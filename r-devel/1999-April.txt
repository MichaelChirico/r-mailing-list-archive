From ihaka@stat.auckland.ac.nz  Thu Apr  1 00:07:40 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu,  1 Apr 1999 11:07:40 +1200 (NZST)
Subject: GC, Disk Storage, etc
In-Reply-To: <Pine.LNX.4.04.9903311441410.14356-100000@localhost>
References: <Pine.LNX.4.04.9903311441410.14356-100000@localhost>
Message-ID: <14082.42975.280157.296729@g.ihaka.slip.auckland.ac.nz>

Gregory R. Warnes writes:
 > 
 > I'm wondering what the plans are for the memory management system.  
 > 
 > Once there is a dynamic memory allocation system in place it would be nice
 > to augment that so that objects which are not currently being used need
 > not be resident in memory.  This way, rarely used objects will not be
 > filling up the memory of the R process.
 > 
 > (Yes, I am thinking about a cross between the current R and S object
 > storage ideas.)
 > 
 > It should be possible to set up an object access system that loads objects
 > on demand, and saves them out to disk when not used using a LRU strategy.
 > 
 > The save to disk could be part of the garbage collection strategy.  Some
 > herusitic like, if we run out of memory, throw all the ojbects we've not
 > used for XXX period of time out to disk.   If there are no such objects,
 > try to increase our available memory.  If that fails, throw things out
 > from least recently used forward.  If we can't manage to satisfy the
 > request using either method, fail the memory allocation and tell the user.
 > 
 > Glancing at the current code, it seems that the hardest part of this would
 > be keeping track of object usage, without imposing excessive overhead.


This is very much what I have in mind, but more for system objects
than user objects.  At startup or when a package is attached, instead
of loading all the objects, we build a list of "promise-to-load"
objects which will load the objects when they are referenced (this is
problematic for closures though because of shared state, but there are
very few if any in the system code).  It would certainly be possible
to time-stamp objects when they are referenced and unload them at gc
time when they have not be referenced for a while.

I'm currently looking at Luke's xlispstat autoload ideas and waiting
the availability of his new garbage collector to see if there might be
better possibilities.

Step one though is to separate the save/restore mechanism from the
garbage collector so that experiments of this type get easier.

	Ross
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From abb@acm.org  Thu Apr  1 03:13:58 1999
From: abb@acm.org (abb@acm.org)
Date: Thu, 1 Apr 1999 04:13:58 +0200
Subject: Makefile fix on Solaris 2.7 (PR#155)
Message-ID: <199904010213.EAA30627@blueberry.kubism.ku.dk>

Full_Name: Andrew Barclay
Version: 0.63.4
OS: Solaris 2.7
Submission from: (NULL) (170.140.252.158)


The Makefile in src/library gets the following error from our Solaris 2.7 make
when making 'docs':
  make: Fatal error: Don't know how to make target `*/man/*.Rd'
  Current working directory R-release/src/library

It doesn't seem to appreciate shell wildcards in the dependencies.
It's been a while since I've done Makefiles, but here are my diffs 
that got it working.  Thanks for such fantastic software!

*** Makefile.original   Wed Mar 31 20:45:50 1999
--- Makefile    Wed Mar 31 20:49:56 1999
***************
*** 15,20 ****
--- 15,21 ----
  PKGS = base eda lqs modreg mva stepfun

  SUBDIRS = profile $(PKGS)
+ RDFILES = $(@echo $(srcdir)/*/man/*.Rd)

  all: Makefile R

***************
*** 37,43 ****
  latex: stamp-latex
  examples: stamp-examples

! stamp-docs: $(srcdir)/*/man/*.Rd $(top_builddir)/library/LibIndex
        @rm -f $@ stamp-help stamp-html stamp-latex stamp-examples
        @echo "Building ALL documentation (help, HTML, LaTeX, R-Examples)"
        @$(MAKE) DOCS
--- 38,44 ----
  latex: stamp-latex
  examples: stamp-examples

! stamp-docs: $(RDFILES) $(top_builddir)/library/LibIndex
        @rm -f $@ stamp-help stamp-html stamp-latex stamp-examples
        @echo "Building ALL documentation (help, HTML, LaTeX, R-Examples)"
        @$(MAKE) DOCS
***************
*** 44,64 ****
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@ stamp-help stamp-html stamp-latex stamp-examples
! stamp-help: $(srcdir)/*/man/*.Rd $(top_builddir)/library/LibIndex
        @rm -f $@
        @OPTS="--nroff" $(MAKE) DOCS
        @touch $@
! stamp-html: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--html"  $(MAKE) DOCS
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@
! stamp-latex: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--latex" $(MAKE) DOCS
        @touch $@
! stamp-examples: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--example" $(MAKE) DOCS
        @touch $@
--- 45,65 ----
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@ stamp-help stamp-html stamp-latex stamp-examples
! stamp-help: $(RDFILES) $(top_builddir)/library/LibIndex
        @rm -f $@
        @OPTS="--nroff" $(MAKE) DOCS
        @touch $@
! stamp-html: $(RDFILES)
        @rm -f $@
        @OPTS="--html"  $(MAKE) DOCS
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@
! stamp-latex: $(RDFILES)
        @rm -f $@
        @OPTS="--latex" $(MAKE) DOCS
        @touch $@
! stamp-examples: $(RDFILES)
        @rm -f $@
        @OPTS="--example" $(MAKE) DOCS
        @touch $@


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr  1 04:55:52 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 1 Apr 1999 05:55:52 +0200
Subject: Makefile fix on Solaris 2.7 (PR#155)
Message-ID: <199904010355.FAA30649@blueberry.kubism.ku.dk>

On Thu, 1 Apr 1999 abb@acm.org wrote:

> Full_Name: Andrew Barclay
> Version: 0.63.4
> OS: Solaris 2.7
> Submission from: (NULL) (170.140.252.158)
> 
> 
> The Makefile in src/library gets the following error from our Solaris 2.7 make
> when making 'docs':
>   make: Fatal error: Don't know how to make target `*/man/*.Rd'
>   Current working directory R-release/src/library
> 
> It doesn't seem to appreciate shell wildcards in the dependencies.
> It's been a while since I've done Makefiles, but here are my diffs 
> that got it working.  Thanks for such fantastic software!

That is an unreleased version, and I guess bug.report() needs to extract a
date for snapshot versions for reports to be useful (if 0.63.4 is genuine).
  
Two comments:
  
1) This has already been changed a couple of days ago, together with the
other places which were giving problems. 0.64.0 (the next release due)
builds and checks correctly for me using Sun 5.x make. (So does the current
0.63.4 snapshot.)                                             

2) If you had read the INSTALL file you would have seen that this was
mentioned _and_ the workaround (use GNU make, not version 3.77) was given.
(The INSTALL file has been changed since to reflect 1.)

As you are into trying pre-release software, please try 0.64 (R-devel) and     
let us know if you have any problems with that.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr  1 04:51:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Thu, 1 Apr 1999 04:51:07 +0100 (BST)
Subject: Makefile fix on Solaris 2.7 (PR#155)
In-Reply-To: <199904010213.EAA30627@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904010449150.25406-100000@auk.stats>

On Thu, 1 Apr 1999 abb@acm.org wrote:

> Full_Name: Andrew Barclay
> Version: 0.63.4
> OS: Solaris 2.7
> Submission from: (NULL) (170.140.252.158)
> 
> 
> The Makefile in src/library gets the following error from our Solaris 2.7 make
> when making 'docs':
>   make: Fatal error: Don't know how to make target `*/man/*.Rd'
>   Current working directory R-release/src/library
> 
> It doesn't seem to appreciate shell wildcards in the dependencies.
> It's been a while since I've done Makefiles, but here are my diffs 
> that got it working.  Thanks for such fantastic software!

That is an unreleased version, and I guess bug.report() needs to extract a
date for snapshot versions for reports to be useful (if 0.63.4 is genuine).
  
Two comments:
  
1) This has already been changed a couple of days ago, together with the
other places which were giving problems. 0.64.0 (the next release due)
builds and checks correctly for me using Sun 5.x make. (So does the current
0.63.4 snapshot.)                                             

2) If you had read the INSTALL file you would have seen that this was
mentioned _and_ the workaround (use GNU make, not version 3.77) was given.
(The INSTALL file has been changed since to reflect 1.)

As you are into trying pre-release software, please try 0.64 (R-devel) and     
let us know if you have any problems with that.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr  1 12:15:01 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 1 Apr 1999 13:15:01 +0200 (CEST)
Subject: PLATFORMS
Message-ID: <14083.21813.762333.384682@pc87.maho.magnaeu.com>

Only three entries thus far.
Please keep them coming in.
-k

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC/FC/MAKE      gcc/egcs-g77/make

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC/FC/MAKE 	egcs/g77/make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC/FC/MAKE	gcc 2.8.1/f77 SC4.2/GNU make
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr  1 15:40:13 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 01 Apr 1999 09:40:13 -0500
Subject: dput / dget
Message-ID: <3703854D.5BE0D95B@bank-banque-canada.ca>

The dump discussion reminded me of a problem I reported early but may not have
been filed as a bug (or may not have been considered a bug):

dput seems to rely on the setting of options()$digits to determine the precision
with which things are written, and the default digits does not seem adequate
(e.g. time series attributes can get truncated enough to make them invalid). A
default for dput of digits=16 would be better.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr  1 18:09:41 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 1 Apr 1999 19:09:41 +0200 (CEST)
Subject: add-on packages
Message-ID: <14083.43093.22882.987965@pc87.maho.magnaeu.com>

It looks like we'll have a 0.64 release by next week.  This should be a
good time for bringing the add-on packages up-to-date as well.  Fixes
should include

* eliminate src-c

* provide complete DESCRIPTION, INDEX and TITLE files with consistent
formatting.  Also please be specific about the copyright/license info.

* provide data indices where applicable (last time I counted, 26 pkgs
had data but only 9 a data index).

The preferred name for the data index is now `00Index' rather than
`index.doc'.  If data files are found but no index, then data() will
give a WARNING when used for listing.

Also, there is now a subdirectory `inst' the contents of which will be
copied recursively (using `cp -r') to the root target dir upon
installation.  This may be useful in particular for copyright info etc
that should be installed along with the package.

It would be great if maintainers could rework their packages
accordingly, which should not be too much effort.  (Includes work for me
too ...)

Thanks,
-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rcreecy@Census.GOV  Thu Apr  1 21:40:48 1999
From: rcreecy@Census.GOV (Rob Creecy)
Date: Thu, 01 Apr 1999 15:40:48 -0500
Subject: GC, Disk Storage, etc
References: <Pine.LNX.4.04.9903311441410.14356-100000@localhost> <14082.42975.280157.296729@g.ihaka.slip.auckland.ac.nz>
Message-ID: <3703D9D0.516FBAE3@census.gov>

Something to keep in mind when designing future memory management
 schemes is that in the not too distant future many machines will
 be 64 bits and have more than 2GB of memory, and it would be nice to be
able
 to fully utilize the available memory. I discovered what seems to be a
current
 limit of 2GB for vector heap size on a DEC ALPHA UNIX 4.0, which fails
 in memory.c doing the malloc for the vector heap when the request is
greater
 than 2GB. I presume this is because address pointers are 32 bits.
 This situation is unfortunate since the machine has 12GB of memory and
I had
 a problem which could have used more than 2GB of memory. I wrote a
FORTRAN
 program instead (which may have been better in the long run anyway)

 I don't have any ideas on how to address this problem, but thought I'd
 raise the issue for your consideration.

Rob 

Ross Ihaka wrote:
> 
> Gregory R. Warnes writes:
>  >
>  > I'm wondering what the plans are for the memory management system.
>  >
>  > Once there is a dynamic memory allocation system in place it would be nice
>  > to augment that so that objects which are not currently being used need
>  > not be resident in memory.  This way, rarely used objects will not be
>  > filling up the memory of the R process.
>  >
>  > (Yes, I am thinking about a cross between the current R and S object
>  > storage ideas.)
>  >
>  > It should be possible to set up an object access system that loads objects
>  > on demand, and saves them out to disk when not used using a LRU strategy.
>  >
>  > The save to disk could be part of the garbage collection strategy.  Some
>  > herusitic like, if we run out of memory, throw all the ojbects we've not
>  > used for XXX period of time out to disk.   If there are no such objects,
>  > try to increase our available memory.  If that fails, throw things out
>  > from least recently used forward.  If we can't manage to satisfy the
>  > request using either method, fail the memory allocation and tell the user.
>  >
>  > Glancing at the current code, it seems that the hardest part of this would
>  > be keeping track of object usage, without imposing excessive overhead.
> 
> This is very much what I have in mind, but more for system objects
> than user objects.  At startup or when a package is attached, instead
> of loading all the objects, we build a list of "promise-to-load"
> objects which will load the objects when they are referenced (this is
> problematic for closures though because of shared state, but there are
> very few if any in the system code).  It would certainly be possible
> to time-stamp objects when they are referenced and unload them at gc
> time when they have not be referenced for a while.
> 
> I'm currently looking at Luke's xlispstat autoload ideas and waiting
> the availability of his new garbage collector to see if there might be
> better possibilities.
> 
> Step one though is to separate the save/restore mechanism from the
> garbage collector so that experiments of this type get easier.
> 
>         Ross
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr  1 23:44:01 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 01 Apr 1999 16:44:01 -0600
Subject: .External interface
Message-ID: <6r90cc0xn2.fsf@verdi.stat.wisc.edu>

There was some mention at the Vienna conference of documenting the
.External interface so the brave could write C code that directly
dealt with SEXP's.  I recently submitted to CRAN/src/contrib/Devel an
add-on to do nonlinear least squares.  That is set up so most of the
work occurs in an nlsModel object which is a list of functions and
their enclosing environment.  Those who think in terms of
object-oriented languages like Java can imagine it to be an instance
of a class.

We would like to write the code that controls the iterations in C -
partially so that implementing things like an algorithm for partially
linear models would be easier.  I need to know how to pass an object
(a list) into a C routine and access the elements, how to force the
evaluation of a function with no arguments, and how to force the
evaluation of a function with a single argument that is a numeric
object.  I presume that I must protect the list that I am passing down
to C so the pointer to that object remains valid after a garbage
collection that may occur during this function evaluation.

I know everyone is busy but a few hints or vague references to look at
the code for ... would help.  Thomas? Robert?
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Fri Apr  2 00:30:45 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Thu, 1 Apr 1999 17:30:45 -0600 (CST)
Subject: .External == .Internal ?
Message-ID: <m10Sqv7-0000X9C@verdi.stat.wisc.edu>

I mentioned the .External interface in my last message.  When I heard
the name, it may have been a joke but I didn't realize that.

Looking through the source code it seems that there are only calls to
.Internal.  I had thought perhaps that .External was a version of
.Internal that could be used with dynamically loaded code.

Am I talking about something that doesn't exist yet and is just in the
planning stages?  (I've got to start paying closer attention in the
R-core meetings.)
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Fri Apr  2 02:03:38 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 1 Apr 1999 17:03:38 -0800 (PST)
Subject: .External == .Internal ?
In-Reply-To: <m10Sqv7-0000X9C@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.10.9904011701530.23400-100000@wompom.biostat.washington.edu>

On Thu, 1 Apr 1999, Douglas Bates wrote:

> I mentioned the .External interface in my last message.  When I heard
> the name, it may have been a joke but I didn't realize that.
> 
> Looking through the source code it seems that there are only calls to
> .Internal.  I had thought perhaps that .External was a version of
> .Internal that could be used with dynamically loaded code.
> 
> Am I talking about something that doesn't exist yet and is just in the
> planning stages?  (I've got to start paying closer attention in the
> R-core meetings.)


No, it's there in R0.64, it just hasn't been used for anything yet.  The
code was sent in to R-devel a few months ago and I added it a few weeks
ago.

The idea is exactly to be able to call dynamically loaded routines in a
similar way to .Internal.

	-thomas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  2 05:35:30 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 2 Apr 1999 16:35:30 +1200 (NZST)
Subject: X11 Device Driver
Message-ID: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>

I have made some modifications to the X11 graphics driver so that it is
more flexible about its use of colors.  I have added a new parameter to
the X11/x11 function which controls this.  The parameter is currently
called "colormodel" and works as follows:

	colormodel = 0		Monochrome graphics
	colormodel = 1		Grayscale (256 shades)
	colormodel = 2		Pseudocolor1
	colormodel = 3		Pseudocolor2
	colormodel = 4		Truecolor

Pseudocolor1 allocates as big a color cube as possible and then
approximates requested colors with colors from the cube.

Pseudocolor2 allocates colors "on-demand" until it runs out of
colors.  You then get a "can't allocate colors" error message.

More sophisticated devices will support the color models of less
sophisticated devices.  E.g. you can do grey-scale and pseudocolor
on a truecolor device.

So, one question is:  How should this functionality be packaged?

One possibility is to have multiple X11 device driver entry points

    X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color

This would be useful because people could use options() to set
the appropriate default device.

Another possibility would be to have use an additional argument to
the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

Perhaps there are better ideas also.

A second question is what should the default behavior be on Pseudocolor
devices; Pseudocolor1 or Pseudocolor2?

Would anyone care to express an opinion.  I'd like to get this commited
for the 0.64 release.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  2 06:38:09 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 2 Apr 1999 06:38:09 +0100 (BST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.05.9904020632260.28106-100000@auk.stats>

On Fri, 2 Apr 1999, Ross Ihaka wrote:

> I have made some modifications to the X11 graphics driver so that it is
> more flexible about its use of colors.  I have added a new parameter to
> the X11/x11 function which controls this.  The parameter is currently
> called "colormodel" and works as follows:
> 
> 	colormodel = 0		Monochrome graphics
> 	colormodel = 1		Grayscale (256 shades)
> 	colormodel = 2		Pseudocolor1
> 	colormodel = 3		Pseudocolor2
> 	colormodel = 4		Truecolor
> 
> Pseudocolor1 allocates as big a color cube as possible and then
> approximates requested colors with colors from the cube.
> 
> Pseudocolor2 allocates colors "on-demand" until it runs out of
> colors.  You then get a "can't allocate colors" error message.
> 
> More sophisticated devices will support the color models of less
> sophisticated devices.  E.g. you can do grey-scale and pseudocolor
> on a truecolor device.
> 
> So, one question is:  How should this functionality be packaged?
> 
> One possibility is to have multiple X11 device driver entry points
> 
>     X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color
> 
> This would be useful because people could use options() to set
> the appropriate default device.
> 
> Another possibility would be to have use an additional argument to
> the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

I would prefer a single driver, with (effectively)

X11(display = "", width = 7, height = 7, pointsize = 12, 
    colortype=options()$X11colortype)

and choosing type from "mono", "gray", "pseudo.cube", "pseudo", "true"
as appropriate.

> A second question is what should the default behavior be on Pseudocolor
> devices; Pseudocolor1 or Pseudocolor2?

Pseudocolor2, please.  I very rarely have a problem (but then I have
netscape and gs under control).

> Would anyone care to express an opinion.  I'd like to get this commited
> for the 0.64 release.

Yes, please.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  2 07:42:55 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 2 Apr 1999 08:42:55 +0200 (CEST)
Subject: PLATFORMS Update
Message-ID: <14084.26351.552385.308376@pc87.maho.magnaeu.com>

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC/FC/MAKE 	egcs/g77/make

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC/FC/MAKE      gcc/egcs-g77/make

NAME		Göran Broström
EMAIL		gb@stat.umu.se
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.2
CC/FC/MAKE      gcc/egcs-g77/make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 5.3 / 6.0
CC/FC/MAKE      egcs/g77/make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC/FC/MAKE      gcc/egcs-g77/make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        alpha-dec-osf4.0
SYSTEM          Digital Unix 4.0E
CC/FC/MAKE      cc/f77/GNUmake

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      cc SC4.2/f77 SC4.2/GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      egcs 1.1 gcc/f77 GNU make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC/FC/MAKE	gcc 2.8.1/f77 SC4.2/GNU make

NAME       	Göran Broström
EMAIL      	gb@stat.umu.se
VERSION    	0.63.3
PLATFORM   	sun-sparc-linux
SYSTEM     	Redhat 5.2
CC/FC/MAKE 	egcs/egcs-g77/make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/(Sun)make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/GNU make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.64
PLATFORM        hppa2.0
SYSTEM          hpux10.20
CC/FC/MAKE      egcs/f2c/(gnu)make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      cc SC4.2/f77 SC4.2/Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      egcs 1.1 gcc/egcs 1.1 f77/GNU make
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Fri Apr  2 08:05:47 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Fri, 2 Apr 1999 09:05:47 +0200 (CEST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
References: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <14084.27723.882357.562231@galadriel.ci.tuwien.ac.at>

>>>>> On Fri, 2 Apr 1999 16:35:30 +1200 (NZST),
>>>>> Ross Ihaka (RI) wrote:

RI> I have made some modifications to the X11 graphics driver so that it is
RI> more flexible about its use of colors.  I have added a new parameter to
RI> the X11/x11 function which controls this.  The parameter is currently
RI> called "colormodel" and works as follows:

RI> 	colormodel = 0		Monochrome graphics
RI> 	colormodel = 1		Grayscale (256 shades)
RI> 	colormodel = 2		Pseudocolor1
RI> 	colormodel = 3		Pseudocolor2
RI> 	colormodel = 4		Truecolor

RI> Pseudocolor1 allocates as big a color cube as possible and then
RI> approximates requested colors with colors from the cube.

don't know if that's possible, but how hard would it be to optionally
limit the size of the cube? I have something in mind like only
allowing 64 colors or whatever to be able to start other applications
(and leaving them some room in the colormap) after R has started.

Netscape.maxImageColors worked always fine for me ...


.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  2 08:27:56 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 2 Apr 1999 19:27:56 +1200 (NZST)
Subject: X11 Device Driver
In-Reply-To: <14084.27723.882357.562231@galadriel.ci.tuwien.ac.at>
Message-ID: <Pine.BSF.3.96.990402192506.6514A-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 2 Apr 1999, Friedrich Leisch wrote:

> RI> Pseudocolor1 allocates as big a color cube as possible and then
> don't know if that's possible, but how hard would it be to optionally
> limit the size of the cube? I have something in mind like only
> allowing 64 colors or whatever to be able to start other applications
> (and leaving them some room in the colormap) after R has started.
> 
> Netscape.maxImageColors worked always fine for me ...

It'll be easy enough to add a maxcolors= argument, with a
default of 256.

Any other requests from anyone while I'm at it?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Fri Apr  2 10:16:27 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Fri, 2 Apr 1999 11:16:27 +0200 (CEST)
Subject: legends of barplots
Message-ID: <14084.35563.482242.1349@galadriel.ci.tuwien.ac.at>



is there a hidden reason why the legend in barplot is in reverse order
(i.e. from bottom to top?). if nobody cares I would change it to the
usual top to bottom.

and while I'm at it: wouldn't it be more natural if in a horizontal
barplot things are also sorted from top to bottom?

.f

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  2 12:14:46 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 02 Apr 1999 13:14:46 +0200
Subject: PLATFORMS Update
In-Reply-To: Kurt Hornik's message of "Fri, 2 Apr 1999 08:42:55 +0200 (CEST)"
References: <14084.26351.552385.308376@pc87.maho.magnaeu.com>
Message-ID: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>

Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

> 
> NAME       	Göran Broström
> EMAIL      	gb@stat.umu.se
> VERSION    	0.63.3
> PLATFORM   	sun-sparc-linux
> SYSTEM     	Redhat 5.2
> CC/FC/MAKE 	egcs/egcs-g77/make
                ^^^^
Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  2 12:37:22 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 2 Apr 1999 12:37:22 +0100 (BST)
Subject: PLATFORMS Update
In-Reply-To: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>

On 2 Apr 1999, Peter Dalgaard BSA wrote:

> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> 
> > 
> > NAME       	Göran Broström
> > EMAIL      	gb@stat.umu.se
> > VERSION    	0.63.3
> > PLATFORM   	sun-sparc-linux
> > SYSTEM     	Redhat 5.2
> > CC/FC/MAKE 	egcs/egcs-g77/make
>                 ^^^^
> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

Note: sun-sparc, and Peter once told me that has nothing to do
with the compiler on Intel.

This makes me say what I thought of earlier: would be it be a good
idea for Kurt to ask those people who used gcc/egcs to give us a
version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
not install by default) so it would be very easy to have a grabbed
a later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version
in use here).


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  2 13:00:53 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 2 Apr 1999 14:00:53 +0200 (CEST)
Subject: PLATFORMS Update
In-Reply-To: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
References: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
 <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
Message-ID: <14084.45429.23176.961539@pc87.maho.magnaeu.com>

>>>>> Prof Brian D Ripley writes:

> On 2 Apr 1999, Peter Dalgaard BSA wrote:
>> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
>> 
>> > 
>> > NAME       	Göran Broström
>> > EMAIL      	gb@stat.umu.se
>> > VERSION    	0.63.3
>> > PLATFORM   	sun-sparc-linux
>> > SYSTEM     	Redhat 5.2
>> > CC/FC/MAKE 	egcs/egcs-g77/make
>> ^^^^
>> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
>> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

> Note: sun-sparc, and Peter once told me that has nothing to do
> with the compiler on Intel.

> This makes me say what I thought of earlier: would be it be a good
> idea for Kurt to ask those people who used gcc/egcs to give us a
> version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
> not install by default) so it would be very easy to have a grabbed a
> later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version in
> use here).

Yes it would be a good idea.

Ideally we should have something like

	CC	gcc 2.7.2.3
	FC	egcs-2.90.29 980515 (egcs-1.0.3 release)
	MAKE	GNU make 3.76.1

which would be my current setup.

Brian suggested this morning to redo PLATFORMS as follows:  first an
intro part like

0.63.3:
  Linux:
    i386	Debian 1.3, 2.0, Red Hat 4.0, 5.0, 5.2, SuSe 6.0
    ppc		LinuxPPC 4
    alpha	xxx
  FreeBSD 2.2.5
  SGI Irix 6.2
  Sun Solaris (Sparc) 2.5.1, 2.6, 2.7
  DEC Alpha (OSF4)

and then simply append the new-style database for detailed info.

Maybe I should then split CC/FC/MAKE as above.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  2 15:40:51 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 02 Apr 1999 16:40:51 +0200
Subject: PLATFORMS Update
In-Reply-To: Prof Brian D Ripley's message of "Fri, 2 Apr 1999 12:37:22 +0100 (BST)"
References: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
Message-ID: <x21zi313ws.fsf@blueberry.kubism.ku.dk>

Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

> On 2 Apr 1999, Peter Dalgaard BSA wrote:
> 
> > Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> > 
> > > 
> > > NAME       	Göran Broström
> > > EMAIL      	gb@stat.umu.se
> > > VERSION    	0.63.3
> > > PLATFORM   	sun-sparc-linux
> > > SYSTEM     	Redhat 5.2
> > > CC/FC/MAKE 	egcs/egcs-g77/make
> >                 ^^^^
> > Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> > 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?
> 
> Note: sun-sparc, and Peter once told me that has nothing to do
> with the compiler on Intel.

Argh. Saw RedHat, implied Intel... Sorry. 

Yes, the bug is very system-dependent -- doesn't even affect the
windows-i386 egcs compiler (not in that spot anyway) since it doesn't
inline the same routines.

> This makes me say what I thought of earlier: would be it be a good
> idea for Kurt to ask those people who used gcc/egcs to give us a
> version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
> not install by default) so it would be very easy to have a grabbed
> a later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version
> in use here).

Agreed. Optimization levels too?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From gb@stat.umu.se  Fri Apr  2 15:39:37 1999
From: gb@stat.umu.se (Goran Brostrom)
Date: Fri, 2 Apr 1999 16:39:37 +0200 (CEST)
Subject: PLATFORMS Update
In-Reply-To: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.LNX.4.10.9904021633230.4028-100000@capa.stat.umu.se>

On 2 Apr 1999, Peter Dalgaard BSA wrote:

> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> 
> > 
> > NAME       	Göran Broström
> > EMAIL      	gb@stat.umu.se
> > VERSION    	0.63.3
> > PLATFORM   	sun-sparc-linux
> > SYSTEM     	Redhat 5.2
> > CC/FC/MAKE 	egcs/egcs-g77/make
>                 ^^^^
> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?
> 

1. It seems as if the redhat 5.2 sparc only has egcs. Because
   a) /usr/bin/egcs and /usr/bin/gcc are identical.
   b) gcc -v:
Reading specs from /usr/lib/gcc-lib/sparc-redhat-linux/egcs-2.90.29/specs
gcc version egcs-2.90.29 980515 (egcs-1.0.3 release)

   This is different from the i386 version, where:
[gb@localhost gb]$ gcc -v
Reading specs from /usr/lib/gcc-lib/i386-redhat-linux/2.7.2.3/specs
gcc version 2.7.2.3
[gb@localhost gb]$ diff /usr/bin/egcs /usr/bin/gcc
Binary files /usr/bin/egcs and /usr/bin/gcc differ

2. It completes "make check".

Göran
--------------------------------------------------------------
 Göran Broström
 Department of Statistics              tel: +46 90 786-5223
 Umeå University                       fax: +46 90 786-6614
 S-90187 Umeå, Sweden               e-mail:  gb@stat.umu.se

 http://www.stat.umu.se/~gb          ftp://capa.stat.umu.se
--------------------------------------------------------------

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Fri Apr  2 18:07:32 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 2 Apr 1999 09:07:32 -0800 (PST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.10.9904020905040.27714-100000@wompom.biostat.washington.edu>

On Fri, 2 Apr 1999, Ross Ihaka wrote:

> 
> So, one question is:  How should this functionality be packaged?
>\ 
> One possibility is to have multiple X11 device driver entry points
> 
>     X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color
> 
> This would be useful because people could use options() to set
> the appropriate default device.
> 
> Another possibility would be to have use an additional argument to
> the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

I'd prefer this one 


> Perhaps there are better ideas also.
> 
> A second question is what should the default behavior be on Pseudocolor
> devices; Pseudocolor1 or Pseudocolor2?

I would go for allocating colors on demand, especially if we can print out
a message suggesting the color cube driver when colors run out.

	-thomas


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jean@stat.ubc.ca  Fri Apr  2 22:58:54 1999
From: jean@stat.ubc.ca (Jean Meloche)
Date: Fri, 02 Apr 1999 21:58:54 +0000
Subject: patch against overflows in saveload.c
Message-ID: <37053D9E.BC882FC8@stat.ubc.ca>

This is a multi-part message in MIME format.
--------------3F9F11E6B00532CFDD5A424A
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

R fails to save long strings... (with xdr)

> str<-''; for(i in c(0:1000)) str<-paste(str,'a')
> q(save='yes')
Error: a write error occured
>

This was noticed a while ago and someone
suggested a large fixed sized buffer.

The attached patch allocates a buffer as needed
using malloc. I know R has ist own allocation
mechanism but I figured malloc was ok for
such short-lived buffers.

If not, please let me know how to do it properly.

--
Jean Meloche
--------------3F9F11E6B00532CFDD5A424A
Content-Type: text/plain; charset=us-ascii;
 name="sl.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="sl.diff"

--- saveload.c	Tue Feb 16 09:15:59 1999
+++ /usr/local/R-0.63.3/src/main/saveload.c	Fri Apr  2 13:25:42 1999
@@ -1,7 +1,6 @@
 /*
  *  R : A Computer Language for Statistical Data Analysis
  *  Copyright (C) 1995, 1996  Robert Gentleman and Ross Ihaka
- *  Copyright (C) 1997--1999  Robert Gentleman, Ross Ihaka and the R Core Team
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -61,7 +60,7 @@
 static int	(*InInteger)(FILE*);
 static double	(*InReal)(FILE*);
 static complex	(*InComplex)(FILE*);
-static char*	(*InString)(FILE*);
+static char*	(*InString)(FILE*,int,char *);
 static void	(*InTerm)(FILE*);
 
 
@@ -195,7 +194,7 @@
     fputc('\"', fp);
 }
 
-static char *AsciiInString(FILE *fp)
+static char *AsciiInString(FILE *fp, int len, char *buf)
 {
     int c;
     bufp = buf;
@@ -346,16 +345,17 @@
 
 static void XdrOutString(FILE *fp, char *s)
 {
-    if (!xdr_string(&xdrs, &s, MAXELTSIZE - 1)) {
+    if (!xdr_string(&xdrs, &s, strlen(s))) {
 	xdr_destroy(&xdrs);
 	error("a write error occured\n");
     }
 }
 
-static char *XdrInString(FILE *fp)
+static char *XdrInString(FILE *fp, int len, char *buf)
 {
-    char *bufp = buf;
-    if (!xdr_string(&xdrs, &bufp, MAXELTSIZE - 1)) {
+    char *bufp;
+    bufp=buf;
+    if (!xdr_string(&xdrs, &bufp, len)) {
 	xdr_destroy(&xdrs);
 	error("a read error occured\n");
     }
@@ -439,7 +439,7 @@
 	error("a write error occured\n");
 }
 
-static char *BinaryInString(FILE *fp)
+static char *BinaryInString(FILE *fp, int len, char *buf)
 {
     bufp = buf;
     do {
@@ -705,6 +705,8 @@
 		OutSpace(fp);
 		OutInteger(fp, NodeToOffset(&R_NHeap[i]));
 		OutSpace(fp);
+		OutInteger(fp, strlen(CHAR(PRINTNAME(&R_NHeap[i]))));
+		OutSpace(fp);
 		OutString(fp, CHAR(PRINTNAME(&R_NHeap[i])));
 		OutNewline(fp);
 		k++;
@@ -737,7 +739,6 @@
     for (i = 0; i < R_NSize; i++) {
 	if (MARK(&R_NHeap[i])) {
 	    if (TYPEOF(&R_NHeap[i]) != SYMSXP) {
-
 		OutInteger(fp, n);
 		OutSpace(fp);
 		OutInteger(fp, TYPEOF(&R_NHeap[i]));
@@ -845,6 +846,7 @@
 {
     unsigned int j;
     int len;
+    char *buf;
 
     TYPEOF(s) = InInteger(fp);
 
@@ -887,12 +889,16 @@
     case SPECIALSXP:
     case BUILTINSXP:
 	len = InInteger(fp);
-	PRIMOFFSET(s) = StrToInternal(InString(fp));
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	PRIMOFFSET(s) = StrToInternal(InString(fp, len, buf));
+	free(buf);
 	break;
     case CHARSXP:
 	LENGTH(s) = len = InInteger(fp);
 	ReallocString(s, len);
-	strcpy(CHAR(s), InString(fp));
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	strcpy(CHAR(s), InString(fp, len, buf));
+	free(buf);
 	break;
     case REALSXP:
 	LENGTH(s) = len = InInteger(fp);
@@ -956,9 +962,14 @@
     /* computing the forwarding addresses */
 
     for (i = 0 ; i < NSymbol ; i++) {
+	char *buf;
+	int len;
 	j = InInteger(fp);
 	OldOffset[j] = InInteger(fp);
-	NewAddress[j] = install(InString(fp));
+	len = InInteger(fp);
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	NewAddress[j] = install(InString(fp,len,buf));
+	free(buf);
     }
 
     /* symbols are all installed */
@@ -1074,7 +1085,7 @@
 	TAG(t) = install(CHAR(STRING(CAR(args))[j]));
 	CAR(t) = findVar(TAG(t), R_GlobalContext->sysparent);
 	if (CAR(t) == R_UnboundValue)
-            error("Object \"%s\" not found\n", CHAR(PRINTNAME(TAG(t))));
+	    error("Object \"%s\" not found\n", CHAR(PRINTNAME(TAG(t))));
     }
 
     R_SaveToFile(s, fp, INTEGER(CADDR(args))[0]);
@@ -1811,12 +1822,12 @@
 do_hdf5save (SEXP call, SEXP op, SEXP args, SEXP env)
 {
     errorcall(call, "HDF5 support unavailable\n");
-    return(R_NilValue);		/* -Wall */
+    return(R_NilValue);         /* -Wall */
 }
 SEXP
 do_hdf5load (SEXP call, SEXP op, SEXP args, SEXP env)
 {
     errorcall(call, "HDF5 support unavailable\n");
-    return(R_NilValue);		/* -Wall */    
+    return(R_NilValue);         /* -Wall */
 }
 #endif

--------------3F9F11E6B00532CFDD5A424A--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jean@stat.ubc.ca  Fri Apr  2 23:01:21 1999
From: jean@stat.ubc.ca (Jean Meloche)
Date: Fri, 02 Apr 1999 22:01:21 +0000
Subject: R patch for strsplit
Message-ID: <37053E31.DC51F380@stat.ubc.ca>

This is a multi-part message in MIME format.
--------------031DBBD5368F0FEAFF79DE0C
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

R core dumps when strsplit-ing long strings:

> str<-''; for(i in c(0:1000)) str<-paste(str,'a')
> strsplit(str,' ')
Bus Error (core dumped)

The attached patch fixes the problem in strsplit
by mallocating a short lived buffer of the right
size.

-- 
Jean Meloche
--------------031DBBD5368F0FEAFF79DE0C
Content-Type: text/plain; charset=us-ascii;
 name="ch.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="ch.diff"

--- character.c	Sun Feb 21 23:59:40 1999
+++ /usr/local/R-0.63.3/src/main/character.c	Fri Apr  2 13:24:03 1999
@@ -107,7 +107,7 @@
 {
     SEXP s, t, tok, x;
     int i, j, len, tlen, ntok;
-    char buff[MAXELTSIZE], *pt, *split = "";
+    char *buff, *pt, *split = "";
 
     checkArity(op, args);
     x = CAR(args);
@@ -119,6 +119,7 @@
     PROTECT(s = allocVector(VECSXP, len));
     for (i = 0; i < len; i++) {
 	/* find out how many splits there will be */
+	buff=malloc(strlen(CHAR(STRING(x)[i]))+1);
 	strcpy(buff, CHAR(STRING(x)[i]));
 	if (tlen > 0) {
 	    split = CHAR(STRING(tok)[i % tlen]);
@@ -150,6 +151,7 @@
 	}
 	UNPROTECT(1);
 	VECTOR(s)[i] = t;
+	free(buff);
     }
     UNPROTECT(1);
     return s;

--------------031DBBD5368F0FEAFF79DE0C--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sat Apr  3 09:38:00 1999
From: wvenable@arcola.stats.adelaide.edu.au (wvenable@arcola.stats.adelaide.edu.au)
Date: Sat, 3 Apr 1999 10:38:00 +0200
Subject: tabulate causes segmentation fault (PR#156)
Message-ID: <199904030838.KAA31481@blueberry.kubism.ku.dk>

Peter,

I thought this one was noted and fixed, but I could be wrong.

    R : Copyright 1999, The R Development Core Team
    Version 0.63.3  (March 6, 1999)
    
    ....
    
    [Previously saved workspace restored]
    
    > tabulate(1:10, 5)
    
    Process R:1 segmentation fault at Sat Apr  3 17:48:34 1999

-- 
(The following contact details become official on 1 May 1999, but
the email address works now and may be used from now on.)
-----------------------------------------------------------------
Bill Venables, Statistician, CMIS Environmetrics Project.

Physical address:                            Postal address:
CSIRO Marine Laboratories,                   PO Box 120,       
233 Middle St, Cleveland, Queensland         Cleveland, Qld, 4163
AUSTRALIA                                    AUSTRALIA

Telephone: +61 7 3826 7200     Email: Bill.Venables@cmis.csiro.au     
      Fax: +61 7 3826 7304

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr  3 10:34:08 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 03 Apr 1999 11:34:08 +0200
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: wvenable@arcola.stats.adelaide.edu.au's message of "Sat, 3 Apr 1999 10:38:00 +0200"
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
Message-ID: <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>

wvenable@arcola.stats.adelaide.edu.au writes:

> Peter,
> 
> I thought this one was noted and fixed, but I could be wrong.
> 
>     R : Copyright 1999, The R Development Core Team
>     Version 0.63.3  (March 6, 1999)
>     
>     ....
>     
>     [Previously saved workspace restored]
>     
>     > tabulate(1:10, 5)
>     
>     Process R:1 segmentation fault at Sat Apr  3 17:48:34 1999

It wasn't...

However, all it needs is a bit of defensive programming. But should it

(a) Protest if any(bin)>nbins
or 
(b) Quietly set bin[bin>nbins] <- 0  # or NA, no matter

(one could also start the routine with bin<-bin[bin<=nbin])

I think (b) since that is consistent with the way values <= 0 are
currently handled.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sun Apr  4 01:11:39 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Sun, 4 Apr 1999 09:41:39 +0930 (CST)
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
 <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
Message-ID: <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>

>>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    Peter> wvenable@arcola.stats.adelaide.edu.au writes:

    >> R : Copyright 1999, The R Development Core Team Version
    >> 0.63.3 (March 6, 1999)
    >> 
    >> ....
    >> 
    >> [Previously saved workspace restored]
    >> 
    >> > tabulate(1:10, 5)
    >> 
    >> Process R:1 segmentation fault at Sat Apr 3 17:48:34 1999

    Peter> It wasn't...

    Peter> However, all it needs is a bit of defensive
    Peter> programming.

Yes, Peter, but by whom?  My point was that this kind of massive
bear trap was not something that should be the users' sole
responsibility to avoid.  Having a simple exception capable of
killing the session and losing all data is perhaps OK for
MicroSoft, but it should not be OK for us.  I believe the flaw is
still present in the nascent 0.64, which bothers me.

I think it should be solved at the C level since tabulate() is
one of those things that you want to be ultra-slick, but if this
is not possible right now, perhaps we will have to put up with a
stop-gap measure.  For example you could change it in 0.64 to

tabulate <- function (bin, nbins = max(bin)) {  
    if (!is.numeric(bin) && !is.factor(bin)) 
        stop("tabulate: bin must be numeric or a factor")

    nbins <- max(0, nbins) 
    if(!missing(nbins) && !all(OK <- (bin <= nbins))) 
	bin <- bin[OK]
    n <- length(bin)
    storage.mode(bin) <- "integer"

    .C("tabulate", bin, n, ans = integer(nbins))$ans
}

> tabulate(1:10, 5)
[1] 1 1 1 1 1
> tabulate(1:10 + 0.1, 5)
[1] 1 1 1 1 0
> tabulate(1:10, 0)
numeric(0)
> tabulate(sample(1:10, 50000, rep=T))
 [1] 5016 5048 4996 5020 4914 5089 5059 4885 4998 4975
> 

I think any degradation in performance over the present version
would be mostly negligible and the whole thing would be much safer.
Users who need ultra-slickness still have the option of using he
C code directly - that is the wonderful benefit of open code.

Bill
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sun Apr  4 07:11:49 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Sun, 4 Apr 1999 15:41:49 +0930 (CST)
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
 <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
 <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>
Message-ID: <14087.677.890232.822546@arcola.stats.adelaide.edu.au>

OK, I have a few noodles around my ears...  

The fix I gave for tabulate can cause problems with factors (and
breaks truehist in the MASS library!).  Here is a further
refinement, which is now getting a little messy, I do admit, but
I'm pretty sure this covers it.  (At least truehist works...)

--(begin tabulate.R)--
tabulate <- function (bin, nbins = max(bin)) {
    if (!is.numeric(bin) && !is.factor(bin)) 
        stop("tabulate: bin must be numeric or a factor")
    nbins <- max(0, nbins)

    if (!missing(nbins)) {
      if (is.factor(bin))
        bin <- unclass(bin)
      if (!all(OK <- (bin <= nbins)))
        bin <- bin[OK]
    }

    n <- length(bin)
    storage.mode(bin) <- "integer"
    .C("tabulate", bin, n, ans = integer(nbins))$ans
}
--(end tabulate.R)--
Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr  4 08:04:17 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Sun, 4 Apr 1999 09:04:17 +0200
Subject: tabulate causes segmentation fault (PR#156)
Message-ID: <199904040704.JAA31993@blueberry.kubism.ku.dk>

On Sun, 4 Apr 1999, Bill Venables wrote:

> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
> 
>     Peter> wvenable@arcola.stats.adelaide.edu.au writes:
> 
>     >> R : Copyright 1999, The R Development Core Team Version
>     >> 0.63.3 (March 6, 1999)
>     >> 
>     >> ....
>     >> 
>     >> [Previously saved workspace restored]
>     >> 
>     >> > tabulate(1:10, 5)
>     >> 
>     >> Process R:1 segmentation fault at Sat Apr 3 17:48:34 1999
> 
>     Peter> It wasn't...
> 
>     Peter> However, all it needs is a bit of defensive
>     Peter> programming.
> 
> Yes, Peter, but by whom?  My point was that this kind of massive
> bear trap was not something that should be the users' sole
> responsibility to avoid.  Having a simple exception capable of
> killing the session and losing all data is perhaps OK for
> MicroSoft, but it should not be OK for us.  I believe the flaw is
> still present in the nascent 0.64, which bothers me.
> 
> I think it should be solved at the C level since tabulate() is
> one of those things that you want to be ultra-slick, but if this
> is not possible right now, perhaps we will have to put up with a

I have put a change in at the C level _and_ altered the help page to
document what tabulate does and what its arguments are. I think the 
defensive programming should be at the C level, for users can call the 
entry point.

The code is now much cleaner (I think):

tabulate <- function(bin, nbins = max(1,bin))
{
    if(!is.numeric(bin) && !is.factor(bin))
	stop("tabulate: bin must be numeric or a factor")
    .C("tabulate",
       as.integer(bin),
       as.integer(length(bin)),
       as.integer(nbins),
       ans = integer(nbins))$ans
}

As tabulate() silently ignored negative integers, I thought it could
silently ignore ones beyond nbins too, especially as I have documented
this.

I reckon the answer for

> tabulate(numeric(0))
[1] 0

is wrong (I would have had a zero-length vector) but have left it for
compatibility.

> stop-gap measure.  For example you could change it in 0.64 to
> 
> tabulate <- function (bin, nbins = max(bin)) {  
>     if (!is.numeric(bin) && !is.factor(bin)) 
>         stop("tabulate: bin must be numeric or a factor")
> 
>     nbins <- max(0, nbins) 
>     if(!missing(nbins) && !all(OK <- (bin <= nbins))) 
> 	bin <- bin[OK]
>     n <- length(bin)
>     storage.mode(bin) <- "integer"
> 
>     .C("tabulate", bin, n, ans = integer(nbins))$ans
> }

Um. although not previously documented, tabulate is used with factors (as
in S).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr  4 11:15:56 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 04 Apr 1999 12:15:56 +0200
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Sun, 4 Apr 1999 09:04:17 +0200"
References: <199904040704.JAA31993@blueberry.kubism.ku.dk>
Message-ID: <x2bth43d43.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> The code is now much cleaner (I think):
> 
> tabulate <- function(bin, nbins = max(1,bin))
> {
>     if(!is.numeric(bin) && !is.factor(bin))
> 	stop("tabulate: bin must be numeric or a factor")
>     .C("tabulate",
>        as.integer(bin),
>        as.integer(length(bin)),
>        as.integer(nbins),
>        ans = integer(nbins))$ans
> }

.. except that it relies on the following phenomenon:
> max(factor(0:3))
Error: "max" not meaningful for factors
> max(1,factor(0:3))
[1] 4

BTW: Why are we testing for x[i] != R_NaInt in tabulate.c, when 

> tabulate(c(1:3,NA),3)
Error: NAs in foreign function call (arg 1)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr  4 18:04:53 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 4 Apr 1999 18:04:53 +0100 (BST)
Subject: "integer" mod ein .C/.Fortran call
Message-ID: <Pine.GSO.4.05.9904041755330.12670-100000@auk.stats>

I have just discovered that mode integer in C maps to int in C and integer
in Fortran, whereas it maps to long in C loaded in to S.  This seems
undocumented in R, and the base R code is not consistent in its usage, let
alone user packages.

Can those of you who have long != int tell us what your machines use, and
also if Fortran integer is equal to C int (which is assumed in a lot
of places).

I believe that on DEC Alpha S-PLUS uses 64-bit "integer", corresponding to
C long and Fortran integer.  I understand R is trying to use 32 bits for
R "integer", C int and Fortran integer.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sun Apr  4 22:36:10 1999
From: bates@stat.wisc.edu (bates@stat.wisc.edu)
Date: Sun, 4 Apr 1999 23:36:10 +0200
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
Message-ID: <199904042136.XAA32150@blueberry.kubism.ku.dk>

Full_Name: Douglas Bates
Version: Version 0.64.0 Unstable (April 3, 1999)
OS: Debian GNU/Linux 2.1
Submission from: (NULL) (128.105.5.97)


R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
R> anova( fm2 )
Analysis of Variance Table

Response: /
Response: 1
Response: Surv
                Df Sum Sq Mean Sq F value  Pr(>F)    
Poison           2   34.9    17.4   72.63 2.3e-13 ***
Antidote         3   20.4     6.8   28.34 1.4e-09 ***
Poison:Antidote  6    1.6     0.3    1.09    0.39    
Residuals       36    8.6     0.2                    
---
Signif. codes:  0  `***'  0.001  `**'  0.01  `*'  0.05  `.'  0.1  ` '  1 


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr  5 06:06:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Mon, 5 Apr 1999 06:06:07 +0100 (BST)
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
In-Reply-To: <199904042136.XAA32150@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904050603001.18277-100000@auk.stats>

On Sun, 4 Apr 1999 bates@stat.wisc.edu wrote:

> Full_Name: Douglas Bates
> Version: Version 0.64.0 Unstable (April 3, 1999)
> OS: Debian GNU/Linux 2.1
> Submission from: (NULL) (128.105.5.97)

[Is that an R problem: should not there be a machine name there?]
 

> R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
> R> anova( fm2 )
> Analysis of Variance Table
> 
> Response: /
> Response: 1
> Response: Surv

[...]

Actually, there is no print.anova.lm (print.anova is used) but the error is
a lack of a deparse in anova.lm. I have fixed this for 0.64 (whilst
incorporating Jean Meloche's patches for singular models).

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr  5 06:11:38 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 5 Apr 1999 07:11:38 +0200
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
Message-ID: <199904050511.HAA32384@blueberry.kubism.ku.dk>

On Sun, 4 Apr 1999 bates@stat.wisc.edu wrote:

> Full_Name: Douglas Bates
> Version: Version 0.64.0 Unstable (April 3, 1999)
> OS: Debian GNU/Linux 2.1
> Submission from: (NULL) (128.105.5.97)

[Is that an R problem: should not there be a machine name there?]
 

> R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
> R> anova( fm2 )
> Analysis of Variance Table
> 
> Response: /
> Response: 1
> Response: Surv

[...]

Actually, there is no print.anova.lm (print.anova is used) but the error is
a lack of a deparse in anova.lm. I have fixed this for 0.64 (whilst
incorporating Jean Meloche's patches for singular models).

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr  6 08:02:45 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 6 Apr 1999 08:02:45 +0100 (BST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <6ryakk2s15.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904060754340.23118-100000@auk.stats>

On 26 Mar 1999, Douglas Bates wrote:

> >>>>> "Jonathan" == Jonathan Rougier <J.C.Rougier@durham.ac.uk> writes:
> 
>   Jonathan> On Fri, 26 Mar 1999, Martyn Plummer wrote:
>   >> The problem isn't that the help files take up a lot of space, but
>   >> that certain file systems are extremely inefficient in the use of
>   >> that space.
> 
>   Jonathan> This is probably an unrealistic suggestion, but if
>   Jonathan> compression is less of a problem than the number of files,
>   Jonathan> why not take the help files `onboard' by creating a new
>   Jonathan> class of objects with mode "help", which would be lists
>   Jonathan> with components much like the current .Rd files, and
>   Jonathan> attach them at the bottom of the search list.  Each
>   Jonathan> library would then require just a single file of help
>   Jonathan> objects.
> 
> This is a reasonable suggestion but I think that the way that R
> handles its search lists would make this problematic.  At present
> objects in a library take up space in memory whether they are used or
> not.  Also, the search to resolve a name is a linear search over the
> available names.  Adding a whole lot more names for help objects would
> exacerbate both of those problems.  Then there is the name-space
> pollution problem.
> 
> Approaches to all of these issues with names and objects are being
> discussed and will probably be implemented in later releases.  Right
> now I think the best approach to the problem of help files,
> etc. (other than waiting for certain commercial operating systems to
> catch up with concepts from the 1980's) is to use the zip format for
> the reasons that Brian Ripley indicated.

Doing this proved relatively easy and quite fast enough. It will appear
in the next Windows version (rw0640, I presume) that is due in a few days.
We just use unzip to extract a file and display it. (There is a DLL
version of unzip, but it seems unnecessary.)  Using zipped help is optional
by package, and where selected (when installing the package from source)
zips up the text, latex and example files. The space savings on a VFAT16
file system are considerable (about 20Mb on my system).

It is a little unfair to blame Windows: it has had more space-efficient
file systems (NTFS, FAT32) for some time. The problem is that not
everything else (notably Linux) could read/write these, and so they
were not the defaults.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Tue Apr  6 08:45:45 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Tue, 6 Apr 1999 09:45:45 +0200
Subject: seg fault with strsplit (PR#158)
Message-ID: <199904060745.JAA32726@blueberry.kubism.ku.dk>

Try the following with R 63.3:

test <- function(z){
	ch1 <- deparse(z,width=500)
	ch <- NULL
	for(i in 1:length(ch1))ch <- paste(ch,ch1[i],collapse=" ")
	a <- gsub("(\\[(0|1|2|3|4|5|6|7|8|9|:|,)+\\])|([][+*/^():!<>%&|~,{}\"\\\=-])|( [0-9]+)|(^[0-9]+)"," ",ch)
	print("here")
	strsplit(a," ")
}
test(glm)

Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr  6 09:30:27 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 06 Apr 1999 10:30:27 +0200
Subject: seg fault with strsplit (PR#158)
In-Reply-To: jlindsey@alpha.luc.ac.be's message of "Tue, 6 Apr 1999 09:45:45 +0200"
References: <199904060745.JAA32726@blueberry.kubism.ku.dk>
Message-ID: <x2hfqui21o.fsf@blueberry.kubism.ku.dk>

jlindsey@alpha.luc.ac.be writes:

> Try the following with R 63.3:
> 
> test <- function(z){
> 	ch1 <- deparse(z,width=500)
> 	ch <- NULL
> 	for(i in 1:length(ch1))ch <- paste(ch,ch1[i],collapse=" ")
> 	a <- gsub("(\\[(0|1|2|3|4|5|6|7|8|9|:|,)+\\])|([][+*/^():!<>%&|~,{}\"\\\=-])|( [0-9]+)|(^[0-9]+)"," ",ch)
> 	print("here")
> 	strsplit(a," ")
> }
> test(glm)

We know... Buffer overflow. There's been a patch for it on r-devel by Jean
Meloche, using a short-lived malloc/free thing, but I'm still waiting
for someone to assure me that it won't interfere with current and
future memory management schemes.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr  6 11:22:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 6 Apr 1999 11:22:07 +0100 (BST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <199904061004.MAA05558@sophie.ethz.ch>
Message-ID: <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>

On Tue, 6 Apr 1999, Martin Maechler wrote:

[discussion moved make to R-devel]

> >>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
> 
>     <.....>
> 
>     BDR> Doing this proved relatively easy and quite fast enough. It will
>     BDR> appear in the next Windows version (rw0640, I presume) that is due
>     BDR> in a few days.  We just use unzip to extract a file and display
>     BDR> it. (There is a DLL version of unzip, but it seems unnecessary.)
>     BDR> Using zipped help is optional by package, and where selected (when
>     BDR> installing the package from source) zips up the text, latex and
>     BDR> example files. The space savings on a VFAT16 file system are
>     BDR> considerable (about 20Mb on my system).
> 
> Brian, 
> this will be part of R `proper',  not just the windows extensions
> right after  0.64, will it?

I am not sure about this. The gain is really only on systems with large
clusters, and that means Windows VFAT16, where small clusters are 4Kb and
clusters can be 32Kb (and are on a > 1Gb disc).

The other issue is licensing. I compiled unzip for Win32 and followed the
minimal allowed distribution as part of the binary distribution. On
source platforms the use of unzip would be optional, but with binary
distributions you would need to ensure unzip is available.

Is there any interest in having this on Unix/Linux platforms?  If so I can
very easily change the source code to search zip files if present.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Tue Apr  6 13:30:56 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Tue, 6 Apr 1999 14:30:56 +0200 (CEST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>
References: <199904061004.MAA05558@sophie.ethz.ch>
 <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>
Message-ID: <14089.65152.713639.650826@galadriel.ci.tuwien.ac.at>

>>>>> On Tue, 6 Apr 1999 11:22:07 +0100 (BST),
>>>>> Prof Brian D Ripley (PBDR) wrote:


PBDR> Is there any interest in having this on Unix/Linux platforms?  If so I can
PBDR> very easily change the source code to search zip files if present.

Yes, I think I want the help system as consistent across platforms as
possible, i.e., using the same mechanisms everywhere. Should be easier
to maintain.

.f


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@blueberry.kubism.ku.dk  Wed Apr  7 06:15:03 1999
From: pd@blueberry.kubism.ku.dk (Peter Dalgaard BSA)
Date: Wed, 7 Apr 1999 07:15:03 +0200
Subject: Bug list summary (automatic post)
Message-ID: <199904070515.HAA26555@blueberry.kubism.ku.dk>

=================================================
This is an automated summary of the status of the R-bugs
repository.

Note that this may be neither complete nor perfectly
correct at any given instance: Not all bugs are reported,
and some reported bugs may have been fixed, but the
repository not yet updated.

Some bug fixes are difficult to verify because they pertain
to specific hardware or operating system versions. If you
have information to contribute, please do so.

If you happen to know how to fix a problem please send
patches to the bug repository, too.

New bugs are reported either through the web
interface at r-bugs.biostat.ku.dk or via email to
r-bugs@biostat.ku.dk. The bug.report() function can be
used to automate parts of the procedure on many systems.
Followups on older bugs can be done by including the string
"(PR#999)" in the Subject of an email (change 999 to the
actual reference number, of course!).
=================================================

Directory:  Accuracy

* PR# 138 *
Subject: Re: [R] bug? and New bug.
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 10 Mar 1999 17:21:16 +0100

Directory:  Add-ons

* PR# 122 *
Subject: [R] possible bug in loglm
From: D.A.Wooff@durham.ac.uk
Date: Thu, 18 Feb 1999 17:06:11 +0000 (GMT)
--Problem with running inside function. 
* PR# 137 *
Subject: funfits
From: "Alvaro A. Novo" <novo@uiuc.edu>
Date: Tue, 9 Mar 1999 22:24:54 -0600

Directory:  Analyses

none

Directory:  Documentation

* PR# 146 *
Subject: nlm docs
From: Patrick Lindsey <plindsey@alpha.luc.ac.be>
Date: Wed, 24 Mar 1999 15:48:41 +0100 (MET)

Directory:  Graphics

* PR# 38 *
Subject: possible bugs
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Sun, 6 Sep 1998 15:59:34 -0400 (EDT)
--ylim problem which appears solved
--Postscript overflow still with us (22feb99)
* PR# 61 *
Subject: points(...,  cex = ..)  is pretty wrong...
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 2 Nov 1998 19:15:06 +0100
--Symbols getting decentered when too large cex for X. Still there 22feb99  
* PR# 66 *
Subject: Bug with bounding box?
From: johnp@tip.csiro.au
Date: Thu, 3 Dec 1998 02:15:38 +0100
--Yes, this appears to have x/y reversed. The supplied example gives 
--%%Orientation: Landscape
--%%BoundingBox: 18 18 824 577 
--but the convention is to rotate the paper but leave the coordinate system.
* PR# 69 *
Subject: Some graphics bugs
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 04 Dec 1998 11:42:50 -0000 ()
Date: 04-Dec-98
--Various anomalies with text size and alignment. 2B appears to be solved. The 
--rest is still there (22feb99)
* PR# 79 *
Subject: apology: text(locator(),"sometext") works
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Tue, 15 Dec 1998 19:45:29 -0500 (EST)
--Clipping discrepancy x11/PS
* PR# 106 *
Subject: border-arg. in persp
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Fri, 29 Jan 1999 11:12:39 +0100
--No effect of arg. Still here 22feb99. Segfault with border=0 seems gone now. 
* PR# 114 *
Subject: PostScript Level 1/2 bug
From: ben@eno.princeton.edu
Date: Mon, 8 Feb 1999 00:07:20 +0100
--Not sure whether this is really PS lev 1/2 issue.
--/Font5 /Symbol findfont definefont
--(missing scalefont?)
* PR# 120 *
Subject: graphics bug: type="l"
From: Matthew Wiener <mcw@ln.nimh.nih.gov>
Date: Tue, 16 Feb 1999 15:30:25 -0500 (EST)
--X server problem drawing > 64K lines at once. Workaround?
* PR# 123 *
Subject: Text in plot
From: Ennapadam Venkatraman <venkat@biosta.mskcc.org>
Date: Thu, 18 Feb 1999 13:05:37 -0500
--Multiline text not working
* PR# 130 *
Subject: lty=0 -- shouldn't it give an invisible line?
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 28 Feb 1999 21:45:43 +0100
* PR# 149 *
Subject: plot.formula and pch=
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 25 Mar 1999 21:22:44 +0100
* PR# 150 *
Subject: R: error report
From: Adelchi Azzalini <adelchi.azzalini@jrc.it>
Date: Fri, 26 Mar 1999 09:39:05 +0000
* PR# 153 *
Subject: image + x11
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Wed, 31 Mar 1999 14:09:53 +0200

Directory:  In-Out

* PR# 117 *
Subject: load() -> segfault
From: "Gregory R. Warnes" <warnes@biostat.washington.edu>
Date: Mon, 8 Feb 1999 18:10:36 -0800 (PST)
--Fixed-size buffer used to hold unlimited size object. Not good...
* PR# 125 *
Subject: scan rejects complex
From: John.Peters@tip.csiro.au (John Peters)
Date: Mon, 22 Feb 1999 10:08:14 +1100 (EST)
* PR# 129 *
Subject: Formatting in formatC and format
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 28 Feb 1999 08:53:34 +0000 (GMT)
--Documentation and ``merge'' of format() and formatC() would be desired - MM

Directory:  Installation

* PR# 95 *
Subject: patch to 63.2
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 15 Jan 1999 11:00:25 +0100 (MET)
--An incident where the 0.63.2 patches didn't take. So far the only one. 
--Maybe caused by patching unclean sources?

Directory:  Language

* PR# 40 *
Subject:  fac1 : fac2 -- fails {no "cross" anymore in seq.c} 
From: maechler@stat.math.ethz.ch
Date: Wed, 16 Sep 1998 08:42:12 +0200
--still there 17feb99
* PR# 85 *
Subject:  A bug in data.entry? 
From: Yusuke Uchiyama <me@naxgul.kais.kyoto-u.ac.jp>
Date: Wed, 23 Dec 1998 11:03:03 GMT
--still there 17feb99
* PR# 89 *
Subject: lapply -- Recall bug
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 6 Jan 1999 15:04:14 +0100
--This is *nasty*.
* PR# 105 *
Subject: an old bug resurfaces
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 29 Jan 1999 08:28:32 +0100 (MET)
--Model formulas. Proper fix probably requires extensive rewrite of model formula
--parser, which would make in non-S-compatible.
* PR# 113 *
Subject: cat data types
From: John Peters <johnp@tip.CSIRO.AU>
Date: Fri, 5 Feb 1999 18:31:52 +1100 (EDT)
--Cannot cat a name. (Docs fixed to reflect this by Kurt, 22feb99)
* PR# 118 *
Subject: Function parsing
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
Date: Wed, 10 Feb 1999 13:42:01 +0000 (GMT)
--comment placement.
* PR# 142 *
Subject: exists finds objects lots of places!
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:34:34 +0100
--No bug; not S compatible; documentation should be clearer

Directory:  Low-level

* PR# 37 *
Subject: S.h compatibility issues
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 6 Sep 1998 19:58:47 +0100 (BST)
* PR# 119 *
Subject: Problems with warnings from loess under Windows, at least
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Thu, 11 Feb 1999 15:08:41 +0000 (GMT)
* PR# 140 *
Subject: rbind dimnames with complex
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:15:14 +0100

Directory:  Misc

* PR# 91 *
Subject: possible bug
From: Rashid Nassar <rnassar@duke.edu>
Date: Sat, 9 Jan 1999 14:50:58 -0500 (EST)
--Remaining issue is whether we can do something more friendly than dumping 
--users into vi?

Directory:  Models

* PR# 121 *
Subject:  model.frame mangles time series 
From: Peter Dalgaard BSA <pd@biostat.ku.dk>
Date: Thu, 18 Feb 1999 15:47:24 +0100
--Subset in C code + attributes = mess
--Switch to interpreted ("[")

Directory:  Startup

* PR# 21 *
Subject: Restoring large image files
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 21 Aug 1998 13:29:16 -0000 ()

Directory:  System-specific

none

Directory:  TooMuchAtOnce

* PR# 53 *
Subject: 0.62.3 bugs, incompatibilities and problems
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 12 Oct 1998 09:43:51 +0200 (MET DST)
* PR# 76 *
Subject: R-0.63.0
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Fri, 11 Dec 1998 23:20:08 -0500 (EST)

Directory:  Windows

* PR# 46 *
Subject: keyboard bug in Guido's R62.3
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Thu, 24 Sep 1998 09:55:39 +0200 (MET DST)
* PR# 47 *
Subject: q() function in win32 version 0.61.3
From: normo@ratfish.pbs.dfo.ca
Date: Thu, 24 Sep 1998 22:04:10 +0200
* PR# 57 *
Subject: windows95
From: christoph.kalinowski@ku-eichstaett.de
Date: Thu, 29 Oct 1998 11:00:18 +0100
* PR# 59 *
Subject: windows nt
From: christoph.kalinowski@biostat.ku.dk
Date: Mon, 2 Nov 1998 13:41:52 +0100
* PR# 101 *
Subject: Re: [R] Re: R-0.63.2 for Windows - some comments
From: Guido Masarotto <guido@hal.stat.unipd.it>
Date: Fri, 22 Jan 1999 12:40:26 +0100

Directory:  incoming

* PR# 127 *
Subject: history
From: jmhughes@globalnet.co.uk
Date: Sat, 27 Feb 1999 21:32:56 +0100
* PR# 132 *
Subject: Re: [R] zero-offset matrices
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 02 Mar 1999 16:59:48 +0100
* PR# 133 *
Subject: Re: system
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 Mar 1999 11:33:21 +0100
* PR# 135 *
Subject: summary() of lm() problem
From: Simon Fear <fears@roycastle.liv.ac.uk>
Date: Tue, 9 Mar 1999 13:18:37 -0000 
--lm (?) AND Windows problem;  Win solved for 0.63.3
* PR# 139 *
Subject: : for factors
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 11 Mar 1999 09:30:04 +0100
* PR# 144 *
Subject: glm throws erroneous(?)'names attribute must be the same length as the vector' 
From: wagman@enteract.com
Date: Thu, 18 Mar 1999 08:58:47 +0100
* PR# 145 *
Subject: R-0.63.3 package on IRIX 6.5 machine
From: Jayshree Sarma <jsarma@cs.gmu.edu>
Date: Tue, 23 Mar 1999 16:54:20 -0500 (EST)
* PR# 148 *
Subject: Missing Warning in :
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 25 Mar 1999 13:34:12 +0100
* PR# 151 *
Subject: problems with formals and get
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 29 Mar 1999 09:29:05 +0200 (MET DST)
* PR# 152 *
Subject: Example(persp) fails in 0.63.4 and 0.64
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Tue, 30 Mar 1999 21:19:37 +0100 (BST)
* PR# 157 *
Subject: deparsing lhs of formula in print.anova.lm
From: bates@stat.wisc.edu
Date: Sun, 4 Apr 1999 23:36:08 +0200
* PR# 158 *
Subject: seg fault with strsplit
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Tue, 6 Apr 1999 09:41:29 +0200 (MET DST)
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Wed Apr  7 08:58:05 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Wed, 7 Apr 1999 09:58:05 +0200
Subject: offsets again (PR#159)
Message-ID: <199904070758.JAA26645@blueberry.kubism.ku.dk>

1. Try the following in 63.3

y <- rnorm(20)
y1 <- y[2:20]
y2 <- y[1:19]
summary(glm(y1~offset(y2)))
summary(glm(y1-y2~1))

Both are the same model, but the first gives the wrong s.e.
I don't believe this was a problem in 63.2

2. Besides the strsplit buffer, there appear to be other memory
problems causing seg faults. With vsize 12M in batch, I accumulated 9
glm objects in memory, then called one of my RM functions and
systematically got a seg fault. After much searching, I simply removed
the 9 objects before calling my function, the problem went away. This
did not occur in 63.2 but I have changed my function so that it now
uses strsplit and modifies function environments. However, in this
case, strsplit is not applied to any text that would cause buffer
overflow.
  Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 09:38:33 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Wed, 7 Apr 1999 10:38:33 +0200
Subject: offsets again (PR#159)
Message-ID: <199904070838.KAA26671@blueberry.kubism.ku.dk>

On Wed, 7 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> 1. Try the following in 63.3
> 
> y <- rnorm(20)
> y1 <- y[2:20]
> y2 <- y[1:19]
> summary(glm(y1~offset(y2)))
> summary(glm(y1-y2~1))
> 
> Both are the same model, but the first gives the wrong s.e.
> I don't believe this was a problem in 63.2

raw residuals from a glm with offset were wrong: fixed for 0.64.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From steuer@amadeus.statistik.uni-dortmund.de  Wed Apr  7 15:25:56 1999
From: steuer@amadeus.statistik.uni-dortmund.de (Dipl.-Stat. Detlef Steuer)
Date: Wed, 07 Apr 1999 16:25:56 +0200 (CEST)
Subject: chull() wanted?
Message-ID: <XFMail.990407162556.steuer@amadeus.statistik.uni-dortmund.de>

Hello!

Is there someone already working on an implementation of Splus'
chull() function for R?
If not, I would like volunteer to try it.

For my "Diplom" I implemented convex peeling in C (some time ago),
 using an O(n log(n)) algorithm, so it probably will prove relatively easy to
use that code for a R-function.

Well, as least as easy as any programming tends to be. :-)  

Detlef Steuer



Detlef Steuer Universitaet Dortmund                             ///////
LS Computergestuetzte Statistik                          U N I D O ///  
steuer@amadeus.statistik.uni-dortmund.de                ______///////  
Tel: ++49 +231 755 4353 Fax: ++49 +231 755 4387         \_\_\_\/////
                                                         \_\_\_\///
                                                          \_\_\_\/

*** Use what talents you possess: the woods would be very silent ***
*** if no birds sang there except those that sang best.          ***
*** Henry Van Dyke                                               ***
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Wed Apr  7 15:29:46 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Wed, 7 Apr 1999 16:29:46 +0200
Subject: core dump (PR#160)
Message-ID: <199904071429.QAA00885@blueberry.kubism.ku.dk>

Here is the output from gdb for one of my numerous reproducible core
dumps. Unfortunately, I cannot send the R code because it involves a lot
of data setting up and a special order of calling my ehr function in
my event library. Note that I am using 63.3 and not calling any of my
own C or Fortran. Jim

GNU gdb 4.17.0.4 with Linux/x86 hardware watchpoint and FPU support
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...
Core was generated by `/usr/local/src/R/bin/R.binary --no-save --no-restore --nsize 1M --vsize 12M'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/X11R6/lib/libSM.so.6...done.
Reading symbols from /usr/X11R6/lib/libICE.so.6...done.
Reading symbols from /usr/X11R6/lib/libX11.so.6...done.
Reading symbols from /usr/lib/libf2c.so.0...done.
Reading symbols from /usr/lib/libreadline.so.3...done.
Reading symbols from /lib/libdl.so.2...done.
Reading symbols from /usr/lib/libncurses.so.4...done.
Reading symbols from /lib/libm.so.6...done.
Reading symbols from /lib/libc.so.6...done.
Reading symbols from /lib/libtermcap.so.2...done.
Reading symbols from /lib/ld-linux.so.2...done.
Reading symbols from /usr/local/src/R/library/rmutil/libs/rmutil.so...done.
Reading symbols from /usr/local/src/R/library/event/libs/event.so...done.
#0  0x8080d6c in markSExp (s=Cannot access memory at address 0xbfffede4.
) at memory.c:501
501         if (s && !MARK(s)) {

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 15:29:57 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Wed, 7 Apr 1999 16:29:57 +0200
Subject: offsets again (PR#159)
Message-ID: <199904071429.QAA00889@blueberry.kubism.ku.dk>

On Wed, 7 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> 1. Try the following in 63.3
> 
> y <- rnorm(20)
> y1 <- y[2:20]
> y2 <- y[1:19]
> summary(glm(y1~offset(y2)))
> summary(glm(y1-y2~1))
> 
> Both are the same model, but the first gives the wrong s.e.
> I don't believe this was a problem in 63.2

My apologies: I have mis-edited the patch I applied, working too close
to the deadline for 0.64. I have in glm.fit

    residuals[good] <- z - (eta + offset)[good] # z does not have

Change + to - .

Oh well, 0.64.1 may get this right.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 15:46:44 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Wed, 7 Apr 1999 15:46:44 +0100 (BST)
Subject: chull() wanted?
In-Reply-To: <XFMail.990407162556.steuer@amadeus.statistik.uni-dortmund.de>
Message-ID: <Pine.GSO.4.05.9904071543310.10385-100000@auk.stats>

On Wed, 7 Apr 1999, Dipl.-Stat. Detlef Steuer wrote:

> Hello!
> 
> Is there someone already working on an implementation of Splus'
> chull() function for R?
> If not, I would like volunteer to try it.
> 
> For my "Diplom" I implemented convex peeling in C (some time ago),
>  using an O(n log(n)) algorithm, so it probably will prove relatively easy to
> use that code for a R-function.

If only you had volunteered a month ago!

There is one implementation in package sm, and a cleaner one in 0.64, due
out today.  Both as versions of Eddy's 1977 algorithm. I would be happy to
replace the present chull by something better, though. It doesn't do
peeling, but that is easy to arrange in R: just remove the convex hull and
repeat.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From J.C.Rougier@durham.ac.uk  Thu Apr  8 10:26:23 1999
From: J.C.Rougier@durham.ac.uk (Jonathan Rougier)
Date: Thu, 8 Apr 1999 10:26:23 +0100 (BST)
Subject: chol()
Message-ID: <Pine.GSO.3.96.990408093028.11467C-100000@laplace>

May I suggest the following modification to chol(), allowing calls on
variance matrices with zeros in the diagonal.  This makes the generation
of multivariate gaussian vectors simpler, and consistent with rnorm()
which can take a zero standard deviation argument. 

"Chol" <-
function (x, tol = sqrt(.Machine$double.eps)) 
{
    if (!is.numeric(x)) 
        stop("non-numeric argument to chol")
    x <- as.matrix(x)
    if (length(n <- unique(dim(x))) > 1) 
        stop("non-square matrix in chol")
    nzero <- diag(x) > tol
    if (!all(nzero)) {
        cx <- Recall(x[nzero, nzero])
        x[] <- 0
        x[nzero, nzero] <- cx
        x
    }
    else {
        if (!is.double(x)) 
            storage.mode(x) <- "double"
        z <- .Fortran("chol", x = x, n, n, v = matrix(0, nr = n, 
            nc = n), info = integer(1), DUP = FALSE)
        if (z$info) 
            stop("singular matrix in chol")
        z$v
    }
}

I know that almost everyone has got one of these, but for completeness
here is my multivariate gaussian function which defaults to rnorm()

"rgauss" <-
function (n, mu, sig, ch = all(sig[lower.tri(sig)] == 0)) 
{
    if (missing(mu)) {
        if (missing(sig)) 
            sig <- 1
        sig <- as.matrix(sig)
        k <- unique(dim(sig))
        if (length(k) > 1) 
            stop("Non-square \"sig\" matrix")
        mu <- rep(0, k)
    }
    else {
        k <- length(mu)
        if (missing(sig)) 
            sig <- diag(rep(1, k))
        else {
            sig <- as.matrix(sig)
            if (any(k != dim(sig))) 
                stop("\"mu\" and \"sig\" inconsistent")
        }
    }
    # uses Chol() to handle zero variances
    if (!ch) 
        sig <- Chol(sig)
    rn <- matrix(rnorm(n * k), nrow = n)
    drop(sweep(rn %*% sig, 2, mu, "+"))
}

Regards, Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE

"[B]egin upon the precept ... that the things we see are to be 
 weighed in the scale with what we know"  (Meredith, 1879, The Egoist)

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rossini@biostat.washington.edu  Thu Apr  8 15:06:06 1999
From: rossini@biostat.washington.edu (A.J. Rossini)
Date: 08 Apr 1999 07:06:06 -0700
Subject: submission method "none" of bug.report() -- interaction with ESS ?
In-Reply-To: Martin Maechler's message of "Thu, 8 Apr 1999 15:55:04 +0200"
References: <14092.40223.352251.472183@galadriel.ci.tuwien.ac.at> <199904081340.PAA06350@sophie.ethz.ch> <14092.46140.344668.897964@galadriel.ci.tuwien.ac.at> <199904081355.PAA06373@sophie.ethz.ch>
Message-ID: <87vhf7b41d.fsf@alpha.cfas.washington.edu>


>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:
>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:
    FrL> This is not only a problem of bug.report(), but of providing
    FrL> a working editor in ESS ... because the same happens if you
    FrL> say edit(lm) or of whatever object you want.

    MM> but nobody sane using ESS would say
    MM>     edit(..)
    MM> 	       ;-)

Well, we hope not.  I guess we should scan for bug.report and edit,
and do the appropriate thing :-).

(for edit, "dump-object to buffer", for bugreport, dump everything
including mail, x-rated pictures, etc, into a file and send it to
r-bugs, until it's fixed in R -- who says you can't have the same kind
of fun with unix that the windows users had with melissa? :-) 

-- but seriously, what should the proper response be?  

R for unix then ought to have an --ess flag, the way Windows does, to
prevent such occurrences, and we can handle things appropriately (and
better!) in ESS.

best,
-tony

-- 
A.J. Rossini
UW Biostatistics & Center for AIDS Research 
206-543-1044 / 206-720-4282                 
rossini@biostat.washington.edu              
http://www.biostat.washington.edu/~rossini/ 
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Thu Apr  8 15:22:43 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Thu, 8 Apr 1999 15:22:43 +0100 (BST)
Subject: submission method "none" of bug.report() -- interaction with ESS ?
Message-ID: <199904081422.PAA14650@toucan.stats.ox.ac.uk>


> R for unix then ought to have an --ess flag, the way Windows does, to
> prevent such occurrences, and we can handle things appropriately (and
> better!) in ESS.

At present it does nothing visible. The best idea is I think for ESS to
set an environment variable which the R code can check for. As in

if(getenv("R_UNDER_ESS")) options(editor="gnuclient")


(Martin: you can have gnuclient on Solaris, I believe.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From mh.smith@auckland.ac.nz  Fri Apr  9 04:20:28 1999
From: mh.smith@auckland.ac.nz (mh.smith@auckland.ac.nz)
Date: Fri, 9 Apr 1999 05:20:28 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090320.FAA00615@blueberry.kubism.ku.dk>

Full_Name: Murray H Smith
Version: 0.63.3
OS: Windows NT
Submission from: (NULL) (130.216.5.57)


The ppois function is displaced by -0.5.
Try:

> ppois(-0.5,1)
[1] 0.3678794
> ppois(-0.51,1)
[1] 0
> ppois(0,1)
[1] 0.3678794

and

> par(mfrow=c(2,1))
> x<-seq(-1,5,0.01)
> plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 07:32:30 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 08:32:30 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090632.IAA00859@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999 mh.smith@auckland.ac.nz wrote:

> Full_Name: Murray H Smith
> Version: 0.63.3
> OS: Windows NT
> Submission from: (NULL) (130.216.5.57)
> 
> 
> The ppois function is displaced by -0.5.
> Try:
> 
> > ppois(-0.5,1)
> [1] 0.3678794
> > ppois(-0.51,1)
> [1] 0
> > ppois(0,1)
> [1] 0.3678794


The problem is in

> ?ppois

The Poisson Distribution

     dpois(x, lambda)
     ppois(q, lambda)
     qpois(p, lambda)
     rpois(n, lambda)

Arguments:

       x: vector of (positive) quantiles.

       p: vector of probabilities.

       n: number of random values to return.

  lambda: vector of positive means.

where q is undefined! It should only be defined for integers. Similarly, x
should only be integers.

It seems better to make ppois defined as the CDF for all q. The code had

    x = floor(x + 0.5);

and that should be something like floor(x + 1e-7).

I've fixed this for 0.64.1, and dpois now warns on non-integer x and,
correctly, gives 0. (Yes, I know S does not warn, but that is taking
silence too far I think.)

> 
> and
> 
> > par(mfrow=c(2,1))
> > x<-seq(-1,5,0.01)
> > plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> > plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")

Thank you for the nice example, now on the help page.


You did not try pnbinom, which is much more wrong:

> pnbinom(1, 3, 0.5)
[1] 0.3125
> pnbinom(1.1, 3, 0.5)
[1] 0.3320067
> pnbinom(1.5, 3, 0.5)
[1] 0.4089029


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 07:31:33 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 9 Apr 1999 07:31:33 +0100 (BST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <199904090320.FAA00615@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904090652020.28479-100000@auk.stats>

On Fri, 9 Apr 1999 mh.smith@auckland.ac.nz wrote:

> Full_Name: Murray H Smith
> Version: 0.63.3
> OS: Windows NT
> Submission from: (NULL) (130.216.5.57)
> 
> 
> The ppois function is displaced by -0.5.
> Try:
> 
> > ppois(-0.5,1)
> [1] 0.3678794
> > ppois(-0.51,1)
> [1] 0
> > ppois(0,1)
> [1] 0.3678794


The problem is in

> ?ppois

The Poisson Distribution

     dpois(x, lambda)
     ppois(q, lambda)
     qpois(p, lambda)
     rpois(n, lambda)

Arguments:

       x: vector of (positive) quantiles.

       p: vector of probabilities.

       n: number of random values to return.

  lambda: vector of positive means.

where q is undefined! It should only be defined for integers. Similarly, x
should only be integers.

It seems better to make ppois defined as the CDF for all q. The code had

    x = floor(x + 0.5);

and that should be something like floor(x + 1e-7).

I've fixed this for 0.64.1, and dpois now warns on non-integer x and,
correctly, gives 0. (Yes, I know S does not warn, but that is taking
silence too far I think.)

> 
> and
> 
> > par(mfrow=c(2,1))
> > x<-seq(-1,5,0.01)
> > plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> > plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")

Thank you for the nice example, now on the help page.


You did not try pnbinom, which is much more wrong:

> pnbinom(1, 3, 0.5)
[1] 0.3125
> pnbinom(1.1, 3, 0.5)
[1] 0.3320067
> pnbinom(1.5, 3, 0.5)
[1] 0.4089029


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Fri Apr  9 07:39:16 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Fri, 9 Apr 1999 08:39:16 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090639.IAA00863@blueberry.kubism.ku.dk>

In R0.64.0, try
as.numeric(is.na(c(NA,NA,1)))
as.numeric(c(T,T,F))
  Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:29:39 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:29:39 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090729.JAA00872@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:

>      ppois(q, lambda)
> 
> where q is undefined! It should only be defined for integers. Similarly, x
> should only be integers.

Ummmm.  I guess I see the argument for dpois, but I thought the
distribution function was defined for all values.  Wouldn't it be in order
to apply the integer argument function to floor(q) perhaps?

This seems to be what S does.

	> ppois(1.5, 2)
	[1] 0.4060058
	> ppois(1.1, 2)
	[1] 0.4060058


	Ross



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:23:40 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:23:40 +1200 (NZST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <Pine.GSO.4.05.9904090652020.28479-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990409191434.3007A-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:

>      ppois(q, lambda)
> 
> where q is undefined! It should only be defined for integers. Similarly, x
> should only be integers.

Ummmm.  I guess I see the argument for dpois, but I thought the
distribution function was defined for all values.  Wouldn't it be in order
to apply the integer argument function to floor(q) perhaps?

This seems to be what S does.

	> ppois(1.5, 2)
	[1] 0.4060058
	> ppois(1.1, 2)
	[1] 0.4060058


	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:34:21 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:34:21 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090734.JAA00876@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999, Ross Ihaka wrote:

Some nonsense or other ... Never mind, it's late Friday.

But ...  How about dpois(1.2, 3) returning NA?

	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:28:24 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:28:24 +1200 (NZST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <Pine.BSF.3.96.990409191434.3007A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.BSF.3.96.990409192558.3007B-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999, Ross Ihaka wrote:

Some nonsense or other ... Never mind, it's late Friday.

But ...  How about dpois(1.2, 3) returning NA?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:36:37 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:36:37 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090736.JAA00880@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> In R0.64.0, try
> as.numeric(is.na(c(NA,NA,1)))
> as.numeric(c(T,T,F))

My version says

	> as.numeric(is.na(c(NA,NA,1)))
	[1] 1 1 0
	> as.numeric(c(T,T,F))
	[1] 1 1 0

which I think is ok?

	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:30:09 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:30:09 +1200 (NZST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904090639.IAA00863@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990409192859.3007C-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> In R0.64.0, try
> as.numeric(is.na(c(NA,NA,1)))
> as.numeric(c(T,T,F))

My version says

	> as.numeric(is.na(c(NA,NA,1)))
	[1] 1 1 0
	> as.numeric(c(T,T,F))
	[1] 1 1 0

which I think is ok?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 08:48:25 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 09:48:25 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090748.JAA00884@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:

> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
> 
> >      ppois(q, lambda)
> > 
> > where q is undefined! It should only be defined for integers. Similarly, x
> > should only be integers.
> 
> Ummmm.  I guess I see the argument for dpois, but I thought the
> distribution function was defined for all values.  Wouldn't it be in order
> to apply the integer argument function to floor(q) perhaps?

Try reading on:

> > It seems better to make ppois defined as the CDF for all q. The code
had
> > 
> >    x = floor(x + 0.5);
> >
> > and that should be something like floor(x + 1e-7).

(q in R is x in C.)

> This seems to be what S does.
> 
> 	> ppois(1.5, 2)
> 	[1] 0.4060058
> 	> ppois(1.1, 2)
> 	[1] 0.4060058

and R-0.64.1 does

> ppois(1.5, 2)
[1] 0.4060058
> ppois(1.1, 2)
[1] 0.4060058
> dpois(1.1, 2)
Warning: non-integer x = 1.100000
[1] 0

Happy?

Brian


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 09:55:56 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 10:55:56 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090855.KAA00972@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> and R-0.64.1 does
> 
> > ppois(1.5, 2)
> [1] 0.4060058
> > ppois(1.1, 2)
> [1] 0.4060058
> > dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0
> 
> Happy?

Almost. Do you use round(x) - x < 1e-7 or some such as criterion for
"integer"? (although I'd be hard pressed to come up with a natural
example where the argument to dpois is subject to FP accuracy issues)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 10:04:56 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 11:04:56 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090904.LAA01010@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:
> 
> > In R0.64.0, try
> > as.numeric(is.na(c(NA,NA,1)))
> > as.numeric(c(T,T,F))
> 
> My version says
> 
> 	> as.numeric(is.na(c(NA,NA,1)))
> 	[1] 1 1 0
> 	> as.numeric(c(T,T,F))
> 	[1] 1 1 0
> 
> which I think is ok?

Mine has 

> as.numeric(is.na(c(NA,NA,1)))
[1] -1 -1  0

Which is obviously not OK...

Seems to affect all numeric NA's:

> as.numeric(is.na(as.numeric(NA)))
[1] -1

This is on RedHat 5.2 (As Jim, I suspect)

Ick!

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 10:04:45 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 09 Apr 1999 11:04:45 +0200
Subject: a strange logical bug (PR#162)
In-Reply-To: Ross Ihaka's message of "Fri, 9 Apr 1999 19:30:09 +1200 (NZST)"
References: <Pine.BSF.3.96.990409192859.3007C-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <x2g16a411u.fsf@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:
> 
> > In R0.64.0, try
> > as.numeric(is.na(c(NA,NA,1)))
> > as.numeric(c(T,T,F))
> 
> My version says
> 
> 	> as.numeric(is.na(c(NA,NA,1)))
> 	[1] 1 1 0
> 	> as.numeric(c(T,T,F))
> 	[1] 1 1 0
> 
> which I think is ok?

Mine has 

> as.numeric(is.na(c(NA,NA,1)))
[1] -1 -1  0

Which is obviously not OK...

Seems to affect all numeric NA's:

> as.numeric(is.na(as.numeric(NA)))
[1] -1

This is on RedHat 5.2 (As Jim, I suspect)

Ick!

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 10:37:42 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 11:37:42 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090937.LAA01047@blueberry.kubism.ku.dk>

> Mine has 
> 
> > as.numeric(is.na(c(NA,NA,1)))
> [1] -1 -1  0
> 
> Which is obviously not OK...
> 
> Seems to affect all numeric NA's:
> 
> > A)))
> [1] -1
> 
> This is on RedHat 5.2 (As Jim, I suspect)

On RH 5.2

       The isnan() function returns a non-zero value if value  is
       "not-a-number" (NaN), and 0 otherwise.

and that non-zero is not defined!

On Solaris:

     isnan(), isnand(), and isnanf() return true (1) if the argu-
     ment dsrc or fsrc is a NaN; otherwise they return false (0).

and isnan is used in Arith.c for ISNAN and that is used in coerce.c
for do_isna (why?)

So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
solves this one for me.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  9 11:43:10 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt.Hornik@ci.tuwien.ac.at)
Date: Fri, 9 Apr 1999 12:43:10 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904091043.MAA03073@blueberry.kubism.ku.dk>

>>>>> ripley  writes:

> On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:
>> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
>> 
>> >      ppois(q, lambda)
>> > 
>> > where q is undefined! It should only be defined for integers. Similarly, x
>> > should only be integers.
>> 
>> Ummmm.  I guess I see the argument for dpois, but I thought the
>> distribution function was defined for all values.  Wouldn't it be in order
>> to apply the integer argument function to floor(q) perhaps?

> Try reading on:

>> > It seems better to make ppois defined as the CDF for all q. The code
> had
>> > 
>> >    x = floor(x + 0.5);
>> >
>> > and that should be something like floor(x + 1e-7).

> (q in R is x in C.)

>> This seems to be what S does.
>> 
>> > ppois(1.5, 2)
>> [1] 0.4060058
>> > ppois(1.1, 2)
>> [1] 0.4060058

> and R-0.64.1 does

>> ppois(1.5, 2)
> [1] 0.4060058
>> ppois(1.1, 2)
> [1] 0.4060058
>> dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0

> Happy?

No!  Why the warning?  dpois(non-integer, something) makes perfect
sense, and simply gives 0.

(Yes, dwilcox() and dsignrank() will need fixing, too ...)

-k

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  9 11:48:46 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 9 Apr 1999 12:48:46 +0200 (CEST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <199904090748.JAA00884@blueberry.kubism.ku.dk>
References: <199904090748.JAA00884@blueberry.kubism.ku.dk>
Message-ID: <14093.56078.682524.466080@pc87.maho.magnaeu.com>

>>>>> ripley  writes:

> On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:
>> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
>> 
>> >      ppois(q, lambda)
>> > 
>> > where q is undefined! It should only be defined for integers. Similarly, x
>> > should only be integers.
>> 
>> Ummmm.  I guess I see the argument for dpois, but I thought the
>> distribution function was defined for all values.  Wouldn't it be in order
>> to apply the integer argument function to floor(q) perhaps?

> Try reading on:

>> > It seems better to make ppois defined as the CDF for all q. The code
> had
>> > 
>> >    x = floor(x + 0.5);
>> >
>> > and that should be something like floor(x + 1e-7).

> (q in R is x in C.)

>> This seems to be what S does.
>> 
>> > ppois(1.5, 2)
>> [1] 0.4060058
>> > ppois(1.1, 2)
>> [1] 0.4060058

> and R-0.64.1 does

>> ppois(1.5, 2)
> [1] 0.4060058
>> ppois(1.1, 2)
> [1] 0.4060058
>> dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0

> Happy?

No!  Why the warning?  dpois(non-integer, something) makes perfect
sense, and simply gives 0.

(Yes, dwilcox() and dsignrank() will need fixing, too ...)

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Fri Apr  9 11:52:05 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Fri, 9 Apr 1999 12:52:05 +0200 (DFT)
Subject: Compilation problems with R-0.64.0
Message-ID: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>

Hi,

I have just tried to upgrade our AIX-machines to R-0.64.0 and encountered
some problems which, I think, are not AIX-specific.

1) The static variable class in "devX11.c" conflicts with a function
class() defined in math.h (using egcs-2.93.11). Therefore compilation
stops with an error message.

2) After renaming class to Visualclass in devX11.c everything looks fine
and an R binary file is created. However, it is not possible to open an
X11 window:

> x11()
Error: invalid colortype passed to X11 driver

3) Trying something like 

> options(X11colortype = "true")     
> x11()
> x<-seq(0,2*pi,len=100)
> plot(x,sin(x),ty="l")

works and draws a sine curve, but the tick marks are in a poor state: The
horizontal tick marks start at the left border of the graphics box, but
continue to the left crossing the legend. The vertical tick marks look
better, but apparently have infinite length and extend beyond the upper
border of the graphic box up to the borders of the X11 window.

4) The seq complains about a missing .Machine variable sometimes:

> x<-seq(0,2*pi,0.1)
Error: Object ".Machine" not found
> x<-seq(0,2*pi,len=100)

5) The fix command starts an editor, but leaves the original function
untouched afterwards... Commands like "myfunc<-vi(myfunc)" still work.

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 12:22:56 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 09 Apr 1999 13:22:56 +0200
Subject: a strange logical bug (PR#162)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Fri, 9 Apr 1999 11:37:42 +0200"
References: <199904090937.LAA01047@blueberry.kubism.ku.dk>
Message-ID: <x2btgy3unj.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> On RH 5.2
> 
>        The isnan() function returns a non-zero value if value  is
>        "not-a-number" (NaN), and 0 otherwise.
> 
> and that non-zero is not defined!

Uh-oh...

> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
> for do_isna (why?)

is.na(0/0) # Splus compat.

> So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
> solves this one for me.

But...(see above)

A better fix is 

#define ISNAN(x) (isnan(x)!=0)

Next problem: Messing with Arith.h and make'ing doesn't do anything
(dependency missing, obviously)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 12:23:01 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 13:23:01 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091123.NAA03290@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> On RH 5.2
> 
>        The isnan() function returns a non-zero value if value  is
>        "not-a-number" (NaN), and 0 otherwise.
> 
> and that non-zero is not defined!

Uh-oh...

> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
> for do_isna (why?)

is.na(0/0) # Splus compat.

> So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
> solves this one for me.

But...(see above)

A better fix is 

#define ISNAN(x) (isnan(x)!=0)

Next problem: Messing with Arith.h and make'ing doesn't do anything
(dependency missing, obviously)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Fri Apr  9 12:48:48 1999
From: N.J.Lee@statslab.cam.ac.uk (N.J.Lee@statslab.cam.ac.uk)
Date: Fri, 9 Apr 1999 13:48:48 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091148.NAA03668@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999 ripley@stats.ox.ac.uk wrote:

> > > as.numeric(is.na(c(NA,NA,1)))
> > [1] -1 -1  0
> > 
> > Seems to affect all numeric NA's:
> > 
> > > A)))
> > [1] -1
> > 
> > This is on RedHat 5.2 (As Jim, I suspect)
> 
> On RH 5.2

I don't seem to have this problem on Debian 2.2 (with glibc2.1):

> as.numeric(is.na(as.numeric(NA)))
[1] 1
> as.numeric(is.na(c(NA,NA,1)))
[1] 1 1 0


Nicholas



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>  Fri Apr  9 12:48:26 1999
From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk> (Nicholas Lee)
Date: Fri, 9 Apr 1999 12:48:26 +0100 (BST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904090937.LAA01047@blueberry.kubism.ku.dk>
Message-ID: <Pine.HPP.3.96.990409124522.22711B-100000@tiger.statslab.cam.ac.uk>


On Fri, 9 Apr 1999 ripley@stats.ox.ac.uk wrote:

> > > as.numeric(is.na(c(NA,NA,1)))
> > [1] -1 -1  0
> > 
> > Seems to affect all numeric NA's:
> > 
> > > A)))
> > [1] -1
> > 
> > This is on RedHat 5.2 (As Jim, I suspect)
> 
> On RH 5.2

I don't seem to have this problem on Debian 2.2 (with glibc2.1):

> as.numeric(is.na(as.numeric(NA)))
[1] 1
> as.numeric(is.na(c(NA,NA,1)))
[1] 1 1 0


Nicholas


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.ethz.ch  Fri Apr  9 13:52:01 1999
From: maechler@stat.ethz.ch (maechler@stat.ethz.ch)
Date: Fri, 9 Apr 1999 14:52:01 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091252.OAA03730@blueberry.kubism.ku.dk>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> ripley@stats.ox.ac.uk writes:
    >> On RH 5.2
    >> 
    >> The isnan() function returns a non-zero value if value is
    >> "not-a-number" (NaN), and 0 otherwise.
    >> 
    >> and that non-zero is not defined!

    PD> Uh-oh...

    >> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
    >> for do_isna (why?)

    PD> is.na(0/0) # Splus compat.

    >> So ISNAN needs to be redefined on Linux at least.  Using ISNA not
    >> ISNAN solves this one for me.

    PD> But...(see above)

    PD> A better fix is

    PD> #define ISNAN(x) (isnan(x)!=0)

oh dear;  and we had thought we would clean up the ISNAN definition and
do_isna[n] functions....
Are we all sure that this is *IT* for now...

Could we improve on the tests in  configure.in	to make sure beforehand
that  ISNAN will work?


    PD> Next problem: Messing with Arith.h and make'ing doesn't do anything
    PD> (dependency missing, obviously)

I've added ``a few of these'' to src/appl/Makefile.in and src/nmath/Makefile.in

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Fri Apr  9 15:45:42 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Fri, 9 Apr 1999 16:45:42 +0200 (DFT)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904091252.OAA03730@blueberry.kubism.ku.dk>
Message-ID: <Pine.A41.4.02.9904091639590.15648-100000@cauchy.mathematik.uni-essen.de>

On Fri, 9 Apr 1999 maechler@stat.math.ethz.ch wrote:

> oh dear;  and we had thought we would clean up the ISNAN definition and
> do_isna[n] functions....

I'm not sure if this fits into the discussion on do_isna, but can anybody
explain to me the following output from R-0.64.0 under AIX:

> NA
[1] NA
> NaN
[1]NaNQ
> par()$tck 
[1]NaNS

What's that? 

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri Apr  9 18:02:01 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 9 Apr 1999 19:02:01 +0200
Subject: Compilation problems with R-0.64.0 [AIX]
In-Reply-To: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>
 (message from Arne Kovac on Fri, 9 Apr 1999 12:52:05 +0200 (DFT))
References: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>
Message-ID: <199904091702.TAA13911@sophie.ethz.ch>

Arne,
thanks a lot for reporting the problems you had with R on AIX.

>> 1) The static variable class in "devX11.c" conflicts with a function
>> class() defined in math.h (using egcs-2.93.11). Therefore compilation
>> stops with an error message.

I've just changed this (using "Vclass") 
for "R-release-patch" aka 0.64.1(prerelease).

>> 2) x11()  gives a  big problem...

Can others confirm this problem?

[no time for more now ..

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum SOL G1;	Sonneggstr.33
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1086			<><
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 18:02:20 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 13:02:20 -0400
Subject: a strange logical bug (PR#162)
References: <199904091252.OAA03730@blueberry.kubism.ku.dk>
Message-ID: <370E329C.54D97C82@bank-banque-canada.ca>

I believe I am being bitten by the isna bug and will happily wait until it is
fixed before I check further. However, one message seemed to suggest this may
only be a problem in Linux, and I am running Solaris. If more detailed problem
reports on this would be useful will someone please let me know.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 18:16:35 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 9 Apr 1999 18:16:35 +0100 (BST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <370E329C.54D97C82@bank-banque-canada.ca>
Message-ID: <Pine.GSO.4.05.9904091814040.26950-100000@auk.stats>

On Fri, 9 Apr 1999, Paul Gilbert wrote:

> I believe I am being bitten by the isna bug and will happily wait until it is
> fixed before I check further. However, one message seemed to suggest this may
> only be a problem in Linux, and I am running Solaris. If more detailed problem
> reports on this would be useful will someone please let me know.

It is not a problem on Solaris, just on some Linux dialects where isnan
is no fully defined.

The fix is in R-release now: please check a snapshot after tomorrow, then
let us know about your isna bug!


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 19:37:37 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 14:37:37 -0400
Subject: eigen
Message-ID: <370E48F1.EBA98B18@bank-banque-canada.ca>

Eigen seems to be giving different results in 0.64 :

eigen(matrix(
 c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
   0.01262442, -0.1141633,  0.04989433, 0.006112607,
   0.04781087,  0.4177869, -0.15569656, 0.074242237,
   0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values

R:
 [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619

S:
[1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293

I am fairly sure that S and R previously gave the same results.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 20:09:13 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 15:09:13 -0400
Subject: dreaming?
Message-ID: <370E5058.AA54DE60@bank-banque-canada.ca>

I have a fairly comprehensive set of tests for my code, however, when my tests
report an error it still takes a fair amount of time to track down the problem.
It occured to me that it would be very nice to be able to run a supervisor
routine that could request an object be returned by an R calculation on a
different machine (different platform and/or different R version) and compare
the results. Has anyone considered this? It would certainly speed up the testing
cycle. Perhaps I could even trace back and narrow down the problem
automatically.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 01:28:03 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 02:28:03 +0200
Subject: eigen
In-Reply-To: Paul Gilbert's message of "Fri, 09 Apr 1999 14:37:37 -0400"
References: <370E48F1.EBA98B18@bank-banque-canada.ca>
Message-ID: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>

Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:

> Eigen seems to be giving different results in 0.64 :
> 
> eigen(matrix(
>  c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
>    0.01262442, -0.1141633,  0.04989433, 0.006112607,
>    0.04781087,  0.4177869, -0.15569656, 0.074242237,
>    0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values
> 
> R:
>  [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619
> 
> S:
> [1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293
> 
> I am fairly sure that S and R previously gave the same results.

Indeedy. At least the pre 63.3 binary I had lying about did give the S
results. The eigenvectors are also bogus as far as I can tell.

The weird thing is that eigen() goes via .Fortran to eigen.c
(which was f2c'ed at some point) and neither eigen.c or eigen.R has
been changed in 1999 according to the cvs logs. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 03:19:09 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 14:19:09 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz>


On 10 Apr 1999, Peter Dalgaard BSA wrote:

> Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:
> 
> > Eigen seems to be giving different results in 0.64 :
> > 
> > eigen(matrix(
> >  c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
> >    0.01262442, -0.1141633,  0.04989433, 0.006112607,
> >    0.04781087,  0.4177869, -0.15569656, 0.074242237,
> >    0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values
> > 
> > R:
> >  [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619
> > 
> > S:
> > [1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293
> > 
> > I am fairly sure that S and R previously gave the same results.
> 
> Indeedy. At least the pre 63.3 binary I had lying about did give the S
> results. The eigenvectors are also bogus as far as I can tell.
> 
> The weird thing is that eigen() goes via .Fortran to eigen.c
> (which was f2c'ed at some point) and neither eigen.c or eigen.R has
> been changed in 1999 according to the cvs logs. 
> 

Weirder still.  I get the problem results under Solaris with a clean
checkout of 0.65 but not under FreeBSD with a clean 0.65.
Solaris is using egcs and FreeBSD is using gcc 2.7.2.1.

I am beginning to suspect a compiler / library bug.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 04:00:55 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 09 Apr 1999 22:00:55 -0500
Subject: eigen
In-Reply-To: Ross Ihaka's message of "Sat, 10 Apr 1999 14:19:09 +1200 (NZST)"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <6rhfqp6uxk.fsf@verdi.stat.wisc.edu>

I also get the problem results under 0.64.0 compiled with egcs on
Linux/Intel - both RedHat and Debian systems.  When I checked the
RedHat system under 0.63.4 (not sure of the compiler) I got the other
set of results.  That pattern was repeated on a SPARC Solaris 2.6
system.  0.64.0 compiled with egcs gave the incorrect results and
0.63.4 compiled with an unknown compiler gave the correct results.
Same again on an Intel/Solaris 2.6 system.

I think the compiler that I used for the 0.63.4 builds was egcs-1.0.3
but I'm not sure.  I'll go back and re-build 0.64.0 with egcs-1.0.3
instead of egcs-1.1.1 and see what happens.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 04:37:04 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 09 Apr 1999 22:37:04 -0500
Subject: eigen
In-Reply-To: Douglas Bates's message of "09 Apr 1999 22:00:55 -0500"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu>
Message-ID: <6raewh6t9b.fsf@verdi.stat.wisc.edu>

>>>>> "DMB" == Douglas Bates <bates@stat.wisc.edu> writes:

  DMB> I think the compiler that I used for the 0.63.4 builds was
  DMB> egcs-1.0.3 but I'm not sure.  I'll go back and re-build 0.64.0
  DMB> with egcs-1.0.3 instead of egcs-1.1.1 and see what happens.

Changing to egcs-1.0.3 for a re-build of 0.64.0 didn't clear up the
problem.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 05:41:22 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 16:41:22 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990410160720.5666B-100000@g.ihaka.slip.auckland.ac.nz>


I don't know what the problem was, but I think I have a fix.  I have
replaced src/appl/eigen.c by the original set of fortran eispack routines. 
This seems to fix the problem on my Solaris box. 

I suspect that this bug may have been there for a while.

I am still puzzled that it was not tripped on my FreeBSD box.  It must be
the advanced compiler technology; it silently finds and fixes the bugs in
your code as you compile it :-).

Anyway could someone check that this change does the job on Linux etc.
(I've committed in both branches).

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sat Apr 10 06:21:47 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sat, 10 Apr 1999 06:21:47 +0100 (BST)
Subject: eigen
In-Reply-To: <Pine.BSF.3.96.990410160720.5666B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>

On Sat, 10 Apr 1999, Ross Ihaka wrote:

> I don't know what the problem was, but I think I have a fix.  I have
> replaced src/appl/eigen.c by the original set of fortran eispack routines. 
> This seems to fix the problem on my Solaris box. 

The bug is that Fortran.h had <math.h>, now has "Mathlib.h", and soemthing
in there is trampling over error.c

> I suspect that this bug may have been there for a while.

No, it _is_ a 0.64 change, 0.63.3 is unaffected.

> 
> I am still puzzled that it was not tripped on my FreeBSD box.  It must be
> the advanced compiler technology; it silently finds and fixes the bugs in
> your code as you compile it :-).

Look to header files in such circumstances. Mathlib.h includes

#include <errno.h>
#include <limits.h>
#include <float.h>
#include <math.h>
#include <stdlib.h>

and on Solaris the culprit is the last one of these.

Guess what: there a load of abs/fabs errors in eigen.c.  On some
systems abs is a macro, on others a function and on others it
depends on the optimization level.

> Anyway could someone check that this change does the job on Linux etc.
> (I've committed in both branches).

(Do you want to revert?)

What worries me is what else Mathlib.h might be trampling over.
I think we need to check this over.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 08:14:39 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 19:14:39 +1200 (NZST)
Subject: eigen
In-Reply-To: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990410190641.3295A-100000@g.ihaka.slip.auckland.ac.nz>


On Sat, 10 Apr 1999, Prof Brian D Ripley wrote:

> (Do you want to revert?)

I think eigen.c dates from days before we tried to be pure C for
portability purposes.  Provided we can live with the namespace pollution
which comes with Fortran (all function names being global), I'd actually
prefer to live with the original code. We've reverted the Linpack and
optimizer code already.

(Yeah, Yeah so why did I do the nmath thing?  I thought it might be more
generally useful than just for R ...) 
 
> What worries me is what else Mathlib.h might be trampling over.
> I think we need to check this over.

Definitely!

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 11:31:30 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 12:31:30 +0200
Subject: eigen
In-Reply-To: Douglas Bates's message of "09 Apr 1999 22:37:04 -0500"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu> <6raewh6t9b.fsf@verdi.stat.wisc.edu>
Message-ID: <x2g168dawt.fsf@blueberry.kubism.ku.dk>

Douglas Bates <bates@stat.wisc.edu> writes:

> >>>>> "DMB" == Douglas Bates <bates@stat.wisc.edu> writes:
> 
>   DMB> I think the compiler that I used for the 0.63.4 builds was
>   DMB> egcs-1.0.3 but I'm not sure.  I'll go back and re-build 0.64.0
>   DMB> with egcs-1.0.3 instead of egcs-1.1.1 and see what happens.
> 
> Changing to egcs-1.0.3 for a re-build of 0.64.0 didn't clear up the
> problem.

I also get the same result with different compilers (gcc 2.7.2.3 and
egcs-2.91.57) Note BTW that it *fails* the
consistency test from the example file

> m %*% V - V %*% diag(lam)
              [,1]          [,2]          [,3]          [,4]
[1,]  2.775558e-17  1.387779e-17  2.775558e-17 -3.382711e-17
[2,]  4.117019e-01  2.872937e-01 -2.687366e-01  7.624831e-02
[3,]  4.615645e-02  3.220889e-02 -3.012842e-02  8.548301e-03
[4,] -2.688891e-01 -1.876361e-01  1.755162e-01 -4.979899e-02

- whereas the older version did

>  m %*% V - V %*% diag(lam)
              [,1]          [,2]          [,3]          [,4]
[1,] -8.326673e-17  0.000000e+00  0.000000e+00 -2.622414e-18
[2,] -5.551115e-17  1.110223e-16  0.000000e+00 -1.368263e-16
[3,]  3.469447e-18 -2.775558e-17 -5.551115e-17  3.957338e-17
[4,] -5.551115e-17 -1.110223e-16  5.028530e-16  1.502704e-16

[0.63.4 in progress (March 9, 1999) on my office machine]

The test on symmetric matrices does not fail, though. (Make check
would have caught this, save for the m<-m+t(m) line...)

Most likely, we're being bitten  either by a code 'cleanup' or some
sort of change in the linked libraries.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 11:49:59 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 12:49:59 +0200
Subject: eigen
In-Reply-To: Peter Dalgaard BSA's message of "10 Apr 1999 12:31:30 +0200"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu> <6raewh6t9b.fsf@verdi.stat.wisc.edu> <x2g168dawt.fsf@blueberry.kubism.ku.dk>
Message-ID: <x2emlsda20.fsf@blueberry.kubism.ku.dk>

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> 
> The test on symmetric matrices does not fail, though. (Make check
> would have caught this, save for the m<-m+t(m) line...)
> 
> Most likely, we're being bitten  either by a code 'cleanup' or some
> sort of change in the linked libraries.
> 

Oops. Didn't see Brian+Ross's exchange before sending. Never mind.
Martin may still want to fix the example, though?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From mtim@farm.ecs.umass.edu  Sat Apr 10 18:35:45 1999
From: mtim@farm.ecs.umass.edu (mtim@farm.ecs.umass.edu)
Date: Sat, 10 Apr 1999 19:35:45 +0200
Subject: IRIX compile (PR#163)
Message-ID: <199904101735.TAA04499@blueberry.kubism.ku.dk>

Full_Name: Tim Middelkoop
Version: 0.64.0
OS: IRIX 6.3 on O2
Submission from: (NULL) (128.119.88.192)


Various IRIX complile  issues

src/nmath/pnt.c
IRIX cc does not like double negatives

Makeconf,config.site,etc/Makeconf
f77 pic hack, should change Makeconf.in or other...
change -PIC with -KPIC

enjoy, tim...
===

diff -ru orig/R-0.64.0/src/nmath/pnt.c R-0.64.0/src/nmath/pnt.c
--- orig/R-0.64.0/src/nmath/pnt.c       Wed Apr  7 02:45:48 1999
+++ R-0.64.0/src/nmath/pnt.c    Sat Apr 10 13:02:45 1999
@@ -80,7 +80,7 @@
        del = -del;
     }
 
-    if (df > 4e5 || del*del > 2*M_LN2*(-DBL_MIN_EXP)) {
+    if (df > 4e5 || del*del > 2*M_LN2*(-(DBL_MIN_EXP))) {
        /*-- 2nd part: if del > 37.62, then p=0 below
          FIXME: test should depend on `df', `tt' AND `del' ! */
        /* Approx. from  Abramowitz & Stegun 26.7.10 (p.949) */










-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Sat Apr 10 18:41:02 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sat, 10 Apr 1999 19:41:02 +0200 (CEST)
Subject: IRIX compile (PR#163)
In-Reply-To: <199904101735.TAA04499@blueberry.kubism.ku.dk>
References: <199904101735.TAA04499@blueberry.kubism.ku.dk>
Message-ID: <14095.36142.306970.30451@aragorn.ci.tuwien.ac.at>

>>>>> mtim  writes:

> Full_Name: Tim Middelkoop
> Version: 0.64.0
> OS: IRIX 6.3 on O2
> Submission from: (NULL) (128.119.88.192)


> Various IRIX complile  issues

> src/nmath/pnt.c
> IRIX cc does not like double negatives

> Makeconf,config.site,etc/Makeconf

> f77 pic hack, should change Makeconf.in or other...
> change -PIC with -KPIC

Sure about this?  Which version of f77 is this, the native one?

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Sat Apr 10 19:12:28 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sat, 10 Apr 1999 20:12:28 +0200 (CEST)
Subject: IRIX compile (PR#163)
In-Reply-To: <199904101735.TAA04499@blueberry.kubism.ku.dk>
References: <199904101735.TAA04499@blueberry.kubism.ku.dk>
Message-ID: <14095.38028.187255.911966@aragorn.ci.tuwien.ac.at>

>>>>> mtim  writes:

> Full_Name: Tim Middelkoop
> Version: 0.64.0
> OS: IRIX 6.3 on O2
> Submission from: (NULL) (128.119.88.192)


> Various IRIX complile  issues

> src/nmath/pnt.c
> IRIX cc does not like double negatives

> Makeconf,config.site,etc/Makeconf
> f77 pic hack, should change Makeconf.in or other...
> change -PIC with -KPIC

> enjoy, tim...
> ===

> diff -ru orig/R-0.64.0/src/nmath/pnt.c R-0.64.0/src/nmath/pnt.c
> --- orig/R-0.64.0/src/nmath/pnt.c       Wed Apr  7 02:45:48 1999
> +++ R-0.64.0/src/nmath/pnt.c    Sat Apr 10 13:02:45 1999
> @@ -80,7 +80,7 @@
>         del = -del;
>      }
 
> -    if (df > 4e5 || del*del > 2*M_LN2*(-DBL_MIN_EXP)) {
> +    if (df > 4e5 || del*del > 2*M_LN2*(-(DBL_MIN_EXP))) {
>         /*-- 2nd part: if del > 37.62, then p=0 below
>           FIXME: test should depend on `df', `tt' AND `del' ! */
>         /* Approx. from  Abramowitz & Stegun 26.7.10 (p.949) */

Both fixed in 0.64.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 21:35:38 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 11 Apr 1999 08:35:38 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2emlsda20.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990411082533.326A-100000@g.ihaka.slip.auckland.ac.nz>


The problem in eigen.c seems to be as follows.

1) f2c defines a macro abs() which does the standard abs() which
   works for all numeric types. This macro was inserted in Fortran.h.

2) recently it was recognised that there is an abs() in stdlib and
   the macro in Fortran.h was commented out.

3) unfortunately the abs() in stdlib is an integer valued function
   of an integer argument.

4) end of world.

I think the lesson is that partial translations of fortran into C and the
use of macros to get the rest of the way is VERY dangerous. 

Sometimes it is unavoidable, because we want to do some bit-fiddling or
platform dependent manipulation.  The lesson I think is to keep the use of
externally defined macros in the translations to a minimum. 

I am going to go through appl/ to look carefully at all the translations
for problems of this kind.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 22:11:32 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 11 Apr 1999 09:11:32 +1200 (NZST)
Subject: Fortran vs C
In-Reply-To: <Pine.BSF.3.96.990410190641.3295A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.BSF.3.96.990411090524.359A-100000@g.ihaka.slip.auckland.ac.nz>


To follow up the "eigen" issue.  What should our position on translating
Fortran into C be?  Should we leave as much code as possible in Fortran or
should we move it to C as much as possible? 

I can see arguments both ways.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 23:00:07 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 10 Apr 1999 17:00:07 -0500
Subject: Fortran vs C
In-Reply-To: Ross Ihaka's message of "Sun, 11 Apr 1999 09:11:32 +1200 (NZST)"
References: <Pine.BSF.3.96.990411090524.359A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>

>>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

  Ross> To follow up the "eigen" issue.  What should our position on
  Ross> translating Fortran into C be?  Should we leave as much code
  Ross> as possible in Fortran or should we move it to C as much as
  Ross> possible?

I can think of three different sets of circumstances:
 a) creating new code: This one is obvious, just say "no" to Fortran.
 b) enhancing existing code: For something small do the automatic
      translation to C with f2c then modify the C sources and regard
      those as the definitive version.  For a big Fortran routine, try
      to write a C wrapper around it and make modifications in the
      wrapper. 
 c) using established code without modification (e.g. Eispack, Linpack):
      Regard the Fortran sources as the definitive version and don't
      translate.

Now that g77 is available and reasonably stable, a lot of the
motivation for using f2c is gone.  There are still the messy linkage
issues when calling Fortran from C but most of those are now resolved
by the configure script.  Passing character strings, etc. will
continue to be problematic but most of the legacy Fortran code we
would use will be strictly numerical routines with, we hope,
comparatively simple calling sequences.  (Lapack is an exception in
that it uses strings to declare options but we aren't using Lapack.)

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 23:05:35 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Sat, 10 Apr 1999 17:05:35 -0500 (CDT)
Subject: R/S compatibility in passing a formula
Message-ID: <m10W5sd-0000X4C@verdi.stat.wisc.edu>

In S3 if you are passing an evaluated formula to another function that
will store it and use it in printing (such as a model-fitting function), you
usually want to unclass the formula.  Otherwise, the formula that gets
stored looks very ugly when printed.  A trick to do the unclassing is to pass
 form = c( myFormula )
In R this has the effect of making form a list rather than a call.  It
seems that passing
 form = as.vector( myFormula )
will work in both dialects.  Anyone else have experience with this?
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr 11 01:16:31 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 11 Apr 1999 02:16:31 +0200
Subject: R/S compatibility in passing a formula
In-Reply-To: Douglas Bates's message of "Sat, 10 Apr 1999 17:05:35 -0500 (CDT)"
References: <m10W5sd-0000X4C@verdi.stat.wisc.edu>
Message-ID: <x267743tb4.fsf@blueberry.kubism.ku.dk>

Douglas Bates <bates@stat.wisc.edu> writes:

> In S3 if you are passing an evaluated formula to another function that
> will store it and use it in printing (such as a model-fitting function), you
> usually want to unclass the formula.  Otherwise, the formula that gets
> stored looks very ugly when printed.  A trick to do the unclassing is to pass
>  form = c( myFormula )
> In R this has the effect of making form a list rather than a call.  It
> seems that passing
>  form = as.vector( myFormula )
> will work in both dialects.  Anyone else have experience with this?

Apparently

(a) R does not print the class on a formula (because print.formula
unclasses it)
(b) as.vector does not unclass in R but does in S3. Try
class(as.vector(form)) 

So the result of as.vector *looks* alike, but isn't. Smells like
trouble... 

Whatever is wrong with using unclass() for unclassing anyway??

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 08:30:40 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 11 Apr 1999 08:30:40 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>

On 10 Apr 1999, Douglas Bates wrote:

> >>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
> 
>   Ross> To follow up the "eigen" issue.  What should our position on
>   Ross> translating Fortran into C be?  Should we leave as much code
>   Ross> as possible in Fortran or should we move it to C as much as
>   Ross> possible?
> 
> I can think of three different sets of circumstances:
>  a) creating new code: This one is obvious, just say "no" to Fortran.
>  b) enhancing existing code: For something small do the automatic
>       translation to C with f2c then modify the C sources and regard
>       those as the definitive version.  For a big Fortran routine, try
>       to write a C wrapper around it and make modifications in the
>       wrapper. 
>  c) using established code without modification (e.g. Eispack, Linpack):
>       Regard the Fortran sources as the definitive version and don't
>       translate.
> 
> Now that g77 is available and reasonably stable, a lot of the
> motivation for using f2c is gone.  There are still the messy linkage
> issues when calling Fortran from C but most of those are now resolved
> by the configure script.  Passing character strings, etc. will
> continue to be problematic but most of the legacy Fortran code we
> would use will be strictly numerical routines with, we hope,
> comparatively simple calling sequences.  (Lapack is an exception in
> that it uses strings to declare options but we aren't using Lapack.)

[A long reply: I am much-bitten here!]

1) In my experience there are problems with error reporting via strings in
such Fortran code, as I found in loess (and found more easily in less
complicated packages). I wrote a two-step interface (in Fortran find the
string length, pass that and string back to C), and perhaps we should
set up warning and error subroutines to be called from Fortran to
standardize this that package writers/porters could use.


2) My motivation would be to use Fortran wherever it already exists. In the
world of scientific computing Fortran has been king and the effort in
compiler development has gone into efficient Fortran compilers with godd
optimizers. So on a Sun or DEC Alpha (and probably SGI) the original
Fortran used to run appreciably faster than the C translation (using the
native compilers), and although the gap has closed I think it is still
quite noticeable.  In my experience R can't afford that price. This may not
be an issue on Linux/Windows, but I expect is on Sun/DEC/SGI/HP.

BTW, I think that means that Doug's `just say "no" to Fortran' is not
obviously true if performance matters. This is likely to especially true if
single-precision calculations will do the job. (And, yes, I know about
Intel hardware but I don't see the need to slow a Sparc or Alpha FP unit
down to Intel speeds, especially older ones. I also know how to make C do
efficient float calculations using float libraries on Sparc, but that sort
of thing is a nightmare to configure portably, and also to link into S or 
R. It happens for free in Fortran.)


3) The problem is finding the external calls from Fortran code. In the base
code this should be not problem now we use the Fortran front-end to link.  
I have problems with quite a few packages that use Fortran, and have
translated some code myself just to avoid those. (It was a big problem in
the first release of MASS software for S-PLUS, and we removed all the 
Fortran to save ourselves the hastle of `it won't work on my XYZ system'
reports. We never made the Fortran work on HPs, whose Fortran name space
clashes with the C one, and it seemed that S had already grabbed some
critical symbols as C ones.)

I think in R we can do better than at present, if only I knew
exactly how. One idea is to have (effectively) a `hints' file that
configure uses to add a base set of libraries to FLIBS, but on Solaris
at least, using the Fortran command (f77 or g77) to link a dynamic library
does the job.  For linking with ld the base FLIBS would need to be

-lF77 -lM77 -lV77 -lsunmath -lm

_if_ f77 is used.  How viable is `use FC to link' on other platforms?

And to come back to beating a drum, if the dlopen option were RTLD_NOW
not RTLD_LAZY, these things would be easier to check. People keep sending
packages to CRAN that are incomplete (mclust seems to be now) and with
RTLD_NOW this is _much_ more likely to be noticed. Can we re-consider?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 08:39:59 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 11 Apr 1999 08:39:59 +0100 (BST)
Subject: R/S compatibility in passing a formula
In-Reply-To: <x267743tb4.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904110835440.3678-100000@auk.stats>

On 11 Apr 1999, Peter Dalgaard BSA wrote:

> Douglas Bates <bates@stat.wisc.edu> writes:
> 
> > In S3 if you are passing an evaluated formula to another function that
> > will store it and use it in printing (such as a model-fitting function), you
> > usually want to unclass the formula.  Otherwise, the formula that gets
> > stored looks very ugly when printed.  A trick to do the unclassing is to pass
> >  form = c( myFormula )
> > In R this has the effect of making form a list rather than a call.  It
> > seems that passing
> >  form = as.vector( myFormula )
> > will work in both dialects.  Anyone else have experience with this?
> 
> Apparently
> 
> (a) R does not print the class on a formula (because print.formula
> unclasses it)
> (b) as.vector does not unclass in R but does in S3. Try
> class(as.vector(form)) 
> 
> So the result of as.vector *looks* alike, but isn't. Smells like
> trouble... 
> 
> Whatever is wrong with using unclass() for unclassing anyway??

Because it is oldUnclass in recent S's, and having to use code translators
for S3/R/S-PLUS 5.x is a pain!   Nevertheless, that is what I do: write
oldUnclass() and translate.  (The reverse does not work: in S-PLUS 5 one
sometimes needs unclass()).

(I am pickily using S-PLUS 5 not S4: there is no public version of S4, but
S-PLUS 5 is quite different from S4 as documented in Chambers, 1998.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sun Apr 11 21:15:35 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 12 Apr 1999 08:15:35 +1200 (NZST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990412081348.339A-100000@g.ihaka.slip.auckland.ac.nz>


On Sun, 11 Apr 1999, Prof Brian D Ripley wrote:

> And to come back to beating a drum, if the dlopen option were RTLD_NOW
> not RTLD_LAZY, these things would be easier to check. People keep sending
> packages to CRAN that are incomplete (mclust seems to be now) and with
> RTLD_NOW this is _much_ more likely to be noticed. Can we re-consider?

I've changed in the devel (non) branch.  Let's see if it bites anyone 
(HPUX?). 

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 22:53:48 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Sun, 11 Apr 1999 23:53:48 +0200
Subject: [R] repeated measurements libraries v0.4 (PR#164)
Message-ID: <199904112153.XAA05566@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999, Jim Lindsey wrote:

> I have just uploaded version 0.4 of my libraries to the CRAN site.
> Hopefully, they will shortly become available.

Jim,

You have shipped growth with symbolic links to rmutil, and that is not even
listed as a Depends: in the DESCRIPTION. Symbolic links do not even exist
on some file systems!  (What happens with a VFAT file system on Linux,
or an SMB-mounted one?)

Could you please re-package this with the missing files? And it would be
very helpful to have correct dependencies listed. For the Windows port I
have put up today I copied the files across from rmutil.

As you know, my preference would be to have your packages in a single
bundle. To get all the cross-links in the man page one has to install your
packages in a certain order, and it would be helpful to know what it is! I
_think_ it is reverse-alphabetical, but am not sure even if it can be done
on one pass now (it used not to be able to).  This sort of thing would be
much easier to get right with a single package.

Brian

[Is this the sort of bug you think I should be sending to r-help? I am
sending it to the R-bugs database, in any case, so please tell R-bugs when
it is fixed.]

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:20:18 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:20:18 +0200 (CEST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
References: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>
 <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <14097.37026.863229.382113@pc87.maho.magnaeu.com>

>>>>> Prof Brian D Ripley writes:

> On 10 Apr 1999, Douglas Bates wrote:
>> >>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
>> 
Ross> To follow up the "eigen" issue.  What should our position on
Ross> translating Fortran into C be?  Should we leave as much code
Ross> as possible in Fortran or should we move it to C as much as
Ross> possible?
>> 
>> I can think of three different sets of circumstances:
>> a) creating new code: This one is obvious, just say "no" to Fortran.
>> b) enhancing existing code: For something small do the automatic
>> translation to C with f2c then modify the C sources and regard
>> those as the definitive version.  For a big Fortran routine, try
>> to write a C wrapper around it and make modifications in the
>> wrapper. 
>> c) using established code without modification (e.g. Eispack, Linpack):
>> Regard the Fortran sources as the definitive version and don't
>> translate.
>> 
>> Now that g77 is available and reasonably stable, a lot of the
>> motivation for using f2c is gone.  There are still the messy linkage
>> issues when calling Fortran from C but most of those are now resolved
>> by the configure script.  Passing character strings, etc. will
>> continue to be problematic but most of the legacy Fortran code we
>> would use will be strictly numerical routines with, we hope,
>> comparatively simple calling sequences.  (Lapack is an exception in
>> that it uses strings to declare options but we aren't using Lapack.)

> [A long reply: I am much-bitten here!]

> ...

> I think in R we can do better than at present, if only I knew exactly
> how. One idea is to have (effectively) a `hints' file that configure
> uses to add a base set of libraries to FLIBS, but on Solaris at least,
> using the Fortran command (f77 or g77) to link a dynamic library does
> the job.  For linking with ld the base FLIBS would need to be

> -lF77 -lM77 -lV77 -lsunmath -lm

> _if_ f77 is used.  How viable is `use FC to link' on other platforms?

Are you suggesting using the Fortran compiler as SHLIBLD?

Please help me understanding this a bit more.  The above `-lF77 ...'
would be the default FLIBS to use when compiling/linking Fortran?

Short term fix should be to use platform-specific overrides in basic
configure.  Another idea is to have configure scripts supported for add
ons.

(If I fully understood the problem, I think I could fix it ...)

=k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr 12 07:35:01 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Mon, 12 Apr 1999 07:35:01 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <14097.37026.863229.382113@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.05.9904120734010.9192-100000@auk.stats>

On Mon, 12 Apr 1999, Kurt Hornik wrote:

> >>>>> Prof Brian D Ripley writes:
> > I think in R we can do better than at present, if only I knew exactly
> > how. One idea is to have (effectively) a `hints' file that configure
> > uses to add a base set of libraries to FLIBS, but on Solaris at least,
> > using the Fortran command (f77 or g77) to link a dynamic library does
> > the job.  For linking with ld the base FLIBS would need to be
> 
> > -lF77 -lM77 -lV77 -lsunmath -lm
> 
> > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> 
> Are you suggesting using the Fortran compiler as SHLIBLD?

Yes, at least on platforms where this is known to be safe.

> Please help me understanding this a bit more.  The above `-lF77 ...'
> would be the default FLIBS to use when compiling/linking Fortran?

On Solaris.

> Short term fix should be to use platform-specific overrides in basic
> configure.  Another idea is to have configure scripts supported for add
> ons.
> 
> (If I fully understood the problem, I think I could fix it ...)

Yes!


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:56:11 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:56:11 +0200
Subject: add-on packages
Message-ID: <199904120656.IAA14380@pc87.maho.magnaeu.com>

Some further infos/thoughts/... on our add-on packages.

Here are the results of running a simple counting script on my system
(at home, not all available packages installed there):

Packages found:            59
  with INDEX               59
  with TITLE               59
  with DESCRIPTION         26
    with License info      21
  with data                25
    with data/00Index      11
    with data/index.doc     6

This is quite alarming (of course, the standard packages from the main
distribution currently do not have DESCRIPTION files)!  PLEASE update
your packages, the DESCRIPTION file is definitely needed!

(Also, some packages still have old-style .doc data documentation.)

Fritz and I are thinking about automating an add-on checking mechanism.
In addition to the above, info on which packages pass `R CMD check' etc
could be provided on a regular basis.

We are also thinking about automating the package build process (e.g.,
`R CMD build pkg').  An `INDEX' and a data index could be generated
automatically.  At build time, comparison of object usage as is and as
documented could be done.  Information on undocumented objects could be
provided.  `R CMD check' could be run.  And so on ...

Btw, re `INDEX': currently, if I document several objects in one Rd
file, I get only one INDEX entry (which is obtained from \title{}).
This is not satisfactory.  Maybe we should have something like
	\index{NAME}{TEXT}
???

I also want to propose adding a "Maintainer" field in DESCRIPTION.  In
the future we could use this info for both automatic checking and bug
reporting.

Another interesting fact is data duplication.  More than 10 data sets
show up in more than one package.  Maybe we should add these to the main
distribution then?

Finally (again?), please make sure that your packages do not mask system
features.

Thanks,
-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:56:11 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:56:11 +0200
Subject: PLATFORMS
Message-ID: <199904120656.IAA14375@pc87.maho.magnaeu.com>

Hmm ... no recent success stories on building 0.64?
Below is what we currently know of.

Thanks for feedback in advance,
-k

***********************************************************************
SUCCESSFUL BUILDS

R is known to configure, compile and run correctly on at least the
following platforms.  

0.63.3	i386	Linux Debian 2.1
		Linux Redhat 5.1, 5.2
		Linux SuSe 5.3, 6.0
		FreeBSD 2.2.5

	alpha	DEC OSF 4.0

	sparc	Linux RedHat 5.2
		Sun Solaris 2.6, 2.7

	ppc	Linux LinuxPPC 4

0.64.0	i386	Linux Debian 2.0

	sparc	Sun Solaris 2.5.1, 2.6

	hppa	HPUX 10.20

See below for more details and contact information.

If you have success on any others, please notify us by filling in the
template and the end of this file.  Make sure to mention any changes you
had to make so we can update this file and our installation procedures.

NOTE: a `successful' build is one that passes `make check'!

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC		egcs
FC		g77
MAKE		make

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC		gcc
FC		egcs-g77
MAKE		make

NAME		Göran Broström
EMAIL		gb@stat.umu.se
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.2
CC		gcc
FC		egcs-g77
MAKE		make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 5.3
CC		egcs-2.91.57
FC		GNU Fortran 0.5.24-19980804
MAKE		GNU Make version 3.76.1
NOTES		native SuSE 5.3 gcc/g77 do not work

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC		egcs-2.91.60
FC		GNU Fortran 0.5.24-19980804
MAKE		GNU Make version 3.76.1

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC		gcc
FC		egcs-g77
MAKE		make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        alpha-dec-osf4.0
SYSTEM          Digital Unix 4.0E
CC		DEC C V5.8-009 on Digital UNIX V4.0 (Rev. 1091)
FC		DIGITAL Fortran 77 V5.1 for DIGITAL UNIX
MAKE		GNU Make version 3.76.1

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		cc SC4.2
FC		f77 SC4.2
MAKE      	GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		egcs 1.1 gcc
FC		egcs 1.1 g77
MAKE		GNU make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME       	Göran Broström
EMAIL      	gb@stat.umu.se
VERSION    	0.63.3
PLATFORM   	sun-sparc-linux
SYSTEM     	Redhat 5.2
CC		gcc version egcs-2.90.29 980515 (egcs-1.0.3 release)
FC		egcs-g77
MAKE 		make

NAME       	Kurt Hornik
EMAIL      	Kurt.Hornik@ci.tuwien.ac.at
VERSION    	0.64.0(1999/04/03)
PLATFORM   	i586-unknown-linux
SYSTEM     	Debian 2.0
CC 		gcc 2.7.2.3
FC		egcs-2.90.29 980515 (egcs-1.0.3 release)
MAKE		GNU make 3.76.1

NAME       	Nicholas Lee
EMAIL      	njl25@cam.ac.uk
VERSION    	0.64.0 Unstable
PLATFORM   	i586-unknown-linux
SYSTEM     	Debian 2.2 Unstable
CC		egcs-1.1.2 gcc
FC		egcs-1.1.2 g77
MAKE		make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		Sun make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		cc SC4.2
FC		f77 SC4.2
MAKE		Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		egcs 1.1 gcc
FC		egcs 1.1 g77
MAKE		GNU make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.64
PLATFORM        hppa2.0
SYSTEM          hpux10.20
CC		egcs
FC		f2c
MAKE		GNU make

NAME		
EMAIL		
VERSION         
PLATFORM        
SYSTEM          
CC		
FC		
MAKE		
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon Apr 12 08:29:37 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 Apr 1999 09:29:37 +0200
Subject: eigen
In-Reply-To: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats> (message
 from Prof Brian D Ripley on Sat, 10 Apr 1999 06:21:47 +0100 (BST))
References: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>
Message-ID: <199904120729.JAA00508@sophie.ethz.ch>

>>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

    BDR> On Sat, 10 Apr 1999, Ross Ihaka wrote:

      >> I don't know what the problem was, but I think I have a fix.  I
      >> have replaced src/appl/eigen.c by the original set of fortran
      >> eispack routines.  This seems to fix the problem on my Solaris
      >> box.

    BDR> The bug is that Fortran.h had <math.h>, now has "Mathlib.h", and
    BDR> something in there is trampling over error.c

    >> I suspect that this bug may have been there for a while.

    BDR> No, it _is_ a 0.64 change, 0.63.3 is unaffected.

    >> 
    >> I am still puzzled that it was not tripped on my FreeBSD box.  It must be
    >> the advanced compiler technology; it silently finds and fixes the bugs in
    >> your code as you compile it :-).

    BDR> Look to header files in such circumstances. Mathlib.h includes

    BDR> #include <errno.h>
    BDR> #include <limits.h>
    BDR> #include <float.h>
    BDR> #include <math.h>
    BDR> #include <stdlib.h>

    BDR> and on Solaris the culprit is the last one of these.
(grrreat)

    BDR> Guess what: there a load of abs/fabs errors in eigen.c.  On some
    BDR> systems abs is a macro, on others a function and on others it
    BDR> depends on the optimization level.

We must use a Mathlib.h -- src/nmath/  version of this

    >> Anyway could someone check that this change does the job on Linux etc.
    >> (I've committed in both branches).

    BDR> (Do you want to revert?)

Yes! -- The eigen.c has been massaged etc to be quite a bit more readable
     than its Fortran counterpart..


    BDR> What worries me is what else Mathlib.h might be trampling over.
    BDR> I think we need to check this over.

certainly
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 10:09:29 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 10:09:29 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904120909.KAA28372@toucan.stats.ox.ac.uk>

Martin M has suggested I widen this discussion to R-devel, and 

> I agree that we should increase them,
> but I'm not sure at all about the amount.
> 
> The default could even depend on the architecture (via "./configure")..

Views, please.

------------- Begin Forwarded Message -------------

Is is not time we increased the defaults a bit? As the base gets bigger
I hit 200k cons cells rather frequently. And 2Mb of heap seems low
compared to 3Mb of cons cells and 1.8Mb for the R binary.

How little memory do people have these data?  Except possibly on Windows
and old teaching labs I would have thought using 15Mb default for R
was very reasonable, which is about

--vsize 6Mb --nsize 300k

On Solaris that gives:

  PID USERNAME THR PRI NICE  SIZE   RES STATE   TIME    CPU COMMAND
 9308 ripley     1 -25    0   15M 8360K sleep   0:02  4.35% R.binary

as against the default

  PID USERNAME THR PRI NICE  SIZE   RES STATE   TIME    CPU COMMAND
 9309 ripley     1 -25    0 9664K 6416K sleep   0:02  4.66% R.binary

and that extra user memory makes a lot of difference.


------------- End Forwarded Message -------------


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From albrecht.gebhardt@uni-klu.ac.at  Mon Apr 12 10:30:20 1999
From: albrecht.gebhardt@uni-klu.ac.at (Albrecht Gebhardt)
Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <Pine.OSF.4.05.9904121125330.19966-100000@zidsrv.sci.uni-klu.ac.at>

On Sun, 11 Apr 1999, Prof Brian D Ripley wrote:

>
> ... some lines deleted ...
>
> 3) The problem is finding the external calls from Fortran code. In the base
> code this should be not problem now we use the Fortran front-end to link.  
> I have problems with quite a few packages that use Fortran, and have
> translated some code myself just to avoid those. (It was a big problem in
> the first release of MASS software for S-PLUS, and we removed all the 
> Fortran to save ourselves the hastle of `it won't work on my XYZ system'
> reports. We never made the Fortran work on HPs, whose Fortran name space
> clashes with the C one, and it seemed that S had already grabbed some
> critical symbols as C ones.)
> 
> I think in R we can do better than at present, if only I knew
> exactly how. One idea is to have (effectively) a `hints' file that
> configure uses to add a base set of libraries to FLIBS, but on Solaris
> at least, using the Fortran command (f77 or g77) to link a dynamic library
> does the job.  For linking with ld the base FLIBS would need to be
> 
> -lF77 -lM77 -lV77 -lsunmath -lm
> 
> _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> 

I'm not sure if it does matter here, but the only way to build R on my
Alphas currently is using Fortran as LDCMD:

in config.site:
LDCMD="f77 -g -nofor_main -fpe3 "

SHLIBLD is "ld -shared -expect_unresolved '*'".



Albrecht

-------------------------------------------------------------------------------
Albrecht Gebhardt                   email   : albrecht.gebhardt@uni-klu.ac.at
Institut fuer Mathematik            Tel.    : (++43 463) 2700/837
Universitaet Klagenfurt             Fax     : (++43 463) 2700/834
Villacher Str. 161
A-9020 Klagenfurt, Austria
-------------------------------------------------------------------------------


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 10:45:07 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 10:45:07 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
Message-ID: <199904120945.KAA28971@toucan.stats.ox.ac.uk>


> Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
> From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>
> > I think in R we can do better than at present, if only I knew
> > exactly how. One idea is to have (effectively) a `hints' file that
> > configure uses to add a base set of libraries to FLIBS, but on Solaris
> > at least, using the Fortran command (f77 or g77) to link a dynamic library
> > does the job.  For linking with ld the base FLIBS would need to be
> > 
> > -lF77 -lM77 -lV77 -lsunmath -lm
> > 
> > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> > 
> 
> I'm not sure if it does matter here, but the only way to build R on my
> Alphas currently is using Fortran as LDCMD:
> 
> in config.site:
> LDCMD="f77 "
> 
> SHLIBLD is "ld -shared -expect_unresolved '*'".

I would have expected

LDCMD=f77
LDFLAGS="-g -nofor_main -fpe3"
SHLIBLD=ld
SHLIBLDFLAGS="-shared -expect_unresolved '*'"

as the way to encode that.  Now my question amounts to

Does SHLIBLD=f77 work with those SHLIBLDFLAGS?
If not, can SHLIBLDFLAGS be modified to make it work?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From osman.buyukisik@ae.ge.com  Mon Apr 12 13:39:00 1999
From: osman.buyukisik@ae.ge.com (U-E59264-Osman F Buyukisik)
Date: Mon, 12 Apr 1999 08:39:00 -0400 (EDT)
Subject: R-0.65-April-12 on hpux10.20
Message-ID: <14097.59185.477055.292796@c1186.ae.ge.com>

Hello,
 It looks like demo("dyn.load") is broken for non ".so" extentions.

> demo("dyn.load")


        demo(dyn.load)
        ---- ~~~~~~~~

Type  <Return>   to start : 

> dyn.load("zero.so")
Error in dyn.load(x) : unable to load shared library "/home/absd00t/zero.so":
  can't open /home/absd00t/zero.so
> 
It looks like zero.R problem. It is looking for zero.* in my home
dir. If I do :
~>R COMPILE zero.c
gcc -I/usr/include/Motif1.1 -I/usr/include/X11R4 -I/home/absd00t/local/include -fpic -I/home/absd00t/local/lib/R/include -c zero.c -o zero.o
~>R SHLIB -o zero.sl zero.o
ld -b -o zero.sl zero.o -L/home/absd00t/local/lib  -lf2c -lm

~>R

R : Copyright 1999, The R Development Core Team
Version 0.65.0 Under development (unstable) (April 12, 1999)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type    "?license" or "?licence" for distribution details.

R is a collaborative project with many contributors.
Type    "?contributors" for a list.

Type    "demo()" for some demos, "help()" for on-line help, or
        "help.start()" for a HTML browser interface to help.
Type    "q()" to quit R.

> dyn.load("zero.sl")
> source("zero.R")   <--- after changing zero.so to zero.sl
[1] 1.5
[1] 1.50000002235174
> 

Seems to be working OK.
Osman
 
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 14:08:13 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 14:08:13 +0100 (BST)
Subject: R-0.65-April-12 on hpux10.20
Message-ID: <199904121308.OAA05354@toucan.stats.ox.ac.uk>

> From: U-E59264-Osman F Buyukisik <absd00t@c1186.ae.ge.com>
> 
> Hello,
>  It looks like demo("dyn.load") is broken for non ".so" extentions.

Broken? Has it ever worked?

You need

dyn.load(paste("zero", .Platform$dynlib.ext, sep="."))

and I will put that in the release branch as this is a bug fix.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Mon Apr 12 15:17:33 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 12 Apr 1999 09:17:33 -0500
Subject: --nsize and --vsize
In-Reply-To: Prof Brian Ripley's message of "Mon, 12 Apr 1999 10:09:29 +0100 (BST)"
References: <199904120909.KAA28372@toucan.stats.ox.ac.uk>
Message-ID: <6rlnfxly82.fsf@verdi.stat.wisc.edu>

I would agree that:
 - it is reasonable to increase the default vsize and nsize
 - the default sizes should probably be architecture dependent
 - If possible, the default sizes should also be picked up from
   ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
   environment variables and use them

I think that 16M for vsize and 800k for nsize could be good global
defaults on many architectures.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Mon Apr 12 16:24:39 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Mon, 12 Apr 1999 08:24:39 -0700 (PDT)
Subject: add-on packages
In-Reply-To: <199904120656.IAA14380@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>

On Mon, 12 Apr 1999, Kurt Hornik wrote:
> Another interesting fact is data duplication.  More than 10 data sets
> show up in more than one package.  Maybe we should add these to the main
> distribution then?

I don't think this follows. Disk space is much cheaper than name space
(perhaps even when we get the promised new features)

> 
> Finally (again?), please make sure that your packages do not mask system
> features.

Note that this requires quite frequent checking -- system features do keep
being added.

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 16:45:50 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 17:45:50 +0200 (CEST)
Subject: add-on packages
In-Reply-To: <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>
References: <199904120656.IAA14380@pc87.maho.magnaeu.com>
 <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>
Message-ID: <14098.5422.232593.587310@pc87.maho.magnaeu.com>

>>>>> Thomas Lumley writes:

> On Mon, 12 Apr 1999, Kurt Hornik wrote:

>> Another interesting fact is data duplication.  More than 10 data sets
>> show up in more than one package.  Maybe we should add these to the main
>> distribution then?

> I don't think this follows. Disk space is much cheaper than name space
> (perhaps even when we get the promised new features)

O.k.

>> 
>> Finally (again?), please make sure that your packages do not mask system
>> features.

> Note that this requires quite frequent checking -- system features do
> keep being added.

I thought that this too could be a part of the automated process.
(After a successful `R CMD check', load the pkg and see if the warnings
occur.)

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Mon Apr 12 16:41:59 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 12 Apr 1999 11:41:59 -0400
Subject: Fortran vs C, easing using Fortran
References: <199904120945.KAA28971@toucan.stats.ox.ac.uk>
Message-ID: <37121447.77787569@bank-banque-canada.ca>

It seems to me that, at least for application packages, there is a strong
incentive to avoid both fortran and C. If eventual R, or a new language like
Omega, are to work in a "Java like" way across platforms, I think both fortran
and C are problems. Is that not correct?

I realize there is a performance issue, but I don't think it is as serious as it
was in old versions of Splus. I am not sure how slow my time series library
would be without the fortran. It used to be intolerable, but I have the
impression it may not be too bad now.

To some extent this must also apply to the core part of the language. Is there
not some incentive to remove, not add, both fortran and C except where they are
essential?

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 16:50:03 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 16:50:03 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904121550.QAA10948@toucan.stats.ox.ac.uk>


> To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
> Cc: R-devel@stat.math.ethz.ch
> Subject: Re: --nsize and --vsize
> From: Douglas Bates <bates@stat.wisc.edu>
> Date: 12 Apr 1999 09:17:33 -0500
> 
> I would agree that:
>  - it is reasonable to increase the default vsize and nsize
>  - the default sizes should probably be architecture dependent
>  - If possible, the default sizes should also be picked up from
>    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
>    environment variables and use them
> 
> I think that 16M for vsize and 800k for nsize could be good global
> defaults on many architectures.

But not I think for multi-user machines. That is 35Mb allocated (on Solaris)
and I would not want our students taking 35Mb for each R job, as the
current memory management really needs most of it resident. About half
that would be tolerable, hence my original figures.  We would like them 
to use perhaps 50Mb in total.

Also, that is too much for 64Mb Windows NT machines, and that is 
high-end for teaching labs.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From albrecht.gebhardt@uni-klu.ac.at  Mon Apr 12 17:27:46 1999
From: albrecht.gebhardt@uni-klu.ac.at (Albrecht Gebhardt)
Date: Mon, 12 Apr 1999 18:27:46 +0200 (MET DST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <199904120945.KAA28971@toucan.stats.ox.ac.uk>
Message-ID: <Pine.OSF.4.05.9904121806200.23217-100000@zidsrv.sci.uni-klu.ac.at>

On Mon, 12 Apr 1999, Prof Brian Ripley wrote:

> 
> > Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
> > From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>
> > > I think in R we can do better than at present, if only I knew
> > > exactly how. One idea is to have (effectively) a `hints' file that
> > > configure uses to add a base set of libraries to FLIBS, but on Solaris
> > > at least, using the Fortran command (f77 or g77) to link a dynamic library
> > > does the job.  For linking with ld the base FLIBS would need to be
> > > 
> > > -lF77 -lM77 -lV77 -lsunmath -lm
> > > 
> > > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> > > 
> > 
> > I'm not sure if it does matter here, but the only way to build R on my
> > Alphas currently is using Fortran as LDCMD:
> > 
> > in config.site:
> > LDCMD="f77 "
> > 
> > SHLIBLD is "ld -shared -expect_unresolved '*'".
> 
> I would have expected
> 
> LDCMD=f77
> LDFLAGS="-g -nofor_main -fpe3"
> SHLIBLD=ld
> SHLIBLDFLAGS="-shared -expect_unresolved '*'"
> 
> as the way to encode that.  Now my question amounts to
> 
> Does SHLIBLD=f77 work with those SHLIBLDFLAGS?
> If not, can SHLIBLDFLAGS be modified to make it work?
> 

splitting 
   LDCMD="f77 -g -nofor_main -fpe3 "
into 
   LDCMD=f77
   LDFLAGS="-g -nofor_main -fpe3"
results in

root@delta[R]# ./configure
loading cache ./config.cache
checking for a BSD compatible install... (cached) /usr/local/bin/install -c
checking whether ln -s works... (cached) yes
checking for ranlib... (cached) ranlib
checking for bison... (cached) bison -y
checking for ar... (cached) ar
checking for latex... (cached) /usr/local/bin/latex
checking for dvips... (cached) /usr/local/bin/dvips
checking for makeindex... (cached) /usr/local/bin/makeindex
checking for perl... (cached) /usr/local/bin/perl
checking whether perl is perl 5... yes
checking for cc... (cached) cc
checking for underscore after Fortran symbols... configure: error: Nothing
worked - cannot use FORTRAN

setting SHLIBLD to f77 and SHLIBLDFLAGS="-shared" works.
(SHLIBLDFLAGS="-shared -expect_unresolved '*'" fails, f77 doesn't
understand this linker option, but no matter: it would only suppress some
warnings)
BTW, the value of SHLIBLDFLAGS specified in config.site gets never used:
it will be overwritten from the configure script with the host specific
versions of SHLIBLDFLAGS.
The same thing for SHLIBLD, this is hardcoded to "ld" in configure.in.
 
But I think there is no difference between
  SHLIBLD=ld
  SHLIBLDFLAGS="-shared -expect_unresolved '*'"
and
  SHLIBLD=f77
  SHLIBLDFLAGS="-shared"
because f77 also calls ld (ok, with the correct Fortran libraries,
libUfor.so, libFutil.so, libots.so). I guess this works because I link R
with LDCMD="f77 -nofor_main", so it already contains the symbols of the
Fortran libraries.

Albrecht
-------------------------------------------------------------------------------
Albrecht Gebhardt                   email   : albrecht.gebhardt@uni-klu.ac.at
Institut fuer Mathematik            Tel.    : (++43 463) 2700/837
Universitaet Klagenfurt             Fax     : (++43 463) 2700/834
Villacher Str. 161
A-9020 Klagenfurt, Austria
-------------------------------------------------------------------------------



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 17:32:38 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 17:32:38 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
Message-ID: <199904121632.RAA11126@toucan.stats.ox.ac.uk>

>  From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>

> But I think there is no difference between
>   SHLIBLD=ld
>   SHLIBLDFLAGS="-shared -expect_unresolved '*'"
> and
>   SHLIBLD=f77
>   SHLIBLDFLAGS="-shared"
> because f77 also calls ld (ok, with the correct Fortran libraries,
> libUfor.so, libFutil.so, libots.so). I guess this works because I link R
> with LDCMD="f77 -nofor_main", so it already contains the symbols of the
> Fortran libraries.

Thanks, it is the `ok, with the correct Fortran libraries' we are looking for
here.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Mon Apr 12 21:53:57 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 Apr 1999 08:53:57 +1200 (NZST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <37121447.77787569@bank-banque-canada.ca>
Message-ID: <Pine.BSF.3.96.990413083608.275D-100000@g.ihaka.slip.auckland.ac.nz>


On Mon, 12 Apr 1999, Paul Gilbert wrote:

> It seems to me that, at least for application packages, there is a strong
> incentive to avoid both fortran and C. If eventual R, or a new language like
> Omega, are to work in a "Java like" way across platforms, I think both fortran
> and C are problems. Is that not correct?

IMHO: Java is (currently) too slow for production numerical work and I
suspect that this will remain the case for some time.  Java gets around
this by providing a way of calling Fortran and C.

I once heard an informed opinion that it would hard to get a language like
S to perform within a factor of 10 of optimized C or Fortran.  Most of the
time we can live with a factor of 10, but sometimes ...

There is also the issue of the code base available in Fortran (and to a
lesser extent in C).  It's a resource which can't be ignored.
 
> I realize there is a performance issue, but I don't think it is as serious as it
> was in old versions of Splus. I am not sure how slow my time series library
> would be without the fortran. It used to be intolerable, but I have the
> impression it may not be too bad now.

For the most part, the numerical methods in S are implemented in Fortran
I think. So even if you don't see it, it's there.

> To some extent this must also apply to the core part of the language. Is there
> not some incentive to remove, not add, both fortran and C except where they are
> essential?

Actually, I quite like Fortran for expressing numerical computations (yes
I should probably keep my dirty habits to myself :-).  I'd prefer Algol60
but that's not really an option. I'd certainly like foreign language calls
to remain an option.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Mon Apr 12 23:41:12 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Mon, 12 Apr 1999 23:41:12 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.HPP.3.96.990412233602.25145B-100000@tiger.statslab.cam.ac.uk>


On 12 Apr 1999, Douglas Bates wrote:

> I would agree that:
>  - it is reasonable to increase the default vsize and nsize
>  - the default sizes should probably be architecture dependent
>  - If possible, the default sizes should also be picked up from
>    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
>    environment variables and use them
> 
> I think that 16M for vsize and 800k for nsize could be good global
> defaults on many architectures.

If the environment variables where used (best solution), wouldn't it be
better to tell people in the memory exhaustion at startup warning message
that this option existed.  Rather than defaulting to a potentially
wasteful use of memory. 


Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>  Tue Apr 13 00:02:21 1999
From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk> (Nicholas Lee)
Date: Tue, 13 Apr 1999 00:02:21 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.BSF.3.96.990413083608.275D-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.HPP.3.96.990412231928.25145A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Ross Ihaka wrote:

> On Mon, 12 Apr 1999, Paul Gilbert wrote:

> > Omega, are to work in a "Java like" way across platforms, I think both fortran
> > and C are problems. Is that not correct?
> 
> IMHO: Java is (currently) too slow for production numerical work and I
> suspect that this will remain the case for some time.  Java gets around
> this by providing a way of calling Fortran and C.

The addage I've seen seen concerning Java currently is, "Write Once, Test
Everywhere."  Quite a part from this, the language itself isn't completely
stable and (free) optimised compilers always lag language modifications.


 
> I once heard an informed opinion that it would hard to get a language like
> S to perform within a factor of 10 of optimized C or Fortran.  Most of the
> time we can live with a factor of 10, but sometimes ...

I thought that R compiler you where talking about, was a way to go? ;)

> > I realize there is a performance issue, but I don't think it is as serious as it
> > was in old versions of Splus. I am not sure how slow my time series library
> > would be without the fortran. It used to be intolerable, but I have the
> > impression it may not be too bad now.

The difference performance of computers and amounts of avaiable memory,
would make retrospective benchmarks trickly. 

 

Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 06:06:51 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 13 Apr 1999 06:06:51 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <Pine.HPP.3.96.990412233602.25145B-100000@tiger.statslab.cam.ac.uk>
Message-ID: <Pine.GSO.4.05.9904130604390.17276-100000@auk.stats>

On Mon, 12 Apr 1999, Nicholas Lee wrote:

> 
> On 12 Apr 1999, Douglas Bates wrote:
> 
> > I would agree that:
> >  - it is reasonable to increase the default vsize and nsize
> >  - the default sizes should probably be architecture dependent
> >  - If possible, the default sizes should also be picked up from
> >    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
> >    environment variables and use them
> > 
> > I think that 16M for vsize and 800k for nsize could be good global
> > defaults on many architectures.
> 
> If the environment variables where used (best solution), wouldn't it be
> better to tell people in the memory exhaustion at startup warning message
> that this option existed.  Rather than defaulting to a potentially
> wasteful use of memory. 

Well, the flags exist now.  The `potentially wasteful' part is running out
of memory after a lot of work.  My comment is that at present the workspace
is less than half the total memory used: If you are going to use 10Mb
by default, why not use 15?


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 07:45:54 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 13 Apr 1999 07:45:54 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>

Based on the discussion so far, I have committed changes to 
`Version 0.64.0 Patched' that

  Uses R_NSIZE and R_VSIZE if set.

  Allows --nsize and --vsize to override these.

  Retains the previous minimum settings (200k and 2M) but if the user sets
  nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
  loaded.)

This is in system.unix.c, so Unix-only. (I see no reason not to so
this under Windows too, although there are other ways there).

The only snag I see is that there is no way to change this on an
installation-wide basis except to edit bin/R or include/Defn.h
and re-compile, but I guess that (especially the first) is safe enough.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 09:50:02 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 10:50:02 +0200
Subject: --nsize and --vsize
In-Reply-To: Prof Brian D Ripley's message of "Tue, 13 Apr 1999 07:45:54 +0100 (BST)"
References: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>
Message-ID: <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>

Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

>   Allows --nsize and --vsize to override these.
> 
>   Retains the previous minimum settings (200k and 2M) but if the user sets
>   nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
>   loaded.)
...
> The only snag I see is that there is no way to change this on an
> installation-wide basis except to edit bin/R or include/Defn.h
> and re-compile, but I guess that (especially the first) is safe enough.

Isn't that essentially the original purpose of using a shell script
(Win/Mac notwithstanding)? If we want it even easier, we could have
bin/R doing something like

...
$R_ENV=${R_ENV:-$RHOME/site/Renviron.sh}
[ -x $R_ENV ] && source $R_ENV
$R_NSIZE=${R_NSIZE:-250K}
...



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 13 11:02:10 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Tue, 13 Apr 1999 12:02:10 +0200
Subject: make check (PR#165)
Message-ID: <199904131002.MAA10093@blueberry.kubism.ku.dk>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Type: text/plain; charset=us-ascii

R 0.64.0 on RedHat Linux 5.1

I decided to add a "make check" command in the R RPM spec file
to ensure that R works properly before packaging it up.  I
found (by sabotaging one of the *.Rout.save files) that errors
found by "make check" are ignored and do not cause make to exit
abnormally. This means that there is no way for rpm to know that
the checks have failed, and the RPM package gets built anyway.

I changed this by removing the "-" flag in test-All, as in the
attached patch. I'm sure there was a reason the flag was there,
but it is a problem for me, so I'm submitting this as a bug
report.

Martyn


--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Disposition: attachment; filename="R-makecheck.patch"
Content-Transfer-Encoding: 7bit
Content-Description: R-makecheck.patch
Content-Type: text/plain;
 charset=us-ascii; name=R-makecheck.patch; SizeOnDisk=306

# Remove "ignore" flag from test-All so that
# build will fail if "make check" fails.
#
--- Makefile.in	Wed Jan  6 16:37:37 1999
+++ Makefile.in.patched	Tue Apr 13 11:00:42 1999
@@ -151,4 +151,4 @@
 
 check test:: test-All
 test-All test-Examples::
-	-@(cd tests && $(MAKE) $@)
+	@(cd tests && $(MAKE) $@)

--_=XFMail.1.3.p0.Linux:990413120342:8241=_--
End of MIME message

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 13 11:03:42 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Tue, 13 Apr 1999 12:03:42 +0200 (CEST)
Subject: make check
Message-ID: <XFMail.990413120342.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Type: text/plain; charset=us-ascii

R 0.64.0 on RedHat Linux 5.1

I decided to add a "make check" command in the R RPM spec file
to ensure that R works properly before packaging it up.  I
found (by sabotaging one of the *.Rout.save files) that errors
found by "make check" are ignored and do not cause make to exit
abnormally. This means that there is no way for rpm to know that
the checks have failed, and the RPM package gets built anyway.

I changed this by removing the "-" flag in test-All, as in the
attached patch. I'm sure there was a reason the flag was there,
but it is a problem for me, so I'm submitting this as a bug
report.

Martyn


--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Disposition: attachment; filename="R-makecheck.patch"
Content-Transfer-Encoding: 7bit
Content-Description: R-makecheck.patch
Content-Type: text/plain;
 charset=us-ascii; name=R-makecheck.patch; SizeOnDisk=306

# Remove "ignore" flag from test-All so that
# build will fail if "make check" fails.
#
--- Makefile.in	Wed Jan  6 16:37:37 1999
+++ Makefile.in.patched	Tue Apr 13 11:00:42 1999
@@ -151,4 +151,4 @@
 
 check test:: test-All
 test-All test-Examples::
-	-@(cd tests && $(MAKE) $@)
+	@(cd tests && $(MAKE) $@)

--_=XFMail.1.3.p0.Linux:990413120342:8241=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Tue Apr 13 11:14:26 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 Apr 1999 12:14:26 +0200 (CEST)
Subject: --nsize and --vsize
In-Reply-To: <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>
References: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>
 <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>
Message-ID: <14099.6402.52677.10185@pc87.maho.magnaeu.com>

>>>>> Peter Dalgaard BSA writes:

> Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
>> Allows --nsize and --vsize to override these.
>> 
>> Retains the previous minimum settings (200k and 2M) but if the user sets
>> nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
>> loaded.)
> ...
>> The only snag I see is that there is no way to change this on an
>> installation-wide basis except to edit bin/R or include/Defn.h
>> and re-compile, but I guess that (especially the first) is safe enough.

> Isn't that essentially the original purpose of using a shell script
> (Win/Mac notwithstanding)? If we want it even easier, we could have
> bin/R doing something like

> ...
> $R_ENV=${R_ENV:-$RHOME/site/Renviron.sh}
> [ -x $R_ENV ] && source $R_ENV
> $R_NSIZE=${R_NSIZE:-250K}
> ...

Something like that, similar to forthcoming R `rc' files (now profile):

	system rc from R_HOME/VERSION/...
	site rc from R_HOME/site/.../Rrc
	user rc from ./.Rrc or ~/.Rrc

	system environ from R_HOME/VERSION/...
	site environ from R_HOME/site/.../Renviron
	user environ from ./.Renviron or ~/.Renviron

Of course, then we'd need options

	--no-user-env
	--no-site-env

and I think I'd maybe want (for 1.0)

	--no-user-file => --no-user-rc
	--no-site-file => --no-site-rc

or (maybe better) keep what we have and interpret it as `files' so that
neither rc no env file would be used.

-k

Btw, I'd use `-r' ...

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Tue Apr 13 11:39:00 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Tue, 13 Apr 1999 11:39:00 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <Pine.GSO.4.05.9904130604390.17276-100000@auk.stats>
Message-ID: <Pine.HPP.3.96.990413112824.25549A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Prof Brian D Ripley wrote:

> Well, the flags exist now.  The `potentially wasteful' part is running out

The flags exist, but in the adage of the lazy programmer, "less
keystrokes, means less RSI/bugs."   One nice option would be for R to probe
the size of the .RData file, and rather than dieing on you if it's too
large, giving you option of loading it with XX extra memory.

> of memory after a lot of work.  My comment is that at present the workspace
> is less than half the total memory used: If you are going to use 10Mb
> by default, why not use 15?

This is always going to be the case since R uses a static memory heap.
So the question arises; if the default is 15, why not 20...? 


The best solution would be for system wide config flags or ENVIRONMENT
variables, as this would allow people to set a memory usage policy given
the amount of library functions they have, general memory usage patterns,
and personal inclinations. 


Nicholas 

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Tue Apr 13 11:53:36 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Tue, 13 Apr 1999 11:53:36 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904131053.LAA17041@toucan.stats.ox.ac.uk>


> Date: Tue, 13 Apr 1999 11:39:00 +0100 (BST)
> From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>
> 
> On Tue, 13 Apr 1999, Prof Brian D Ripley wrote:
> 
> > Well, the flags exist now.  The `potentially wasteful' part is running out
> 
> The flags exist, but in the adage of the lazy programmer, "less
> keystrokes, means less RSI/bugs."   One nice option would be for R to probe
> the size of the .RData file, and rather than dieing on you if it's too
> large, giving you option of loading it with XX extra memory.

Fine. Please write the code to do this and submit it to us. (It would be
good to see your name in ?contributors.)

For the rest (why 15M?, best policy), please catch up with your reading
of R-devel.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Tue Apr 13 13:59:17 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Tue, 13 Apr 1999 13:59:17 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <199904131053.LAA17041@toucan.stats.ox.ac.uk>
Message-ID: <Pine.HPP.3.96.990413124738.25580A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Prof Brian Ripley wrote:

> > The flags exist, but in the adage of the lazy programmer, "less
> > keystrokes, means less RSI/bugs."   One nice option would be for R to probe


Here is a quick solution in the R.sh.in file: (Although it might be nicer
to do this via getenv("R_VSIZE") in the system.c) 

[ -f ${HOME}/.Renviron ] && . ${HOME}/.Renviron
[ "$R_VSIZE" != "" ] && ARG_STACK="$ARG_STACK --vsize $R_VSIZE"
[ "$R_NSIZE" != "" ] && ARG_STACK="$ARG_STACK --nsize $R_NSIZE"

exec ${RHOME}/bin/${RBINARY} $ARG_STACK "$@"


The only problem with this is:
-->8--
$ echo "R_VSIZE=20M" > ~/.Renviron  (or export R_VSIZE=20M)
$ R --vsize 4M
WARNING: invalid v(ector heap)size '4194304' ignored;using default = 20M

R : Copyright 1999, The R Development Core Team
[...]
> 
-->8--

I assume that --(v|n)size should override enviroment defaults?  

So we could fix that, by accepting the second --vsize option from $@,
instead of the first --vsize from the $ARG_STACK. 

That probably means some mickying around with: 

if(value < R_NSize || value > Max_Nsize) 
    REprintf("WARNING: ...
else
    R_NSize = value;


So what should the default action be?

> > the size of the .RData file, and rather than dieing on you if it's too
> > large, giving you option of loading it with XX extra memory.

Since InitMemory() is called before R_InitialData(), this might be
trickly.  Either involving some magic in the shell script wrapper or
pre-checking the size of the .RData file before calling InitMemory.


Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 18:29:17 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Tue, 13 Apr 1999 19:29:17 +0200
Subject: outer fails with group generic operations on factors (PR#166)
Message-ID: <199904131729.TAA18570@biostat.ku.dk>

B <- A <- factor(c("a", "b"))
outer(A, B, "!=")
Warning: "FUN" not meaningful for factors
     [,1] [,2]
[1,]   NA   NA
[2,]   NA   NA

Now, this used to work in 0.63.2, but someone `improved' outer. There
it did an implicit as.numeric. The problem is that get in match.fun does
not understand group generics, and gets

Browse[1]> FUN
.Primitive("!=")

This _should_ launch Ops.factor, but does not.

> "!="(A, B)
[1] FALSE FALSE
> get("!=")(A, B)
Warning: "" not meaningful for factors
[1] NA NA



This causes misclass.tree(, detail=F) in package tree to fail.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.6
 arch = sparc
 os = solaris2.6
 system = sparc, solaris2.6
 status = 
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 8
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 19:03:01 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 20:03:01 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Tue, 13 Apr 1999 19:29:17 +0200"
References: <199904131729.TAA18570@biostat.ku.dk>
Message-ID: <x2g164gzze.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> Browse[1]> FUN
> .Primitive("!=")
> 
> This _should_ launch Ops.factor, but does not.
> 
> > "!="(A, B)
> [1] FALSE FALSE
> > get("!=")(A, B)
> Warning: "" not meaningful for factors
> [1] NA NA
> 

Actually, it *does* launch Ops.factor, but it gets confused by garbage
in .Generic. The bug is this line in DispatchGroup:

    sprintf(generic, "%s", CHAR(PRINTNAME(CAR(call))));

which presumably should rather look at the "op" arg. 

I'll have a closer look.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 19:42:38 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 20:42:38 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: Peter Dalgaard BSA's message of "13 Apr 1999 20:03:01 +0200"
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk>
Message-ID: <x2btgsgy5d.fsf@blueberry.kubism.ku.dk>

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> Actually, it *does* launch Ops.factor, but it gets confused by garbage
> in .Generic. The bug is this line in DispatchGroup:
> 
>     sprintf(generic, "%s", CHAR(PRINTNAME(CAR(call))));
> 
> which presumably should rather look at the "op" arg. 
> 
> I'll have a closer look.

It *apparently* works to change the above line to:

 sprintf(generic, "%s", PRIMNAME(op));

"make check" completes (haven't checked the output yet), but can we
*really* be sure that "op" is a .Primitive at that point?

Anyone know better?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Tue Apr 13 21:51:52 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 Apr 1999 08:51:52 +1200 (NZST)
Subject: --nsize and --vsize
In-Reply-To: <199904131053.LAA17041@toucan.stats.ox.ac.uk>
Message-ID: <Pine.BSF.3.96.990414084552.244D-100000@g.ihaka.slip.auckland.ac.nz>


On Tue, 13 Apr 1999, Prof Brian Ripley wrote:

> Fine. Please write the code to do this and submit it to us. (It would be
> good to see your name in ?contributors.)

Egads, Another Aucklander!

Looks like we're singlehandedly curing the "small number of people in the
field" problem which John Chambers mentioned :-). 

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 14 07:31:01 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 Apr 1999 08:31:01 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: <x2g164gzze.fsf@blueberry.kubism.ku.dk> (message from Peter
 Dalgaard BSA on 13 Apr 1999 20:03:01 +0200)
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk>
Message-ID: <199904140631.IAA29602@sophie.ethz.ch>

Which reminds me of another long-standing  
UseMethod / NextMethod / Dispatch problem that I've never traced/solved..

Look at the  $RHOME/tests/mode-methods.R   file !
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 14 09:21:40 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 14 Apr 1999 10:21:40 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: Martin Maechler's message of "Wed, 14 Apr 1999 08:31:01 +0200"
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk> <199904140631.IAA29602@sophie.ethz.ch>
Message-ID: <x27lrfa9yj.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> Which reminds me of another long-standing  
> UseMethod / NextMethod / Dispatch problem that I've never traced/solved..
> 
> Look at the  $RHOME/tests/mode-methods.R   file !

..i.e. this:
abc <- function(x, ...) {
    if (is.null(class(x))) class(x) <- data.class(x)
    UseMethod("abc")
}

will dispatch on the data class in S but not in R.

This puzzles me, because normally you can't mess with the arguments of
a generic function, in *either* language:

> cde<-function(x,...){x<-x*2;UseMethod("print")}
> cde(2)
[1] 2

So, either it's because class<- is non-duplicating in S, or S is doing
something *really* strange here. 

Hmm, then again: class<- *is* non-duplicating in R:

> x<-1
> y<-.Alias(x)
> class(x)<-'foo'
> y
[1] 1
attr(,"class")
[1] "foo"

I think this is related to evaluation of promises:

> f<-function(x)substitute(x)
> f(sin(1))
sin(1)
> f<-function(x){x;substitute(x)}
> f(sin(1))
sin(1)
> f<-function(x){class(x)<-'foo';substitute(x)}
> f(sin(1))
[1] 0.841471
attr(,"class")
[1] "foo"

Notice that just forcing evaluation of x does not destroy the link
between x and the argument expression, but changing its class does.
This is probably what shouldn't happen.

You can get the dispatching done by using

abc <- function(x, ...) {
    if (is.null(class(x))) {
	class(x) <- data.class(x)
	abc(x, ...)
    } else
        UseMethod("abc")
}

which (seemingly) works in both languages, at least as long as you
don't have to mess with sys.parent()

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Wed Apr 14 10:23:20 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Wed, 14 Apr 1999 11:23:20 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904140923.LAA25445@biostat.ku.dk>

       (opening new bug report thread, on suggestion of BDR ..)

I said on vaguely related topic:

 MM> There's  another long-standing  
 MM> UseMethod / NextMethod / Dispatch problem that I've never traced/solved..
 MM>  
 MM> Look at the  $RHOME/tests/mode-methods.R   file !

Peter Dalgaard already remarked :

 PD> ..i.e. this:

 PD> abc <- function(x, ...) {
 PD>     if (is.null(class(x))) class(x) <- data.class(x)
 PD>     UseMethod("abc")
 PD> }
 PD> 
 PD> will dispatch on the data class in S but not in R.
 PD> 
 PD> This puzzles me, because normally you can't mess with the arguments of
 PD> a generic function, in *either* language:
 PD> 
 PD> > cde<-function(x,...){x<-x*2;UseMethod("print")}
 PD> > cde(2)
 PD> [1] 2
 PD> 
 PD> So, either it's because class<- is non-duplicating in S, or S is doing
 PD> something *really* strange here. 
 PD> 
 PD> Hmm, then again: class<- *is* non-duplicating in R:
 PD> 
 PD> > x<-1
 PD> > y<-.Alias(x)
 PD> > class(x)<-'foo'
 PD> > y
 PD> [1] 1
 PD> attr(,"class")
 PD> [1] "foo"
 PD> 
 PD> I think this is related to evaluation of promises:
 PD> 
 PD> > f<-function(x)substitute(x)
 PD> > f(sin(1))
 PD> sin(1)
 PD> > f<-function(x){x;substitute(x)}
 PD> > f(sin(1))
 PD> sin(1)
 PD> > f<-function(x){class(x)<-'foo';substitute(x)}
 PD> > f(sin(1))
 PD> [1] 0.841471
 PD> attr(,"class")
 PD> [1] "foo"
 PD> 
 PD> Notice that just forcing evaluation of x does not destroy the link
 PD> between x and the argument expression, but changing its class does.
 PD> This is probably what shouldn't happen.
 PD> 
 PD> You can get the dispatching done by using
 PD> 
 PD> abc <- function(x, ...) {
 PD>     if (is.null(class(x))) {
 PD> 	class(x) <- data.class(x)
 PD> 	abc(x, ...)
 PD>     } else
 PD>         UseMethod("abc")
 PD> }
 PD> 
 PD> which (seemingly) works in both languages, at least as long as you
 PD> don't have to mess with sys.parent()

So we don't know if this is a bug in R.
However, R is behaving inexpectedly to ``Joe Average-User''
and at least we should know if (and why)
we want to be different than S here.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 14 15:29:54 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 14 Apr 1999 10:29:54 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <199904140923.LAA25445@biostat.ku.dk>
Message-ID: <Pine.SV4.4.05.9904141016170.18981-100000@hsph.harvard.edu>


I'm pretty sure we've been through this one several times already,
although probably in different guises.
The discussion in the white book, section A.6 is rather specific about
this. And as near as I can tell is contrary to what S does. I don't think
that you want to do what S does.

Do you really want to have a language that accepts any change in x?
It is rather hard to see how it's object oriented then!
Or, alternatively do you really want to see if the only thing that
has changed about x is its class and that will be ok?
What about the other arguments?
The whole point of UseMethod is that we got an object x, with a
particular class and now we're going to do the right thing.
If you wanted to do the right thing with an object of a different
class then you need to do that before you call UseMethod.

Basically, one of the differences between UseMethod and NextMethod is
that with the first you don't get to change anything in the body of
the function, or at least, if you do then it will be ignored. If you
want to change things, do so and then call the generic.

UseMethod believes that the x in the call was evaluated and will
use that value in the call to the method.
NextMethod looks in the local environment for an x, uses one if it
finds one (otherwise gets the x in the call).
Semantically different, well documented and if Joe User doesn't
understand it's because S doesn't do what it says it does and
people write bad code (but generally not as bad as mine ;-).


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 14 17:00:19 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 14 Apr 1999 12:00:19 -0400 (EDT)
Subject: options
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.SV4.4.05.9904141155440.5911-100000@hsph.harvard.edu>


 Do we have a policy on checking for valid options?

In working on the warning system I tried to get S to
give a warning. So I went:

 options(object.size= -9)

 but it didn't, it exited in a rather confused state.

Is it the responsibility of the function retrieving the
option to set the value to something sensible. The user
can set them to any old thing but we will just use the
default (regardless of the state of options). Or do we
actively try to maintain the options in a "reliable state"?

As near as I can tell we currently do the former (some of the
time).



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 14 23:17:11 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 00:17:11 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Robert Gentleman's message of "Wed, 14 Apr 1999 10:29:54 -0400 (EDT)"
References: <Pine.SV4.4.05.9904141016170.18981-100000@hsph.harvard.edu>
Message-ID: <x2ogkqlue0.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

> Do you really want to have a language that accepts any change in x?
> It is rather hard to see how it's object oriented then!
> Or, alternatively do you really want to see if the only thing that
> has changed about x is its class and that will be ok?
> What about the other arguments?
> The whole point of UseMethod is that we got an object x, with a
> particular class and now we're going to do the right thing.
> If you wanted to do the right thing with an object of a different
> class then you need to do that before you call UseMethod.

I'm inclined to agree here. On the other hand, what might be the case
is that you could make class<- be a little more careful with its
argument so that UseMethod would see the modified x. Sneaky, but
compatible, and *perhaps* not very hard to do. How often is this kind
of construct (class(x)<-foo;UseMethod()) used in actual S code?

> Semantically different, well documented and if Joe User doesn't
> understand it's because S doesn't do what it says it does and
> people write bad code (but generally not as bad as mine ;-).

- and Joe User generally gets in trouble with methods anyway...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr 14 23:37:26 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 15 Apr 1999 00:37:26 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904142237.AAA25670@biostat.ku.dk>

On 15 Apr 1999, Peter Dalgaard BSA wrote:

> Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> 
> > Do you really want to have a language that accepts any change in x?
> > It is rather hard to see how it's object oriented then!
> > Or, alternatively do you really want to see if the only thing that
> > has changed about x is its class and that will be ok?
> > What about the other arguments?
> > The whole point of UseMethod is that we got an object x, with a
> > particular class and now we're going to do the right thing.
> > If you wanted to do the right thing with an object of a different
> > class then you need to do that before you call UseMethod.
> 
> I'm inclined to agree here. On the other hand, what might be the case
> is that you could make class<- be a little more careful with its
> argument so that UseMethod would see the modified x. Sneaky, but
> compatible, and *perhaps* not very hard to do. How often is this kind
> of construct (class(x)<-foo;UseMethod()) used in actual S code?

Often by certain people with a massive presence!

We have indeed been here before.  In our lda function we do

class(x) <- data.class(x)
UseMethod("lda")

That fails to use the new class in R, and according to `your' reading of
the White book (but not mine nor apparently the author of S's) should do
so. `You' suggested

   UseMethod("lda", x, ...)

which works in some versions of S-PLUS 3.x but crashes the DEC Alpha
version and works on no version of S-PLUS 5.x. Hence I have

lda <- function(x, ...)
{
   if(is.null(class(x))) class(x) <- data.class(x)
#ifdef R
   UseMethod("lda", x, ...)
#ifdef SP3
   UseMethod("lda")
}

and in SP5 I do something with new-style classes.

> - and Joe User generally gets in trouble with methods anyway...

and not just Joe User....

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 15 07:39:49 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 15 Apr 1999 08:39:49 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904150639.IAA26078@biostat.ku.dk>

On Wed, 14 Apr 1999, Robert Gentleman wrote:

> On Wed, 14 Apr 1999, Prof Brian D Ripley wrote:
> 
> > On 15 Apr 1999, Peter Dalgaard BSA wrote:
> > 
> > > Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> > > 
> > > > Do you really want to have a language that accepts any change in x?
> > > > It is rather hard to see how it's object oriented then!
> > > > Or, alternatively do you really want to see if the only thing that
> > > > has changed about x is its class and that will be ok?
> > > > What about the other arguments?
> > > > The whole point of UseMethod is that we got an object x, with a
> > > > particular class and now we're going to do the right thing.
> > > > If you wanted to do the right thing with an object of a different
> > > > class then you need to do that before you call UseMethod.
> > > 
> > > I'm inclined to agree here. On the other hand, what might be the case
> > > is that you could make class<- be a little more careful with its
> > > argument so that UseMethod would see the modified x. Sneaky, but
> > > compatible, and *perhaps* not very hard to do. How often is this kind
> > > of construct (class(x)<-foo;UseMethod()) used in actual S code?
> > 
> > Often by certain people with a massive presence!
> > 
> > We have indeed been here before.  In our lda function we do
> > 
> > class(x) <- data.class(x)
> > UseMethod("lda")
> > 
> > That fails to use the new class in R, and according to `your' reading of
> > the White book (but not mine nor apparently the author of S's) should do
> > so. `You' suggested
> 
>  If you could point out the error of my ways I would appreciate it.

I did not mean to imply that you were wrong, rather that the White Book
can be read both ways (and it seems has been).

> But, it as I understand it, UseMethod is supposed to call the method
> with the arguments the same as those that called the generic. You
> must evaluate x to figure out what method to call, but I don't see
> how you can change x (adding classes is changing it).

Then why are

UseMethod("foo")
UseMethod("foo", x)

different in R? (They are: lda works.) The actual definition of UseMethod
in S is

       UseMethod(generic, object, ...)

and by the standard evaluation model, `object' is subject to lazy
evaluation. Nothing I can see in the White Book says otherwise. Indeed,
page 467 says the arguments are `re-matched by the standard rules'. It then
says `The method will see argument matches as it would if the user's call
had been directly to the method'.  I think those claims are contradictory,
and in particular whichever way they are read suggest my pair of calls
should be the same.

[In S UseMethod("foo") is semantic shorthand for UseMethod("foo", <name of
first argument of caller>), according to the help page.]

To make matters worse, in S it is a common mistake to have

foo <- function(x, ...) UseMethod("foo")
foo.lm <- function(y, ...) { .... }

and that change of name of argument causes re-evaluation.  What happens in
R?  This makes an apparently small point, that generics should have the
same argument name as S, potentially rather important. I know of four
outstanding discrepancies:

R: deviance <- function (x, ...) UseMethod("deviance")
S: deviance <- function (x, ...) UseMethod("deviance")

and ditto for coef, fitted, residuals (which I had not realized, in part
because some of these only recently acquited defaults).

There are inconsistencies in the current R code: any objections if
I change these to uniformly follow S and use `object'?


The other common one is `print'. As in

> print
function (x, ...) 
UseMethod("print")
> print.socket
function (socket) 
{
    cat("Socket connection #", socket$socket, "to", socket$host, 
        "on port", socket$port, "\n")
}

print methods should have first argument x, a ... argument _and_ return
invisible(x) for an unchanged x (in S, at least).  print.plot
does not even have an argument, so how does that ever work?

>   I realize it is frustrating and if you think it's important
> you should change it. But, by doing that you move the language
> further away from being object oriented. 

What we do need is to get this documented!  In particular, in R

> ?UseMethod

Class Methods

     UseMethod(name)

is incomplete, and I only know about UseMethod("foo", x, ...) because
`you' (Kurt?) suggested I use it. 

BTW, I have never believed S3's claim to be `object-oriented': it has a
class-based dispatcher. S has changed (although it remains to be seen if
users will follow) and I would be happy for R to be different from both.
However, as Bill and I are currently trying to write about this for V&R3v2,
I would not like R to change dramatically after the next few months!


Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 14:37:16 1999
From: rgentlem@hsph.harvard.edu (rgentlem@hsph.harvard.edu)
Date: Thu, 15 Apr 1999 15:37:16 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904151337.PAA00928@biostat.ku.dk>


I've done some editing to get things together (hopefully without
changing the semantics)

On Thu, 15 Apr 1999, Prof Brian D Ripley wrote:

> On Wed, 14 Apr 1999, Robert Gentleman wrote:
> 
> > On Wed, 14 Apr 1999, Prof Brian D Ripley wrote:
> > 
> > > On 15 Apr 1999, Peter Dalgaard BSA wrote:
> > > 
> > > > Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> > > > 
> 
> I did not mean to imply that you were wrong, rather that the White Book
> can be read both ways (and it seems has been).
> 
> > But, it as I understand it, UseMethod is supposed to call the method
> > with the arguments the same as those that called the generic. You
> > must evaluate x to figure out what method to call, but I don't see
> > how you can change x (adding classes is changing it).
> 
> Then why are
> 
> UseMethod("foo")
> UseMethod("foo", x)
> different
> 
> 
> and by the standard evaluation model, `object' is subject to lazy
> evaluation. Nothing I can see in the White Book says otherwise. Indeed,
> page 467 says the arguments are `re-matched by the standard rules'. It then
> says `The method will see argument matches as it would if the user's call
> had been directly to the method'.  I think those claims are contradictory,
> and in particular whichever way they are read suggest my pair of calls
> should be the same.
> 
> [In S UseMethod("foo") is semantic shorthand for UseMethod("foo", <name of
> first argument of caller>), according to the help page.]
> 

  Now, with my reading, the method will see the argument as it would
if the users call had been directly to the the method, coupled with
the later comment (top of p. 469) that for NextMethod you must take local
bindings for the arguments, yields
   with UseMethod you don't take local bindings, the method gets what
the generic did, but it will rematch (argument names and positions
may have changed). That means you need to ignore what happened
inside of the generic.

  Now, we have the variable definition problem raise it's head,
  UseMethod("foo")
  UseMethod("foo",x)
  If the second version doesn't use the local binding of x then
 UseMethod behaves differently, in terms of how it treats its arguments
 than every other function (which is ok, we just need to be specific
 about it).
  So we have to make a decision, UseMethod does what S does (which is
 fine) or it doesn't.

> To make matters worse, in S it is a common mistake to have
> 
> foo <- function(x, ...) UseMethod("foo")
> foo.lm <- function(y, ...) { .... }
> 
> and that change of name of argument causes re-evaluation.  What happens in
> R?  
  The standard argument matching system takes over. If there was an
argument y=blah, in the ... then it will get matched to y in foo.lm
even though something different was matched to x in the call to the 
generic. I don't believe that a reevaluation takes place in either 
situation. If x was evaluated and that is what is matched then we
look in the value side of the expression, see that it's there and
carry on. If we match to something new then the standard rules take
over.
  Promises are basically cells with three slots, an unevaluated
expression, an environment in which to carry out the evaluation
of that expression and a value. When we want a value, we look in
the value slot first, if there is no value, we evaluate the
expression and stick the value into the value slot. So promises
should never be evaluated twice.

 For those not bored, here is a difference between R and S that 
we may not want.
bar<-function(w,...) {
    UseMethod("bar")
  }
 bar.foo<-function(y, w) print(w)
x<-30
class(x)<-"foo"

Now in R,
> bar(x,10)
[1] 10
> bar(x,y=10)
[1] 30
attr(,"class")
[1] "foo"

Notice that if the arguments are not named we use default matching and
that the symbolic name for the first argument in the generic is not
carried over.

In S bar(x,10) and bar(x,y=10) both evaluate to the same thing,
[1] 30
attr(,"class")
[1] "foo"
it appears that the name w has been applied to the first argument and
that is carried with it for subsequent evaluations.

  I'm not sure what you meant by "the change of name causes reevaluation,
when I try
> bar(x<-x+1)
I get,
[1] 31
attr(, "class"):
[1] "foo"
[1] 31
attr(, "class"):
[1] "foo"
  which is only one evaluation (and the same in R)

> This makes an apparently small point, that generics should have the
> same argument name as S, potentially rather important. I know of four
> outstanding discrepancies:
> 
> R: deviance <- function (x, ...) UseMethod("deviance")
> S: deviance <- function (x, ...) UseMethod("deviance")
> 
> and ditto for coef, fitted, residuals (which I had not realized, in part
> because some of these only recently acquited defaults).
> 
> There are inconsistencies in the current R code: any objections if
> I change these to uniformly follow S and use `object'?

  Change to your hearts content. I think we want something that works
and that makes sense.
> What we do need is to get this documented!  In particular, in R
> 
> > ?UseMethod
> 
> Class Methods
> 
>      UseMethod(name)
> 


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr 15 15:25:07 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 15 Apr 1999 10:25:07 -0400
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
References: <199904151337.PAA00928@biostat.ku.dk>
Message-ID: <3715F6C2.81A6B0F8@bank-banque-canada.ca>

> To make matters worse, in S it is a common mistake to have
> foo <- function(x, ...) UseMethod("foo")
> foo.lm <- function(y, ...) { .... }

I've tried very hard not to do this, but it sure would be nice to have a good
automatic way to check it. Any suggestions?

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Thu Apr 15 17:07:39 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Fri, 16 Apr 1999 01:37:39 +0930 (CST)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <199904151337.PAA00928@biostat.ku.dk>
References: <199904151337.PAA00928@biostat.ku.dk>
Message-ID: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>

Blundering late into this discussion I'm going to take a chance
here and venture an opinion on what does happen in S3 UseMethod,
regardless of what interpretations are made of A.6 in the white
book.  This is by the "suck it and see" method, the only one I
trust.  (The chance I take is in supposing this to be useful...)

1. At the time of the UseMethod call the principal argument is
   examined, and evaluated if necessary, and the class it has at
   that stage is the one used for method dispatch.

2. All non-missing arguments are passed on to the method with the
   values they were supplied with at the time of the original
   call, not the changed values they may have at the time of
   dispatch, (including the principal argument).

3. Missing arguments that have been given values at the time of
   method dispatch, as well as local variables, retain their
   current values when control passes to the method.

4. Supplying a second argument to UseMethod() allows some other
   argument than the first to act as the principal argument.

5. Default values for arguments in the method supercede defaults
   supplied in the generic.

The method directly occupies the frame of the generic, but
arguments actually supplied to the generic re-assume their
original supplied values (even though changes to the principal
argument prior to method dispatch may determine mathod dispatch.)

So, for example, if the principal argument is not missing, has no
class at the call and is given class "xyz" by the generic, the
"xyz" method is dispatched, but the object corresponding to the
principal argument inside the method is the original classless
object.  (I would have thought that this was the major reason to
have a function like data.class in the first place.  What other
serious use does it have?)  To verify *from within the method*
that the principal argument had the class implied by the method,
you have to inspect the .Class guaranteed variable, not the
current class of the principal argument itself, which may be
wildly at variance.

"Missing" arguments on the original call remain missing unless
the generic has given them values prior to method dispatch, in
which case they behave like local variables and retain their
local supplied values.  If defaults are needed, the most recent
one is used.

Now, how does R differ?

Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 17:38:27 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 12:38:27 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <Pine.SV4.4.05.9904151213320.1352-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Bill Venables wrote:

> Blundering late into this discussion I'm going to take a chance
> here and venture an opinion on what does happen in S3 UseMethod,
> regardless of what interpretations are made of A.6 in the white
> book.  This is by the "suck it and see" method, the only one I
> trust.  (The chance I take is in supposing this to be useful...)
> 
> 1. At the time of the UseMethod call the principal argument is
>    examined, and evaluated if necessary, and the class it has at
>    that stage is the one used for method dispatch.
> 
> 2. All non-missing arguments are passed on to the method with the
>    values they were supplied with at the time of the original
>    call, not the changed values they may have at the time of
>    dispatch, (including the principal argument).
> 
> 3. Missing arguments that have been given values at the time of
>    method dispatch, as well as local variables, retain their
>    current values when control passes to the method.
> 
> 4. Supplying a second argument to UseMethod() allows some other
>    argument than the first to act as the principal argument.
> 
> 5. Default values for arguments in the method supercede defaults
>    supplied in the generic.
> 
> The method directly occupies the frame of the generic, but
> arguments actually supplied to the generic re-assume their
> original supplied values (even though changes to the principal
> argument prior to method dispatch may determine mathod dispatch.)

  I don't think that's what S does. My experiments suggest that S
takes the current value of the principal argument regardless of
what was passed in. I asked JMC and if I understood him then that's
what is being done.
  As for other arguments, well it seems to pick things up at the point
that UseMethod is called from.
  For example,
  bar<-function(w, y, ...)
{
        y <- 12
        w <- 3
        UseMethod("bar")
}
  bar.default<-function(y, w) {
     print(w)
     print(y)
  }

  x<-30
  bar(x)

  yields:
[1] 3
[1] 12
[1] 12

  So, x was changed, y (even though missing from the original call
 now exists) and the names given to the arguments in the call to
 the generic have been used to match in the call to the method.

 In R, (0.65)
 I get 
  > Error: Argument "w" is missing, with no default.


 One small change (and back to S) 
  bar<- function(w, v, ...)
{
        y <- 12
        w <- 3
        UseMethod("bar")
}

  Now, for bar(x,20) I still get,
[1] 3
[1] 12
[1] 12
 
  I don't think that's what you want. But my guess as to the semantics
is the following.
  When UseMethod is called the generic is determined by the class
of the principal argument at that point. That method is grabbed
and it's arguments are matched using the frame of the currently
executing method (not the arguments in the call to the currently 
active method). Then that method is evaluated using a new frame,
but the bindings achieved from the match. 

We can do this; but do we want to? There is something particularly
unsettling about the method matching args from the currently active frame
rather than from the call to the generic.

  I'm working with:
S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
S : Copyright AT&T.
Version 3.4 Release 1 for Sun SPARC, SunOS 5.3 : 1996 

> 
> So, for example, if the principal argument is not missing, has no
> class at the call and is given class "xyz" by the generic, the
> "xyz" method is dispatched, but the object corresponding to the
> principal argument inside the method is the original classless
> object.  (I would have thought that this was the major reason to
> have a function like data.class in the first place.  What other
> serious use does it have?)  To verify *from within the method*
> that the principal argument had the class implied by the method,
> you have to inspect the .Class guaranteed variable, not the
> current class of the principal argument itself, which may be
> wildly at variance.
> 
> "Missing" arguments on the original call remain missing unless
> the generic has given them values prior to method dispatch, in
> which case they behave like local variables and retain their
> local supplied values.  If defaults are needed, the most recent
> one is used.
> 
> Now, how does R differ?
> 
> Bill Venables.
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 18:00:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 19:00:14 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Bill Venables's message of "Fri, 16 Apr 1999 01:37:39 +0930 (CST)"
References: <199904151337.PAA00928@biostat.ku.dk> <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <x2aew9g6ox.fsf@blueberry.kubism.ku.dk>

Bill Venables <wvenable@arcola.stats.adelaide.edu.au> writes:

> Blundering late into this discussion I'm going to take a chance
> here and venture an opinion on what does happen in S3 UseMethod,
> regardless of what interpretations are made of A.6 in the white
> book.  This is by the "suck it and see" method, the only one I
> trust.  (The chance I take is in supposing this to be useful...)
> 
> 1. At the time of the UseMethod call the principal argument is
>    examined, and evaluated if necessary, and the class it has at
>    that stage is the one used for method dispatch.
> 
> 2. All non-missing arguments are passed on to the method with the
>    values they were supplied with at the time of the original
>    call, not the changed values they may have at the time of
>    dispatch, (including the principal argument).
> 
> 3. Missing arguments that have been given values at the time of
>    method dispatch, as well as local variables, retain their
>    current values when control passes to the method.
> 
> 4. Supplying a second argument to UseMethod() allows some other
>    argument than the first to act as the principal argument.
> 
> 5. Default values for arguments in the method supercede defaults
>    supplied in the generic.
> 
> The method directly occupies the frame of the generic, but
> arguments actually supplied to the generic re-assume their
> original supplied values (even though changes to the principal
> argument prior to method dispatch may determine mathod dispatch.)

Erm, does that cover this case?:

>  f<-function(x){x<-2;print(substitute(x));UseMethod("print")}  
> f(4)
[1] 2
[1] 4
> f((4))
(4)
[1] 2

(It may, I'm just too tired to see it...)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 21:32:28 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 16:32:28 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <x2aew9g6ox.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904151628020.16888-100000@hsph.harvard.edu>



On 15 Apr 1999, Peter Dalgaard BSA wrote:

> Erm, does that cover this case?:
> 
> >  f<-function(x){x<-2;print(substitute(x));UseMethod("print")}  
> > f(4)
> [1] 2
> [1] 4
> > f((4))
> (4)
> [1] 2
> 
> (It may, I'm just too tired to see it...)

  Wow! That's peculiar. 
  R does the rather boring

> f<-function(x){x<-2;print(substitute(x));UseMethod("print")}
> f(4)
[1] 2
[1] 4
> f((4))
[1] 2
[1] 4

  Does that mean that our implementaion of substitute is not quite
right? The documentation suggests that you get the expression typed as
the value of a formal argument; right now we're getting the current
value.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 22:50:21 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Thu, 15 Apr 1999 23:50:21 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904152150.XAA01121@biostat.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>   Does that mean that our implementaion of substitute is not quite
> right? The documentation suggests that you get the expression typed as
> the value of a formal argument; right now we're getting the current
> value.

No. It means that S's implementation is quite wrong...

R's substitute works by fairly clean rules of (lazy) evaluation: If
you pass it a an expression containing x and x is a PROMSXP, you get
the argument expression. If you change x before the substitute, you get
the current value (unless you used x<-delay(something), in which case
you get the unevaluated something). 

S does --- something else:

> f<-function(x){x<-2;substitute(x)}
> f(5)
[1] 2
> y<-5     
> f(y)
y

This, I *really* don't think we want to emulate.

The documentation is badly off, though... and the quote() doc is
really off target. (I've written about this before, but it never found
its way to the help page, obviously).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 22:50:07 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 23:50:07 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Robert Gentleman's message of "Thu, 15 Apr 1999 16:32:28 -0400 (EDT)"
References: <Pine.SV4.4.05.9904151628020.16888-100000@hsph.harvard.edu>
Message-ID: <x2zp49d04w.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>   Does that mean that our implementaion of substitute is not quite
> right? The documentation suggests that you get the expression typed as
> the value of a formal argument; right now we're getting the current
> value.

No. It means that S's implementation is quite wrong...

R's substitute works by fairly clean rules of (lazy) evaluation: If
you pass it a an expression containing x and x is a PROMSXP, you get
the argument expression. If you change x before the substitute, you get
the current value (unless you used x<-delay(something), in which case
you get the unevaluated something). 

S does --- something else:

> f<-function(x){x<-2;substitute(x)}
> f(5)
[1] 2
> y<-5     
> f(y)
y

This, I *really* don't think we want to emulate.

The documentation is badly off, though... and the quote() doc is
really off target. (I've written about this before, but it never found
its way to the help page, obviously).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 23:17:16 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 18:17:16 -0400 (EDT)
Subject: debug
In-Reply-To: <199904131002.MAA10093@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904151806220.21765-100000@hsph.harvard.edu>

I've just committed a fix for debugging functions that do not have
{'s around the body (funs with one line basically). Let me know if you
have problems. 

(all my stuff is going in 0.65 and I'll try to migrate it over once
I think it's ok)


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 23:28:31 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 16 Apr 1999 00:28:31 +0200
Subject: debug
In-Reply-To: Robert Gentleman's message of "Thu, 15 Apr 1999 18:17:16 -0400 (EDT)"
References: <Pine.SV4.4.05.9904151806220.21765-100000@hsph.harvard.edu>
Message-ID: <x2wvzdcycw.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

> I've just committed a fix for debugging functions that do not have
> {'s around the body (funs with one line basically). Let me know if you
> have problems. 

One thing:

example(esoph)

is bailing out in a glm() call, and of course make check does too.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Fri Apr 16 07:20:54 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Fri, 16 Apr 1999 15:50:54 +0930 (CST)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
References: <199904151337.PAA00928@biostat.ku.dk>
 <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <14102.54983.17904.253771@arcola.stats.adelaide.edu.au>

Well, I have to admit that I have egg all over my face this
time, and if you don't want to have the long-winded justification
I suggest you pass to your next email...

--

In my defence I was misled by what can only be called an S3 bug,
now probably unfixable since some code probably depends on it.
Here is the most succinct expression of it I can devise:

S3:

foo <- function(x) {
  class(x) <- "bar"
  x <- x - 1
  UseMethod("foo")
}
foo.bar <- function(x) invisible(print(x))


Now with one kind of actual argument method dispatch occurs, but
he *original* value is passed on:

> foo(10)
[1] 10

but with any other kind the *modified* value is passed:

> fred <- 10
> foo(fred)
[1] 9
attr(, "class"):
[1] "bar"

and most egregiously:

> foo((10))
[1] 9
attr(, "class"):
[1] "bar"



On the other hand in S4 this anomaly is at least fixed.

S4 (using backward compatibility):

foo <- function(x) {
  oldClass(x) <- "bar"
  x <- x - 1
  UseMethod("foo")
}
foo.bar <- function(x) invisible(print(x))

> foo(10)
[1] 9
attr(, "class"):
[1] "bar"
> foo((10))
[1] 9
attr(, "class"):
[1] "bar"

There are other differences with S3, though.  For example, local
variables generated in the frame of the generic *are* passed to
the method in S3, but *are not* passed to the method in S4.

What a mess!

One clear moral seems to be don't do anything more inside a
generic function than you really need to do.  Keep it *very*
simple indeed.


I'm grateful to you guys for bringing up this matter right now,
but I'm sorry to be working it all out in front of you like this!

Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr 16 13:05:15 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 16 Apr 1999 14:05:15 +0200
Subject: Segfault from evalq(return()) (PR#168)
Message-ID: <199904161205.OAA01677@biostat.ku.dk>

Luke Tierney brought this up while we were discussing the semantics of
a possible let() or local() call:

> evalq(return())
Segmentation fault (core dumped)

This is not just caused by trying to pop an empty stack:

> f<-function(x)evalq(return())
> f(2)
Segmentation fault (core dumped)


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr 16 13:10:41 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 16 Apr 1999 14:10:41 +0200
Subject: deparse drops () sometimes (PR#169)
Message-ID: <199904161210.OAA01687@biostat.ku.dk>

Shortest example is this:

> function()(g)()
function () 
(g)

It executes OK, but editing a function with one of these in will
introduce an error in an uexpected place.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 16 14:04:30 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 16 Apr 1999 09:04:30 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.54983.17904.253771@arcola.stats.adelaide.edu.au>
Message-ID: <Pine.SV4.4.05.9904160858520.25362-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Bill Venables wrote:

> Well, I have to admit that I have egg all over my face this
> time, and if you don't want to have the long-winded justification
> I suggest you pass to your next email...
> 
> --
> 
> In my defence I was misled by what can only be called an S3 bug,
> now probably unfixable since some code probably depends on it.

  Great examples. I am coming to understand the S3 model. Now,
 does anyone want to say what we want? Brian, you probably use this
 stuff more than most. Do you want to say what you want and I'll
 see what can be done to duplicate it. Anyone else that wants to
 chime in?

> 
> 
> One clear moral seems to be don't do anything more inside a
> generic function than you really need to do.  Keep it *very*
> simple indeed.
> 
   I recall JMC saying something like, all generic functions
 should be one line long; a call to the appropriate UseMethod.

   My own belief in this regard is that once you start down the
  OO road the object is immutable (otherwise what is the point?).
  Unfortunately the flexibility of S-like languages makes this
  impossible to enforce. There is also the issue of when do you 
  "start down the OO road", I always felt it was with the call
  to the generic but perhaps it's with the call to UseMethod.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr 16 17:22:01 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 16 Apr 1999 12:22:01 -0400
Subject: NextMethod
Message-ID: <371763A9.D2FF89C6@bank-banque-canada.ca>

>> One clear moral seems to be don't do anything more inside a
>> generic function than you really need to do.  Keep it *very*
>> simple indeed.
>>
>  I recall JMC saying something like, all generic functions
> should be one line long; a call to the appropriate UseMethod.

It certainly is encouraging to know that others also have been confused by
aspects of UseMethod. I've mostly kept my generic functions to one lined based
on the "keep it simple, stupid" principle. It's nice to have more impressive
references.

The "if it's not broken don't fix it" principle makes me reluctant to consider
the following, but...

In cleaning up parts of my library I realized that many of my old summary
methods actually print things instead of returning an object for a print method.
Some of these use NextMethod, and I've always been even more confused by
NextMethod than by UseMethod. Is the following a good model of how this should
be done:

summary.level1.level2 <- function(object)
{ r <- list("level2 before")
  r <- append(r,NextMethod("summary"))
  r <- append(r,"level2 after")
  class(r) <- "summary.level1.level2"
  r
}

print.summary.level1.level2 <- function(x)
 { cat(x[[1]])
   print(x[[2]])
   cat(x[[3]])
   invisible(x)
 }


z <- 1:3
class(z) <- c("level1.level2", "level1")
summary(z)

TIA
Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 16 17:50:53 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 16 Apr 1999 12:50:53 -0400 (EDT)
Subject: NextMethod
In-Reply-To: <371763A9.D2FF89C6@bank-banque-canada.ca>
Message-ID: <Pine.SV4.4.05.9904161235440.795-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Paul Gilbert wrote:

> In cleaning up parts of my library I realized that many of my old summary
> methods actually print things instead of returning an object for a print method.
> Some of these use NextMethod, and I've always been even more confused by
> NextMethod than by UseMethod. Is the following a good model of how this should
> be done:
> 
> summary.level1.level2 <- function(object)
> { r <- list("level2 before")
>   r <- append(r,NextMethod("summary"))
>   r <- append(r,"level2 after")
>   class(r) <- "summary.level1.level2"
>   r
> }
> 
> print.summary.level1.level2 <- function(x)
>  { cat(x[[1]])
>    print(x[[2]])
>    cat(x[[3]])
>    invisible(x)
>  }
> 
> 
> z <- 1:3
> class(z) <- c("level1.level2", "level1")
> summary(z)
> 
   You haven't really said what you want to do in enough detail for
me to give you an answer.
   If an object has several class attributes then NextMethod is
a way to move down the heirarchy. While it is much more general
almost every use is of the form that you used in summary.level1.level2;
first do some preprocessing, second call the default, do some post
processing and return. One big difference between NextMethod and UseMethod
is that UseMethod does not return (so putting stuff after it is
pointless).
   You can put any class you want on the return value. If you
want to have objects of class, summary.level1.level2, that's fine.
But if you want to have objects of class Tsobj.summary (returned
by all sorts of functions, but filtered through a single print)
then you can do that as well.
   I don't see the point of, class(z) <- c("level1.level2", "level1"),
in my R, since I don't have a summary.level1 function (which you may
have), I do get a call to summary.default as a result of NextMethod.
But NextMethod does first search for a function called summary.level1,
if it finds one then that will be evaluated.
   So, you really have to be careful. If you want to call a particular
function then you should do that by name. If you want to handle certain
attributes (for level1.level2) and then attributes for any other classes
(in this case level1) then NextMethod is your man. But if you want
to do some level1.level2 stuff and then call summary.default, don't
use NextMethod. 
    There are other differences between NextMethod and UseMethod (and
those differences are different between R and S; you need to read
the as yet unwritten R documentation to see what they really are :-)

robert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr 16 20:08:45 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 16 Apr 1999 15:08:45 -0400
Subject: NextMethod
References: <Pine.SV4.4.05.9904161235440.795-100000@hsph.harvard.edu>
Message-ID: <37178ABC.5299C80F@bank-banque-canada.ca>

> since I don't have a summary.level1 function (which you may

Whoops, I missed a part:

summary.level1 <- function(object)
{ r<- "level1"
  class(r) <- "summary.level1"
  r
 }

print.summary.level1 <- function(x) { cat(x) }

>  You haven't really said what you want to do in enough detail for
>  me to give you an answer.
>    If an object has several class attributes then NextMethod is
>  a way to move down the heirarchy.

I guess my first question was a very general one: Is this approach to moving
through the heirarchy to  construct a summary and print it likely to be fairly
robust as R and S evolve? Despite my lack of detail I think you answered that in
general it is.

Some of your other comments made me realize that my whole understanding of class
heirarchy is not good. In particular, I had thought of a more specific class
something like a sub-class: a specific class being associated with a particular
general class.  An object could be  c("level2a", "level1") or c("level2b",
"level1") but it would not logically be c("level2", "level1a") or c("level2",
"level1b").

>From what you've said I guess that is wrong. The class heirarchy should be
associated only with a specific object, not thought of as a logical structure
for all objects having their most specific class in common.

So, in my example

summary.level1.level2 <- function(object)
{ r <- list("level2 before")
  r <- append(r,NextMethod("summary"))
  r <- append(r,"level2 after")
  class(r) <- "summary.level1.level2"
  r
}

I could replace NextMethod("summary") with summary.level1(object) because I know
that any object of class "level1.level2" always inherits from "level1". (This is
part of the reason for my naming convention "level1.level2" for the specific
class.) But if I did this replacement and then called summary with an object of
class c("level1.level2", "level1b"), I would get a different result.
My way of thinking about this has not caused me any problems, I just have not
used inheritance  to its full power.

If I still have this all wrong please let me know.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Tue Apr 20 18:18:35 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Tue, 20 Apr 1999 12:18:35 -0500 (CDT)
Subject: eigenvalue/eigenvector calculations
Message-ID: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>

Some of you may have seen a message on s-news by Stefan Steinhaus
regarding his paper on "Comparison of mathematical programs for data
analysis".  He compares S-PLUS 4.5 with several other programs.  He
does not include R in the comparisons.  On p. 28 of his report he
gives the URL the Auckland site along with URL's for two other systems
but comments that "I didn't received (sic) any support for my work by
the software developers".  I'm not sure what that means.

Anyway, one of his comparisons for timing is for the calculation of the
determinant of a 1000x1000 matrix of uniform (0,1) random numbers.  It
is not the wisest computation because it is usually Infinity but we
may still want to look at some of the properties.  He used
 determinant <- function(x) prod(eigen(x)$values)
There are many problems with this calculation and I address some of
them in a note to him with a copy to S-news.

I was cross-checking my results in R and came up with the following
peculiar behaviour.  If you use only.values = TRUE in eigen, you get
noticeably different eigenvalues and I don't think it is just a matter
of the ordering of the results.  Their products are noticeably
different.

R : Copyright 1999, The R Development Core Team
Version 0.64.0  (April 8, 1999)

> x <- array( runif( 10000 ), c(100, 100))
> determinant <- function(x) prod(eigen(x)$values)
> det1 <- function(x) prod(eigen(x, only.values = TRUE)$values)
> det2 <- function(x) prod(diag(qr(x)$qr)) * (-1)^(ncol(x) - 1)
> system.time(print(determinant(x)))
[1] -27320631-8.050401e-10i
[1] 0.06 0.04 0.00 0.00 0.00
> system.time(print(det1(x)))
[1] 36072865748-5.155196e-06i
[1] 0.06 0.00 0.00 0.00 0.00
> system.time(print(det2(x)))
[1] -9.854994e+25
[1] 0.03 0.00 0.00 0.00 0.00
> all(eigen(x,only.values=TRUE)$values == eigen(x)$values)
[1] FALSE
> rel.diff <- function(x,y) Mod(x-y)/Mod(x)
> rel.diff(eigen(x,only.values=TRUE)$values, eigen(x)$values)
  [1] 1.395689e-07 1.793713e-04 1.793713e-04 7.604683e-06 7.604683e-06
  [6] 6.027408e-05 6.027408e-05 2.001094e+00 1.887877e+00 2.088785e+00
 [11] 1.889478e+00 1.263914e+00 4.822391e-04 4.822391e-04 1.033824e-13
 [16] 1.582459e-05 1.590463e+00 1.684538e+00 1.861574e+00 1.891079e+00
 [21] 4.260913e-01 1.762078e+00 1.796430e+00 1.483012e+00 5.403557e-01
 [26] 5.403557e-01 1.217432e+00 1.217432e+00 5.188953e-01 5.188953e-01
 [31] 1.621965e+00 1.942157e+00 1.815673e+00 1.625482e+00 1.914144e+00
 [36] 1.914177e+00 1.728506e+00 1.724235e+00 7.271222e-01 7.271222e-01
 [41] 9.928653e-01 1.971190e+00 1.931997e+00 1.920628e+00 1.816204e+00
 [46] 1.946860e+00 1.565290e+00 8.955887e-01 1.924923e+00 1.388633e+00
 [51] 1.960728e+00 1.822560e+00 1.059483e+00 1.585604e+00 1.105094e+00
 [56] 5.622539e-02 5.622539e-02 1.795988e+00 1.846025e+00 1.333497e-01
 [61] 1.418881e+00 1.418881e+00 9.874141e-02 2.524210e-01 1.615536e+00
 [66] 1.195681e+00 1.793995e+00 6.952189e-01 1.268999e-01 1.472427e+00
 [71] 1.446002e+00 1.627224e-01 1.870035e+00 1.888633e+00 1.145509e-01
 [76] 1.625031e-01 1.860097e+00 1.469557e-01 1.438975e+00 1.505856e+00
 [81] 1.955270e+00 1.260539e+00 1.440042e+00 1.575450e-01 1.469263e-01
 [86] 1.769835e+00 1.780567e+00 2.119072e-01 3.139617e-01 2.748911e-01
 [91] 3.652874e-01 2.611222e-01 1.746714e+00 1.345816e-01 1.560194e+00
 [96] 1.225182e+00 2.020903e-01 1.836618e+00 1.962674e+00 9.724950e-16

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Tue Apr 20 18:44:59 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 20 Apr 1999 13:44:59 -0400
Subject: eigenvalue/eigenvector calculations
References: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>
Message-ID: <371CBD1B.A0206ED3@bank-banque-canada.ca>

> was cross-checking my results in R and came up with the following
>peculiar behaviour.  If you use only.values = TRUE in eigen, you get
>noticeably different eigenvalues and I don't think it is just a matter

This might be related to the problem (bad values from eigen) I reported a couple
of weeks ago. I think it was tracked down to a problem in the header files. As I
understand it, the bug has been around for awhile,  but may not always bite -
unless you're using a snapshot where it might be fixed. (I've reverted to 0.63.3
as it didn't seem to cause me a problem there.)

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 20 19:17:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 20 Apr 1999 19:17:07 +0100 (BST)
Subject: eigenvalue/eigenvector calculations
In-Reply-To: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904201914460.13546-100000@auk.stats>

On Tue, 20 Apr 1999, Douglas Bates wrote:

> I was cross-checking my results in R and came up with the following
> peculiar behaviour.  If you use only.values = TRUE in eigen, you get
> noticeably different eigenvalues and I don't think it is just a matter
> of the ordering of the results.  Their products are noticeably
> different.
> 
> R : Copyright 1999, The R Development Core Team
> Version 0.64.0  (April 8, 1999)
> 

That's the problem. On

R : Copyright 1999, The R Development Core Team
Version 0.64.0 Patched (unreleased snapshot) (April 19, 1999)

> all(eigen(x,only.values=TRUE)$values == eigen(x)$values)
[1] TRUE

As the NEWS says:

BUG FIXES

    o   eigen() now should work (again) in all cases.

There is quite a long list of bug fixes in 0.64.0, so I recommend the
R-release version.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Tue Apr 20 22:15:26 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 20 Apr 1999 16:15:26 -0500
Subject: eigenvalue calculations
Message-ID: <6rvher56z5.fsf@verdi.stat.wisc.edu>

I should have remembered that there was a problem with eigen() in
0.64.0.  In the patched versions of R-release (available under
src/devel at the CRAN sites) that bug has been fixed.

In case anyone else is interested, I redid the determinant
calculations in 
 Version 0.64.0 Patched (unreleased snapshot) (April 19, 1999)
using the method from Stephan Steinhaus's script (det0), the method
based on calculating the eigenvalues alone (det1) and the method based
on the QR decomposition (det2).  The results from the three methods
are consistent except that the eigenvalue methods both produce a
non-trivial imaginary component.

I enclose the timing results below.  Notice that the determinant
becomes extremely large as the matrix size increases and that the
error introduced by the complex arithmetic grows with it.

R> det0 <- function(x) prod(eigen(x)$values)
R> det1 <- function(x) prod(eigen(x, only = TRUE)$values)
R> det2 <- function(x) prod(diag(qr(x)$qr))*(-1)^(ncol(x)-1)
R> x1 <- array(runif(100*100), c(100,100))
R> x2 <- array(runif(200*200), c(200,200))
R> x3 <- array(runif(300*300), c(300,300))
R> system.time(print(det0(x1)))
[1] -9.267e+24+912457728i
[1] 1.36 0.00 2.00 0.00 0.00
R> system.time(print(det1(x1)))
[1] -9.267e+24+1041334272i
[1] 0.32 0.00 0.00 0.00 0.00
R> system.time(print(det2(x1)))
[1] -9.267e+24
[1] 0.04 0.00 0.00 0.00 0.00
R> system.time(print(det0(x2)))
[1] -9.4162e+79-1.458e+64i
[1] 10.28  0.00 11.00  0.00  0.00
R> system.time(print(det1(x2)))
[1] -9.4162e+79-2.9602e+64i
[1] 2.7 0.0 3.0 0.0 0.0
R> system.time(print(det2(x2)))
[1] -9.4162e+79
[1] 0.36 0.00 1.00 0.00 0.00
R> system.time(print(det0(x3)))
[1] -5.6519e+145+2.9732e+130i
[1] 34.86  0.01 34.00  0.00  0.00
R> system.time(print(det1(x3)))
[1] -5.6519e+145+9.494e+129i
[1] 10.49  0.00 10.00  0.00  0.00
R> system.time(print(det2(x3)))
[1] -5.6519e+145
[1] 1.49 0.00 1.00 0.00 0.00
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 06:15:17 1999
From: pd@biostat.ku.dk (Peter Dalgaard BSA)
Date: Wed, 21 Apr 1999 07:15:17 +0200
Subject: Bug list summary (automatic post)
Message-ID: <199904210515.HAA09383@biostat.ku.dk>

=================================================
This is an automated summary of the status of the R-bugs
repository.

Note that this may be neither complete nor perfectly
correct at any given instance: Not all bugs are reported,
and some reported bugs may have been fixed, but the
repository not yet updated.

Some bug fixes are difficult to verify because they pertain
to specific hardware or operating system versions. If you
have information to contribute, please do so.

If you happen to know how to fix a problem please send
patches to the bug repository, too.

New bugs are reported either through the web
interface at r-bugs.biostat.ku.dk or via email to
r-bugs@biostat.ku.dk. The bug.report() function can be
used to automate parts of the procedure on many systems.
Followups on older bugs can be done by including the string
"(PR#999)" in the Subject of an email (change 999 to the
actual reference number, of course!).
=================================================

Directory:  Accuracy

* PR# 138 *
Subject: Re: [R] bug? and New bug.
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 10 Mar 1999 17:21:16 +0100

Directory:  Add-ons

* PR# 137 *
Subject: funfits
From: "Alvaro A. Novo" <novo@uiuc.edu>
Date: Tue, 9 Mar 1999 22:24:54 -0600

Directory:  Analyses

none

Directory:  Documentation

* PR# 146 *
Subject: nlm docs
From: Patrick Lindsey <plindsey@alpha.luc.ac.be>
Date: Wed, 24 Mar 1999 15:48:41 +0100 (MET)

Directory:  Graphics

* PR# 38 *
Subject: possible bugs
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Sun, 6 Sep 1998 15:59:34 -0400 (EDT)
--ylim problem which appears solved
--Postscript overflow still with us (22feb99)
* PR# 61 *
Subject: points(...,  cex = ..)  is pretty wrong...
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 2 Nov 1998 19:15:06 +0100
--Symbols getting decentered when too large cex for X. Still there 22feb99  
* PR# 66 *
Subject: Bug with bounding box?
From: johnp@tip.csiro.au
Date: Thu, 3 Dec 1998 02:15:38 +0100
--Yes, this appears to have x/y reversed. The supplied example gives 
--%%Orientation: Landscape
--%%BoundingBox: 18 18 824 577 
--but the convention is to rotate the paper but leave the coordinate system.
* PR# 69 *
Subject: Some graphics bugs
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 04 Dec 1998 11:42:50 -0000 ()
Date: 04-Dec-98
--Various anomalies with text size and alignment. 2B appears to be solved. The 
--rest is still there (22feb99)
* PR# 79 *
Subject: apology: text(locator(),"sometext") works
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Tue, 15 Dec 1998 19:45:29 -0500 (EST)
--Clipping discrepancy x11/PS
* PR# 106 *
Subject: border-arg. in persp
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Fri, 29 Jan 1999 11:12:39 +0100
--No effect of arg. Still here 22feb99. Segfault with border=0 seems gone now. 
* PR# 114 *
Subject: PostScript Level 1/2 bug
From: ben@eno.princeton.edu
Date: Mon, 8 Feb 1999 00:07:20 +0100
--Not sure whether this is really PS lev 1/2 issue.
--/Font5 /Symbol findfont definefont
--(missing scalefont?)
* PR# 120 *
Subject: graphics bug: type="l"
From: Matthew Wiener <mcw@ln.nimh.nih.gov>
Date: Tue, 16 Feb 1999 15:30:25 -0500 (EST)
--X server problem drawing > 64K lines at once. Workaround?
* PR# 123 *
Subject: Text in plot
From: Ennapadam Venkatraman <venkat@biosta.mskcc.org>
Date: Thu, 18 Feb 1999 13:05:37 -0500
--Multiline text not working
* PR# 130 *
Subject: lty=0 -- shouldn't it give an invisible line?
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 28 Feb 1999 21:45:43 +0100
* PR# 149 *
Subject: plot.formula and pch=
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 25 Mar 1999 21:22:44 +0100
* PR# 150 *
Subject: R: error report
From: Adelchi Azzalini <adelchi.azzalini@jrc.it>
Date: Fri, 26 Mar 1999 09:39:05 +0000
* PR# 153 *
Subject: image + x11
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Wed, 31 Mar 1999 14:09:53 +0200

Directory:  In-Out

* PR# 125 *
Subject: scan rejects complex
From: John.Peters@tip.csiro.au (John Peters)
Date: Mon, 22 Feb 1999 10:08:14 +1100 (EST)
* PR# 129 *
Subject: Formatting in formatC and format
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 28 Feb 1999 08:53:34 +0000 (GMT)
--Documentation and ``merge'' of format() and formatC() would be desired - MM

Directory:  Installation

* PR# 95 *
Subject: patch to 63.2
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 15 Jan 1999 11:00:25 +0100 (MET)
--An incident where the 0.63.2 patches didn't take. So far the only one. 
--Maybe caused by patching unclean sources?

Directory:  Language

* PR# 40 *
Subject:  fac1 : fac2 -- fails {no "cross" anymore in seq.c} 
From: maechler@stat.math.ethz.ch
Date: Wed, 16 Sep 1998 08:42:12 +0200
--still there 17feb99
* PR# 85 *
Subject:  A bug in data.entry? 
From: Yusuke Uchiyama <me@naxgul.kais.kyoto-u.ac.jp>
Date: Wed, 23 Dec 1998 11:03:03 GMT
--still there 17feb99
* PR# 89 *
Subject: lapply -- Recall bug
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 6 Jan 1999 15:04:14 +0100
--This is *nasty*.
* PR# 105 *
Subject: an old bug resurfaces
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 29 Jan 1999 08:28:32 +0100 (MET)
--Model formulas. Proper fix probably requires extensive rewrite of model formula
--parser, which would make in non-S-compatible.
* PR# 113 *
Subject: cat data types
From: John Peters <johnp@tip.CSIRO.AU>
Date: Fri, 5 Feb 1999 18:31:52 +1100 (EDT)
--Cannot cat a name. (Docs fixed to reflect this by Kurt, 22feb99)
* PR# 118 *
Subject: Function parsing
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
Date: Wed, 10 Feb 1999 13:42:01 +0000 (GMT)
--comment placement.
* PR# 139 *
Subject: : for factors
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 11 Mar 1999 09:30:04 +0100

Directory:  Low-level

* PR# 37 *
Subject: S.h compatibility issues
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 6 Sep 1998 19:58:47 +0100 (BST)
* PR# 101 *
Subject: Re: [R] Re: R-0.63.2 for Windows - some comments
From: Guido Masarotto <guido@hal.stat.unipd.it>
Date: Fri, 22 Jan 1999 12:40:26 +0100
--This is really about fixed buffer sizes in printutils.c
* PR# 135 *
Subject: summary() of lm() problem
From: Simon Fear <fears@roycastle.liv.ac.uk>
Date: Tue, 9 Mar 1999 13:18:37 -0000 
--lm (?) AND Windows problem;  Win solved (fudged) for 0.63.3
--
--Another low-level buffer-size problem
* PR# 140 *
Subject: rbind dimnames with complex
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:15:14 +0100

Directory:  Misc

* PR# 91 *
Subject: possible bug
From: Rashid Nassar <rnassar@duke.edu>
Date: Sat, 9 Jan 1999 14:50:58 -0500 (EST)
--Remaining issue is whether we can do something more friendly than dumping 
--users into vi?

Directory:  Models

* PR# 121 *
Subject:  model.frame mangles time series 
From: Peter Dalgaard BSA <pd@biostat.ku.dk>
Date: Thu, 18 Feb 1999 15:47:24 +0100
--Subset in C code + attributes = mess
--Switch to interpreted ("[")

Directory:  Startup

* PR# 21 *
Subject: Restoring large image files
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 21 Aug 1998 13:29:16 -0000 ()

Directory:  System-specific

none

Directory:  TooMuchAtOnce

* PR# 53 *
Subject: 0.62.3 bugs, incompatibilities and problems
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 12 Oct 1998 09:43:51 +0200 (MET DST)
* PR# 76 *
Subject: R-0.63.0
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Fri, 11 Dec 1998 23:20:08 -0500 (EST)

Directory:  Windows

none

Directory:  incoming

* PR# 132 *
Subject: Re: [R] zero-offset matrices
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 02 Mar 1999 16:59:48 +0100
* PR# 144 *
Subject: glm throws erroneous(?)'names attribute must be the same length as the vector' 
From: wagman@enteract.com
Date: Thu, 18 Mar 1999 08:58:47 +0100
* PR# 145 *
Subject: R-0.63.3 package on IRIX 6.5 machine
From: Jayshree Sarma <jsarma@cs.gmu.edu>
Date: Tue, 23 Mar 1999 16:54:20 -0500 (EST)
* PR# 148 *
Subject: Missing Warning in :
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 25 Mar 1999 13:34:12 +0100
* PR# 151 *
Subject: problems with formals and get
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 29 Mar 1999 09:29:05 +0200 (MET DST)
* PR# 160 *
Subject: core dump
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Wed, 7 Apr 1999 16:30:39 +0200 (MET DST)
* PR# 163 *
Subject: IRIX compile
From: mtim@farm.ecs.umass.edu
Date: Sat, 10 Apr 1999 19:35:43 +0200
* PR# 164 *
Subject: Re: [R] repeated measurements libraries v0.4
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 11 Apr 1999 22:52:34 +0100 (BST)
* PR# 165 *
Subject: make check
From: Martyn Plummer <plummer@iarc.fr>
Date: Tue, 13 Apr 1999 12:03:42 +0200 (CEST)
* PR# 166 *
Subject: outer fails with group generic operations on factors
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Tue, 13 Apr 1999 18:28:53 +0100 (BST)
* PR# 167 *
Subject: R's UseMethod() does not dispatch on changed class()
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 14 Apr 1999 11:22:10 +0200
* PR# 168 *
Subject: Segfault from evalq(return())
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 16 Apr 1999 14:05:12 +0200
* PR# 169 *
Subject: deparse drops () sometimes
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 16 Apr 1999 14:10:39 +0200
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 21 08:49:03 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 Apr 1999 09:49:03 +0200
Subject: eigenvalue calculations
In-Reply-To: <6rvher56z5.fsf@verdi.stat.wisc.edu> (message from Douglas Bates
 on 20 Apr 1999 16:15:26 -0500)
References: <6rvher56z5.fsf@verdi.stat.wisc.edu>
Message-ID: <199904210749.JAA14072@sophie.ethz.ch>

I've added some hints and the det2() function 
to the help pages (*.Rd) of `eigen' and `qr'.

Martin
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pwhiting@fury.ittc.ukans.edu  Wed Apr 21 12:43:00 1999
From: pwhiting@fury.ittc.ukans.edu (pwhiting@fury.ittc.ukans.edu)
Date: Wed, 21 Apr 1999 13:43:00 +0200
Subject: [MAILER-DAEMON@biostat.ku.dk: Returned mail: /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs] (PR#170)
Message-ID: <199904211143.NAA09587@biostat.ku.dk>


--rwEMma7ioTxnRzrJ
Content-Type: text/plain; charset=us-ascii

at the bottom is a bug report - however I have include the bounce
headers in case you want to fix the mailer too.  This was the
result of an online bug submission via http://r-bugs.biostat.ku.dk/cgi-bin/R.

pete

--rwEMma7ioTxnRzrJ
Content-Type: message/rfc822
Content-Description: Forwarded message from Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>

Return-Path: <>
Received: from stephens.ittc.ukans.edu (stephens.ittc.ukans.edu [129.237.125.220])
	by fury.ittc.ukans.edu (8.8.7/8.8.7) with ESMTP id GAA11879
	for <pwhiting@fury.ittc.ukans.edu>; Wed, 21 Apr 1999 06:35:58 -0500
Received: from gate1.sprintlink.net (gate1.sprintlink.net [199.0.233.2])
	by stephens.ittc.ukans.edu (8.9.1/8.9.1/ITTC-NOSPAM-1.0) with SMTP id GAA17594
	for <pwhiting@ittc.ukans.edu>; Wed, 21 Apr 1999 06:35:45 -0500 (CDT)
Received: from elle.res.sprintlink.net by gate1.sprintlink.net
          via smtpd (for stephens.ittc.ukans.edu [129.237.125.220]) with SMTP; 21 Apr 1999 11:35:45 UT
Received: from gate1dmz0-qe0.res.sprintlink.net (gate1dmz.res.sprintlink.net [199.0.234.1])
	by elle.res.sprintlink.net (8.8.5/8.8.5) with SMTP id HAA13854
	for <pwhiting@sprint.net>; Wed, 21 Apr 1999 07:35:45 -0400 (EDT)
Received: from jay.sprintlink.net ([199.0.233.7]) by gate1dmz0-qe0.res.sprintlink.net
          via smtpd (for elle.res.sprintlink.net [199.0.234.34]) with SMTP; 21 Apr 1999 11:35:45 UT
Received: from biostat.ku.dk (blueberry.kubism.ku.dk [130.225.108.193])
	by jay.sprintlink.net (8.8.5/0.0.0) with ESMTP id HAA19423
	for <pwhiting@sprint.net>; Wed, 21 Apr 1999 07:35:44 -0400 (EDT)
Received: from localhost (localhost)
	by biostat.ku.dk (8.8.7/8.8.7) with internal id NAA09576;
	Wed, 21 Apr 1999 13:37:45 +0200
Date: Wed, 21 Apr 1999 13:37:45 +0200
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
Message-Id: <199904211137.NAA09576@biostat.ku.dk>
To: <pwhiting@sprint.net>
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
	boundary="NAA09576.924694665/biostat.ku.dk"
Subject: Returned mail: /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs
Auto-Submitted: auto-generated (failure)

This is a MIME-encapsulated message

--NAA09576.924694665/biostat.ku.dk

The original message was received at Wed, 21 Apr 1999 13:37:43 +0200
from blueberry.kubism.ku.dk [130.225.108.193]

   ----- The following addresses had permanent fatal errors -----
"|/home/sfe1/r-bugs/bin/new_message Rnew"
    (expanded from: <R-bugs@biostat.ku.dk>)

   ----- Transcript of session follows -----
550 /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs

--NAA09576.924694665/biostat.ku.dk
Content-Type: message/delivery-status

Reporting-MTA: dns; biostat.ku.dk
Received-From-MTA: DNS; blueberry.kubism.ku.dk
Arrival-Date: Wed, 21 Apr 1999 13:37:43 +0200

Final-Recipient: RFC822; r-bugs@biostat.ku.dk
X-Actual-Recipient: RFC822; "|/home/sfe1/r-bugs/bin/new_message Rnew"@biostat.ku.dk
Action: failed
Status: 5.7.1
Last-Attempt-Date: Wed, 21 Apr 1999 13:37:45 +0200

--NAA09576.924694665/biostat.ku.dk
Content-Type: message/rfc822

Return-Path: <pwhiting@sprint.net>
Received: from localhost (blueberry.kubism.ku.dk [130.225.108.193])
	by biostat.ku.dk (8.8.7/8.8.7) with ESMTP id NAA09575
	for <R-bugs@biostat.ku.dk>; Wed, 21 Apr 1999 13:37:43 +0200
Date: Wed, 21 Apr 1999 13:37:43 +0200
From: pwhiting@sprint.net
Message-Id: <199904211137.NAA09575@biostat.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: GConvert error when using pictex

Full_Name: Peter Whiting
Version: 0.64.0
OS: linux
Submission from: (NULL) (168.191.164.23)


I get an error whenever I try to plot a histogram in pictex.
The error doesn't occur for X11 or postscript.

> x<-c(1,2,3)
> pictex()
> hist(x)
Error: Bad units specified in GConvert, please report!

platform   i686-unknown-linux           
arch       i686                         
os         linux                        
system     i686, linux                  
status     Patched (unreleased snapshot)
status.rev 0                            
major      0                            
minor      64.0                         
year       1999                         
month      April                        
day        15                           
language   R                            

pete

--NAA09576.924694665/biostat.ku.dk--

--rwEMma7ioTxnRzrJ--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 13:04:19 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 14:04:19 +0200
Subject: test2 (PR#171)
Message-ID: <199904211204.OAA09626@biostat.ku.dk>


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 13:51:32 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 14:51:32 +0200 (MET DST)
Subject: Test (PR#172)
Message-ID: <199904211251.OAA24086@pubhealth.ku.dk>

Full_Name: Peter D
Version: --
OS: --
Submission from: (NULL) (127.0.0.1)


Trouble with mail config --solved?

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 21 14:20:18 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 21 Apr 1999 15:20:18 +0200
Subject: Test (PR#172)
In-Reply-To: pd@biostat.ku.dk's message of "Wed, 21 Apr 1999 14:51:32 +0200 (MET DST)"
References: <199904211251.OAA24086@pubhealth.ku.dk>
Message-ID: <x2hfqaxg8d.fsf@blueberry.kubism.ku.dk>

pd@biostat.ku.dk writes:

> Full_Name: Peter D
> Version: --
> OS: --
> Submission from: (NULL) (127.0.0.1)
> 
> 
> Trouble with mail config --solved?

OK, the problem seems to be gone now. Sorry for the disturbance.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pwhiting@sprint.net  Wed Apr 21 17:18:48 1999
From: pwhiting@sprint.net (pwhiting@sprint.net)
Date: Wed, 21 Apr 1999 18:18:48 +0200 (MET DST)
Subject: GConvert error when using pictex (PR#173)
Message-ID: <199904211618.SAA26673@pubhealth.ku.dk>


[I'm refiling this one due to mailer config messup]

I get an error whenever I try to plot a histogram in pictex.
The error doesn't occur for X11 or postscript.

> x<-c(1,2,3)
> pictex()
> hist(x)
Error: Bad units specified in GConvert, please report!

platform   i686-unknown-linux           
arch       i686                         
os         linux                        
system     i686, linux                  
status     Patched (unreleased snapshot)
status.rev 0                            
major      0                            
minor      64.0                         
year       1999                         
month      April                        
day        15                           
language   R                            

pete

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Wed Apr 21 17:20:29 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 Apr 1999 09:20:29 -0700 (PDT)
Subject: survival5
In-Reply-To: <199904211602.SAA24704@sophie.ethz.ch>
Message-ID: <Pine.GSO.4.10.9904210907360.13904-100000@wompom.biostat.washington.edu>

A nearly complete port of the new survival5 package has been sent to CRAN
and will soon be appearing on a mirror near you in the contrib/devel
area.

This new package, the successor to survival4, has a more stable likelihood
maximiser for parametric survival models and incorporates penalised
likelihoods for adding smoothing splines, ridge regression, and
(approximately) frailties to survival models. User-defined penalties are
also possible.

It is in the devel area for two reasons

(1) There are some tests I want to run against S-PLUS, and we don't have
survival5 installed for S-PLUS yet.

(2) It calls R internal functions to implement the penalised regression.
The API for these has not been standardised yet and you need to install
the package from an R source tree. 


Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 21 17:28:41 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 21 Apr 1999 18:28:41 +0200
Subject: GConvert error when using pictex (PR#173)
In-Reply-To: pwhiting@sprint.net's message of "Wed, 21 Apr 1999 18:18:48 +0200 (MET DST)"
References: <199904211618.SAA26673@pubhealth.ku.dk>
Message-ID: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>

pwhiting@sprint.net writes:

> [I'm refiling this one due to mailer config messup]
   ^^^

Oops. Me, that is. Whereas it *can* be figured out from the headers, I
probably should have signed that one....

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 21 17:37:58 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 Apr 1999 18:37:58 +0200
Subject: GConvert error when using pictex (PR#173)  (PR#150)
In-Reply-To: <199904211618.SAA26673@pubhealth.ku.dk> (pwhiting@sprint.net)
References: <199904211618.SAA26673@pubhealth.ku.dk>
Message-ID: <199904211637.SAA24863@sophie.ethz.ch>

Thank you for the report!

>>>>> "pwhiting" == pwhiting  <pwhiting@sprint.net> writes:

    pwhiting> I get an error whenever I try to plot a histogram in pictex.
    pwhiting> The error doesn't occur for X11 or postscript.

    pw>> x<-c(1,2,3); pictex() ; hist(x)
    pwhiting> Error: Bad units specified in GConvert, please report!


I believe that your report is just a much more compact example
of the same
bug reported on March 26, by Adelchi Azzalini, report no.150.

By the way:  The [Graphics] section at  http://R-bugs.biostat.ku.dk/
	     has quite a few bugs, some of which should really be addressed
	     rather sooner than later....
	     
I don't think the R-core team has any commitments on working on these,
but I think we should...

Martin
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 18:36:25 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 19:36:25 +0200 (MET DST)
Subject: do.call() mangles expressions in arguments (PR#174)
Message-ID: <199904211736.TAA26994@pubhealth.ku.dk>


> f<-function(x)x
> f(expression(print("Oops")))
expression(print("Oops"))
> do.call("f",list(expression(print("Oops"))))
[1] "Oops"

Something in the do_docall code causes an extra eval of the
argument. Causes trouble with math expressions in labels in 
boxplot (do.call("title",...))

--please do not edit the information below--

Version:
 platform = i586-unknown-linux
 arch = i586
 os = linux
 system = i586, linux
 status = Patched (unreleased snapshot)
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 22
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 21 21:46:41 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 21 Apr 1999 16:46:41 -0400 (EDT)
Subject: make check isn't quite right
In-Reply-To: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>

If I don't build the help pages at the start and then
do make check, 
  the examples for the base man pages get made but not
for any of the packages:

> example("smooth",package="eda")
Error: No help file found for'smooth'
Execution halted



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Wed Apr 21 22:49:39 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 Apr 1999 09:49:39 +1200 (NZST)
Subject: do.call() mangles expressions in arguments (PR#174)
In-Reply-To: <199904211736.TAA26994@pubhealth.ku.dk>
Message-ID: <Pine.BSF.4.05.9904220938180.3355-100000@g.ihaka.slip.auckland.ac.nz>



On Wed, 21 Apr 1999 pd@biostat.ku.dk wrote:

> 
> > f<-function(x)x
> > f(expression(print("Oops")))
> expression(print("Oops"))
> > do.call("f",list(expression(print("Oops"))))
> [1] "Oops"
> 
> Something in the do_docall code causes an extra eval of the
> argument. Causes trouble with math expressions in labels in 
> boxplot (do.call("title",...))

I think this is correct behavior.  The function "list" evaluates its
arguments and when it does the "expression" call gets evaluated.

I think that it is boxplot that needs to be fixed.  There needs to be some
form of quoting for the title (and xlab, ylab arguments).  It isn't
completely obvious to me what the right solution is.  It may require a
redesign of boxplot and bxp.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 00:21:18 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 01:21:18 +0200
Subject: do.call() mangles expressions in arguments (PR#174)
In-Reply-To: Ross Ihaka's message of "Thu, 22 Apr 1999 09:49:39 +1200 (NZST)"
References: <Pine.BSF.4.05.9904220938180.3355-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <x2vhepblw1.fsf@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Wed, 21 Apr 1999 pd@biostat.ku.dk wrote:
> 
> > 
> > > f<-function(x)x
> > > f(expression(print("Oops")))
> > expression(print("Oops"))
> > > do.call("f",list(expression(print("Oops"))))
> > [1] "Oops"
> > 
> > Something in the do_docall code causes an extra eval of the
> > argument. Causes trouble with math expressions in labels in 
> > boxplot (do.call("title",...))
> 
> I think this is correct behavior.  The function "list" evaluates its
> arguments and when it does the "expression" call gets evaluated.

Oh yes! (D**n! I know I decided to take it easy for a few days, but I
seem to have displaced my brain in the process.) 

> I think that it is boxplot that needs to be fixed.  There needs to be some
> form of quoting for the title (and xlab, ylab arguments).  It isn't
> completely obvious to me what the right solution is.  It may require a
> redesign of boxplot and bxp.

Hmm. The following seems to work for the xlabs problem at least:

    for (i in 1:length(pars)) pars[[i]] <- as.call(c(as.name("expression"), 
        pars[[i]]))
    if (plot) {
        bxp(groups, width, varwidth = varwidth, notch = notch,
    ...etc...

(one might want to guard that assignment by an if(is.expression())
thing) 


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Thu Apr 22 04:45:26 1999
From: wvenable@arcola.stats.adelaide.edu.au (wvenable@arcola.stats.adelaide.edu.au)
Date: Thu, 22 Apr 1999 05:45:26 +0200 (MET DST)
Subject: Assigning to a list within a loop (PR#175)
Message-ID: <199904220345.FAA28639@pubhealth.ku.dk>

We noticed this bug in more complex code, but this succinctly
describes the phenomenon.

If you do not re-initialize a each time in the following loop,
the final value only is assigned to all places when the loop is
complete.

> a <- b <- list()
> for(i in 1:5) {
+	a$alpha <- i
+	b[[i]] <- a
+	}
> unlist(b)
alpha alpha alpha alpha alpha 
    5     5     5     5     5 

If a is re-created each time, however the correct behaviour
happens:


> b <- list()
> for(i in 1:5) {
+	  a <- list(alpha = i)
+	  b[[i]] <- a
+	  }
> unlist(b)
alpha alpha alpha alpha alpha 
    1     2     3     4     5 

> version
           _                 
platform   i586-unknown-linux
arch       i586              
os         linux             
system     i586, linux       
status                       
status.rev 0                 
major      0                 
minor      64.0              
year       1999              
month      April             
day        8                 
language   R                 
>

Bill Venables & Berwin Turlach.

-- 
-----------------------------------------------------------------
Bill Venables, Statistician, CMIS Environmetrics Project.

Physical address:                            Postal address:
CSIRO Marine Laboratories,                   PO Box 120,       
233 Middle St, Cleveland, Queensland         Cleveland, Qld, 4163
AUSTRALIA                                    AUSTRALIA

Telephone: +61 7 3826 7251     Email: Bill.Venables@cmis.csiro.au     
      Fax: +61 7 3826 7304

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr 22 07:30:29 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 Apr 1999 08:30:29 +0200 (CEST)
Subject: make check isn't quite right
In-Reply-To: <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>
References: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>
 <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>
Message-ID: <14110.49669.12978.909618@pc87.maho.magnaeu.com>

>>>>> Robert Gentleman writes:

> If I don't build the help pages at the start and then
> do make check, 
>   the examples for the base man pages get made but not
> for any of the packages:

>> example("smooth",package="eda")
> Error: No help file found for'smooth'
> Execution halted

Your observation is correct.  What currently happens is something like

	make R
	for pkg in PKGS; do
	  maybe rebuild pkg examples/help pages
	  try to run the examples
	done

This will fail if the tests for pkg1 assume that pkg2 help/examples must
be there.

We could easily change the `make R' to `make; make help; make examples'
but I am not sure that this is the right thing.  Conceptually, `eda' is
an add-on package and all that must be there is base (Rlang/Rstat), so I
think the example should be changed.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 22 07:45:53 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Thu, 22 Apr 1999 07:45:53 +0100 (BST)
Subject: make check isn't quite right
In-Reply-To: <14110.49669.12978.909618@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.05.9904220736000.4204-100000@auk.stats>

On Thu, 22 Apr 1999, Kurt Hornik wrote:

> >>>>> Robert Gentleman writes:
> 
> > If I don't build the help pages at the start and then
> > do make check, 
> >   the examples for the base man pages get made but not
> > for any of the packages:
> 
> >> example("smooth",package="eda")
> > Error: No help file found for'smooth'
> > Execution halted
> 
> Your observation is correct.  What currently happens is something like
> 
> 	make R
> 	for pkg in PKGS; do
> 	  maybe rebuild pkg examples/help pages
> 	  try to run the examples
> 	done
> 
> This will fail if the tests for pkg1 assume that pkg2 help/examples must
> be there.
> 
> We could easily change the `make R' to `make; make help; make examples'
> but I am not sure that this is the right thing.  Conceptually, `eda' is
> an add-on package and all that must be there is base (Rlang/Rstat), so I
> think the example should be changed.

I think 

-- the example is a nice one for human readers
-- it is a useful test on the codebase (at least one version I created
   of example failed it).

My problem is with

> > Error: No help file found for'smooth'
> > Execution halted

Now if we could keep running, we would get to see _all_ the problems
and be able to ignore those we knew about. 

Alternatively, I could fix the specific case, and make this a warning and
do-nothing condition.  I am inclined to do that anyway. The only
knock-on effect I can see is that some examples call other examples, and if
the included ones are missing then the main example main fail in an
unanticipated way.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Thu Apr 22 13:52:34 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 Apr 1999 14:52:34 +0200 (CEST)
Subject: R on AIX
Message-ID: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>


I tried to build R on AIX and after 2 minor bugfixes everything seems
to work fine except for dynamic loading of code.

In a previous mail I found that Fabrizio Moro succeeded using

	SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg" 

which compiles fine for me, I get also no error messages upon
dynloading, but no symbols are available afterwards, i.e. is.loaded
fails (I tried also with trailing underscores etc.).

Has anybody some experience which flags to use?

I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
compiles but produces incorrect code, i.e., some computations are
wrong).

Make check succeeds until eda :-)

.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu Apr 22 14:04:30 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 Apr 1999 15:04:30 +0200
Subject: R on AIX
In-Reply-To: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at> (message from
 Friedrich Leisch on Thu, 22 Apr 1999 14:52:34 +0200 (CEST))
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>
Message-ID: <199904221304.PAA05194@sophie.ethz.ch>

>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:

    FrL> I tried to build R on AIX and after 2 minor bugfixes everything
    FrL> seems to work fine except for dynamic loading of code.

    FrL> In a previous mail I found that Fabrizio Moro succeeded using

    FrL>   SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg"

    FrL> which compiles fine for me, I get also no error messages upon
    FrL> dynloading, but no symbols are available afterwards,
    FrL> i.e. is.loaded fails (I tried also with trailing underscores
    FrL> etc.).

Yes.  Unfortunately, Fabrizio (nor me) followed up on that mail telling you
that we (Fabrizio and me) ended up with the exact same symptomps as you
have.

I gave up at that time; Fabrizio continues to use S-plus on AIX
(and R on Linux, to some extentes at least)...
... yes a sad story,  but I think we both ended up with the impression that
AIX is half broken environment anyway 
 --- at least if you want to compile software that has no problems at all
     on other architectures...


    FrL> Has anybody some experience which flags to use?

    FrL> I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
    FrL> compiles but produces incorrect code, i.e., some computations are
    FrL> wrong).

    FrL> Make check succeeds until eda :-)

exactly. The first time, dyn.load is needed....

Martin.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr 22 14:20:19 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 Apr 1999 15:20:19 +0200 (CEST)
Subject: R on AIX
In-Reply-To: <199904221304.PAA05194@sophie.ethz.ch>
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>
 <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <14111.8723.93389.159193@pc87.maho.magnaeu.com>

>>>>> Martin Maechler writes:

>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:
FrL> I tried to build R on AIX and after 2 minor bugfixes everything
FrL> seems to work fine except for dynamic loading of code.

FrL> In a previous mail I found that Fabrizio Moro succeeded using

FrL> SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg"

FrL> which compiles fine for me, I get also no error messages upon
FrL> dynloading, but no symbols are available afterwards,
FrL> i.e. is.loaded fails (I tried also with trailing underscores
FrL> etc.).

> Yes.  Unfortunately, Fabrizio (nor me) followed up on that mail telling you
> that we (Fabrizio and me) ended up with the exact same symptomps as you
> have.

> I gave up at that time; Fabrizio continues to use S-plus on AIX
> (and R on Linux, to some extentes at least)...
> ... yes a sad story,  but I think we both ended up with the impression that
> AIX is half broken environment anyway 
>  --- at least if you want to compile software that has no problems at all
>      on other architectures...


FrL> Has anybody some experience which flags to use?

FrL> I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
FrL> compiles but produces incorrect code, i.e., some computations are
FrL> wrong).

FrL> Make check succeeds until eda :-)

> exactly. The first time, dyn.load is needed....

It might help to look into other software for which dynloading works
under AIX.  Three potential examples come to mind:

	Xlisp-stat
	Octave
	Tcl

Anyone willing to have a look?

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 14:19:03 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 15:19:03 +0200
Subject: R on AIX
In-Reply-To: Martin Maechler's message of "Thu, 22 Apr 1999 15:04:30 +0200"
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at> <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <x2r9pchjy0.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> that we (Fabrizio and me) ended up with the exact same symptomps as you
> have.
> 
> I gave up at that time; Fabrizio continues to use S-plus on AIX
> (and R on Linux, to some extentes at least)...
> ... yes a sad story,  but I think we both ended up with the impression that
> AIX is half broken environment anyway 
>  --- at least if you want to compile software that has no problems at all
>      on other architectures...

Have you tried following up on pointers from DejaNews? A quick search
on "aix dynamic link" turned up this one:

---snip
On Tue, 23 Mar 1999 22:44:30 -0000, PaulT <News@ecosmart.demon.co.uk> wrote:

>I am trying to create a 'c' link libary for use with java I'm struggling
>because
>documentation indicates that the -G option should be used with
>cc to create a dynamic library, but it is not available for AIX  v4.

Check the makefile in the /usr/J1.1.6/jni_example/c directory, these contain
the proper command line flags.

-- 
Jens-Uwe Mager  <pgp-mailto:62CFDB25>
---snap


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Thu Apr 22 14:26:01 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Thu, 22 Apr 1999 15:26:01 +0200 (DFT)
Subject: R on AIX
In-Reply-To: <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>

We have R running on AIX (several OS versions between 4.1 and 4.3) and we
are able to load code dynamically. Our solution was essentially developed
by Heiner Schwarte. We use a different version of dynload.c and the linker
is called like this:

  $(F77) -o module.so  \   
           -bM:SRE -bE:module.exp -bnoentry  $(OBJECTS)  $(LIBDIR) $(LIBS)

where module.exp contains all symbols that have to be exported.

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Thu Apr 22 15:21:00 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 Apr 1999 16:21:00 +0200 (CEST)
Subject: R on AIX
In-Reply-To: <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>
References: <199904221304.PAA05194@sophie.ethz.ch>
 <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>
Message-ID: <14111.12364.351689.643342@galadriel.ci.tuwien.ac.at>

>>>>> On Thu, 22 Apr 1999 15:26:01 +0200 (DFT),
>>>>> Arne Kovac (AK) wrote:

AK> We have R running on AIX (several OS versions between 4.1 and 4.3) and we
AK> are able to load code dynamically. Our solution was essentially developed
AK> by Heiner Schwarte. We use a different version of dynload.c and the linker
AK> is called like this:

AK>   $(F77) -o module.so  \   
AK>            -bM:SRE -bE:module.exp -bnoentry  $(OBJECTS)  $(LIBDIR) $(LIBS)

AK> where module.exp contains all symbols that have to be exported.

Have you got modified Makefiles to automate this procedure, i.e.,
create the export file and which libs to include?

What's your `different version of dynload.c'?

.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Thu Apr 22 15:41:54 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Thu, 22 Apr 1999 16:41:54 +0200 (DFT)
Subject: R on AIX
In-Reply-To: <14111.12364.351689.643342@galadriel.ci.tuwien.ac.at>
Message-ID: <Pine.A41.4.02.9904221628420.14640-100000@cauchy.mathematik.uni-essen.de>

On Thu, 22 Apr 1999, Friedrich Leisch wrote:

> Have you got modified Makefiles to automate this procedure, i.e.,
> create the export file and which libs to include?

No, I'm afraid we extend our module.exp every time we write a new
function... Not very convenient, and even worse, adding a new library is
always a pain. But AIX users get used to that...

> What's your `different version of dynload.c'?

I attach it below. I am quite sure that you should be able to compile a
working version of R, if you use AIX 4.2.x and R<=0.63.1. However, I
wouldn't give any promises for AIX 4.3 and/or R 0.64. Recently I reported
on this list about my installation problems and I don't know whether they
are caused by the new OS or R version.

Arne

----------
/*
 *  R : A Computer Langage for Statistical Data Analysis
 *  Copyright (C) 1995  Robert Gentleman and Ross Ihaka
 *  Copyright (C) 1997  The R Core Team
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */


/*  Dynamic Loading Support
 *
 *  This module provides support for run-time loading of shared libraries
 *  access to symbols within such libraries via .C and .Fortran.  This is
 *  done under Unix with dlopen, dlclose and dlsym (the exception is
 *  hpux, where we use compatibility code provided by Luke Tierney.
 *  There are two cases:
 *
 *
 *  1. The dlopen interface is available.
 *
 *  In this case all symbol location is done using the dlopen routines.
 *  We maintain a list of currently loaded shared libraries in an array
 *  called "LoadedDLL" with the number of currenly loaded libraries
 *  being "CountDLL".  To locate a symbol, we probe the loaded libraries
 *  in order until the symbol is located.  If we do not find a symbol
 *  in the loaded libraries, we search the executable itself.  This
 *  search is not very efficient, but this probably pales into
 *  insignificance when compared with the inefficiencies in the R
 *  interpreter.
 *
 *  Loading and unloading of shared libraries is done via the routines
 *  AddDLL and DeleteDLL.  These routines maintain the list of currently
 *  loaded libraries.  When a library is added, any existing reference
 *  to that library are deleted and then the library is inserted at the
 *  start of the search list.  This way, symbols in more recently loaded
 *  libraries are found first.
 *
 *
 *  2. The dlopen interface is not available.
 *
 *  In this case we use the table "CFunTabEntry" to locate functions
 *  in the executable.  We do this by straight linear search through
 *  the table.  Note that the content of the table is created at
 *  system build time from the list in ../appl/ROUTINES.
 */

#include "Defn.h"
#include "Mathlib.h"
#include <string.h>
#include <stdlib.h>
#include <sys/param.h>

typedef int (*DL_FUNC)();
typedef struct {
        char *name;
        DL_FUNC func;
} CFunTabEntry;  
#include "FFDecl.h"
#include "FFDecl.h"

	/* This provides a table of built-in C and Fortran functions */

static CFunTabEntry CFunTab[] =
{
#include "FFTab.h"
        {NULL, NULL}
};      

	/* The following code loads in a compatibility module */
	/* written by Luke Tierney to support S version 4 on */
	/* Hewlett-Packard machines.  The relevant defines are */
	/* set up by autoconfigure */

#ifdef HAVE_DLFCN_H
#include <dlfcn.h>
#else
#ifdef HAVE_DL_H
#include "hpdlfcn.c"
#define HAVE_DLFCN_H
#endif
#endif

#ifdef HAVE_DLFCN_H
#ifndef RTLD_LAZY
#define RTLD_LAZY 1
#endif

struct libhandlelist
{
  void *ptr;
  char *librarypath;
  struct libhandlelist *next;
};

static struct libhandlelist *list = NULL;

static void 
add_ptr (void *p, char *name)
{
  struct libhandlelist *tmp;
  if (p == NULL)
    return;
  tmp = (struct libhandlelist *) malloc (sizeof (struct libhandlelist));
  tmp->ptr = p;
  tmp->librarypath = (char *) malloc (sizeof (char) * (strlen (name) + 1));
  strcpy (tmp->librarypath, name);
  tmp->next = list;
  list = tmp;
}

/* Inserts the specified DLL at the start of the DLL list */
/* All the other entries are "moved down" by one. */
/* Returns 1 if the library was successfully added */
/* and returns 0 if there library table is full or */
/* or if dlopen fails for some reason. */

static int AddDLL(char *path)
{
  void *handle;
  handle = dlopen(path, RTLD_LAZY|RTLD_GLOBAL);
  if(handle == NULL){
	printf("%s\n",dlerror());
    return 0;
}
  add_ptr(handle,path);
  return 1;
}

static void RemoveFromHashTable (void *);

/* Remove the specified DLL from the current DLL list */
/* Returns 1 if the DLL was found and removed from */
/* the list and returns 0 otherwise. */

static int DeleteDLL(char *path)
{
  struct libhandlelist *ptr, *oldptr=NULL;
  ptr = list;
  while (ptr != NULL)
    {
      if (strcmp (ptr->librarypath, path) == 0)
	{
	  RemoveFromHashTable (ptr->ptr);
	  dlclose (ptr->ptr);
	  free (ptr->librarypath);
	  if (list == ptr)
	    list = ptr->next;
	  else
	    oldptr->next = ptr->next;
	  free (ptr);
	  return 1;
	}
      oldptr = ptr;
      ptr = ptr->next;
    }
  return 0;
}

typedef struct HashTabElem
  {
    CFunTabEntry data;
    struct HashTabElem *next;
    void *libraryhandle;
  }
HashTabElem;


/* HashTable stores name - pointer pairs with chaining. Sometimes      */
/* the hashtable  will be expanded and reorganized. The implementation */
/* is entirely elementary.  Possible sizes of the table are 2^p+1      */
/* where p is a positive integer.                                      */

static HashTabElem **HashTable;
static int HASHSIZE;
static int NumberElem;


static int 
HashCode (char *symbol)
{
  unsigned int code = 0;
  char *p = symbol;

  while (*p)
    code = 8 * code + *p++;
  return code % HASHSIZE;
}


static void 
HashInstall (char *name, DL_FUNC func, void *libhandle)
{
  int key;
  HashTabElem *newptr;
  newptr = (HashTabElem *) malloc (sizeof (HashTabElem));
  (newptr->data).name = (char *) malloc (strlen (name) + 1);
  strcpy ((newptr->data).name, name);
  (newptr->data).func = func;
  newptr->libraryhandle = libhandle;
  NumberElem++;
  key = HashCode (name);
  newptr->next = HashTable[key];
  HashTable[key] = newptr;
}


static void 
HashExpand ()
{
  int oldsize;
  int i;
  HashTabElem **OldTable;
  HashTabElem *ptr, *newptr;
  oldsize = HASHSIZE;
  OldTable = HashTable;
  HASHSIZE = 2 * HASHSIZE - 1;
  NumberElem = 0;
  HashTable = (HashTabElem **) malloc (HASHSIZE *
				       sizeof (HashTabElem *));
  for (i = 0; i < HASHSIZE; i++)
    HashTable[i] = NULL;

  for (i = 0; i < oldsize; i++)
    {
      ptr = OldTable[i];
      while (ptr != NULL)
	{
	  HashInstall (ptr->data.name, ptr->data.func, ptr->libraryhandle);
	  newptr = ptr->next;
	  free (ptr->data.name);
	  free (ptr);
	  ptr = newptr;
	}
    }
  free (OldTable);
}

static DL_FUNC 
HashLookup (char *symbol)
{
  int key;
  HashTabElem *ptr;
  key = HashCode (symbol);
  ptr = HashTable[key];
  while (ptr != NULL)
    {
      if (strcmp (symbol, (ptr->data).name) == 0)
	return (ptr->data).func;
      ptr = ptr->next;
    }
  return NULL;
}


static void 
RemoveFromHashTable (void *handle)
{
  int key;
  HashTabElem *ptr, *oldptr=NULL;
  for (key = 0; key < HASHSIZE; key++)
    {
      ptr = HashTable[key];
      while (ptr != NULL)
	{
	  if (ptr->libraryhandle == handle)
	    {
	      if (HashTable[key] == ptr)
		{
		  HashTable[key] = ptr->next;
		  free ((ptr->data).name);
		  free (ptr);
		  ptr = HashTable[key];
		}
	      else
		{
		  oldptr->next = ptr->next;
		  free ((ptr->data).name);
		  free (ptr);
		  ptr = oldptr->next;
		}
	    }
	  else
	    {
	      oldptr = ptr;
	      ptr = ptr->next;
	    }
	}
    }
}



/* findDynProc checks whether one of the libraries    */
/* that have been loaded contains the symbol name and */
/* returns a pointer to that symbol and the library   */ 
/* handle upon success.                               */


DL_FUNC 
findDynProc (char const *name, void **handle)
{
  struct libhandlelist *tmp;
  DL_FUNC fcnptr;
  for (tmp = list; tmp != NULL; tmp = tmp->next)
    {
      /* The following line is not legal ANSI C. */
      /* It is only meant to be used in systems supporting */
      /* the dlopen() interface, in which systems data and  */
      /* function pointers _are_ the same size and _can_   */
      /* be cast without loss of information.              */
      fcnptr = (DL_FUNC) dlsym (tmp->ptr, name);
      if (fcnptr != NULL)
	{
	  *handle = tmp->ptr;
	  return fcnptr;
	}
    }
  return NULL;
}


DL_FUNC R_FindSymbol(char const *name)
{
  char buf[MAXIDSIZE+1];
  DL_FUNC fcnptr=NULL;
  void *libhandle;
  sprintf(buf, "%s", name);
     if (!(fcnptr = HashLookup (buf)))
    {
      if ((fcnptr = findDynProc (buf, &libhandle)))
	{
	  if ((1.0 * NumberElem) / HASHSIZE > 0.5)
	    HashExpand ();
	  HashInstall (buf, fcnptr, libhandle);
	}
    }
if(fcnptr!=NULL)
return fcnptr;
  sprintf(buf, "%s_", name);
  
     if (!(fcnptr = HashLookup (buf)))
    {
      if ((fcnptr = findDynProc (buf, &libhandle)))
	{
	  if ((1.0 * NumberElem) / HASHSIZE > 0.5)
	    HashExpand ();
	  HashInstall (buf, fcnptr, libhandle);
	}
    }

 return fcnptr;
}


void 
InitFunctionHashing ()
{
  int n;
  int i, size = 3;
#ifdef OLD
  NaokSymbol = install ("NAOK");
  DupSymbol = install ("DUP");
#endif
  n = sizeof (CFunTab) / sizeof (CFunTabEntry);
  while (size < n/2 )
    size = 2 * size - 1;
  HASHSIZE = size;
  NumberElem = 0;
  HashTable = (HashTabElem **) malloc (HASHSIZE * sizeof (HashTabElem *));
  for (i = 0; i < HASHSIZE; i++)
    HashTable[i] = NULL;
  for (i = 0; CFunTab[i].name; i++)
    HashInstall (CFunTab[i].name, CFunTab[i].func, NULL);
  HashExpand ();
}


static void GetFullDLLPath(SEXP call, char *buf, char *path)
{
	if(path[0] != '/') {
		if(!getwd(buf))
			errorcall(call, "can't get working directory!\n");
		strcat(buf, "/");
		strcat(buf, path);
	}
	else strcpy(buf, path);
}

	/* do_dynload implements the R-Interface for the */
	/* loading of shared libraries */

SEXP do_dynload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	char buf[2*MAXPATHLEN];
	checkArity(op,args);
	if (!isString(CAR(args)) || length(CAR(args)) < 1)
		errorcall(call, "character argument expected\n");
	GetFullDLLPath(call, buf, CHAR(STRING(CAR(args))[0]));
	DeleteDLL(buf);
	if(!AddDLL(buf))
		errorcall(call, "unable to load shared library \"%s\"\n", buf);
	return R_NilValue;
}

SEXP do_dynunload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	char buf[2*MAXPATHLEN];
	checkArity(op,args);
	if (!isString(CAR(args)) || length(CAR(args)) < 1)
		errorcall(call, "character argument expected\n");
	GetFullDLLPath(call, buf, CHAR(STRING(CAR(args))[0]));
	if(!DeleteDLL(buf))
		errorcall(call, "shared library \"%s\" was not loaded\n", buf);
	return R_NilValue;
}

#else

void InitFunctionHashing()
{
#ifdef OLD
        NaokSymbol = install("NAOK");
        DupSymbol = install("DUP");
#endif
}

DL_FUNC R_FindSymbol(char const *name)
{
	int i;
	for(i=0 ; CFunTab[i].name ; i++)
		if(!strcmp(name, CFunTab[i].name))
			return CFunTab[i].func;
	return (DL_FUNC)0;
}

SEXP do_dynload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	error("no dyn.load support in this R version\n");
}

SEXP do_dynunload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	error("no dyn.load support in this R version\n");
}

#endif



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 22 16:14:51 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 22 Apr 1999 11:14:51 -0400 (EDT)
Subject: Assigning to a list within a loop (PR#175)
In-Reply-To: <199904220345.FAA28639@pubhealth.ku.dk>
Message-ID: <Pine.SV4.4.05.9904221109250.7304-100000@hsph.harvard.edu>



On Thu, 22 Apr 1999 wvenable@arcola.stats.adelaide.edu.au wrote:

> We noticed this bug in more complex code, but this succinctly
> describes the phenomenon.
> 
> If you do not re-initialize a each time in the following loop,
> the final value only is assigned to all places when the loop is
> complete.
> 
> > a <- b <- list()
> > for(i in 1:5) {
> +	a$alpha <- i
> +	b[[i]] <- a
> +	}
> > unlist(b)
> alpha alpha alpha alpha alpha 
>     5     5     5     5     5 
> 
> If a is re-created each time, however the correct behaviour
> happens:
> 
> 
> > b <- list()
> > for(i in 1:5) {
> +	  a <- list(alpha = i)
> +	  b[[i]] <- a
> +	  }
> > unlist(b)
> alpha alpha alpha alpha alpha 
>     1     2     3     4     5 
> 
> > version
>            _                 
> platform   i586-unknown-linux
> arch       i586              
> os         linux             
> system     i586, linux       
> status                       
> status.rev 0                 
> major      0                 
> minor      64.0              
> year       1999              
> month      April             
> day        8                 
> language   R                 
> >
> 
> Bill Venables & Berwin Turlach.
> 
  I think that worse things could happen, the problem seems to be around
 line 1486 of subassign (the first line is missing in the current source)

  1486              if( NAMED(y) ) y = duplicate(y);
  1487              VECTOR(x)[offset] = y;
  1488              break;
  1489

  I think that you need to duplicate y, and have added that line;
  but perhaps what you need to do is to increment NAMED of y(???)
  I'll commit it if Ross doesn't yell too loud

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Thu Apr 22 17:59:44 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Thu, 22 Apr 1999 18:59:44 +0200 (CEST)
Subject: mvfft
Message-ID: <XFMail.990422185944.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Type: text/plain; charset=us-ascii

R-0.64.0 on RedHat Linux 5.1

Some problems with multivariate fast fourier transform. I
have attached the dump of a 30 x 3 matrix that seems to
reliably reproduce these problems

1) mvfft doesn't like vectors. It complains about not having
   enough memory:

R> mvfft(xx[,1])
Error: heap memory (2048 Kb) exhausted [needed 1024 Kb more]
       See "help(Memory)" on how to increase the heap size.

What in fact is happening here is that do_mvfft tries to
get the dimensions of the argument (fourier.c: 125), but 
gets junk instead, since the argument is not an array.

2) mvfft causes a segmentation fault or gets stuck in a loop

R> mvfft(xx)

Program received signal SIGSEGV, Segmentation fault.
0x80d36cb in fftmx (a=0x40617eb0, b=0x40617eb8, ntot=30, n=30, nspan=30, 
    isn=-2, m=3, kt=0, at=0x407c8f58, ck=0x407c8f80, bt=0x407c8fa8, 
    sk=0x407c8fd0, np=0x407c8ee4, nfac=0x8115a78) at fft.c:558
558         bt[j] = b[k1] - b[k2];
(gdb) print bt[j]
Cannot access memory at address 0x407cb000.
(gdb) print kspan
$4 = 0

We're in a loop here where kspan is the increment for k1 and decrement
for k2. The loop breaks when k1 < k2, but somehow kspan is zero.  How it
got there, I can't say, as we're in goto hell at this point.

Martyn

--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Disposition: attachment; filename="dumpdata"
Content-Transfer-Encoding: 7bit
Content-Description: dumpdata
Content-Type: text/plain; charset=us-ascii; name=dumpdata; SizeOnDisk=946

"xx" <-
structure(c(2.80791, 2.92504, 3.02911, 2.85911, 3.28071, 3.43015, 
2.3898, 1.67055, 3.81164, 2.43832, 2.92065, 1.37547, 3.23811, 
2.96203, 2.83998, 2.36596, 3.51832, 2.59301, 3.08633, 2.87675, 
3.16977, 2.81822, 2.48206, 3.28322, 2.51132, 3.01153, 3.25603, 
2.98599, 2.93238, 2.12555, 1.15452, 0.625684, 0.708469, 0.984351, 
0.576846, 0.228625, 1.40307, 1.21012, 0.143615, 1.4046, 1.32799, 
0.0254974, 1.17005, 1.28567, 1.51562, 0.842245, 0.852613, 0.780749, 
0.967637, 0.810536, 0.858167, 0.960625, 0.613509, 1.38389, 1.22199, 
0.93934, 0.479022, 0.684411, 0.907639, 0.694256, 0.637226, 0.698318, 
0.404093, 0.979977, 1.42097, 0.761441, 1.0802, 2.09035, 2.85473, 
2.44305, 1.81988, 1.78082, 1.69385, 0.643862, 1.5311, 0.960032, 
0.69531, 0.821253, 0.49187, 0.394229, 0.806075, 0.557793, 0.694918, 
1.46079, 1.56847, 0.823876, 0.73726, 0.698766, 0.800476, 1.45114
), .Dim = c(30, 3), .Dimnames = list(NULL, c("alpha", "beta", 
"sigma")))

--_=XFMail.1.3.p0.Linux:990422185944:4782=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Thu Apr 22 17:54:53 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Thu, 22 Apr 1999 18:54:53 +0200 (MET DST)
Subject: mvfft (PR#176)
Message-ID: <199904221654.SAA07496@pubhealth.ku.dk>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Type: text/plain; charset=us-ascii

R-0.64.0 on RedHat Linux 5.1

Some problems with multivariate fast fourier transform. I
have attached the dump of a 30 x 3 matrix that seems to
reliably reproduce these problems

1) mvfft doesn't like vectors. It complains about not having
   enough memory:

R> mvfft(xx[,1])
Error: heap memory (2048 Kb) exhausted [needed 1024 Kb more]
       See "help(Memory)" on how to increase the heap size.

What in fact is happening here is that do_mvfft tries to
get the dimensions of the argument (fourier.c: 125), but 
gets junk instead, since the argument is not an array.

2) mvfft causes a segmentation fault or gets stuck in a loop

R> mvfft(xx)

Program received signal SIGSEGV, Segmentation fault.
0x80d36cb in fftmx (a=0x40617eb0, b=0x40617eb8, ntot=30, n=30, nspan=30, 
    isn=-2, m=3, kt=0, at=0x407c8f58, ck=0x407c8f80, bt=0x407c8fa8, 
    sk=0x407c8fd0, np=0x407c8ee4, nfac=0x8115a78) at fft.c:558
558         bt[j] = b[k1] - b[k2];
(gdb) print bt[j]
Cannot access memory at address 0x407cb000.
(gdb) print kspan
$4 = 0

We're in a loop here where kspan is the increment for k1 and decrement
for k2. The loop breaks when k1 < k2, but somehow kspan is zero.  How it
got there, I can't say, as we're in goto hell at this point.

Martyn

--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Disposition: attachment; filename="dumpdata"
Content-Transfer-Encoding: 7bit
Content-Description: dumpdata
Content-Type: text/plain; charset=us-ascii; name=dumpdata; SizeOnDisk=946

"xx" <-
structure(c(2.80791, 2.92504, 3.02911, 2.85911, 3.28071, 3.43015, 
2.3898, 1.67055, 3.81164, 2.43832, 2.92065, 1.37547, 3.23811, 
2.96203, 2.83998, 2.36596, 3.51832, 2.59301, 3.08633, 2.87675, 
3.16977, 2.81822, 2.48206, 3.28322, 2.51132, 3.01153, 3.25603, 
2.98599, 2.93238, 2.12555, 1.15452, 0.625684, 0.708469, 0.984351, 
0.576846, 0.228625, 1.40307, 1.21012, 0.143615, 1.4046, 1.32799, 
0.0254974, 1.17005, 1.28567, 1.51562, 0.842245, 0.852613, 0.780749, 
0.967637, 0.810536, 0.858167, 0.960625, 0.613509, 1.38389, 1.22199, 
0.93934, 0.479022, 0.684411, 0.907639, 0.694256, 0.637226, 0.698318, 
0.404093, 0.979977, 1.42097, 0.761441, 1.0802, 2.09035, 2.85473, 
2.44305, 1.81988, 1.78082, 1.69385, 0.643862, 1.5311, 0.960032, 
0.69531, 0.821253, 0.49187, 0.394229, 0.806075, 0.557793, 0.694918, 
1.46079, 1.56847, 0.823876, 0.73726, 0.698766, 0.800476, 1.45114
), .Dim = c(30, 3), .Dimnames = list(NULL, c("alpha", "beta", 
"sigma")))

--_=XFMail.1.3.p0.Linux:990422185944:4782=_--
End of MIME message

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 22 20:06:05 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 22 Apr 1999 15:06:05 -0400 (EDT)
Subject: options
In-Reply-To: <199904220345.FAA28639@pubhealth.ku.dk>
Message-ID: <Pine.SV4.4.05.9904221440170.7304-100000@hsph.harvard.edu>


 Before I go too far down the wrong track we need to think a little bit
about how "options" is going to behave in a threaded environment. The
reason for this is that S uses "options" to control most of the error
handling.
 I'm sure that we want thread specific behaviour and that seems to imply
that "options" is going to have to be thread specific. Without worrying
about how we are going to achieve that, does anyone have any qualms
about this?
 Duncan has said that in S, when he threaded it, options was a frame 0
object and frame 0 was thread specific. We don't really have frames.
Conceptually it seems that we are going to have to stick an environment
between GlobalEnv and any evaluation envs where that environment 
contains thread specific items (perhaps all assignments along that
thread).


  As for error handling S offers:
    error, interrupt, and warning.expression
  as options. All of which are supposed to be expressions with no
arguments (no free variables I assume) that are evaluated when an
error, an interrupt or a warning occurs (if warning.expression is
non-null then options("warn") is ignored).
  I should get those in today.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 22:55:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 23:55:14 +0200
Subject: options
In-Reply-To: Robert Gentleman's message of "Thu, 22 Apr 1999 15:06:05 -0400 (EDT)"
References: <Pine.SV4.4.05.9904221440170.7304-100000@hsph.harvard.edu>
Message-ID: <x2ogkggw1p.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>  Duncan has said that in S, when he threaded it, options was a frame 0
> object and frame 0 was thread specific. We don't really have frames.
> Conceptually it seems that we are going to have to stick an environment
> between GlobalEnv and any evaluation envs where that environment 
> contains thread specific items (perhaps all assignments along that
> thread).

Hmm. Ross has also been talking about "frame 0" when talking about
attachments to position 1. Does that fit in?

If I get the picture right (I've never tried threads in S), there may
be an alternative where the thread-specific environment sits on top of
the the environment from which the thread is started, rather than
GlobalEnv.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 23 14:33:52 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 23 Apr 1999 09:33:52 -0400 (EDT)
Subject: options and other things
In-Reply-To: <x2ogkggw1p.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904230925260.20965-100000@hsph.harvard.edu>



On 22 Apr 1999, Peter Dalgaard BSA wrote:

> Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> 
> >  Duncan has said that in S, when he threaded it, options was a frame 0
> > object and frame 0 was thread specific. We don't really have frames.
> > Conceptually it seems that we are going to have to stick an environment
> > between GlobalEnv and any evaluation envs where that environment 
> > contains thread specific items (perhaps all assignments along that
> > thread).
> 
> Hmm. Ross has also been talking about "frame 0" when talking about
> attachments to position 1. Does that fit in?
> 
> If I get the picture right (I've never tried threads in S), there may
> be an alternative where the thread-specific environment sits on top of
> the the environment from which the thread is started, rather than
> GlobalEnv.
> 
Brian's comment is correct, only Duncan and John ever played with threaded
S and it currently doesn't work with some high probability (and Duncan
said he didn't think it ever would be publicly available).

I guess what I'm thinking is that all threads get started from GlobalEnv,
but that there has to be an extra thread specific env stuck in right
on top of GlobalEnv and before any evaluation envs (so that thread 
specific info can be handled appropriately).

However, having done a little reading over the past few days I'm a bit
discouraged about how difficult it will be to get this stuff correct.
According to at least one author, threads are hard but they are infinitely
easier than signal catching/exception handling. So making a function
thread-safe is possible (not all C level ones that we use are) making
it reentrant on an asynchronous signal is much more difficult.

I am also coming quickly to the belief that POSIX might be the right
coding standard for R. It at least has some standard stuff for letting
you know (at compile time) what level of thread safety is available in
the C library. 

Does that have bad implications for you and Guido, Brian? I'm a bit
worried because alot of the signal handling is if-def'd for Unix only.
Perhaps it should shift and be if-def'd for the correct level of 
POSIX?

What about the Mac?

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri Apr 23 18:13:32 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 23 Apr 1999 19:13:32 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: <199904220944.LAA10647@gwen.stat.unipd.it.>
References: <199904220944.LAA10647@gwen.stat.unipd.it.>
Message-ID: <199904231713.TAA15277@sophie.ethz.ch>

Dear Prof Azzalini,

You have an interesting example of  recursive use of  uniroot().
    [re-cited at the end]
However, note that R currently has the same problem as S-plus:

Uniroot() doesn't work reliably, recursively.
When you found it to be better, you were just lucky.

The relevant file in R's source,   src/main/optimize.c
says 

   /* WARNING : As things stand, these routines should not be called
    *	     recursively because of the way global variables are used.
    *	     This could be fixed by saving and restoring these global variables.
    */

--------

Fellow R-code developpers :  

       Does anyone of you feel like fixing these?
       Would be really nice and useful!

       (and you will become famous in the R community ... :-)

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum SOL G1;	Sonneggstr.33
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1086			<><

>>>>> "AA" == Adelchi Azzalini <aa@gwen.stat.unipd.it> writes 
      to S-news on 22 Apr 1999 :

    AA> Dear S+ users,

    AA> has anyone experienced problems with uniroot(), in Splus 4.5?  
    AA> In my case, it locates a (non-existing) solution outside the 
    AA> given search interval. The S-news database on Statlib does not
    AA> show anything of this sort.

    AA> In the sample problem below, a root is searched in  the 
    AA> interval ( 0.02418690, 0.07753657), with an existing solution
    AA> near  0.05408. 
    AA> However uniroot comes up with the the answer -0.6160564 (!)

    AA> The code below should reproduce the problem.
    AA> Possibly, the problem is due to the recursive call to uniroot().
    AA> However, R 0.64 produces more sensible answers.

    AA> Regards
    AA> Adelchi Azzalini

    AA> #---------------------------------------------------

    AA> f.dev <- function(mu,y,crit) f.deviance(mu,y,F)-crit

    AA> f.deviance <- function(mu, y, display=F){
    AA> g <- function(x,d) mean(d/(1+x*d))
    AA> epsilon<-(1e-8)
    AA> W<-rep(NA,length=length(mu))
    AA> for(i in 1:length(mu)) {
    AA> d <- (y-mu[i])
    AA> interv<- c(-1/max(d)+epsilon,-1/min(d)-epsilon)
    AA> root <- uniroot(g,interval=interv,d=d) 
    AA> lambda<-root$root
    AA> W[i] <- 2*sum(log(1+lambda*d))
    AA> if(is.na(W[i])| W[i]<0) warning("W<0 or W==NA")
    AA> }
    AA> if(length(mu)>1 & display) plot(mu,W,type="l")
    AA> return(W)
    AA> }

    AA> #-----------------
    AA> #  sample problem:
    AA> #
    AA> y <- c(0.8931869, 0.6805792, 0.8349237, rep(0,97))
    AA> interv <- c( 0.02418690, 0.07753657)
    AA> crit <- 2.705543

    AA> print(f.dev(interv,y,crit))
    AA> # [1] -2.705491  3.881472

    AA> print(f.dev(0.05408, y,crit))
    AA> # [1] -0.0001011083

    AA> uniroot(f.dev, interval=interv, y=y, crit=crit)$root
    AA> # [1] -0.6160564
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgutwin@us.ibm.com  Fri Apr 23 19:08:57 1999
From: pgutwin@us.ibm.com (pgutwin@us.ibm.com)
Date: Fri, 23 Apr 1999 20:08:57 +0200 (MET DST)
Subject: R won't compile on Redhat 5.2 (PR#177)
Message-ID: <199904231808.UAA17927@pubhealth.ku.dk>

Full_Name: Paul Gutwin
Version: R-0.64.0
OS: Redhat 5.2
Submission from: (NULL) (198.133.22.73)


I built a new Linux machine, and was trying to install R on it. I get the
following
message during the build:

make[2]: Entering directory `/usr/src/R-0.64.0/src/nmath'
gcc -g -O2 -I../include -I../../src/include  -c mlutils.c -o mlutils.o
gcc -g -O2 -I../include -I../../src/include  -c d1mach.c -o d1mach.o
gcc: Internal compiler error: program cc1 got fatal signal 6
make[2]: *** [d1mach.o] Error 1
make[2]: Leaving directory `/usr/src/R-0.64.0/src/nmath'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/usr/src/R-0.64.0/src'
make: *** [R] Error 1

I've built R on an older Linux system without trouble.



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 24 00:50:48 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 24 Apr 1999 01:50:48 +0200
Subject: R won't compile on Redhat 5.2 (PR#177)
In-Reply-To: pgutwin@us.ibm.com's message of "Fri, 23 Apr 1999 20:08:57 +0200 (MET DST)"
References: <199904231808.UAA17927@pubhealth.ku.dk>
Message-ID: <x2k8v2dhgn.fsf@blueberry.kubism.ku.dk>

pgutwin@us.ibm.com writes:

> I built a new Linux machine, and was trying to install R on it. I get the
> following
> message during the build:
> 
> make[2]: Entering directory `/usr/src/R-0.64.0/src/nmath'
> gcc -g -O2 -I../include -I../../src/include  -c mlutils.c -o mlutils.o
> gcc -g -O2 -I../include -I../../src/include  -c d1mach.c -o d1mach.o
> gcc: Internal compiler error: program cc1 got fatal signal 6

> I've built R on an older Linux system without trouble.

That looks like a system problem more than anything else. R gets
rebuilt on RedHat 5.2 a couple of times per day, usually. Are you sure
your RAM sticks are seated properly, etc.?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr 25 00:41:04 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 25 Apr 1999 01:41:04 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Martin Maechler's message of "Fri, 23 Apr 1999 19:13:32 +0200"
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch>
Message-ID: <x2yajhh9in.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> Dear Prof Azzalini,
> 
> You have an interesting example of  recursive use of  uniroot().
...
> Fellow R-code developpers :  
> 
>        Does anyone of you feel like fixing these?
>        Would be really nice and useful!
> 
>        (and you will become famous in the R community ... :-)

Well, uniroot calls zeroin which is a FORTRAN routine. As long as this
is the case, all bets are off as to whether or not it will be
reentrant on any given system. In principle, it is not, and FORTRAN
just plain states that "you cannot do that", but if your compiler
happens to be f2c-like, and no global storage is involved, then it
*might* work after all. The example doesn't work on my system either.

The only sensible thing to do to get this to work is to rewite zeroin
in C. According to the comments in the file, it is a transcription of
an Algol60 program, so it is probably not hard to convert it to
another Algol descendant.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From naras@stat.stanford.edu  Mon Apr 26 00:55:36 1999
From: naras@stat.stanford.edu (Balasubramanian Narasimhan)
Date: Sun, 25 Apr 1999 16:55:36 -0700 (PDT)
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Your message of "25 Apr 1999 01:41:04 +0200"
 <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
Message-ID: <19990425165536M.naras@stat.Stanford.EDU>

>>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    Peter> The only sensible thing to do to get this to work is to
    Peter> rewite zeroin in C. According to the comments in the file,
    Peter> it is a transcription of an Algol60 program, so it is
    Peter> probably not hard to convert it to another Algol
    Peter> descendant.

Agreed, but there's no need for a rewrite. A C version has been
available in Netlib for some time.

________________________________________________________________
B. Narasimhan                            naras@stat.stanford.edu
                             http://www-stat.stanford.edu/~naras





-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From adelchi.azzalini@jrc.it  Mon Apr 26 10:12:35 1999
From: adelchi.azzalini@jrc.it (Adelchi Azzalini)
Date: Mon, 26 Apr 1999 10:12:35 +0100
Subject: [S] uniroot -- doesn't work recursively
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch> <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
Message-ID: <37242E03.63BEAB06@jrc.it>

Martin Maechler wrote:

) However, note that R currently has the same problem as S-plus:

) Uniroot() doesn't work reliably, recursively.
) When you found it to be better, you were just lucky.

Right.  I realised later on that R seemed to behave better but 
it could not work properly since it calls a Fortran (66? 77?) routine.
It just happen to produce less obviously wrong answers than Splus.
In fact more tests confirm wrong answers, but not as non-sensical 
as those from Splus.

To get around the problem,  I have replaced  f(x)=0 by f^2(x)=min,
where f(x)is computed with the aid of uniroot(), and the minimization
is solved by optimize(). This works.

Peter Dalgaard BSA wrote:
> 
> Martin Maechler <maechler@stat.math.ethz.ch> writes:
> 
> 
> Well, uniroot calls zeroin which is a FORTRAN routine. As long as this
> is the case, all bets are off as to whether or not it will be
> reentrant on any given system. In principle, it is not, and FORTRAN
> just plain states that "you cannot do that", but if your compiler
> happens to be f2c-like, and no global storage is involved, then it
> *might* work after all. The example doesn't work on my system either.
> 
> The only sensible thing to do to get this to work is to rewite zeroin
> in C. According to the comments in the file, it is a transcription of
> an Algol60 program, so it is probably not hard to convert it to
> another Algol descendant.
> 

My R 0.64 is obtained from the binary file distributed by CRAN in Wien
(compiled by Guido Masarotto?), so I do not know which the compiler is 
used.

Thanks for your comments

Regards
Adelchi Azzalini
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 13:57:21 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 14:57:21 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Balasubramanian Narasimhan's message of "Sun, 25 Apr 1999 16:55:36 -0700 (PDT)"
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU>
Message-ID: <x2r9p7v8su.fsf@blueberry.kubism.ku.dk>

Balasubramanian Narasimhan <naras@stat.stanford.edu> writes:

> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
> 
>     Peter> The only sensible thing to do to get this to work is to
>     Peter> rewite zeroin in C. According to the comments in the file,
>     Peter> it is a transcription of an Algol60 program, so it is
>     Peter> probably not hard to convert it to another Algol
>     Peter> descendant.
> 
> Agreed, but there's no need for a rewrite. A C version has been
> available in Netlib for some time.

Thanks for the pointer, Naras! 

Found, adapted and inserted (in my private source tree for now). It
wasn't a complete drop-in replacement since it didn't support max.iter
and didn't return convergence info, but close enough.

Unfortunately, closer inspection revealed that the Fortran-ness of
zeroin was not the only problem, there's also trouble with global
storage used by the wrapper routine. And since C doesn't have lexical
scoping, that stuff needs to be passed around via arguments. Oh
well...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon Apr 26 14:19:37 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 26 Apr 1999 15:19:37 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: <x2r9p7v8su.fsf@blueberry.kubism.ku.dk> (message from Peter
 Dalgaard BSA on 26 Apr 1999 14:57:21 +0200)
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU> <x2r9p7v8su.fsf@blueberry.kubism.ku.dk>
Message-ID: <199904261319.PAA04686@sophie.ethz.ch>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> Balasubramanian Narasimhan <naras@stat.stanford.edu> writes:
    >> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
    >> writes:
    >> 
    Peter> The only sensible thing to do to get this to work is to rewite
    Peter> zeroin in C. According to the comments in the file, it is a
    Peter> transcription of an Algol60 program, so it is probably not hard
    Peter> to convert it to another Algol descendant.
    >>  Agreed, but there's no need for a rewrite. A C version has been
    >> available in Netlib for some time.

    PD> Thanks for the pointer, Naras!

    PD> Found, adapted and inserted (in my private source tree for now). It
    PD> wasn't a complete drop-in replacement since it didn't support
    PD> max.iter and didn't return convergence info, but close enough.

The max.iter and convergence info are things that Jim Lindsey and I had
ADDED to the original netlib/Fortran code.
It's the ``value-added'' part of the R (vs. S-plus) code...

    PD> Unfortunately, closer inspection revealed that the Fortran-ness of
    PD> zeroin was not the only problem, there's also trouble with global
    PD> storage used by the wrapper routine. And since C doesn't have
    PD> lexical scoping, that stuff needs to be passed around via
    PD> arguments. Oh well...

yes (I think that's what the comment in optimize.c [the wrapper] meant
     that I had cited here...).
and  YES  it would be really nice if that could be done, finally.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 14:27:29 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 15:27:29 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Martin Maechler's message of "Mon, 26 Apr 1999 15:19:37 +0200"
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU> <x2r9p7v8su.fsf@blueberry.kubism.ku.dk> <199904261319.PAA04686@sophie.ethz.ch>
Message-ID: <x2pv4rv7em.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

>     PD> zeroin was not the only problem, there's also trouble with global
>     PD> storage used by the wrapper routine. And since C doesn't have
>     PD> lexical scoping, that stuff needs to be passed around via
>     PD> arguments. Oh well...
> 
> yes (I think that's what the comment in optimize.c [the wrapper] meant
>      that I had cited here...).
> and  YES  it would be really nice if that could be done, finally.

It is done now. (Actually took about as much time as writing the email
griping about it...)

>      uniroot(f.dev, interval=interv, y=y, crit=crit)     
$root
[1] 0.05408745

$f.root
[1] 0.0009728222

$iter
[1] 5

$estim.prec
[1] 6.103516e-05

I'll commit my stuff in a moment.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 15:54:51 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 16:54:51 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Adelchi Azzalini's message of "Mon, 26 Apr 1999 10:12:35 +0100"
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch> <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <37242E03.63BEAB06@jrc.it>
Message-ID: <x2n1zvv3d0.fsf@blueberry.kubism.ku.dk>

Adelchi Azzalini <adelchi.azzalini@jrc.it> writes:

> Martin Maechler wrote:
> 
> ) However, note that R currently has the same problem as S-plus:
> 
> ) Uniroot() doesn't work reliably, recursively.
> ) When you found it to be better, you were just lucky.
> 
> Right.  I realised later on that R seemed to behave better but 
> it could not work properly since it calls a Fortran (66? 77?) routine.
> It just happen to produce less obviously wrong answers than Splus.
> In fact more tests confirm wrong answers, but not as non-sensical 
> as those from Splus.

The development version now has a reentrant uniroot(). Those of you
outside R-core who are interested can get it in the next development
snapshot. (and perhaps remind me what is the proper typecast to avoid
the following error message...)

optimize.c: In function `do_zeroin':
optimize.c:205: warning: passing arg 3 of `zeroin' from incompatible pointer type

Binaries are a bit further into the future, I'm afraid.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Mon Apr 26 17:47:23 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 26 Apr 1999 12:47:23 -0400
Subject: [R] random sequence
References: <0FAS00HIDRIZW5@hermes.ucd.ie>
Message-ID: <3724989B.D57AC481@bank-banque-canada.ca>

>How can I get the same stream of random numbers in R and S?

I'd like to do this too.  I think you need to extract the RNG C code from R and
compile then dynload it into S. If you get it working please let me know.

Thanks,

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 26 18:10:32 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 26 Apr 1999 18:10:32 +0100 (BST)
Subject: [R] random sequence
Message-ID: <199904261710.SAA08747@toucan.stats.ox.ac.uk>

> Date: Mon, 26 Apr 1999 12:47:23 -0400
> From: Paul Gilbert <pgilbert@bank-banque-canada.ca>
> 
> >How can I get the same stream of random numbers in R and S?
> 
> I'd like to do this too.  I think you need to extract the RNG C code from R 
and
> compile then dynload it into S. If you get it working please let me know.


What exactly do you want?  My class exercise is to implement the
Wichmann-Hill algorithm in C/Fortran and use it with S-PLUS! But
while one is at it, why not use a decent generator with both?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Mon Apr 26 21:08:02 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Mon, 26 Apr 1999 16:08:02 -0400 (EDT)
Subject: problems with formals and get (PR#151)
In-Reply-To: <x2d80ruru1.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904261603320.27933-100000@hsph.harvard.edu>

Peter wrote:


jlindsey@alpha.luc.ac.be writes:

> With 0.63.3, try
> 
> test <- function(){
>       fn <- function(a) print("hello")
>       print(is.function(fn))
>       print(names(formals("fn")))}
> test()
> 
> if fn is not quoted in the last line of test, it works properly.

This version of formals seems to work better:

function (fun = sys.function(sys.parent())) 
{
    if (is.character(fun)) 
        fun <- get(fun, mode = "function", envir =
sys.frame(sys.parent()))
    .Internal(formals(fun))
}

> test <- function(){
>       fn <- function() print("hello")
>       formals(fn) <- alist(a=,b=)
>       return(fn)}
> formals(test())
> 
> now try with line 3 of test changed to
>       formals(fn) <- alist(a=)

This is a bug, originating in sys.call:

> xx<-function(...)sys.call()
> xx(a=)
xx()
> xx(a=,b=)
xx(a = , b = )



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~

Bzzt: the bug was in gram.y not in sys.call.
It should be fixed now. If an arg list only had one element and
that element didn't have a default the arglist was being
stripped.

I also committed Peter's improved version of formals.

All this is in the 0.65 (unstable) branch.


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 27 12:52:05 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Tue, 27 Apr 1999 13:52:05 +0200 (CEST)
Subject: mvfft (PR#176)
Message-ID: <XFMail.990427135205.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990427135205:436=_
Content-Type: text/plain; charset=us-ascii

This should fix it.
1) Check that the dimensions are not null.
2) Call fft_factor before each call to fft_work.  The array nfac
   is set by fft_factor and overwritten by fftmx (in src/appl/fft.c,
   called by fft_work). Since nfac is not an argument of fft_work,
   nor of fft_factor it is not easy to spot the bug!

--_=XFMail.1.3.p0.Linux:990427135205:436=_
Content-Disposition: attachment; filename="fourier.diff"
Content-Transfer-Encoding: 7bit
Content-Description: fourier.diff
Content-Type: text/plain; charset=us-ascii; name=fourier.diff; SizeOnDisk=833

diff -uNr R-0.64.0/src/main/fourier.c R-fixed/src/main/fourier.c
--- R-0.64.0/src/main/fourier.c	Fri Feb  5 07:44:44 1999
+++ R-fixed/src/main/fourier.c	Tue Apr 27 12:44:48 1999
@@ -123,7 +123,7 @@
     z = CAR(args);
 
     d = getAttrib(z, R_DimSymbol);
-    if (length(d) > 2)
+    if (d == R_NilValue || length(d) > 2)
 	errorcall(call, "vector-valued series required\n");
     n = INTEGER(d)[0];
     p = INTEGER(d)[1];
@@ -156,9 +156,11 @@
 	    errorcall(call, "fft factorization error\n");
 	work = (double*)R_alloc(4 * maxf, sizeof(double));
 	iwork = (int*)R_alloc(maxp, sizeof(int));
-	for (i = 0; i < p; i++)
+	for (i = 0; i < p; i++) {
+	    fft_factor(n, &maxf, &maxp);
 	    fft_work(&(COMPLEX(z)[i*n].r), &(COMPLEX(z)[i*n].i),
 		     1, n, 1, inv, work, iwork);
+        }
 	vmaxset(vmax);
     }
     UNPROTECT(1);

--_=XFMail.1.3.p0.Linux:990427135205:436=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Tue Apr 27 17:54:48 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 27 Apr 1999 12:54:48 -0400
Subject: ts
Message-ID: <3725EBD8.9C58131C@bank-banque-canada.ca>

ts() is giving me problems on Solaris:

R : Copyright 1999, The R Development Core Team
Version 0.64.0  (April 8, 1999)
...
> z <- ts(matrix(1:20,10,2), start=c(1969,1), frequency=12)
> max(abs(z-z))
Error: invalid time series parameters specified
> traceback()
[1] "max(abs(z - z))"
> max(abs(z+z))
Error: invalid time series parameters specified
>

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Tue Apr 27 18:32:05 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Tue, 27 Apr 1999 19:32:05 +0200 (MET DST)
Subject: Multivariate ts -- arithmetic bug [ for SOME time-series ] (PR#178)
Message-ID: <199904271732.TAA18748@pubhealth.ku.dk>


Paul wrote to R-devel :

    PaulG> ts() is giving me problems on Solaris:
    PaulG> R : Copyright 1999, The R Development Core Team
    PaulG> Version 0.64.0  (April 8, 1999)
    PaulG> ...
    >> z <- ts(matrix(1:20,10,2), start=c(1969,1), frequency=12)
    >> max(abs(z-z))
    PaulG> Error: invalid time series parameters specified
    >> traceback()
    PaulG> [1] "max(abs(z - z))"
    >> max(abs(z+z))
    PaulG> Error: invalid time series parameters specified

This is a SEVERE (new?) bug.

it's already visible as

  > z <- ts(matrix(1:48,ncol=2), start=c(1969,1), frequency=12);  z+z
  Error: invalid time series parameters specified

Note that not all multivariate  ts show the problem; e.g.,

  > data(presidents) # also a multivariate ts
  > p <- presidents
  > p + p
  > 3 * p

all work

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 27 22:38:32 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 27 Apr 1999 23:38:32 +0200
Subject: Multivariate ts -- arithmetic bug [ for SOME time-series ] (PR#178)
In-Reply-To: maechler@stat.math.ethz.ch's message of "Tue, 27 Apr 1999 19:32:05 +0200 (MET DST)"
References: <199904271732.TAA18748@pubhealth.ku.dk>
Message-ID: <x2aevt7nhj.fsf@blueberry.kubism.ku.dk>

maechler@stat.math.ethz.ch writes:


> This is a SEVERE (new?) bug.
> 
> it's already visible as
> 
>   > z <- ts(matrix(1:48,ncol=2), start=c(1969,1), frequency=12);  z+z
>   Error: invalid time series parameters specified

Found and squashed (setting tsp attrib before dims on the result is a
bad idea, since tspgets checks with for consistency with nrows(vec)!).
Committed for 0.64.1.

> 
> Note that not all multivariate  ts show the problem; e.g.,
> 
>   > data(presidents) # also a multivariate ts
>   > p <- presidents
>   > p + p
>   > 3 * p
> 
> all work

Erm. That one isn't multivariate:

> dim(p)
NULL

It's just getting prettyprinted in 4 columns because it happens to be
quarterly data...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Wed Apr 28 16:31:47 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Wed, 28 Apr 1999 17:31:47 +0200 (CEST)
Subject: configure for packages
Message-ID: <14119.10723.632172.658144@galadriel.ci.tuwien.ac.at>


when I get a working connection to auckland again I will commit a new
version of the INSTALL script which allows packages to run configure
befor anything else is done (hence create Makefiles and patch R code
depending on if some lib's are found etc.)

R INSTALL now works as follows:

	cd pkgdir
	if ./configure exists run it
	do everything as has been done until now
	if ./cleanup exists and flag --clean was used, run ./cleanup 

i.e., you can add 2 execs to the top-level directory of a package
which perform pre-installation configuration and post-installation
cleanup. cleanup should remove all files that were created by
configure.

the configure script may be created by autoconf but of course must
not.

I have put a new version of the e1071 package onto CRAN which uses
configure to search for the netpbm library. It currently only looks
for libnetpbm (correct for debian linux sytems). If the functions
pnm_readpnm & friends are contained in another lib on your system,
please let me know such that I can modify configure.in accordingly (or
better: send me the patched version :-))

.f







-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 29 09:48:58 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 29 Apr 1999 10:48:58 +0200 (MET DST)
Subject: Problems with setting .Random.seed (PR#179)
Message-ID: <199904290848.KAA01351@pubhealth.ku.dk>

I have commited fixes for 0.64.1 for

(1) From: Mai Zhou <mai@ms.uky.edu>
> .Random.seed <- c(1, 1:2)
> .Random.seed
[1] 1 1 2
> runif(5)
Warning: Wrong length .Random.seed; forgot initial RNGkind? set to
Wichmann-Hill[1] 0.02253721 0.84832584  ........

Here the length of the seed was being tested before the kind was
picked out, so the length of the previous type was used.

(2) 
> .Random.seed <- c(0, 30269, 30307, 30323)
> runif(1)
[1] 0
> .Random.seed
[1] 0 0 0 0

and it remains zero thereafter.

This was particularly invidious as the help has said (for a long time,
despite my commenting several times, even in the `R Complements')

          The seed, `.Random.seed[-1] == r[1:3]' is an
          integer vector of length 3, where each `r[i]' is
          in `1:p[i]', where `p' is the length 3 vector of
          primes, `p = (30269, 30307, 30323)'. The

This should be (and will be) 1:(p[1] - 1).

(3) The help page now says what the length of the seed is and the
restrictions for the "Marsaglia-Multicarry" and "Super-Duper" kinds
and corrects the description of the latter.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr 29 18:28:33 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 29 Apr 1999 13:28:33 -0400
Subject: another ts problem
Message-ID: <372896C1.862C5EB8@bank-banque-canada.ca>

My previous ts problem is fixed in today's snapshot but ...

R : Copyright 1999, The R Development Core Team
Version 0.64.0 Patched (unreleased snapshot) (April 29, 1999)
...
> z <- ts(matrix(rnorm(300),100,3),start=c(1961,1), frequency=12)
> all(z==z)
Error: invalid time series parameters specified
>

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr 29 19:04:49 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 29 Apr 1999 13:04:49 -0500
Subject: gdb and f77
Message-ID: <6ru2tz5mm6.fsf@verdi.stat.wisc.edu>

I am trying to debug some code that uses the nlm optimizer but with
analytic gradient and hessian.  The optimization code itself is
written in Fortran ($RSRC/src/appl/uncmin.f).  I compiled 
 Version 0.64.0 Patched (unreleased snapshot) (April 29, 1999)
with the -g flag and ran it under gdb.  When I set a breakpoint at
heschk_ I can trace the execution and I can print the values of local
scalar variables or scalar arguments.  When I try to print the values
of array elements I am always getting a segmentation violation, either 
under the automatic choice of language (Fortran) or manually setting
the language to C.

Has anyone had experience with using gdb on Fortran code compiled with 
g77?  If so, can you tell me what syntax I should use to access an
array element.

This is the sort of thing that happens:
 ...
 ) at uncmin.f:1052
 Current language:  auto; currently fortran
 (gdb) set lang c
 Warning: the current language does not match this frame.
 (gdb) p j
 $1 = 1
 (gdb) p udiag
 $2 = (double precision (*)[536870911]) 0x421aee98
 (gdb) p udiag[1]

 Debugger segmentation fault
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 29 20:41:37 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 29 Apr 1999 21:41:37 +0200
Subject: another ts problem
In-Reply-To: Paul Gilbert's message of "Thu, 29 Apr 1999 13:28:33 -0400"
References: <372896C1.862C5EB8@bank-banque-canada.ca>
Message-ID: <x2d80nuscu.fsf@blueberry.kubism.ku.dk>

Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:

> My previous ts problem is fixed in today's snapshot but ...

> > z <- ts(matrix(rnorm(300),100,3),start=c(1961,1), frequency=12)
> > all(z==z)
> Error: invalid time series parameters specified
> >

Pah! Exact same error, but in do_relop (relop.c)... Will fix.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 29 21:14:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 29 Apr 1999 22:14:14 +0200
Subject: another ts problem
In-Reply-To: Peter Dalgaard BSA's message of "29 Apr 1999 21:41:37 +0200"
References: <372896C1.862C5EB8@bank-banque-canada.ca> <x2d80nuscu.fsf@blueberry.kubism.ku.dk>
Message-ID: <x24slzfall.fsf@blueberry.kubism.ku.dk>


> Pah! Exact same error, but in do_relop (relop.c)... Will fix.

..and the patch is this:

diff -c -r1.8.2.1 relop.c
*** /tmp/T0a005Bn       Fri Apr 30 08:03:10 1999
--- relop.c     Fri Apr 30 08:03:10 1999
***************
*** 136,146 ****
      }
  
      PROTECT(x);
-     if (xts || yts) {
-       setAttrib(x, R_TspSymbol, tsp);
-       setAttrib(x, R_ClassSymbol, class);
-       UNPROTECT(2);
-     }
      if (dims != R_NilValue) {
        setAttrib(x, R_DimSymbol, dims);
        if (xnames != R_NilValue)
--- 136,141 ----
***************
*** 154,159 ****
--- 149,159 ----
        else if (length(x) == length(ynames))
            setAttrib(x, R_NamesSymbol, ynames);
      }
+     if (xts || yts) {
+       setAttrib(x, R_TspSymbol, tsp);
+       setAttrib(x, R_ClassSymbol, class);
+       UNPROTECT(2);
+     }
  
      UNPROTECT(4);
      return x;

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr 29 23:09:37 1999
From: bates@stat.wisc.edu (bates@stat.wisc.edu)
Date: Fri, 30 Apr 1999 00:09:37 +0200 (MET DST)
Subject: nlm on a function in the Math group (PR#180)
Message-ID: <199904292209.AAA07303@pubhealth.ku.dk>

If nlm is called with a function in the Math group it causes a
segmentation violation in DispatchGroup.  For example
 R> nlm( sin, -0.5, print.level = 2 )

 Process R segmentation fault at Thu Apr 29 17:10:15 1999

--please do not edit the information below--

Version:
 platform = i686-unknown-linux
 arch = i686
 os = linux
 system = i686, linux
 status = Patched (unreleased snapshot)
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 29
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From J.C.Rougier@durham.ac.uk  Fri Apr 30 09:48:13 1999
From: J.C.Rougier@durham.ac.uk (J.C.Rougier@durham.ac.uk)
Date: Fri, 30 Apr 1999 10:48:13 +0200 (MET DST)
Subject: polygon() help file (PR#181)
Message-ID: <199904300848.KAA08594@pubhealth.ku.dk>

A minor point, but the polygon() help file needs a small amount of
attention (0.63.2).  First, there appears to be no \usage{} line.  Second,
the default is not to leave the border undrawn, as documented, but to draw
the border in par("fg").

Cheers, Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE

"[B]egin upon the precept ... that the things we see are to be 
 weighed in the scale with what we know"  (Meredith, 1879, The Egoist)



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Fri Apr 30 12:39:15 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Fri, 30 Apr 1999 13:39:15 +0200 (MET DST)
Subject: polygon() help file (PR#181)
Message-ID: <199904301139.NAA09111@pubhealth.ku.dk>

>>>>> "JonR" == J C Rougier <J.C.Rougier@durham.ac.uk> writes:

    JonR> A minor point, but the polygon() help file needs a small amount
    JonR> of attention (0.63.2).  First, there appears to be no \usage{}
    JonR> line.  Second, the default is not to leave the border undrawn, as
    JonR> documented, but to draw the border in par("fg").

Done [for 0.64.1],
thanks a lot!

Yes, all of you, please send bug reports even as small as that one to
R-bugs !

Martin

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Fri Apr 30 17:54:31 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Fri, 30 Apr 1999 18:54:31 +0200 (MET DST)
Subject: par help page  errors (PR#182)
Message-ID: <199904301654.SAA09919@pubhealth.ku.dk>

R 0.64.0

In the help page for par(), the parameters "oma"
and "omi" are described as vectors of the form
c(xb, xt, yl, yr)
whereas they are
c(xb,yl,xt,yr)

Martyn

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Thu Apr  1 00:07:40 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu,  1 Apr 1999 11:07:40 +1200 (NZST)
Subject: GC, Disk Storage, etc
In-Reply-To: <Pine.LNX.4.04.9903311441410.14356-100000@localhost>
References: <Pine.LNX.4.04.9903311441410.14356-100000@localhost>
Message-ID: <14082.42975.280157.296729@g.ihaka.slip.auckland.ac.nz>

Gregory R. Warnes writes:
 > 
 > I'm wondering what the plans are for the memory management system.  
 > 
 > Once there is a dynamic memory allocation system in place it would be nice
 > to augment that so that objects which are not currently being used need
 > not be resident in memory.  This way, rarely used objects will not be
 > filling up the memory of the R process.
 > 
 > (Yes, I am thinking about a cross between the current R and S object
 > storage ideas.)
 > 
 > It should be possible to set up an object access system that loads objects
 > on demand, and saves them out to disk when not used using a LRU strategy.
 > 
 > The save to disk could be part of the garbage collection strategy.  Some
 > herusitic like, if we run out of memory, throw all the ojbects we've not
 > used for XXX period of time out to disk.   If there are no such objects,
 > try to increase our available memory.  If that fails, throw things out
 > from least recently used forward.  If we can't manage to satisfy the
 > request using either method, fail the memory allocation and tell the user.
 > 
 > Glancing at the current code, it seems that the hardest part of this would
 > be keeping track of object usage, without imposing excessive overhead.


This is very much what I have in mind, but more for system objects
than user objects.  At startup or when a package is attached, instead
of loading all the objects, we build a list of "promise-to-load"
objects which will load the objects when they are referenced (this is
problematic for closures though because of shared state, but there are
very few if any in the system code).  It would certainly be possible
to time-stamp objects when they are referenced and unload them at gc
time when they have not be referenced for a while.

I'm currently looking at Luke's xlispstat autoload ideas and waiting
the availability of his new garbage collector to see if there might be
better possibilities.

Step one though is to separate the save/restore mechanism from the
garbage collector so that experiments of this type get easier.

	Ross
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From abb@acm.org  Thu Apr  1 03:13:58 1999
From: abb@acm.org (abb@acm.org)
Date: Thu, 1 Apr 1999 04:13:58 +0200
Subject: Makefile fix on Solaris 2.7 (PR#155)
Message-ID: <199904010213.EAA30627@blueberry.kubism.ku.dk>

Full_Name: Andrew Barclay
Version: 0.63.4
OS: Solaris 2.7
Submission from: (NULL) (170.140.252.158)


The Makefile in src/library gets the following error from our Solaris 2.7 make
when making 'docs':
  make: Fatal error: Don't know how to make target `*/man/*.Rd'
  Current working directory R-release/src/library

It doesn't seem to appreciate shell wildcards in the dependencies.
It's been a while since I've done Makefiles, but here are my diffs 
that got it working.  Thanks for such fantastic software!

*** Makefile.original   Wed Mar 31 20:45:50 1999
--- Makefile    Wed Mar 31 20:49:56 1999
***************
*** 15,20 ****
--- 15,21 ----
  PKGS = base eda lqs modreg mva stepfun

  SUBDIRS = profile $(PKGS)
+ RDFILES = $(@echo $(srcdir)/*/man/*.Rd)

  all: Makefile R

***************
*** 37,43 ****
  latex: stamp-latex
  examples: stamp-examples

! stamp-docs: $(srcdir)/*/man/*.Rd $(top_builddir)/library/LibIndex
        @rm -f $@ stamp-help stamp-html stamp-latex stamp-examples
        @echo "Building ALL documentation (help, HTML, LaTeX, R-Examples)"
        @$(MAKE) DOCS
--- 38,44 ----
  latex: stamp-latex
  examples: stamp-examples

! stamp-docs: $(RDFILES) $(top_builddir)/library/LibIndex
        @rm -f $@ stamp-help stamp-html stamp-latex stamp-examples
        @echo "Building ALL documentation (help, HTML, LaTeX, R-Examples)"
        @$(MAKE) DOCS
***************
*** 44,64 ****
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@ stamp-help stamp-html stamp-latex stamp-examples
! stamp-help: $(srcdir)/*/man/*.Rd $(top_builddir)/library/LibIndex
        @rm -f $@
        @OPTS="--nroff" $(MAKE) DOCS
        @touch $@
! stamp-html: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--html"  $(MAKE) DOCS
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@
! stamp-latex: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--latex" $(MAKE) DOCS
        @touch $@
! stamp-examples: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--example" $(MAKE) DOCS
        @touch $@
--- 45,65 ----
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@ stamp-help stamp-html stamp-latex stamp-examples
! stamp-help: $(RDFILES) $(top_builddir)/library/LibIndex
        @rm -f $@
        @OPTS="--nroff" $(MAKE) DOCS
        @touch $@
! stamp-html: $(RDFILES)
        @rm -f $@
        @OPTS="--html"  $(MAKE) DOCS
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@
! stamp-latex: $(RDFILES)
        @rm -f $@
        @OPTS="--latex" $(MAKE) DOCS
        @touch $@
! stamp-examples: $(RDFILES)
        @rm -f $@
        @OPTS="--example" $(MAKE) DOCS
        @touch $@


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr  1 04:55:52 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 1 Apr 1999 05:55:52 +0200
Subject: Makefile fix on Solaris 2.7 (PR#155)
Message-ID: <199904010355.FAA30649@blueberry.kubism.ku.dk>

On Thu, 1 Apr 1999 abb@acm.org wrote:

> Full_Name: Andrew Barclay
> Version: 0.63.4
> OS: Solaris 2.7
> Submission from: (NULL) (170.140.252.158)
> 
> 
> The Makefile in src/library gets the following error from our Solaris 2.7 make
> when making 'docs':
>   make: Fatal error: Don't know how to make target `*/man/*.Rd'
>   Current working directory R-release/src/library
> 
> It doesn't seem to appreciate shell wildcards in the dependencies.
> It's been a while since I've done Makefiles, but here are my diffs 
> that got it working.  Thanks for such fantastic software!

That is an unreleased version, and I guess bug.report() needs to extract a
date for snapshot versions for reports to be useful (if 0.63.4 is genuine).
  
Two comments:
  
1) This has already been changed a couple of days ago, together with the
other places which were giving problems. 0.64.0 (the next release due)
builds and checks correctly for me using Sun 5.x make. (So does the current
0.63.4 snapshot.)                                             

2) If you had read the INSTALL file you would have seen that this was
mentioned _and_ the workaround (use GNU make, not version 3.77) was given.
(The INSTALL file has been changed since to reflect 1.)

As you are into trying pre-release software, please try 0.64 (R-devel) and     
let us know if you have any problems with that.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr  1 04:51:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Thu, 1 Apr 1999 04:51:07 +0100 (BST)
Subject: Makefile fix on Solaris 2.7 (PR#155)
In-Reply-To: <199904010213.EAA30627@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904010449150.25406-100000@auk.stats>

On Thu, 1 Apr 1999 abb@acm.org wrote:

> Full_Name: Andrew Barclay
> Version: 0.63.4
> OS: Solaris 2.7
> Submission from: (NULL) (170.140.252.158)
> 
> 
> The Makefile in src/library gets the following error from our Solaris 2.7 make
> when making 'docs':
>   make: Fatal error: Don't know how to make target `*/man/*.Rd'
>   Current working directory R-release/src/library
> 
> It doesn't seem to appreciate shell wildcards in the dependencies.
> It's been a while since I've done Makefiles, but here are my diffs 
> that got it working.  Thanks for such fantastic software!

That is an unreleased version, and I guess bug.report() needs to extract a
date for snapshot versions for reports to be useful (if 0.63.4 is genuine).
  
Two comments:
  
1) This has already been changed a couple of days ago, together with the
other places which were giving problems. 0.64.0 (the next release due)
builds and checks correctly for me using Sun 5.x make. (So does the current
0.63.4 snapshot.)                                             

2) If you had read the INSTALL file you would have seen that this was
mentioned _and_ the workaround (use GNU make, not version 3.77) was given.
(The INSTALL file has been changed since to reflect 1.)

As you are into trying pre-release software, please try 0.64 (R-devel) and     
let us know if you have any problems with that.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr  1 12:15:01 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 1 Apr 1999 13:15:01 +0200 (CEST)
Subject: PLATFORMS
Message-ID: <14083.21813.762333.384682@pc87.maho.magnaeu.com>

Only three entries thus far.
Please keep them coming in.
-k

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC/FC/MAKE      gcc/egcs-g77/make

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC/FC/MAKE 	egcs/g77/make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC/FC/MAKE	gcc 2.8.1/f77 SC4.2/GNU make
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr  1 15:40:13 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 01 Apr 1999 09:40:13 -0500
Subject: dput / dget
Message-ID: <3703854D.5BE0D95B@bank-banque-canada.ca>

The dump discussion reminded me of a problem I reported early but may not have
been filed as a bug (or may not have been considered a bug):

dput seems to rely on the setting of options()$digits to determine the precision
with which things are written, and the default digits does not seem adequate
(e.g. time series attributes can get truncated enough to make them invalid). A
default for dput of digits=16 would be better.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr  1 18:09:41 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 1 Apr 1999 19:09:41 +0200 (CEST)
Subject: add-on packages
Message-ID: <14083.43093.22882.987965@pc87.maho.magnaeu.com>

It looks like we'll have a 0.64 release by next week.  This should be a
good time for bringing the add-on packages up-to-date as well.  Fixes
should include

* eliminate src-c

* provide complete DESCRIPTION, INDEX and TITLE files with consistent
formatting.  Also please be specific about the copyright/license info.

* provide data indices where applicable (last time I counted, 26 pkgs
had data but only 9 a data index).

The preferred name for the data index is now `00Index' rather than
`index.doc'.  If data files are found but no index, then data() will
give a WARNING when used for listing.

Also, there is now a subdirectory `inst' the contents of which will be
copied recursively (using `cp -r') to the root target dir upon
installation.  This may be useful in particular for copyright info etc
that should be installed along with the package.

It would be great if maintainers could rework their packages
accordingly, which should not be too much effort.  (Includes work for me
too ...)

Thanks,
-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rcreecy@Census.GOV  Thu Apr  1 21:40:48 1999
From: rcreecy@Census.GOV (Rob Creecy)
Date: Thu, 01 Apr 1999 15:40:48 -0500
Subject: GC, Disk Storage, etc
References: <Pine.LNX.4.04.9903311441410.14356-100000@localhost> <14082.42975.280157.296729@g.ihaka.slip.auckland.ac.nz>
Message-ID: <3703D9D0.516FBAE3@census.gov>

Something to keep in mind when designing future memory management
 schemes is that in the not too distant future many machines will
 be 64 bits and have more than 2GB of memory, and it would be nice to be
able
 to fully utilize the available memory. I discovered what seems to be a
current
 limit of 2GB for vector heap size on a DEC ALPHA UNIX 4.0, which fails
 in memory.c doing the malloc for the vector heap when the request is
greater
 than 2GB. I presume this is because address pointers are 32 bits.
 This situation is unfortunate since the machine has 12GB of memory and
I had
 a problem which could have used more than 2GB of memory. I wrote a
FORTRAN
 program instead (which may have been better in the long run anyway)

 I don't have any ideas on how to address this problem, but thought I'd
 raise the issue for your consideration.

Rob 

Ross Ihaka wrote:
> 
> Gregory R. Warnes writes:
>  >
>  > I'm wondering what the plans are for the memory management system.
>  >
>  > Once there is a dynamic memory allocation system in place it would be nice
>  > to augment that so that objects which are not currently being used need
>  > not be resident in memory.  This way, rarely used objects will not be
>  > filling up the memory of the R process.
>  >
>  > (Yes, I am thinking about a cross between the current R and S object
>  > storage ideas.)
>  >
>  > It should be possible to set up an object access system that loads objects
>  > on demand, and saves them out to disk when not used using a LRU strategy.
>  >
>  > The save to disk could be part of the garbage collection strategy.  Some
>  > herusitic like, if we run out of memory, throw all the ojbects we've not
>  > used for XXX period of time out to disk.   If there are no such objects,
>  > try to increase our available memory.  If that fails, throw things out
>  > from least recently used forward.  If we can't manage to satisfy the
>  > request using either method, fail the memory allocation and tell the user.
>  >
>  > Glancing at the current code, it seems that the hardest part of this would
>  > be keeping track of object usage, without imposing excessive overhead.
> 
> This is very much what I have in mind, but more for system objects
> than user objects.  At startup or when a package is attached, instead
> of loading all the objects, we build a list of "promise-to-load"
> objects which will load the objects when they are referenced (this is
> problematic for closures though because of shared state, but there are
> very few if any in the system code).  It would certainly be possible
> to time-stamp objects when they are referenced and unload them at gc
> time when they have not be referenced for a while.
> 
> I'm currently looking at Luke's xlispstat autoload ideas and waiting
> the availability of his new garbage collector to see if there might be
> better possibilities.
> 
> Step one though is to separate the save/restore mechanism from the
> garbage collector so that experiments of this type get easier.
> 
>         Ross
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr  1 23:44:01 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 01 Apr 1999 16:44:01 -0600
Subject: .External interface
Message-ID: <6r90cc0xn2.fsf@verdi.stat.wisc.edu>

There was some mention at the Vienna conference of documenting the
.External interface so the brave could write C code that directly
dealt with SEXP's.  I recently submitted to CRAN/src/contrib/Devel an
add-on to do nonlinear least squares.  That is set up so most of the
work occurs in an nlsModel object which is a list of functions and
their enclosing environment.  Those who think in terms of
object-oriented languages like Java can imagine it to be an instance
of a class.

We would like to write the code that controls the iterations in C -
partially so that implementing things like an algorithm for partially
linear models would be easier.  I need to know how to pass an object
(a list) into a C routine and access the elements, how to force the
evaluation of a function with no arguments, and how to force the
evaluation of a function with a single argument that is a numeric
object.  I presume that I must protect the list that I am passing down
to C so the pointer to that object remains valid after a garbage
collection that may occur during this function evaluation.

I know everyone is busy but a few hints or vague references to look at
the code for ... would help.  Thomas? Robert?
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Fri Apr  2 00:30:45 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Thu, 1 Apr 1999 17:30:45 -0600 (CST)
Subject: .External == .Internal ?
Message-ID: <m10Sqv7-0000X9C@verdi.stat.wisc.edu>

I mentioned the .External interface in my last message.  When I heard
the name, it may have been a joke but I didn't realize that.

Looking through the source code it seems that there are only calls to
.Internal.  I had thought perhaps that .External was a version of
.Internal that could be used with dynamically loaded code.

Am I talking about something that doesn't exist yet and is just in the
planning stages?  (I've got to start paying closer attention in the
R-core meetings.)
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Fri Apr  2 02:03:38 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 1 Apr 1999 17:03:38 -0800 (PST)
Subject: .External == .Internal ?
In-Reply-To: <m10Sqv7-0000X9C@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.10.9904011701530.23400-100000@wompom.biostat.washington.edu>

On Thu, 1 Apr 1999, Douglas Bates wrote:

> I mentioned the .External interface in my last message.  When I heard
> the name, it may have been a joke but I didn't realize that.
> 
> Looking through the source code it seems that there are only calls to
> .Internal.  I had thought perhaps that .External was a version of
> .Internal that could be used with dynamically loaded code.
> 
> Am I talking about something that doesn't exist yet and is just in the
> planning stages?  (I've got to start paying closer attention in the
> R-core meetings.)


No, it's there in R0.64, it just hasn't been used for anything yet.  The
code was sent in to R-devel a few months ago and I added it a few weeks
ago.

The idea is exactly to be able to call dynamically loaded routines in a
similar way to .Internal.

	-thomas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  2 05:35:30 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 2 Apr 1999 16:35:30 +1200 (NZST)
Subject: X11 Device Driver
Message-ID: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>

I have made some modifications to the X11 graphics driver so that it is
more flexible about its use of colors.  I have added a new parameter to
the X11/x11 function which controls this.  The parameter is currently
called "colormodel" and works as follows:

	colormodel = 0		Monochrome graphics
	colormodel = 1		Grayscale (256 shades)
	colormodel = 2		Pseudocolor1
	colormodel = 3		Pseudocolor2
	colormodel = 4		Truecolor

Pseudocolor1 allocates as big a color cube as possible and then
approximates requested colors with colors from the cube.

Pseudocolor2 allocates colors "on-demand" until it runs out of
colors.  You then get a "can't allocate colors" error message.

More sophisticated devices will support the color models of less
sophisticated devices.  E.g. you can do grey-scale and pseudocolor
on a truecolor device.

So, one question is:  How should this functionality be packaged?

One possibility is to have multiple X11 device driver entry points

    X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color

This would be useful because people could use options() to set
the appropriate default device.

Another possibility would be to have use an additional argument to
the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

Perhaps there are better ideas also.

A second question is what should the default behavior be on Pseudocolor
devices; Pseudocolor1 or Pseudocolor2?

Would anyone care to express an opinion.  I'd like to get this commited
for the 0.64 release.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  2 06:38:09 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 2 Apr 1999 06:38:09 +0100 (BST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.05.9904020632260.28106-100000@auk.stats>

On Fri, 2 Apr 1999, Ross Ihaka wrote:

> I have made some modifications to the X11 graphics driver so that it is
> more flexible about its use of colors.  I have added a new parameter to
> the X11/x11 function which controls this.  The parameter is currently
> called "colormodel" and works as follows:
> 
> 	colormodel = 0		Monochrome graphics
> 	colormodel = 1		Grayscale (256 shades)
> 	colormodel = 2		Pseudocolor1
> 	colormodel = 3		Pseudocolor2
> 	colormodel = 4		Truecolor
> 
> Pseudocolor1 allocates as big a color cube as possible and then
> approximates requested colors with colors from the cube.
> 
> Pseudocolor2 allocates colors "on-demand" until it runs out of
> colors.  You then get a "can't allocate colors" error message.
> 
> More sophisticated devices will support the color models of less
> sophisticated devices.  E.g. you can do grey-scale and pseudocolor
> on a truecolor device.
> 
> So, one question is:  How should this functionality be packaged?
> 
> One possibility is to have multiple X11 device driver entry points
> 
>     X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color
> 
> This would be useful because people could use options() to set
> the appropriate default device.
> 
> Another possibility would be to have use an additional argument to
> the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

I would prefer a single driver, with (effectively)

X11(display = "", width = 7, height = 7, pointsize = 12, 
    colortype=options()$X11colortype)

and choosing type from "mono", "gray", "pseudo.cube", "pseudo", "true"
as appropriate.

> A second question is what should the default behavior be on Pseudocolor
> devices; Pseudocolor1 or Pseudocolor2?

Pseudocolor2, please.  I very rarely have a problem (but then I have
netscape and gs under control).

> Would anyone care to express an opinion.  I'd like to get this commited
> for the 0.64 release.

Yes, please.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  2 07:42:55 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 2 Apr 1999 08:42:55 +0200 (CEST)
Subject: PLATFORMS Update
Message-ID: <14084.26351.552385.308376@pc87.maho.magnaeu.com>

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC/FC/MAKE 	egcs/g77/make

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC/FC/MAKE      gcc/egcs-g77/make

NAME		Göran Broström
EMAIL		gb@stat.umu.se
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.2
CC/FC/MAKE      gcc/egcs-g77/make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 5.3 / 6.0
CC/FC/MAKE      egcs/g77/make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC/FC/MAKE      gcc/egcs-g77/make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        alpha-dec-osf4.0
SYSTEM          Digital Unix 4.0E
CC/FC/MAKE      cc/f77/GNUmake

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      cc SC4.2/f77 SC4.2/GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      egcs 1.1 gcc/f77 GNU make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC/FC/MAKE	gcc 2.8.1/f77 SC4.2/GNU make

NAME       	Göran Broström
EMAIL      	gb@stat.umu.se
VERSION    	0.63.3
PLATFORM   	sun-sparc-linux
SYSTEM     	Redhat 5.2
CC/FC/MAKE 	egcs/egcs-g77/make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/(Sun)make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/GNU make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.64
PLATFORM        hppa2.0
SYSTEM          hpux10.20
CC/FC/MAKE      egcs/f2c/(gnu)make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      cc SC4.2/f77 SC4.2/Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      egcs 1.1 gcc/egcs 1.1 f77/GNU make
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Fri Apr  2 08:05:47 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Fri, 2 Apr 1999 09:05:47 +0200 (CEST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
References: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <14084.27723.882357.562231@galadriel.ci.tuwien.ac.at>

>>>>> On Fri, 2 Apr 1999 16:35:30 +1200 (NZST),
>>>>> Ross Ihaka (RI) wrote:

RI> I have made some modifications to the X11 graphics driver so that it is
RI> more flexible about its use of colors.  I have added a new parameter to
RI> the X11/x11 function which controls this.  The parameter is currently
RI> called "colormodel" and works as follows:

RI> 	colormodel = 0		Monochrome graphics
RI> 	colormodel = 1		Grayscale (256 shades)
RI> 	colormodel = 2		Pseudocolor1
RI> 	colormodel = 3		Pseudocolor2
RI> 	colormodel = 4		Truecolor

RI> Pseudocolor1 allocates as big a color cube as possible and then
RI> approximates requested colors with colors from the cube.

don't know if that's possible, but how hard would it be to optionally
limit the size of the cube? I have something in mind like only
allowing 64 colors or whatever to be able to start other applications
(and leaving them some room in the colormap) after R has started.

Netscape.maxImageColors worked always fine for me ...


.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  2 08:27:56 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 2 Apr 1999 19:27:56 +1200 (NZST)
Subject: X11 Device Driver
In-Reply-To: <14084.27723.882357.562231@galadriel.ci.tuwien.ac.at>
Message-ID: <Pine.BSF.3.96.990402192506.6514A-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 2 Apr 1999, Friedrich Leisch wrote:

> RI> Pseudocolor1 allocates as big a color cube as possible and then
> don't know if that's possible, but how hard would it be to optionally
> limit the size of the cube? I have something in mind like only
> allowing 64 colors or whatever to be able to start other applications
> (and leaving them some room in the colormap) after R has started.
> 
> Netscape.maxImageColors worked always fine for me ...

It'll be easy enough to add a maxcolors= argument, with a
default of 256.

Any other requests from anyone while I'm at it?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Fri Apr  2 10:16:27 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Fri, 2 Apr 1999 11:16:27 +0200 (CEST)
Subject: legends of barplots
Message-ID: <14084.35563.482242.1349@galadriel.ci.tuwien.ac.at>



is there a hidden reason why the legend in barplot is in reverse order
(i.e. from bottom to top?). if nobody cares I would change it to the
usual top to bottom.

and while I'm at it: wouldn't it be more natural if in a horizontal
barplot things are also sorted from top to bottom?

.f

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  2 12:14:46 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 02 Apr 1999 13:14:46 +0200
Subject: PLATFORMS Update
In-Reply-To: Kurt Hornik's message of "Fri, 2 Apr 1999 08:42:55 +0200 (CEST)"
References: <14084.26351.552385.308376@pc87.maho.magnaeu.com>
Message-ID: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>

Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

> 
> NAME       	Göran Broström
> EMAIL      	gb@stat.umu.se
> VERSION    	0.63.3
> PLATFORM   	sun-sparc-linux
> SYSTEM     	Redhat 5.2
> CC/FC/MAKE 	egcs/egcs-g77/make
                ^^^^
Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  2 12:37:22 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 2 Apr 1999 12:37:22 +0100 (BST)
Subject: PLATFORMS Update
In-Reply-To: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>

On 2 Apr 1999, Peter Dalgaard BSA wrote:

> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> 
> > 
> > NAME       	Göran Broström
> > EMAIL      	gb@stat.umu.se
> > VERSION    	0.63.3
> > PLATFORM   	sun-sparc-linux
> > SYSTEM     	Redhat 5.2
> > CC/FC/MAKE 	egcs/egcs-g77/make
>                 ^^^^
> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

Note: sun-sparc, and Peter once told me that has nothing to do
with the compiler on Intel.

This makes me say what I thought of earlier: would be it be a good
idea for Kurt to ask those people who used gcc/egcs to give us a
version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
not install by default) so it would be very easy to have a grabbed
a later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version
in use here).


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  2 13:00:53 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 2 Apr 1999 14:00:53 +0200 (CEST)
Subject: PLATFORMS Update
In-Reply-To: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
References: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
 <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
Message-ID: <14084.45429.23176.961539@pc87.maho.magnaeu.com>

>>>>> Prof Brian D Ripley writes:

> On 2 Apr 1999, Peter Dalgaard BSA wrote:
>> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
>> 
>> > 
>> > NAME       	Göran Broström
>> > EMAIL      	gb@stat.umu.se
>> > VERSION    	0.63.3
>> > PLATFORM   	sun-sparc-linux
>> > SYSTEM     	Redhat 5.2
>> > CC/FC/MAKE 	egcs/egcs-g77/make
>> ^^^^
>> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
>> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

> Note: sun-sparc, and Peter once told me that has nothing to do
> with the compiler on Intel.

> This makes me say what I thought of earlier: would be it be a good
> idea for Kurt to ask those people who used gcc/egcs to give us a
> version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
> not install by default) so it would be very easy to have a grabbed a
> later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version in
> use here).

Yes it would be a good idea.

Ideally we should have something like

	CC	gcc 2.7.2.3
	FC	egcs-2.90.29 980515 (egcs-1.0.3 release)
	MAKE	GNU make 3.76.1

which would be my current setup.

Brian suggested this morning to redo PLATFORMS as follows:  first an
intro part like

0.63.3:
  Linux:
    i386	Debian 1.3, 2.0, Red Hat 4.0, 5.0, 5.2, SuSe 6.0
    ppc		LinuxPPC 4
    alpha	xxx
  FreeBSD 2.2.5
  SGI Irix 6.2
  Sun Solaris (Sparc) 2.5.1, 2.6, 2.7
  DEC Alpha (OSF4)

and then simply append the new-style database for detailed info.

Maybe I should then split CC/FC/MAKE as above.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  2 15:40:51 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 02 Apr 1999 16:40:51 +0200
Subject: PLATFORMS Update
In-Reply-To: Prof Brian D Ripley's message of "Fri, 2 Apr 1999 12:37:22 +0100 (BST)"
References: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
Message-ID: <x21zi313ws.fsf@blueberry.kubism.ku.dk>

Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

> On 2 Apr 1999, Peter Dalgaard BSA wrote:
> 
> > Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> > 
> > > 
> > > NAME       	Göran Broström
> > > EMAIL      	gb@stat.umu.se
> > > VERSION    	0.63.3
> > > PLATFORM   	sun-sparc-linux
> > > SYSTEM     	Redhat 5.2
> > > CC/FC/MAKE 	egcs/egcs-g77/make
> >                 ^^^^
> > Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> > 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?
> 
> Note: sun-sparc, and Peter once told me that has nothing to do
> with the compiler on Intel.

Argh. Saw RedHat, implied Intel... Sorry. 

Yes, the bug is very system-dependent -- doesn't even affect the
windows-i386 egcs compiler (not in that spot anyway) since it doesn't
inline the same routines.

> This makes me say what I thought of earlier: would be it be a good
> idea for Kurt to ask those people who used gcc/egcs to give us a
> version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
> not install by default) so it would be very easy to have a grabbed
> a later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version
> in use here).

Agreed. Optimization levels too?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From gb@stat.umu.se  Fri Apr  2 15:39:37 1999
From: gb@stat.umu.se (Goran Brostrom)
Date: Fri, 2 Apr 1999 16:39:37 +0200 (CEST)
Subject: PLATFORMS Update
In-Reply-To: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.LNX.4.10.9904021633230.4028-100000@capa.stat.umu.se>

On 2 Apr 1999, Peter Dalgaard BSA wrote:

> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> 
> > 
> > NAME       	Göran Broström
> > EMAIL      	gb@stat.umu.se
> > VERSION    	0.63.3
> > PLATFORM   	sun-sparc-linux
> > SYSTEM     	Redhat 5.2
> > CC/FC/MAKE 	egcs/egcs-g77/make
>                 ^^^^
> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?
> 

1. It seems as if the redhat 5.2 sparc only has egcs. Because
   a) /usr/bin/egcs and /usr/bin/gcc are identical.
   b) gcc -v:
Reading specs from /usr/lib/gcc-lib/sparc-redhat-linux/egcs-2.90.29/specs
gcc version egcs-2.90.29 980515 (egcs-1.0.3 release)

   This is different from the i386 version, where:
[gb@localhost gb]$ gcc -v
Reading specs from /usr/lib/gcc-lib/i386-redhat-linux/2.7.2.3/specs
gcc version 2.7.2.3
[gb@localhost gb]$ diff /usr/bin/egcs /usr/bin/gcc
Binary files /usr/bin/egcs and /usr/bin/gcc differ

2. It completes "make check".

Göran
--------------------------------------------------------------
 Göran Broström
 Department of Statistics              tel: +46 90 786-5223
 Umeå University                       fax: +46 90 786-6614
 S-90187 Umeå, Sweden               e-mail:  gb@stat.umu.se

 http://www.stat.umu.se/~gb          ftp://capa.stat.umu.se
--------------------------------------------------------------

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Fri Apr  2 18:07:32 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 2 Apr 1999 09:07:32 -0800 (PST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.10.9904020905040.27714-100000@wompom.biostat.washington.edu>

On Fri, 2 Apr 1999, Ross Ihaka wrote:

> 
> So, one question is:  How should this functionality be packaged?
>\ 
> One possibility is to have multiple X11 device driver entry points
> 
>     X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color
> 
> This would be useful because people could use options() to set
> the appropriate default device.
> 
> Another possibility would be to have use an additional argument to
> the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

I'd prefer this one 


> Perhaps there are better ideas also.
> 
> A second question is what should the default behavior be on Pseudocolor
> devices; Pseudocolor1 or Pseudocolor2?

I would go for allocating colors on demand, especially if we can print out
a message suggesting the color cube driver when colors run out.

	-thomas


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jean@stat.ubc.ca  Fri Apr  2 22:58:54 1999
From: jean@stat.ubc.ca (Jean Meloche)
Date: Fri, 02 Apr 1999 21:58:54 +0000
Subject: patch against overflows in saveload.c
Message-ID: <37053D9E.BC882FC8@stat.ubc.ca>

This is a multi-part message in MIME format.
--------------3F9F11E6B00532CFDD5A424A
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

R fails to save long strings... (with xdr)

> str<-''; for(i in c(0:1000)) str<-paste(str,'a')
> q(save='yes')
Error: a write error occured
>

This was noticed a while ago and someone
suggested a large fixed sized buffer.

The attached patch allocates a buffer as needed
using malloc. I know R has ist own allocation
mechanism but I figured malloc was ok for
such short-lived buffers.

If not, please let me know how to do it properly.

--
Jean Meloche
--------------3F9F11E6B00532CFDD5A424A
Content-Type: text/plain; charset=us-ascii;
 name="sl.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="sl.diff"

--- saveload.c	Tue Feb 16 09:15:59 1999
+++ /usr/local/R-0.63.3/src/main/saveload.c	Fri Apr  2 13:25:42 1999
@@ -1,7 +1,6 @@
 /*
  *  R : A Computer Language for Statistical Data Analysis
  *  Copyright (C) 1995, 1996  Robert Gentleman and Ross Ihaka
- *  Copyright (C) 1997--1999  Robert Gentleman, Ross Ihaka and the R Core Team
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -61,7 +60,7 @@
 static int	(*InInteger)(FILE*);
 static double	(*InReal)(FILE*);
 static complex	(*InComplex)(FILE*);
-static char*	(*InString)(FILE*);
+static char*	(*InString)(FILE*,int,char *);
 static void	(*InTerm)(FILE*);
 
 
@@ -195,7 +194,7 @@
     fputc('\"', fp);
 }
 
-static char *AsciiInString(FILE *fp)
+static char *AsciiInString(FILE *fp, int len, char *buf)
 {
     int c;
     bufp = buf;
@@ -346,16 +345,17 @@
 
 static void XdrOutString(FILE *fp, char *s)
 {
-    if (!xdr_string(&xdrs, &s, MAXELTSIZE - 1)) {
+    if (!xdr_string(&xdrs, &s, strlen(s))) {
 	xdr_destroy(&xdrs);
 	error("a write error occured\n");
     }
 }
 
-static char *XdrInString(FILE *fp)
+static char *XdrInString(FILE *fp, int len, char *buf)
 {
-    char *bufp = buf;
-    if (!xdr_string(&xdrs, &bufp, MAXELTSIZE - 1)) {
+    char *bufp;
+    bufp=buf;
+    if (!xdr_string(&xdrs, &bufp, len)) {
 	xdr_destroy(&xdrs);
 	error("a read error occured\n");
     }
@@ -439,7 +439,7 @@
 	error("a write error occured\n");
 }
 
-static char *BinaryInString(FILE *fp)
+static char *BinaryInString(FILE *fp, int len, char *buf)
 {
     bufp = buf;
     do {
@@ -705,6 +705,8 @@
 		OutSpace(fp);
 		OutInteger(fp, NodeToOffset(&R_NHeap[i]));
 		OutSpace(fp);
+		OutInteger(fp, strlen(CHAR(PRINTNAME(&R_NHeap[i]))));
+		OutSpace(fp);
 		OutString(fp, CHAR(PRINTNAME(&R_NHeap[i])));
 		OutNewline(fp);
 		k++;
@@ -737,7 +739,6 @@
     for (i = 0; i < R_NSize; i++) {
 	if (MARK(&R_NHeap[i])) {
 	    if (TYPEOF(&R_NHeap[i]) != SYMSXP) {
-
 		OutInteger(fp, n);
 		OutSpace(fp);
 		OutInteger(fp, TYPEOF(&R_NHeap[i]));
@@ -845,6 +846,7 @@
 {
     unsigned int j;
     int len;
+    char *buf;
 
     TYPEOF(s) = InInteger(fp);
 
@@ -887,12 +889,16 @@
     case SPECIALSXP:
     case BUILTINSXP:
 	len = InInteger(fp);
-	PRIMOFFSET(s) = StrToInternal(InString(fp));
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	PRIMOFFSET(s) = StrToInternal(InString(fp, len, buf));
+	free(buf);
 	break;
     case CHARSXP:
 	LENGTH(s) = len = InInteger(fp);
 	ReallocString(s, len);
-	strcpy(CHAR(s), InString(fp));
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	strcpy(CHAR(s), InString(fp, len, buf));
+	free(buf);
 	break;
     case REALSXP:
 	LENGTH(s) = len = InInteger(fp);
@@ -956,9 +962,14 @@
     /* computing the forwarding addresses */
 
     for (i = 0 ; i < NSymbol ; i++) {
+	char *buf;
+	int len;
 	j = InInteger(fp);
 	OldOffset[j] = InInteger(fp);
-	NewAddress[j] = install(InString(fp));
+	len = InInteger(fp);
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	NewAddress[j] = install(InString(fp,len,buf));
+	free(buf);
     }
 
     /* symbols are all installed */
@@ -1074,7 +1085,7 @@
 	TAG(t) = install(CHAR(STRING(CAR(args))[j]));
 	CAR(t) = findVar(TAG(t), R_GlobalContext->sysparent);
 	if (CAR(t) == R_UnboundValue)
-            error("Object \"%s\" not found\n", CHAR(PRINTNAME(TAG(t))));
+	    error("Object \"%s\" not found\n", CHAR(PRINTNAME(TAG(t))));
     }
 
     R_SaveToFile(s, fp, INTEGER(CADDR(args))[0]);
@@ -1811,12 +1822,12 @@
 do_hdf5save (SEXP call, SEXP op, SEXP args, SEXP env)
 {
     errorcall(call, "HDF5 support unavailable\n");
-    return(R_NilValue);		/* -Wall */
+    return(R_NilValue);         /* -Wall */
 }
 SEXP
 do_hdf5load (SEXP call, SEXP op, SEXP args, SEXP env)
 {
     errorcall(call, "HDF5 support unavailable\n");
-    return(R_NilValue);		/* -Wall */    
+    return(R_NilValue);         /* -Wall */
 }
 #endif

--------------3F9F11E6B00532CFDD5A424A--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jean@stat.ubc.ca  Fri Apr  2 23:01:21 1999
From: jean@stat.ubc.ca (Jean Meloche)
Date: Fri, 02 Apr 1999 22:01:21 +0000
Subject: R patch for strsplit
Message-ID: <37053E31.DC51F380@stat.ubc.ca>

This is a multi-part message in MIME format.
--------------031DBBD5368F0FEAFF79DE0C
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

R core dumps when strsplit-ing long strings:

> str<-''; for(i in c(0:1000)) str<-paste(str,'a')
> strsplit(str,' ')
Bus Error (core dumped)

The attached patch fixes the problem in strsplit
by mallocating a short lived buffer of the right
size.

-- 
Jean Meloche
--------------031DBBD5368F0FEAFF79DE0C
Content-Type: text/plain; charset=us-ascii;
 name="ch.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="ch.diff"

--- character.c	Sun Feb 21 23:59:40 1999
+++ /usr/local/R-0.63.3/src/main/character.c	Fri Apr  2 13:24:03 1999
@@ -107,7 +107,7 @@
 {
     SEXP s, t, tok, x;
     int i, j, len, tlen, ntok;
-    char buff[MAXELTSIZE], *pt, *split = "";
+    char *buff, *pt, *split = "";
 
     checkArity(op, args);
     x = CAR(args);
@@ -119,6 +119,7 @@
     PROTECT(s = allocVector(VECSXP, len));
     for (i = 0; i < len; i++) {
 	/* find out how many splits there will be */
+	buff=malloc(strlen(CHAR(STRING(x)[i]))+1);
 	strcpy(buff, CHAR(STRING(x)[i]));
 	if (tlen > 0) {
 	    split = CHAR(STRING(tok)[i % tlen]);
@@ -150,6 +151,7 @@
 	}
 	UNPROTECT(1);
 	VECTOR(s)[i] = t;
+	free(buff);
     }
     UNPROTECT(1);
     return s;

--------------031DBBD5368F0FEAFF79DE0C--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sat Apr  3 09:38:00 1999
From: wvenable@arcola.stats.adelaide.edu.au (wvenable@arcola.stats.adelaide.edu.au)
Date: Sat, 3 Apr 1999 10:38:00 +0200
Subject: tabulate causes segmentation fault (PR#156)
Message-ID: <199904030838.KAA31481@blueberry.kubism.ku.dk>

Peter,

I thought this one was noted and fixed, but I could be wrong.

    R : Copyright 1999, The R Development Core Team
    Version 0.63.3  (March 6, 1999)
    
    ....
    
    [Previously saved workspace restored]
    
    > tabulate(1:10, 5)
    
    Process R:1 segmentation fault at Sat Apr  3 17:48:34 1999

-- 
(The following contact details become official on 1 May 1999, but
the email address works now and may be used from now on.)
-----------------------------------------------------------------
Bill Venables, Statistician, CMIS Environmetrics Project.

Physical address:                            Postal address:
CSIRO Marine Laboratories,                   PO Box 120,       
233 Middle St, Cleveland, Queensland         Cleveland, Qld, 4163
AUSTRALIA                                    AUSTRALIA

Telephone: +61 7 3826 7200     Email: Bill.Venables@cmis.csiro.au     
      Fax: +61 7 3826 7304

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr  3 10:34:08 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 03 Apr 1999 11:34:08 +0200
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: wvenable@arcola.stats.adelaide.edu.au's message of "Sat, 3 Apr 1999 10:38:00 +0200"
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
Message-ID: <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>

wvenable@arcola.stats.adelaide.edu.au writes:

> Peter,
> 
> I thought this one was noted and fixed, but I could be wrong.
> 
>     R : Copyright 1999, The R Development Core Team
>     Version 0.63.3  (March 6, 1999)
>     
>     ....
>     
>     [Previously saved workspace restored]
>     
>     > tabulate(1:10, 5)
>     
>     Process R:1 segmentation fault at Sat Apr  3 17:48:34 1999

It wasn't...

However, all it needs is a bit of defensive programming. But should it

(a) Protest if any(bin)>nbins
or 
(b) Quietly set bin[bin>nbins] <- 0  # or NA, no matter

(one could also start the routine with bin<-bin[bin<=nbin])

I think (b) since that is consistent with the way values <= 0 are
currently handled.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sun Apr  4 01:11:39 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Sun, 4 Apr 1999 09:41:39 +0930 (CST)
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
 <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
Message-ID: <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>

>>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    Peter> wvenable@arcola.stats.adelaide.edu.au writes:

    >> R : Copyright 1999, The R Development Core Team Version
    >> 0.63.3 (March 6, 1999)
    >> 
    >> ....
    >> 
    >> [Previously saved workspace restored]
    >> 
    >> > tabulate(1:10, 5)
    >> 
    >> Process R:1 segmentation fault at Sat Apr 3 17:48:34 1999

    Peter> It wasn't...

    Peter> However, all it needs is a bit of defensive
    Peter> programming.

Yes, Peter, but by whom?  My point was that this kind of massive
bear trap was not something that should be the users' sole
responsibility to avoid.  Having a simple exception capable of
killing the session and losing all data is perhaps OK for
MicroSoft, but it should not be OK for us.  I believe the flaw is
still present in the nascent 0.64, which bothers me.

I think it should be solved at the C level since tabulate() is
one of those things that you want to be ultra-slick, but if this
is not possible right now, perhaps we will have to put up with a
stop-gap measure.  For example you could change it in 0.64 to

tabulate <- function (bin, nbins = max(bin)) {  
    if (!is.numeric(bin) && !is.factor(bin)) 
        stop("tabulate: bin must be numeric or a factor")

    nbins <- max(0, nbins) 
    if(!missing(nbins) && !all(OK <- (bin <= nbins))) 
	bin <- bin[OK]
    n <- length(bin)
    storage.mode(bin) <- "integer"

    .C("tabulate", bin, n, ans = integer(nbins))$ans
}

> tabulate(1:10, 5)
[1] 1 1 1 1 1
> tabulate(1:10 + 0.1, 5)
[1] 1 1 1 1 0
> tabulate(1:10, 0)
numeric(0)
> tabulate(sample(1:10, 50000, rep=T))
 [1] 5016 5048 4996 5020 4914 5089 5059 4885 4998 4975
> 

I think any degradation in performance over the present version
would be mostly negligible and the whole thing would be much safer.
Users who need ultra-slickness still have the option of using he
C code directly - that is the wonderful benefit of open code.

Bill
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sun Apr  4 07:11:49 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Sun, 4 Apr 1999 15:41:49 +0930 (CST)
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
 <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
 <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>
Message-ID: <14087.677.890232.822546@arcola.stats.adelaide.edu.au>

OK, I have a few noodles around my ears...  

The fix I gave for tabulate can cause problems with factors (and
breaks truehist in the MASS library!).  Here is a further
refinement, which is now getting a little messy, I do admit, but
I'm pretty sure this covers it.  (At least truehist works...)

--(begin tabulate.R)--
tabulate <- function (bin, nbins = max(bin)) {
    if (!is.numeric(bin) && !is.factor(bin)) 
        stop("tabulate: bin must be numeric or a factor")
    nbins <- max(0, nbins)

    if (!missing(nbins)) {
      if (is.factor(bin))
        bin <- unclass(bin)
      if (!all(OK <- (bin <= nbins)))
        bin <- bin[OK]
    }

    n <- length(bin)
    storage.mode(bin) <- "integer"
    .C("tabulate", bin, n, ans = integer(nbins))$ans
}
--(end tabulate.R)--
Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr  4 08:04:17 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Sun, 4 Apr 1999 09:04:17 +0200
Subject: tabulate causes segmentation fault (PR#156)
Message-ID: <199904040704.JAA31993@blueberry.kubism.ku.dk>

On Sun, 4 Apr 1999, Bill Venables wrote:

> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
> 
>     Peter> wvenable@arcola.stats.adelaide.edu.au writes:
> 
>     >> R : Copyright 1999, The R Development Core Team Version
>     >> 0.63.3 (March 6, 1999)
>     >> 
>     >> ....
>     >> 
>     >> [Previously saved workspace restored]
>     >> 
>     >> > tabulate(1:10, 5)
>     >> 
>     >> Process R:1 segmentation fault at Sat Apr 3 17:48:34 1999
> 
>     Peter> It wasn't...
> 
>     Peter> However, all it needs is a bit of defensive
>     Peter> programming.
> 
> Yes, Peter, but by whom?  My point was that this kind of massive
> bear trap was not something that should be the users' sole
> responsibility to avoid.  Having a simple exception capable of
> killing the session and losing all data is perhaps OK for
> MicroSoft, but it should not be OK for us.  I believe the flaw is
> still present in the nascent 0.64, which bothers me.
> 
> I think it should be solved at the C level since tabulate() is
> one of those things that you want to be ultra-slick, but if this
> is not possible right now, perhaps we will have to put up with a

I have put a change in at the C level _and_ altered the help page to
document what tabulate does and what its arguments are. I think the 
defensive programming should be at the C level, for users can call the 
entry point.

The code is now much cleaner (I think):

tabulate <- function(bin, nbins = max(1,bin))
{
    if(!is.numeric(bin) && !is.factor(bin))
	stop("tabulate: bin must be numeric or a factor")
    .C("tabulate",
       as.integer(bin),
       as.integer(length(bin)),
       as.integer(nbins),
       ans = integer(nbins))$ans
}

As tabulate() silently ignored negative integers, I thought it could
silently ignore ones beyond nbins too, especially as I have documented
this.

I reckon the answer for

> tabulate(numeric(0))
[1] 0

is wrong (I would have had a zero-length vector) but have left it for
compatibility.

> stop-gap measure.  For example you could change it in 0.64 to
> 
> tabulate <- function (bin, nbins = max(bin)) {  
>     if (!is.numeric(bin) && !is.factor(bin)) 
>         stop("tabulate: bin must be numeric or a factor")
> 
>     nbins <- max(0, nbins) 
>     if(!missing(nbins) && !all(OK <- (bin <= nbins))) 
> 	bin <- bin[OK]
>     n <- length(bin)
>     storage.mode(bin) <- "integer"
> 
>     .C("tabulate", bin, n, ans = integer(nbins))$ans
> }

Um. although not previously documented, tabulate is used with factors (as
in S).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr  4 11:15:56 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 04 Apr 1999 12:15:56 +0200
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Sun, 4 Apr 1999 09:04:17 +0200"
References: <199904040704.JAA31993@blueberry.kubism.ku.dk>
Message-ID: <x2bth43d43.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> The code is now much cleaner (I think):
> 
> tabulate <- function(bin, nbins = max(1,bin))
> {
>     if(!is.numeric(bin) && !is.factor(bin))
> 	stop("tabulate: bin must be numeric or a factor")
>     .C("tabulate",
>        as.integer(bin),
>        as.integer(length(bin)),
>        as.integer(nbins),
>        ans = integer(nbins))$ans
> }

.. except that it relies on the following phenomenon:
> max(factor(0:3))
Error: "max" not meaningful for factors
> max(1,factor(0:3))
[1] 4

BTW: Why are we testing for x[i] != R_NaInt in tabulate.c, when 

> tabulate(c(1:3,NA),3)
Error: NAs in foreign function call (arg 1)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr  4 18:04:53 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 4 Apr 1999 18:04:53 +0100 (BST)
Subject: "integer" mod ein .C/.Fortran call
Message-ID: <Pine.GSO.4.05.9904041755330.12670-100000@auk.stats>

I have just discovered that mode integer in C maps to int in C and integer
in Fortran, whereas it maps to long in C loaded in to S.  This seems
undocumented in R, and the base R code is not consistent in its usage, let
alone user packages.

Can those of you who have long != int tell us what your machines use, and
also if Fortran integer is equal to C int (which is assumed in a lot
of places).

I believe that on DEC Alpha S-PLUS uses 64-bit "integer", corresponding to
C long and Fortran integer.  I understand R is trying to use 32 bits for
R "integer", C int and Fortran integer.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sun Apr  4 22:36:10 1999
From: bates@stat.wisc.edu (bates@stat.wisc.edu)
Date: Sun, 4 Apr 1999 23:36:10 +0200
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
Message-ID: <199904042136.XAA32150@blueberry.kubism.ku.dk>

Full_Name: Douglas Bates
Version: Version 0.64.0 Unstable (April 3, 1999)
OS: Debian GNU/Linux 2.1
Submission from: (NULL) (128.105.5.97)


R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
R> anova( fm2 )
Analysis of Variance Table

Response: /
Response: 1
Response: Surv
                Df Sum Sq Mean Sq F value  Pr(>F)    
Poison           2   34.9    17.4   72.63 2.3e-13 ***
Antidote         3   20.4     6.8   28.34 1.4e-09 ***
Poison:Antidote  6    1.6     0.3    1.09    0.39    
Residuals       36    8.6     0.2                    
---
Signif. codes:  0  `***'  0.001  `**'  0.01  `*'  0.05  `.'  0.1  ` '  1 


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr  5 06:06:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Mon, 5 Apr 1999 06:06:07 +0100 (BST)
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
In-Reply-To: <199904042136.XAA32150@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904050603001.18277-100000@auk.stats>

On Sun, 4 Apr 1999 bates@stat.wisc.edu wrote:

> Full_Name: Douglas Bates
> Version: Version 0.64.0 Unstable (April 3, 1999)
> OS: Debian GNU/Linux 2.1
> Submission from: (NULL) (128.105.5.97)

[Is that an R problem: should not there be a machine name there?]
 

> R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
> R> anova( fm2 )
> Analysis of Variance Table
> 
> Response: /
> Response: 1
> Response: Surv

[...]

Actually, there is no print.anova.lm (print.anova is used) but the error is
a lack of a deparse in anova.lm. I have fixed this for 0.64 (whilst
incorporating Jean Meloche's patches for singular models).

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr  5 06:11:38 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 5 Apr 1999 07:11:38 +0200
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
Message-ID: <199904050511.HAA32384@blueberry.kubism.ku.dk>

On Sun, 4 Apr 1999 bates@stat.wisc.edu wrote:

> Full_Name: Douglas Bates
> Version: Version 0.64.0 Unstable (April 3, 1999)
> OS: Debian GNU/Linux 2.1
> Submission from: (NULL) (128.105.5.97)

[Is that an R problem: should not there be a machine name there?]
 

> R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
> R> anova( fm2 )
> Analysis of Variance Table
> 
> Response: /
> Response: 1
> Response: Surv

[...]

Actually, there is no print.anova.lm (print.anova is used) but the error is
a lack of a deparse in anova.lm. I have fixed this for 0.64 (whilst
incorporating Jean Meloche's patches for singular models).

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr  6 08:02:45 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 6 Apr 1999 08:02:45 +0100 (BST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <6ryakk2s15.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904060754340.23118-100000@auk.stats>

On 26 Mar 1999, Douglas Bates wrote:

> >>>>> "Jonathan" == Jonathan Rougier <J.C.Rougier@durham.ac.uk> writes:
> 
>   Jonathan> On Fri, 26 Mar 1999, Martyn Plummer wrote:
>   >> The problem isn't that the help files take up a lot of space, but
>   >> that certain file systems are extremely inefficient in the use of
>   >> that space.
> 
>   Jonathan> This is probably an unrealistic suggestion, but if
>   Jonathan> compression is less of a problem than the number of files,
>   Jonathan> why not take the help files `onboard' by creating a new
>   Jonathan> class of objects with mode "help", which would be lists
>   Jonathan> with components much like the current .Rd files, and
>   Jonathan> attach them at the bottom of the search list.  Each
>   Jonathan> library would then require just a single file of help
>   Jonathan> objects.
> 
> This is a reasonable suggestion but I think that the way that R
> handles its search lists would make this problematic.  At present
> objects in a library take up space in memory whether they are used or
> not.  Also, the search to resolve a name is a linear search over the
> available names.  Adding a whole lot more names for help objects would
> exacerbate both of those problems.  Then there is the name-space
> pollution problem.
> 
> Approaches to all of these issues with names and objects are being
> discussed and will probably be implemented in later releases.  Right
> now I think the best approach to the problem of help files,
> etc. (other than waiting for certain commercial operating systems to
> catch up with concepts from the 1980's) is to use the zip format for
> the reasons that Brian Ripley indicated.

Doing this proved relatively easy and quite fast enough. It will appear
in the next Windows version (rw0640, I presume) that is due in a few days.
We just use unzip to extract a file and display it. (There is a DLL
version of unzip, but it seems unnecessary.)  Using zipped help is optional
by package, and where selected (when installing the package from source)
zips up the text, latex and example files. The space savings on a VFAT16
file system are considerable (about 20Mb on my system).

It is a little unfair to blame Windows: it has had more space-efficient
file systems (NTFS, FAT32) for some time. The problem is that not
everything else (notably Linux) could read/write these, and so they
were not the defaults.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Tue Apr  6 08:45:45 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Tue, 6 Apr 1999 09:45:45 +0200
Subject: seg fault with strsplit (PR#158)
Message-ID: <199904060745.JAA32726@blueberry.kubism.ku.dk>

Try the following with R 63.3:

test <- function(z){
	ch1 <- deparse(z,width=500)
	ch <- NULL
	for(i in 1:length(ch1))ch <- paste(ch,ch1[i],collapse=" ")
	a <- gsub("(\\[(0|1|2|3|4|5|6|7|8|9|:|,)+\\])|([][+*/^():!<>%&|~,{}\"\\\=-])|( [0-9]+)|(^[0-9]+)"," ",ch)
	print("here")
	strsplit(a," ")
}
test(glm)

Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr  6 09:30:27 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 06 Apr 1999 10:30:27 +0200
Subject: seg fault with strsplit (PR#158)
In-Reply-To: jlindsey@alpha.luc.ac.be's message of "Tue, 6 Apr 1999 09:45:45 +0200"
References: <199904060745.JAA32726@blueberry.kubism.ku.dk>
Message-ID: <x2hfqui21o.fsf@blueberry.kubism.ku.dk>

jlindsey@alpha.luc.ac.be writes:

> Try the following with R 63.3:
> 
> test <- function(z){
> 	ch1 <- deparse(z,width=500)
> 	ch <- NULL
> 	for(i in 1:length(ch1))ch <- paste(ch,ch1[i],collapse=" ")
> 	a <- gsub("(\\[(0|1|2|3|4|5|6|7|8|9|:|,)+\\])|([][+*/^():!<>%&|~,{}\"\\\=-])|( [0-9]+)|(^[0-9]+)"," ",ch)
> 	print("here")
> 	strsplit(a," ")
> }
> test(glm)

We know... Buffer overflow. There's been a patch for it on r-devel by Jean
Meloche, using a short-lived malloc/free thing, but I'm still waiting
for someone to assure me that it won't interfere with current and
future memory management schemes.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr  6 11:22:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 6 Apr 1999 11:22:07 +0100 (BST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <199904061004.MAA05558@sophie.ethz.ch>
Message-ID: <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>

On Tue, 6 Apr 1999, Martin Maechler wrote:

[discussion moved make to R-devel]

> >>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
> 
>     <.....>
> 
>     BDR> Doing this proved relatively easy and quite fast enough. It will
>     BDR> appear in the next Windows version (rw0640, I presume) that is due
>     BDR> in a few days.  We just use unzip to extract a file and display
>     BDR> it. (There is a DLL version of unzip, but it seems unnecessary.)
>     BDR> Using zipped help is optional by package, and where selected (when
>     BDR> installing the package from source) zips up the text, latex and
>     BDR> example files. The space savings on a VFAT16 file system are
>     BDR> considerable (about 20Mb on my system).
> 
> Brian, 
> this will be part of R `proper',  not just the windows extensions
> right after  0.64, will it?

I am not sure about this. The gain is really only on systems with large
clusters, and that means Windows VFAT16, where small clusters are 4Kb and
clusters can be 32Kb (and are on a > 1Gb disc).

The other issue is licensing. I compiled unzip for Win32 and followed the
minimal allowed distribution as part of the binary distribution. On
source platforms the use of unzip would be optional, but with binary
distributions you would need to ensure unzip is available.

Is there any interest in having this on Unix/Linux platforms?  If so I can
very easily change the source code to search zip files if present.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Tue Apr  6 13:30:56 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Tue, 6 Apr 1999 14:30:56 +0200 (CEST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>
References: <199904061004.MAA05558@sophie.ethz.ch>
 <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>
Message-ID: <14089.65152.713639.650826@galadriel.ci.tuwien.ac.at>

>>>>> On Tue, 6 Apr 1999 11:22:07 +0100 (BST),
>>>>> Prof Brian D Ripley (PBDR) wrote:


PBDR> Is there any interest in having this on Unix/Linux platforms?  If so I can
PBDR> very easily change the source code to search zip files if present.

Yes, I think I want the help system as consistent across platforms as
possible, i.e., using the same mechanisms everywhere. Should be easier
to maintain.

.f


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@blueberry.kubism.ku.dk  Wed Apr  7 06:15:03 1999
From: pd@blueberry.kubism.ku.dk (Peter Dalgaard BSA)
Date: Wed, 7 Apr 1999 07:15:03 +0200
Subject: Bug list summary (automatic post)
Message-ID: <199904070515.HAA26555@blueberry.kubism.ku.dk>

=================================================
This is an automated summary of the status of the R-bugs
repository.

Note that this may be neither complete nor perfectly
correct at any given instance: Not all bugs are reported,
and some reported bugs may have been fixed, but the
repository not yet updated.

Some bug fixes are difficult to verify because they pertain
to specific hardware or operating system versions. If you
have information to contribute, please do so.

If you happen to know how to fix a problem please send
patches to the bug repository, too.

New bugs are reported either through the web
interface at r-bugs.biostat.ku.dk or via email to
r-bugs@biostat.ku.dk. The bug.report() function can be
used to automate parts of the procedure on many systems.
Followups on older bugs can be done by including the string
"(PR#999)" in the Subject of an email (change 999 to the
actual reference number, of course!).
=================================================

Directory:  Accuracy

* PR# 138 *
Subject: Re: [R] bug? and New bug.
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 10 Mar 1999 17:21:16 +0100

Directory:  Add-ons

* PR# 122 *
Subject: [R] possible bug in loglm
From: D.A.Wooff@durham.ac.uk
Date: Thu, 18 Feb 1999 17:06:11 +0000 (GMT)
--Problem with running inside function. 
* PR# 137 *
Subject: funfits
From: "Alvaro A. Novo" <novo@uiuc.edu>
Date: Tue, 9 Mar 1999 22:24:54 -0600

Directory:  Analyses

none

Directory:  Documentation

* PR# 146 *
Subject: nlm docs
From: Patrick Lindsey <plindsey@alpha.luc.ac.be>
Date: Wed, 24 Mar 1999 15:48:41 +0100 (MET)

Directory:  Graphics

* PR# 38 *
Subject: possible bugs
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Sun, 6 Sep 1998 15:59:34 -0400 (EDT)
--ylim problem which appears solved
--Postscript overflow still with us (22feb99)
* PR# 61 *
Subject: points(...,  cex = ..)  is pretty wrong...
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 2 Nov 1998 19:15:06 +0100
--Symbols getting decentered when too large cex for X. Still there 22feb99  
* PR# 66 *
Subject: Bug with bounding box?
From: johnp@tip.csiro.au
Date: Thu, 3 Dec 1998 02:15:38 +0100
--Yes, this appears to have x/y reversed. The supplied example gives 
--%%Orientation: Landscape
--%%BoundingBox: 18 18 824 577 
--but the convention is to rotate the paper but leave the coordinate system.
* PR# 69 *
Subject: Some graphics bugs
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 04 Dec 1998 11:42:50 -0000 ()
Date: 04-Dec-98
--Various anomalies with text size and alignment. 2B appears to be solved. The 
--rest is still there (22feb99)
* PR# 79 *
Subject: apology: text(locator(),"sometext") works
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Tue, 15 Dec 1998 19:45:29 -0500 (EST)
--Clipping discrepancy x11/PS
* PR# 106 *
Subject: border-arg. in persp
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Fri, 29 Jan 1999 11:12:39 +0100
--No effect of arg. Still here 22feb99. Segfault with border=0 seems gone now. 
* PR# 114 *
Subject: PostScript Level 1/2 bug
From: ben@eno.princeton.edu
Date: Mon, 8 Feb 1999 00:07:20 +0100
--Not sure whether this is really PS lev 1/2 issue.
--/Font5 /Symbol findfont definefont
--(missing scalefont?)
* PR# 120 *
Subject: graphics bug: type="l"
From: Matthew Wiener <mcw@ln.nimh.nih.gov>
Date: Tue, 16 Feb 1999 15:30:25 -0500 (EST)
--X server problem drawing > 64K lines at once. Workaround?
* PR# 123 *
Subject: Text in plot
From: Ennapadam Venkatraman <venkat@biosta.mskcc.org>
Date: Thu, 18 Feb 1999 13:05:37 -0500
--Multiline text not working
* PR# 130 *
Subject: lty=0 -- shouldn't it give an invisible line?
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 28 Feb 1999 21:45:43 +0100
* PR# 149 *
Subject: plot.formula and pch=
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 25 Mar 1999 21:22:44 +0100
* PR# 150 *
Subject: R: error report
From: Adelchi Azzalini <adelchi.azzalini@jrc.it>
Date: Fri, 26 Mar 1999 09:39:05 +0000
* PR# 153 *
Subject: image + x11
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Wed, 31 Mar 1999 14:09:53 +0200

Directory:  In-Out

* PR# 117 *
Subject: load() -> segfault
From: "Gregory R. Warnes" <warnes@biostat.washington.edu>
Date: Mon, 8 Feb 1999 18:10:36 -0800 (PST)
--Fixed-size buffer used to hold unlimited size object. Not good...
* PR# 125 *
Subject: scan rejects complex
From: John.Peters@tip.csiro.au (John Peters)
Date: Mon, 22 Feb 1999 10:08:14 +1100 (EST)
* PR# 129 *
Subject: Formatting in formatC and format
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 28 Feb 1999 08:53:34 +0000 (GMT)
--Documentation and ``merge'' of format() and formatC() would be desired - MM

Directory:  Installation

* PR# 95 *
Subject: patch to 63.2
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 15 Jan 1999 11:00:25 +0100 (MET)
--An incident where the 0.63.2 patches didn't take. So far the only one. 
--Maybe caused by patching unclean sources?

Directory:  Language

* PR# 40 *
Subject:  fac1 : fac2 -- fails {no "cross" anymore in seq.c} 
From: maechler@stat.math.ethz.ch
Date: Wed, 16 Sep 1998 08:42:12 +0200
--still there 17feb99
* PR# 85 *
Subject:  A bug in data.entry? 
From: Yusuke Uchiyama <me@naxgul.kais.kyoto-u.ac.jp>
Date: Wed, 23 Dec 1998 11:03:03 GMT
--still there 17feb99
* PR# 89 *
Subject: lapply -- Recall bug
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 6 Jan 1999 15:04:14 +0100
--This is *nasty*.
* PR# 105 *
Subject: an old bug resurfaces
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 29 Jan 1999 08:28:32 +0100 (MET)
--Model formulas. Proper fix probably requires extensive rewrite of model formula
--parser, which would make in non-S-compatible.
* PR# 113 *
Subject: cat data types
From: John Peters <johnp@tip.CSIRO.AU>
Date: Fri, 5 Feb 1999 18:31:52 +1100 (EDT)
--Cannot cat a name. (Docs fixed to reflect this by Kurt, 22feb99)
* PR# 118 *
Subject: Function parsing
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
Date: Wed, 10 Feb 1999 13:42:01 +0000 (GMT)
--comment placement.
* PR# 142 *
Subject: exists finds objects lots of places!
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:34:34 +0100
--No bug; not S compatible; documentation should be clearer

Directory:  Low-level

* PR# 37 *
Subject: S.h compatibility issues
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 6 Sep 1998 19:58:47 +0100 (BST)
* PR# 119 *
Subject: Problems with warnings from loess under Windows, at least
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Thu, 11 Feb 1999 15:08:41 +0000 (GMT)
* PR# 140 *
Subject: rbind dimnames with complex
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:15:14 +0100

Directory:  Misc

* PR# 91 *
Subject: possible bug
From: Rashid Nassar <rnassar@duke.edu>
Date: Sat, 9 Jan 1999 14:50:58 -0500 (EST)
--Remaining issue is whether we can do something more friendly than dumping 
--users into vi?

Directory:  Models

* PR# 121 *
Subject:  model.frame mangles time series 
From: Peter Dalgaard BSA <pd@biostat.ku.dk>
Date: Thu, 18 Feb 1999 15:47:24 +0100
--Subset in C code + attributes = mess
--Switch to interpreted ("[")

Directory:  Startup

* PR# 21 *
Subject: Restoring large image files
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 21 Aug 1998 13:29:16 -0000 ()

Directory:  System-specific

none

Directory:  TooMuchAtOnce

* PR# 53 *
Subject: 0.62.3 bugs, incompatibilities and problems
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 12 Oct 1998 09:43:51 +0200 (MET DST)
* PR# 76 *
Subject: R-0.63.0
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Fri, 11 Dec 1998 23:20:08 -0500 (EST)

Directory:  Windows

* PR# 46 *
Subject: keyboard bug in Guido's R62.3
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Thu, 24 Sep 1998 09:55:39 +0200 (MET DST)
* PR# 47 *
Subject: q() function in win32 version 0.61.3
From: normo@ratfish.pbs.dfo.ca
Date: Thu, 24 Sep 1998 22:04:10 +0200
* PR# 57 *
Subject: windows95
From: christoph.kalinowski@ku-eichstaett.de
Date: Thu, 29 Oct 1998 11:00:18 +0100
* PR# 59 *
Subject: windows nt
From: christoph.kalinowski@biostat.ku.dk
Date: Mon, 2 Nov 1998 13:41:52 +0100
* PR# 101 *
Subject: Re: [R] Re: R-0.63.2 for Windows - some comments
From: Guido Masarotto <guido@hal.stat.unipd.it>
Date: Fri, 22 Jan 1999 12:40:26 +0100

Directory:  incoming

* PR# 127 *
Subject: history
From: jmhughes@globalnet.co.uk
Date: Sat, 27 Feb 1999 21:32:56 +0100
* PR# 132 *
Subject: Re: [R] zero-offset matrices
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 02 Mar 1999 16:59:48 +0100
* PR# 133 *
Subject: Re: system
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 Mar 1999 11:33:21 +0100
* PR# 135 *
Subject: summary() of lm() problem
From: Simon Fear <fears@roycastle.liv.ac.uk>
Date: Tue, 9 Mar 1999 13:18:37 -0000 
--lm (?) AND Windows problem;  Win solved for 0.63.3
* PR# 139 *
Subject: : for factors
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 11 Mar 1999 09:30:04 +0100
* PR# 144 *
Subject: glm throws erroneous(?)'names attribute must be the same length as the vector' 
From: wagman@enteract.com
Date: Thu, 18 Mar 1999 08:58:47 +0100
* PR# 145 *
Subject: R-0.63.3 package on IRIX 6.5 machine
From: Jayshree Sarma <jsarma@cs.gmu.edu>
Date: Tue, 23 Mar 1999 16:54:20 -0500 (EST)
* PR# 148 *
Subject: Missing Warning in :
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 25 Mar 1999 13:34:12 +0100
* PR# 151 *
Subject: problems with formals and get
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 29 Mar 1999 09:29:05 +0200 (MET DST)
* PR# 152 *
Subject: Example(persp) fails in 0.63.4 and 0.64
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Tue, 30 Mar 1999 21:19:37 +0100 (BST)
* PR# 157 *
Subject: deparsing lhs of formula in print.anova.lm
From: bates@stat.wisc.edu
Date: Sun, 4 Apr 1999 23:36:08 +0200
* PR# 158 *
Subject: seg fault with strsplit
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Tue, 6 Apr 1999 09:41:29 +0200 (MET DST)
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Wed Apr  7 08:58:05 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Wed, 7 Apr 1999 09:58:05 +0200
Subject: offsets again (PR#159)
Message-ID: <199904070758.JAA26645@blueberry.kubism.ku.dk>

1. Try the following in 63.3

y <- rnorm(20)
y1 <- y[2:20]
y2 <- y[1:19]
summary(glm(y1~offset(y2)))
summary(glm(y1-y2~1))

Both are the same model, but the first gives the wrong s.e.
I don't believe this was a problem in 63.2

2. Besides the strsplit buffer, there appear to be other memory
problems causing seg faults. With vsize 12M in batch, I accumulated 9
glm objects in memory, then called one of my RM functions and
systematically got a seg fault. After much searching, I simply removed
the 9 objects before calling my function, the problem went away. This
did not occur in 63.2 but I have changed my function so that it now
uses strsplit and modifies function environments. However, in this
case, strsplit is not applied to any text that would cause buffer
overflow.
  Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 09:38:33 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Wed, 7 Apr 1999 10:38:33 +0200
Subject: offsets again (PR#159)
Message-ID: <199904070838.KAA26671@blueberry.kubism.ku.dk>

On Wed, 7 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> 1. Try the following in 63.3
> 
> y <- rnorm(20)
> y1 <- y[2:20]
> y2 <- y[1:19]
> summary(glm(y1~offset(y2)))
> summary(glm(y1-y2~1))
> 
> Both are the same model, but the first gives the wrong s.e.
> I don't believe this was a problem in 63.2

raw residuals from a glm with offset were wrong: fixed for 0.64.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From steuer@amadeus.statistik.uni-dortmund.de  Wed Apr  7 15:25:56 1999
From: steuer@amadeus.statistik.uni-dortmund.de (Dipl.-Stat. Detlef Steuer)
Date: Wed, 07 Apr 1999 16:25:56 +0200 (CEST)
Subject: chull() wanted?
Message-ID: <XFMail.990407162556.steuer@amadeus.statistik.uni-dortmund.de>

Hello!

Is there someone already working on an implementation of Splus'
chull() function for R?
If not, I would like volunteer to try it.

For my "Diplom" I implemented convex peeling in C (some time ago),
 using an O(n log(n)) algorithm, so it probably will prove relatively easy to
use that code for a R-function.

Well, as least as easy as any programming tends to be. :-)  

Detlef Steuer



Detlef Steuer Universitaet Dortmund                             ///////
LS Computergestuetzte Statistik                          U N I D O ///  
steuer@amadeus.statistik.uni-dortmund.de                ______///////  
Tel: ++49 +231 755 4353 Fax: ++49 +231 755 4387         \_\_\_\/////
                                                         \_\_\_\///
                                                          \_\_\_\/

*** Use what talents you possess: the woods would be very silent ***
*** if no birds sang there except those that sang best.          ***
*** Henry Van Dyke                                               ***
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Wed Apr  7 15:29:46 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Wed, 7 Apr 1999 16:29:46 +0200
Subject: core dump (PR#160)
Message-ID: <199904071429.QAA00885@blueberry.kubism.ku.dk>

Here is the output from gdb for one of my numerous reproducible core
dumps. Unfortunately, I cannot send the R code because it involves a lot
of data setting up and a special order of calling my ehr function in
my event library. Note that I am using 63.3 and not calling any of my
own C or Fortran. Jim

GNU gdb 4.17.0.4 with Linux/x86 hardware watchpoint and FPU support
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...
Core was generated by `/usr/local/src/R/bin/R.binary --no-save --no-restore --nsize 1M --vsize 12M'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/X11R6/lib/libSM.so.6...done.
Reading symbols from /usr/X11R6/lib/libICE.so.6...done.
Reading symbols from /usr/X11R6/lib/libX11.so.6...done.
Reading symbols from /usr/lib/libf2c.so.0...done.
Reading symbols from /usr/lib/libreadline.so.3...done.
Reading symbols from /lib/libdl.so.2...done.
Reading symbols from /usr/lib/libncurses.so.4...done.
Reading symbols from /lib/libm.so.6...done.
Reading symbols from /lib/libc.so.6...done.
Reading symbols from /lib/libtermcap.so.2...done.
Reading symbols from /lib/ld-linux.so.2...done.
Reading symbols from /usr/local/src/R/library/rmutil/libs/rmutil.so...done.
Reading symbols from /usr/local/src/R/library/event/libs/event.so...done.
#0  0x8080d6c in markSExp (s=Cannot access memory at address 0xbfffede4.
) at memory.c:501
501         if (s && !MARK(s)) {

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 15:29:57 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Wed, 7 Apr 1999 16:29:57 +0200
Subject: offsets again (PR#159)
Message-ID: <199904071429.QAA00889@blueberry.kubism.ku.dk>

On Wed, 7 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> 1. Try the following in 63.3
> 
> y <- rnorm(20)
> y1 <- y[2:20]
> y2 <- y[1:19]
> summary(glm(y1~offset(y2)))
> summary(glm(y1-y2~1))
> 
> Both are the same model, but the first gives the wrong s.e.
> I don't believe this was a problem in 63.2

My apologies: I have mis-edited the patch I applied, working too close
to the deadline for 0.64. I have in glm.fit

    residuals[good] <- z - (eta + offset)[good] # z does not have

Change + to - .

Oh well, 0.64.1 may get this right.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 15:46:44 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Wed, 7 Apr 1999 15:46:44 +0100 (BST)
Subject: chull() wanted?
In-Reply-To: <XFMail.990407162556.steuer@amadeus.statistik.uni-dortmund.de>
Message-ID: <Pine.GSO.4.05.9904071543310.10385-100000@auk.stats>

On Wed, 7 Apr 1999, Dipl.-Stat. Detlef Steuer wrote:

> Hello!
> 
> Is there someone already working on an implementation of Splus'
> chull() function for R?
> If not, I would like volunteer to try it.
> 
> For my "Diplom" I implemented convex peeling in C (some time ago),
>  using an O(n log(n)) algorithm, so it probably will prove relatively easy to
> use that code for a R-function.

If only you had volunteered a month ago!

There is one implementation in package sm, and a cleaner one in 0.64, due
out today.  Both as versions of Eddy's 1977 algorithm. I would be happy to
replace the present chull by something better, though. It doesn't do
peeling, but that is easy to arrange in R: just remove the convex hull and
repeat.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From J.C.Rougier@durham.ac.uk  Thu Apr  8 10:26:23 1999
From: J.C.Rougier@durham.ac.uk (Jonathan Rougier)
Date: Thu, 8 Apr 1999 10:26:23 +0100 (BST)
Subject: chol()
Message-ID: <Pine.GSO.3.96.990408093028.11467C-100000@laplace>

May I suggest the following modification to chol(), allowing calls on
variance matrices with zeros in the diagonal.  This makes the generation
of multivariate gaussian vectors simpler, and consistent with rnorm()
which can take a zero standard deviation argument. 

"Chol" <-
function (x, tol = sqrt(.Machine$double.eps)) 
{
    if (!is.numeric(x)) 
        stop("non-numeric argument to chol")
    x <- as.matrix(x)
    if (length(n <- unique(dim(x))) > 1) 
        stop("non-square matrix in chol")
    nzero <- diag(x) > tol
    if (!all(nzero)) {
        cx <- Recall(x[nzero, nzero])
        x[] <- 0
        x[nzero, nzero] <- cx
        x
    }
    else {
        if (!is.double(x)) 
            storage.mode(x) <- "double"
        z <- .Fortran("chol", x = x, n, n, v = matrix(0, nr = n, 
            nc = n), info = integer(1), DUP = FALSE)
        if (z$info) 
            stop("singular matrix in chol")
        z$v
    }
}

I know that almost everyone has got one of these, but for completeness
here is my multivariate gaussian function which defaults to rnorm()

"rgauss" <-
function (n, mu, sig, ch = all(sig[lower.tri(sig)] == 0)) 
{
    if (missing(mu)) {
        if (missing(sig)) 
            sig <- 1
        sig <- as.matrix(sig)
        k <- unique(dim(sig))
        if (length(k) > 1) 
            stop("Non-square \"sig\" matrix")
        mu <- rep(0, k)
    }
    else {
        k <- length(mu)
        if (missing(sig)) 
            sig <- diag(rep(1, k))
        else {
            sig <- as.matrix(sig)
            if (any(k != dim(sig))) 
                stop("\"mu\" and \"sig\" inconsistent")
        }
    }
    # uses Chol() to handle zero variances
    if (!ch) 
        sig <- Chol(sig)
    rn <- matrix(rnorm(n * k), nrow = n)
    drop(sweep(rn %*% sig, 2, mu, "+"))
}

Regards, Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE

"[B]egin upon the precept ... that the things we see are to be 
 weighed in the scale with what we know"  (Meredith, 1879, The Egoist)

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rossini@biostat.washington.edu  Thu Apr  8 15:06:06 1999
From: rossini@biostat.washington.edu (A.J. Rossini)
Date: 08 Apr 1999 07:06:06 -0700
Subject: submission method "none" of bug.report() -- interaction with ESS ?
In-Reply-To: Martin Maechler's message of "Thu, 8 Apr 1999 15:55:04 +0200"
References: <14092.40223.352251.472183@galadriel.ci.tuwien.ac.at> <199904081340.PAA06350@sophie.ethz.ch> <14092.46140.344668.897964@galadriel.ci.tuwien.ac.at> <199904081355.PAA06373@sophie.ethz.ch>
Message-ID: <87vhf7b41d.fsf@alpha.cfas.washington.edu>


>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:
>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:
    FrL> This is not only a problem of bug.report(), but of providing
    FrL> a working editor in ESS ... because the same happens if you
    FrL> say edit(lm) or of whatever object you want.

    MM> but nobody sane using ESS would say
    MM>     edit(..)
    MM> 	       ;-)

Well, we hope not.  I guess we should scan for bug.report and edit,
and do the appropriate thing :-).

(for edit, "dump-object to buffer", for bugreport, dump everything
including mail, x-rated pictures, etc, into a file and send it to
r-bugs, until it's fixed in R -- who says you can't have the same kind
of fun with unix that the windows users had with melissa? :-) 

-- but seriously, what should the proper response be?  

R for unix then ought to have an --ess flag, the way Windows does, to
prevent such occurrences, and we can handle things appropriately (and
better!) in ESS.

best,
-tony

-- 
A.J. Rossini
UW Biostatistics & Center for AIDS Research 
206-543-1044 / 206-720-4282                 
rossini@biostat.washington.edu              
http://www.biostat.washington.edu/~rossini/ 
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Thu Apr  8 15:22:43 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Thu, 8 Apr 1999 15:22:43 +0100 (BST)
Subject: submission method "none" of bug.report() -- interaction with ESS ?
Message-ID: <199904081422.PAA14650@toucan.stats.ox.ac.uk>


> R for unix then ought to have an --ess flag, the way Windows does, to
> prevent such occurrences, and we can handle things appropriately (and
> better!) in ESS.

At present it does nothing visible. The best idea is I think for ESS to
set an environment variable which the R code can check for. As in

if(getenv("R_UNDER_ESS")) options(editor="gnuclient")


(Martin: you can have gnuclient on Solaris, I believe.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From mh.smith@auckland.ac.nz  Fri Apr  9 04:20:28 1999
From: mh.smith@auckland.ac.nz (mh.smith@auckland.ac.nz)
Date: Fri, 9 Apr 1999 05:20:28 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090320.FAA00615@blueberry.kubism.ku.dk>

Full_Name: Murray H Smith
Version: 0.63.3
OS: Windows NT
Submission from: (NULL) (130.216.5.57)


The ppois function is displaced by -0.5.
Try:

> ppois(-0.5,1)
[1] 0.3678794
> ppois(-0.51,1)
[1] 0
> ppois(0,1)
[1] 0.3678794

and

> par(mfrow=c(2,1))
> x<-seq(-1,5,0.01)
> plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 07:32:30 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 08:32:30 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090632.IAA00859@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999 mh.smith@auckland.ac.nz wrote:

> Full_Name: Murray H Smith
> Version: 0.63.3
> OS: Windows NT
> Submission from: (NULL) (130.216.5.57)
> 
> 
> The ppois function is displaced by -0.5.
> Try:
> 
> > ppois(-0.5,1)
> [1] 0.3678794
> > ppois(-0.51,1)
> [1] 0
> > ppois(0,1)
> [1] 0.3678794


The problem is in

> ?ppois

The Poisson Distribution

     dpois(x, lambda)
     ppois(q, lambda)
     qpois(p, lambda)
     rpois(n, lambda)

Arguments:

       x: vector of (positive) quantiles.

       p: vector of probabilities.

       n: number of random values to return.

  lambda: vector of positive means.

where q is undefined! It should only be defined for integers. Similarly, x
should only be integers.

It seems better to make ppois defined as the CDF for all q. The code had

    x = floor(x + 0.5);

and that should be something like floor(x + 1e-7).

I've fixed this for 0.64.1, and dpois now warns on non-integer x and,
correctly, gives 0. (Yes, I know S does not warn, but that is taking
silence too far I think.)

> 
> and
> 
> > par(mfrow=c(2,1))
> > x<-seq(-1,5,0.01)
> > plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> > plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")

Thank you for the nice example, now on the help page.


You did not try pnbinom, which is much more wrong:

> pnbinom(1, 3, 0.5)
[1] 0.3125
> pnbinom(1.1, 3, 0.5)
[1] 0.3320067
> pnbinom(1.5, 3, 0.5)
[1] 0.4089029


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 07:31:33 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 9 Apr 1999 07:31:33 +0100 (BST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <199904090320.FAA00615@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904090652020.28479-100000@auk.stats>

On Fri, 9 Apr 1999 mh.smith@auckland.ac.nz wrote:

> Full_Name: Murray H Smith
> Version: 0.63.3
> OS: Windows NT
> Submission from: (NULL) (130.216.5.57)
> 
> 
> The ppois function is displaced by -0.5.
> Try:
> 
> > ppois(-0.5,1)
> [1] 0.3678794
> > ppois(-0.51,1)
> [1] 0
> > ppois(0,1)
> [1] 0.3678794


The problem is in

> ?ppois

The Poisson Distribution

     dpois(x, lambda)
     ppois(q, lambda)
     qpois(p, lambda)
     rpois(n, lambda)

Arguments:

       x: vector of (positive) quantiles.

       p: vector of probabilities.

       n: number of random values to return.

  lambda: vector of positive means.

where q is undefined! It should only be defined for integers. Similarly, x
should only be integers.

It seems better to make ppois defined as the CDF for all q. The code had

    x = floor(x + 0.5);

and that should be something like floor(x + 1e-7).

I've fixed this for 0.64.1, and dpois now warns on non-integer x and,
correctly, gives 0. (Yes, I know S does not warn, but that is taking
silence too far I think.)

> 
> and
> 
> > par(mfrow=c(2,1))
> > x<-seq(-1,5,0.01)
> > plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> > plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")

Thank you for the nice example, now on the help page.


You did not try pnbinom, which is much more wrong:

> pnbinom(1, 3, 0.5)
[1] 0.3125
> pnbinom(1.1, 3, 0.5)
[1] 0.3320067
> pnbinom(1.5, 3, 0.5)
[1] 0.4089029


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Fri Apr  9 07:39:16 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Fri, 9 Apr 1999 08:39:16 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090639.IAA00863@blueberry.kubism.ku.dk>

In R0.64.0, try
as.numeric(is.na(c(NA,NA,1)))
as.numeric(c(T,T,F))
  Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:29:39 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:29:39 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090729.JAA00872@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:

>      ppois(q, lambda)
> 
> where q is undefined! It should only be defined for integers. Similarly, x
> should only be integers.

Ummmm.  I guess I see the argument for dpois, but I thought the
distribution function was defined for all values.  Wouldn't it be in order
to apply the integer argument function to floor(q) perhaps?

This seems to be what S does.

	> ppois(1.5, 2)
	[1] 0.4060058
	> ppois(1.1, 2)
	[1] 0.4060058


	Ross



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:23:40 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:23:40 +1200 (NZST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <Pine.GSO.4.05.9904090652020.28479-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990409191434.3007A-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:

>      ppois(q, lambda)
> 
> where q is undefined! It should only be defined for integers. Similarly, x
> should only be integers.

Ummmm.  I guess I see the argument for dpois, but I thought the
distribution function was defined for all values.  Wouldn't it be in order
to apply the integer argument function to floor(q) perhaps?

This seems to be what S does.

	> ppois(1.5, 2)
	[1] 0.4060058
	> ppois(1.1, 2)
	[1] 0.4060058


	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:34:21 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:34:21 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090734.JAA00876@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999, Ross Ihaka wrote:

Some nonsense or other ... Never mind, it's late Friday.

But ...  How about dpois(1.2, 3) returning NA?

	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:28:24 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:28:24 +1200 (NZST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <Pine.BSF.3.96.990409191434.3007A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.BSF.3.96.990409192558.3007B-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999, Ross Ihaka wrote:

Some nonsense or other ... Never mind, it's late Friday.

But ...  How about dpois(1.2, 3) returning NA?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:36:37 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:36:37 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090736.JAA00880@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> In R0.64.0, try
> as.numeric(is.na(c(NA,NA,1)))
> as.numeric(c(T,T,F))

My version says

	> as.numeric(is.na(c(NA,NA,1)))
	[1] 1 1 0
	> as.numeric(c(T,T,F))
	[1] 1 1 0

which I think is ok?

	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:30:09 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:30:09 +1200 (NZST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904090639.IAA00863@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990409192859.3007C-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> In R0.64.0, try
> as.numeric(is.na(c(NA,NA,1)))
> as.numeric(c(T,T,F))

My version says

	> as.numeric(is.na(c(NA,NA,1)))
	[1] 1 1 0
	> as.numeric(c(T,T,F))
	[1] 1 1 0

which I think is ok?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 08:48:25 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 09:48:25 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090748.JAA00884@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:

> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
> 
> >      ppois(q, lambda)
> > 
> > where q is undefined! It should only be defined for integers. Similarly, x
> > should only be integers.
> 
> Ummmm.  I guess I see the argument for dpois, but I thought the
> distribution function was defined for all values.  Wouldn't it be in order
> to apply the integer argument function to floor(q) perhaps?

Try reading on:

> > It seems better to make ppois defined as the CDF for all q. The code
had
> > 
> >    x = floor(x + 0.5);
> >
> > and that should be something like floor(x + 1e-7).

(q in R is x in C.)

> This seems to be what S does.
> 
> 	> ppois(1.5, 2)
> 	[1] 0.4060058
> 	> ppois(1.1, 2)
> 	[1] 0.4060058

and R-0.64.1 does

> ppois(1.5, 2)
[1] 0.4060058
> ppois(1.1, 2)
[1] 0.4060058
> dpois(1.1, 2)
Warning: non-integer x = 1.100000
[1] 0

Happy?

Brian


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 09:55:56 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 10:55:56 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090855.KAA00972@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> and R-0.64.1 does
> 
> > ppois(1.5, 2)
> [1] 0.4060058
> > ppois(1.1, 2)
> [1] 0.4060058
> > dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0
> 
> Happy?

Almost. Do you use round(x) - x < 1e-7 or some such as criterion for
"integer"? (although I'd be hard pressed to come up with a natural
example where the argument to dpois is subject to FP accuracy issues)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 10:04:56 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 11:04:56 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090904.LAA01010@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:
> 
> > In R0.64.0, try
> > as.numeric(is.na(c(NA,NA,1)))
> > as.numeric(c(T,T,F))
> 
> My version says
> 
> 	> as.numeric(is.na(c(NA,NA,1)))
> 	[1] 1 1 0
> 	> as.numeric(c(T,T,F))
> 	[1] 1 1 0
> 
> which I think is ok?

Mine has 

> as.numeric(is.na(c(NA,NA,1)))
[1] -1 -1  0

Which is obviously not OK...

Seems to affect all numeric NA's:

> as.numeric(is.na(as.numeric(NA)))
[1] -1

This is on RedHat 5.2 (As Jim, I suspect)

Ick!

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 10:04:45 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 09 Apr 1999 11:04:45 +0200
Subject: a strange logical bug (PR#162)
In-Reply-To: Ross Ihaka's message of "Fri, 9 Apr 1999 19:30:09 +1200 (NZST)"
References: <Pine.BSF.3.96.990409192859.3007C-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <x2g16a411u.fsf@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:
> 
> > In R0.64.0, try
> > as.numeric(is.na(c(NA,NA,1)))
> > as.numeric(c(T,T,F))
> 
> My version says
> 
> 	> as.numeric(is.na(c(NA,NA,1)))
> 	[1] 1 1 0
> 	> as.numeric(c(T,T,F))
> 	[1] 1 1 0
> 
> which I think is ok?

Mine has 

> as.numeric(is.na(c(NA,NA,1)))
[1] -1 -1  0

Which is obviously not OK...

Seems to affect all numeric NA's:

> as.numeric(is.na(as.numeric(NA)))
[1] -1

This is on RedHat 5.2 (As Jim, I suspect)

Ick!

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 10:37:42 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 11:37:42 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090937.LAA01047@blueberry.kubism.ku.dk>

> Mine has 
> 
> > as.numeric(is.na(c(NA,NA,1)))
> [1] -1 -1  0
> 
> Which is obviously not OK...
> 
> Seems to affect all numeric NA's:
> 
> > A)))
> [1] -1
> 
> This is on RedHat 5.2 (As Jim, I suspect)

On RH 5.2

       The isnan() function returns a non-zero value if value  is
       "not-a-number" (NaN), and 0 otherwise.

and that non-zero is not defined!

On Solaris:

     isnan(), isnand(), and isnanf() return true (1) if the argu-
     ment dsrc or fsrc is a NaN; otherwise they return false (0).

and isnan is used in Arith.c for ISNAN and that is used in coerce.c
for do_isna (why?)

So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
solves this one for me.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  9 11:43:10 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt.Hornik@ci.tuwien.ac.at)
Date: Fri, 9 Apr 1999 12:43:10 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904091043.MAA03073@blueberry.kubism.ku.dk>

>>>>> ripley  writes:

> On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:
>> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
>> 
>> >      ppois(q, lambda)
>> > 
>> > where q is undefined! It should only be defined for integers. Similarly, x
>> > should only be integers.
>> 
>> Ummmm.  I guess I see the argument for dpois, but I thought the
>> distribution function was defined for all values.  Wouldn't it be in order
>> to apply the integer argument function to floor(q) perhaps?

> Try reading on:

>> > It seems better to make ppois defined as the CDF for all q. The code
> had
>> > 
>> >    x = floor(x + 0.5);
>> >
>> > and that should be something like floor(x + 1e-7).

> (q in R is x in C.)

>> This seems to be what S does.
>> 
>> > ppois(1.5, 2)
>> [1] 0.4060058
>> > ppois(1.1, 2)
>> [1] 0.4060058

> and R-0.64.1 does

>> ppois(1.5, 2)
> [1] 0.4060058
>> ppois(1.1, 2)
> [1] 0.4060058
>> dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0

> Happy?

No!  Why the warning?  dpois(non-integer, something) makes perfect
sense, and simply gives 0.

(Yes, dwilcox() and dsignrank() will need fixing, too ...)

-k

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  9 11:48:46 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 9 Apr 1999 12:48:46 +0200 (CEST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <199904090748.JAA00884@blueberry.kubism.ku.dk>
References: <199904090748.JAA00884@blueberry.kubism.ku.dk>
Message-ID: <14093.56078.682524.466080@pc87.maho.magnaeu.com>

>>>>> ripley  writes:

> On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:
>> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
>> 
>> >      ppois(q, lambda)
>> > 
>> > where q is undefined! It should only be defined for integers. Similarly, x
>> > should only be integers.
>> 
>> Ummmm.  I guess I see the argument for dpois, but I thought the
>> distribution function was defined for all values.  Wouldn't it be in order
>> to apply the integer argument function to floor(q) perhaps?

> Try reading on:

>> > It seems better to make ppois defined as the CDF for all q. The code
> had
>> > 
>> >    x = floor(x + 0.5);
>> >
>> > and that should be something like floor(x + 1e-7).

> (q in R is x in C.)

>> This seems to be what S does.
>> 
>> > ppois(1.5, 2)
>> [1] 0.4060058
>> > ppois(1.1, 2)
>> [1] 0.4060058

> and R-0.64.1 does

>> ppois(1.5, 2)
> [1] 0.4060058
>> ppois(1.1, 2)
> [1] 0.4060058
>> dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0

> Happy?

No!  Why the warning?  dpois(non-integer, something) makes perfect
sense, and simply gives 0.

(Yes, dwilcox() and dsignrank() will need fixing, too ...)

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Fri Apr  9 11:52:05 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Fri, 9 Apr 1999 12:52:05 +0200 (DFT)
Subject: Compilation problems with R-0.64.0
Message-ID: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>

Hi,

I have just tried to upgrade our AIX-machines to R-0.64.0 and encountered
some problems which, I think, are not AIX-specific.

1) The static variable class in "devX11.c" conflicts with a function
class() defined in math.h (using egcs-2.93.11). Therefore compilation
stops with an error message.

2) After renaming class to Visualclass in devX11.c everything looks fine
and an R binary file is created. However, it is not possible to open an
X11 window:

> x11()
Error: invalid colortype passed to X11 driver

3) Trying something like 

> options(X11colortype = "true")     
> x11()
> x<-seq(0,2*pi,len=100)
> plot(x,sin(x),ty="l")

works and draws a sine curve, but the tick marks are in a poor state: The
horizontal tick marks start at the left border of the graphics box, but
continue to the left crossing the legend. The vertical tick marks look
better, but apparently have infinite length and extend beyond the upper
border of the graphic box up to the borders of the X11 window.

4) The seq complains about a missing .Machine variable sometimes:

> x<-seq(0,2*pi,0.1)
Error: Object ".Machine" not found
> x<-seq(0,2*pi,len=100)

5) The fix command starts an editor, but leaves the original function
untouched afterwards... Commands like "myfunc<-vi(myfunc)" still work.

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 12:22:56 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 09 Apr 1999 13:22:56 +0200
Subject: a strange logical bug (PR#162)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Fri, 9 Apr 1999 11:37:42 +0200"
References: <199904090937.LAA01047@blueberry.kubism.ku.dk>
Message-ID: <x2btgy3unj.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> On RH 5.2
> 
>        The isnan() function returns a non-zero value if value  is
>        "not-a-number" (NaN), and 0 otherwise.
> 
> and that non-zero is not defined!

Uh-oh...

> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
> for do_isna (why?)

is.na(0/0) # Splus compat.

> So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
> solves this one for me.

But...(see above)

A better fix is 

#define ISNAN(x) (isnan(x)!=0)

Next problem: Messing with Arith.h and make'ing doesn't do anything
(dependency missing, obviously)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 12:23:01 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 13:23:01 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091123.NAA03290@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> On RH 5.2
> 
>        The isnan() function returns a non-zero value if value  is
>        "not-a-number" (NaN), and 0 otherwise.
> 
> and that non-zero is not defined!

Uh-oh...

> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
> for do_isna (why?)

is.na(0/0) # Splus compat.

> So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
> solves this one for me.

But...(see above)

A better fix is 

#define ISNAN(x) (isnan(x)!=0)

Next problem: Messing with Arith.h and make'ing doesn't do anything
(dependency missing, obviously)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Fri Apr  9 12:48:48 1999
From: N.J.Lee@statslab.cam.ac.uk (N.J.Lee@statslab.cam.ac.uk)
Date: Fri, 9 Apr 1999 13:48:48 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091148.NAA03668@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999 ripley@stats.ox.ac.uk wrote:

> > > as.numeric(is.na(c(NA,NA,1)))
> > [1] -1 -1  0
> > 
> > Seems to affect all numeric NA's:
> > 
> > > A)))
> > [1] -1
> > 
> > This is on RedHat 5.2 (As Jim, I suspect)
> 
> On RH 5.2

I don't seem to have this problem on Debian 2.2 (with glibc2.1):

> as.numeric(is.na(as.numeric(NA)))
[1] 1
> as.numeric(is.na(c(NA,NA,1)))
[1] 1 1 0


Nicholas



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>  Fri Apr  9 12:48:26 1999
From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk> (Nicholas Lee)
Date: Fri, 9 Apr 1999 12:48:26 +0100 (BST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904090937.LAA01047@blueberry.kubism.ku.dk>
Message-ID: <Pine.HPP.3.96.990409124522.22711B-100000@tiger.statslab.cam.ac.uk>


On Fri, 9 Apr 1999 ripley@stats.ox.ac.uk wrote:

> > > as.numeric(is.na(c(NA,NA,1)))
> > [1] -1 -1  0
> > 
> > Seems to affect all numeric NA's:
> > 
> > > A)))
> > [1] -1
> > 
> > This is on RedHat 5.2 (As Jim, I suspect)
> 
> On RH 5.2

I don't seem to have this problem on Debian 2.2 (with glibc2.1):

> as.numeric(is.na(as.numeric(NA)))
[1] 1
> as.numeric(is.na(c(NA,NA,1)))
[1] 1 1 0


Nicholas


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.ethz.ch  Fri Apr  9 13:52:01 1999
From: maechler@stat.ethz.ch (maechler@stat.ethz.ch)
Date: Fri, 9 Apr 1999 14:52:01 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091252.OAA03730@blueberry.kubism.ku.dk>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> ripley@stats.ox.ac.uk writes:
    >> On RH 5.2
    >> 
    >> The isnan() function returns a non-zero value if value is
    >> "not-a-number" (NaN), and 0 otherwise.
    >> 
    >> and that non-zero is not defined!

    PD> Uh-oh...

    >> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
    >> for do_isna (why?)

    PD> is.na(0/0) # Splus compat.

    >> So ISNAN needs to be redefined on Linux at least.  Using ISNA not
    >> ISNAN solves this one for me.

    PD> But...(see above)

    PD> A better fix is

    PD> #define ISNAN(x) (isnan(x)!=0)

oh dear;  and we had thought we would clean up the ISNAN definition and
do_isna[n] functions....
Are we all sure that this is *IT* for now...

Could we improve on the tests in  configure.in	to make sure beforehand
that  ISNAN will work?


    PD> Next problem: Messing with Arith.h and make'ing doesn't do anything
    PD> (dependency missing, obviously)

I've added ``a few of these'' to src/appl/Makefile.in and src/nmath/Makefile.in

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Fri Apr  9 15:45:42 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Fri, 9 Apr 1999 16:45:42 +0200 (DFT)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904091252.OAA03730@blueberry.kubism.ku.dk>
Message-ID: <Pine.A41.4.02.9904091639590.15648-100000@cauchy.mathematik.uni-essen.de>

On Fri, 9 Apr 1999 maechler@stat.math.ethz.ch wrote:

> oh dear;  and we had thought we would clean up the ISNAN definition and
> do_isna[n] functions....

I'm not sure if this fits into the discussion on do_isna, but can anybody
explain to me the following output from R-0.64.0 under AIX:

> NA
[1] NA
> NaN
[1]NaNQ
> par()$tck 
[1]NaNS

What's that? 

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri Apr  9 18:02:01 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 9 Apr 1999 19:02:01 +0200
Subject: Compilation problems with R-0.64.0 [AIX]
In-Reply-To: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>
 (message from Arne Kovac on Fri, 9 Apr 1999 12:52:05 +0200 (DFT))
References: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>
Message-ID: <199904091702.TAA13911@sophie.ethz.ch>

Arne,
thanks a lot for reporting the problems you had with R on AIX.

>> 1) The static variable class in "devX11.c" conflicts with a function
>> class() defined in math.h (using egcs-2.93.11). Therefore compilation
>> stops with an error message.

I've just changed this (using "Vclass") 
for "R-release-patch" aka 0.64.1(prerelease).

>> 2) x11()  gives a  big problem...

Can others confirm this problem?

[no time for more now ..

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum SOL G1;	Sonneggstr.33
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1086			<><
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 18:02:20 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 13:02:20 -0400
Subject: a strange logical bug (PR#162)
References: <199904091252.OAA03730@blueberry.kubism.ku.dk>
Message-ID: <370E329C.54D97C82@bank-banque-canada.ca>

I believe I am being bitten by the isna bug and will happily wait until it is
fixed before I check further. However, one message seemed to suggest this may
only be a problem in Linux, and I am running Solaris. If more detailed problem
reports on this would be useful will someone please let me know.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 18:16:35 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 9 Apr 1999 18:16:35 +0100 (BST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <370E329C.54D97C82@bank-banque-canada.ca>
Message-ID: <Pine.GSO.4.05.9904091814040.26950-100000@auk.stats>

On Fri, 9 Apr 1999, Paul Gilbert wrote:

> I believe I am being bitten by the isna bug and will happily wait until it is
> fixed before I check further. However, one message seemed to suggest this may
> only be a problem in Linux, and I am running Solaris. If more detailed problem
> reports on this would be useful will someone please let me know.

It is not a problem on Solaris, just on some Linux dialects where isnan
is no fully defined.

The fix is in R-release now: please check a snapshot after tomorrow, then
let us know about your isna bug!


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 19:37:37 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 14:37:37 -0400
Subject: eigen
Message-ID: <370E48F1.EBA98B18@bank-banque-canada.ca>

Eigen seems to be giving different results in 0.64 :

eigen(matrix(
 c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
   0.01262442, -0.1141633,  0.04989433, 0.006112607,
   0.04781087,  0.4177869, -0.15569656, 0.074242237,
   0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values

R:
 [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619

S:
[1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293

I am fairly sure that S and R previously gave the same results.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 20:09:13 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 15:09:13 -0400
Subject: dreaming?
Message-ID: <370E5058.AA54DE60@bank-banque-canada.ca>

I have a fairly comprehensive set of tests for my code, however, when my tests
report an error it still takes a fair amount of time to track down the problem.
It occured to me that it would be very nice to be able to run a supervisor
routine that could request an object be returned by an R calculation on a
different machine (different platform and/or different R version) and compare
the results. Has anyone considered this? It would certainly speed up the testing
cycle. Perhaps I could even trace back and narrow down the problem
automatically.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 01:28:03 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 02:28:03 +0200
Subject: eigen
In-Reply-To: Paul Gilbert's message of "Fri, 09 Apr 1999 14:37:37 -0400"
References: <370E48F1.EBA98B18@bank-banque-canada.ca>
Message-ID: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>

Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:

> Eigen seems to be giving different results in 0.64 :
> 
> eigen(matrix(
>  c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
>    0.01262442, -0.1141633,  0.04989433, 0.006112607,
>    0.04781087,  0.4177869, -0.15569656, 0.074242237,
>    0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values
> 
> R:
>  [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619
> 
> S:
> [1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293
> 
> I am fairly sure that S and R previously gave the same results.

Indeedy. At least the pre 63.3 binary I had lying about did give the S
results. The eigenvectors are also bogus as far as I can tell.

The weird thing is that eigen() goes via .Fortran to eigen.c
(which was f2c'ed at some point) and neither eigen.c or eigen.R has
been changed in 1999 according to the cvs logs. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 03:19:09 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 14:19:09 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz>


On 10 Apr 1999, Peter Dalgaard BSA wrote:

> Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:
> 
> > Eigen seems to be giving different results in 0.64 :
> > 
> > eigen(matrix(
> >  c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
> >    0.01262442, -0.1141633,  0.04989433, 0.006112607,
> >    0.04781087,  0.4177869, -0.15569656, 0.074242237,
> >    0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values
> > 
> > R:
> >  [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619
> > 
> > S:
> > [1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293
> > 
> > I am fairly sure that S and R previously gave the same results.
> 
> Indeedy. At least the pre 63.3 binary I had lying about did give the S
> results. The eigenvectors are also bogus as far as I can tell.
> 
> The weird thing is that eigen() goes via .Fortran to eigen.c
> (which was f2c'ed at some point) and neither eigen.c or eigen.R has
> been changed in 1999 according to the cvs logs. 
> 

Weirder still.  I get the problem results under Solaris with a clean
checkout of 0.65 but not under FreeBSD with a clean 0.65.
Solaris is using egcs and FreeBSD is using gcc 2.7.2.1.

I am beginning to suspect a compiler / library bug.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 04:00:55 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 09 Apr 1999 22:00:55 -0500
Subject: eigen
In-Reply-To: Ross Ihaka's message of "Sat, 10 Apr 1999 14:19:09 +1200 (NZST)"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <6rhfqp6uxk.fsf@verdi.stat.wisc.edu>

I also get the problem results under 0.64.0 compiled with egcs on
Linux/Intel - both RedHat and Debian systems.  When I checked the
RedHat system under 0.63.4 (not sure of the compiler) I got the other
set of results.  That pattern was repeated on a SPARC Solaris 2.6
system.  0.64.0 compiled with egcs gave the incorrect results and
0.63.4 compiled with an unknown compiler gave the correct results.
Same again on an Intel/Solaris 2.6 system.

I think the compiler that I used for the 0.63.4 builds was egcs-1.0.3
but I'm not sure.  I'll go back and re-build 0.64.0 with egcs-1.0.3
instead of egcs-1.1.1 and see what happens.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 04:37:04 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 09 Apr 1999 22:37:04 -0500
Subject: eigen
In-Reply-To: Douglas Bates's message of "09 Apr 1999 22:00:55 -0500"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu>
Message-ID: <6raewh6t9b.fsf@verdi.stat.wisc.edu>

>>>>> "DMB" == Douglas Bates <bates@stat.wisc.edu> writes:

  DMB> I think the compiler that I used for the 0.63.4 builds was
  DMB> egcs-1.0.3 but I'm not sure.  I'll go back and re-build 0.64.0
  DMB> with egcs-1.0.3 instead of egcs-1.1.1 and see what happens.

Changing to egcs-1.0.3 for a re-build of 0.64.0 didn't clear up the
problem.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 05:41:22 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 16:41:22 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990410160720.5666B-100000@g.ihaka.slip.auckland.ac.nz>


I don't know what the problem was, but I think I have a fix.  I have
replaced src/appl/eigen.c by the original set of fortran eispack routines. 
This seems to fix the problem on my Solaris box. 

I suspect that this bug may have been there for a while.

I am still puzzled that it was not tripped on my FreeBSD box.  It must be
the advanced compiler technology; it silently finds and fixes the bugs in
your code as you compile it :-).

Anyway could someone check that this change does the job on Linux etc.
(I've committed in both branches).

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sat Apr 10 06:21:47 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sat, 10 Apr 1999 06:21:47 +0100 (BST)
Subject: eigen
In-Reply-To: <Pine.BSF.3.96.990410160720.5666B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>

On Sat, 10 Apr 1999, Ross Ihaka wrote:

> I don't know what the problem was, but I think I have a fix.  I have
> replaced src/appl/eigen.c by the original set of fortran eispack routines. 
> This seems to fix the problem on my Solaris box. 

The bug is that Fortran.h had <math.h>, now has "Mathlib.h", and soemthing
in there is trampling over error.c

> I suspect that this bug may have been there for a while.

No, it _is_ a 0.64 change, 0.63.3 is unaffected.

> 
> I am still puzzled that it was not tripped on my FreeBSD box.  It must be
> the advanced compiler technology; it silently finds and fixes the bugs in
> your code as you compile it :-).

Look to header files in such circumstances. Mathlib.h includes

#include <errno.h>
#include <limits.h>
#include <float.h>
#include <math.h>
#include <stdlib.h>

and on Solaris the culprit is the last one of these.

Guess what: there a load of abs/fabs errors in eigen.c.  On some
systems abs is a macro, on others a function and on others it
depends on the optimization level.

> Anyway could someone check that this change does the job on Linux etc.
> (I've committed in both branches).

(Do you want to revert?)

What worries me is what else Mathlib.h might be trampling over.
I think we need to check this over.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 08:14:39 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 19:14:39 +1200 (NZST)
Subject: eigen
In-Reply-To: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990410190641.3295A-100000@g.ihaka.slip.auckland.ac.nz>


On Sat, 10 Apr 1999, Prof Brian D Ripley wrote:

> (Do you want to revert?)

I think eigen.c dates from days before we tried to be pure C for
portability purposes.  Provided we can live with the namespace pollution
which comes with Fortran (all function names being global), I'd actually
prefer to live with the original code. We've reverted the Linpack and
optimizer code already.

(Yeah, Yeah so why did I do the nmath thing?  I thought it might be more
generally useful than just for R ...) 
 
> What worries me is what else Mathlib.h might be trampling over.
> I think we need to check this over.

Definitely!

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 11:31:30 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 12:31:30 +0200
Subject: eigen
In-Reply-To: Douglas Bates's message of "09 Apr 1999 22:37:04 -0500"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu> <6raewh6t9b.fsf@verdi.stat.wisc.edu>
Message-ID: <x2g168dawt.fsf@blueberry.kubism.ku.dk>

Douglas Bates <bates@stat.wisc.edu> writes:

> >>>>> "DMB" == Douglas Bates <bates@stat.wisc.edu> writes:
> 
>   DMB> I think the compiler that I used for the 0.63.4 builds was
>   DMB> egcs-1.0.3 but I'm not sure.  I'll go back and re-build 0.64.0
>   DMB> with egcs-1.0.3 instead of egcs-1.1.1 and see what happens.
> 
> Changing to egcs-1.0.3 for a re-build of 0.64.0 didn't clear up the
> problem.

I also get the same result with different compilers (gcc 2.7.2.3 and
egcs-2.91.57) Note BTW that it *fails* the
consistency test from the example file

> m %*% V - V %*% diag(lam)
              [,1]          [,2]          [,3]          [,4]
[1,]  2.775558e-17  1.387779e-17  2.775558e-17 -3.382711e-17
[2,]  4.117019e-01  2.872937e-01 -2.687366e-01  7.624831e-02
[3,]  4.615645e-02  3.220889e-02 -3.012842e-02  8.548301e-03
[4,] -2.688891e-01 -1.876361e-01  1.755162e-01 -4.979899e-02

- whereas the older version did

>  m %*% V - V %*% diag(lam)
              [,1]          [,2]          [,3]          [,4]
[1,] -8.326673e-17  0.000000e+00  0.000000e+00 -2.622414e-18
[2,] -5.551115e-17  1.110223e-16  0.000000e+00 -1.368263e-16
[3,]  3.469447e-18 -2.775558e-17 -5.551115e-17  3.957338e-17
[4,] -5.551115e-17 -1.110223e-16  5.028530e-16  1.502704e-16

[0.63.4 in progress (March 9, 1999) on my office machine]

The test on symmetric matrices does not fail, though. (Make check
would have caught this, save for the m<-m+t(m) line...)

Most likely, we're being bitten  either by a code 'cleanup' or some
sort of change in the linked libraries.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 11:49:59 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 12:49:59 +0200
Subject: eigen
In-Reply-To: Peter Dalgaard BSA's message of "10 Apr 1999 12:31:30 +0200"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu> <6raewh6t9b.fsf@verdi.stat.wisc.edu> <x2g168dawt.fsf@blueberry.kubism.ku.dk>
Message-ID: <x2emlsda20.fsf@blueberry.kubism.ku.dk>

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> 
> The test on symmetric matrices does not fail, though. (Make check
> would have caught this, save for the m<-m+t(m) line...)
> 
> Most likely, we're being bitten  either by a code 'cleanup' or some
> sort of change in the linked libraries.
> 

Oops. Didn't see Brian+Ross's exchange before sending. Never mind.
Martin may still want to fix the example, though?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From mtim@farm.ecs.umass.edu  Sat Apr 10 18:35:45 1999
From: mtim@farm.ecs.umass.edu (mtim@farm.ecs.umass.edu)
Date: Sat, 10 Apr 1999 19:35:45 +0200
Subject: IRIX compile (PR#163)
Message-ID: <199904101735.TAA04499@blueberry.kubism.ku.dk>

Full_Name: Tim Middelkoop
Version: 0.64.0
OS: IRIX 6.3 on O2
Submission from: (NULL) (128.119.88.192)


Various IRIX complile  issues

src/nmath/pnt.c
IRIX cc does not like double negatives

Makeconf,config.site,etc/Makeconf
f77 pic hack, should change Makeconf.in or other...
change -PIC with -KPIC

enjoy, tim...
===

diff -ru orig/R-0.64.0/src/nmath/pnt.c R-0.64.0/src/nmath/pnt.c
--- orig/R-0.64.0/src/nmath/pnt.c       Wed Apr  7 02:45:48 1999
+++ R-0.64.0/src/nmath/pnt.c    Sat Apr 10 13:02:45 1999
@@ -80,7 +80,7 @@
        del = -del;
     }
 
-    if (df > 4e5 || del*del > 2*M_LN2*(-DBL_MIN_EXP)) {
+    if (df > 4e5 || del*del > 2*M_LN2*(-(DBL_MIN_EXP))) {
        /*-- 2nd part: if del > 37.62, then p=0 below
          FIXME: test should depend on `df', `tt' AND `del' ! */
        /* Approx. from  Abramowitz & Stegun 26.7.10 (p.949) */










-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Sat Apr 10 18:41:02 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sat, 10 Apr 1999 19:41:02 +0200 (CEST)
Subject: IRIX compile (PR#163)
In-Reply-To: <199904101735.TAA04499@blueberry.kubism.ku.dk>
References: <199904101735.TAA04499@blueberry.kubism.ku.dk>
Message-ID: <14095.36142.306970.30451@aragorn.ci.tuwien.ac.at>

>>>>> mtim  writes:

> Full_Name: Tim Middelkoop
> Version: 0.64.0
> OS: IRIX 6.3 on O2
> Submission from: (NULL) (128.119.88.192)


> Various IRIX complile  issues

> src/nmath/pnt.c
> IRIX cc does not like double negatives

> Makeconf,config.site,etc/Makeconf

> f77 pic hack, should change Makeconf.in or other...
> change -PIC with -KPIC

Sure about this?  Which version of f77 is this, the native one?

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Sat Apr 10 19:12:28 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sat, 10 Apr 1999 20:12:28 +0200 (CEST)
Subject: IRIX compile (PR#163)
In-Reply-To: <199904101735.TAA04499@blueberry.kubism.ku.dk>
References: <199904101735.TAA04499@blueberry.kubism.ku.dk>
Message-ID: <14095.38028.187255.911966@aragorn.ci.tuwien.ac.at>

>>>>> mtim  writes:

> Full_Name: Tim Middelkoop
> Version: 0.64.0
> OS: IRIX 6.3 on O2
> Submission from: (NULL) (128.119.88.192)


> Various IRIX complile  issues

> src/nmath/pnt.c
> IRIX cc does not like double negatives

> Makeconf,config.site,etc/Makeconf
> f77 pic hack, should change Makeconf.in or other...
> change -PIC with -KPIC

> enjoy, tim...
> ===

> diff -ru orig/R-0.64.0/src/nmath/pnt.c R-0.64.0/src/nmath/pnt.c
> --- orig/R-0.64.0/src/nmath/pnt.c       Wed Apr  7 02:45:48 1999
> +++ R-0.64.0/src/nmath/pnt.c    Sat Apr 10 13:02:45 1999
> @@ -80,7 +80,7 @@
>         del = -del;
>      }
 
> -    if (df > 4e5 || del*del > 2*M_LN2*(-DBL_MIN_EXP)) {
> +    if (df > 4e5 || del*del > 2*M_LN2*(-(DBL_MIN_EXP))) {
>         /*-- 2nd part: if del > 37.62, then p=0 below
>           FIXME: test should depend on `df', `tt' AND `del' ! */
>         /* Approx. from  Abramowitz & Stegun 26.7.10 (p.949) */

Both fixed in 0.64.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 21:35:38 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 11 Apr 1999 08:35:38 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2emlsda20.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990411082533.326A-100000@g.ihaka.slip.auckland.ac.nz>


The problem in eigen.c seems to be as follows.

1) f2c defines a macro abs() which does the standard abs() which
   works for all numeric types. This macro was inserted in Fortran.h.

2) recently it was recognised that there is an abs() in stdlib and
   the macro in Fortran.h was commented out.

3) unfortunately the abs() in stdlib is an integer valued function
   of an integer argument.

4) end of world.

I think the lesson is that partial translations of fortran into C and the
use of macros to get the rest of the way is VERY dangerous. 

Sometimes it is unavoidable, because we want to do some bit-fiddling or
platform dependent manipulation.  The lesson I think is to keep the use of
externally defined macros in the translations to a minimum. 

I am going to go through appl/ to look carefully at all the translations
for problems of this kind.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 22:11:32 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 11 Apr 1999 09:11:32 +1200 (NZST)
Subject: Fortran vs C
In-Reply-To: <Pine.BSF.3.96.990410190641.3295A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.BSF.3.96.990411090524.359A-100000@g.ihaka.slip.auckland.ac.nz>


To follow up the "eigen" issue.  What should our position on translating
Fortran into C be?  Should we leave as much code as possible in Fortran or
should we move it to C as much as possible? 

I can see arguments both ways.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 23:00:07 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 10 Apr 1999 17:00:07 -0500
Subject: Fortran vs C
In-Reply-To: Ross Ihaka's message of "Sun, 11 Apr 1999 09:11:32 +1200 (NZST)"
References: <Pine.BSF.3.96.990411090524.359A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>

>>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

  Ross> To follow up the "eigen" issue.  What should our position on
  Ross> translating Fortran into C be?  Should we leave as much code
  Ross> as possible in Fortran or should we move it to C as much as
  Ross> possible?

I can think of three different sets of circumstances:
 a) creating new code: This one is obvious, just say "no" to Fortran.
 b) enhancing existing code: For something small do the automatic
      translation to C with f2c then modify the C sources and regard
      those as the definitive version.  For a big Fortran routine, try
      to write a C wrapper around it and make modifications in the
      wrapper. 
 c) using established code without modification (e.g. Eispack, Linpack):
      Regard the Fortran sources as the definitive version and don't
      translate.

Now that g77 is available and reasonably stable, a lot of the
motivation for using f2c is gone.  There are still the messy linkage
issues when calling Fortran from C but most of those are now resolved
by the configure script.  Passing character strings, etc. will
continue to be problematic but most of the legacy Fortran code we
would use will be strictly numerical routines with, we hope,
comparatively simple calling sequences.  (Lapack is an exception in
that it uses strings to declare options but we aren't using Lapack.)

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 23:05:35 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Sat, 10 Apr 1999 17:05:35 -0500 (CDT)
Subject: R/S compatibility in passing a formula
Message-ID: <m10W5sd-0000X4C@verdi.stat.wisc.edu>

In S3 if you are passing an evaluated formula to another function that
will store it and use it in printing (such as a model-fitting function), you
usually want to unclass the formula.  Otherwise, the formula that gets
stored looks very ugly when printed.  A trick to do the unclassing is to pass
 form = c( myFormula )
In R this has the effect of making form a list rather than a call.  It
seems that passing
 form = as.vector( myFormula )
will work in both dialects.  Anyone else have experience with this?
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr 11 01:16:31 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 11 Apr 1999 02:16:31 +0200
Subject: R/S compatibility in passing a formula
In-Reply-To: Douglas Bates's message of "Sat, 10 Apr 1999 17:05:35 -0500 (CDT)"
References: <m10W5sd-0000X4C@verdi.stat.wisc.edu>
Message-ID: <x267743tb4.fsf@blueberry.kubism.ku.dk>

Douglas Bates <bates@stat.wisc.edu> writes:

> In S3 if you are passing an evaluated formula to another function that
> will store it and use it in printing (such as a model-fitting function), you
> usually want to unclass the formula.  Otherwise, the formula that gets
> stored looks very ugly when printed.  A trick to do the unclassing is to pass
>  form = c( myFormula )
> In R this has the effect of making form a list rather than a call.  It
> seems that passing
>  form = as.vector( myFormula )
> will work in both dialects.  Anyone else have experience with this?

Apparently

(a) R does not print the class on a formula (because print.formula
unclasses it)
(b) as.vector does not unclass in R but does in S3. Try
class(as.vector(form)) 

So the result of as.vector *looks* alike, but isn't. Smells like
trouble... 

Whatever is wrong with using unclass() for unclassing anyway??

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 08:30:40 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 11 Apr 1999 08:30:40 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>

On 10 Apr 1999, Douglas Bates wrote:

> >>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
> 
>   Ross> To follow up the "eigen" issue.  What should our position on
>   Ross> translating Fortran into C be?  Should we leave as much code
>   Ross> as possible in Fortran or should we move it to C as much as
>   Ross> possible?
> 
> I can think of three different sets of circumstances:
>  a) creating new code: This one is obvious, just say "no" to Fortran.
>  b) enhancing existing code: For something small do the automatic
>       translation to C with f2c then modify the C sources and regard
>       those as the definitive version.  For a big Fortran routine, try
>       to write a C wrapper around it and make modifications in the
>       wrapper. 
>  c) using established code without modification (e.g. Eispack, Linpack):
>       Regard the Fortran sources as the definitive version and don't
>       translate.
> 
> Now that g77 is available and reasonably stable, a lot of the
> motivation for using f2c is gone.  There are still the messy linkage
> issues when calling Fortran from C but most of those are now resolved
> by the configure script.  Passing character strings, etc. will
> continue to be problematic but most of the legacy Fortran code we
> would use will be strictly numerical routines with, we hope,
> comparatively simple calling sequences.  (Lapack is an exception in
> that it uses strings to declare options but we aren't using Lapack.)

[A long reply: I am much-bitten here!]

1) In my experience there are problems with error reporting via strings in
such Fortran code, as I found in loess (and found more easily in less
complicated packages). I wrote a two-step interface (in Fortran find the
string length, pass that and string back to C), and perhaps we should
set up warning and error subroutines to be called from Fortran to
standardize this that package writers/porters could use.


2) My motivation would be to use Fortran wherever it already exists. In the
world of scientific computing Fortran has been king and the effort in
compiler development has gone into efficient Fortran compilers with godd
optimizers. So on a Sun or DEC Alpha (and probably SGI) the original
Fortran used to run appreciably faster than the C translation (using the
native compilers), and although the gap has closed I think it is still
quite noticeable.  In my experience R can't afford that price. This may not
be an issue on Linux/Windows, but I expect is on Sun/DEC/SGI/HP.

BTW, I think that means that Doug's `just say "no" to Fortran' is not
obviously true if performance matters. This is likely to especially true if
single-precision calculations will do the job. (And, yes, I know about
Intel hardware but I don't see the need to slow a Sparc or Alpha FP unit
down to Intel speeds, especially older ones. I also know how to make C do
efficient float calculations using float libraries on Sparc, but that sort
of thing is a nightmare to configure portably, and also to link into S or 
R. It happens for free in Fortran.)


3) The problem is finding the external calls from Fortran code. In the base
code this should be not problem now we use the Fortran front-end to link.  
I have problems with quite a few packages that use Fortran, and have
translated some code myself just to avoid those. (It was a big problem in
the first release of MASS software for S-PLUS, and we removed all the 
Fortran to save ourselves the hastle of `it won't work on my XYZ system'
reports. We never made the Fortran work on HPs, whose Fortran name space
clashes with the C one, and it seemed that S had already grabbed some
critical symbols as C ones.)

I think in R we can do better than at present, if only I knew
exactly how. One idea is to have (effectively) a `hints' file that
configure uses to add a base set of libraries to FLIBS, but on Solaris
at least, using the Fortran command (f77 or g77) to link a dynamic library
does the job.  For linking with ld the base FLIBS would need to be

-lF77 -lM77 -lV77 -lsunmath -lm

_if_ f77 is used.  How viable is `use FC to link' on other platforms?

And to come back to beating a drum, if the dlopen option were RTLD_NOW
not RTLD_LAZY, these things would be easier to check. People keep sending
packages to CRAN that are incomplete (mclust seems to be now) and with
RTLD_NOW this is _much_ more likely to be noticed. Can we re-consider?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 08:39:59 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 11 Apr 1999 08:39:59 +0100 (BST)
Subject: R/S compatibility in passing a formula
In-Reply-To: <x267743tb4.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904110835440.3678-100000@auk.stats>

On 11 Apr 1999, Peter Dalgaard BSA wrote:

> Douglas Bates <bates@stat.wisc.edu> writes:
> 
> > In S3 if you are passing an evaluated formula to another function that
> > will store it and use it in printing (such as a model-fitting function), you
> > usually want to unclass the formula.  Otherwise, the formula that gets
> > stored looks very ugly when printed.  A trick to do the unclassing is to pass
> >  form = c( myFormula )
> > In R this has the effect of making form a list rather than a call.  It
> > seems that passing
> >  form = as.vector( myFormula )
> > will work in both dialects.  Anyone else have experience with this?
> 
> Apparently
> 
> (a) R does not print the class on a formula (because print.formula
> unclasses it)
> (b) as.vector does not unclass in R but does in S3. Try
> class(as.vector(form)) 
> 
> So the result of as.vector *looks* alike, but isn't. Smells like
> trouble... 
> 
> Whatever is wrong with using unclass() for unclassing anyway??

Because it is oldUnclass in recent S's, and having to use code translators
for S3/R/S-PLUS 5.x is a pain!   Nevertheless, that is what I do: write
oldUnclass() and translate.  (The reverse does not work: in S-PLUS 5 one
sometimes needs unclass()).

(I am pickily using S-PLUS 5 not S4: there is no public version of S4, but
S-PLUS 5 is quite different from S4 as documented in Chambers, 1998.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sun Apr 11 21:15:35 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 12 Apr 1999 08:15:35 +1200 (NZST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990412081348.339A-100000@g.ihaka.slip.auckland.ac.nz>


On Sun, 11 Apr 1999, Prof Brian D Ripley wrote:

> And to come back to beating a drum, if the dlopen option were RTLD_NOW
> not RTLD_LAZY, these things would be easier to check. People keep sending
> packages to CRAN that are incomplete (mclust seems to be now) and with
> RTLD_NOW this is _much_ more likely to be noticed. Can we re-consider?

I've changed in the devel (non) branch.  Let's see if it bites anyone 
(HPUX?). 

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 22:53:48 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Sun, 11 Apr 1999 23:53:48 +0200
Subject: [R] repeated measurements libraries v0.4 (PR#164)
Message-ID: <199904112153.XAA05566@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999, Jim Lindsey wrote:

> I have just uploaded version 0.4 of my libraries to the CRAN site.
> Hopefully, they will shortly become available.

Jim,

You have shipped growth with symbolic links to rmutil, and that is not even
listed as a Depends: in the DESCRIPTION. Symbolic links do not even exist
on some file systems!  (What happens with a VFAT file system on Linux,
or an SMB-mounted one?)

Could you please re-package this with the missing files? And it would be
very helpful to have correct dependencies listed. For the Windows port I
have put up today I copied the files across from rmutil.

As you know, my preference would be to have your packages in a single
bundle. To get all the cross-links in the man page one has to install your
packages in a certain order, and it would be helpful to know what it is! I
_think_ it is reverse-alphabetical, but am not sure even if it can be done
on one pass now (it used not to be able to).  This sort of thing would be
much easier to get right with a single package.

Brian

[Is this the sort of bug you think I should be sending to r-help? I am
sending it to the R-bugs database, in any case, so please tell R-bugs when
it is fixed.]

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:20:18 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:20:18 +0200 (CEST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
References: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>
 <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <14097.37026.863229.382113@pc87.maho.magnaeu.com>

>>>>> Prof Brian D Ripley writes:

> On 10 Apr 1999, Douglas Bates wrote:
>> >>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
>> 
Ross> To follow up the "eigen" issue.  What should our position on
Ross> translating Fortran into C be?  Should we leave as much code
Ross> as possible in Fortran or should we move it to C as much as
Ross> possible?
>> 
>> I can think of three different sets of circumstances:
>> a) creating new code: This one is obvious, just say "no" to Fortran.
>> b) enhancing existing code: For something small do the automatic
>> translation to C with f2c then modify the C sources and regard
>> those as the definitive version.  For a big Fortran routine, try
>> to write a C wrapper around it and make modifications in the
>> wrapper. 
>> c) using established code without modification (e.g. Eispack, Linpack):
>> Regard the Fortran sources as the definitive version and don't
>> translate.
>> 
>> Now that g77 is available and reasonably stable, a lot of the
>> motivation for using f2c is gone.  There are still the messy linkage
>> issues when calling Fortran from C but most of those are now resolved
>> by the configure script.  Passing character strings, etc. will
>> continue to be problematic but most of the legacy Fortran code we
>> would use will be strictly numerical routines with, we hope,
>> comparatively simple calling sequences.  (Lapack is an exception in
>> that it uses strings to declare options but we aren't using Lapack.)

> [A long reply: I am much-bitten here!]

> ...

> I think in R we can do better than at present, if only I knew exactly
> how. One idea is to have (effectively) a `hints' file that configure
> uses to add a base set of libraries to FLIBS, but on Solaris at least,
> using the Fortran command (f77 or g77) to link a dynamic library does
> the job.  For linking with ld the base FLIBS would need to be

> -lF77 -lM77 -lV77 -lsunmath -lm

> _if_ f77 is used.  How viable is `use FC to link' on other platforms?

Are you suggesting using the Fortran compiler as SHLIBLD?

Please help me understanding this a bit more.  The above `-lF77 ...'
would be the default FLIBS to use when compiling/linking Fortran?

Short term fix should be to use platform-specific overrides in basic
configure.  Another idea is to have configure scripts supported for add
ons.

(If I fully understood the problem, I think I could fix it ...)

=k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr 12 07:35:01 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Mon, 12 Apr 1999 07:35:01 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <14097.37026.863229.382113@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.05.9904120734010.9192-100000@auk.stats>

On Mon, 12 Apr 1999, Kurt Hornik wrote:

> >>>>> Prof Brian D Ripley writes:
> > I think in R we can do better than at present, if only I knew exactly
> > how. One idea is to have (effectively) a `hints' file that configure
> > uses to add a base set of libraries to FLIBS, but on Solaris at least,
> > using the Fortran command (f77 or g77) to link a dynamic library does
> > the job.  For linking with ld the base FLIBS would need to be
> 
> > -lF77 -lM77 -lV77 -lsunmath -lm
> 
> > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> 
> Are you suggesting using the Fortran compiler as SHLIBLD?

Yes, at least on platforms where this is known to be safe.

> Please help me understanding this a bit more.  The above `-lF77 ...'
> would be the default FLIBS to use when compiling/linking Fortran?

On Solaris.

> Short term fix should be to use platform-specific overrides in basic
> configure.  Another idea is to have configure scripts supported for add
> ons.
> 
> (If I fully understood the problem, I think I could fix it ...)

Yes!


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:56:11 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:56:11 +0200
Subject: add-on packages
Message-ID: <199904120656.IAA14380@pc87.maho.magnaeu.com>

Some further infos/thoughts/... on our add-on packages.

Here are the results of running a simple counting script on my system
(at home, not all available packages installed there):

Packages found:            59
  with INDEX               59
  with TITLE               59
  with DESCRIPTION         26
    with License info      21
  with data                25
    with data/00Index      11
    with data/index.doc     6

This is quite alarming (of course, the standard packages from the main
distribution currently do not have DESCRIPTION files)!  PLEASE update
your packages, the DESCRIPTION file is definitely needed!

(Also, some packages still have old-style .doc data documentation.)

Fritz and I are thinking about automating an add-on checking mechanism.
In addition to the above, info on which packages pass `R CMD check' etc
could be provided on a regular basis.

We are also thinking about automating the package build process (e.g.,
`R CMD build pkg').  An `INDEX' and a data index could be generated
automatically.  At build time, comparison of object usage as is and as
documented could be done.  Information on undocumented objects could be
provided.  `R CMD check' could be run.  And so on ...

Btw, re `INDEX': currently, if I document several objects in one Rd
file, I get only one INDEX entry (which is obtained from \title{}).
This is not satisfactory.  Maybe we should have something like
	\index{NAME}{TEXT}
???

I also want to propose adding a "Maintainer" field in DESCRIPTION.  In
the future we could use this info for both automatic checking and bug
reporting.

Another interesting fact is data duplication.  More than 10 data sets
show up in more than one package.  Maybe we should add these to the main
distribution then?

Finally (again?), please make sure that your packages do not mask system
features.

Thanks,
-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:56:11 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:56:11 +0200
Subject: PLATFORMS
Message-ID: <199904120656.IAA14375@pc87.maho.magnaeu.com>

Hmm ... no recent success stories on building 0.64?
Below is what we currently know of.

Thanks for feedback in advance,
-k

***********************************************************************
SUCCESSFUL BUILDS

R is known to configure, compile and run correctly on at least the
following platforms.  

0.63.3	i386	Linux Debian 2.1
		Linux Redhat 5.1, 5.2
		Linux SuSe 5.3, 6.0
		FreeBSD 2.2.5

	alpha	DEC OSF 4.0

	sparc	Linux RedHat 5.2
		Sun Solaris 2.6, 2.7

	ppc	Linux LinuxPPC 4

0.64.0	i386	Linux Debian 2.0

	sparc	Sun Solaris 2.5.1, 2.6

	hppa	HPUX 10.20

See below for more details and contact information.

If you have success on any others, please notify us by filling in the
template and the end of this file.  Make sure to mention any changes you
had to make so we can update this file and our installation procedures.

NOTE: a `successful' build is one that passes `make check'!

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC		egcs
FC		g77
MAKE		make

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC		gcc
FC		egcs-g77
MAKE		make

NAME		Göran Broström
EMAIL		gb@stat.umu.se
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.2
CC		gcc
FC		egcs-g77
MAKE		make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 5.3
CC		egcs-2.91.57
FC		GNU Fortran 0.5.24-19980804
MAKE		GNU Make version 3.76.1
NOTES		native SuSE 5.3 gcc/g77 do not work

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC		egcs-2.91.60
FC		GNU Fortran 0.5.24-19980804
MAKE		GNU Make version 3.76.1

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC		gcc
FC		egcs-g77
MAKE		make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        alpha-dec-osf4.0
SYSTEM          Digital Unix 4.0E
CC		DEC C V5.8-009 on Digital UNIX V4.0 (Rev. 1091)
FC		DIGITAL Fortran 77 V5.1 for DIGITAL UNIX
MAKE		GNU Make version 3.76.1

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		cc SC4.2
FC		f77 SC4.2
MAKE      	GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		egcs 1.1 gcc
FC		egcs 1.1 g77
MAKE		GNU make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME       	Göran Broström
EMAIL      	gb@stat.umu.se
VERSION    	0.63.3
PLATFORM   	sun-sparc-linux
SYSTEM     	Redhat 5.2
CC		gcc version egcs-2.90.29 980515 (egcs-1.0.3 release)
FC		egcs-g77
MAKE 		make

NAME       	Kurt Hornik
EMAIL      	Kurt.Hornik@ci.tuwien.ac.at
VERSION    	0.64.0(1999/04/03)
PLATFORM   	i586-unknown-linux
SYSTEM     	Debian 2.0
CC 		gcc 2.7.2.3
FC		egcs-2.90.29 980515 (egcs-1.0.3 release)
MAKE		GNU make 3.76.1

NAME       	Nicholas Lee
EMAIL      	njl25@cam.ac.uk
VERSION    	0.64.0 Unstable
PLATFORM   	i586-unknown-linux
SYSTEM     	Debian 2.2 Unstable
CC		egcs-1.1.2 gcc
FC		egcs-1.1.2 g77
MAKE		make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		Sun make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		cc SC4.2
FC		f77 SC4.2
MAKE		Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		egcs 1.1 gcc
FC		egcs 1.1 g77
MAKE		GNU make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.64
PLATFORM        hppa2.0
SYSTEM          hpux10.20
CC		egcs
FC		f2c
MAKE		GNU make

NAME		
EMAIL		
VERSION         
PLATFORM        
SYSTEM          
CC		
FC		
MAKE		
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon Apr 12 08:29:37 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 Apr 1999 09:29:37 +0200
Subject: eigen
In-Reply-To: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats> (message
 from Prof Brian D Ripley on Sat, 10 Apr 1999 06:21:47 +0100 (BST))
References: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>
Message-ID: <199904120729.JAA00508@sophie.ethz.ch>

>>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

    BDR> On Sat, 10 Apr 1999, Ross Ihaka wrote:

      >> I don't know what the problem was, but I think I have a fix.  I
      >> have replaced src/appl/eigen.c by the original set of fortran
      >> eispack routines.  This seems to fix the problem on my Solaris
      >> box.

    BDR> The bug is that Fortran.h had <math.h>, now has "Mathlib.h", and
    BDR> something in there is trampling over error.c

    >> I suspect that this bug may have been there for a while.

    BDR> No, it _is_ a 0.64 change, 0.63.3 is unaffected.

    >> 
    >> I am still puzzled that it was not tripped on my FreeBSD box.  It must be
    >> the advanced compiler technology; it silently finds and fixes the bugs in
    >> your code as you compile it :-).

    BDR> Look to header files in such circumstances. Mathlib.h includes

    BDR> #include <errno.h>
    BDR> #include <limits.h>
    BDR> #include <float.h>
    BDR> #include <math.h>
    BDR> #include <stdlib.h>

    BDR> and on Solaris the culprit is the last one of these.
(grrreat)

    BDR> Guess what: there a load of abs/fabs errors in eigen.c.  On some
    BDR> systems abs is a macro, on others a function and on others it
    BDR> depends on the optimization level.

We must use a Mathlib.h -- src/nmath/  version of this

    >> Anyway could someone check that this change does the job on Linux etc.
    >> (I've committed in both branches).

    BDR> (Do you want to revert?)

Yes! -- The eigen.c has been massaged etc to be quite a bit more readable
     than its Fortran counterpart..


    BDR> What worries me is what else Mathlib.h might be trampling over.
    BDR> I think we need to check this over.

certainly
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 10:09:29 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 10:09:29 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904120909.KAA28372@toucan.stats.ox.ac.uk>

Martin M has suggested I widen this discussion to R-devel, and 

> I agree that we should increase them,
> but I'm not sure at all about the amount.
> 
> The default could even depend on the architecture (via "./configure")..

Views, please.

------------- Begin Forwarded Message -------------

Is is not time we increased the defaults a bit? As the base gets bigger
I hit 200k cons cells rather frequently. And 2Mb of heap seems low
compared to 3Mb of cons cells and 1.8Mb for the R binary.

How little memory do people have these data?  Except possibly on Windows
and old teaching labs I would have thought using 15Mb default for R
was very reasonable, which is about

--vsize 6Mb --nsize 300k

On Solaris that gives:

  PID USERNAME THR PRI NICE  SIZE   RES STATE   TIME    CPU COMMAND
 9308 ripley     1 -25    0   15M 8360K sleep   0:02  4.35% R.binary

as against the default

  PID USERNAME THR PRI NICE  SIZE   RES STATE   TIME    CPU COMMAND
 9309 ripley     1 -25    0 9664K 6416K sleep   0:02  4.66% R.binary

and that extra user memory makes a lot of difference.


------------- End Forwarded Message -------------


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From albrecht.gebhardt@uni-klu.ac.at  Mon Apr 12 10:30:20 1999
From: albrecht.gebhardt@uni-klu.ac.at (Albrecht Gebhardt)
Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <Pine.OSF.4.05.9904121125330.19966-100000@zidsrv.sci.uni-klu.ac.at>

On Sun, 11 Apr 1999, Prof Brian D Ripley wrote:

>
> ... some lines deleted ...
>
> 3) The problem is finding the external calls from Fortran code. In the base
> code this should be not problem now we use the Fortran front-end to link.  
> I have problems with quite a few packages that use Fortran, and have
> translated some code myself just to avoid those. (It was a big problem in
> the first release of MASS software for S-PLUS, and we removed all the 
> Fortran to save ourselves the hastle of `it won't work on my XYZ system'
> reports. We never made the Fortran work on HPs, whose Fortran name space
> clashes with the C one, and it seemed that S had already grabbed some
> critical symbols as C ones.)
> 
> I think in R we can do better than at present, if only I knew
> exactly how. One idea is to have (effectively) a `hints' file that
> configure uses to add a base set of libraries to FLIBS, but on Solaris
> at least, using the Fortran command (f77 or g77) to link a dynamic library
> does the job.  For linking with ld the base FLIBS would need to be
> 
> -lF77 -lM77 -lV77 -lsunmath -lm
> 
> _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> 

I'm not sure if it does matter here, but the only way to build R on my
Alphas currently is using Fortran as LDCMD:

in config.site:
LDCMD="f77 -g -nofor_main -fpe3 "

SHLIBLD is "ld -shared -expect_unresolved '*'".



Albrecht

-------------------------------------------------------------------------------
Albrecht Gebhardt                   email   : albrecht.gebhardt@uni-klu.ac.at
Institut fuer Mathematik            Tel.    : (++43 463) 2700/837
Universitaet Klagenfurt             Fax     : (++43 463) 2700/834
Villacher Str. 161
A-9020 Klagenfurt, Austria
-------------------------------------------------------------------------------


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 10:45:07 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 10:45:07 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
Message-ID: <199904120945.KAA28971@toucan.stats.ox.ac.uk>


> Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
> From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>
> > I think in R we can do better than at present, if only I knew
> > exactly how. One idea is to have (effectively) a `hints' file that
> > configure uses to add a base set of libraries to FLIBS, but on Solaris
> > at least, using the Fortran command (f77 or g77) to link a dynamic library
> > does the job.  For linking with ld the base FLIBS would need to be
> > 
> > -lF77 -lM77 -lV77 -lsunmath -lm
> > 
> > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> > 
> 
> I'm not sure if it does matter here, but the only way to build R on my
> Alphas currently is using Fortran as LDCMD:
> 
> in config.site:
> LDCMD="f77 "
> 
> SHLIBLD is "ld -shared -expect_unresolved '*'".

I would have expected

LDCMD=f77
LDFLAGS="-g -nofor_main -fpe3"
SHLIBLD=ld
SHLIBLDFLAGS="-shared -expect_unresolved '*'"

as the way to encode that.  Now my question amounts to

Does SHLIBLD=f77 work with those SHLIBLDFLAGS?
If not, can SHLIBLDFLAGS be modified to make it work?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From osman.buyukisik@ae.ge.com  Mon Apr 12 13:39:00 1999
From: osman.buyukisik@ae.ge.com (U-E59264-Osman F Buyukisik)
Date: Mon, 12 Apr 1999 08:39:00 -0400 (EDT)
Subject: R-0.65-April-12 on hpux10.20
Message-ID: <14097.59185.477055.292796@c1186.ae.ge.com>

Hello,
 It looks like demo("dyn.load") is broken for non ".so" extentions.

> demo("dyn.load")


        demo(dyn.load)
        ---- ~~~~~~~~

Type  <Return>   to start : 

> dyn.load("zero.so")
Error in dyn.load(x) : unable to load shared library "/home/absd00t/zero.so":
  can't open /home/absd00t/zero.so
> 
It looks like zero.R problem. It is looking for zero.* in my home
dir. If I do :
~>R COMPILE zero.c
gcc -I/usr/include/Motif1.1 -I/usr/include/X11R4 -I/home/absd00t/local/include -fpic -I/home/absd00t/local/lib/R/include -c zero.c -o zero.o
~>R SHLIB -o zero.sl zero.o
ld -b -o zero.sl zero.o -L/home/absd00t/local/lib  -lf2c -lm

~>R

R : Copyright 1999, The R Development Core Team
Version 0.65.0 Under development (unstable) (April 12, 1999)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type    "?license" or "?licence" for distribution details.

R is a collaborative project with many contributors.
Type    "?contributors" for a list.

Type    "demo()" for some demos, "help()" for on-line help, or
        "help.start()" for a HTML browser interface to help.
Type    "q()" to quit R.

> dyn.load("zero.sl")
> source("zero.R")   <--- after changing zero.so to zero.sl
[1] 1.5
[1] 1.50000002235174
> 

Seems to be working OK.
Osman
 
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 14:08:13 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 14:08:13 +0100 (BST)
Subject: R-0.65-April-12 on hpux10.20
Message-ID: <199904121308.OAA05354@toucan.stats.ox.ac.uk>

> From: U-E59264-Osman F Buyukisik <absd00t@c1186.ae.ge.com>
> 
> Hello,
>  It looks like demo("dyn.load") is broken for non ".so" extentions.

Broken? Has it ever worked?

You need

dyn.load(paste("zero", .Platform$dynlib.ext, sep="."))

and I will put that in the release branch as this is a bug fix.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Mon Apr 12 15:17:33 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 12 Apr 1999 09:17:33 -0500
Subject: --nsize and --vsize
In-Reply-To: Prof Brian Ripley's message of "Mon, 12 Apr 1999 10:09:29 +0100 (BST)"
References: <199904120909.KAA28372@toucan.stats.ox.ac.uk>
Message-ID: <6rlnfxly82.fsf@verdi.stat.wisc.edu>

I would agree that:
 - it is reasonable to increase the default vsize and nsize
 - the default sizes should probably be architecture dependent
 - If possible, the default sizes should also be picked up from
   ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
   environment variables and use them

I think that 16M for vsize and 800k for nsize could be good global
defaults on many architectures.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Mon Apr 12 16:24:39 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Mon, 12 Apr 1999 08:24:39 -0700 (PDT)
Subject: add-on packages
In-Reply-To: <199904120656.IAA14380@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>

On Mon, 12 Apr 1999, Kurt Hornik wrote:
> Another interesting fact is data duplication.  More than 10 data sets
> show up in more than one package.  Maybe we should add these to the main
> distribution then?

I don't think this follows. Disk space is much cheaper than name space
(perhaps even when we get the promised new features)

> 
> Finally (again?), please make sure that your packages do not mask system
> features.

Note that this requires quite frequent checking -- system features do keep
being added.

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 16:45:50 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 17:45:50 +0200 (CEST)
Subject: add-on packages
In-Reply-To: <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>
References: <199904120656.IAA14380@pc87.maho.magnaeu.com>
 <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>
Message-ID: <14098.5422.232593.587310@pc87.maho.magnaeu.com>

>>>>> Thomas Lumley writes:

> On Mon, 12 Apr 1999, Kurt Hornik wrote:

>> Another interesting fact is data duplication.  More than 10 data sets
>> show up in more than one package.  Maybe we should add these to the main
>> distribution then?

> I don't think this follows. Disk space is much cheaper than name space
> (perhaps even when we get the promised new features)

O.k.

>> 
>> Finally (again?), please make sure that your packages do not mask system
>> features.

> Note that this requires quite frequent checking -- system features do
> keep being added.

I thought that this too could be a part of the automated process.
(After a successful `R CMD check', load the pkg and see if the warnings
occur.)

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Mon Apr 12 16:41:59 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 12 Apr 1999 11:41:59 -0400
Subject: Fortran vs C, easing using Fortran
References: <199904120945.KAA28971@toucan.stats.ox.ac.uk>
Message-ID: <37121447.77787569@bank-banque-canada.ca>

It seems to me that, at least for application packages, there is a strong
incentive to avoid both fortran and C. If eventual R, or a new language like
Omega, are to work in a "Java like" way across platforms, I think both fortran
and C are problems. Is that not correct?

I realize there is a performance issue, but I don't think it is as serious as it
was in old versions of Splus. I am not sure how slow my time series library
would be without the fortran. It used to be intolerable, but I have the
impression it may not be too bad now.

To some extent this must also apply to the core part of the language. Is there
not some incentive to remove, not add, both fortran and C except where they are
essential?

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 16:50:03 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 16:50:03 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904121550.QAA10948@toucan.stats.ox.ac.uk>


> To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
> Cc: R-devel@stat.math.ethz.ch
> Subject: Re: --nsize and --vsize
> From: Douglas Bates <bates@stat.wisc.edu>
> Date: 12 Apr 1999 09:17:33 -0500
> 
> I would agree that:
>  - it is reasonable to increase the default vsize and nsize
>  - the default sizes should probably be architecture dependent
>  - If possible, the default sizes should also be picked up from
>    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
>    environment variables and use them
> 
> I think that 16M for vsize and 800k for nsize could be good global
> defaults on many architectures.

But not I think for multi-user machines. That is 35Mb allocated (on Solaris)
and I would not want our students taking 35Mb for each R job, as the
current memory management really needs most of it resident. About half
that would be tolerable, hence my original figures.  We would like them 
to use perhaps 50Mb in total.

Also, that is too much for 64Mb Windows NT machines, and that is 
high-end for teaching labs.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From albrecht.gebhardt@uni-klu.ac.at  Mon Apr 12 17:27:46 1999
From: albrecht.gebhardt@uni-klu.ac.at (Albrecht Gebhardt)
Date: Mon, 12 Apr 1999 18:27:46 +0200 (MET DST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <199904120945.KAA28971@toucan.stats.ox.ac.uk>
Message-ID: <Pine.OSF.4.05.9904121806200.23217-100000@zidsrv.sci.uni-klu.ac.at>

On Mon, 12 Apr 1999, Prof Brian Ripley wrote:

> 
> > Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
> > From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>
> > > I think in R we can do better than at present, if only I knew
> > > exactly how. One idea is to have (effectively) a `hints' file that
> > > configure uses to add a base set of libraries to FLIBS, but on Solaris
> > > at least, using the Fortran command (f77 or g77) to link a dynamic library
> > > does the job.  For linking with ld the base FLIBS would need to be
> > > 
> > > -lF77 -lM77 -lV77 -lsunmath -lm
> > > 
> > > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> > > 
> > 
> > I'm not sure if it does matter here, but the only way to build R on my
> > Alphas currently is using Fortran as LDCMD:
> > 
> > in config.site:
> > LDCMD="f77 "
> > 
> > SHLIBLD is "ld -shared -expect_unresolved '*'".
> 
> I would have expected
> 
> LDCMD=f77
> LDFLAGS="-g -nofor_main -fpe3"
> SHLIBLD=ld
> SHLIBLDFLAGS="-shared -expect_unresolved '*'"
> 
> as the way to encode that.  Now my question amounts to
> 
> Does SHLIBLD=f77 work with those SHLIBLDFLAGS?
> If not, can SHLIBLDFLAGS be modified to make it work?
> 

splitting 
   LDCMD="f77 -g -nofor_main -fpe3 "
into 
   LDCMD=f77
   LDFLAGS="-g -nofor_main -fpe3"
results in

root@delta[R]# ./configure
loading cache ./config.cache
checking for a BSD compatible install... (cached) /usr/local/bin/install -c
checking whether ln -s works... (cached) yes
checking for ranlib... (cached) ranlib
checking for bison... (cached) bison -y
checking for ar... (cached) ar
checking for latex... (cached) /usr/local/bin/latex
checking for dvips... (cached) /usr/local/bin/dvips
checking for makeindex... (cached) /usr/local/bin/makeindex
checking for perl... (cached) /usr/local/bin/perl
checking whether perl is perl 5... yes
checking for cc... (cached) cc
checking for underscore after Fortran symbols... configure: error: Nothing
worked - cannot use FORTRAN

setting SHLIBLD to f77 and SHLIBLDFLAGS="-shared" works.
(SHLIBLDFLAGS="-shared -expect_unresolved '*'" fails, f77 doesn't
understand this linker option, but no matter: it would only suppress some
warnings)
BTW, the value of SHLIBLDFLAGS specified in config.site gets never used:
it will be overwritten from the configure script with the host specific
versions of SHLIBLDFLAGS.
The same thing for SHLIBLD, this is hardcoded to "ld" in configure.in.
 
But I think there is no difference between
  SHLIBLD=ld
  SHLIBLDFLAGS="-shared -expect_unresolved '*'"
and
  SHLIBLD=f77
  SHLIBLDFLAGS="-shared"
because f77 also calls ld (ok, with the correct Fortran libraries,
libUfor.so, libFutil.so, libots.so). I guess this works because I link R
with LDCMD="f77 -nofor_main", so it already contains the symbols of the
Fortran libraries.

Albrecht
-------------------------------------------------------------------------------
Albrecht Gebhardt                   email   : albrecht.gebhardt@uni-klu.ac.at
Institut fuer Mathematik            Tel.    : (++43 463) 2700/837
Universitaet Klagenfurt             Fax     : (++43 463) 2700/834
Villacher Str. 161
A-9020 Klagenfurt, Austria
-------------------------------------------------------------------------------



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 17:32:38 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 17:32:38 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
Message-ID: <199904121632.RAA11126@toucan.stats.ox.ac.uk>

>  From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>

> But I think there is no difference between
>   SHLIBLD=ld
>   SHLIBLDFLAGS="-shared -expect_unresolved '*'"
> and
>   SHLIBLD=f77
>   SHLIBLDFLAGS="-shared"
> because f77 also calls ld (ok, with the correct Fortran libraries,
> libUfor.so, libFutil.so, libots.so). I guess this works because I link R
> with LDCMD="f77 -nofor_main", so it already contains the symbols of the
> Fortran libraries.

Thanks, it is the `ok, with the correct Fortran libraries' we are looking for
here.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Mon Apr 12 21:53:57 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 Apr 1999 08:53:57 +1200 (NZST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <37121447.77787569@bank-banque-canada.ca>
Message-ID: <Pine.BSF.3.96.990413083608.275D-100000@g.ihaka.slip.auckland.ac.nz>


On Mon, 12 Apr 1999, Paul Gilbert wrote:

> It seems to me that, at least for application packages, there is a strong
> incentive to avoid both fortran and C. If eventual R, or a new language like
> Omega, are to work in a "Java like" way across platforms, I think both fortran
> and C are problems. Is that not correct?

IMHO: Java is (currently) too slow for production numerical work and I
suspect that this will remain the case for some time.  Java gets around
this by providing a way of calling Fortran and C.

I once heard an informed opinion that it would hard to get a language like
S to perform within a factor of 10 of optimized C or Fortran.  Most of the
time we can live with a factor of 10, but sometimes ...

There is also the issue of the code base available in Fortran (and to a
lesser extent in C).  It's a resource which can't be ignored.
 
> I realize there is a performance issue, but I don't think it is as serious as it
> was in old versions of Splus. I am not sure how slow my time series library
> would be without the fortran. It used to be intolerable, but I have the
> impression it may not be too bad now.

For the most part, the numerical methods in S are implemented in Fortran
I think. So even if you don't see it, it's there.

> To some extent this must also apply to the core part of the language. Is there
> not some incentive to remove, not add, both fortran and C except where they are
> essential?

Actually, I quite like Fortran for expressing numerical computations (yes
I should probably keep my dirty habits to myself :-).  I'd prefer Algol60
but that's not really an option. I'd certainly like foreign language calls
to remain an option.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Mon Apr 12 23:41:12 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Mon, 12 Apr 1999 23:41:12 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.HPP.3.96.990412233602.25145B-100000@tiger.statslab.cam.ac.uk>


On 12 Apr 1999, Douglas Bates wrote:

> I would agree that:
>  - it is reasonable to increase the default vsize and nsize
>  - the default sizes should probably be architecture dependent
>  - If possible, the default sizes should also be picked up from
>    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
>    environment variables and use them
> 
> I think that 16M for vsize and 800k for nsize could be good global
> defaults on many architectures.

If the environment variables where used (best solution), wouldn't it be
better to tell people in the memory exhaustion at startup warning message
that this option existed.  Rather than defaulting to a potentially
wasteful use of memory. 


Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>  Tue Apr 13 00:02:21 1999
From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk> (Nicholas Lee)
Date: Tue, 13 Apr 1999 00:02:21 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.BSF.3.96.990413083608.275D-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.HPP.3.96.990412231928.25145A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Ross Ihaka wrote:

> On Mon, 12 Apr 1999, Paul Gilbert wrote:

> > Omega, are to work in a "Java like" way across platforms, I think both fortran
> > and C are problems. Is that not correct?
> 
> IMHO: Java is (currently) too slow for production numerical work and I
> suspect that this will remain the case for some time.  Java gets around
> this by providing a way of calling Fortran and C.

The addage I've seen seen concerning Java currently is, "Write Once, Test
Everywhere."  Quite a part from this, the language itself isn't completely
stable and (free) optimised compilers always lag language modifications.


 
> I once heard an informed opinion that it would hard to get a language like
> S to perform within a factor of 10 of optimized C or Fortran.  Most of the
> time we can live with a factor of 10, but sometimes ...

I thought that R compiler you where talking about, was a way to go? ;)

> > I realize there is a performance issue, but I don't think it is as serious as it
> > was in old versions of Splus. I am not sure how slow my time series library
> > would be without the fortran. It used to be intolerable, but I have the
> > impression it may not be too bad now.

The difference performance of computers and amounts of avaiable memory,
would make retrospective benchmarks trickly. 

 

Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 06:06:51 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 13 Apr 1999 06:06:51 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <Pine.HPP.3.96.990412233602.25145B-100000@tiger.statslab.cam.ac.uk>
Message-ID: <Pine.GSO.4.05.9904130604390.17276-100000@auk.stats>

On Mon, 12 Apr 1999, Nicholas Lee wrote:

> 
> On 12 Apr 1999, Douglas Bates wrote:
> 
> > I would agree that:
> >  - it is reasonable to increase the default vsize and nsize
> >  - the default sizes should probably be architecture dependent
> >  - If possible, the default sizes should also be picked up from
> >    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
> >    environment variables and use them
> > 
> > I think that 16M for vsize and 800k for nsize could be good global
> > defaults on many architectures.
> 
> If the environment variables where used (best solution), wouldn't it be
> better to tell people in the memory exhaustion at startup warning message
> that this option existed.  Rather than defaulting to a potentially
> wasteful use of memory. 

Well, the flags exist now.  The `potentially wasteful' part is running out
of memory after a lot of work.  My comment is that at present the workspace
is less than half the total memory used: If you are going to use 10Mb
by default, why not use 15?


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 07:45:54 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 13 Apr 1999 07:45:54 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>

Based on the discussion so far, I have committed changes to 
`Version 0.64.0 Patched' that

  Uses R_NSIZE and R_VSIZE if set.

  Allows --nsize and --vsize to override these.

  Retains the previous minimum settings (200k and 2M) but if the user sets
  nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
  loaded.)

This is in system.unix.c, so Unix-only. (I see no reason not to so
this under Windows too, although there are other ways there).

The only snag I see is that there is no way to change this on an
installation-wide basis except to edit bin/R or include/Defn.h
and re-compile, but I guess that (especially the first) is safe enough.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 09:50:02 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 10:50:02 +0200
Subject: --nsize and --vsize
In-Reply-To: Prof Brian D Ripley's message of "Tue, 13 Apr 1999 07:45:54 +0100 (BST)"
References: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>
Message-ID: <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>

Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

>   Allows --nsize and --vsize to override these.
> 
>   Retains the previous minimum settings (200k and 2M) but if the user sets
>   nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
>   loaded.)
...
> The only snag I see is that there is no way to change this on an
> installation-wide basis except to edit bin/R or include/Defn.h
> and re-compile, but I guess that (especially the first) is safe enough.

Isn't that essentially the original purpose of using a shell script
(Win/Mac notwithstanding)? If we want it even easier, we could have
bin/R doing something like

...
$R_ENV=${R_ENV:-$RHOME/site/Renviron.sh}
[ -x $R_ENV ] && source $R_ENV
$R_NSIZE=${R_NSIZE:-250K}
...



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 13 11:02:10 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Tue, 13 Apr 1999 12:02:10 +0200
Subject: make check (PR#165)
Message-ID: <199904131002.MAA10093@blueberry.kubism.ku.dk>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Type: text/plain; charset=us-ascii

R 0.64.0 on RedHat Linux 5.1

I decided to add a "make check" command in the R RPM spec file
to ensure that R works properly before packaging it up.  I
found (by sabotaging one of the *.Rout.save files) that errors
found by "make check" are ignored and do not cause make to exit
abnormally. This means that there is no way for rpm to know that
the checks have failed, and the RPM package gets built anyway.

I changed this by removing the "-" flag in test-All, as in the
attached patch. I'm sure there was a reason the flag was there,
but it is a problem for me, so I'm submitting this as a bug
report.

Martyn


--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Disposition: attachment; filename="R-makecheck.patch"
Content-Transfer-Encoding: 7bit
Content-Description: R-makecheck.patch
Content-Type: text/plain;
 charset=us-ascii; name=R-makecheck.patch; SizeOnDisk=306

# Remove "ignore" flag from test-All so that
# build will fail if "make check" fails.
#
--- Makefile.in	Wed Jan  6 16:37:37 1999
+++ Makefile.in.patched	Tue Apr 13 11:00:42 1999
@@ -151,4 +151,4 @@
 
 check test:: test-All
 test-All test-Examples::
-	-@(cd tests && $(MAKE) $@)
+	@(cd tests && $(MAKE) $@)

--_=XFMail.1.3.p0.Linux:990413120342:8241=_--
End of MIME message

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 13 11:03:42 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Tue, 13 Apr 1999 12:03:42 +0200 (CEST)
Subject: make check
Message-ID: <XFMail.990413120342.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Type: text/plain; charset=us-ascii

R 0.64.0 on RedHat Linux 5.1

I decided to add a "make check" command in the R RPM spec file
to ensure that R works properly before packaging it up.  I
found (by sabotaging one of the *.Rout.save files) that errors
found by "make check" are ignored and do not cause make to exit
abnormally. This means that there is no way for rpm to know that
the checks have failed, and the RPM package gets built anyway.

I changed this by removing the "-" flag in test-All, as in the
attached patch. I'm sure there was a reason the flag was there,
but it is a problem for me, so I'm submitting this as a bug
report.

Martyn


--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Disposition: attachment; filename="R-makecheck.patch"
Content-Transfer-Encoding: 7bit
Content-Description: R-makecheck.patch
Content-Type: text/plain;
 charset=us-ascii; name=R-makecheck.patch; SizeOnDisk=306

# Remove "ignore" flag from test-All so that
# build will fail if "make check" fails.
#
--- Makefile.in	Wed Jan  6 16:37:37 1999
+++ Makefile.in.patched	Tue Apr 13 11:00:42 1999
@@ -151,4 +151,4 @@
 
 check test:: test-All
 test-All test-Examples::
-	-@(cd tests && $(MAKE) $@)
+	@(cd tests && $(MAKE) $@)

--_=XFMail.1.3.p0.Linux:990413120342:8241=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Tue Apr 13 11:14:26 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 Apr 1999 12:14:26 +0200 (CEST)
Subject: --nsize and --vsize
In-Reply-To: <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>
References: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>
 <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>
Message-ID: <14099.6402.52677.10185@pc87.maho.magnaeu.com>

>>>>> Peter Dalgaard BSA writes:

> Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
>> Allows --nsize and --vsize to override these.
>> 
>> Retains the previous minimum settings (200k and 2M) but if the user sets
>> nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
>> loaded.)
> ...
>> The only snag I see is that there is no way to change this on an
>> installation-wide basis except to edit bin/R or include/Defn.h
>> and re-compile, but I guess that (especially the first) is safe enough.

> Isn't that essentially the original purpose of using a shell script
> (Win/Mac notwithstanding)? If we want it even easier, we could have
> bin/R doing something like

> ...
> $R_ENV=${R_ENV:-$RHOME/site/Renviron.sh}
> [ -x $R_ENV ] && source $R_ENV
> $R_NSIZE=${R_NSIZE:-250K}
> ...

Something like that, similar to forthcoming R `rc' files (now profile):

	system rc from R_HOME/VERSION/...
	site rc from R_HOME/site/.../Rrc
	user rc from ./.Rrc or ~/.Rrc

	system environ from R_HOME/VERSION/...
	site environ from R_HOME/site/.../Renviron
	user environ from ./.Renviron or ~/.Renviron

Of course, then we'd need options

	--no-user-env
	--no-site-env

and I think I'd maybe want (for 1.0)

	--no-user-file => --no-user-rc
	--no-site-file => --no-site-rc

or (maybe better) keep what we have and interpret it as `files' so that
neither rc no env file would be used.

-k

Btw, I'd use `-r' ...

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Tue Apr 13 11:39:00 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Tue, 13 Apr 1999 11:39:00 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <Pine.GSO.4.05.9904130604390.17276-100000@auk.stats>
Message-ID: <Pine.HPP.3.96.990413112824.25549A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Prof Brian D Ripley wrote:

> Well, the flags exist now.  The `potentially wasteful' part is running out

The flags exist, but in the adage of the lazy programmer, "less
keystrokes, means less RSI/bugs."   One nice option would be for R to probe
the size of the .RData file, and rather than dieing on you if it's too
large, giving you option of loading it with XX extra memory.

> of memory after a lot of work.  My comment is that at present the workspace
> is less than half the total memory used: If you are going to use 10Mb
> by default, why not use 15?

This is always going to be the case since R uses a static memory heap.
So the question arises; if the default is 15, why not 20...? 


The best solution would be for system wide config flags or ENVIRONMENT
variables, as this would allow people to set a memory usage policy given
the amount of library functions they have, general memory usage patterns,
and personal inclinations. 


Nicholas 

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Tue Apr 13 11:53:36 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Tue, 13 Apr 1999 11:53:36 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904131053.LAA17041@toucan.stats.ox.ac.uk>


> Date: Tue, 13 Apr 1999 11:39:00 +0100 (BST)
> From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>
> 
> On Tue, 13 Apr 1999, Prof Brian D Ripley wrote:
> 
> > Well, the flags exist now.  The `potentially wasteful' part is running out
> 
> The flags exist, but in the adage of the lazy programmer, "less
> keystrokes, means less RSI/bugs."   One nice option would be for R to probe
> the size of the .RData file, and rather than dieing on you if it's too
> large, giving you option of loading it with XX extra memory.

Fine. Please write the code to do this and submit it to us. (It would be
good to see your name in ?contributors.)

For the rest (why 15M?, best policy), please catch up with your reading
of R-devel.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Tue Apr 13 13:59:17 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Tue, 13 Apr 1999 13:59:17 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <199904131053.LAA17041@toucan.stats.ox.ac.uk>
Message-ID: <Pine.HPP.3.96.990413124738.25580A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Prof Brian Ripley wrote:

> > The flags exist, but in the adage of the lazy programmer, "less
> > keystrokes, means less RSI/bugs."   One nice option would be for R to probe


Here is a quick solution in the R.sh.in file: (Although it might be nicer
to do this via getenv("R_VSIZE") in the system.c) 

[ -f ${HOME}/.Renviron ] && . ${HOME}/.Renviron
[ "$R_VSIZE" != "" ] && ARG_STACK="$ARG_STACK --vsize $R_VSIZE"
[ "$R_NSIZE" != "" ] && ARG_STACK="$ARG_STACK --nsize $R_NSIZE"

exec ${RHOME}/bin/${RBINARY} $ARG_STACK "$@"


The only problem with this is:
-->8--
$ echo "R_VSIZE=20M" > ~/.Renviron  (or export R_VSIZE=20M)
$ R --vsize 4M
WARNING: invalid v(ector heap)size '4194304' ignored;using default = 20M

R : Copyright 1999, The R Development Core Team
[...]
> 
-->8--

I assume that --(v|n)size should override enviroment defaults?  

So we could fix that, by accepting the second --vsize option from $@,
instead of the first --vsize from the $ARG_STACK. 

That probably means some mickying around with: 

if(value < R_NSize || value > Max_Nsize) 
    REprintf("WARNING: ...
else
    R_NSize = value;


So what should the default action be?

> > the size of the .RData file, and rather than dieing on you if it's too
> > large, giving you option of loading it with XX extra memory.

Since InitMemory() is called before R_InitialData(), this might be
trickly.  Either involving some magic in the shell script wrapper or
pre-checking the size of the .RData file before calling InitMemory.


Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 18:29:17 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Tue, 13 Apr 1999 19:29:17 +0200
Subject: outer fails with group generic operations on factors (PR#166)
Message-ID: <199904131729.TAA18570@biostat.ku.dk>

B <- A <- factor(c("a", "b"))
outer(A, B, "!=")
Warning: "FUN" not meaningful for factors
     [,1] [,2]
[1,]   NA   NA
[2,]   NA   NA

Now, this used to work in 0.63.2, but someone `improved' outer. There
it did an implicit as.numeric. The problem is that get in match.fun does
not understand group generics, and gets

Browse[1]> FUN
.Primitive("!=")

This _should_ launch Ops.factor, but does not.

> "!="(A, B)
[1] FALSE FALSE
> get("!=")(A, B)
Warning: "" not meaningful for factors
[1] NA NA



This causes misclass.tree(, detail=F) in package tree to fail.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.6
 arch = sparc
 os = solaris2.6
 system = sparc, solaris2.6
 status = 
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 8
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 19:03:01 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 20:03:01 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Tue, 13 Apr 1999 19:29:17 +0200"
References: <199904131729.TAA18570@biostat.ku.dk>
Message-ID: <x2g164gzze.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> Browse[1]> FUN
> .Primitive("!=")
> 
> This _should_ launch Ops.factor, but does not.
> 
> > "!="(A, B)
> [1] FALSE FALSE
> > get("!=")(A, B)
> Warning: "" not meaningful for factors
> [1] NA NA
> 

Actually, it *does* launch Ops.factor, but it gets confused by garbage
in .Generic. The bug is this line in DispatchGroup:

    sprintf(generic, "%s", CHAR(PRINTNAME(CAR(call))));

which presumably should rather look at the "op" arg. 

I'll have a closer look.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 19:42:38 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 20:42:38 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: Peter Dalgaard BSA's message of "13 Apr 1999 20:03:01 +0200"
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk>
Message-ID: <x2btgsgy5d.fsf@blueberry.kubism.ku.dk>

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> Actually, it *does* launch Ops.factor, but it gets confused by garbage
> in .Generic. The bug is this line in DispatchGroup:
> 
>     sprintf(generic, "%s", CHAR(PRINTNAME(CAR(call))));
> 
> which presumably should rather look at the "op" arg. 
> 
> I'll have a closer look.

It *apparently* works to change the above line to:

 sprintf(generic, "%s", PRIMNAME(op));

"make check" completes (haven't checked the output yet), but can we
*really* be sure that "op" is a .Primitive at that point?

Anyone know better?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Tue Apr 13 21:51:52 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 Apr 1999 08:51:52 +1200 (NZST)
Subject: --nsize and --vsize
In-Reply-To: <199904131053.LAA17041@toucan.stats.ox.ac.uk>
Message-ID: <Pine.BSF.3.96.990414084552.244D-100000@g.ihaka.slip.auckland.ac.nz>


On Tue, 13 Apr 1999, Prof Brian Ripley wrote:

> Fine. Please write the code to do this and submit it to us. (It would be
> good to see your name in ?contributors.)

Egads, Another Aucklander!

Looks like we're singlehandedly curing the "small number of people in the
field" problem which John Chambers mentioned :-). 

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 14 07:31:01 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 Apr 1999 08:31:01 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: <x2g164gzze.fsf@blueberry.kubism.ku.dk> (message from Peter
 Dalgaard BSA on 13 Apr 1999 20:03:01 +0200)
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk>
Message-ID: <199904140631.IAA29602@sophie.ethz.ch>

Which reminds me of another long-standing  
UseMethod / NextMethod / Dispatch problem that I've never traced/solved..

Look at the  $RHOME/tests/mode-methods.R   file !
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 14 09:21:40 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 14 Apr 1999 10:21:40 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: Martin Maechler's message of "Wed, 14 Apr 1999 08:31:01 +0200"
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk> <199904140631.IAA29602@sophie.ethz.ch>
Message-ID: <x27lrfa9yj.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> Which reminds me of another long-standing  
> UseMethod / NextMethod / Dispatch problem that I've never traced/solved..
> 
> Look at the  $RHOME/tests/mode-methods.R   file !

..i.e. this:
abc <- function(x, ...) {
    if (is.null(class(x))) class(x) <- data.class(x)
    UseMethod("abc")
}

will dispatch on the data class in S but not in R.

This puzzles me, because normally you can't mess with the arguments of
a generic function, in *either* language:

> cde<-function(x,...){x<-x*2;UseMethod("print")}
> cde(2)
[1] 2

So, either it's because class<- is non-duplicating in S, or S is doing
something *really* strange here. 

Hmm, then again: class<- *is* non-duplicating in R:

> x<-1
> y<-.Alias(x)
> class(x)<-'foo'
> y
[1] 1
attr(,"class")
[1] "foo"

I think this is related to evaluation of promises:

> f<-function(x)substitute(x)
> f(sin(1))
sin(1)
> f<-function(x){x;substitute(x)}
> f(sin(1))
sin(1)
> f<-function(x){class(x)<-'foo';substitute(x)}
> f(sin(1))
[1] 0.841471
attr(,"class")
[1] "foo"

Notice that just forcing evaluation of x does not destroy the link
between x and the argument expression, but changing its class does.
This is probably what shouldn't happen.

You can get the dispatching done by using

abc <- function(x, ...) {
    if (is.null(class(x))) {
	class(x) <- data.class(x)
	abc(x, ...)
    } else
        UseMethod("abc")
}

which (seemingly) works in both languages, at least as long as you
don't have to mess with sys.parent()

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Wed Apr 14 10:23:20 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Wed, 14 Apr 1999 11:23:20 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904140923.LAA25445@biostat.ku.dk>

       (opening new bug report thread, on suggestion of BDR ..)

I said on vaguely related topic:

 MM> There's  another long-standing  
 MM> UseMethod / NextMethod / Dispatch problem that I've never traced/solved..
 MM>  
 MM> Look at the  $RHOME/tests/mode-methods.R   file !

Peter Dalgaard already remarked :

 PD> ..i.e. this:

 PD> abc <- function(x, ...) {
 PD>     if (is.null(class(x))) class(x) <- data.class(x)
 PD>     UseMethod("abc")
 PD> }
 PD> 
 PD> will dispatch on the data class in S but not in R.
 PD> 
 PD> This puzzles me, because normally you can't mess with the arguments of
 PD> a generic function, in *either* language:
 PD> 
 PD> > cde<-function(x,...){x<-x*2;UseMethod("print")}
 PD> > cde(2)
 PD> [1] 2
 PD> 
 PD> So, either it's because class<- is non-duplicating in S, or S is doing
 PD> something *really* strange here. 
 PD> 
 PD> Hmm, then again: class<- *is* non-duplicating in R:
 PD> 
 PD> > x<-1
 PD> > y<-.Alias(x)
 PD> > class(x)<-'foo'
 PD> > y
 PD> [1] 1
 PD> attr(,"class")
 PD> [1] "foo"
 PD> 
 PD> I think this is related to evaluation of promises:
 PD> 
 PD> > f<-function(x)substitute(x)
 PD> > f(sin(1))
 PD> sin(1)
 PD> > f<-function(x){x;substitute(x)}
 PD> > f(sin(1))
 PD> sin(1)
 PD> > f<-function(x){class(x)<-'foo';substitute(x)}
 PD> > f(sin(1))
 PD> [1] 0.841471
 PD> attr(,"class")
 PD> [1] "foo"
 PD> 
 PD> Notice that just forcing evaluation of x does not destroy the link
 PD> between x and the argument expression, but changing its class does.
 PD> This is probably what shouldn't happen.
 PD> 
 PD> You can get the dispatching done by using
 PD> 
 PD> abc <- function(x, ...) {
 PD>     if (is.null(class(x))) {
 PD> 	class(x) <- data.class(x)
 PD> 	abc(x, ...)
 PD>     } else
 PD>         UseMethod("abc")
 PD> }
 PD> 
 PD> which (seemingly) works in both languages, at least as long as you
 PD> don't have to mess with sys.parent()

So we don't know if this is a bug in R.
However, R is behaving inexpectedly to ``Joe Average-User''
and at least we should know if (and why)
we want to be different than S here.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 14 15:29:54 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 14 Apr 1999 10:29:54 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <199904140923.LAA25445@biostat.ku.dk>
Message-ID: <Pine.SV4.4.05.9904141016170.18981-100000@hsph.harvard.edu>


I'm pretty sure we've been through this one several times already,
although probably in different guises.
The discussion in the white book, section A.6 is rather specific about
this. And as near as I can tell is contrary to what S does. I don't think
that you want to do what S does.

Do you really want to have a language that accepts any change in x?
It is rather hard to see how it's object oriented then!
Or, alternatively do you really want to see if the only thing that
has changed about x is its class and that will be ok?
What about the other arguments?
The whole point of UseMethod is that we got an object x, with a
particular class and now we're going to do the right thing.
If you wanted to do the right thing with an object of a different
class then you need to do that before you call UseMethod.

Basically, one of the differences between UseMethod and NextMethod is
that with the first you don't get to change anything in the body of
the function, or at least, if you do then it will be ignored. If you
want to change things, do so and then call the generic.

UseMethod believes that the x in the call was evaluated and will
use that value in the call to the method.
NextMethod looks in the local environment for an x, uses one if it
finds one (otherwise gets the x in the call).
Semantically different, well documented and if Joe User doesn't
understand it's because S doesn't do what it says it does and
people write bad code (but generally not as bad as mine ;-).


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 14 17:00:19 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 14 Apr 1999 12:00:19 -0400 (EDT)
Subject: options
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.SV4.4.05.9904141155440.5911-100000@hsph.harvard.edu>


 Do we have a policy on checking for valid options?

In working on the warning system I tried to get S to
give a warning. So I went:

 options(object.size= -9)

 but it didn't, it exited in a rather confused state.

Is it the responsibility of the function retrieving the
option to set the value to something sensible. The user
can set them to any old thing but we will just use the
default (regardless of the state of options). Or do we
actively try to maintain the options in a "reliable state"?

As near as I can tell we currently do the former (some of the
time).



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 14 23:17:11 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 00:17:11 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Robert Gentleman's message of "Wed, 14 Apr 1999 10:29:54 -0400 (EDT)"
References: <Pine.SV4.4.05.9904141016170.18981-100000@hsph.harvard.edu>
Message-ID: <x2ogkqlue0.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

> Do you really want to have a language that accepts any change in x?
> It is rather hard to see how it's object oriented then!
> Or, alternatively do you really want to see if the only thing that
> has changed about x is its class and that will be ok?
> What about the other arguments?
> The whole point of UseMethod is that we got an object x, with a
> particular class and now we're going to do the right thing.
> If you wanted to do the right thing with an object of a different
> class then you need to do that before you call UseMethod.

I'm inclined to agree here. On the other hand, what might be the case
is that you could make class<- be a little more careful with its
argument so that UseMethod would see the modified x. Sneaky, but
compatible, and *perhaps* not very hard to do. How often is this kind
of construct (class(x)<-foo;UseMethod()) used in actual S code?

> Semantically different, well documented and if Joe User doesn't
> understand it's because S doesn't do what it says it does and
> people write bad code (but generally not as bad as mine ;-).

- and Joe User generally gets in trouble with methods anyway...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr 14 23:37:26 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 15 Apr 1999 00:37:26 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904142237.AAA25670@biostat.ku.dk>

On 15 Apr 1999, Peter Dalgaard BSA wrote:

> Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> 
> > Do you really want to have a language that accepts any change in x?
> > It is rather hard to see how it's object oriented then!
> > Or, alternatively do you really want to see if the only thing that
> > has changed about x is its class and that will be ok?
> > What about the other arguments?
> > The whole point of UseMethod is that we got an object x, with a
> > particular class and now we're going to do the right thing.
> > If you wanted to do the right thing with an object of a different
> > class then you need to do that before you call UseMethod.
> 
> I'm inclined to agree here. On the other hand, what might be the case
> is that you could make class<- be a little more careful with its
> argument so that UseMethod would see the modified x. Sneaky, but
> compatible, and *perhaps* not very hard to do. How often is this kind
> of construct (class(x)<-foo;UseMethod()) used in actual S code?

Often by certain people with a massive presence!

We have indeed been here before.  In our lda function we do

class(x) <- data.class(x)
UseMethod("lda")

That fails to use the new class in R, and according to `your' reading of
the White book (but not mine nor apparently the author of S's) should do
so. `You' suggested

   UseMethod("lda", x, ...)

which works in some versions of S-PLUS 3.x but crashes the DEC Alpha
version and works on no version of S-PLUS 5.x. Hence I have

lda <- function(x, ...)
{
   if(is.null(class(x))) class(x) <- data.class(x)
#ifdef R
   UseMethod("lda", x, ...)
#ifdef SP3
   UseMethod("lda")
}

and in SP5 I do something with new-style classes.

> - and Joe User generally gets in trouble with methods anyway...

and not just Joe User....

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 15 07:39:49 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 15 Apr 1999 08:39:49 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904150639.IAA26078@biostat.ku.dk>

On Wed, 14 Apr 1999, Robert Gentleman wrote:

> On Wed, 14 Apr 1999, Prof Brian D Ripley wrote:
> 
> > On 15 Apr 1999, Peter Dalgaard BSA wrote:
> > 
> > > Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> > > 
> > > > Do you really want to have a language that accepts any change in x?
> > > > It is rather hard to see how it's object oriented then!
> > > > Or, alternatively do you really want to see if the only thing that
> > > > has changed about x is its class and that will be ok?
> > > > What about the other arguments?
> > > > The whole point of UseMethod is that we got an object x, with a
> > > > particular class and now we're going to do the right thing.
> > > > If you wanted to do the right thing with an object of a different
> > > > class then you need to do that before you call UseMethod.
> > > 
> > > I'm inclined to agree here. On the other hand, what might be the case
> > > is that you could make class<- be a little more careful with its
> > > argument so that UseMethod would see the modified x. Sneaky, but
> > > compatible, and *perhaps* not very hard to do. How often is this kind
> > > of construct (class(x)<-foo;UseMethod()) used in actual S code?
> > 
> > Often by certain people with a massive presence!
> > 
> > We have indeed been here before.  In our lda function we do
> > 
> > class(x) <- data.class(x)
> > UseMethod("lda")
> > 
> > That fails to use the new class in R, and according to `your' reading of
> > the White book (but not mine nor apparently the author of S's) should do
> > so. `You' suggested
> 
>  If you could point out the error of my ways I would appreciate it.

I did not mean to imply that you were wrong, rather that the White Book
can be read both ways (and it seems has been).

> But, it as I understand it, UseMethod is supposed to call the method
> with the arguments the same as those that called the generic. You
> must evaluate x to figure out what method to call, but I don't see
> how you can change x (adding classes is changing it).

Then why are

UseMethod("foo")
UseMethod("foo", x)

different in R? (They are: lda works.) The actual definition of UseMethod
in S is

       UseMethod(generic, object, ...)

and by the standard evaluation model, `object' is subject to lazy
evaluation. Nothing I can see in the White Book says otherwise. Indeed,
page 467 says the arguments are `re-matched by the standard rules'. It then
says `The method will see argument matches as it would if the user's call
had been directly to the method'.  I think those claims are contradictory,
and in particular whichever way they are read suggest my pair of calls
should be the same.

[In S UseMethod("foo") is semantic shorthand for UseMethod("foo", <name of
first argument of caller>), according to the help page.]

To make matters worse, in S it is a common mistake to have

foo <- function(x, ...) UseMethod("foo")
foo.lm <- function(y, ...) { .... }

and that change of name of argument causes re-evaluation.  What happens in
R?  This makes an apparently small point, that generics should have the
same argument name as S, potentially rather important. I know of four
outstanding discrepancies:

R: deviance <- function (x, ...) UseMethod("deviance")
S: deviance <- function (x, ...) UseMethod("deviance")

and ditto for coef, fitted, residuals (which I had not realized, in part
because some of these only recently acquited defaults).

There are inconsistencies in the current R code: any objections if
I change these to uniformly follow S and use `object'?


The other common one is `print'. As in

> print
function (x, ...) 
UseMethod("print")
> print.socket
function (socket) 
{
    cat("Socket connection #", socket$socket, "to", socket$host, 
        "on port", socket$port, "\n")
}

print methods should have first argument x, a ... argument _and_ return
invisible(x) for an unchanged x (in S, at least).  print.plot
does not even have an argument, so how does that ever work?

>   I realize it is frustrating and if you think it's important
> you should change it. But, by doing that you move the language
> further away from being object oriented. 

What we do need is to get this documented!  In particular, in R

> ?UseMethod

Class Methods

     UseMethod(name)

is incomplete, and I only know about UseMethod("foo", x, ...) because
`you' (Kurt?) suggested I use it. 

BTW, I have never believed S3's claim to be `object-oriented': it has a
class-based dispatcher. S has changed (although it remains to be seen if
users will follow) and I would be happy for R to be different from both.
However, as Bill and I are currently trying to write about this for V&R3v2,
I would not like R to change dramatically after the next few months!


Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 14:37:16 1999
From: rgentlem@hsph.harvard.edu (rgentlem@hsph.harvard.edu)
Date: Thu, 15 Apr 1999 15:37:16 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904151337.PAA00928@biostat.ku.dk>


I've done some editing to get things together (hopefully without
changing the semantics)

On Thu, 15 Apr 1999, Prof Brian D Ripley wrote:

> On Wed, 14 Apr 1999, Robert Gentleman wrote:
> 
> > On Wed, 14 Apr 1999, Prof Brian D Ripley wrote:
> > 
> > > On 15 Apr 1999, Peter Dalgaard BSA wrote:
> > > 
> > > > Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> > > > 
> 
> I did not mean to imply that you were wrong, rather that the White Book
> can be read both ways (and it seems has been).
> 
> > But, it as I understand it, UseMethod is supposed to call the method
> > with the arguments the same as those that called the generic. You
> > must evaluate x to figure out what method to call, but I don't see
> > how you can change x (adding classes is changing it).
> 
> Then why are
> 
> UseMethod("foo")
> UseMethod("foo", x)
> different
> 
> 
> and by the standard evaluation model, `object' is subject to lazy
> evaluation. Nothing I can see in the White Book says otherwise. Indeed,
> page 467 says the arguments are `re-matched by the standard rules'. It then
> says `The method will see argument matches as it would if the user's call
> had been directly to the method'.  I think those claims are contradictory,
> and in particular whichever way they are read suggest my pair of calls
> should be the same.
> 
> [In S UseMethod("foo") is semantic shorthand for UseMethod("foo", <name of
> first argument of caller>), according to the help page.]
> 

  Now, with my reading, the method will see the argument as it would
if the users call had been directly to the the method, coupled with
the later comment (top of p. 469) that for NextMethod you must take local
bindings for the arguments, yields
   with UseMethod you don't take local bindings, the method gets what
the generic did, but it will rematch (argument names and positions
may have changed). That means you need to ignore what happened
inside of the generic.

  Now, we have the variable definition problem raise it's head,
  UseMethod("foo")
  UseMethod("foo",x)
  If the second version doesn't use the local binding of x then
 UseMethod behaves differently, in terms of how it treats its arguments
 than every other function (which is ok, we just need to be specific
 about it).
  So we have to make a decision, UseMethod does what S does (which is
 fine) or it doesn't.

> To make matters worse, in S it is a common mistake to have
> 
> foo <- function(x, ...) UseMethod("foo")
> foo.lm <- function(y, ...) { .... }
> 
> and that change of name of argument causes re-evaluation.  What happens in
> R?  
  The standard argument matching system takes over. If there was an
argument y=blah, in the ... then it will get matched to y in foo.lm
even though something different was matched to x in the call to the 
generic. I don't believe that a reevaluation takes place in either 
situation. If x was evaluated and that is what is matched then we
look in the value side of the expression, see that it's there and
carry on. If we match to something new then the standard rules take
over.
  Promises are basically cells with three slots, an unevaluated
expression, an environment in which to carry out the evaluation
of that expression and a value. When we want a value, we look in
the value slot first, if there is no value, we evaluate the
expression and stick the value into the value slot. So promises
should never be evaluated twice.

 For those not bored, here is a difference between R and S that 
we may not want.
bar<-function(w,...) {
    UseMethod("bar")
  }
 bar.foo<-function(y, w) print(w)
x<-30
class(x)<-"foo"

Now in R,
> bar(x,10)
[1] 10
> bar(x,y=10)
[1] 30
attr(,"class")
[1] "foo"

Notice that if the arguments are not named we use default matching and
that the symbolic name for the first argument in the generic is not
carried over.

In S bar(x,10) and bar(x,y=10) both evaluate to the same thing,
[1] 30
attr(,"class")
[1] "foo"
it appears that the name w has been applied to the first argument and
that is carried with it for subsequent evaluations.

  I'm not sure what you meant by "the change of name causes reevaluation,
when I try
> bar(x<-x+1)
I get,
[1] 31
attr(, "class"):
[1] "foo"
[1] 31
attr(, "class"):
[1] "foo"
  which is only one evaluation (and the same in R)

> This makes an apparently small point, that generics should have the
> same argument name as S, potentially rather important. I know of four
> outstanding discrepancies:
> 
> R: deviance <- function (x, ...) UseMethod("deviance")
> S: deviance <- function (x, ...) UseMethod("deviance")
> 
> and ditto for coef, fitted, residuals (which I had not realized, in part
> because some of these only recently acquited defaults).
> 
> There are inconsistencies in the current R code: any objections if
> I change these to uniformly follow S and use `object'?

  Change to your hearts content. I think we want something that works
and that makes sense.
> What we do need is to get this documented!  In particular, in R
> 
> > ?UseMethod
> 
> Class Methods
> 
>      UseMethod(name)
> 


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr 15 15:25:07 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 15 Apr 1999 10:25:07 -0400
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
References: <199904151337.PAA00928@biostat.ku.dk>
Message-ID: <3715F6C2.81A6B0F8@bank-banque-canada.ca>

> To make matters worse, in S it is a common mistake to have
> foo <- function(x, ...) UseMethod("foo")
> foo.lm <- function(y, ...) { .... }

I've tried very hard not to do this, but it sure would be nice to have a good
automatic way to check it. Any suggestions?

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Thu Apr 15 17:07:39 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Fri, 16 Apr 1999 01:37:39 +0930 (CST)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <199904151337.PAA00928@biostat.ku.dk>
References: <199904151337.PAA00928@biostat.ku.dk>
Message-ID: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>

Blundering late into this discussion I'm going to take a chance
here and venture an opinion on what does happen in S3 UseMethod,
regardless of what interpretations are made of A.6 in the white
book.  This is by the "suck it and see" method, the only one I
trust.  (The chance I take is in supposing this to be useful...)

1. At the time of the UseMethod call the principal argument is
   examined, and evaluated if necessary, and the class it has at
   that stage is the one used for method dispatch.

2. All non-missing arguments are passed on to the method with the
   values they were supplied with at the time of the original
   call, not the changed values they may have at the time of
   dispatch, (including the principal argument).

3. Missing arguments that have been given values at the time of
   method dispatch, as well as local variables, retain their
   current values when control passes to the method.

4. Supplying a second argument to UseMethod() allows some other
   argument than the first to act as the principal argument.

5. Default values for arguments in the method supercede defaults
   supplied in the generic.

The method directly occupies the frame of the generic, but
arguments actually supplied to the generic re-assume their
original supplied values (even though changes to the principal
argument prior to method dispatch may determine mathod dispatch.)

So, for example, if the principal argument is not missing, has no
class at the call and is given class "xyz" by the generic, the
"xyz" method is dispatched, but the object corresponding to the
principal argument inside the method is the original classless
object.  (I would have thought that this was the major reason to
have a function like data.class in the first place.  What other
serious use does it have?)  To verify *from within the method*
that the principal argument had the class implied by the method,
you have to inspect the .Class guaranteed variable, not the
current class of the principal argument itself, which may be
wildly at variance.

"Missing" arguments on the original call remain missing unless
the generic has given them values prior to method dispatch, in
which case they behave like local variables and retain their
local supplied values.  If defaults are needed, the most recent
one is used.

Now, how does R differ?

Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 17:38:27 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 12:38:27 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <Pine.SV4.4.05.9904151213320.1352-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Bill Venables wrote:

> Blundering late into this discussion I'm going to take a chance
> here and venture an opinion on what does happen in S3 UseMethod,
> regardless of what interpretations are made of A.6 in the white
> book.  This is by the "suck it and see" method, the only one I
> trust.  (The chance I take is in supposing this to be useful...)
> 
> 1. At the time of the UseMethod call the principal argument is
>    examined, and evaluated if necessary, and the class it has at
>    that stage is the one used for method dispatch.
> 
> 2. All non-missing arguments are passed on to the method with the
>    values they were supplied with at the time of the original
>    call, not the changed values they may have at the time of
>    dispatch, (including the principal argument).
> 
> 3. Missing arguments that have been given values at the time of
>    method dispatch, as well as local variables, retain their
>    current values when control passes to the method.
> 
> 4. Supplying a second argument to UseMethod() allows some other
>    argument than the first to act as the principal argument.
> 
> 5. Default values for arguments in the method supercede defaults
>    supplied in the generic.
> 
> The method directly occupies the frame of the generic, but
> arguments actually supplied to the generic re-assume their
> original supplied values (even though changes to the principal
> argument prior to method dispatch may determine mathod dispatch.)

  I don't think that's what S does. My experiments suggest that S
takes the current value of the principal argument regardless of
what was passed in. I asked JMC and if I understood him then that's
what is being done.
  As for other arguments, well it seems to pick things up at the point
that UseMethod is called from.
  For example,
  bar<-function(w, y, ...)
{
        y <- 12
        w <- 3
        UseMethod("bar")
}
  bar.default<-function(y, w) {
     print(w)
     print(y)
  }

  x<-30
  bar(x)

  yields:
[1] 3
[1] 12
[1] 12

  So, x was changed, y (even though missing from the original call
 now exists) and the names given to the arguments in the call to
 the generic have been used to match in the call to the method.

 In R, (0.65)
 I get 
  > Error: Argument "w" is missing, with no default.


 One small change (and back to S) 
  bar<- function(w, v, ...)
{
        y <- 12
        w <- 3
        UseMethod("bar")
}

  Now, for bar(x,20) I still get,
[1] 3
[1] 12
[1] 12
 
  I don't think that's what you want. But my guess as to the semantics
is the following.
  When UseMethod is called the generic is determined by the class
of the principal argument at that point. That method is grabbed
and it's arguments are matched using the frame of the currently
executing method (not the arguments in the call to the currently 
active method). Then that method is evaluated using a new frame,
but the bindings achieved from the match. 

We can do this; but do we want to? There is something particularly
unsettling about the method matching args from the currently active frame
rather than from the call to the generic.

  I'm working with:
S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
S : Copyright AT&T.
Version 3.4 Release 1 for Sun SPARC, SunOS 5.3 : 1996 

> 
> So, for example, if the principal argument is not missing, has no
> class at the call and is given class "xyz" by the generic, the
> "xyz" method is dispatched, but the object corresponding to the
> principal argument inside the method is the original classless
> object.  (I would have thought that this was the major reason to
> have a function like data.class in the first place.  What other
> serious use does it have?)  To verify *from within the method*
> that the principal argument had the class implied by the method,
> you have to inspect the .Class guaranteed variable, not the
> current class of the principal argument itself, which may be
> wildly at variance.
> 
> "Missing" arguments on the original call remain missing unless
> the generic has given them values prior to method dispatch, in
> which case they behave like local variables and retain their
> local supplied values.  If defaults are needed, the most recent
> one is used.
> 
> Now, how does R differ?
> 
> Bill Venables.
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 18:00:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 19:00:14 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Bill Venables's message of "Fri, 16 Apr 1999 01:37:39 +0930 (CST)"
References: <199904151337.PAA00928@biostat.ku.dk> <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <x2aew9g6ox.fsf@blueberry.kubism.ku.dk>

Bill Venables <wvenable@arcola.stats.adelaide.edu.au> writes:

> Blundering late into this discussion I'm going to take a chance
> here and venture an opinion on what does happen in S3 UseMethod,
> regardless of what interpretations are made of A.6 in the white
> book.  This is by the "suck it and see" method, the only one I
> trust.  (The chance I take is in supposing this to be useful...)
> 
> 1. At the time of the UseMethod call the principal argument is
>    examined, and evaluated if necessary, and the class it has at
>    that stage is the one used for method dispatch.
> 
> 2. All non-missing arguments are passed on to the method with the
>    values they were supplied with at the time of the original
>    call, not the changed values they may have at the time of
>    dispatch, (including the principal argument).
> 
> 3. Missing arguments that have been given values at the time of
>    method dispatch, as well as local variables, retain their
>    current values when control passes to the method.
> 
> 4. Supplying a second argument to UseMethod() allows some other
>    argument than the first to act as the principal argument.
> 
> 5. Default values for arguments in the method supercede defaults
>    supplied in the generic.
> 
> The method directly occupies the frame of the generic, but
> arguments actually supplied to the generic re-assume their
> original supplied values (even though changes to the principal
> argument prior to method dispatch may determine mathod dispatch.)

Erm, does that cover this case?:

>  f<-function(x){x<-2;print(substitute(x));UseMethod("print")}  
> f(4)
[1] 2
[1] 4
> f((4))
(4)
[1] 2

(It may, I'm just too tired to see it...)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 21:32:28 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 16:32:28 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <x2aew9g6ox.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904151628020.16888-100000@hsph.harvard.edu>



On 15 Apr 1999, Peter Dalgaard BSA wrote:

> Erm, does that cover this case?:
> 
> >  f<-function(x){x<-2;print(substitute(x));UseMethod("print")}  
> > f(4)
> [1] 2
> [1] 4
> > f((4))
> (4)
> [1] 2
> 
> (It may, I'm just too tired to see it...)

  Wow! That's peculiar. 
  R does the rather boring

> f<-function(x){x<-2;print(substitute(x));UseMethod("print")}
> f(4)
[1] 2
[1] 4
> f((4))
[1] 2
[1] 4

  Does that mean that our implementaion of substitute is not quite
right? The documentation suggests that you get the expression typed as
the value of a formal argument; right now we're getting the current
value.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 22:50:21 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Thu, 15 Apr 1999 23:50:21 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904152150.XAA01121@biostat.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>   Does that mean that our implementaion of substitute is not quite
> right? The documentation suggests that you get the expression typed as
> the value of a formal argument; right now we're getting the current
> value.

No. It means that S's implementation is quite wrong...

R's substitute works by fairly clean rules of (lazy) evaluation: If
you pass it a an expression containing x and x is a PROMSXP, you get
the argument expression. If you change x before the substitute, you get
the current value (unless you used x<-delay(something), in which case
you get the unevaluated something). 

S does --- something else:

> f<-function(x){x<-2;substitute(x)}
> f(5)
[1] 2
> y<-5     
> f(y)
y

This, I *really* don't think we want to emulate.

The documentation is badly off, though... and the quote() doc is
really off target. (I've written about this before, but it never found
its way to the help page, obviously).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 22:50:07 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 23:50:07 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Robert Gentleman's message of "Thu, 15 Apr 1999 16:32:28 -0400 (EDT)"
References: <Pine.SV4.4.05.9904151628020.16888-100000@hsph.harvard.edu>
Message-ID: <x2zp49d04w.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>   Does that mean that our implementaion of substitute is not quite
> right? The documentation suggests that you get the expression typed as
> the value of a formal argument; right now we're getting the current
> value.

No. It means that S's implementation is quite wrong...

R's substitute works by fairly clean rules of (lazy) evaluation: If
you pass it a an expression containing x and x is a PROMSXP, you get
the argument expression. If you change x before the substitute, you get
the current value (unless you used x<-delay(something), in which case
you get the unevaluated something). 

S does --- something else:

> f<-function(x){x<-2;substitute(x)}
> f(5)
[1] 2
> y<-5     
> f(y)
y

This, I *really* don't think we want to emulate.

The documentation is badly off, though... and the quote() doc is
really off target. (I've written about this before, but it never found
its way to the help page, obviously).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 23:17:16 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 18:17:16 -0400 (EDT)
Subject: debug
In-Reply-To: <199904131002.MAA10093@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904151806220.21765-100000@hsph.harvard.edu>

I've just committed a fix for debugging functions that do not have
{'s around the body (funs with one line basically). Let me know if you
have problems. 

(all my stuff is going in 0.65 and I'll try to migrate it over once
I think it's ok)


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 23:28:31 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 16 Apr 1999 00:28:31 +0200
Subject: debug
In-Reply-To: Robert Gentleman's message of "Thu, 15 Apr 1999 18:17:16 -0400 (EDT)"
References: <Pine.SV4.4.05.9904151806220.21765-100000@hsph.harvard.edu>
Message-ID: <x2wvzdcycw.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

> I've just committed a fix for debugging functions that do not have
> {'s around the body (funs with one line basically). Let me know if you
> have problems. 

One thing:

example(esoph)

is bailing out in a glm() call, and of course make check does too.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Fri Apr 16 07:20:54 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Fri, 16 Apr 1999 15:50:54 +0930 (CST)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
References: <199904151337.PAA00928@biostat.ku.dk>
 <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <14102.54983.17904.253771@arcola.stats.adelaide.edu.au>

Well, I have to admit that I have egg all over my face this
time, and if you don't want to have the long-winded justification
I suggest you pass to your next email...

--

In my defence I was misled by what can only be called an S3 bug,
now probably unfixable since some code probably depends on it.
Here is the most succinct expression of it I can devise:

S3:

foo <- function(x) {
  class(x) <- "bar"
  x <- x - 1
  UseMethod("foo")
}
foo.bar <- function(x) invisible(print(x))


Now with one kind of actual argument method dispatch occurs, but
he *original* value is passed on:

> foo(10)
[1] 10

but with any other kind the *modified* value is passed:

> fred <- 10
> foo(fred)
[1] 9
attr(, "class"):
[1] "bar"

and most egregiously:

> foo((10))
[1] 9
attr(, "class"):
[1] "bar"



On the other hand in S4 this anomaly is at least fixed.

S4 (using backward compatibility):

foo <- function(x) {
  oldClass(x) <- "bar"
  x <- x - 1
  UseMethod("foo")
}
foo.bar <- function(x) invisible(print(x))

> foo(10)
[1] 9
attr(, "class"):
[1] "bar"
> foo((10))
[1] 9
attr(, "class"):
[1] "bar"

There are other differences with S3, though.  For example, local
variables generated in the frame of the generic *are* passed to
the method in S3, but *are not* passed to the method in S4.

What a mess!

One clear moral seems to be don't do anything more inside a
generic function than you really need to do.  Keep it *very*
simple indeed.


I'm grateful to you guys for bringing up this matter right now,
but I'm sorry to be working it all out in front of you like this!

Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr 16 13:05:15 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 16 Apr 1999 14:05:15 +0200
Subject: Segfault from evalq(return()) (PR#168)
Message-ID: <199904161205.OAA01677@biostat.ku.dk>

Luke Tierney brought this up while we were discussing the semantics of
a possible let() or local() call:

> evalq(return())
Segmentation fault (core dumped)

This is not just caused by trying to pop an empty stack:

> f<-function(x)evalq(return())
> f(2)
Segmentation fault (core dumped)


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr 16 13:10:41 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 16 Apr 1999 14:10:41 +0200
Subject: deparse drops () sometimes (PR#169)
Message-ID: <199904161210.OAA01687@biostat.ku.dk>

Shortest example is this:

> function()(g)()
function () 
(g)

It executes OK, but editing a function with one of these in will
introduce an error in an uexpected place.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 16 14:04:30 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 16 Apr 1999 09:04:30 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.54983.17904.253771@arcola.stats.adelaide.edu.au>
Message-ID: <Pine.SV4.4.05.9904160858520.25362-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Bill Venables wrote:

> Well, I have to admit that I have egg all over my face this
> time, and if you don't want to have the long-winded justification
> I suggest you pass to your next email...
> 
> --
> 
> In my defence I was misled by what can only be called an S3 bug,
> now probably unfixable since some code probably depends on it.

  Great examples. I am coming to understand the S3 model. Now,
 does anyone want to say what we want? Brian, you probably use this
 stuff more than most. Do you want to say what you want and I'll
 see what can be done to duplicate it. Anyone else that wants to
 chime in?

> 
> 
> One clear moral seems to be don't do anything more inside a
> generic function than you really need to do.  Keep it *very*
> simple indeed.
> 
   I recall JMC saying something like, all generic functions
 should be one line long; a call to the appropriate UseMethod.

   My own belief in this regard is that once you start down the
  OO road the object is immutable (otherwise what is the point?).
  Unfortunately the flexibility of S-like languages makes this
  impossible to enforce. There is also the issue of when do you 
  "start down the OO road", I always felt it was with the call
  to the generic but perhaps it's with the call to UseMethod.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr 16 17:22:01 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 16 Apr 1999 12:22:01 -0400
Subject: NextMethod
Message-ID: <371763A9.D2FF89C6@bank-banque-canada.ca>

>> One clear moral seems to be don't do anything more inside a
>> generic function than you really need to do.  Keep it *very*
>> simple indeed.
>>
>  I recall JMC saying something like, all generic functions
> should be one line long; a call to the appropriate UseMethod.

It certainly is encouraging to know that others also have been confused by
aspects of UseMethod. I've mostly kept my generic functions to one lined based
on the "keep it simple, stupid" principle. It's nice to have more impressive
references.

The "if it's not broken don't fix it" principle makes me reluctant to consider
the following, but...

In cleaning up parts of my library I realized that many of my old summary
methods actually print things instead of returning an object for a print method.
Some of these use NextMethod, and I've always been even more confused by
NextMethod than by UseMethod. Is the following a good model of how this should
be done:

summary.level1.level2 <- function(object)
{ r <- list("level2 before")
  r <- append(r,NextMethod("summary"))
  r <- append(r,"level2 after")
  class(r) <- "summary.level1.level2"
  r
}

print.summary.level1.level2 <- function(x)
 { cat(x[[1]])
   print(x[[2]])
   cat(x[[3]])
   invisible(x)
 }


z <- 1:3
class(z) <- c("level1.level2", "level1")
summary(z)

TIA
Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 16 17:50:53 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 16 Apr 1999 12:50:53 -0400 (EDT)
Subject: NextMethod
In-Reply-To: <371763A9.D2FF89C6@bank-banque-canada.ca>
Message-ID: <Pine.SV4.4.05.9904161235440.795-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Paul Gilbert wrote:

> In cleaning up parts of my library I realized that many of my old summary
> methods actually print things instead of returning an object for a print method.
> Some of these use NextMethod, and I've always been even more confused by
> NextMethod than by UseMethod. Is the following a good model of how this should
> be done:
> 
> summary.level1.level2 <- function(object)
> { r <- list("level2 before")
>   r <- append(r,NextMethod("summary"))
>   r <- append(r,"level2 after")
>   class(r) <- "summary.level1.level2"
>   r
> }
> 
> print.summary.level1.level2 <- function(x)
>  { cat(x[[1]])
>    print(x[[2]])
>    cat(x[[3]])
>    invisible(x)
>  }
> 
> 
> z <- 1:3
> class(z) <- c("level1.level2", "level1")
> summary(z)
> 
   You haven't really said what you want to do in enough detail for
me to give you an answer.
   If an object has several class attributes then NextMethod is
a way to move down the heirarchy. While it is much more general
almost every use is of the form that you used in summary.level1.level2;
first do some preprocessing, second call the default, do some post
processing and return. One big difference between NextMethod and UseMethod
is that UseMethod does not return (so putting stuff after it is
pointless).
   You can put any class you want on the return value. If you
want to have objects of class, summary.level1.level2, that's fine.
But if you want to have objects of class Tsobj.summary (returned
by all sorts of functions, but filtered through a single print)
then you can do that as well.
   I don't see the point of, class(z) <- c("level1.level2", "level1"),
in my R, since I don't have a summary.level1 function (which you may
have), I do get a call to summary.default as a result of NextMethod.
But NextMethod does first search for a function called summary.level1,
if it finds one then that will be evaluated.
   So, you really have to be careful. If you want to call a particular
function then you should do that by name. If you want to handle certain
attributes (for level1.level2) and then attributes for any other classes
(in this case level1) then NextMethod is your man. But if you want
to do some level1.level2 stuff and then call summary.default, don't
use NextMethod. 
    There are other differences between NextMethod and UseMethod (and
those differences are different between R and S; you need to read
the as yet unwritten R documentation to see what they really are :-)

robert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr 16 20:08:45 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 16 Apr 1999 15:08:45 -0400
Subject: NextMethod
References: <Pine.SV4.4.05.9904161235440.795-100000@hsph.harvard.edu>
Message-ID: <37178ABC.5299C80F@bank-banque-canada.ca>

> since I don't have a summary.level1 function (which you may

Whoops, I missed a part:

summary.level1 <- function(object)
{ r<- "level1"
  class(r) <- "summary.level1"
  r
 }

print.summary.level1 <- function(x) { cat(x) }

>  You haven't really said what you want to do in enough detail for
>  me to give you an answer.
>    If an object has several class attributes then NextMethod is
>  a way to move down the heirarchy.

I guess my first question was a very general one: Is this approach to moving
through the heirarchy to  construct a summary and print it likely to be fairly
robust as R and S evolve? Despite my lack of detail I think you answered that in
general it is.

Some of your other comments made me realize that my whole understanding of class
heirarchy is not good. In particular, I had thought of a more specific class
something like a sub-class: a specific class being associated with a particular
general class.  An object could be  c("level2a", "level1") or c("level2b",
"level1") but it would not logically be c("level2", "level1a") or c("level2",
"level1b").

>From what you've said I guess that is wrong. The class heirarchy should be
associated only with a specific object, not thought of as a logical structure
for all objects having their most specific class in common.

So, in my example

summary.level1.level2 <- function(object)
{ r <- list("level2 before")
  r <- append(r,NextMethod("summary"))
  r <- append(r,"level2 after")
  class(r) <- "summary.level1.level2"
  r
}

I could replace NextMethod("summary") with summary.level1(object) because I know
that any object of class "level1.level2" always inherits from "level1". (This is
part of the reason for my naming convention "level1.level2" for the specific
class.) But if I did this replacement and then called summary with an object of
class c("level1.level2", "level1b"), I would get a different result.
My way of thinking about this has not caused me any problems, I just have not
used inheritance  to its full power.

If I still have this all wrong please let me know.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Tue Apr 20 18:18:35 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Tue, 20 Apr 1999 12:18:35 -0500 (CDT)
Subject: eigenvalue/eigenvector calculations
Message-ID: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>

Some of you may have seen a message on s-news by Stefan Steinhaus
regarding his paper on "Comparison of mathematical programs for data
analysis".  He compares S-PLUS 4.5 with several other programs.  He
does not include R in the comparisons.  On p. 28 of his report he
gives the URL the Auckland site along with URL's for two other systems
but comments that "I didn't received (sic) any support for my work by
the software developers".  I'm not sure what that means.

Anyway, one of his comparisons for timing is for the calculation of the
determinant of a 1000x1000 matrix of uniform (0,1) random numbers.  It
is not the wisest computation because it is usually Infinity but we
may still want to look at some of the properties.  He used
 determinant <- function(x) prod(eigen(x)$values)
There are many problems with this calculation and I address some of
them in a note to him with a copy to S-news.

I was cross-checking my results in R and came up with the following
peculiar behaviour.  If you use only.values = TRUE in eigen, you get
noticeably different eigenvalues and I don't think it is just a matter
of the ordering of the results.  Their products are noticeably
different.

R : Copyright 1999, The R Development Core Team
Version 0.64.0  (April 8, 1999)

> x <- array( runif( 10000 ), c(100, 100))
> determinant <- function(x) prod(eigen(x)$values)
> det1 <- function(x) prod(eigen(x, only.values = TRUE)$values)
> det2 <- function(x) prod(diag(qr(x)$qr)) * (-1)^(ncol(x) - 1)
> system.time(print(determinant(x)))
[1] -27320631-8.050401e-10i
[1] 0.06 0.04 0.00 0.00 0.00
> system.time(print(det1(x)))
[1] 36072865748-5.155196e-06i
[1] 0.06 0.00 0.00 0.00 0.00
> system.time(print(det2(x)))
[1] -9.854994e+25
[1] 0.03 0.00 0.00 0.00 0.00
> all(eigen(x,only.values=TRUE)$values == eigen(x)$values)
[1] FALSE
> rel.diff <- function(x,y) Mod(x-y)/Mod(x)
> rel.diff(eigen(x,only.values=TRUE)$values, eigen(x)$values)
  [1] 1.395689e-07 1.793713e-04 1.793713e-04 7.604683e-06 7.604683e-06
  [6] 6.027408e-05 6.027408e-05 2.001094e+00 1.887877e+00 2.088785e+00
 [11] 1.889478e+00 1.263914e+00 4.822391e-04 4.822391e-04 1.033824e-13
 [16] 1.582459e-05 1.590463e+00 1.684538e+00 1.861574e+00 1.891079e+00
 [21] 4.260913e-01 1.762078e+00 1.796430e+00 1.483012e+00 5.403557e-01
 [26] 5.403557e-01 1.217432e+00 1.217432e+00 5.188953e-01 5.188953e-01
 [31] 1.621965e+00 1.942157e+00 1.815673e+00 1.625482e+00 1.914144e+00
 [36] 1.914177e+00 1.728506e+00 1.724235e+00 7.271222e-01 7.271222e-01
 [41] 9.928653e-01 1.971190e+00 1.931997e+00 1.920628e+00 1.816204e+00
 [46] 1.946860e+00 1.565290e+00 8.955887e-01 1.924923e+00 1.388633e+00
 [51] 1.960728e+00 1.822560e+00 1.059483e+00 1.585604e+00 1.105094e+00
 [56] 5.622539e-02 5.622539e-02 1.795988e+00 1.846025e+00 1.333497e-01
 [61] 1.418881e+00 1.418881e+00 9.874141e-02 2.524210e-01 1.615536e+00
 [66] 1.195681e+00 1.793995e+00 6.952189e-01 1.268999e-01 1.472427e+00
 [71] 1.446002e+00 1.627224e-01 1.870035e+00 1.888633e+00 1.145509e-01
 [76] 1.625031e-01 1.860097e+00 1.469557e-01 1.438975e+00 1.505856e+00
 [81] 1.955270e+00 1.260539e+00 1.440042e+00 1.575450e-01 1.469263e-01
 [86] 1.769835e+00 1.780567e+00 2.119072e-01 3.139617e-01 2.748911e-01
 [91] 3.652874e-01 2.611222e-01 1.746714e+00 1.345816e-01 1.560194e+00
 [96] 1.225182e+00 2.020903e-01 1.836618e+00 1.962674e+00 9.724950e-16

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Tue Apr 20 18:44:59 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 20 Apr 1999 13:44:59 -0400
Subject: eigenvalue/eigenvector calculations
References: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>
Message-ID: <371CBD1B.A0206ED3@bank-banque-canada.ca>

> was cross-checking my results in R and came up with the following
>peculiar behaviour.  If you use only.values = TRUE in eigen, you get
>noticeably different eigenvalues and I don't think it is just a matter

This might be related to the problem (bad values from eigen) I reported a couple
of weeks ago. I think it was tracked down to a problem in the header files. As I
understand it, the bug has been around for awhile,  but may not always bite -
unless you're using a snapshot where it might be fixed. (I've reverted to 0.63.3
as it didn't seem to cause me a problem there.)

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 20 19:17:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 20 Apr 1999 19:17:07 +0100 (BST)
Subject: eigenvalue/eigenvector calculations
In-Reply-To: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904201914460.13546-100000@auk.stats>

On Tue, 20 Apr 1999, Douglas Bates wrote:

> I was cross-checking my results in R and came up with the following
> peculiar behaviour.  If you use only.values = TRUE in eigen, you get
> noticeably different eigenvalues and I don't think it is just a matter
> of the ordering of the results.  Their products are noticeably
> different.
> 
> R : Copyright 1999, The R Development Core Team
> Version 0.64.0  (April 8, 1999)
> 

That's the problem. On

R : Copyright 1999, The R Development Core Team
Version 0.64.0 Patched (unreleased snapshot) (April 19, 1999)

> all(eigen(x,only.values=TRUE)$values == eigen(x)$values)
[1] TRUE

As the NEWS says:

BUG FIXES

    o   eigen() now should work (again) in all cases.

There is quite a long list of bug fixes in 0.64.0, so I recommend the
R-release version.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Tue Apr 20 22:15:26 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 20 Apr 1999 16:15:26 -0500
Subject: eigenvalue calculations
Message-ID: <6rvher56z5.fsf@verdi.stat.wisc.edu>

I should have remembered that there was a problem with eigen() in
0.64.0.  In the patched versions of R-release (available under
src/devel at the CRAN sites) that bug has been fixed.

In case anyone else is interested, I redid the determinant
calculations in 
 Version 0.64.0 Patched (unreleased snapshot) (April 19, 1999)
using the method from Stephan Steinhaus's script (det0), the method
based on calculating the eigenvalues alone (det1) and the method based
on the QR decomposition (det2).  The results from the three methods
are consistent except that the eigenvalue methods both produce a
non-trivial imaginary component.

I enclose the timing results below.  Notice that the determinant
becomes extremely large as the matrix size increases and that the
error introduced by the complex arithmetic grows with it.

R> det0 <- function(x) prod(eigen(x)$values)
R> det1 <- function(x) prod(eigen(x, only = TRUE)$values)
R> det2 <- function(x) prod(diag(qr(x)$qr))*(-1)^(ncol(x)-1)
R> x1 <- array(runif(100*100), c(100,100))
R> x2 <- array(runif(200*200), c(200,200))
R> x3 <- array(runif(300*300), c(300,300))
R> system.time(print(det0(x1)))
[1] -9.267e+24+912457728i
[1] 1.36 0.00 2.00 0.00 0.00
R> system.time(print(det1(x1)))
[1] -9.267e+24+1041334272i
[1] 0.32 0.00 0.00 0.00 0.00
R> system.time(print(det2(x1)))
[1] -9.267e+24
[1] 0.04 0.00 0.00 0.00 0.00
R> system.time(print(det0(x2)))
[1] -9.4162e+79-1.458e+64i
[1] 10.28  0.00 11.00  0.00  0.00
R> system.time(print(det1(x2)))
[1] -9.4162e+79-2.9602e+64i
[1] 2.7 0.0 3.0 0.0 0.0
R> system.time(print(det2(x2)))
[1] -9.4162e+79
[1] 0.36 0.00 1.00 0.00 0.00
R> system.time(print(det0(x3)))
[1] -5.6519e+145+2.9732e+130i
[1] 34.86  0.01 34.00  0.00  0.00
R> system.time(print(det1(x3)))
[1] -5.6519e+145+9.494e+129i
[1] 10.49  0.00 10.00  0.00  0.00
R> system.time(print(det2(x3)))
[1] -5.6519e+145
[1] 1.49 0.00 1.00 0.00 0.00
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 06:15:17 1999
From: pd@biostat.ku.dk (Peter Dalgaard BSA)
Date: Wed, 21 Apr 1999 07:15:17 +0200
Subject: Bug list summary (automatic post)
Message-ID: <199904210515.HAA09383@biostat.ku.dk>

=================================================
This is an automated summary of the status of the R-bugs
repository.

Note that this may be neither complete nor perfectly
correct at any given instance: Not all bugs are reported,
and some reported bugs may have been fixed, but the
repository not yet updated.

Some bug fixes are difficult to verify because they pertain
to specific hardware or operating system versions. If you
have information to contribute, please do so.

If you happen to know how to fix a problem please send
patches to the bug repository, too.

New bugs are reported either through the web
interface at r-bugs.biostat.ku.dk or via email to
r-bugs@biostat.ku.dk. The bug.report() function can be
used to automate parts of the procedure on many systems.
Followups on older bugs can be done by including the string
"(PR#999)" in the Subject of an email (change 999 to the
actual reference number, of course!).
=================================================

Directory:  Accuracy

* PR# 138 *
Subject: Re: [R] bug? and New bug.
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 10 Mar 1999 17:21:16 +0100

Directory:  Add-ons

* PR# 137 *
Subject: funfits
From: "Alvaro A. Novo" <novo@uiuc.edu>
Date: Tue, 9 Mar 1999 22:24:54 -0600

Directory:  Analyses

none

Directory:  Documentation

* PR# 146 *
Subject: nlm docs
From: Patrick Lindsey <plindsey@alpha.luc.ac.be>
Date: Wed, 24 Mar 1999 15:48:41 +0100 (MET)

Directory:  Graphics

* PR# 38 *
Subject: possible bugs
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Sun, 6 Sep 1998 15:59:34 -0400 (EDT)
--ylim problem which appears solved
--Postscript overflow still with us (22feb99)
* PR# 61 *
Subject: points(...,  cex = ..)  is pretty wrong...
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 2 Nov 1998 19:15:06 +0100
--Symbols getting decentered when too large cex for X. Still there 22feb99  
* PR# 66 *
Subject: Bug with bounding box?
From: johnp@tip.csiro.au
Date: Thu, 3 Dec 1998 02:15:38 +0100
--Yes, this appears to have x/y reversed. The supplied example gives 
--%%Orientation: Landscape
--%%BoundingBox: 18 18 824 577 
--but the convention is to rotate the paper but leave the coordinate system.
* PR# 69 *
Subject: Some graphics bugs
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 04 Dec 1998 11:42:50 -0000 ()
Date: 04-Dec-98
--Various anomalies with text size and alignment. 2B appears to be solved. The 
--rest is still there (22feb99)
* PR# 79 *
Subject: apology: text(locator(),"sometext") works
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Tue, 15 Dec 1998 19:45:29 -0500 (EST)
--Clipping discrepancy x11/PS
* PR# 106 *
Subject: border-arg. in persp
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Fri, 29 Jan 1999 11:12:39 +0100
--No effect of arg. Still here 22feb99. Segfault with border=0 seems gone now. 
* PR# 114 *
Subject: PostScript Level 1/2 bug
From: ben@eno.princeton.edu
Date: Mon, 8 Feb 1999 00:07:20 +0100
--Not sure whether this is really PS lev 1/2 issue.
--/Font5 /Symbol findfont definefont
--(missing scalefont?)
* PR# 120 *
Subject: graphics bug: type="l"
From: Matthew Wiener <mcw@ln.nimh.nih.gov>
Date: Tue, 16 Feb 1999 15:30:25 -0500 (EST)
--X server problem drawing > 64K lines at once. Workaround?
* PR# 123 *
Subject: Text in plot
From: Ennapadam Venkatraman <venkat@biosta.mskcc.org>
Date: Thu, 18 Feb 1999 13:05:37 -0500
--Multiline text not working
* PR# 130 *
Subject: lty=0 -- shouldn't it give an invisible line?
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 28 Feb 1999 21:45:43 +0100
* PR# 149 *
Subject: plot.formula and pch=
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 25 Mar 1999 21:22:44 +0100
* PR# 150 *
Subject: R: error report
From: Adelchi Azzalini <adelchi.azzalini@jrc.it>
Date: Fri, 26 Mar 1999 09:39:05 +0000
* PR# 153 *
Subject: image + x11
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Wed, 31 Mar 1999 14:09:53 +0200

Directory:  In-Out

* PR# 125 *
Subject: scan rejects complex
From: John.Peters@tip.csiro.au (John Peters)
Date: Mon, 22 Feb 1999 10:08:14 +1100 (EST)
* PR# 129 *
Subject: Formatting in formatC and format
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 28 Feb 1999 08:53:34 +0000 (GMT)
--Documentation and ``merge'' of format() and formatC() would be desired - MM

Directory:  Installation

* PR# 95 *
Subject: patch to 63.2
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 15 Jan 1999 11:00:25 +0100 (MET)
--An incident where the 0.63.2 patches didn't take. So far the only one. 
--Maybe caused by patching unclean sources?

Directory:  Language

* PR# 40 *
Subject:  fac1 : fac2 -- fails {no "cross" anymore in seq.c} 
From: maechler@stat.math.ethz.ch
Date: Wed, 16 Sep 1998 08:42:12 +0200
--still there 17feb99
* PR# 85 *
Subject:  A bug in data.entry? 
From: Yusuke Uchiyama <me@naxgul.kais.kyoto-u.ac.jp>
Date: Wed, 23 Dec 1998 11:03:03 GMT
--still there 17feb99
* PR# 89 *
Subject: lapply -- Recall bug
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 6 Jan 1999 15:04:14 +0100
--This is *nasty*.
* PR# 105 *
Subject: an old bug resurfaces
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 29 Jan 1999 08:28:32 +0100 (MET)
--Model formulas. Proper fix probably requires extensive rewrite of model formula
--parser, which would make in non-S-compatible.
* PR# 113 *
Subject: cat data types
From: John Peters <johnp@tip.CSIRO.AU>
Date: Fri, 5 Feb 1999 18:31:52 +1100 (EDT)
--Cannot cat a name. (Docs fixed to reflect this by Kurt, 22feb99)
* PR# 118 *
Subject: Function parsing
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
Date: Wed, 10 Feb 1999 13:42:01 +0000 (GMT)
--comment placement.
* PR# 139 *
Subject: : for factors
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 11 Mar 1999 09:30:04 +0100

Directory:  Low-level

* PR# 37 *
Subject: S.h compatibility issues
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 6 Sep 1998 19:58:47 +0100 (BST)
* PR# 101 *
Subject: Re: [R] Re: R-0.63.2 for Windows - some comments
From: Guido Masarotto <guido@hal.stat.unipd.it>
Date: Fri, 22 Jan 1999 12:40:26 +0100
--This is really about fixed buffer sizes in printutils.c
* PR# 135 *
Subject: summary() of lm() problem
From: Simon Fear <fears@roycastle.liv.ac.uk>
Date: Tue, 9 Mar 1999 13:18:37 -0000 
--lm (?) AND Windows problem;  Win solved (fudged) for 0.63.3
--
--Another low-level buffer-size problem
* PR# 140 *
Subject: rbind dimnames with complex
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:15:14 +0100

Directory:  Misc

* PR# 91 *
Subject: possible bug
From: Rashid Nassar <rnassar@duke.edu>
Date: Sat, 9 Jan 1999 14:50:58 -0500 (EST)
--Remaining issue is whether we can do something more friendly than dumping 
--users into vi?

Directory:  Models

* PR# 121 *
Subject:  model.frame mangles time series 
From: Peter Dalgaard BSA <pd@biostat.ku.dk>
Date: Thu, 18 Feb 1999 15:47:24 +0100
--Subset in C code + attributes = mess
--Switch to interpreted ("[")

Directory:  Startup

* PR# 21 *
Subject: Restoring large image files
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 21 Aug 1998 13:29:16 -0000 ()

Directory:  System-specific

none

Directory:  TooMuchAtOnce

* PR# 53 *
Subject: 0.62.3 bugs, incompatibilities and problems
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 12 Oct 1998 09:43:51 +0200 (MET DST)
* PR# 76 *
Subject: R-0.63.0
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Fri, 11 Dec 1998 23:20:08 -0500 (EST)

Directory:  Windows

none

Directory:  incoming

* PR# 132 *
Subject: Re: [R] zero-offset matrices
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 02 Mar 1999 16:59:48 +0100
* PR# 144 *
Subject: glm throws erroneous(?)'names attribute must be the same length as the vector' 
From: wagman@enteract.com
Date: Thu, 18 Mar 1999 08:58:47 +0100
* PR# 145 *
Subject: R-0.63.3 package on IRIX 6.5 machine
From: Jayshree Sarma <jsarma@cs.gmu.edu>
Date: Tue, 23 Mar 1999 16:54:20 -0500 (EST)
* PR# 148 *
Subject: Missing Warning in :
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 25 Mar 1999 13:34:12 +0100
* PR# 151 *
Subject: problems with formals and get
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 29 Mar 1999 09:29:05 +0200 (MET DST)
* PR# 160 *
Subject: core dump
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Wed, 7 Apr 1999 16:30:39 +0200 (MET DST)
* PR# 163 *
Subject: IRIX compile
From: mtim@farm.ecs.umass.edu
Date: Sat, 10 Apr 1999 19:35:43 +0200
* PR# 164 *
Subject: Re: [R] repeated measurements libraries v0.4
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 11 Apr 1999 22:52:34 +0100 (BST)
* PR# 165 *
Subject: make check
From: Martyn Plummer <plummer@iarc.fr>
Date: Tue, 13 Apr 1999 12:03:42 +0200 (CEST)
* PR# 166 *
Subject: outer fails with group generic operations on factors
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Tue, 13 Apr 1999 18:28:53 +0100 (BST)
* PR# 167 *
Subject: R's UseMethod() does not dispatch on changed class()
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 14 Apr 1999 11:22:10 +0200
* PR# 168 *
Subject: Segfault from evalq(return())
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 16 Apr 1999 14:05:12 +0200
* PR# 169 *
Subject: deparse drops () sometimes
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 16 Apr 1999 14:10:39 +0200
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 21 08:49:03 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 Apr 1999 09:49:03 +0200
Subject: eigenvalue calculations
In-Reply-To: <6rvher56z5.fsf@verdi.stat.wisc.edu> (message from Douglas Bates
 on 20 Apr 1999 16:15:26 -0500)
References: <6rvher56z5.fsf@verdi.stat.wisc.edu>
Message-ID: <199904210749.JAA14072@sophie.ethz.ch>

I've added some hints and the det2() function 
to the help pages (*.Rd) of `eigen' and `qr'.

Martin
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pwhiting@fury.ittc.ukans.edu  Wed Apr 21 12:43:00 1999
From: pwhiting@fury.ittc.ukans.edu (pwhiting@fury.ittc.ukans.edu)
Date: Wed, 21 Apr 1999 13:43:00 +0200
Subject: [MAILER-DAEMON@biostat.ku.dk: Returned mail: /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs] (PR#170)
Message-ID: <199904211143.NAA09587@biostat.ku.dk>


--rwEMma7ioTxnRzrJ
Content-Type: text/plain; charset=us-ascii

at the bottom is a bug report - however I have include the bounce
headers in case you want to fix the mailer too.  This was the
result of an online bug submission via http://r-bugs.biostat.ku.dk/cgi-bin/R.

pete

--rwEMma7ioTxnRzrJ
Content-Type: message/rfc822
Content-Description: Forwarded message from Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>

Return-Path: <>
Received: from stephens.ittc.ukans.edu (stephens.ittc.ukans.edu [129.237.125.220])
	by fury.ittc.ukans.edu (8.8.7/8.8.7) with ESMTP id GAA11879
	for <pwhiting@fury.ittc.ukans.edu>; Wed, 21 Apr 1999 06:35:58 -0500
Received: from gate1.sprintlink.net (gate1.sprintlink.net [199.0.233.2])
	by stephens.ittc.ukans.edu (8.9.1/8.9.1/ITTC-NOSPAM-1.0) with SMTP id GAA17594
	for <pwhiting@ittc.ukans.edu>; Wed, 21 Apr 1999 06:35:45 -0500 (CDT)
Received: from elle.res.sprintlink.net by gate1.sprintlink.net
          via smtpd (for stephens.ittc.ukans.edu [129.237.125.220]) with SMTP; 21 Apr 1999 11:35:45 UT
Received: from gate1dmz0-qe0.res.sprintlink.net (gate1dmz.res.sprintlink.net [199.0.234.1])
	by elle.res.sprintlink.net (8.8.5/8.8.5) with SMTP id HAA13854
	for <pwhiting@sprint.net>; Wed, 21 Apr 1999 07:35:45 -0400 (EDT)
Received: from jay.sprintlink.net ([199.0.233.7]) by gate1dmz0-qe0.res.sprintlink.net
          via smtpd (for elle.res.sprintlink.net [199.0.234.34]) with SMTP; 21 Apr 1999 11:35:45 UT
Received: from biostat.ku.dk (blueberry.kubism.ku.dk [130.225.108.193])
	by jay.sprintlink.net (8.8.5/0.0.0) with ESMTP id HAA19423
	for <pwhiting@sprint.net>; Wed, 21 Apr 1999 07:35:44 -0400 (EDT)
Received: from localhost (localhost)
	by biostat.ku.dk (8.8.7/8.8.7) with internal id NAA09576;
	Wed, 21 Apr 1999 13:37:45 +0200
Date: Wed, 21 Apr 1999 13:37:45 +0200
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
Message-Id: <199904211137.NAA09576@biostat.ku.dk>
To: <pwhiting@sprint.net>
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
	boundary="NAA09576.924694665/biostat.ku.dk"
Subject: Returned mail: /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs
Auto-Submitted: auto-generated (failure)

This is a MIME-encapsulated message

--NAA09576.924694665/biostat.ku.dk

The original message was received at Wed, 21 Apr 1999 13:37:43 +0200
from blueberry.kubism.ku.dk [130.225.108.193]

   ----- The following addresses had permanent fatal errors -----
"|/home/sfe1/r-bugs/bin/new_message Rnew"
    (expanded from: <R-bugs@biostat.ku.dk>)

   ----- Transcript of session follows -----
550 /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs

--NAA09576.924694665/biostat.ku.dk
Content-Type: message/delivery-status

Reporting-MTA: dns; biostat.ku.dk
Received-From-MTA: DNS; blueberry.kubism.ku.dk
Arrival-Date: Wed, 21 Apr 1999 13:37:43 +0200

Final-Recipient: RFC822; r-bugs@biostat.ku.dk
X-Actual-Recipient: RFC822; "|/home/sfe1/r-bugs/bin/new_message Rnew"@biostat.ku.dk
Action: failed
Status: 5.7.1
Last-Attempt-Date: Wed, 21 Apr 1999 13:37:45 +0200

--NAA09576.924694665/biostat.ku.dk
Content-Type: message/rfc822

Return-Path: <pwhiting@sprint.net>
Received: from localhost (blueberry.kubism.ku.dk [130.225.108.193])
	by biostat.ku.dk (8.8.7/8.8.7) with ESMTP id NAA09575
	for <R-bugs@biostat.ku.dk>; Wed, 21 Apr 1999 13:37:43 +0200
Date: Wed, 21 Apr 1999 13:37:43 +0200
From: pwhiting@sprint.net
Message-Id: <199904211137.NAA09575@biostat.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: GConvert error when using pictex

Full_Name: Peter Whiting
Version: 0.64.0
OS: linux
Submission from: (NULL) (168.191.164.23)


I get an error whenever I try to plot a histogram in pictex.
The error doesn't occur for X11 or postscript.

> x<-c(1,2,3)
> pictex()
> hist(x)
Error: Bad units specified in GConvert, please report!

platform   i686-unknown-linux           
arch       i686                         
os         linux                        
system     i686, linux                  
status     Patched (unreleased snapshot)
status.rev 0                            
major      0                            
minor      64.0                         
year       1999                         
month      April                        
day        15                           
language   R                            

pete

--NAA09576.924694665/biostat.ku.dk--

--rwEMma7ioTxnRzrJ--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 13:04:19 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 14:04:19 +0200
Subject: test2 (PR#171)
Message-ID: <199904211204.OAA09626@biostat.ku.dk>


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 13:51:32 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 14:51:32 +0200 (MET DST)
Subject: Test (PR#172)
Message-ID: <199904211251.OAA24086@pubhealth.ku.dk>

Full_Name: Peter D
Version: --
OS: --
Submission from: (NULL) (127.0.0.1)


Trouble with mail config --solved?

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 21 14:20:18 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 21 Apr 1999 15:20:18 +0200
Subject: Test (PR#172)
In-Reply-To: pd@biostat.ku.dk's message of "Wed, 21 Apr 1999 14:51:32 +0200 (MET DST)"
References: <199904211251.OAA24086@pubhealth.ku.dk>
Message-ID: <x2hfqaxg8d.fsf@blueberry.kubism.ku.dk>

pd@biostat.ku.dk writes:

> Full_Name: Peter D
> Version: --
> OS: --
> Submission from: (NULL) (127.0.0.1)
> 
> 
> Trouble with mail config --solved?

OK, the problem seems to be gone now. Sorry for the disturbance.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pwhiting@sprint.net  Wed Apr 21 17:18:48 1999
From: pwhiting@sprint.net (pwhiting@sprint.net)
Date: Wed, 21 Apr 1999 18:18:48 +0200 (MET DST)
Subject: GConvert error when using pictex (PR#173)
Message-ID: <199904211618.SAA26673@pubhealth.ku.dk>


[I'm refiling this one due to mailer config messup]

I get an error whenever I try to plot a histogram in pictex.
The error doesn't occur for X11 or postscript.

> x<-c(1,2,3)
> pictex()
> hist(x)
Error: Bad units specified in GConvert, please report!

platform   i686-unknown-linux           
arch       i686                         
os         linux                        
system     i686, linux                  
status     Patched (unreleased snapshot)
status.rev 0                            
major      0                            
minor      64.0                         
year       1999                         
month      April                        
day        15                           
language   R                            

pete

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Wed Apr 21 17:20:29 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 Apr 1999 09:20:29 -0700 (PDT)
Subject: survival5
In-Reply-To: <199904211602.SAA24704@sophie.ethz.ch>
Message-ID: <Pine.GSO.4.10.9904210907360.13904-100000@wompom.biostat.washington.edu>

A nearly complete port of the new survival5 package has been sent to CRAN
and will soon be appearing on a mirror near you in the contrib/devel
area.

This new package, the successor to survival4, has a more stable likelihood
maximiser for parametric survival models and incorporates penalised
likelihoods for adding smoothing splines, ridge regression, and
(approximately) frailties to survival models. User-defined penalties are
also possible.

It is in the devel area for two reasons

(1) There are some tests I want to run against S-PLUS, and we don't have
survival5 installed for S-PLUS yet.

(2) It calls R internal functions to implement the penalised regression.
The API for these has not been standardised yet and you need to install
the package from an R source tree. 


Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 21 17:28:41 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 21 Apr 1999 18:28:41 +0200
Subject: GConvert error when using pictex (PR#173)
In-Reply-To: pwhiting@sprint.net's message of "Wed, 21 Apr 1999 18:18:48 +0200 (MET DST)"
References: <199904211618.SAA26673@pubhealth.ku.dk>
Message-ID: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>

pwhiting@sprint.net writes:

> [I'm refiling this one due to mailer config messup]
   ^^^

Oops. Me, that is. Whereas it *can* be figured out from the headers, I
probably should have signed that one....

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 21 17:37:58 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 Apr 1999 18:37:58 +0200
Subject: GConvert error when using pictex (PR#173)  (PR#150)
In-Reply-To: <199904211618.SAA26673@pubhealth.ku.dk> (pwhiting@sprint.net)
References: <199904211618.SAA26673@pubhealth.ku.dk>
Message-ID: <199904211637.SAA24863@sophie.ethz.ch>

Thank you for the report!

>>>>> "pwhiting" == pwhiting  <pwhiting@sprint.net> writes:

    pwhiting> I get an error whenever I try to plot a histogram in pictex.
    pwhiting> The error doesn't occur for X11 or postscript.

    pw>> x<-c(1,2,3); pictex() ; hist(x)
    pwhiting> Error: Bad units specified in GConvert, please report!


I believe that your report is just a much more compact example
of the same
bug reported on March 26, by Adelchi Azzalini, report no.150.

By the way:  The [Graphics] section at  http://R-bugs.biostat.ku.dk/
	     has quite a few bugs, some of which should really be addressed
	     rather sooner than later....
	     
I don't think the R-core team has any commitments on working on these,
but I think we should...

Martin
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 18:36:25 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 19:36:25 +0200 (MET DST)
Subject: do.call() mangles expressions in arguments (PR#174)
Message-ID: <199904211736.TAA26994@pubhealth.ku.dk>


> f<-function(x)x
> f(expression(print("Oops")))
expression(print("Oops"))
> do.call("f",list(expression(print("Oops"))))
[1] "Oops"

Something in the do_docall code causes an extra eval of the
argument. Causes trouble with math expressions in labels in 
boxplot (do.call("title",...))

--please do not edit the information below--

Version:
 platform = i586-unknown-linux
 arch = i586
 os = linux
 system = i586, linux
 status = Patched (unreleased snapshot)
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 22
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 21 21:46:41 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 21 Apr 1999 16:46:41 -0400 (EDT)
Subject: make check isn't quite right
In-Reply-To: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>

If I don't build the help pages at the start and then
do make check, 
  the examples for the base man pages get made but not
for any of the packages:

> example("smooth",package="eda")
Error: No help file found for'smooth'
Execution halted



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Wed Apr 21 22:49:39 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 Apr 1999 09:49:39 +1200 (NZST)
Subject: do.call() mangles expressions in arguments (PR#174)
In-Reply-To: <199904211736.TAA26994@pubhealth.ku.dk>
Message-ID: <Pine.BSF.4.05.9904220938180.3355-100000@g.ihaka.slip.auckland.ac.nz>



On Wed, 21 Apr 1999 pd@biostat.ku.dk wrote:

> 
> > f<-function(x)x
> > f(expression(print("Oops")))
> expression(print("Oops"))
> > do.call("f",list(expression(print("Oops"))))
> [1] "Oops"
> 
> Something in the do_docall code causes an extra eval of the
> argument. Causes trouble with math expressions in labels in 
> boxplot (do.call("title",...))

I think this is correct behavior.  The function "list" evaluates its
arguments and when it does the "expression" call gets evaluated.

I think that it is boxplot that needs to be fixed.  There needs to be some
form of quoting for the title (and xlab, ylab arguments).  It isn't
completely obvious to me what the right solution is.  It may require a
redesign of boxplot and bxp.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 00:21:18 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 01:21:18 +0200
Subject: do.call() mangles expressions in arguments (PR#174)
In-Reply-To: Ross Ihaka's message of "Thu, 22 Apr 1999 09:49:39 +1200 (NZST)"
References: <Pine.BSF.4.05.9904220938180.3355-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <x2vhepblw1.fsf@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Wed, 21 Apr 1999 pd@biostat.ku.dk wrote:
> 
> > 
> > > f<-function(x)x
> > > f(expression(print("Oops")))
> > expression(print("Oops"))
> > > do.call("f",list(expression(print("Oops"))))
> > [1] "Oops"
> > 
> > Something in the do_docall code causes an extra eval of the
> > argument. Causes trouble with math expressions in labels in 
> > boxplot (do.call("title",...))
> 
> I think this is correct behavior.  The function "list" evaluates its
> arguments and when it does the "expression" call gets evaluated.

Oh yes! (D**n! I know I decided to take it easy for a few days, but I
seem to have displaced my brain in the process.) 

> I think that it is boxplot that needs to be fixed.  There needs to be some
> form of quoting for the title (and xlab, ylab arguments).  It isn't
> completely obvious to me what the right solution is.  It may require a
> redesign of boxplot and bxp.

Hmm. The following seems to work for the xlabs problem at least:

    for (i in 1:length(pars)) pars[[i]] <- as.call(c(as.name("expression"), 
        pars[[i]]))
    if (plot) {
        bxp(groups, width, varwidth = varwidth, notch = notch,
    ...etc...

(one might want to guard that assignment by an if(is.expression())
thing) 


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Thu Apr 22 04:45:26 1999
From: wvenable@arcola.stats.adelaide.edu.au (wvenable@arcola.stats.adelaide.edu.au)
Date: Thu, 22 Apr 1999 05:45:26 +0200 (MET DST)
Subject: Assigning to a list within a loop (PR#175)
Message-ID: <199904220345.FAA28639@pubhealth.ku.dk>

We noticed this bug in more complex code, but this succinctly
describes the phenomenon.

If you do not re-initialize a each time in the following loop,
the final value only is assigned to all places when the loop is
complete.

> a <- b <- list()
> for(i in 1:5) {
+	a$alpha <- i
+	b[[i]] <- a
+	}
> unlist(b)
alpha alpha alpha alpha alpha 
    5     5     5     5     5 

If a is re-created each time, however the correct behaviour
happens:


> b <- list()
> for(i in 1:5) {
+	  a <- list(alpha = i)
+	  b[[i]] <- a
+	  }
> unlist(b)
alpha alpha alpha alpha alpha 
    1     2     3     4     5 

> version
           _                 
platform   i586-unknown-linux
arch       i586              
os         linux             
system     i586, linux       
status                       
status.rev 0                 
major      0                 
minor      64.0              
year       1999              
month      April             
day        8                 
language   R                 
>

Bill Venables & Berwin Turlach.

-- 
-----------------------------------------------------------------
Bill Venables, Statistician, CMIS Environmetrics Project.

Physical address:                            Postal address:
CSIRO Marine Laboratories,                   PO Box 120,       
233 Middle St, Cleveland, Queensland         Cleveland, Qld, 4163
AUSTRALIA                                    AUSTRALIA

Telephone: +61 7 3826 7251     Email: Bill.Venables@cmis.csiro.au     
      Fax: +61 7 3826 7304

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr 22 07:30:29 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 Apr 1999 08:30:29 +0200 (CEST)
Subject: make check isn't quite right
In-Reply-To: <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>
References: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>
 <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>
Message-ID: <14110.49669.12978.909618@pc87.maho.magnaeu.com>

>>>>> Robert Gentleman writes:

> If I don't build the help pages at the start and then
> do make check, 
>   the examples for the base man pages get made but not
> for any of the packages:

>> example("smooth",package="eda")
> Error: No help file found for'smooth'
> Execution halted

Your observation is correct.  What currently happens is something like

	make R
	for pkg in PKGS; do
	  maybe rebuild pkg examples/help pages
	  try to run the examples
	done

This will fail if the tests for pkg1 assume that pkg2 help/examples must
be there.

We could easily change the `make R' to `make; make help; make examples'
but I am not sure that this is the right thing.  Conceptually, `eda' is
an add-on package and all that must be there is base (Rlang/Rstat), so I
think the example should be changed.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 22 07:45:53 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Thu, 22 Apr 1999 07:45:53 +0100 (BST)
Subject: make check isn't quite right
In-Reply-To: <14110.49669.12978.909618@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.05.9904220736000.4204-100000@auk.stats>

On Thu, 22 Apr 1999, Kurt Hornik wrote:

> >>>>> Robert Gentleman writes:
> 
> > If I don't build the help pages at the start and then
> > do make check, 
> >   the examples for the base man pages get made but not
> > for any of the packages:
> 
> >> example("smooth",package="eda")
> > Error: No help file found for'smooth'
> > Execution halted
> 
> Your observation is correct.  What currently happens is something like
> 
> 	make R
> 	for pkg in PKGS; do
> 	  maybe rebuild pkg examples/help pages
> 	  try to run the examples
> 	done
> 
> This will fail if the tests for pkg1 assume that pkg2 help/examples must
> be there.
> 
> We could easily change the `make R' to `make; make help; make examples'
> but I am not sure that this is the right thing.  Conceptually, `eda' is
> an add-on package and all that must be there is base (Rlang/Rstat), so I
> think the example should be changed.

I think 

-- the example is a nice one for human readers
-- it is a useful test on the codebase (at least one version I created
   of example failed it).

My problem is with

> > Error: No help file found for'smooth'
> > Execution halted

Now if we could keep running, we would get to see _all_ the problems
and be able to ignore those we knew about. 

Alternatively, I could fix the specific case, and make this a warning and
do-nothing condition.  I am inclined to do that anyway. The only
knock-on effect I can see is that some examples call other examples, and if
the included ones are missing then the main example main fail in an
unanticipated way.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Thu Apr 22 13:52:34 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 Apr 1999 14:52:34 +0200 (CEST)
Subject: R on AIX
Message-ID: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>


I tried to build R on AIX and after 2 minor bugfixes everything seems
to work fine except for dynamic loading of code.

In a previous mail I found that Fabrizio Moro succeeded using

	SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg" 

which compiles fine for me, I get also no error messages upon
dynloading, but no symbols are available afterwards, i.e. is.loaded
fails (I tried also with trailing underscores etc.).

Has anybody some experience which flags to use?

I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
compiles but produces incorrect code, i.e., some computations are
wrong).

Make check succeeds until eda :-)

.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu Apr 22 14:04:30 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 Apr 1999 15:04:30 +0200
Subject: R on AIX
In-Reply-To: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at> (message from
 Friedrich Leisch on Thu, 22 Apr 1999 14:52:34 +0200 (CEST))
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>
Message-ID: <199904221304.PAA05194@sophie.ethz.ch>

>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:

    FrL> I tried to build R on AIX and after 2 minor bugfixes everything
    FrL> seems to work fine except for dynamic loading of code.

    FrL> In a previous mail I found that Fabrizio Moro succeeded using

    FrL>   SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg"

    FrL> which compiles fine for me, I get also no error messages upon
    FrL> dynloading, but no symbols are available afterwards,
    FrL> i.e. is.loaded fails (I tried also with trailing underscores
    FrL> etc.).

Yes.  Unfortunately, Fabrizio (nor me) followed up on that mail telling you
that we (Fabrizio and me) ended up with the exact same symptomps as you
have.

I gave up at that time; Fabrizio continues to use S-plus on AIX
(and R on Linux, to some extentes at least)...
... yes a sad story,  but I think we both ended up with the impression that
AIX is half broken environment anyway 
 --- at least if you want to compile software that has no problems at all
     on other architectures...


    FrL> Has anybody some experience which flags to use?

    FrL> I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
    FrL> compiles but produces incorrect code, i.e., some computations are
    FrL> wrong).

    FrL> Make check succeeds until eda :-)

exactly. The first time, dyn.load is needed....

Martin.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr 22 14:20:19 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 Apr 1999 15:20:19 +0200 (CEST)
Subject: R on AIX
In-Reply-To: <199904221304.PAA05194@sophie.ethz.ch>
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>
 <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <14111.8723.93389.159193@pc87.maho.magnaeu.com>

>>>>> Martin Maechler writes:

>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:
FrL> I tried to build R on AIX and after 2 minor bugfixes everything
FrL> seems to work fine except for dynamic loading of code.

FrL> In a previous mail I found that Fabrizio Moro succeeded using

FrL> SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg"

FrL> which compiles fine for me, I get also no error messages upon
FrL> dynloading, but no symbols are available afterwards,
FrL> i.e. is.loaded fails (I tried also with trailing underscores
FrL> etc.).

> Yes.  Unfortunately, Fabrizio (nor me) followed up on that mail telling you
> that we (Fabrizio and me) ended up with the exact same symptomps as you
> have.

> I gave up at that time; Fabrizio continues to use S-plus on AIX
> (and R on Linux, to some extentes at least)...
> ... yes a sad story,  but I think we both ended up with the impression that
> AIX is half broken environment anyway 
>  --- at least if you want to compile software that has no problems at all
>      on other architectures...


FrL> Has anybody some experience which flags to use?

FrL> I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
FrL> compiles but produces incorrect code, i.e., some computations are
FrL> wrong).

FrL> Make check succeeds until eda :-)

> exactly. The first time, dyn.load is needed....

It might help to look into other software for which dynloading works
under AIX.  Three potential examples come to mind:

	Xlisp-stat
	Octave
	Tcl

Anyone willing to have a look?

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 14:19:03 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 15:19:03 +0200
Subject: R on AIX
In-Reply-To: Martin Maechler's message of "Thu, 22 Apr 1999 15:04:30 +0200"
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at> <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <x2r9pchjy0.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> that we (Fabrizio and me) ended up with the exact same symptomps as you
> have.
> 
> I gave up at that time; Fabrizio continues to use S-plus on AIX
> (and R on Linux, to some extentes at least)...
> ... yes a sad story,  but I think we both ended up with the impression that
> AIX is half broken environment anyway 
>  --- at least if you want to compile software that has no problems at all
>      on other architectures...

Have you tried following up on pointers from DejaNews? A quick search
on "aix dynamic link" turned up this one:

---snip
On Tue, 23 Mar 1999 22:44:30 -0000, PaulT <News@ecosmart.demon.co.uk> wrote:

>I am trying to create a 'c' link libary for use with java I'm struggling
>because
>documentation indicates that the -G option should be used with
>cc to create a dynamic library, but it is not available for AIX  v4.

Check the makefile in the /usr/J1.1.6/jni_example/c directory, these contain
the proper command line flags.

-- 
Jens-Uwe Mager  <pgp-mailto:62CFDB25>
---snap


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Thu Apr 22 14:26:01 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Thu, 22 Apr 1999 15:26:01 +0200 (DFT)
Subject: R on AIX
In-Reply-To: <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>

We have R running on AIX (several OS versions between 4.1 and 4.3) and we
are able to load code dynamically. Our solution was essentially developed
by Heiner Schwarte. We use a different version of dynload.c and the linker
is called like this:

  $(F77) -o module.so  \   
           -bM:SRE -bE:module.exp -bnoentry  $(OBJECTS)  $(LIBDIR) $(LIBS)

where module.exp contains all symbols that have to be exported.

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Thu Apr 22 15:21:00 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 Apr 1999 16:21:00 +0200 (CEST)
Subject: R on AIX
In-Reply-To: <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>
References: <199904221304.PAA05194@sophie.ethz.ch>
 <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>
Message-ID: <14111.12364.351689.643342@galadriel.ci.tuwien.ac.at>

>>>>> On Thu, 22 Apr 1999 15:26:01 +0200 (DFT),
>>>>> Arne Kovac (AK) wrote:

AK> We have R running on AIX (several OS versions between 4.1 and 4.3) and we
AK> are able to load code dynamically. Our solution was essentially developed
AK> by Heiner Schwarte. We use a different version of dynload.c and the linker
AK> is called like this:

AK>   $(F77) -o module.so  \   
AK>            -bM:SRE -bE:module.exp -bnoentry  $(OBJECTS)  $(LIBDIR) $(LIBS)

AK> where module.exp contains all symbols that have to be exported.

Have you got modified Makefiles to automate this procedure, i.e.,
create the export file and which libs to include?

What's your `different version of dynload.c'?

.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Thu Apr 22 15:41:54 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Thu, 22 Apr 1999 16:41:54 +0200 (DFT)
Subject: R on AIX
In-Reply-To: <14111.12364.351689.643342@galadriel.ci.tuwien.ac.at>
Message-ID: <Pine.A41.4.02.9904221628420.14640-100000@cauchy.mathematik.uni-essen.de>

On Thu, 22 Apr 1999, Friedrich Leisch wrote:

> Have you got modified Makefiles to automate this procedure, i.e.,
> create the export file and which libs to include?

No, I'm afraid we extend our module.exp every time we write a new
function... Not very convenient, and even worse, adding a new library is
always a pain. But AIX users get used to that...

> What's your `different version of dynload.c'?

I attach it below. I am quite sure that you should be able to compile a
working version of R, if you use AIX 4.2.x and R<=0.63.1. However, I
wouldn't give any promises for AIX 4.3 and/or R 0.64. Recently I reported
on this list about my installation problems and I don't know whether they
are caused by the new OS or R version.

Arne

----------
/*
 *  R : A Computer Langage for Statistical Data Analysis
 *  Copyright (C) 1995  Robert Gentleman and Ross Ihaka
 *  Copyright (C) 1997  The R Core Team
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */


/*  Dynamic Loading Support
 *
 *  This module provides support for run-time loading of shared libraries
 *  access to symbols within such libraries via .C and .Fortran.  This is
 *  done under Unix with dlopen, dlclose and dlsym (the exception is
 *  hpux, where we use compatibility code provided by Luke Tierney.
 *  There are two cases:
 *
 *
 *  1. The dlopen interface is available.
 *
 *  In this case all symbol location is done using the dlopen routines.
 *  We maintain a list of currently loaded shared libraries in an array
 *  called "LoadedDLL" with the number of currenly loaded libraries
 *  being "CountDLL".  To locate a symbol, we probe the loaded libraries
 *  in order until the symbol is located.  If we do not find a symbol
 *  in the loaded libraries, we search the executable itself.  This
 *  search is not very efficient, but this probably pales into
 *  insignificance when compared with the inefficiencies in the R
 *  interpreter.
 *
 *  Loading and unloading of shared libraries is done via the routines
 *  AddDLL and DeleteDLL.  These routines maintain the list of currently
 *  loaded libraries.  When a library is added, any existing reference
 *  to that library are deleted and then the library is inserted at the
 *  start of the search list.  This way, symbols in more recently loaded
 *  libraries are found first.
 *
 *
 *  2. The dlopen interface is not available.
 *
 *  In this case we use the table "CFunTabEntry" to locate functions
 *  in the executable.  We do this by straight linear search through
 *  the table.  Note that the content of the table is created at
 *  system build time from the list in ../appl/ROUTINES.
 */

#include "Defn.h"
#include "Mathlib.h"
#include <string.h>
#include <stdlib.h>
#include <sys/param.h>

typedef int (*DL_FUNC)();
typedef struct {
        char *name;
        DL_FUNC func;
} CFunTabEntry;  
#include "FFDecl.h"
#include "FFDecl.h"

	/* This provides a table of built-in C and Fortran functions */

static CFunTabEntry CFunTab[] =
{
#include "FFTab.h"
        {NULL, NULL}
};      

	/* The following code loads in a compatibility module */
	/* written by Luke Tierney to support S version 4 on */
	/* Hewlett-Packard machines.  The relevant defines are */
	/* set up by autoconfigure */

#ifdef HAVE_DLFCN_H
#include <dlfcn.h>
#else
#ifdef HAVE_DL_H
#include "hpdlfcn.c"
#define HAVE_DLFCN_H
#endif
#endif

#ifdef HAVE_DLFCN_H
#ifndef RTLD_LAZY
#define RTLD_LAZY 1
#endif

struct libhandlelist
{
  void *ptr;
  char *librarypath;
  struct libhandlelist *next;
};

static struct libhandlelist *list = NULL;

static void 
add_ptr (void *p, char *name)
{
  struct libhandlelist *tmp;
  if (p == NULL)
    return;
  tmp = (struct libhandlelist *) malloc (sizeof (struct libhandlelist));
  tmp->ptr = p;
  tmp->librarypath = (char *) malloc (sizeof (char) * (strlen (name) + 1));
  strcpy (tmp->librarypath, name);
  tmp->next = list;
  list = tmp;
}

/* Inserts the specified DLL at the start of the DLL list */
/* All the other entries are "moved down" by one. */
/* Returns 1 if the library was successfully added */
/* and returns 0 if there library table is full or */
/* or if dlopen fails for some reason. */

static int AddDLL(char *path)
{
  void *handle;
  handle = dlopen(path, RTLD_LAZY|RTLD_GLOBAL);
  if(handle == NULL){
	printf("%s\n",dlerror());
    return 0;
}
  add_ptr(handle,path);
  return 1;
}

static void RemoveFromHashTable (void *);

/* Remove the specified DLL from the current DLL list */
/* Returns 1 if the DLL was found and removed from */
/* the list and returns 0 otherwise. */

static int DeleteDLL(char *path)
{
  struct libhandlelist *ptr, *oldptr=NULL;
  ptr = list;
  while (ptr != NULL)
    {
      if (strcmp (ptr->librarypath, path) == 0)
	{
	  RemoveFromHashTable (ptr->ptr);
	  dlclose (ptr->ptr);
	  free (ptr->librarypath);
	  if (list == ptr)
	    list = ptr->next;
	  else
	    oldptr->next = ptr->next;
	  free (ptr);
	  return 1;
	}
      oldptr = ptr;
      ptr = ptr->next;
    }
  return 0;
}

typedef struct HashTabElem
  {
    CFunTabEntry data;
    struct HashTabElem *next;
    void *libraryhandle;
  }
HashTabElem;


/* HashTable stores name - pointer pairs with chaining. Sometimes      */
/* the hashtable  will be expanded and reorganized. The implementation */
/* is entirely elementary.  Possible sizes of the table are 2^p+1      */
/* where p is a positive integer.                                      */

static HashTabElem **HashTable;
static int HASHSIZE;
static int NumberElem;


static int 
HashCode (char *symbol)
{
  unsigned int code = 0;
  char *p = symbol;

  while (*p)
    code = 8 * code + *p++;
  return code % HASHSIZE;
}


static void 
HashInstall (char *name, DL_FUNC func, void *libhandle)
{
  int key;
  HashTabElem *newptr;
  newptr = (HashTabElem *) malloc (sizeof (HashTabElem));
  (newptr->data).name = (char *) malloc (strlen (name) + 1);
  strcpy ((newptr->data).name, name);
  (newptr->data).func = func;
  newptr->libraryhandle = libhandle;
  NumberElem++;
  key = HashCode (name);
  newptr->next = HashTable[key];
  HashTable[key] = newptr;
}


static void 
HashExpand ()
{
  int oldsize;
  int i;
  HashTabElem **OldTable;
  HashTabElem *ptr, *newptr;
  oldsize = HASHSIZE;
  OldTable = HashTable;
  HASHSIZE = 2 * HASHSIZE - 1;
  NumberElem = 0;
  HashTable = (HashTabElem **) malloc (HASHSIZE *
				       sizeof (HashTabElem *));
  for (i = 0; i < HASHSIZE; i++)
    HashTable[i] = NULL;

  for (i = 0; i < oldsize; i++)
    {
      ptr = OldTable[i];
      while (ptr != NULL)
	{
	  HashInstall (ptr->data.name, ptr->data.func, ptr->libraryhandle);
	  newptr = ptr->next;
	  free (ptr->data.name);
	  free (ptr);
	  ptr = newptr;
	}
    }
  free (OldTable);
}

static DL_FUNC 
HashLookup (char *symbol)
{
  int key;
  HashTabElem *ptr;
  key = HashCode (symbol);
  ptr = HashTable[key];
  while (ptr != NULL)
    {
      if (strcmp (symbol, (ptr->data).name) == 0)
	return (ptr->data).func;
      ptr = ptr->next;
    }
  return NULL;
}


static void 
RemoveFromHashTable (void *handle)
{
  int key;
  HashTabElem *ptr, *oldptr=NULL;
  for (key = 0; key < HASHSIZE; key++)
    {
      ptr = HashTable[key];
      while (ptr != NULL)
	{
	  if (ptr->libraryhandle == handle)
	    {
	      if (HashTable[key] == ptr)
		{
		  HashTable[key] = ptr->next;
		  free ((ptr->data).name);
		  free (ptr);
		  ptr = HashTable[key];
		}
	      else
		{
		  oldptr->next = ptr->next;
		  free ((ptr->data).name);
		  free (ptr);
		  ptr = oldptr->next;
		}
	    }
	  else
	    {
	      oldptr = ptr;
	      ptr = ptr->next;
	    }
	}
    }
}



/* findDynProc checks whether one of the libraries    */
/* that have been loaded contains the symbol name and */
/* returns a pointer to that symbol and the library   */ 
/* handle upon success.                               */


DL_FUNC 
findDynProc (char const *name, void **handle)
{
  struct libhandlelist *tmp;
  DL_FUNC fcnptr;
  for (tmp = list; tmp != NULL; tmp = tmp->next)
    {
      /* The following line is not legal ANSI C. */
      /* It is only meant to be used in systems supporting */
      /* the dlopen() interface, in which systems data and  */
      /* function pointers _are_ the same size and _can_   */
      /* be cast without loss of information.              */
      fcnptr = (DL_FUNC) dlsym (tmp->ptr, name);
      if (fcnptr != NULL)
	{
	  *handle = tmp->ptr;
	  return fcnptr;
	}
    }
  return NULL;
}


DL_FUNC R_FindSymbol(char const *name)
{
  char buf[MAXIDSIZE+1];
  DL_FUNC fcnptr=NULL;
  void *libhandle;
  sprintf(buf, "%s", name);
     if (!(fcnptr = HashLookup (buf)))
    {
      if ((fcnptr = findDynProc (buf, &libhandle)))
	{
	  if ((1.0 * NumberElem) / HASHSIZE > 0.5)
	    HashExpand ();
	  HashInstall (buf, fcnptr, libhandle);
	}
    }
if(fcnptr!=NULL)
return fcnptr;
  sprintf(buf, "%s_", name);
  
     if (!(fcnptr = HashLookup (buf)))
    {
      if ((fcnptr = findDynProc (buf, &libhandle)))
	{
	  if ((1.0 * NumberElem) / HASHSIZE > 0.5)
	    HashExpand ();
	  HashInstall (buf, fcnptr, libhandle);
	}
    }

 return fcnptr;
}


void 
InitFunctionHashing ()
{
  int n;
  int i, size = 3;
#ifdef OLD
  NaokSymbol = install ("NAOK");
  DupSymbol = install ("DUP");
#endif
  n = sizeof (CFunTab) / sizeof (CFunTabEntry);
  while (size < n/2 )
    size = 2 * size - 1;
  HASHSIZE = size;
  NumberElem = 0;
  HashTable = (HashTabElem **) malloc (HASHSIZE * sizeof (HashTabElem *));
  for (i = 0; i < HASHSIZE; i++)
    HashTable[i] = NULL;
  for (i = 0; CFunTab[i].name; i++)
    HashInstall (CFunTab[i].name, CFunTab[i].func, NULL);
  HashExpand ();
}


static void GetFullDLLPath(SEXP call, char *buf, char *path)
{
	if(path[0] != '/') {
		if(!getwd(buf))
			errorcall(call, "can't get working directory!\n");
		strcat(buf, "/");
		strcat(buf, path);
	}
	else strcpy(buf, path);
}

	/* do_dynload implements the R-Interface for the */
	/* loading of shared libraries */

SEXP do_dynload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	char buf[2*MAXPATHLEN];
	checkArity(op,args);
	if (!isString(CAR(args)) || length(CAR(args)) < 1)
		errorcall(call, "character argument expected\n");
	GetFullDLLPath(call, buf, CHAR(STRING(CAR(args))[0]));
	DeleteDLL(buf);
	if(!AddDLL(buf))
		errorcall(call, "unable to load shared library \"%s\"\n", buf);
	return R_NilValue;
}

SEXP do_dynunload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	char buf[2*MAXPATHLEN];
	checkArity(op,args);
	if (!isString(CAR(args)) || length(CAR(args)) < 1)
		errorcall(call, "character argument expected\n");
	GetFullDLLPath(call, buf, CHAR(STRING(CAR(args))[0]));
	if(!DeleteDLL(buf))
		errorcall(call, "shared library \"%s\" was not loaded\n", buf);
	return R_NilValue;
}

#else

void InitFunctionHashing()
{
#ifdef OLD
        NaokSymbol = install("NAOK");
        DupSymbol = install("DUP");
#endif
}

DL_FUNC R_FindSymbol(char const *name)
{
	int i;
	for(i=0 ; CFunTab[i].name ; i++)
		if(!strcmp(name, CFunTab[i].name))
			return CFunTab[i].func;
	return (DL_FUNC)0;
}

SEXP do_dynload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	error("no dyn.load support in this R version\n");
}

SEXP do_dynunload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	error("no dyn.load support in this R version\n");
}

#endif



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 22 16:14:51 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 22 Apr 1999 11:14:51 -0400 (EDT)
Subject: Assigning to a list within a loop (PR#175)
In-Reply-To: <199904220345.FAA28639@pubhealth.ku.dk>
Message-ID: <Pine.SV4.4.05.9904221109250.7304-100000@hsph.harvard.edu>



On Thu, 22 Apr 1999 wvenable@arcola.stats.adelaide.edu.au wrote:

> We noticed this bug in more complex code, but this succinctly
> describes the phenomenon.
> 
> If you do not re-initialize a each time in the following loop,
> the final value only is assigned to all places when the loop is
> complete.
> 
> > a <- b <- list()
> > for(i in 1:5) {
> +	a$alpha <- i
> +	b[[i]] <- a
> +	}
> > unlist(b)
> alpha alpha alpha alpha alpha 
>     5     5     5     5     5 
> 
> If a is re-created each time, however the correct behaviour
> happens:
> 
> 
> > b <- list()
> > for(i in 1:5) {
> +	  a <- list(alpha = i)
> +	  b[[i]] <- a
> +	  }
> > unlist(b)
> alpha alpha alpha alpha alpha 
>     1     2     3     4     5 
> 
> > version
>            _                 
> platform   i586-unknown-linux
> arch       i586              
> os         linux             
> system     i586, linux       
> status                       
> status.rev 0                 
> major      0                 
> minor      64.0              
> year       1999              
> month      April             
> day        8                 
> language   R                 
> >
> 
> Bill Venables & Berwin Turlach.
> 
  I think that worse things could happen, the problem seems to be around
 line 1486 of subassign (the first line is missing in the current source)

  1486              if( NAMED(y) ) y = duplicate(y);
  1487              VECTOR(x)[offset] = y;
  1488              break;
  1489

  I think that you need to duplicate y, and have added that line;
  but perhaps what you need to do is to increment NAMED of y(???)
  I'll commit it if Ross doesn't yell too loud

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Thu Apr 22 17:59:44 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Thu, 22 Apr 1999 18:59:44 +0200 (CEST)
Subject: mvfft
Message-ID: <XFMail.990422185944.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Type: text/plain; charset=us-ascii

R-0.64.0 on RedHat Linux 5.1

Some problems with multivariate fast fourier transform. I
have attached the dump of a 30 x 3 matrix that seems to
reliably reproduce these problems

1) mvfft doesn't like vectors. It complains about not having
   enough memory:

R> mvfft(xx[,1])
Error: heap memory (2048 Kb) exhausted [needed 1024 Kb more]
       See "help(Memory)" on how to increase the heap size.

What in fact is happening here is that do_mvfft tries to
get the dimensions of the argument (fourier.c: 125), but 
gets junk instead, since the argument is not an array.

2) mvfft causes a segmentation fault or gets stuck in a loop

R> mvfft(xx)

Program received signal SIGSEGV, Segmentation fault.
0x80d36cb in fftmx (a=0x40617eb0, b=0x40617eb8, ntot=30, n=30, nspan=30, 
    isn=-2, m=3, kt=0, at=0x407c8f58, ck=0x407c8f80, bt=0x407c8fa8, 
    sk=0x407c8fd0, np=0x407c8ee4, nfac=0x8115a78) at fft.c:558
558         bt[j] = b[k1] - b[k2];
(gdb) print bt[j]
Cannot access memory at address 0x407cb000.
(gdb) print kspan
$4 = 0

We're in a loop here where kspan is the increment for k1 and decrement
for k2. The loop breaks when k1 < k2, but somehow kspan is zero.  How it
got there, I can't say, as we're in goto hell at this point.

Martyn

--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Disposition: attachment; filename="dumpdata"
Content-Transfer-Encoding: 7bit
Content-Description: dumpdata
Content-Type: text/plain; charset=us-ascii; name=dumpdata; SizeOnDisk=946

"xx" <-
structure(c(2.80791, 2.92504, 3.02911, 2.85911, 3.28071, 3.43015, 
2.3898, 1.67055, 3.81164, 2.43832, 2.92065, 1.37547, 3.23811, 
2.96203, 2.83998, 2.36596, 3.51832, 2.59301, 3.08633, 2.87675, 
3.16977, 2.81822, 2.48206, 3.28322, 2.51132, 3.01153, 3.25603, 
2.98599, 2.93238, 2.12555, 1.15452, 0.625684, 0.708469, 0.984351, 
0.576846, 0.228625, 1.40307, 1.21012, 0.143615, 1.4046, 1.32799, 
0.0254974, 1.17005, 1.28567, 1.51562, 0.842245, 0.852613, 0.780749, 
0.967637, 0.810536, 0.858167, 0.960625, 0.613509, 1.38389, 1.22199, 
0.93934, 0.479022, 0.684411, 0.907639, 0.694256, 0.637226, 0.698318, 
0.404093, 0.979977, 1.42097, 0.761441, 1.0802, 2.09035, 2.85473, 
2.44305, 1.81988, 1.78082, 1.69385, 0.643862, 1.5311, 0.960032, 
0.69531, 0.821253, 0.49187, 0.394229, 0.806075, 0.557793, 0.694918, 
1.46079, 1.56847, 0.823876, 0.73726, 0.698766, 0.800476, 1.45114
), .Dim = c(30, 3), .Dimnames = list(NULL, c("alpha", "beta", 
"sigma")))

--_=XFMail.1.3.p0.Linux:990422185944:4782=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Thu Apr 22 17:54:53 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Thu, 22 Apr 1999 18:54:53 +0200 (MET DST)
Subject: mvfft (PR#176)
Message-ID: <199904221654.SAA07496@pubhealth.ku.dk>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Type: text/plain; charset=us-ascii

R-0.64.0 on RedHat Linux 5.1

Some problems with multivariate fast fourier transform. I
have attached the dump of a 30 x 3 matrix that seems to
reliably reproduce these problems

1) mvfft doesn't like vectors. It complains about not having
   enough memory:

R> mvfft(xx[,1])
Error: heap memory (2048 Kb) exhausted [needed 1024 Kb more]
       See "help(Memory)" on how to increase the heap size.

What in fact is happening here is that do_mvfft tries to
get the dimensions of the argument (fourier.c: 125), but 
gets junk instead, since the argument is not an array.

2) mvfft causes a segmentation fault or gets stuck in a loop

R> mvfft(xx)

Program received signal SIGSEGV, Segmentation fault.
0x80d36cb in fftmx (a=0x40617eb0, b=0x40617eb8, ntot=30, n=30, nspan=30, 
    isn=-2, m=3, kt=0, at=0x407c8f58, ck=0x407c8f80, bt=0x407c8fa8, 
    sk=0x407c8fd0, np=0x407c8ee4, nfac=0x8115a78) at fft.c:558
558         bt[j] = b[k1] - b[k2];
(gdb) print bt[j]
Cannot access memory at address 0x407cb000.
(gdb) print kspan
$4 = 0

We're in a loop here where kspan is the increment for k1 and decrement
for k2. The loop breaks when k1 < k2, but somehow kspan is zero.  How it
got there, I can't say, as we're in goto hell at this point.

Martyn

--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Disposition: attachment; filename="dumpdata"
Content-Transfer-Encoding: 7bit
Content-Description: dumpdata
Content-Type: text/plain; charset=us-ascii; name=dumpdata; SizeOnDisk=946

"xx" <-
structure(c(2.80791, 2.92504, 3.02911, 2.85911, 3.28071, 3.43015, 
2.3898, 1.67055, 3.81164, 2.43832, 2.92065, 1.37547, 3.23811, 
2.96203, 2.83998, 2.36596, 3.51832, 2.59301, 3.08633, 2.87675, 
3.16977, 2.81822, 2.48206, 3.28322, 2.51132, 3.01153, 3.25603, 
2.98599, 2.93238, 2.12555, 1.15452, 0.625684, 0.708469, 0.984351, 
0.576846, 0.228625, 1.40307, 1.21012, 0.143615, 1.4046, 1.32799, 
0.0254974, 1.17005, 1.28567, 1.51562, 0.842245, 0.852613, 0.780749, 
0.967637, 0.810536, 0.858167, 0.960625, 0.613509, 1.38389, 1.22199, 
0.93934, 0.479022, 0.684411, 0.907639, 0.694256, 0.637226, 0.698318, 
0.404093, 0.979977, 1.42097, 0.761441, 1.0802, 2.09035, 2.85473, 
2.44305, 1.81988, 1.78082, 1.69385, 0.643862, 1.5311, 0.960032, 
0.69531, 0.821253, 0.49187, 0.394229, 0.806075, 0.557793, 0.694918, 
1.46079, 1.56847, 0.823876, 0.73726, 0.698766, 0.800476, 1.45114
), .Dim = c(30, 3), .Dimnames = list(NULL, c("alpha", "beta", 
"sigma")))

--_=XFMail.1.3.p0.Linux:990422185944:4782=_--
End of MIME message

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 22 20:06:05 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 22 Apr 1999 15:06:05 -0400 (EDT)
Subject: options
In-Reply-To: <199904220345.FAA28639@pubhealth.ku.dk>
Message-ID: <Pine.SV4.4.05.9904221440170.7304-100000@hsph.harvard.edu>


 Before I go too far down the wrong track we need to think a little bit
about how "options" is going to behave in a threaded environment. The
reason for this is that S uses "options" to control most of the error
handling.
 I'm sure that we want thread specific behaviour and that seems to imply
that "options" is going to have to be thread specific. Without worrying
about how we are going to achieve that, does anyone have any qualms
about this?
 Duncan has said that in S, when he threaded it, options was a frame 0
object and frame 0 was thread specific. We don't really have frames.
Conceptually it seems that we are going to have to stick an environment
between GlobalEnv and any evaluation envs where that environment 
contains thread specific items (perhaps all assignments along that
thread).


  As for error handling S offers:
    error, interrupt, and warning.expression
  as options. All of which are supposed to be expressions with no
arguments (no free variables I assume) that are evaluated when an
error, an interrupt or a warning occurs (if warning.expression is
non-null then options("warn") is ignored).
  I should get those in today.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 22:55:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 23:55:14 +0200
Subject: options
In-Reply-To: Robert Gentleman's message of "Thu, 22 Apr 1999 15:06:05 -0400 (EDT)"
References: <Pine.SV4.4.05.9904221440170.7304-100000@hsph.harvard.edu>
Message-ID: <x2ogkggw1p.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>  Duncan has said that in S, when he threaded it, options was a frame 0
> object and frame 0 was thread specific. We don't really have frames.
> Conceptually it seems that we are going to have to stick an environment
> between GlobalEnv and any evaluation envs where that environment 
> contains thread specific items (perhaps all assignments along that
> thread).

Hmm. Ross has also been talking about "frame 0" when talking about
attachments to position 1. Does that fit in?

If I get the picture right (I've never tried threads in S), there may
be an alternative where the thread-specific environment sits on top of
the the environment from which the thread is started, rather than
GlobalEnv.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 23 14:33:52 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 23 Apr 1999 09:33:52 -0400 (EDT)
Subject: options and other things
In-Reply-To: <x2ogkggw1p.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904230925260.20965-100000@hsph.harvard.edu>



On 22 Apr 1999, Peter Dalgaard BSA wrote:

> Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> 
> >  Duncan has said that in S, when he threaded it, options was a frame 0
> > object and frame 0 was thread specific. We don't really have frames.
> > Conceptually it seems that we are going to have to stick an environment
> > between GlobalEnv and any evaluation envs where that environment 
> > contains thread specific items (perhaps all assignments along that
> > thread).
> 
> Hmm. Ross has also been talking about "frame 0" when talking about
> attachments to position 1. Does that fit in?
> 
> If I get the picture right (I've never tried threads in S), there may
> be an alternative where the thread-specific environment sits on top of
> the the environment from which the thread is started, rather than
> GlobalEnv.
> 
Brian's comment is correct, only Duncan and John ever played with threaded
S and it currently doesn't work with some high probability (and Duncan
said he didn't think it ever would be publicly available).

I guess what I'm thinking is that all threads get started from GlobalEnv,
but that there has to be an extra thread specific env stuck in right
on top of GlobalEnv and before any evaluation envs (so that thread 
specific info can be handled appropriately).

However, having done a little reading over the past few days I'm a bit
discouraged about how difficult it will be to get this stuff correct.
According to at least one author, threads are hard but they are infinitely
easier than signal catching/exception handling. So making a function
thread-safe is possible (not all C level ones that we use are) making
it reentrant on an asynchronous signal is much more difficult.

I am also coming quickly to the belief that POSIX might be the right
coding standard for R. It at least has some standard stuff for letting
you know (at compile time) what level of thread safety is available in
the C library. 

Does that have bad implications for you and Guido, Brian? I'm a bit
worried because alot of the signal handling is if-def'd for Unix only.
Perhaps it should shift and be if-def'd for the correct level of 
POSIX?

What about the Mac?

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri Apr 23 18:13:32 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 23 Apr 1999 19:13:32 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: <199904220944.LAA10647@gwen.stat.unipd.it.>
References: <199904220944.LAA10647@gwen.stat.unipd.it.>
Message-ID: <199904231713.TAA15277@sophie.ethz.ch>

Dear Prof Azzalini,

You have an interesting example of  recursive use of  uniroot().
    [re-cited at the end]
However, note that R currently has the same problem as S-plus:

Uniroot() doesn't work reliably, recursively.
When you found it to be better, you were just lucky.

The relevant file in R's source,   src/main/optimize.c
says 

   /* WARNING : As things stand, these routines should not be called
    *	     recursively because of the way global variables are used.
    *	     This could be fixed by saving and restoring these global variables.
    */

--------

Fellow R-code developpers :  

       Does anyone of you feel like fixing these?
       Would be really nice and useful!

       (and you will become famous in the R community ... :-)

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum SOL G1;	Sonneggstr.33
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1086			<><

>>>>> "AA" == Adelchi Azzalini <aa@gwen.stat.unipd.it> writes 
      to S-news on 22 Apr 1999 :

    AA> Dear S+ users,

    AA> has anyone experienced problems with uniroot(), in Splus 4.5?  
    AA> In my case, it locates a (non-existing) solution outside the 
    AA> given search interval. The S-news database on Statlib does not
    AA> show anything of this sort.

    AA> In the sample problem below, a root is searched in  the 
    AA> interval ( 0.02418690, 0.07753657), with an existing solution
    AA> near  0.05408. 
    AA> However uniroot comes up with the the answer -0.6160564 (!)

    AA> The code below should reproduce the problem.
    AA> Possibly, the problem is due to the recursive call to uniroot().
    AA> However, R 0.64 produces more sensible answers.

    AA> Regards
    AA> Adelchi Azzalini

    AA> #---------------------------------------------------

    AA> f.dev <- function(mu,y,crit) f.deviance(mu,y,F)-crit

    AA> f.deviance <- function(mu, y, display=F){
    AA> g <- function(x,d) mean(d/(1+x*d))
    AA> epsilon<-(1e-8)
    AA> W<-rep(NA,length=length(mu))
    AA> for(i in 1:length(mu)) {
    AA> d <- (y-mu[i])
    AA> interv<- c(-1/max(d)+epsilon,-1/min(d)-epsilon)
    AA> root <- uniroot(g,interval=interv,d=d) 
    AA> lambda<-root$root
    AA> W[i] <- 2*sum(log(1+lambda*d))
    AA> if(is.na(W[i])| W[i]<0) warning("W<0 or W==NA")
    AA> }
    AA> if(length(mu)>1 & display) plot(mu,W,type="l")
    AA> return(W)
    AA> }

    AA> #-----------------
    AA> #  sample problem:
    AA> #
    AA> y <- c(0.8931869, 0.6805792, 0.8349237, rep(0,97))
    AA> interv <- c( 0.02418690, 0.07753657)
    AA> crit <- 2.705543

    AA> print(f.dev(interv,y,crit))
    AA> # [1] -2.705491  3.881472

    AA> print(f.dev(0.05408, y,crit))
    AA> # [1] -0.0001011083

    AA> uniroot(f.dev, interval=interv, y=y, crit=crit)$root
    AA> # [1] -0.6160564
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgutwin@us.ibm.com  Fri Apr 23 19:08:57 1999
From: pgutwin@us.ibm.com (pgutwin@us.ibm.com)
Date: Fri, 23 Apr 1999 20:08:57 +0200 (MET DST)
Subject: R won't compile on Redhat 5.2 (PR#177)
Message-ID: <199904231808.UAA17927@pubhealth.ku.dk>

Full_Name: Paul Gutwin
Version: R-0.64.0
OS: Redhat 5.2
Submission from: (NULL) (198.133.22.73)


I built a new Linux machine, and was trying to install R on it. I get the
following
message during the build:

make[2]: Entering directory `/usr/src/R-0.64.0/src/nmath'
gcc -g -O2 -I../include -I../../src/include  -c mlutils.c -o mlutils.o
gcc -g -O2 -I../include -I../../src/include  -c d1mach.c -o d1mach.o
gcc: Internal compiler error: program cc1 got fatal signal 6
make[2]: *** [d1mach.o] Error 1
make[2]: Leaving directory `/usr/src/R-0.64.0/src/nmath'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/usr/src/R-0.64.0/src'
make: *** [R] Error 1

I've built R on an older Linux system without trouble.



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 24 00:50:48 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 24 Apr 1999 01:50:48 +0200
Subject: R won't compile on Redhat 5.2 (PR#177)
In-Reply-To: pgutwin@us.ibm.com's message of "Fri, 23 Apr 1999 20:08:57 +0200 (MET DST)"
References: <199904231808.UAA17927@pubhealth.ku.dk>
Message-ID: <x2k8v2dhgn.fsf@blueberry.kubism.ku.dk>

pgutwin@us.ibm.com writes:

> I built a new Linux machine, and was trying to install R on it. I get the
> following
> message during the build:
> 
> make[2]: Entering directory `/usr/src/R-0.64.0/src/nmath'
> gcc -g -O2 -I../include -I../../src/include  -c mlutils.c -o mlutils.o
> gcc -g -O2 -I../include -I../../src/include  -c d1mach.c -o d1mach.o
> gcc: Internal compiler error: program cc1 got fatal signal 6

> I've built R on an older Linux system without trouble.

That looks like a system problem more than anything else. R gets
rebuilt on RedHat 5.2 a couple of times per day, usually. Are you sure
your RAM sticks are seated properly, etc.?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr 25 00:41:04 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 25 Apr 1999 01:41:04 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Martin Maechler's message of "Fri, 23 Apr 1999 19:13:32 +0200"
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch>
Message-ID: <x2yajhh9in.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> Dear Prof Azzalini,
> 
> You have an interesting example of  recursive use of  uniroot().
...
> Fellow R-code developpers :  
> 
>        Does anyone of you feel like fixing these?
>        Would be really nice and useful!
> 
>        (and you will become famous in the R community ... :-)

Well, uniroot calls zeroin which is a FORTRAN routine. As long as this
is the case, all bets are off as to whether or not it will be
reentrant on any given system. In principle, it is not, and FORTRAN
just plain states that "you cannot do that", but if your compiler
happens to be f2c-like, and no global storage is involved, then it
*might* work after all. The example doesn't work on my system either.

The only sensible thing to do to get this to work is to rewite zeroin
in C. According to the comments in the file, it is a transcription of
an Algol60 program, so it is probably not hard to convert it to
another Algol descendant.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From naras@stat.stanford.edu  Mon Apr 26 00:55:36 1999
From: naras@stat.stanford.edu (Balasubramanian Narasimhan)
Date: Sun, 25 Apr 1999 16:55:36 -0700 (PDT)
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Your message of "25 Apr 1999 01:41:04 +0200"
 <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
Message-ID: <19990425165536M.naras@stat.Stanford.EDU>

>>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    Peter> The only sensible thing to do to get this to work is to
    Peter> rewite zeroin in C. According to the comments in the file,
    Peter> it is a transcription of an Algol60 program, so it is
    Peter> probably not hard to convert it to another Algol
    Peter> descendant.

Agreed, but there's no need for a rewrite. A C version has been
available in Netlib for some time.

________________________________________________________________
B. Narasimhan                            naras@stat.stanford.edu
                             http://www-stat.stanford.edu/~naras





-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From adelchi.azzalini@jrc.it  Mon Apr 26 10:12:35 1999
From: adelchi.azzalini@jrc.it (Adelchi Azzalini)
Date: Mon, 26 Apr 1999 10:12:35 +0100
Subject: [S] uniroot -- doesn't work recursively
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch> <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
Message-ID: <37242E03.63BEAB06@jrc.it>

Martin Maechler wrote:

) However, note that R currently has the same problem as S-plus:

) Uniroot() doesn't work reliably, recursively.
) When you found it to be better, you were just lucky.

Right.  I realised later on that R seemed to behave better but 
it could not work properly since it calls a Fortran (66? 77?) routine.
It just happen to produce less obviously wrong answers than Splus.
In fact more tests confirm wrong answers, but not as non-sensical 
as those from Splus.

To get around the problem,  I have replaced  f(x)=0 by f^2(x)=min,
where f(x)is computed with the aid of uniroot(), and the minimization
is solved by optimize(). This works.

Peter Dalgaard BSA wrote:
> 
> Martin Maechler <maechler@stat.math.ethz.ch> writes:
> 
> 
> Well, uniroot calls zeroin which is a FORTRAN routine. As long as this
> is the case, all bets are off as to whether or not it will be
> reentrant on any given system. In principle, it is not, and FORTRAN
> just plain states that "you cannot do that", but if your compiler
> happens to be f2c-like, and no global storage is involved, then it
> *might* work after all. The example doesn't work on my system either.
> 
> The only sensible thing to do to get this to work is to rewite zeroin
> in C. According to the comments in the file, it is a transcription of
> an Algol60 program, so it is probably not hard to convert it to
> another Algol descendant.
> 

My R 0.64 is obtained from the binary file distributed by CRAN in Wien
(compiled by Guido Masarotto?), so I do not know which the compiler is 
used.

Thanks for your comments

Regards
Adelchi Azzalini
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 13:57:21 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 14:57:21 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Balasubramanian Narasimhan's message of "Sun, 25 Apr 1999 16:55:36 -0700 (PDT)"
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU>
Message-ID: <x2r9p7v8su.fsf@blueberry.kubism.ku.dk>

Balasubramanian Narasimhan <naras@stat.stanford.edu> writes:

> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
> 
>     Peter> The only sensible thing to do to get this to work is to
>     Peter> rewite zeroin in C. According to the comments in the file,
>     Peter> it is a transcription of an Algol60 program, so it is
>     Peter> probably not hard to convert it to another Algol
>     Peter> descendant.
> 
> Agreed, but there's no need for a rewrite. A C version has been
> available in Netlib for some time.

Thanks for the pointer, Naras! 

Found, adapted and inserted (in my private source tree for now). It
wasn't a complete drop-in replacement since it didn't support max.iter
and didn't return convergence info, but close enough.

Unfortunately, closer inspection revealed that the Fortran-ness of
zeroin was not the only problem, there's also trouble with global
storage used by the wrapper routine. And since C doesn't have lexical
scoping, that stuff needs to be passed around via arguments. Oh
well...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon Apr 26 14:19:37 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 26 Apr 1999 15:19:37 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: <x2r9p7v8su.fsf@blueberry.kubism.ku.dk> (message from Peter
 Dalgaard BSA on 26 Apr 1999 14:57:21 +0200)
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU> <x2r9p7v8su.fsf@blueberry.kubism.ku.dk>
Message-ID: <199904261319.PAA04686@sophie.ethz.ch>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> Balasubramanian Narasimhan <naras@stat.stanford.edu> writes:
    >> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
    >> writes:
    >> 
    Peter> The only sensible thing to do to get this to work is to rewite
    Peter> zeroin in C. According to the comments in the file, it is a
    Peter> transcription of an Algol60 program, so it is probably not hard
    Peter> to convert it to another Algol descendant.
    >>  Agreed, but there's no need for a rewrite. A C version has been
    >> available in Netlib for some time.

    PD> Thanks for the pointer, Naras!

    PD> Found, adapted and inserted (in my private source tree for now). It
    PD> wasn't a complete drop-in replacement since it didn't support
    PD> max.iter and didn't return convergence info, but close enough.

The max.iter and convergence info are things that Jim Lindsey and I had
ADDED to the original netlib/Fortran code.
It's the ``value-added'' part of the R (vs. S-plus) code...

    PD> Unfortunately, closer inspection revealed that the Fortran-ness of
    PD> zeroin was not the only problem, there's also trouble with global
    PD> storage used by the wrapper routine. And since C doesn't have
    PD> lexical scoping, that stuff needs to be passed around via
    PD> arguments. Oh well...

yes (I think that's what the comment in optimize.c [the wrapper] meant
     that I had cited here...).
and  YES  it would be really nice if that could be done, finally.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 14:27:29 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 15:27:29 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Martin Maechler's message of "Mon, 26 Apr 1999 15:19:37 +0200"
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU> <x2r9p7v8su.fsf@blueberry.kubism.ku.dk> <199904261319.PAA04686@sophie.ethz.ch>
Message-ID: <x2pv4rv7em.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

>     PD> zeroin was not the only problem, there's also trouble with global
>     PD> storage used by the wrapper routine. And since C doesn't have
>     PD> lexical scoping, that stuff needs to be passed around via
>     PD> arguments. Oh well...
> 
> yes (I think that's what the comment in optimize.c [the wrapper] meant
>      that I had cited here...).
> and  YES  it would be really nice if that could be done, finally.

It is done now. (Actually took about as much time as writing the email
griping about it...)

>      uniroot(f.dev, interval=interv, y=y, crit=crit)     
$root
[1] 0.05408745

$f.root
[1] 0.0009728222

$iter
[1] 5

$estim.prec
[1] 6.103516e-05

I'll commit my stuff in a moment.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 15:54:51 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 16:54:51 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Adelchi Azzalini's message of "Mon, 26 Apr 1999 10:12:35 +0100"
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch> <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <37242E03.63BEAB06@jrc.it>
Message-ID: <x2n1zvv3d0.fsf@blueberry.kubism.ku.dk>

Adelchi Azzalini <adelchi.azzalini@jrc.it> writes:

> Martin Maechler wrote:
> 
> ) However, note that R currently has the same problem as S-plus:
> 
> ) Uniroot() doesn't work reliably, recursively.
> ) When you found it to be better, you were just lucky.
> 
> Right.  I realised later on that R seemed to behave better but 
> it could not work properly since it calls a Fortran (66? 77?) routine.
> It just happen to produce less obviously wrong answers than Splus.
> In fact more tests confirm wrong answers, but not as non-sensical 
> as those from Splus.

The development version now has a reentrant uniroot(). Those of you
outside R-core who are interested can get it in the next development
snapshot. (and perhaps remind me what is the proper typecast to avoid
the following error message...)

optimize.c: In function `do_zeroin':
optimize.c:205: warning: passing arg 3 of `zeroin' from incompatible pointer type

Binaries are a bit further into the future, I'm afraid.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Mon Apr 26 17:47:23 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 26 Apr 1999 12:47:23 -0400
Subject: [R] random sequence
References: <0FAS00HIDRIZW5@hermes.ucd.ie>
Message-ID: <3724989B.D57AC481@bank-banque-canada.ca>

>How can I get the same stream of random numbers in R and S?

I'd like to do this too.  I think you need to extract the RNG C code from R and
compile then dynload it into S. If you get it working please let me know.

Thanks,

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 26 18:10:32 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 26 Apr 1999 18:10:32 +0100 (BST)
Subject: [R] random sequence
Message-ID: <199904261710.SAA08747@toucan.stats.ox.ac.uk>

> Date: Mon, 26 Apr 1999 12:47:23 -0400
> From: Paul Gilbert <pgilbert@bank-banque-canada.ca>
> 
> >How can I get the same stream of random numbers in R and S?
> 
> I'd like to do this too.  I think you need to extract the RNG C code from R 
and
> compile then dynload it into S. If you get it working please let me know.


What exactly do you want?  My class exercise is to implement the
Wichmann-Hill algorithm in C/Fortran and use it with S-PLUS! But
while one is at it, why not use a decent generator with both?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Mon Apr 26 21:08:02 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Mon, 26 Apr 1999 16:08:02 -0400 (EDT)
Subject: problems with formals and get (PR#151)
In-Reply-To: <x2d80ruru1.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904261603320.27933-100000@hsph.harvard.edu>

Peter wrote:


jlindsey@alpha.luc.ac.be writes:

> With 0.63.3, try
> 
> test <- function(){
>       fn <- function(a) print("hello")
>       print(is.function(fn))
>       print(names(formals("fn")))}
> test()
> 
> if fn is not quoted in the last line of test, it works properly.

This version of formals seems to work better:

function (fun = sys.function(sys.parent())) 
{
    if (is.character(fun)) 
        fun <- get(fun, mode = "function", envir =
sys.frame(sys.parent()))
    .Internal(formals(fun))
}

> test <- function(){
>       fn <- function() print("hello")
>       formals(fn) <- alist(a=,b=)
>       return(fn)}
> formals(test())
> 
> now try with line 3 of test changed to
>       formals(fn) <- alist(a=)

This is a bug, originating in sys.call:

> xx<-function(...)sys.call()
> xx(a=)
xx()
> xx(a=,b=)
xx(a = , b = )



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~

Bzzt: the bug was in gram.y not in sys.call.
It should be fixed now. If an arg list only had one element and
that element didn't have a default the arglist was being
stripped.

I also committed Peter's improved version of formals.

All this is in the 0.65 (unstable) branch.


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 27 12:52:05 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Tue, 27 Apr 1999 13:52:05 +0200 (CEST)
Subject: mvfft (PR#176)
Message-ID: <XFMail.990427135205.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990427135205:436=_
Content-Type: text/plain; charset=us-ascii

This should fix it.
1) Check that the dimensions are not null.
2) Call fft_factor before each call to fft_work.  The array nfac
   is set by fft_factor and overwritten by fftmx (in src/appl/fft.c,
   called by fft_work). Since nfac is not an argument of fft_work,
   nor of fft_factor it is not easy to spot the bug!

--_=XFMail.1.3.p0.Linux:990427135205:436=_
Content-Disposition: attachment; filename="fourier.diff"
Content-Transfer-Encoding: 7bit
Content-Description: fourier.diff
Content-Type: text/plain; charset=us-ascii; name=fourier.diff; SizeOnDisk=833

diff -uNr R-0.64.0/src/main/fourier.c R-fixed/src/main/fourier.c
--- R-0.64.0/src/main/fourier.c	Fri Feb  5 07:44:44 1999
+++ R-fixed/src/main/fourier.c	Tue Apr 27 12:44:48 1999
@@ -123,7 +123,7 @@
     z = CAR(args);
 
     d = getAttrib(z, R_DimSymbol);
-    if (length(d) > 2)
+    if (d == R_NilValue || length(d) > 2)
 	errorcall(call, "vector-valued series required\n");
     n = INTEGER(d)[0];
     p = INTEGER(d)[1];
@@ -156,9 +156,11 @@
 	    errorcall(call, "fft factorization error\n");
 	work = (double*)R_alloc(4 * maxf, sizeof(double));
 	iwork = (int*)R_alloc(maxp, sizeof(int));
-	for (i = 0; i < p; i++)
+	for (i = 0; i < p; i++) {
+	    fft_factor(n, &maxf, &maxp);
 	    fft_work(&(COMPLEX(z)[i*n].r), &(COMPLEX(z)[i*n].i),
 		     1, n, 1, inv, work, iwork);
+        }
 	vmaxset(vmax);
     }
     UNPROTECT(1);

--_=XFMail.1.3.p0.Linux:990427135205:436=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Tue Apr 27 17:54:48 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 27 Apr 1999 12:54:48 -0400
Subject: ts
Message-ID: <3725EBD8.9C58131C@bank-banque-canada.ca>

ts() is giving me problems on Solaris:

R : Copyright 1999, The R Development Core Team
Version 0.64.0  (April 8, 1999)
...
> z <- ts(matrix(1:20,10,2), start=c(1969,1), frequency=12)
> max(abs(z-z))
Error: invalid time series parameters specified
> traceback()
[1] "max(abs(z - z))"
> max(abs(z+z))
Error: invalid time series parameters specified
>

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Tue Apr 27 18:32:05 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Tue, 27 Apr 1999 19:32:05 +0200 (MET DST)
Subject: Multivariate ts -- arithmetic bug [ for SOME time-series ] (PR#178)
Message-ID: <199904271732.TAA18748@pubhealth.ku.dk>


Paul wrote to R-devel :

    PaulG> ts() is giving me problems on Solaris:
    PaulG> R : Copyright 1999, The R Development Core Team
    PaulG> Version 0.64.0  (April 8, 1999)
    PaulG> ...
    >> z <- ts(matrix(1:20,10,2), start=c(1969,1), frequency=12)
    >> max(abs(z-z))
    PaulG> Error: invalid time series parameters specified
    >> traceback()
    PaulG> [1] "max(abs(z - z))"
    >> max(abs(z+z))
    PaulG> Error: invalid time series parameters specified

This is a SEVERE (new?) bug.

it's already visible as

  > z <- ts(matrix(1:48,ncol=2), start=c(1969,1), frequency=12);  z+z
  Error: invalid time series parameters specified

Note that not all multivariate  ts show the problem; e.g.,

  > data(presidents) # also a multivariate ts
  > p <- presidents
  > p + p
  > 3 * p

all work

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 27 22:38:32 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 27 Apr 1999 23:38:32 +0200
Subject: Multivariate ts -- arithmetic bug [ for SOME time-series ] (PR#178)
In-Reply-To: maechler@stat.math.ethz.ch's message of "Tue, 27 Apr 1999 19:32:05 +0200 (MET DST)"
References: <199904271732.TAA18748@pubhealth.ku.dk>
Message-ID: <x2aevt7nhj.fsf@blueberry.kubism.ku.dk>

maechler@stat.math.ethz.ch writes:


> This is a SEVERE (new?) bug.
> 
> it's already visible as
> 
>   > z <- ts(matrix(1:48,ncol=2), start=c(1969,1), frequency=12);  z+z
>   Error: invalid time series parameters specified

Found and squashed (setting tsp attrib before dims on the result is a
bad idea, since tspgets checks with for consistency with nrows(vec)!).
Committed for 0.64.1.

> 
> Note that not all multivariate  ts show the problem; e.g.,
> 
>   > data(presidents) # also a multivariate ts
>   > p <- presidents
>   > p + p
>   > 3 * p
> 
> all work

Erm. That one isn't multivariate:

> dim(p)
NULL

It's just getting prettyprinted in 4 columns because it happens to be
quarterly data...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Wed Apr 28 16:31:47 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Wed, 28 Apr 1999 17:31:47 +0200 (CEST)
Subject: configure for packages
Message-ID: <14119.10723.632172.658144@galadriel.ci.tuwien.ac.at>


when I get a working connection to auckland again I will commit a new
version of the INSTALL script which allows packages to run configure
befor anything else is done (hence create Makefiles and patch R code
depending on if some lib's are found etc.)

R INSTALL now works as follows:

	cd pkgdir
	if ./configure exists run it
	do everything as has been done until now
	if ./cleanup exists and flag --clean was used, run ./cleanup 

i.e., you can add 2 execs to the top-level directory of a package
which perform pre-installation configuration and post-installation
cleanup. cleanup should remove all files that were created by
configure.

the configure script may be created by autoconf but of course must
not.

I have put a new version of the e1071 package onto CRAN which uses
configure to search for the netpbm library. It currently only looks
for libnetpbm (correct for debian linux sytems). If the functions
pnm_readpnm & friends are contained in another lib on your system,
please let me know such that I can modify configure.in accordingly (or
better: send me the patched version :-))

.f







-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 29 09:48:58 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 29 Apr 1999 10:48:58 +0200 (MET DST)
Subject: Problems with setting .Random.seed (PR#179)
Message-ID: <199904290848.KAA01351@pubhealth.ku.dk>

I have commited fixes for 0.64.1 for

(1) From: Mai Zhou <mai@ms.uky.edu>
> .Random.seed <- c(1, 1:2)
> .Random.seed
[1] 1 1 2
> runif(5)
Warning: Wrong length .Random.seed; forgot initial RNGkind? set to
Wichmann-Hill[1] 0.02253721 0.84832584  ........

Here the length of the seed was being tested before the kind was
picked out, so the length of the previous type was used.

(2) 
> .Random.seed <- c(0, 30269, 30307, 30323)
> runif(1)
[1] 0
> .Random.seed
[1] 0 0 0 0

and it remains zero thereafter.

This was particularly invidious as the help has said (for a long time,
despite my commenting several times, even in the `R Complements')

          The seed, `.Random.seed[-1] == r[1:3]' is an
          integer vector of length 3, where each `r[i]' is
          in `1:p[i]', where `p' is the length 3 vector of
          primes, `p = (30269, 30307, 30323)'. The

This should be (and will be) 1:(p[1] - 1).

(3) The help page now says what the length of the seed is and the
restrictions for the "Marsaglia-Multicarry" and "Super-Duper" kinds
and corrects the description of the latter.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr 29 18:28:33 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 29 Apr 1999 13:28:33 -0400
Subject: another ts problem
Message-ID: <372896C1.862C5EB8@bank-banque-canada.ca>

My previous ts problem is fixed in today's snapshot but ...

R : Copyright 1999, The R Development Core Team
Version 0.64.0 Patched (unreleased snapshot) (April 29, 1999)
...
> z <- ts(matrix(rnorm(300),100,3),start=c(1961,1), frequency=12)
> all(z==z)
Error: invalid time series parameters specified
>

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr 29 19:04:49 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 29 Apr 1999 13:04:49 -0500
Subject: gdb and f77
Message-ID: <6ru2tz5mm6.fsf@verdi.stat.wisc.edu>

I am trying to debug some code that uses the nlm optimizer but with
analytic gradient and hessian.  The optimization code itself is
written in Fortran ($RSRC/src/appl/uncmin.f).  I compiled 
 Version 0.64.0 Patched (unreleased snapshot) (April 29, 1999)
with the -g flag and ran it under gdb.  When I set a breakpoint at
heschk_ I can trace the execution and I can print the values of local
scalar variables or scalar arguments.  When I try to print the values
of array elements I am always getting a segmentation violation, either 
under the automatic choice of language (Fortran) or manually setting
the language to C.

Has anyone had experience with using gdb on Fortran code compiled with 
g77?  If so, can you tell me what syntax I should use to access an
array element.

This is the sort of thing that happens:
 ...
 ) at uncmin.f:1052
 Current language:  auto; currently fortran
 (gdb) set lang c
 Warning: the current language does not match this frame.
 (gdb) p j
 $1 = 1
 (gdb) p udiag
 $2 = (double precision (*)[536870911]) 0x421aee98
 (gdb) p udiag[1]

 Debugger segmentation fault
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 29 20:41:37 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 29 Apr 1999 21:41:37 +0200
Subject: another ts problem
In-Reply-To: Paul Gilbert's message of "Thu, 29 Apr 1999 13:28:33 -0400"
References: <372896C1.862C5EB8@bank-banque-canada.ca>
Message-ID: <x2d80nuscu.fsf@blueberry.kubism.ku.dk>

Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:

> My previous ts problem is fixed in today's snapshot but ...

> > z <- ts(matrix(rnorm(300),100,3),start=c(1961,1), frequency=12)
> > all(z==z)
> Error: invalid time series parameters specified
> >

Pah! Exact same error, but in do_relop (relop.c)... Will fix.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 29 21:14:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 29 Apr 1999 22:14:14 +0200
Subject: another ts problem
In-Reply-To: Peter Dalgaard BSA's message of "29 Apr 1999 21:41:37 +0200"
References: <372896C1.862C5EB8@bank-banque-canada.ca> <x2d80nuscu.fsf@blueberry.kubism.ku.dk>
Message-ID: <x24slzfall.fsf@blueberry.kubism.ku.dk>


> Pah! Exact same error, but in do_relop (relop.c)... Will fix.

..and the patch is this:

diff -c -r1.8.2.1 relop.c
*** /tmp/T0a005Bn       Fri Apr 30 08:03:10 1999
--- relop.c     Fri Apr 30 08:03:10 1999
***************
*** 136,146 ****
      }
  
      PROTECT(x);
-     if (xts || yts) {
-       setAttrib(x, R_TspSymbol, tsp);
-       setAttrib(x, R_ClassSymbol, class);
-       UNPROTECT(2);
-     }
      if (dims != R_NilValue) {
        setAttrib(x, R_DimSymbol, dims);
        if (xnames != R_NilValue)
--- 136,141 ----
***************
*** 154,159 ****
--- 149,159 ----
        else if (length(x) == length(ynames))
            setAttrib(x, R_NamesSymbol, ynames);
      }
+     if (xts || yts) {
+       setAttrib(x, R_TspSymbol, tsp);
+       setAttrib(x, R_ClassSymbol, class);
+       UNPROTECT(2);
+     }
  
      UNPROTECT(4);
      return x;

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr 29 23:09:37 1999
From: bates@stat.wisc.edu (bates@stat.wisc.edu)
Date: Fri, 30 Apr 1999 00:09:37 +0200 (MET DST)
Subject: nlm on a function in the Math group (PR#180)
Message-ID: <199904292209.AAA07303@pubhealth.ku.dk>

If nlm is called with a function in the Math group it causes a
segmentation violation in DispatchGroup.  For example
 R> nlm( sin, -0.5, print.level = 2 )

 Process R segmentation fault at Thu Apr 29 17:10:15 1999

--please do not edit the information below--

Version:
 platform = i686-unknown-linux
 arch = i686
 os = linux
 system = i686, linux
 status = Patched (unreleased snapshot)
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 29
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From J.C.Rougier@durham.ac.uk  Fri Apr 30 09:48:13 1999
From: J.C.Rougier@durham.ac.uk (J.C.Rougier@durham.ac.uk)
Date: Fri, 30 Apr 1999 10:48:13 +0200 (MET DST)
Subject: polygon() help file (PR#181)
Message-ID: <199904300848.KAA08594@pubhealth.ku.dk>

A minor point, but the polygon() help file needs a small amount of
attention (0.63.2).  First, there appears to be no \usage{} line.  Second,
the default is not to leave the border undrawn, as documented, but to draw
the border in par("fg").

Cheers, Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE

"[B]egin upon the precept ... that the things we see are to be 
 weighed in the scale with what we know"  (Meredith, 1879, The Egoist)



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Fri Apr 30 12:39:15 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Fri, 30 Apr 1999 13:39:15 +0200 (MET DST)
Subject: polygon() help file (PR#181)
Message-ID: <199904301139.NAA09111@pubhealth.ku.dk>

>>>>> "JonR" == J C Rougier <J.C.Rougier@durham.ac.uk> writes:

    JonR> A minor point, but the polygon() help file needs a small amount
    JonR> of attention (0.63.2).  First, there appears to be no \usage{}
    JonR> line.  Second, the default is not to leave the border undrawn, as
    JonR> documented, but to draw the border in par("fg").

Done [for 0.64.1],
thanks a lot!

Yes, all of you, please send bug reports even as small as that one to
R-bugs !

Martin

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Fri Apr 30 17:54:31 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Fri, 30 Apr 1999 18:54:31 +0200 (MET DST)
Subject: par help page  errors (PR#182)
Message-ID: <199904301654.SAA09919@pubhealth.ku.dk>

R 0.64.0

In the help page for par(), the parameters "oma"
and "omi" are described as vectors of the form
c(xb, xt, yl, yr)
whereas they are
c(xb,yl,xt,yr)

Martyn

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Thu Apr  1 00:07:40 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu,  1 Apr 1999 11:07:40 +1200 (NZST)
Subject: GC, Disk Storage, etc
In-Reply-To: <Pine.LNX.4.04.9903311441410.14356-100000@localhost>
References: <Pine.LNX.4.04.9903311441410.14356-100000@localhost>
Message-ID: <14082.42975.280157.296729@g.ihaka.slip.auckland.ac.nz>

Gregory R. Warnes writes:
 > 
 > I'm wondering what the plans are for the memory management system.  
 > 
 > Once there is a dynamic memory allocation system in place it would be nice
 > to augment that so that objects which are not currently being used need
 > not be resident in memory.  This way, rarely used objects will not be
 > filling up the memory of the R process.
 > 
 > (Yes, I am thinking about a cross between the current R and S object
 > storage ideas.)
 > 
 > It should be possible to set up an object access system that loads objects
 > on demand, and saves them out to disk when not used using a LRU strategy.
 > 
 > The save to disk could be part of the garbage collection strategy.  Some
 > herusitic like, if we run out of memory, throw all the ojbects we've not
 > used for XXX period of time out to disk.   If there are no such objects,
 > try to increase our available memory.  If that fails, throw things out
 > from least recently used forward.  If we can't manage to satisfy the
 > request using either method, fail the memory allocation and tell the user.
 > 
 > Glancing at the current code, it seems that the hardest part of this would
 > be keeping track of object usage, without imposing excessive overhead.


This is very much what I have in mind, but more for system objects
than user objects.  At startup or when a package is attached, instead
of loading all the objects, we build a list of "promise-to-load"
objects which will load the objects when they are referenced (this is
problematic for closures though because of shared state, but there are
very few if any in the system code).  It would certainly be possible
to time-stamp objects when they are referenced and unload them at gc
time when they have not be referenced for a while.

I'm currently looking at Luke's xlispstat autoload ideas and waiting
the availability of his new garbage collector to see if there might be
better possibilities.

Step one though is to separate the save/restore mechanism from the
garbage collector so that experiments of this type get easier.

	Ross
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From abb@acm.org  Thu Apr  1 03:13:58 1999
From: abb@acm.org (abb@acm.org)
Date: Thu, 1 Apr 1999 04:13:58 +0200
Subject: Makefile fix on Solaris 2.7 (PR#155)
Message-ID: <199904010213.EAA30627@blueberry.kubism.ku.dk>

Full_Name: Andrew Barclay
Version: 0.63.4
OS: Solaris 2.7
Submission from: (NULL) (170.140.252.158)


The Makefile in src/library gets the following error from our Solaris 2.7 make
when making 'docs':
  make: Fatal error: Don't know how to make target `*/man/*.Rd'
  Current working directory R-release/src/library

It doesn't seem to appreciate shell wildcards in the dependencies.
It's been a while since I've done Makefiles, but here are my diffs 
that got it working.  Thanks for such fantastic software!

*** Makefile.original   Wed Mar 31 20:45:50 1999
--- Makefile    Wed Mar 31 20:49:56 1999
***************
*** 15,20 ****
--- 15,21 ----
  PKGS = base eda lqs modreg mva stepfun

  SUBDIRS = profile $(PKGS)
+ RDFILES = $(@echo $(srcdir)/*/man/*.Rd)

  all: Makefile R

***************
*** 37,43 ****
  latex: stamp-latex
  examples: stamp-examples

! stamp-docs: $(srcdir)/*/man/*.Rd $(top_builddir)/library/LibIndex
        @rm -f $@ stamp-help stamp-html stamp-latex stamp-examples
        @echo "Building ALL documentation (help, HTML, LaTeX, R-Examples)"
        @$(MAKE) DOCS
--- 38,44 ----
  latex: stamp-latex
  examples: stamp-examples

! stamp-docs: $(RDFILES) $(top_builddir)/library/LibIndex
        @rm -f $@ stamp-help stamp-html stamp-latex stamp-examples
        @echo "Building ALL documentation (help, HTML, LaTeX, R-Examples)"
        @$(MAKE) DOCS
***************
*** 44,64 ****
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@ stamp-help stamp-html stamp-latex stamp-examples
! stamp-help: $(srcdir)/*/man/*.Rd $(top_builddir)/library/LibIndex
        @rm -f $@
        @OPTS="--nroff" $(MAKE) DOCS
        @touch $@
! stamp-html: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--html"  $(MAKE) DOCS
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@
! stamp-latex: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--latex" $(MAKE) DOCS
        @touch $@
! stamp-examples: $(srcdir)/*/man/*.Rd
        @rm -f $@
        @OPTS="--example" $(MAKE) DOCS
        @touch $@
--- 45,65 ----
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@ stamp-help stamp-html stamp-latex stamp-examples
! stamp-help: $(RDFILES) $(top_builddir)/library/LibIndex
        @rm -f $@
        @OPTS="--nroff" $(MAKE) DOCS
        @touch $@
! stamp-html: $(RDFILES)
        @rm -f $@
        @OPTS="--html"  $(MAKE) DOCS
        @RHOME=`cd $(top_builddir); pwd`; export RHOME; \
        $${RHOME}/bin/build-help --htmllists
        @touch $@
! stamp-latex: $(RDFILES)
        @rm -f $@
        @OPTS="--latex" $(MAKE) DOCS
        @touch $@
! stamp-examples: $(RDFILES)
        @rm -f $@
        @OPTS="--example" $(MAKE) DOCS
        @touch $@


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr  1 04:55:52 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 1 Apr 1999 05:55:52 +0200
Subject: Makefile fix on Solaris 2.7 (PR#155)
Message-ID: <199904010355.FAA30649@blueberry.kubism.ku.dk>

On Thu, 1 Apr 1999 abb@acm.org wrote:

> Full_Name: Andrew Barclay
> Version: 0.63.4
> OS: Solaris 2.7
> Submission from: (NULL) (170.140.252.158)
> 
> 
> The Makefile in src/library gets the following error from our Solaris 2.7 make
> when making 'docs':
>   make: Fatal error: Don't know how to make target `*/man/*.Rd'
>   Current working directory R-release/src/library
> 
> It doesn't seem to appreciate shell wildcards in the dependencies.
> It's been a while since I've done Makefiles, but here are my diffs 
> that got it working.  Thanks for such fantastic software!

That is an unreleased version, and I guess bug.report() needs to extract a
date for snapshot versions for reports to be useful (if 0.63.4 is genuine).
  
Two comments:
  
1) This has already been changed a couple of days ago, together with the
other places which were giving problems. 0.64.0 (the next release due)
builds and checks correctly for me using Sun 5.x make. (So does the current
0.63.4 snapshot.)                                             

2) If you had read the INSTALL file you would have seen that this was
mentioned _and_ the workaround (use GNU make, not version 3.77) was given.
(The INSTALL file has been changed since to reflect 1.)

As you are into trying pre-release software, please try 0.64 (R-devel) and     
let us know if you have any problems with that.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr  1 04:51:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Thu, 1 Apr 1999 04:51:07 +0100 (BST)
Subject: Makefile fix on Solaris 2.7 (PR#155)
In-Reply-To: <199904010213.EAA30627@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904010449150.25406-100000@auk.stats>

On Thu, 1 Apr 1999 abb@acm.org wrote:

> Full_Name: Andrew Barclay
> Version: 0.63.4
> OS: Solaris 2.7
> Submission from: (NULL) (170.140.252.158)
> 
> 
> The Makefile in src/library gets the following error from our Solaris 2.7 make
> when making 'docs':
>   make: Fatal error: Don't know how to make target `*/man/*.Rd'
>   Current working directory R-release/src/library
> 
> It doesn't seem to appreciate shell wildcards in the dependencies.
> It's been a while since I've done Makefiles, but here are my diffs 
> that got it working.  Thanks for such fantastic software!

That is an unreleased version, and I guess bug.report() needs to extract a
date for snapshot versions for reports to be useful (if 0.63.4 is genuine).
  
Two comments:
  
1) This has already been changed a couple of days ago, together with the
other places which were giving problems. 0.64.0 (the next release due)
builds and checks correctly for me using Sun 5.x make. (So does the current
0.63.4 snapshot.)                                             

2) If you had read the INSTALL file you would have seen that this was
mentioned _and_ the workaround (use GNU make, not version 3.77) was given.
(The INSTALL file has been changed since to reflect 1.)

As you are into trying pre-release software, please try 0.64 (R-devel) and     
let us know if you have any problems with that.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr  1 12:15:01 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 1 Apr 1999 13:15:01 +0200 (CEST)
Subject: PLATFORMS
Message-ID: <14083.21813.762333.384682@pc87.maho.magnaeu.com>

Only three entries thus far.
Please keep them coming in.
-k

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC/FC/MAKE      gcc/egcs-g77/make

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC/FC/MAKE 	egcs/g77/make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC/FC/MAKE	gcc 2.8.1/f77 SC4.2/GNU make
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr  1 15:40:13 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 01 Apr 1999 09:40:13 -0500
Subject: dput / dget
Message-ID: <3703854D.5BE0D95B@bank-banque-canada.ca>

The dump discussion reminded me of a problem I reported early but may not have
been filed as a bug (or may not have been considered a bug):

dput seems to rely on the setting of options()$digits to determine the precision
with which things are written, and the default digits does not seem adequate
(e.g. time series attributes can get truncated enough to make them invalid). A
default for dput of digits=16 would be better.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr  1 18:09:41 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 1 Apr 1999 19:09:41 +0200 (CEST)
Subject: add-on packages
Message-ID: <14083.43093.22882.987965@pc87.maho.magnaeu.com>

It looks like we'll have a 0.64 release by next week.  This should be a
good time for bringing the add-on packages up-to-date as well.  Fixes
should include

* eliminate src-c

* provide complete DESCRIPTION, INDEX and TITLE files with consistent
formatting.  Also please be specific about the copyright/license info.

* provide data indices where applicable (last time I counted, 26 pkgs
had data but only 9 a data index).

The preferred name for the data index is now `00Index' rather than
`index.doc'.  If data files are found but no index, then data() will
give a WARNING when used for listing.

Also, there is now a subdirectory `inst' the contents of which will be
copied recursively (using `cp -r') to the root target dir upon
installation.  This may be useful in particular for copyright info etc
that should be installed along with the package.

It would be great if maintainers could rework their packages
accordingly, which should not be too much effort.  (Includes work for me
too ...)

Thanks,
-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rcreecy@Census.GOV  Thu Apr  1 21:40:48 1999
From: rcreecy@Census.GOV (Rob Creecy)
Date: Thu, 01 Apr 1999 15:40:48 -0500
Subject: GC, Disk Storage, etc
References: <Pine.LNX.4.04.9903311441410.14356-100000@localhost> <14082.42975.280157.296729@g.ihaka.slip.auckland.ac.nz>
Message-ID: <3703D9D0.516FBAE3@census.gov>

Something to keep in mind when designing future memory management
 schemes is that in the not too distant future many machines will
 be 64 bits and have more than 2GB of memory, and it would be nice to be
able
 to fully utilize the available memory. I discovered what seems to be a
current
 limit of 2GB for vector heap size on a DEC ALPHA UNIX 4.0, which fails
 in memory.c doing the malloc for the vector heap when the request is
greater
 than 2GB. I presume this is because address pointers are 32 bits.
 This situation is unfortunate since the machine has 12GB of memory and
I had
 a problem which could have used more than 2GB of memory. I wrote a
FORTRAN
 program instead (which may have been better in the long run anyway)

 I don't have any ideas on how to address this problem, but thought I'd
 raise the issue for your consideration.

Rob 

Ross Ihaka wrote:
> 
> Gregory R. Warnes writes:
>  >
>  > I'm wondering what the plans are for the memory management system.
>  >
>  > Once there is a dynamic memory allocation system in place it would be nice
>  > to augment that so that objects which are not currently being used need
>  > not be resident in memory.  This way, rarely used objects will not be
>  > filling up the memory of the R process.
>  >
>  > (Yes, I am thinking about a cross between the current R and S object
>  > storage ideas.)
>  >
>  > It should be possible to set up an object access system that loads objects
>  > on demand, and saves them out to disk when not used using a LRU strategy.
>  >
>  > The save to disk could be part of the garbage collection strategy.  Some
>  > herusitic like, if we run out of memory, throw all the ojbects we've not
>  > used for XXX period of time out to disk.   If there are no such objects,
>  > try to increase our available memory.  If that fails, throw things out
>  > from least recently used forward.  If we can't manage to satisfy the
>  > request using either method, fail the memory allocation and tell the user.
>  >
>  > Glancing at the current code, it seems that the hardest part of this would
>  > be keeping track of object usage, without imposing excessive overhead.
> 
> This is very much what I have in mind, but more for system objects
> than user objects.  At startup or when a package is attached, instead
> of loading all the objects, we build a list of "promise-to-load"
> objects which will load the objects when they are referenced (this is
> problematic for closures though because of shared state, but there are
> very few if any in the system code).  It would certainly be possible
> to time-stamp objects when they are referenced and unload them at gc
> time when they have not be referenced for a while.
> 
> I'm currently looking at Luke's xlispstat autoload ideas and waiting
> the availability of his new garbage collector to see if there might be
> better possibilities.
> 
> Step one though is to separate the save/restore mechanism from the
> garbage collector so that experiments of this type get easier.
> 
>         Ross
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr  1 23:44:01 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 01 Apr 1999 16:44:01 -0600
Subject: .External interface
Message-ID: <6r90cc0xn2.fsf@verdi.stat.wisc.edu>

There was some mention at the Vienna conference of documenting the
.External interface so the brave could write C code that directly
dealt with SEXP's.  I recently submitted to CRAN/src/contrib/Devel an
add-on to do nonlinear least squares.  That is set up so most of the
work occurs in an nlsModel object which is a list of functions and
their enclosing environment.  Those who think in terms of
object-oriented languages like Java can imagine it to be an instance
of a class.

We would like to write the code that controls the iterations in C -
partially so that implementing things like an algorithm for partially
linear models would be easier.  I need to know how to pass an object
(a list) into a C routine and access the elements, how to force the
evaluation of a function with no arguments, and how to force the
evaluation of a function with a single argument that is a numeric
object.  I presume that I must protect the list that I am passing down
to C so the pointer to that object remains valid after a garbage
collection that may occur during this function evaluation.

I know everyone is busy but a few hints or vague references to look at
the code for ... would help.  Thomas? Robert?
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Fri Apr  2 00:30:45 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Thu, 1 Apr 1999 17:30:45 -0600 (CST)
Subject: .External == .Internal ?
Message-ID: <m10Sqv7-0000X9C@verdi.stat.wisc.edu>

I mentioned the .External interface in my last message.  When I heard
the name, it may have been a joke but I didn't realize that.

Looking through the source code it seems that there are only calls to
.Internal.  I had thought perhaps that .External was a version of
.Internal that could be used with dynamically loaded code.

Am I talking about something that doesn't exist yet and is just in the
planning stages?  (I've got to start paying closer attention in the
R-core meetings.)
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Fri Apr  2 02:03:38 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 1 Apr 1999 17:03:38 -0800 (PST)
Subject: .External == .Internal ?
In-Reply-To: <m10Sqv7-0000X9C@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.10.9904011701530.23400-100000@wompom.biostat.washington.edu>

On Thu, 1 Apr 1999, Douglas Bates wrote:

> I mentioned the .External interface in my last message.  When I heard
> the name, it may have been a joke but I didn't realize that.
> 
> Looking through the source code it seems that there are only calls to
> .Internal.  I had thought perhaps that .External was a version of
> .Internal that could be used with dynamically loaded code.
> 
> Am I talking about something that doesn't exist yet and is just in the
> planning stages?  (I've got to start paying closer attention in the
> R-core meetings.)


No, it's there in R0.64, it just hasn't been used for anything yet.  The
code was sent in to R-devel a few months ago and I added it a few weeks
ago.

The idea is exactly to be able to call dynamically loaded routines in a
similar way to .Internal.

	-thomas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  2 05:35:30 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 2 Apr 1999 16:35:30 +1200 (NZST)
Subject: X11 Device Driver
Message-ID: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>

I have made some modifications to the X11 graphics driver so that it is
more flexible about its use of colors.  I have added a new parameter to
the X11/x11 function which controls this.  The parameter is currently
called "colormodel" and works as follows:

	colormodel = 0		Monochrome graphics
	colormodel = 1		Grayscale (256 shades)
	colormodel = 2		Pseudocolor1
	colormodel = 3		Pseudocolor2
	colormodel = 4		Truecolor

Pseudocolor1 allocates as big a color cube as possible and then
approximates requested colors with colors from the cube.

Pseudocolor2 allocates colors "on-demand" until it runs out of
colors.  You then get a "can't allocate colors" error message.

More sophisticated devices will support the color models of less
sophisticated devices.  E.g. you can do grey-scale and pseudocolor
on a truecolor device.

So, one question is:  How should this functionality be packaged?

One possibility is to have multiple X11 device driver entry points

    X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color

This would be useful because people could use options() to set
the appropriate default device.

Another possibility would be to have use an additional argument to
the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

Perhaps there are better ideas also.

A second question is what should the default behavior be on Pseudocolor
devices; Pseudocolor1 or Pseudocolor2?

Would anyone care to express an opinion.  I'd like to get this commited
for the 0.64 release.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  2 06:38:09 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 2 Apr 1999 06:38:09 +0100 (BST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.05.9904020632260.28106-100000@auk.stats>

On Fri, 2 Apr 1999, Ross Ihaka wrote:

> I have made some modifications to the X11 graphics driver so that it is
> more flexible about its use of colors.  I have added a new parameter to
> the X11/x11 function which controls this.  The parameter is currently
> called "colormodel" and works as follows:
> 
> 	colormodel = 0		Monochrome graphics
> 	colormodel = 1		Grayscale (256 shades)
> 	colormodel = 2		Pseudocolor1
> 	colormodel = 3		Pseudocolor2
> 	colormodel = 4		Truecolor
> 
> Pseudocolor1 allocates as big a color cube as possible and then
> approximates requested colors with colors from the cube.
> 
> Pseudocolor2 allocates colors "on-demand" until it runs out of
> colors.  You then get a "can't allocate colors" error message.
> 
> More sophisticated devices will support the color models of less
> sophisticated devices.  E.g. you can do grey-scale and pseudocolor
> on a truecolor device.
> 
> So, one question is:  How should this functionality be packaged?
> 
> One possibility is to have multiple X11 device driver entry points
> 
>     X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color
> 
> This would be useful because people could use options() to set
> the appropriate default device.
> 
> Another possibility would be to have use an additional argument to
> the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

I would prefer a single driver, with (effectively)

X11(display = "", width = 7, height = 7, pointsize = 12, 
    colortype=options()$X11colortype)

and choosing type from "mono", "gray", "pseudo.cube", "pseudo", "true"
as appropriate.

> A second question is what should the default behavior be on Pseudocolor
> devices; Pseudocolor1 or Pseudocolor2?

Pseudocolor2, please.  I very rarely have a problem (but then I have
netscape and gs under control).

> Would anyone care to express an opinion.  I'd like to get this commited
> for the 0.64 release.

Yes, please.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  2 07:42:55 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 2 Apr 1999 08:42:55 +0200 (CEST)
Subject: PLATFORMS Update
Message-ID: <14084.26351.552385.308376@pc87.maho.magnaeu.com>

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC/FC/MAKE 	egcs/g77/make

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC/FC/MAKE      gcc/egcs-g77/make

NAME		Göran Broström
EMAIL		gb@stat.umu.se
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.2
CC/FC/MAKE      gcc/egcs-g77/make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 5.3 / 6.0
CC/FC/MAKE      egcs/g77/make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC/FC/MAKE      gcc/egcs-g77/make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        alpha-dec-osf4.0
SYSTEM          Digital Unix 4.0E
CC/FC/MAKE      cc/f77/GNUmake

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      cc SC4.2/f77 SC4.2/GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      egcs 1.1 gcc/f77 GNU make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC/FC/MAKE	gcc 2.8.1/f77 SC4.2/GNU make

NAME       	Göran Broström
EMAIL      	gb@stat.umu.se
VERSION    	0.63.3
PLATFORM   	sun-sparc-linux
SYSTEM     	Redhat 5.2
CC/FC/MAKE 	egcs/egcs-g77/make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/(Sun)make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/GNU make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.64
PLATFORM        hppa2.0
SYSTEM          hpux10.20
CC/FC/MAKE      egcs/f2c/(gnu)make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      gcc 2.8.1/f77 SC4.2/Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      cc SC4.2/f77 SC4.2/Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC/FC/MAKE      egcs 1.1 gcc/egcs 1.1 f77/GNU make
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Fri Apr  2 08:05:47 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Fri, 2 Apr 1999 09:05:47 +0200 (CEST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
References: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <14084.27723.882357.562231@galadriel.ci.tuwien.ac.at>

>>>>> On Fri, 2 Apr 1999 16:35:30 +1200 (NZST),
>>>>> Ross Ihaka (RI) wrote:

RI> I have made some modifications to the X11 graphics driver so that it is
RI> more flexible about its use of colors.  I have added a new parameter to
RI> the X11/x11 function which controls this.  The parameter is currently
RI> called "colormodel" and works as follows:

RI> 	colormodel = 0		Monochrome graphics
RI> 	colormodel = 1		Grayscale (256 shades)
RI> 	colormodel = 2		Pseudocolor1
RI> 	colormodel = 3		Pseudocolor2
RI> 	colormodel = 4		Truecolor

RI> Pseudocolor1 allocates as big a color cube as possible and then
RI> approximates requested colors with colors from the cube.

don't know if that's possible, but how hard would it be to optionally
limit the size of the cube? I have something in mind like only
allowing 64 colors or whatever to be able to start other applications
(and leaving them some room in the colormap) after R has started.

Netscape.maxImageColors worked always fine for me ...


.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  2 08:27:56 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 2 Apr 1999 19:27:56 +1200 (NZST)
Subject: X11 Device Driver
In-Reply-To: <14084.27723.882357.562231@galadriel.ci.tuwien.ac.at>
Message-ID: <Pine.BSF.3.96.990402192506.6514A-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 2 Apr 1999, Friedrich Leisch wrote:

> RI> Pseudocolor1 allocates as big a color cube as possible and then
> don't know if that's possible, but how hard would it be to optionally
> limit the size of the cube? I have something in mind like only
> allowing 64 colors or whatever to be able to start other applications
> (and leaving them some room in the colormap) after R has started.
> 
> Netscape.maxImageColors worked always fine for me ...

It'll be easy enough to add a maxcolors= argument, with a
default of 256.

Any other requests from anyone while I'm at it?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Fri Apr  2 10:16:27 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Fri, 2 Apr 1999 11:16:27 +0200 (CEST)
Subject: legends of barplots
Message-ID: <14084.35563.482242.1349@galadriel.ci.tuwien.ac.at>



is there a hidden reason why the legend in barplot is in reverse order
(i.e. from bottom to top?). if nobody cares I would change it to the
usual top to bottom.

and while I'm at it: wouldn't it be more natural if in a horizontal
barplot things are also sorted from top to bottom?

.f

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  2 12:14:46 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 02 Apr 1999 13:14:46 +0200
Subject: PLATFORMS Update
In-Reply-To: Kurt Hornik's message of "Fri, 2 Apr 1999 08:42:55 +0200 (CEST)"
References: <14084.26351.552385.308376@pc87.maho.magnaeu.com>
Message-ID: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>

Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

> 
> NAME       	Göran Broström
> EMAIL      	gb@stat.umu.se
> VERSION    	0.63.3
> PLATFORM   	sun-sparc-linux
> SYSTEM     	Redhat 5.2
> CC/FC/MAKE 	egcs/egcs-g77/make
                ^^^^
Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  2 12:37:22 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 2 Apr 1999 12:37:22 +0100 (BST)
Subject: PLATFORMS Update
In-Reply-To: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>

On 2 Apr 1999, Peter Dalgaard BSA wrote:

> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> 
> > 
> > NAME       	Göran Broström
> > EMAIL      	gb@stat.umu.se
> > VERSION    	0.63.3
> > PLATFORM   	sun-sparc-linux
> > SYSTEM     	Redhat 5.2
> > CC/FC/MAKE 	egcs/egcs-g77/make
>                 ^^^^
> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

Note: sun-sparc, and Peter once told me that has nothing to do
with the compiler on Intel.

This makes me say what I thought of earlier: would be it be a good
idea for Kurt to ask those people who used gcc/egcs to give us a
version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
not install by default) so it would be very easy to have a grabbed
a later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version
in use here).


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  2 13:00:53 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 2 Apr 1999 14:00:53 +0200 (CEST)
Subject: PLATFORMS Update
In-Reply-To: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
References: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
 <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
Message-ID: <14084.45429.23176.961539@pc87.maho.magnaeu.com>

>>>>> Prof Brian D Ripley writes:

> On 2 Apr 1999, Peter Dalgaard BSA wrote:
>> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
>> 
>> > 
>> > NAME       	Göran Broström
>> > EMAIL      	gb@stat.umu.se
>> > VERSION    	0.63.3
>> > PLATFORM   	sun-sparc-linux
>> > SYSTEM     	Redhat 5.2
>> > CC/FC/MAKE 	egcs/egcs-g77/make
>> ^^^^
>> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
>> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?

> Note: sun-sparc, and Peter once told me that has nothing to do
> with the compiler on Intel.

> This makes me say what I thought of earlier: would be it be a good
> idea for Kurt to ask those people who used gcc/egcs to give us a
> version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
> not install by default) so it would be very easy to have a grabbed a
> later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version in
> use here).

Yes it would be a good idea.

Ideally we should have something like

	CC	gcc 2.7.2.3
	FC	egcs-2.90.29 980515 (egcs-1.0.3 release)
	MAKE	GNU make 3.76.1

which would be my current setup.

Brian suggested this morning to redo PLATFORMS as follows:  first an
intro part like

0.63.3:
  Linux:
    i386	Debian 1.3, 2.0, Red Hat 4.0, 5.0, 5.2, SuSe 6.0
    ppc		LinuxPPC 4
    alpha	xxx
  FreeBSD 2.2.5
  SGI Irix 6.2
  Sun Solaris (Sparc) 2.5.1, 2.6, 2.7
  DEC Alpha (OSF4)

and then simply append the new-style database for detailed info.

Maybe I should then split CC/FC/MAKE as above.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  2 15:40:51 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 02 Apr 1999 16:40:51 +0200
Subject: PLATFORMS Update
In-Reply-To: Prof Brian D Ripley's message of "Fri, 2 Apr 1999 12:37:22 +0100 (BST)"
References: <Pine.GSO.4.05.9904021229070.1257-100000@auk.stats>
Message-ID: <x21zi313ws.fsf@blueberry.kubism.ku.dk>

Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

> On 2 Apr 1999, Peter Dalgaard BSA wrote:
> 
> > Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> > 
> > > 
> > > NAME       	Göran Broström
> > > EMAIL      	gb@stat.umu.se
> > > VERSION    	0.63.3
> > > PLATFORM   	sun-sparc-linux
> > > SYSTEM     	Redhat 5.2
> > > CC/FC/MAKE 	egcs/egcs-g77/make
> >                 ^^^^
> > Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> > 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?
> 
> Note: sun-sparc, and Peter once told me that has nothing to do
> with the compiler on Intel.

Argh. Saw RedHat, implied Intel... Sorry. 

Yes, the bug is very system-dependent -- doesn't even affect the
windows-i386 egcs compiler (not in that spot anyway) since it doesn't
inline the same routines.

> This makes me say what I thought of earlier: would be it be a good
> idea for Kurt to ask those people who used gcc/egcs to give us a
> version number?  AFAIK egcs is an addon for RH5.2 (ships with, does
> not install by default) so it would be very easy to have a grabbed
> a later rpm for egcs/ecgs-g77 (which are not even on the 1-CD version
> in use here).

Agreed. Optimization levels too?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From gb@stat.umu.se  Fri Apr  2 15:39:37 1999
From: gb@stat.umu.se (Goran Brostrom)
Date: Fri, 2 Apr 1999 16:39:37 +0200 (CEST)
Subject: PLATFORMS Update
In-Reply-To: <x2ogl7z32x.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.LNX.4.10.9904021633230.4028-100000@capa.stat.umu.se>

On 2 Apr 1999, Peter Dalgaard BSA wrote:

> Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:
> 
> > 
> > NAME       	Göran Broström
> > EMAIL      	gb@stat.umu.se
> > VERSION    	0.63.3
> > PLATFORM   	sun-sparc-linux
> > SYSTEM     	Redhat 5.2
> > CC/FC/MAKE 	egcs/egcs-g77/make
>                 ^^^^
> Oops. I thought that one was a "known bad" for egcs<1.1 (RH5.2 ships
> 1.0.3a). Crashes in qbeta.c, IIRC. Will it complete "make check"?
> 

1. It seems as if the redhat 5.2 sparc only has egcs. Because
   a) /usr/bin/egcs and /usr/bin/gcc are identical.
   b) gcc -v:
Reading specs from /usr/lib/gcc-lib/sparc-redhat-linux/egcs-2.90.29/specs
gcc version egcs-2.90.29 980515 (egcs-1.0.3 release)

   This is different from the i386 version, where:
[gb@localhost gb]$ gcc -v
Reading specs from /usr/lib/gcc-lib/i386-redhat-linux/2.7.2.3/specs
gcc version 2.7.2.3
[gb@localhost gb]$ diff /usr/bin/egcs /usr/bin/gcc
Binary files /usr/bin/egcs and /usr/bin/gcc differ

2. It completes "make check".

Göran
--------------------------------------------------------------
 Göran Broström
 Department of Statistics              tel: +46 90 786-5223
 Umeå University                       fax: +46 90 786-6614
 S-90187 Umeå, Sweden               e-mail:  gb@stat.umu.se

 http://www.stat.umu.se/~gb          ftp://capa.stat.umu.se
--------------------------------------------------------------

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Fri Apr  2 18:07:32 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 2 Apr 1999 09:07:32 -0800 (PST)
Subject: X11 Device Driver
In-Reply-To: <Pine.BSF.3.96.990402161719.3510B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.10.9904020905040.27714-100000@wompom.biostat.washington.edu>

On Fri, 2 Apr 1999, Ross Ihaka wrote:

> 
> So, one question is:  How should this functionality be packaged?
>\ 
> One possibility is to have multiple X11 device driver entry points
> 
>     X11.mono, X11.gray, X11.pseudo1, X11.pseudo2, X11.color
> 
> This would be useful because people could use options() to set
> the appropriate default device.
> 
> Another possibility would be to have use an additional argument to
> the driver and to make it rather more meaningful than 0, 1, 2, 3, 4.

I'd prefer this one 


> Perhaps there are better ideas also.
> 
> A second question is what should the default behavior be on Pseudocolor
> devices; Pseudocolor1 or Pseudocolor2?

I would go for allocating colors on demand, especially if we can print out
a message suggesting the color cube driver when colors run out.

	-thomas


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jean@stat.ubc.ca  Fri Apr  2 22:58:54 1999
From: jean@stat.ubc.ca (Jean Meloche)
Date: Fri, 02 Apr 1999 21:58:54 +0000
Subject: patch against overflows in saveload.c
Message-ID: <37053D9E.BC882FC8@stat.ubc.ca>

This is a multi-part message in MIME format.
--------------3F9F11E6B00532CFDD5A424A
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

R fails to save long strings... (with xdr)

> str<-''; for(i in c(0:1000)) str<-paste(str,'a')
> q(save='yes')
Error: a write error occured
>

This was noticed a while ago and someone
suggested a large fixed sized buffer.

The attached patch allocates a buffer as needed
using malloc. I know R has ist own allocation
mechanism but I figured malloc was ok for
such short-lived buffers.

If not, please let me know how to do it properly.

--
Jean Meloche
--------------3F9F11E6B00532CFDD5A424A
Content-Type: text/plain; charset=us-ascii;
 name="sl.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="sl.diff"

--- saveload.c	Tue Feb 16 09:15:59 1999
+++ /usr/local/R-0.63.3/src/main/saveload.c	Fri Apr  2 13:25:42 1999
@@ -1,7 +1,6 @@
 /*
  *  R : A Computer Language for Statistical Data Analysis
  *  Copyright (C) 1995, 1996  Robert Gentleman and Ross Ihaka
- *  Copyright (C) 1997--1999  Robert Gentleman, Ross Ihaka and the R Core Team
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -61,7 +60,7 @@
 static int	(*InInteger)(FILE*);
 static double	(*InReal)(FILE*);
 static complex	(*InComplex)(FILE*);
-static char*	(*InString)(FILE*);
+static char*	(*InString)(FILE*,int,char *);
 static void	(*InTerm)(FILE*);
 
 
@@ -195,7 +194,7 @@
     fputc('\"', fp);
 }
 
-static char *AsciiInString(FILE *fp)
+static char *AsciiInString(FILE *fp, int len, char *buf)
 {
     int c;
     bufp = buf;
@@ -346,16 +345,17 @@
 
 static void XdrOutString(FILE *fp, char *s)
 {
-    if (!xdr_string(&xdrs, &s, MAXELTSIZE - 1)) {
+    if (!xdr_string(&xdrs, &s, strlen(s))) {
 	xdr_destroy(&xdrs);
 	error("a write error occured\n");
     }
 }
 
-static char *XdrInString(FILE *fp)
+static char *XdrInString(FILE *fp, int len, char *buf)
 {
-    char *bufp = buf;
-    if (!xdr_string(&xdrs, &bufp, MAXELTSIZE - 1)) {
+    char *bufp;
+    bufp=buf;
+    if (!xdr_string(&xdrs, &bufp, len)) {
 	xdr_destroy(&xdrs);
 	error("a read error occured\n");
     }
@@ -439,7 +439,7 @@
 	error("a write error occured\n");
 }
 
-static char *BinaryInString(FILE *fp)
+static char *BinaryInString(FILE *fp, int len, char *buf)
 {
     bufp = buf;
     do {
@@ -705,6 +705,8 @@
 		OutSpace(fp);
 		OutInteger(fp, NodeToOffset(&R_NHeap[i]));
 		OutSpace(fp);
+		OutInteger(fp, strlen(CHAR(PRINTNAME(&R_NHeap[i]))));
+		OutSpace(fp);
 		OutString(fp, CHAR(PRINTNAME(&R_NHeap[i])));
 		OutNewline(fp);
 		k++;
@@ -737,7 +739,6 @@
     for (i = 0; i < R_NSize; i++) {
 	if (MARK(&R_NHeap[i])) {
 	    if (TYPEOF(&R_NHeap[i]) != SYMSXP) {
-
 		OutInteger(fp, n);
 		OutSpace(fp);
 		OutInteger(fp, TYPEOF(&R_NHeap[i]));
@@ -845,6 +846,7 @@
 {
     unsigned int j;
     int len;
+    char *buf;
 
     TYPEOF(s) = InInteger(fp);
 
@@ -887,12 +889,16 @@
     case SPECIALSXP:
     case BUILTINSXP:
 	len = InInteger(fp);
-	PRIMOFFSET(s) = StrToInternal(InString(fp));
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	PRIMOFFSET(s) = StrToInternal(InString(fp, len, buf));
+	free(buf);
 	break;
     case CHARSXP:
 	LENGTH(s) = len = InInteger(fp);
 	ReallocString(s, len);
-	strcpy(CHAR(s), InString(fp));
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	strcpy(CHAR(s), InString(fp, len, buf));
+	free(buf);
 	break;
     case REALSXP:
 	LENGTH(s) = len = InInteger(fp);
@@ -956,9 +962,14 @@
     /* computing the forwarding addresses */
 
     for (i = 0 ; i < NSymbol ; i++) {
+	char *buf;
+	int len;
 	j = InInteger(fp);
 	OldOffset[j] = InInteger(fp);
-	NewAddress[j] = install(InString(fp));
+	len = InInteger(fp);
+	if((buf=malloc(len+1))==NULL) error("not enough memory to restore data\n");
+	NewAddress[j] = install(InString(fp,len,buf));
+	free(buf);
     }
 
     /* symbols are all installed */
@@ -1074,7 +1085,7 @@
 	TAG(t) = install(CHAR(STRING(CAR(args))[j]));
 	CAR(t) = findVar(TAG(t), R_GlobalContext->sysparent);
 	if (CAR(t) == R_UnboundValue)
-            error("Object \"%s\" not found\n", CHAR(PRINTNAME(TAG(t))));
+	    error("Object \"%s\" not found\n", CHAR(PRINTNAME(TAG(t))));
     }
 
     R_SaveToFile(s, fp, INTEGER(CADDR(args))[0]);
@@ -1811,12 +1822,12 @@
 do_hdf5save (SEXP call, SEXP op, SEXP args, SEXP env)
 {
     errorcall(call, "HDF5 support unavailable\n");
-    return(R_NilValue);		/* -Wall */
+    return(R_NilValue);         /* -Wall */
 }
 SEXP
 do_hdf5load (SEXP call, SEXP op, SEXP args, SEXP env)
 {
     errorcall(call, "HDF5 support unavailable\n");
-    return(R_NilValue);		/* -Wall */    
+    return(R_NilValue);         /* -Wall */
 }
 #endif

--------------3F9F11E6B00532CFDD5A424A--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jean@stat.ubc.ca  Fri Apr  2 23:01:21 1999
From: jean@stat.ubc.ca (Jean Meloche)
Date: Fri, 02 Apr 1999 22:01:21 +0000
Subject: R patch for strsplit
Message-ID: <37053E31.DC51F380@stat.ubc.ca>

This is a multi-part message in MIME format.
--------------031DBBD5368F0FEAFF79DE0C
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

R core dumps when strsplit-ing long strings:

> str<-''; for(i in c(0:1000)) str<-paste(str,'a')
> strsplit(str,' ')
Bus Error (core dumped)

The attached patch fixes the problem in strsplit
by mallocating a short lived buffer of the right
size.

-- 
Jean Meloche
--------------031DBBD5368F0FEAFF79DE0C
Content-Type: text/plain; charset=us-ascii;
 name="ch.diff"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="ch.diff"

--- character.c	Sun Feb 21 23:59:40 1999
+++ /usr/local/R-0.63.3/src/main/character.c	Fri Apr  2 13:24:03 1999
@@ -107,7 +107,7 @@
 {
     SEXP s, t, tok, x;
     int i, j, len, tlen, ntok;
-    char buff[MAXELTSIZE], *pt, *split = "";
+    char *buff, *pt, *split = "";
 
     checkArity(op, args);
     x = CAR(args);
@@ -119,6 +119,7 @@
     PROTECT(s = allocVector(VECSXP, len));
     for (i = 0; i < len; i++) {
 	/* find out how many splits there will be */
+	buff=malloc(strlen(CHAR(STRING(x)[i]))+1);
 	strcpy(buff, CHAR(STRING(x)[i]));
 	if (tlen > 0) {
 	    split = CHAR(STRING(tok)[i % tlen]);
@@ -150,6 +151,7 @@
 	}
 	UNPROTECT(1);
 	VECTOR(s)[i] = t;
+	free(buff);
     }
     UNPROTECT(1);
     return s;

--------------031DBBD5368F0FEAFF79DE0C--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sat Apr  3 09:38:00 1999
From: wvenable@arcola.stats.adelaide.edu.au (wvenable@arcola.stats.adelaide.edu.au)
Date: Sat, 3 Apr 1999 10:38:00 +0200
Subject: tabulate causes segmentation fault (PR#156)
Message-ID: <199904030838.KAA31481@blueberry.kubism.ku.dk>

Peter,

I thought this one was noted and fixed, but I could be wrong.

    R : Copyright 1999, The R Development Core Team
    Version 0.63.3  (March 6, 1999)
    
    ....
    
    [Previously saved workspace restored]
    
    > tabulate(1:10, 5)
    
    Process R:1 segmentation fault at Sat Apr  3 17:48:34 1999

-- 
(The following contact details become official on 1 May 1999, but
the email address works now and may be used from now on.)
-----------------------------------------------------------------
Bill Venables, Statistician, CMIS Environmetrics Project.

Physical address:                            Postal address:
CSIRO Marine Laboratories,                   PO Box 120,       
233 Middle St, Cleveland, Queensland         Cleveland, Qld, 4163
AUSTRALIA                                    AUSTRALIA

Telephone: +61 7 3826 7200     Email: Bill.Venables@cmis.csiro.au     
      Fax: +61 7 3826 7304

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr  3 10:34:08 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 03 Apr 1999 11:34:08 +0200
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: wvenable@arcola.stats.adelaide.edu.au's message of "Sat, 3 Apr 1999 10:38:00 +0200"
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
Message-ID: <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>

wvenable@arcola.stats.adelaide.edu.au writes:

> Peter,
> 
> I thought this one was noted and fixed, but I could be wrong.
> 
>     R : Copyright 1999, The R Development Core Team
>     Version 0.63.3  (March 6, 1999)
>     
>     ....
>     
>     [Previously saved workspace restored]
>     
>     > tabulate(1:10, 5)
>     
>     Process R:1 segmentation fault at Sat Apr  3 17:48:34 1999

It wasn't...

However, all it needs is a bit of defensive programming. But should it

(a) Protest if any(bin)>nbins
or 
(b) Quietly set bin[bin>nbins] <- 0  # or NA, no matter

(one could also start the routine with bin<-bin[bin<=nbin])

I think (b) since that is consistent with the way values <= 0 are
currently handled.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sun Apr  4 01:11:39 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Sun, 4 Apr 1999 09:41:39 +0930 (CST)
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
 <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
Message-ID: <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>

>>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    Peter> wvenable@arcola.stats.adelaide.edu.au writes:

    >> R : Copyright 1999, The R Development Core Team Version
    >> 0.63.3 (March 6, 1999)
    >> 
    >> ....
    >> 
    >> [Previously saved workspace restored]
    >> 
    >> > tabulate(1:10, 5)
    >> 
    >> Process R:1 segmentation fault at Sat Apr 3 17:48:34 1999

    Peter> It wasn't...

    Peter> However, all it needs is a bit of defensive
    Peter> programming.

Yes, Peter, but by whom?  My point was that this kind of massive
bear trap was not something that should be the users' sole
responsibility to avoid.  Having a simple exception capable of
killing the session and losing all data is perhaps OK for
MicroSoft, but it should not be OK for us.  I believe the flaw is
still present in the nascent 0.64, which bothers me.

I think it should be solved at the C level since tabulate() is
one of those things that you want to be ultra-slick, but if this
is not possible right now, perhaps we will have to put up with a
stop-gap measure.  For example you could change it in 0.64 to

tabulate <- function (bin, nbins = max(bin)) {  
    if (!is.numeric(bin) && !is.factor(bin)) 
        stop("tabulate: bin must be numeric or a factor")

    nbins <- max(0, nbins) 
    if(!missing(nbins) && !all(OK <- (bin <= nbins))) 
	bin <- bin[OK]
    n <- length(bin)
    storage.mode(bin) <- "integer"

    .C("tabulate", bin, n, ans = integer(nbins))$ans
}

> tabulate(1:10, 5)
[1] 1 1 1 1 1
> tabulate(1:10 + 0.1, 5)
[1] 1 1 1 1 0
> tabulate(1:10, 0)
numeric(0)
> tabulate(sample(1:10, 50000, rep=T))
 [1] 5016 5048 4996 5020 4914 5089 5059 4885 4998 4975
> 

I think any degradation in performance over the present version
would be mostly negligible and the whole thing would be much safer.
Users who need ultra-slickness still have the option of using he
C code directly - that is the wonderful benefit of open code.

Bill
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Sun Apr  4 07:11:49 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Sun, 4 Apr 1999 15:41:49 +0930 (CST)
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>
References: <199904030838.KAA31481@blueberry.kubism.ku.dk>
 <x2hfqydp4f.fsf@blueberry.kubism.ku.dk>
 <14086.44603.723137.13426@arcola.stats.adelaide.edu.au>
Message-ID: <14087.677.890232.822546@arcola.stats.adelaide.edu.au>

OK, I have a few noodles around my ears...  

The fix I gave for tabulate can cause problems with factors (and
breaks truehist in the MASS library!).  Here is a further
refinement, which is now getting a little messy, I do admit, but
I'm pretty sure this covers it.  (At least truehist works...)

--(begin tabulate.R)--
tabulate <- function (bin, nbins = max(bin)) {
    if (!is.numeric(bin) && !is.factor(bin)) 
        stop("tabulate: bin must be numeric or a factor")
    nbins <- max(0, nbins)

    if (!missing(nbins)) {
      if (is.factor(bin))
        bin <- unclass(bin)
      if (!all(OK <- (bin <= nbins)))
        bin <- bin[OK]
    }

    n <- length(bin)
    storage.mode(bin) <- "integer"
    .C("tabulate", bin, n, ans = integer(nbins))$ans
}
--(end tabulate.R)--
Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr  4 08:04:17 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Sun, 4 Apr 1999 09:04:17 +0200
Subject: tabulate causes segmentation fault (PR#156)
Message-ID: <199904040704.JAA31993@blueberry.kubism.ku.dk>

On Sun, 4 Apr 1999, Bill Venables wrote:

> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
> 
>     Peter> wvenable@arcola.stats.adelaide.edu.au writes:
> 
>     >> R : Copyright 1999, The R Development Core Team Version
>     >> 0.63.3 (March 6, 1999)
>     >> 
>     >> ....
>     >> 
>     >> [Previously saved workspace restored]
>     >> 
>     >> > tabulate(1:10, 5)
>     >> 
>     >> Process R:1 segmentation fault at Sat Apr 3 17:48:34 1999
> 
>     Peter> It wasn't...
> 
>     Peter> However, all it needs is a bit of defensive
>     Peter> programming.
> 
> Yes, Peter, but by whom?  My point was that this kind of massive
> bear trap was not something that should be the users' sole
> responsibility to avoid.  Having a simple exception capable of
> killing the session and losing all data is perhaps OK for
> MicroSoft, but it should not be OK for us.  I believe the flaw is
> still present in the nascent 0.64, which bothers me.
> 
> I think it should be solved at the C level since tabulate() is
> one of those things that you want to be ultra-slick, but if this
> is not possible right now, perhaps we will have to put up with a

I have put a change in at the C level _and_ altered the help page to
document what tabulate does and what its arguments are. I think the 
defensive programming should be at the C level, for users can call the 
entry point.

The code is now much cleaner (I think):

tabulate <- function(bin, nbins = max(1,bin))
{
    if(!is.numeric(bin) && !is.factor(bin))
	stop("tabulate: bin must be numeric or a factor")
    .C("tabulate",
       as.integer(bin),
       as.integer(length(bin)),
       as.integer(nbins),
       ans = integer(nbins))$ans
}

As tabulate() silently ignored negative integers, I thought it could
silently ignore ones beyond nbins too, especially as I have documented
this.

I reckon the answer for

> tabulate(numeric(0))
[1] 0

is wrong (I would have had a zero-length vector) but have left it for
compatibility.

> stop-gap measure.  For example you could change it in 0.64 to
> 
> tabulate <- function (bin, nbins = max(bin)) {  
>     if (!is.numeric(bin) && !is.factor(bin)) 
>         stop("tabulate: bin must be numeric or a factor")
> 
>     nbins <- max(0, nbins) 
>     if(!missing(nbins) && !all(OK <- (bin <= nbins))) 
> 	bin <- bin[OK]
>     n <- length(bin)
>     storage.mode(bin) <- "integer"
> 
>     .C("tabulate", bin, n, ans = integer(nbins))$ans
> }

Um. although not previously documented, tabulate is used with factors (as
in S).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr  4 11:15:56 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 04 Apr 1999 12:15:56 +0200
Subject: tabulate causes segmentation fault (PR#156)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Sun, 4 Apr 1999 09:04:17 +0200"
References: <199904040704.JAA31993@blueberry.kubism.ku.dk>
Message-ID: <x2bth43d43.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> The code is now much cleaner (I think):
> 
> tabulate <- function(bin, nbins = max(1,bin))
> {
>     if(!is.numeric(bin) && !is.factor(bin))
> 	stop("tabulate: bin must be numeric or a factor")
>     .C("tabulate",
>        as.integer(bin),
>        as.integer(length(bin)),
>        as.integer(nbins),
>        ans = integer(nbins))$ans
> }

.. except that it relies on the following phenomenon:
> max(factor(0:3))
Error: "max" not meaningful for factors
> max(1,factor(0:3))
[1] 4

BTW: Why are we testing for x[i] != R_NaInt in tabulate.c, when 

> tabulate(c(1:3,NA),3)
Error: NAs in foreign function call (arg 1)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr  4 18:04:53 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 4 Apr 1999 18:04:53 +0100 (BST)
Subject: "integer" mod ein .C/.Fortran call
Message-ID: <Pine.GSO.4.05.9904041755330.12670-100000@auk.stats>

I have just discovered that mode integer in C maps to int in C and integer
in Fortran, whereas it maps to long in C loaded in to S.  This seems
undocumented in R, and the base R code is not consistent in its usage, let
alone user packages.

Can those of you who have long != int tell us what your machines use, and
also if Fortran integer is equal to C int (which is assumed in a lot
of places).

I believe that on DEC Alpha S-PLUS uses 64-bit "integer", corresponding to
C long and Fortran integer.  I understand R is trying to use 32 bits for
R "integer", C int and Fortran integer.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sun Apr  4 22:36:10 1999
From: bates@stat.wisc.edu (bates@stat.wisc.edu)
Date: Sun, 4 Apr 1999 23:36:10 +0200
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
Message-ID: <199904042136.XAA32150@blueberry.kubism.ku.dk>

Full_Name: Douglas Bates
Version: Version 0.64.0 Unstable (April 3, 1999)
OS: Debian GNU/Linux 2.1
Submission from: (NULL) (128.105.5.97)


R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
R> anova( fm2 )
Analysis of Variance Table

Response: /
Response: 1
Response: Surv
                Df Sum Sq Mean Sq F value  Pr(>F)    
Poison           2   34.9    17.4   72.63 2.3e-13 ***
Antidote         3   20.4     6.8   28.34 1.4e-09 ***
Poison:Antidote  6    1.6     0.3    1.09    0.39    
Residuals       36    8.6     0.2                    
---
Signif. codes:  0  `***'  0.001  `**'  0.01  `*'  0.05  `.'  0.1  ` '  1 


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr  5 06:06:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Mon, 5 Apr 1999 06:06:07 +0100 (BST)
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
In-Reply-To: <199904042136.XAA32150@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904050603001.18277-100000@auk.stats>

On Sun, 4 Apr 1999 bates@stat.wisc.edu wrote:

> Full_Name: Douglas Bates
> Version: Version 0.64.0 Unstable (April 3, 1999)
> OS: Debian GNU/Linux 2.1
> Submission from: (NULL) (128.105.5.97)

[Is that an R problem: should not there be a machine name there?]
 

> R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
> R> anova( fm2 )
> Analysis of Variance Table
> 
> Response: /
> Response: 1
> Response: Surv

[...]

Actually, there is no print.anova.lm (print.anova is used) but the error is
a lack of a deparse in anova.lm. I have fixed this for 0.64 (whilst
incorporating Jean Meloche's patches for singular models).

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr  5 06:11:38 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 5 Apr 1999 07:11:38 +0200
Subject: deparsing lhs of formula in print.anova.lm (PR#157)
Message-ID: <199904050511.HAA32384@blueberry.kubism.ku.dk>

On Sun, 4 Apr 1999 bates@stat.wisc.edu wrote:

> Full_Name: Douglas Bates
> Version: Version 0.64.0 Unstable (April 3, 1999)
> OS: Debian GNU/Linux 2.1
> Submission from: (NULL) (128.105.5.97)

[Is that an R problem: should not there be a machine name there?]
 

> R> fm2 <- lm( 1/Surv ~ Poison + Antidote + Poison:Antidote, data = BC )
> R> anova( fm2 )
> Analysis of Variance Table
> 
> Response: /
> Response: 1
> Response: Surv

[...]

Actually, there is no print.anova.lm (print.anova is used) but the error is
a lack of a deparse in anova.lm. I have fixed this for 0.64 (whilst
incorporating Jean Meloche's patches for singular models).

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr  6 08:02:45 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 6 Apr 1999 08:02:45 +0100 (BST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <6ryakk2s15.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904060754340.23118-100000@auk.stats>

On 26 Mar 1999, Douglas Bates wrote:

> >>>>> "Jonathan" == Jonathan Rougier <J.C.Rougier@durham.ac.uk> writes:
> 
>   Jonathan> On Fri, 26 Mar 1999, Martyn Plummer wrote:
>   >> The problem isn't that the help files take up a lot of space, but
>   >> that certain file systems are extremely inefficient in the use of
>   >> that space.
> 
>   Jonathan> This is probably an unrealistic suggestion, but if
>   Jonathan> compression is less of a problem than the number of files,
>   Jonathan> why not take the help files `onboard' by creating a new
>   Jonathan> class of objects with mode "help", which would be lists
>   Jonathan> with components much like the current .Rd files, and
>   Jonathan> attach them at the bottom of the search list.  Each
>   Jonathan> library would then require just a single file of help
>   Jonathan> objects.
> 
> This is a reasonable suggestion but I think that the way that R
> handles its search lists would make this problematic.  At present
> objects in a library take up space in memory whether they are used or
> not.  Also, the search to resolve a name is a linear search over the
> available names.  Adding a whole lot more names for help objects would
> exacerbate both of those problems.  Then there is the name-space
> pollution problem.
> 
> Approaches to all of these issues with names and objects are being
> discussed and will probably be implemented in later releases.  Right
> now I think the best approach to the problem of help files,
> etc. (other than waiting for certain commercial operating systems to
> catch up with concepts from the 1980's) is to use the zip format for
> the reasons that Brian Ripley indicated.

Doing this proved relatively easy and quite fast enough. It will appear
in the next Windows version (rw0640, I presume) that is due in a few days.
We just use unzip to extract a file and display it. (There is a DLL
version of unzip, but it seems unnecessary.)  Using zipped help is optional
by package, and where selected (when installing the package from source)
zips up the text, latex and example files. The space savings on a VFAT16
file system are considerable (about 20Mb on my system).

It is a little unfair to blame Windows: it has had more space-efficient
file systems (NTFS, FAT32) for some time. The problem is that not
everything else (notably Linux) could read/write these, and so they
were not the defaults.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Tue Apr  6 08:45:45 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Tue, 6 Apr 1999 09:45:45 +0200
Subject: seg fault with strsplit (PR#158)
Message-ID: <199904060745.JAA32726@blueberry.kubism.ku.dk>

Try the following with R 63.3:

test <- function(z){
	ch1 <- deparse(z,width=500)
	ch <- NULL
	for(i in 1:length(ch1))ch <- paste(ch,ch1[i],collapse=" ")
	a <- gsub("(\\[(0|1|2|3|4|5|6|7|8|9|:|,)+\\])|([][+*/^():!<>%&|~,{}\"\\\=-])|( [0-9]+)|(^[0-9]+)"," ",ch)
	print("here")
	strsplit(a," ")
}
test(glm)

Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr  6 09:30:27 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 06 Apr 1999 10:30:27 +0200
Subject: seg fault with strsplit (PR#158)
In-Reply-To: jlindsey@alpha.luc.ac.be's message of "Tue, 6 Apr 1999 09:45:45 +0200"
References: <199904060745.JAA32726@blueberry.kubism.ku.dk>
Message-ID: <x2hfqui21o.fsf@blueberry.kubism.ku.dk>

jlindsey@alpha.luc.ac.be writes:

> Try the following with R 63.3:
> 
> test <- function(z){
> 	ch1 <- deparse(z,width=500)
> 	ch <- NULL
> 	for(i in 1:length(ch1))ch <- paste(ch,ch1[i],collapse=" ")
> 	a <- gsub("(\\[(0|1|2|3|4|5|6|7|8|9|:|,)+\\])|([][+*/^():!<>%&|~,{}\"\\\=-])|( [0-9]+)|(^[0-9]+)"," ",ch)
> 	print("here")
> 	strsplit(a," ")
> }
> test(glm)

We know... Buffer overflow. There's been a patch for it on r-devel by Jean
Meloche, using a short-lived malloc/free thing, but I'm still waiting
for someone to assure me that it won't interfere with current and
future memory management schemes.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr  6 11:22:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 6 Apr 1999 11:22:07 +0100 (BST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <199904061004.MAA05558@sophie.ethz.ch>
Message-ID: <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>

On Tue, 6 Apr 1999, Martin Maechler wrote:

[discussion moved make to R-devel]

> >>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
> 
>     <.....>
> 
>     BDR> Doing this proved relatively easy and quite fast enough. It will
>     BDR> appear in the next Windows version (rw0640, I presume) that is due
>     BDR> in a few days.  We just use unzip to extract a file and display
>     BDR> it. (There is a DLL version of unzip, but it seems unnecessary.)
>     BDR> Using zipped help is optional by package, and where selected (when
>     BDR> installing the package from source) zips up the text, latex and
>     BDR> example files. The space savings on a VFAT16 file system are
>     BDR> considerable (about 20Mb on my system).
> 
> Brian, 
> this will be part of R `proper',  not just the windows extensions
> right after  0.64, will it?

I am not sure about this. The gain is really only on systems with large
clusters, and that means Windows VFAT16, where small clusters are 4Kb and
clusters can be 32Kb (and are on a > 1Gb disc).

The other issue is licensing. I compiled unzip for Win32 and followed the
minimal allowed distribution as part of the binary distribution. On
source platforms the use of unzip would be optional, but with binary
distributions you would need to ensure unzip is available.

Is there any interest in having this on Unix/Linux platforms?  If so I can
very easily change the source code to search zip files if present.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Tue Apr  6 13:30:56 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Tue, 6 Apr 1999 14:30:56 +0200 (CEST)
Subject: Using zip format for help pages, examples, etc.
In-Reply-To: <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>
References: <199904061004.MAA05558@sophie.ethz.ch>
 <Pine.GSO.4.05.9904061114020.23412-100000@auk.stats>
Message-ID: <14089.65152.713639.650826@galadriel.ci.tuwien.ac.at>

>>>>> On Tue, 6 Apr 1999 11:22:07 +0100 (BST),
>>>>> Prof Brian D Ripley (PBDR) wrote:


PBDR> Is there any interest in having this on Unix/Linux platforms?  If so I can
PBDR> very easily change the source code to search zip files if present.

Yes, I think I want the help system as consistent across platforms as
possible, i.e., using the same mechanisms everywhere. Should be easier
to maintain.

.f


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@blueberry.kubism.ku.dk  Wed Apr  7 06:15:03 1999
From: pd@blueberry.kubism.ku.dk (Peter Dalgaard BSA)
Date: Wed, 7 Apr 1999 07:15:03 +0200
Subject: Bug list summary (automatic post)
Message-ID: <199904070515.HAA26555@blueberry.kubism.ku.dk>

=================================================
This is an automated summary of the status of the R-bugs
repository.

Note that this may be neither complete nor perfectly
correct at any given instance: Not all bugs are reported,
and some reported bugs may have been fixed, but the
repository not yet updated.

Some bug fixes are difficult to verify because they pertain
to specific hardware or operating system versions. If you
have information to contribute, please do so.

If you happen to know how to fix a problem please send
patches to the bug repository, too.

New bugs are reported either through the web
interface at r-bugs.biostat.ku.dk or via email to
r-bugs@biostat.ku.dk. The bug.report() function can be
used to automate parts of the procedure on many systems.
Followups on older bugs can be done by including the string
"(PR#999)" in the Subject of an email (change 999 to the
actual reference number, of course!).
=================================================

Directory:  Accuracy

* PR# 138 *
Subject: Re: [R] bug? and New bug.
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 10 Mar 1999 17:21:16 +0100

Directory:  Add-ons

* PR# 122 *
Subject: [R] possible bug in loglm
From: D.A.Wooff@durham.ac.uk
Date: Thu, 18 Feb 1999 17:06:11 +0000 (GMT)
--Problem with running inside function. 
* PR# 137 *
Subject: funfits
From: "Alvaro A. Novo" <novo@uiuc.edu>
Date: Tue, 9 Mar 1999 22:24:54 -0600

Directory:  Analyses

none

Directory:  Documentation

* PR# 146 *
Subject: nlm docs
From: Patrick Lindsey <plindsey@alpha.luc.ac.be>
Date: Wed, 24 Mar 1999 15:48:41 +0100 (MET)

Directory:  Graphics

* PR# 38 *
Subject: possible bugs
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Sun, 6 Sep 1998 15:59:34 -0400 (EDT)
--ylim problem which appears solved
--Postscript overflow still with us (22feb99)
* PR# 61 *
Subject: points(...,  cex = ..)  is pretty wrong...
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 2 Nov 1998 19:15:06 +0100
--Symbols getting decentered when too large cex for X. Still there 22feb99  
* PR# 66 *
Subject: Bug with bounding box?
From: johnp@tip.csiro.au
Date: Thu, 3 Dec 1998 02:15:38 +0100
--Yes, this appears to have x/y reversed. The supplied example gives 
--%%Orientation: Landscape
--%%BoundingBox: 18 18 824 577 
--but the convention is to rotate the paper but leave the coordinate system.
* PR# 69 *
Subject: Some graphics bugs
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 04 Dec 1998 11:42:50 -0000 ()
Date: 04-Dec-98
--Various anomalies with text size and alignment. 2B appears to be solved. The 
--rest is still there (22feb99)
* PR# 79 *
Subject: apology: text(locator(),"sometext") works
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Tue, 15 Dec 1998 19:45:29 -0500 (EST)
--Clipping discrepancy x11/PS
* PR# 106 *
Subject: border-arg. in persp
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Fri, 29 Jan 1999 11:12:39 +0100
--No effect of arg. Still here 22feb99. Segfault with border=0 seems gone now. 
* PR# 114 *
Subject: PostScript Level 1/2 bug
From: ben@eno.princeton.edu
Date: Mon, 8 Feb 1999 00:07:20 +0100
--Not sure whether this is really PS lev 1/2 issue.
--/Font5 /Symbol findfont definefont
--(missing scalefont?)
* PR# 120 *
Subject: graphics bug: type="l"
From: Matthew Wiener <mcw@ln.nimh.nih.gov>
Date: Tue, 16 Feb 1999 15:30:25 -0500 (EST)
--X server problem drawing > 64K lines at once. Workaround?
* PR# 123 *
Subject: Text in plot
From: Ennapadam Venkatraman <venkat@biosta.mskcc.org>
Date: Thu, 18 Feb 1999 13:05:37 -0500
--Multiline text not working
* PR# 130 *
Subject: lty=0 -- shouldn't it give an invisible line?
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 28 Feb 1999 21:45:43 +0100
* PR# 149 *
Subject: plot.formula and pch=
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 25 Mar 1999 21:22:44 +0100
* PR# 150 *
Subject: R: error report
From: Adelchi Azzalini <adelchi.azzalini@jrc.it>
Date: Fri, 26 Mar 1999 09:39:05 +0000
* PR# 153 *
Subject: image + x11
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Wed, 31 Mar 1999 14:09:53 +0200

Directory:  In-Out

* PR# 117 *
Subject: load() -> segfault
From: "Gregory R. Warnes" <warnes@biostat.washington.edu>
Date: Mon, 8 Feb 1999 18:10:36 -0800 (PST)
--Fixed-size buffer used to hold unlimited size object. Not good...
* PR# 125 *
Subject: scan rejects complex
From: John.Peters@tip.csiro.au (John Peters)
Date: Mon, 22 Feb 1999 10:08:14 +1100 (EST)
* PR# 129 *
Subject: Formatting in formatC and format
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 28 Feb 1999 08:53:34 +0000 (GMT)
--Documentation and ``merge'' of format() and formatC() would be desired - MM

Directory:  Installation

* PR# 95 *
Subject: patch to 63.2
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 15 Jan 1999 11:00:25 +0100 (MET)
--An incident where the 0.63.2 patches didn't take. So far the only one. 
--Maybe caused by patching unclean sources?

Directory:  Language

* PR# 40 *
Subject:  fac1 : fac2 -- fails {no "cross" anymore in seq.c} 
From: maechler@stat.math.ethz.ch
Date: Wed, 16 Sep 1998 08:42:12 +0200
--still there 17feb99
* PR# 85 *
Subject:  A bug in data.entry? 
From: Yusuke Uchiyama <me@naxgul.kais.kyoto-u.ac.jp>
Date: Wed, 23 Dec 1998 11:03:03 GMT
--still there 17feb99
* PR# 89 *
Subject: lapply -- Recall bug
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 6 Jan 1999 15:04:14 +0100
--This is *nasty*.
* PR# 105 *
Subject: an old bug resurfaces
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 29 Jan 1999 08:28:32 +0100 (MET)
--Model formulas. Proper fix probably requires extensive rewrite of model formula
--parser, which would make in non-S-compatible.
* PR# 113 *
Subject: cat data types
From: John Peters <johnp@tip.CSIRO.AU>
Date: Fri, 5 Feb 1999 18:31:52 +1100 (EDT)
--Cannot cat a name. (Docs fixed to reflect this by Kurt, 22feb99)
* PR# 118 *
Subject: Function parsing
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
Date: Wed, 10 Feb 1999 13:42:01 +0000 (GMT)
--comment placement.
* PR# 142 *
Subject: exists finds objects lots of places!
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:34:34 +0100
--No bug; not S compatible; documentation should be clearer

Directory:  Low-level

* PR# 37 *
Subject: S.h compatibility issues
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 6 Sep 1998 19:58:47 +0100 (BST)
* PR# 119 *
Subject: Problems with warnings from loess under Windows, at least
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Thu, 11 Feb 1999 15:08:41 +0000 (GMT)
* PR# 140 *
Subject: rbind dimnames with complex
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:15:14 +0100

Directory:  Misc

* PR# 91 *
Subject: possible bug
From: Rashid Nassar <rnassar@duke.edu>
Date: Sat, 9 Jan 1999 14:50:58 -0500 (EST)
--Remaining issue is whether we can do something more friendly than dumping 
--users into vi?

Directory:  Models

* PR# 121 *
Subject:  model.frame mangles time series 
From: Peter Dalgaard BSA <pd@biostat.ku.dk>
Date: Thu, 18 Feb 1999 15:47:24 +0100
--Subset in C code + attributes = mess
--Switch to interpreted ("[")

Directory:  Startup

* PR# 21 *
Subject: Restoring large image files
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 21 Aug 1998 13:29:16 -0000 ()

Directory:  System-specific

none

Directory:  TooMuchAtOnce

* PR# 53 *
Subject: 0.62.3 bugs, incompatibilities and problems
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 12 Oct 1998 09:43:51 +0200 (MET DST)
* PR# 76 *
Subject: R-0.63.0
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Fri, 11 Dec 1998 23:20:08 -0500 (EST)

Directory:  Windows

* PR# 46 *
Subject: keyboard bug in Guido's R62.3
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Thu, 24 Sep 1998 09:55:39 +0200 (MET DST)
* PR# 47 *
Subject: q() function in win32 version 0.61.3
From: normo@ratfish.pbs.dfo.ca
Date: Thu, 24 Sep 1998 22:04:10 +0200
* PR# 57 *
Subject: windows95
From: christoph.kalinowski@ku-eichstaett.de
Date: Thu, 29 Oct 1998 11:00:18 +0100
* PR# 59 *
Subject: windows nt
From: christoph.kalinowski@biostat.ku.dk
Date: Mon, 2 Nov 1998 13:41:52 +0100
* PR# 101 *
Subject: Re: [R] Re: R-0.63.2 for Windows - some comments
From: Guido Masarotto <guido@hal.stat.unipd.it>
Date: Fri, 22 Jan 1999 12:40:26 +0100

Directory:  incoming

* PR# 127 *
Subject: history
From: jmhughes@globalnet.co.uk
Date: Sat, 27 Feb 1999 21:32:56 +0100
* PR# 132 *
Subject: Re: [R] zero-offset matrices
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 02 Mar 1999 16:59:48 +0100
* PR# 133 *
Subject: Re: system
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 Mar 1999 11:33:21 +0100
* PR# 135 *
Subject: summary() of lm() problem
From: Simon Fear <fears@roycastle.liv.ac.uk>
Date: Tue, 9 Mar 1999 13:18:37 -0000 
--lm (?) AND Windows problem;  Win solved for 0.63.3
* PR# 139 *
Subject: : for factors
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 11 Mar 1999 09:30:04 +0100
* PR# 144 *
Subject: glm throws erroneous(?)'names attribute must be the same length as the vector' 
From: wagman@enteract.com
Date: Thu, 18 Mar 1999 08:58:47 +0100
* PR# 145 *
Subject: R-0.63.3 package on IRIX 6.5 machine
From: Jayshree Sarma <jsarma@cs.gmu.edu>
Date: Tue, 23 Mar 1999 16:54:20 -0500 (EST)
* PR# 148 *
Subject: Missing Warning in :
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 25 Mar 1999 13:34:12 +0100
* PR# 151 *
Subject: problems with formals and get
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 29 Mar 1999 09:29:05 +0200 (MET DST)
* PR# 152 *
Subject: Example(persp) fails in 0.63.4 and 0.64
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Tue, 30 Mar 1999 21:19:37 +0100 (BST)
* PR# 157 *
Subject: deparsing lhs of formula in print.anova.lm
From: bates@stat.wisc.edu
Date: Sun, 4 Apr 1999 23:36:08 +0200
* PR# 158 *
Subject: seg fault with strsplit
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Tue, 6 Apr 1999 09:41:29 +0200 (MET DST)
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Wed Apr  7 08:58:05 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Wed, 7 Apr 1999 09:58:05 +0200
Subject: offsets again (PR#159)
Message-ID: <199904070758.JAA26645@blueberry.kubism.ku.dk>

1. Try the following in 63.3

y <- rnorm(20)
y1 <- y[2:20]
y2 <- y[1:19]
summary(glm(y1~offset(y2)))
summary(glm(y1-y2~1))

Both are the same model, but the first gives the wrong s.e.
I don't believe this was a problem in 63.2

2. Besides the strsplit buffer, there appear to be other memory
problems causing seg faults. With vsize 12M in batch, I accumulated 9
glm objects in memory, then called one of my RM functions and
systematically got a seg fault. After much searching, I simply removed
the 9 objects before calling my function, the problem went away. This
did not occur in 63.2 but I have changed my function so that it now
uses strsplit and modifies function environments. However, in this
case, strsplit is not applied to any text that would cause buffer
overflow.
  Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 09:38:33 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Wed, 7 Apr 1999 10:38:33 +0200
Subject: offsets again (PR#159)
Message-ID: <199904070838.KAA26671@blueberry.kubism.ku.dk>

On Wed, 7 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> 1. Try the following in 63.3
> 
> y <- rnorm(20)
> y1 <- y[2:20]
> y2 <- y[1:19]
> summary(glm(y1~offset(y2)))
> summary(glm(y1-y2~1))
> 
> Both are the same model, but the first gives the wrong s.e.
> I don't believe this was a problem in 63.2

raw residuals from a glm with offset were wrong: fixed for 0.64.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From steuer@amadeus.statistik.uni-dortmund.de  Wed Apr  7 15:25:56 1999
From: steuer@amadeus.statistik.uni-dortmund.de (Dipl.-Stat. Detlef Steuer)
Date: Wed, 07 Apr 1999 16:25:56 +0200 (CEST)
Subject: chull() wanted?
Message-ID: <XFMail.990407162556.steuer@amadeus.statistik.uni-dortmund.de>

Hello!

Is there someone already working on an implementation of Splus'
chull() function for R?
If not, I would like volunteer to try it.

For my "Diplom" I implemented convex peeling in C (some time ago),
 using an O(n log(n)) algorithm, so it probably will prove relatively easy to
use that code for a R-function.

Well, as least as easy as any programming tends to be. :-)  

Detlef Steuer



Detlef Steuer Universitaet Dortmund                             ///////
LS Computergestuetzte Statistik                          U N I D O ///  
steuer@amadeus.statistik.uni-dortmund.de                ______///////  
Tel: ++49 +231 755 4353 Fax: ++49 +231 755 4387         \_\_\_\/////
                                                         \_\_\_\///
                                                          \_\_\_\/

*** Use what talents you possess: the woods would be very silent ***
*** if no birds sang there except those that sang best.          ***
*** Henry Van Dyke                                               ***
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Wed Apr  7 15:29:46 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Wed, 7 Apr 1999 16:29:46 +0200
Subject: core dump (PR#160)
Message-ID: <199904071429.QAA00885@blueberry.kubism.ku.dk>

Here is the output from gdb for one of my numerous reproducible core
dumps. Unfortunately, I cannot send the R code because it involves a lot
of data setting up and a special order of calling my ehr function in
my event library. Note that I am using 63.3 and not calling any of my
own C or Fortran. Jim

GNU gdb 4.17.0.4 with Linux/x86 hardware watchpoint and FPU support
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...
Core was generated by `/usr/local/src/R/bin/R.binary --no-save --no-restore --nsize 1M --vsize 12M'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/X11R6/lib/libSM.so.6...done.
Reading symbols from /usr/X11R6/lib/libICE.so.6...done.
Reading symbols from /usr/X11R6/lib/libX11.so.6...done.
Reading symbols from /usr/lib/libf2c.so.0...done.
Reading symbols from /usr/lib/libreadline.so.3...done.
Reading symbols from /lib/libdl.so.2...done.
Reading symbols from /usr/lib/libncurses.so.4...done.
Reading symbols from /lib/libm.so.6...done.
Reading symbols from /lib/libc.so.6...done.
Reading symbols from /lib/libtermcap.so.2...done.
Reading symbols from /lib/ld-linux.so.2...done.
Reading symbols from /usr/local/src/R/library/rmutil/libs/rmutil.so...done.
Reading symbols from /usr/local/src/R/library/event/libs/event.so...done.
#0  0x8080d6c in markSExp (s=Cannot access memory at address 0xbfffede4.
) at memory.c:501
501         if (s && !MARK(s)) {

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 15:29:57 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Wed, 7 Apr 1999 16:29:57 +0200
Subject: offsets again (PR#159)
Message-ID: <199904071429.QAA00889@blueberry.kubism.ku.dk>

On Wed, 7 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> 1. Try the following in 63.3
> 
> y <- rnorm(20)
> y1 <- y[2:20]
> y2 <- y[1:19]
> summary(glm(y1~offset(y2)))
> summary(glm(y1-y2~1))
> 
> Both are the same model, but the first gives the wrong s.e.
> I don't believe this was a problem in 63.2

My apologies: I have mis-edited the patch I applied, working too close
to the deadline for 0.64. I have in glm.fit

    residuals[good] <- z - (eta + offset)[good] # z does not have

Change + to - .

Oh well, 0.64.1 may get this right.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr  7 15:46:44 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Wed, 7 Apr 1999 15:46:44 +0100 (BST)
Subject: chull() wanted?
In-Reply-To: <XFMail.990407162556.steuer@amadeus.statistik.uni-dortmund.de>
Message-ID: <Pine.GSO.4.05.9904071543310.10385-100000@auk.stats>

On Wed, 7 Apr 1999, Dipl.-Stat. Detlef Steuer wrote:

> Hello!
> 
> Is there someone already working on an implementation of Splus'
> chull() function for R?
> If not, I would like volunteer to try it.
> 
> For my "Diplom" I implemented convex peeling in C (some time ago),
>  using an O(n log(n)) algorithm, so it probably will prove relatively easy to
> use that code for a R-function.

If only you had volunteered a month ago!

There is one implementation in package sm, and a cleaner one in 0.64, due
out today.  Both as versions of Eddy's 1977 algorithm. I would be happy to
replace the present chull by something better, though. It doesn't do
peeling, but that is easy to arrange in R: just remove the convex hull and
repeat.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From J.C.Rougier@durham.ac.uk  Thu Apr  8 10:26:23 1999
From: J.C.Rougier@durham.ac.uk (Jonathan Rougier)
Date: Thu, 8 Apr 1999 10:26:23 +0100 (BST)
Subject: chol()
Message-ID: <Pine.GSO.3.96.990408093028.11467C-100000@laplace>

May I suggest the following modification to chol(), allowing calls on
variance matrices with zeros in the diagonal.  This makes the generation
of multivariate gaussian vectors simpler, and consistent with rnorm()
which can take a zero standard deviation argument. 

"Chol" <-
function (x, tol = sqrt(.Machine$double.eps)) 
{
    if (!is.numeric(x)) 
        stop("non-numeric argument to chol")
    x <- as.matrix(x)
    if (length(n <- unique(dim(x))) > 1) 
        stop("non-square matrix in chol")
    nzero <- diag(x) > tol
    if (!all(nzero)) {
        cx <- Recall(x[nzero, nzero])
        x[] <- 0
        x[nzero, nzero] <- cx
        x
    }
    else {
        if (!is.double(x)) 
            storage.mode(x) <- "double"
        z <- .Fortran("chol", x = x, n, n, v = matrix(0, nr = n, 
            nc = n), info = integer(1), DUP = FALSE)
        if (z$info) 
            stop("singular matrix in chol")
        z$v
    }
}

I know that almost everyone has got one of these, but for completeness
here is my multivariate gaussian function which defaults to rnorm()

"rgauss" <-
function (n, mu, sig, ch = all(sig[lower.tri(sig)] == 0)) 
{
    if (missing(mu)) {
        if (missing(sig)) 
            sig <- 1
        sig <- as.matrix(sig)
        k <- unique(dim(sig))
        if (length(k) > 1) 
            stop("Non-square \"sig\" matrix")
        mu <- rep(0, k)
    }
    else {
        k <- length(mu)
        if (missing(sig)) 
            sig <- diag(rep(1, k))
        else {
            sig <- as.matrix(sig)
            if (any(k != dim(sig))) 
                stop("\"mu\" and \"sig\" inconsistent")
        }
    }
    # uses Chol() to handle zero variances
    if (!ch) 
        sig <- Chol(sig)
    rn <- matrix(rnorm(n * k), nrow = n)
    drop(sweep(rn %*% sig, 2, mu, "+"))
}

Regards, Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE

"[B]egin upon the precept ... that the things we see are to be 
 weighed in the scale with what we know"  (Meredith, 1879, The Egoist)

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rossini@biostat.washington.edu  Thu Apr  8 15:06:06 1999
From: rossini@biostat.washington.edu (A.J. Rossini)
Date: 08 Apr 1999 07:06:06 -0700
Subject: submission method "none" of bug.report() -- interaction with ESS ?
In-Reply-To: Martin Maechler's message of "Thu, 8 Apr 1999 15:55:04 +0200"
References: <14092.40223.352251.472183@galadriel.ci.tuwien.ac.at> <199904081340.PAA06350@sophie.ethz.ch> <14092.46140.344668.897964@galadriel.ci.tuwien.ac.at> <199904081355.PAA06373@sophie.ethz.ch>
Message-ID: <87vhf7b41d.fsf@alpha.cfas.washington.edu>


>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:
>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:
    FrL> This is not only a problem of bug.report(), but of providing
    FrL> a working editor in ESS ... because the same happens if you
    FrL> say edit(lm) or of whatever object you want.

    MM> but nobody sane using ESS would say
    MM>     edit(..)
    MM> 	       ;-)

Well, we hope not.  I guess we should scan for bug.report and edit,
and do the appropriate thing :-).

(for edit, "dump-object to buffer", for bugreport, dump everything
including mail, x-rated pictures, etc, into a file and send it to
r-bugs, until it's fixed in R -- who says you can't have the same kind
of fun with unix that the windows users had with melissa? :-) 

-- but seriously, what should the proper response be?  

R for unix then ought to have an --ess flag, the way Windows does, to
prevent such occurrences, and we can handle things appropriately (and
better!) in ESS.

best,
-tony

-- 
A.J. Rossini
UW Biostatistics & Center for AIDS Research 
206-543-1044 / 206-720-4282                 
rossini@biostat.washington.edu              
http://www.biostat.washington.edu/~rossini/ 
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Thu Apr  8 15:22:43 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Thu, 8 Apr 1999 15:22:43 +0100 (BST)
Subject: submission method "none" of bug.report() -- interaction with ESS ?
Message-ID: <199904081422.PAA14650@toucan.stats.ox.ac.uk>


> R for unix then ought to have an --ess flag, the way Windows does, to
> prevent such occurrences, and we can handle things appropriately (and
> better!) in ESS.

At present it does nothing visible. The best idea is I think for ESS to
set an environment variable which the R code can check for. As in

if(getenv("R_UNDER_ESS")) options(editor="gnuclient")


(Martin: you can have gnuclient on Solaris, I believe.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From mh.smith@auckland.ac.nz  Fri Apr  9 04:20:28 1999
From: mh.smith@auckland.ac.nz (mh.smith@auckland.ac.nz)
Date: Fri, 9 Apr 1999 05:20:28 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090320.FAA00615@blueberry.kubism.ku.dk>

Full_Name: Murray H Smith
Version: 0.63.3
OS: Windows NT
Submission from: (NULL) (130.216.5.57)


The ppois function is displaced by -0.5.
Try:

> ppois(-0.5,1)
[1] 0.3678794
> ppois(-0.51,1)
[1] 0
> ppois(0,1)
[1] 0.3678794

and

> par(mfrow=c(2,1))
> x<-seq(-1,5,0.01)
> plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 07:32:30 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 08:32:30 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090632.IAA00859@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999 mh.smith@auckland.ac.nz wrote:

> Full_Name: Murray H Smith
> Version: 0.63.3
> OS: Windows NT
> Submission from: (NULL) (130.216.5.57)
> 
> 
> The ppois function is displaced by -0.5.
> Try:
> 
> > ppois(-0.5,1)
> [1] 0.3678794
> > ppois(-0.51,1)
> [1] 0
> > ppois(0,1)
> [1] 0.3678794


The problem is in

> ?ppois

The Poisson Distribution

     dpois(x, lambda)
     ppois(q, lambda)
     qpois(p, lambda)
     rpois(n, lambda)

Arguments:

       x: vector of (positive) quantiles.

       p: vector of probabilities.

       n: number of random values to return.

  lambda: vector of positive means.

where q is undefined! It should only be defined for integers. Similarly, x
should only be integers.

It seems better to make ppois defined as the CDF for all q. The code had

    x = floor(x + 0.5);

and that should be something like floor(x + 1e-7).

I've fixed this for 0.64.1, and dpois now warns on non-integer x and,
correctly, gives 0. (Yes, I know S does not warn, but that is taking
silence too far I think.)

> 
> and
> 
> > par(mfrow=c(2,1))
> > x<-seq(-1,5,0.01)
> > plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> > plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")

Thank you for the nice example, now on the help page.


You did not try pnbinom, which is much more wrong:

> pnbinom(1, 3, 0.5)
[1] 0.3125
> pnbinom(1.1, 3, 0.5)
[1] 0.3320067
> pnbinom(1.5, 3, 0.5)
[1] 0.4089029


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 07:31:33 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 9 Apr 1999 07:31:33 +0100 (BST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <199904090320.FAA00615@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904090652020.28479-100000@auk.stats>

On Fri, 9 Apr 1999 mh.smith@auckland.ac.nz wrote:

> Full_Name: Murray H Smith
> Version: 0.63.3
> OS: Windows NT
> Submission from: (NULL) (130.216.5.57)
> 
> 
> The ppois function is displaced by -0.5.
> Try:
> 
> > ppois(-0.5,1)
> [1] 0.3678794
> > ppois(-0.51,1)
> [1] 0
> > ppois(0,1)
> [1] 0.3678794


The problem is in

> ?ppois

The Poisson Distribution

     dpois(x, lambda)
     ppois(q, lambda)
     qpois(p, lambda)
     rpois(n, lambda)

Arguments:

       x: vector of (positive) quantiles.

       p: vector of probabilities.

       n: number of random values to return.

  lambda: vector of positive means.

where q is undefined! It should only be defined for integers. Similarly, x
should only be integers.

It seems better to make ppois defined as the CDF for all q. The code had

    x = floor(x + 0.5);

and that should be something like floor(x + 1e-7).

I've fixed this for 0.64.1, and dpois now warns on non-integer x and,
correctly, gives 0. (Yes, I know S does not warn, but that is taking
silence too far I think.)

> 
> and
> 
> > par(mfrow=c(2,1))
> > x<-seq(-1,5,0.01)
> > plot(x,ppois(x,1),type="s",ylab="F(x)",main="Poisson CDF?")
> > plot(x,pbinom(x,100,0.01),type="s",ylab="F(x)",main="Binomial CDF")

Thank you for the nice example, now on the help page.


You did not try pnbinom, which is much more wrong:

> pnbinom(1, 3, 0.5)
[1] 0.3125
> pnbinom(1.1, 3, 0.5)
[1] 0.3320067
> pnbinom(1.5, 3, 0.5)
[1] 0.4089029


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From jlindsey@alpha.luc.ac.be  Fri Apr  9 07:39:16 1999
From: jlindsey@alpha.luc.ac.be (jlindsey@alpha.luc.ac.be)
Date: Fri, 9 Apr 1999 08:39:16 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090639.IAA00863@blueberry.kubism.ku.dk>

In R0.64.0, try
as.numeric(is.na(c(NA,NA,1)))
as.numeric(c(T,T,F))
  Jim

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:29:39 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:29:39 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090729.JAA00872@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:

>      ppois(q, lambda)
> 
> where q is undefined! It should only be defined for integers. Similarly, x
> should only be integers.

Ummmm.  I guess I see the argument for dpois, but I thought the
distribution function was defined for all values.  Wouldn't it be in order
to apply the integer argument function to floor(q) perhaps?

This seems to be what S does.

	> ppois(1.5, 2)
	[1] 0.4060058
	> ppois(1.1, 2)
	[1] 0.4060058


	Ross



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:23:40 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:23:40 +1200 (NZST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <Pine.GSO.4.05.9904090652020.28479-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990409191434.3007A-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:

>      ppois(q, lambda)
> 
> where q is undefined! It should only be defined for integers. Similarly, x
> should only be integers.

Ummmm.  I guess I see the argument for dpois, but I thought the
distribution function was defined for all values.  Wouldn't it be in order
to apply the integer argument function to floor(q) perhaps?

This seems to be what S does.

	> ppois(1.5, 2)
	[1] 0.4060058
	> ppois(1.1, 2)
	[1] 0.4060058


	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:34:21 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:34:21 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090734.JAA00876@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999, Ross Ihaka wrote:

Some nonsense or other ... Never mind, it's late Friday.

But ...  How about dpois(1.2, 3) returning NA?

	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:28:24 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:28:24 +1200 (NZST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <Pine.BSF.3.96.990409191434.3007A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.BSF.3.96.990409192558.3007B-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999, Ross Ihaka wrote:

Some nonsense or other ... Never mind, it's late Friday.

But ...  How about dpois(1.2, 3) returning NA?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:36:37 1999
From: ihaka@stat.auckland.ac.nz (ihaka@stat.auckland.ac.nz)
Date: Fri, 9 Apr 1999 09:36:37 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090736.JAA00880@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> In R0.64.0, try
> as.numeric(is.na(c(NA,NA,1)))
> as.numeric(c(T,T,F))

My version says

	> as.numeric(is.na(c(NA,NA,1)))
	[1] 1 1 0
	> as.numeric(c(T,T,F))
	[1] 1 1 0

which I think is ok?

	Ross


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Fri Apr  9 08:30:09 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 Apr 1999 19:30:09 +1200 (NZST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904090639.IAA00863@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990409192859.3007C-100000@g.ihaka.slip.auckland.ac.nz>


On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:

> In R0.64.0, try
> as.numeric(is.na(c(NA,NA,1)))
> as.numeric(c(T,T,F))

My version says

	> as.numeric(is.na(c(NA,NA,1)))
	[1] 1 1 0
	> as.numeric(c(T,T,F))
	[1] 1 1 0

which I think is ok?

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 08:48:25 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 09:48:25 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090748.JAA00884@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:

> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
> 
> >      ppois(q, lambda)
> > 
> > where q is undefined! It should only be defined for integers. Similarly, x
> > should only be integers.
> 
> Ummmm.  I guess I see the argument for dpois, but I thought the
> distribution function was defined for all values.  Wouldn't it be in order
> to apply the integer argument function to floor(q) perhaps?

Try reading on:

> > It seems better to make ppois defined as the CDF for all q. The code
had
> > 
> >    x = floor(x + 0.5);
> >
> > and that should be something like floor(x + 1e-7).

(q in R is x in C.)

> This seems to be what S does.
> 
> 	> ppois(1.5, 2)
> 	[1] 0.4060058
> 	> ppois(1.1, 2)
> 	[1] 0.4060058

and R-0.64.1 does

> ppois(1.5, 2)
[1] 0.4060058
> ppois(1.1, 2)
[1] 0.4060058
> dpois(1.1, 2)
Warning: non-integer x = 1.100000
[1] 0

Happy?

Brian


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 09:55:56 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 10:55:56 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904090855.KAA00972@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> and R-0.64.1 does
> 
> > ppois(1.5, 2)
> [1] 0.4060058
> > ppois(1.1, 2)
> [1] 0.4060058
> > dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0
> 
> Happy?

Almost. Do you use round(x) - x < 1e-7 or some such as criterion for
"integer"? (although I'd be hard pressed to come up with a natural
example where the argument to dpois is subject to FP accuracy issues)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 10:04:56 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 11:04:56 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090904.LAA01010@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:
> 
> > In R0.64.0, try
> > as.numeric(is.na(c(NA,NA,1)))
> > as.numeric(c(T,T,F))
> 
> My version says
> 
> 	> as.numeric(is.na(c(NA,NA,1)))
> 	[1] 1 1 0
> 	> as.numeric(c(T,T,F))
> 	[1] 1 1 0
> 
> which I think is ok?

Mine has 

> as.numeric(is.na(c(NA,NA,1)))
[1] -1 -1  0

Which is obviously not OK...

Seems to affect all numeric NA's:

> as.numeric(is.na(as.numeric(NA)))
[1] -1

This is on RedHat 5.2 (As Jim, I suspect)

Ick!

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 10:04:45 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 09 Apr 1999 11:04:45 +0200
Subject: a strange logical bug (PR#162)
In-Reply-To: Ross Ihaka's message of "Fri, 9 Apr 1999 19:30:09 +1200 (NZST)"
References: <Pine.BSF.3.96.990409192859.3007C-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <x2g16a411u.fsf@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Fri, 9 Apr 1999 jlindsey@alpha.luc.ac.be wrote:
> 
> > In R0.64.0, try
> > as.numeric(is.na(c(NA,NA,1)))
> > as.numeric(c(T,T,F))
> 
> My version says
> 
> 	> as.numeric(is.na(c(NA,NA,1)))
> 	[1] 1 1 0
> 	> as.numeric(c(T,T,F))
> 	[1] 1 1 0
> 
> which I think is ok?

Mine has 

> as.numeric(is.na(c(NA,NA,1)))
[1] -1 -1  0

Which is obviously not OK...

Seems to affect all numeric NA's:

> as.numeric(is.na(as.numeric(NA)))
[1] -1

This is on RedHat 5.2 (As Jim, I suspect)

Ick!

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 10:37:42 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 9 Apr 1999 11:37:42 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904090937.LAA01047@blueberry.kubism.ku.dk>

> Mine has 
> 
> > as.numeric(is.na(c(NA,NA,1)))
> [1] -1 -1  0
> 
> Which is obviously not OK...
> 
> Seems to affect all numeric NA's:
> 
> > A)))
> [1] -1
> 
> This is on RedHat 5.2 (As Jim, I suspect)

On RH 5.2

       The isnan() function returns a non-zero value if value  is
       "not-a-number" (NaN), and 0 otherwise.

and that non-zero is not defined!

On Solaris:

     isnan(), isnand(), and isnanf() return true (1) if the argu-
     ment dsrc or fsrc is a NaN; otherwise they return false (0).

and isnan is used in Arith.c for ISNAN and that is used in coerce.c
for do_isna (why?)

So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
solves this one for me.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  9 11:43:10 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt.Hornik@ci.tuwien.ac.at)
Date: Fri, 9 Apr 1999 12:43:10 +0200
Subject: Error in ppois function (PR#161)
Message-ID: <199904091043.MAA03073@blueberry.kubism.ku.dk>

>>>>> ripley  writes:

> On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:
>> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
>> 
>> >      ppois(q, lambda)
>> > 
>> > where q is undefined! It should only be defined for integers. Similarly, x
>> > should only be integers.
>> 
>> Ummmm.  I guess I see the argument for dpois, but I thought the
>> distribution function was defined for all values.  Wouldn't it be in order
>> to apply the integer argument function to floor(q) perhaps?

> Try reading on:

>> > It seems better to make ppois defined as the CDF for all q. The code
> had
>> > 
>> >    x = floor(x + 0.5);
>> >
>> > and that should be something like floor(x + 1e-7).

> (q in R is x in C.)

>> This seems to be what S does.
>> 
>> > ppois(1.5, 2)
>> [1] 0.4060058
>> > ppois(1.1, 2)
>> [1] 0.4060058

> and R-0.64.1 does

>> ppois(1.5, 2)
> [1] 0.4060058
>> ppois(1.1, 2)
> [1] 0.4060058
>> dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0

> Happy?

No!  Why the warning?  dpois(non-integer, something) makes perfect
sense, and simply gives 0.

(Yes, dwilcox() and dsignrank() will need fixing, too ...)

-k

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Fri Apr  9 11:48:46 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 9 Apr 1999 12:48:46 +0200 (CEST)
Subject: Error in ppois function (PR#161)
In-Reply-To: <199904090748.JAA00884@blueberry.kubism.ku.dk>
References: <199904090748.JAA00884@blueberry.kubism.ku.dk>
Message-ID: <14093.56078.682524.466080@pc87.maho.magnaeu.com>

>>>>> ripley  writes:

> On Fri, 9 Apr 1999 ihaka@stat.auckland.ac.nz wrote:
>> On Fri, 9 Apr 1999, Prof Brian D Ripley wrote:
>> 
>> >      ppois(q, lambda)
>> > 
>> > where q is undefined! It should only be defined for integers. Similarly, x
>> > should only be integers.
>> 
>> Ummmm.  I guess I see the argument for dpois, but I thought the
>> distribution function was defined for all values.  Wouldn't it be in order
>> to apply the integer argument function to floor(q) perhaps?

> Try reading on:

>> > It seems better to make ppois defined as the CDF for all q. The code
> had
>> > 
>> >    x = floor(x + 0.5);
>> >
>> > and that should be something like floor(x + 1e-7).

> (q in R is x in C.)

>> This seems to be what S does.
>> 
>> > ppois(1.5, 2)
>> [1] 0.4060058
>> > ppois(1.1, 2)
>> [1] 0.4060058

> and R-0.64.1 does

>> ppois(1.5, 2)
> [1] 0.4060058
>> ppois(1.1, 2)
> [1] 0.4060058
>> dpois(1.1, 2)
> Warning: non-integer x = 1.100000
> [1] 0

> Happy?

No!  Why the warning?  dpois(non-integer, something) makes perfect
sense, and simply gives 0.

(Yes, dwilcox() and dsignrank() will need fixing, too ...)

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Fri Apr  9 11:52:05 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Fri, 9 Apr 1999 12:52:05 +0200 (DFT)
Subject: Compilation problems with R-0.64.0
Message-ID: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>

Hi,

I have just tried to upgrade our AIX-machines to R-0.64.0 and encountered
some problems which, I think, are not AIX-specific.

1) The static variable class in "devX11.c" conflicts with a function
class() defined in math.h (using egcs-2.93.11). Therefore compilation
stops with an error message.

2) After renaming class to Visualclass in devX11.c everything looks fine
and an R binary file is created. However, it is not possible to open an
X11 window:

> x11()
Error: invalid colortype passed to X11 driver

3) Trying something like 

> options(X11colortype = "true")     
> x11()
> x<-seq(0,2*pi,len=100)
> plot(x,sin(x),ty="l")

works and draws a sine curve, but the tick marks are in a poor state: The
horizontal tick marks start at the left border of the graphics box, but
continue to the left crossing the legend. The vertical tick marks look
better, but apparently have infinite length and extend beyond the upper
border of the graphic box up to the borders of the X11 window.

4) The seq complains about a missing .Machine variable sometimes:

> x<-seq(0,2*pi,0.1)
Error: Object ".Machine" not found
> x<-seq(0,2*pi,len=100)

5) The fix command starts an editor, but leaves the original function
untouched afterwards... Commands like "myfunc<-vi(myfunc)" still work.

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 12:22:56 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 09 Apr 1999 13:22:56 +0200
Subject: a strange logical bug (PR#162)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Fri, 9 Apr 1999 11:37:42 +0200"
References: <199904090937.LAA01047@blueberry.kubism.ku.dk>
Message-ID: <x2btgy3unj.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> On RH 5.2
> 
>        The isnan() function returns a non-zero value if value  is
>        "not-a-number" (NaN), and 0 otherwise.
> 
> and that non-zero is not defined!

Uh-oh...

> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
> for do_isna (why?)

is.na(0/0) # Splus compat.

> So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
> solves this one for me.

But...(see above)

A better fix is 

#define ISNAN(x) (isnan(x)!=0)

Next problem: Messing with Arith.h and make'ing doesn't do anything
(dependency missing, obviously)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr  9 12:23:01 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 9 Apr 1999 13:23:01 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091123.NAA03290@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> On RH 5.2
> 
>        The isnan() function returns a non-zero value if value  is
>        "not-a-number" (NaN), and 0 otherwise.
> 
> and that non-zero is not defined!

Uh-oh...

> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
> for do_isna (why?)

is.na(0/0) # Splus compat.

> So ISNAN needs to be redefined on Linux at least.  Using ISNA not ISNAN
> solves this one for me.

But...(see above)

A better fix is 

#define ISNAN(x) (isnan(x)!=0)

Next problem: Messing with Arith.h and make'ing doesn't do anything
(dependency missing, obviously)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Fri Apr  9 12:48:48 1999
From: N.J.Lee@statslab.cam.ac.uk (N.J.Lee@statslab.cam.ac.uk)
Date: Fri, 9 Apr 1999 13:48:48 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091148.NAA03668@blueberry.kubism.ku.dk>


On Fri, 9 Apr 1999 ripley@stats.ox.ac.uk wrote:

> > > as.numeric(is.na(c(NA,NA,1)))
> > [1] -1 -1  0
> > 
> > Seems to affect all numeric NA's:
> > 
> > > A)))
> > [1] -1
> > 
> > This is on RedHat 5.2 (As Jim, I suspect)
> 
> On RH 5.2

I don't seem to have this problem on Debian 2.2 (with glibc2.1):

> as.numeric(is.na(as.numeric(NA)))
[1] 1
> as.numeric(is.na(c(NA,NA,1)))
[1] 1 1 0


Nicholas



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>  Fri Apr  9 12:48:26 1999
From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk> (Nicholas Lee)
Date: Fri, 9 Apr 1999 12:48:26 +0100 (BST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904090937.LAA01047@blueberry.kubism.ku.dk>
Message-ID: <Pine.HPP.3.96.990409124522.22711B-100000@tiger.statslab.cam.ac.uk>


On Fri, 9 Apr 1999 ripley@stats.ox.ac.uk wrote:

> > > as.numeric(is.na(c(NA,NA,1)))
> > [1] -1 -1  0
> > 
> > Seems to affect all numeric NA's:
> > 
> > > A)))
> > [1] -1
> > 
> > This is on RedHat 5.2 (As Jim, I suspect)
> 
> On RH 5.2

I don't seem to have this problem on Debian 2.2 (with glibc2.1):

> as.numeric(is.na(as.numeric(NA)))
[1] 1
> as.numeric(is.na(c(NA,NA,1)))
[1] 1 1 0


Nicholas


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.ethz.ch  Fri Apr  9 13:52:01 1999
From: maechler@stat.ethz.ch (maechler@stat.ethz.ch)
Date: Fri, 9 Apr 1999 14:52:01 +0200
Subject: a strange logical bug (PR#162)
Message-ID: <199904091252.OAA03730@blueberry.kubism.ku.dk>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> ripley@stats.ox.ac.uk writes:
    >> On RH 5.2
    >> 
    >> The isnan() function returns a non-zero value if value is
    >> "not-a-number" (NaN), and 0 otherwise.
    >> 
    >> and that non-zero is not defined!

    PD> Uh-oh...

    >> and isnan is used in Arith.c for ISNAN and that is used in coerce.c
    >> for do_isna (why?)

    PD> is.na(0/0) # Splus compat.

    >> So ISNAN needs to be redefined on Linux at least.  Using ISNA not
    >> ISNAN solves this one for me.

    PD> But...(see above)

    PD> A better fix is

    PD> #define ISNAN(x) (isnan(x)!=0)

oh dear;  and we had thought we would clean up the ISNAN definition and
do_isna[n] functions....
Are we all sure that this is *IT* for now...

Could we improve on the tests in  configure.in	to make sure beforehand
that  ISNAN will work?


    PD> Next problem: Messing with Arith.h and make'ing doesn't do anything
    PD> (dependency missing, obviously)

I've added ``a few of these'' to src/appl/Makefile.in and src/nmath/Makefile.in

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Fri Apr  9 15:45:42 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Fri, 9 Apr 1999 16:45:42 +0200 (DFT)
Subject: a strange logical bug (PR#162)
In-Reply-To: <199904091252.OAA03730@blueberry.kubism.ku.dk>
Message-ID: <Pine.A41.4.02.9904091639590.15648-100000@cauchy.mathematik.uni-essen.de>

On Fri, 9 Apr 1999 maechler@stat.math.ethz.ch wrote:

> oh dear;  and we had thought we would clean up the ISNAN definition and
> do_isna[n] functions....

I'm not sure if this fits into the discussion on do_isna, but can anybody
explain to me the following output from R-0.64.0 under AIX:

> NA
[1] NA
> NaN
[1]NaNQ
> par()$tck 
[1]NaNS

What's that? 

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri Apr  9 18:02:01 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 9 Apr 1999 19:02:01 +0200
Subject: Compilation problems with R-0.64.0 [AIX]
In-Reply-To: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>
 (message from Arne Kovac on Fri, 9 Apr 1999 12:52:05 +0200 (DFT))
References: <Pine.A41.4.02.9904091223250.19384-100000@gauss.mathematik.uni-essen.de>
Message-ID: <199904091702.TAA13911@sophie.ethz.ch>

Arne,
thanks a lot for reporting the problems you had with R on AIX.

>> 1) The static variable class in "devX11.c" conflicts with a function
>> class() defined in math.h (using egcs-2.93.11). Therefore compilation
>> stops with an error message.

I've just changed this (using "Vclass") 
for "R-release-patch" aka 0.64.1(prerelease).

>> 2) x11()  gives a  big problem...

Can others confirm this problem?

[no time for more now ..

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum SOL G1;	Sonneggstr.33
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1086			<><
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 18:02:20 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 13:02:20 -0400
Subject: a strange logical bug (PR#162)
References: <199904091252.OAA03730@blueberry.kubism.ku.dk>
Message-ID: <370E329C.54D97C82@bank-banque-canada.ca>

I believe I am being bitten by the isna bug and will happily wait until it is
fixed before I check further. However, one message seemed to suggest this may
only be a problem in Linux, and I am running Solaris. If more detailed problem
reports on this would be useful will someone please let me know.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Fri Apr  9 18:16:35 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Fri, 9 Apr 1999 18:16:35 +0100 (BST)
Subject: a strange logical bug (PR#162)
In-Reply-To: <370E329C.54D97C82@bank-banque-canada.ca>
Message-ID: <Pine.GSO.4.05.9904091814040.26950-100000@auk.stats>

On Fri, 9 Apr 1999, Paul Gilbert wrote:

> I believe I am being bitten by the isna bug and will happily wait until it is
> fixed before I check further. However, one message seemed to suggest this may
> only be a problem in Linux, and I am running Solaris. If more detailed problem
> reports on this would be useful will someone please let me know.

It is not a problem on Solaris, just on some Linux dialects where isnan
is no fully defined.

The fix is in R-release now: please check a snapshot after tomorrow, then
let us know about your isna bug!


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 19:37:37 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 14:37:37 -0400
Subject: eigen
Message-ID: <370E48F1.EBA98B18@bank-banque-canada.ca>

Eigen seems to be giving different results in 0.64 :

eigen(matrix(
 c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
   0.01262442, -0.1141633,  0.04989433, 0.006112607,
   0.04781087,  0.4177869, -0.15569656, 0.074242237,
   0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values

R:
 [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619

S:
[1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293

I am fairly sure that S and R previously gave the same results.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr  9 20:09:13 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 09 Apr 1999 15:09:13 -0400
Subject: dreaming?
Message-ID: <370E5058.AA54DE60@bank-banque-canada.ca>

I have a fairly comprehensive set of tests for my code, however, when my tests
report an error it still takes a fair amount of time to track down the problem.
It occured to me that it would be very nice to be able to run a supervisor
routine that could request an object be returned by an R calculation on a
different machine (different platform and/or different R version) and compare
the results. Has anyone considered this? It would certainly speed up the testing
cycle. Perhaps I could even trace back and narrow down the problem
automatically.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 01:28:03 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 02:28:03 +0200
Subject: eigen
In-Reply-To: Paul Gilbert's message of "Fri, 09 Apr 1999 14:37:37 -0400"
References: <370E48F1.EBA98B18@bank-banque-canada.ca>
Message-ID: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>

Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:

> Eigen seems to be giving different results in 0.64 :
> 
> eigen(matrix(
>  c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
>    0.01262442, -0.1141633,  0.04989433, 0.006112607,
>    0.04781087,  0.4177869, -0.15569656, 0.074242237,
>    0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values
> 
> R:
>  [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619
> 
> S:
> [1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293
> 
> I am fairly sure that S and R previously gave the same results.

Indeedy. At least the pre 63.3 binary I had lying about did give the S
results. The eigenvectors are also bogus as far as I can tell.

The weird thing is that eigen() goes via .Fortran to eigen.c
(which was f2c'ed at some point) and neither eigen.c or eigen.R has
been changed in 1999 according to the cvs logs. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 03:19:09 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 14:19:09 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz>


On 10 Apr 1999, Peter Dalgaard BSA wrote:

> Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:
> 
> > Eigen seems to be giving different results in 0.64 :
> > 
> > eigen(matrix(
> >  c(0.00000000,  0.0000000,  0.00000000, 1.000000000,
> >    0.01262442, -0.1141633,  0.04989433, 0.006112607,
> >    0.04781087,  0.4177869, -0.15569656, 0.074242237,
> >    0.20167331,  0.2531109, -0.04973573, 0.034046467) ,4,4))$values
> > 
> > R:
> >  [1]  0.35519256 -0.29294606 -0.26637369 -0.03168619
> > 
> > S:
> > [1]  0.4689288205 -0.4246063863 -0.2810596564  0.0009238293
> > 
> > I am fairly sure that S and R previously gave the same results.
> 
> Indeedy. At least the pre 63.3 binary I had lying about did give the S
> results. The eigenvectors are also bogus as far as I can tell.
> 
> The weird thing is that eigen() goes via .Fortran to eigen.c
> (which was f2c'ed at some point) and neither eigen.c or eigen.R has
> been changed in 1999 according to the cvs logs. 
> 

Weirder still.  I get the problem results under Solaris with a clean
checkout of 0.65 but not under FreeBSD with a clean 0.65.
Solaris is using egcs and FreeBSD is using gcc 2.7.2.1.

I am beginning to suspect a compiler / library bug.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 04:00:55 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 09 Apr 1999 22:00:55 -0500
Subject: eigen
In-Reply-To: Ross Ihaka's message of "Sat, 10 Apr 1999 14:19:09 +1200 (NZST)"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <6rhfqp6uxk.fsf@verdi.stat.wisc.edu>

I also get the problem results under 0.64.0 compiled with egcs on
Linux/Intel - both RedHat and Debian systems.  When I checked the
RedHat system under 0.63.4 (not sure of the compiler) I got the other
set of results.  That pattern was repeated on a SPARC Solaris 2.6
system.  0.64.0 compiled with egcs gave the incorrect results and
0.63.4 compiled with an unknown compiler gave the correct results.
Same again on an Intel/Solaris 2.6 system.

I think the compiler that I used for the 0.63.4 builds was egcs-1.0.3
but I'm not sure.  I'll go back and re-build 0.64.0 with egcs-1.0.3
instead of egcs-1.1.1 and see what happens.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 04:37:04 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 09 Apr 1999 22:37:04 -0500
Subject: eigen
In-Reply-To: Douglas Bates's message of "09 Apr 1999 22:00:55 -0500"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu>
Message-ID: <6raewh6t9b.fsf@verdi.stat.wisc.edu>

>>>>> "DMB" == Douglas Bates <bates@stat.wisc.edu> writes:

  DMB> I think the compiler that I used for the 0.63.4 builds was
  DMB> egcs-1.0.3 but I'm not sure.  I'll go back and re-build 0.64.0
  DMB> with egcs-1.0.3 instead of egcs-1.1.1 and see what happens.

Changing to egcs-1.0.3 for a re-build of 0.64.0 didn't clear up the
problem.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 05:41:22 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 16:41:22 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2vhf5uxnw.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990410160720.5666B-100000@g.ihaka.slip.auckland.ac.nz>


I don't know what the problem was, but I think I have a fix.  I have
replaced src/appl/eigen.c by the original set of fortran eispack routines. 
This seems to fix the problem on my Solaris box. 

I suspect that this bug may have been there for a while.

I am still puzzled that it was not tripped on my FreeBSD box.  It must be
the advanced compiler technology; it silently finds and fixes the bugs in
your code as you compile it :-).

Anyway could someone check that this change does the job on Linux etc.
(I've committed in both branches).

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sat Apr 10 06:21:47 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sat, 10 Apr 1999 06:21:47 +0100 (BST)
Subject: eigen
In-Reply-To: <Pine.BSF.3.96.990410160720.5666B-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>

On Sat, 10 Apr 1999, Ross Ihaka wrote:

> I don't know what the problem was, but I think I have a fix.  I have
> replaced src/appl/eigen.c by the original set of fortran eispack routines. 
> This seems to fix the problem on my Solaris box. 

The bug is that Fortran.h had <math.h>, now has "Mathlib.h", and soemthing
in there is trampling over error.c

> I suspect that this bug may have been there for a while.

No, it _is_ a 0.64 change, 0.63.3 is unaffected.

> 
> I am still puzzled that it was not tripped on my FreeBSD box.  It must be
> the advanced compiler technology; it silently finds and fixes the bugs in
> your code as you compile it :-).

Look to header files in such circumstances. Mathlib.h includes

#include <errno.h>
#include <limits.h>
#include <float.h>
#include <math.h>
#include <stdlib.h>

and on Solaris the culprit is the last one of these.

Guess what: there a load of abs/fabs errors in eigen.c.  On some
systems abs is a macro, on others a function and on others it
depends on the optimization level.

> Anyway could someone check that this change does the job on Linux etc.
> (I've committed in both branches).

(Do you want to revert?)

What worries me is what else Mathlib.h might be trampling over.
I think we need to check this over.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 08:14:39 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sat, 10 Apr 1999 19:14:39 +1200 (NZST)
Subject: eigen
In-Reply-To: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990410190641.3295A-100000@g.ihaka.slip.auckland.ac.nz>


On Sat, 10 Apr 1999, Prof Brian D Ripley wrote:

> (Do you want to revert?)

I think eigen.c dates from days before we tried to be pure C for
portability purposes.  Provided we can live with the namespace pollution
which comes with Fortran (all function names being global), I'd actually
prefer to live with the original code. We've reverted the Linpack and
optimizer code already.

(Yeah, Yeah so why did I do the nmath thing?  I thought it might be more
generally useful than just for R ...) 
 
> What worries me is what else Mathlib.h might be trampling over.
> I think we need to check this over.

Definitely!

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 11:31:30 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 12:31:30 +0200
Subject: eigen
In-Reply-To: Douglas Bates's message of "09 Apr 1999 22:37:04 -0500"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu> <6raewh6t9b.fsf@verdi.stat.wisc.edu>
Message-ID: <x2g168dawt.fsf@blueberry.kubism.ku.dk>

Douglas Bates <bates@stat.wisc.edu> writes:

> >>>>> "DMB" == Douglas Bates <bates@stat.wisc.edu> writes:
> 
>   DMB> I think the compiler that I used for the 0.63.4 builds was
>   DMB> egcs-1.0.3 but I'm not sure.  I'll go back and re-build 0.64.0
>   DMB> with egcs-1.0.3 instead of egcs-1.1.1 and see what happens.
> 
> Changing to egcs-1.0.3 for a re-build of 0.64.0 didn't clear up the
> problem.

I also get the same result with different compilers (gcc 2.7.2.3 and
egcs-2.91.57) Note BTW that it *fails* the
consistency test from the example file

> m %*% V - V %*% diag(lam)
              [,1]          [,2]          [,3]          [,4]
[1,]  2.775558e-17  1.387779e-17  2.775558e-17 -3.382711e-17
[2,]  4.117019e-01  2.872937e-01 -2.687366e-01  7.624831e-02
[3,]  4.615645e-02  3.220889e-02 -3.012842e-02  8.548301e-03
[4,] -2.688891e-01 -1.876361e-01  1.755162e-01 -4.979899e-02

- whereas the older version did

>  m %*% V - V %*% diag(lam)
              [,1]          [,2]          [,3]          [,4]
[1,] -8.326673e-17  0.000000e+00  0.000000e+00 -2.622414e-18
[2,] -5.551115e-17  1.110223e-16  0.000000e+00 -1.368263e-16
[3,]  3.469447e-18 -2.775558e-17 -5.551115e-17  3.957338e-17
[4,] -5.551115e-17 -1.110223e-16  5.028530e-16  1.502704e-16

[0.63.4 in progress (March 9, 1999) on my office machine]

The test on symmetric matrices does not fail, though. (Make check
would have caught this, save for the m<-m+t(m) line...)

Most likely, we're being bitten  either by a code 'cleanup' or some
sort of change in the linked libraries.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 10 11:49:59 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 10 Apr 1999 12:49:59 +0200
Subject: eigen
In-Reply-To: Peter Dalgaard BSA's message of "10 Apr 1999 12:31:30 +0200"
References: <Pine.BSF.3.96.990410131911.5666A-100000@g.ihaka.slip.auckland.ac.nz> <6rhfqp6uxk.fsf@verdi.stat.wisc.edu> <6raewh6t9b.fsf@verdi.stat.wisc.edu> <x2g168dawt.fsf@blueberry.kubism.ku.dk>
Message-ID: <x2emlsda20.fsf@blueberry.kubism.ku.dk>

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> 
> The test on symmetric matrices does not fail, though. (Make check
> would have caught this, save for the m<-m+t(m) line...)
> 
> Most likely, we're being bitten  either by a code 'cleanup' or some
> sort of change in the linked libraries.
> 

Oops. Didn't see Brian+Ross's exchange before sending. Never mind.
Martin may still want to fix the example, though?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From mtim@farm.ecs.umass.edu  Sat Apr 10 18:35:45 1999
From: mtim@farm.ecs.umass.edu (mtim@farm.ecs.umass.edu)
Date: Sat, 10 Apr 1999 19:35:45 +0200
Subject: IRIX compile (PR#163)
Message-ID: <199904101735.TAA04499@blueberry.kubism.ku.dk>

Full_Name: Tim Middelkoop
Version: 0.64.0
OS: IRIX 6.3 on O2
Submission from: (NULL) (128.119.88.192)


Various IRIX complile  issues

src/nmath/pnt.c
IRIX cc does not like double negatives

Makeconf,config.site,etc/Makeconf
f77 pic hack, should change Makeconf.in or other...
change -PIC with -KPIC

enjoy, tim...
===

diff -ru orig/R-0.64.0/src/nmath/pnt.c R-0.64.0/src/nmath/pnt.c
--- orig/R-0.64.0/src/nmath/pnt.c       Wed Apr  7 02:45:48 1999
+++ R-0.64.0/src/nmath/pnt.c    Sat Apr 10 13:02:45 1999
@@ -80,7 +80,7 @@
        del = -del;
     }
 
-    if (df > 4e5 || del*del > 2*M_LN2*(-DBL_MIN_EXP)) {
+    if (df > 4e5 || del*del > 2*M_LN2*(-(DBL_MIN_EXP))) {
        /*-- 2nd part: if del > 37.62, then p=0 below
          FIXME: test should depend on `df', `tt' AND `del' ! */
        /* Approx. from  Abramowitz & Stegun 26.7.10 (p.949) */










-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Sat Apr 10 18:41:02 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sat, 10 Apr 1999 19:41:02 +0200 (CEST)
Subject: IRIX compile (PR#163)
In-Reply-To: <199904101735.TAA04499@blueberry.kubism.ku.dk>
References: <199904101735.TAA04499@blueberry.kubism.ku.dk>
Message-ID: <14095.36142.306970.30451@aragorn.ci.tuwien.ac.at>

>>>>> mtim  writes:

> Full_Name: Tim Middelkoop
> Version: 0.64.0
> OS: IRIX 6.3 on O2
> Submission from: (NULL) (128.119.88.192)


> Various IRIX complile  issues

> src/nmath/pnt.c
> IRIX cc does not like double negatives

> Makeconf,config.site,etc/Makeconf

> f77 pic hack, should change Makeconf.in or other...
> change -PIC with -KPIC

Sure about this?  Which version of f77 is this, the native one?

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Sat Apr 10 19:12:28 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sat, 10 Apr 1999 20:12:28 +0200 (CEST)
Subject: IRIX compile (PR#163)
In-Reply-To: <199904101735.TAA04499@blueberry.kubism.ku.dk>
References: <199904101735.TAA04499@blueberry.kubism.ku.dk>
Message-ID: <14095.38028.187255.911966@aragorn.ci.tuwien.ac.at>

>>>>> mtim  writes:

> Full_Name: Tim Middelkoop
> Version: 0.64.0
> OS: IRIX 6.3 on O2
> Submission from: (NULL) (128.119.88.192)


> Various IRIX complile  issues

> src/nmath/pnt.c
> IRIX cc does not like double negatives

> Makeconf,config.site,etc/Makeconf
> f77 pic hack, should change Makeconf.in or other...
> change -PIC with -KPIC

> enjoy, tim...
> ===

> diff -ru orig/R-0.64.0/src/nmath/pnt.c R-0.64.0/src/nmath/pnt.c
> --- orig/R-0.64.0/src/nmath/pnt.c       Wed Apr  7 02:45:48 1999
> +++ R-0.64.0/src/nmath/pnt.c    Sat Apr 10 13:02:45 1999
> @@ -80,7 +80,7 @@
>         del = -del;
>      }
 
> -    if (df > 4e5 || del*del > 2*M_LN2*(-DBL_MIN_EXP)) {
> +    if (df > 4e5 || del*del > 2*M_LN2*(-(DBL_MIN_EXP))) {
>         /*-- 2nd part: if del > 37.62, then p=0 below
>           FIXME: test should depend on `df', `tt' AND `del' ! */
>         /* Approx. from  Abramowitz & Stegun 26.7.10 (p.949) */

Both fixed in 0.64.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 21:35:38 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 11 Apr 1999 08:35:38 +1200 (NZST)
Subject: eigen
In-Reply-To: <x2emlsda20.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.BSF.3.96.990411082533.326A-100000@g.ihaka.slip.auckland.ac.nz>


The problem in eigen.c seems to be as follows.

1) f2c defines a macro abs() which does the standard abs() which
   works for all numeric types. This macro was inserted in Fortran.h.

2) recently it was recognised that there is an abs() in stdlib and
   the macro in Fortran.h was commented out.

3) unfortunately the abs() in stdlib is an integer valued function
   of an integer argument.

4) end of world.

I think the lesson is that partial translations of fortran into C and the
use of macros to get the rest of the way is VERY dangerous. 

Sometimes it is unavoidable, because we want to do some bit-fiddling or
platform dependent manipulation.  The lesson I think is to keep the use of
externally defined macros in the translations to a minimum. 

I am going to go through appl/ to look carefully at all the translations
for problems of this kind.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sat Apr 10 22:11:32 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 11 Apr 1999 09:11:32 +1200 (NZST)
Subject: Fortran vs C
In-Reply-To: <Pine.BSF.3.96.990410190641.3295A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.BSF.3.96.990411090524.359A-100000@g.ihaka.slip.auckland.ac.nz>


To follow up the "eigen" issue.  What should our position on translating
Fortran into C be?  Should we leave as much code as possible in Fortran or
should we move it to C as much as possible? 

I can see arguments both ways.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 23:00:07 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 10 Apr 1999 17:00:07 -0500
Subject: Fortran vs C
In-Reply-To: Ross Ihaka's message of "Sun, 11 Apr 1999 09:11:32 +1200 (NZST)"
References: <Pine.BSF.3.96.990411090524.359A-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>

>>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

  Ross> To follow up the "eigen" issue.  What should our position on
  Ross> translating Fortran into C be?  Should we leave as much code
  Ross> as possible in Fortran or should we move it to C as much as
  Ross> possible?

I can think of three different sets of circumstances:
 a) creating new code: This one is obvious, just say "no" to Fortran.
 b) enhancing existing code: For something small do the automatic
      translation to C with f2c then modify the C sources and regard
      those as the definitive version.  For a big Fortran routine, try
      to write a C wrapper around it and make modifications in the
      wrapper. 
 c) using established code without modification (e.g. Eispack, Linpack):
      Regard the Fortran sources as the definitive version and don't
      translate.

Now that g77 is available and reasonably stable, a lot of the
motivation for using f2c is gone.  There are still the messy linkage
issues when calling Fortran from C but most of those are now resolved
by the configure script.  Passing character strings, etc. will
continue to be problematic but most of the legacy Fortran code we
would use will be strictly numerical routines with, we hope,
comparatively simple calling sequences.  (Lapack is an exception in
that it uses strings to declare options but we aren't using Lapack.)

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Sat Apr 10 23:05:35 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Sat, 10 Apr 1999 17:05:35 -0500 (CDT)
Subject: R/S compatibility in passing a formula
Message-ID: <m10W5sd-0000X4C@verdi.stat.wisc.edu>

In S3 if you are passing an evaluated formula to another function that
will store it and use it in printing (such as a model-fitting function), you
usually want to unclass the formula.  Otherwise, the formula that gets
stored looks very ugly when printed.  A trick to do the unclassing is to pass
 form = c( myFormula )
In R this has the effect of making form a list rather than a call.  It
seems that passing
 form = as.vector( myFormula )
will work in both dialects.  Anyone else have experience with this?
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr 11 01:16:31 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 11 Apr 1999 02:16:31 +0200
Subject: R/S compatibility in passing a formula
In-Reply-To: Douglas Bates's message of "Sat, 10 Apr 1999 17:05:35 -0500 (CDT)"
References: <m10W5sd-0000X4C@verdi.stat.wisc.edu>
Message-ID: <x267743tb4.fsf@blueberry.kubism.ku.dk>

Douglas Bates <bates@stat.wisc.edu> writes:

> In S3 if you are passing an evaluated formula to another function that
> will store it and use it in printing (such as a model-fitting function), you
> usually want to unclass the formula.  Otherwise, the formula that gets
> stored looks very ugly when printed.  A trick to do the unclassing is to pass
>  form = c( myFormula )
> In R this has the effect of making form a list rather than a call.  It
> seems that passing
>  form = as.vector( myFormula )
> will work in both dialects.  Anyone else have experience with this?

Apparently

(a) R does not print the class on a formula (because print.formula
unclasses it)
(b) as.vector does not unclass in R but does in S3. Try
class(as.vector(form)) 

So the result of as.vector *looks* alike, but isn't. Smells like
trouble... 

Whatever is wrong with using unclass() for unclassing anyway??

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 08:30:40 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 11 Apr 1999 08:30:40 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>

On 10 Apr 1999, Douglas Bates wrote:

> >>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
> 
>   Ross> To follow up the "eigen" issue.  What should our position on
>   Ross> translating Fortran into C be?  Should we leave as much code
>   Ross> as possible in Fortran or should we move it to C as much as
>   Ross> possible?
> 
> I can think of three different sets of circumstances:
>  a) creating new code: This one is obvious, just say "no" to Fortran.
>  b) enhancing existing code: For something small do the automatic
>       translation to C with f2c then modify the C sources and regard
>       those as the definitive version.  For a big Fortran routine, try
>       to write a C wrapper around it and make modifications in the
>       wrapper. 
>  c) using established code without modification (e.g. Eispack, Linpack):
>       Regard the Fortran sources as the definitive version and don't
>       translate.
> 
> Now that g77 is available and reasonably stable, a lot of the
> motivation for using f2c is gone.  There are still the messy linkage
> issues when calling Fortran from C but most of those are now resolved
> by the configure script.  Passing character strings, etc. will
> continue to be problematic but most of the legacy Fortran code we
> would use will be strictly numerical routines with, we hope,
> comparatively simple calling sequences.  (Lapack is an exception in
> that it uses strings to declare options but we aren't using Lapack.)

[A long reply: I am much-bitten here!]

1) In my experience there are problems with error reporting via strings in
such Fortran code, as I found in loess (and found more easily in less
complicated packages). I wrote a two-step interface (in Fortran find the
string length, pass that and string back to C), and perhaps we should
set up warning and error subroutines to be called from Fortran to
standardize this that package writers/porters could use.


2) My motivation would be to use Fortran wherever it already exists. In the
world of scientific computing Fortran has been king and the effort in
compiler development has gone into efficient Fortran compilers with godd
optimizers. So on a Sun or DEC Alpha (and probably SGI) the original
Fortran used to run appreciably faster than the C translation (using the
native compilers), and although the gap has closed I think it is still
quite noticeable.  In my experience R can't afford that price. This may not
be an issue on Linux/Windows, but I expect is on Sun/DEC/SGI/HP.

BTW, I think that means that Doug's `just say "no" to Fortran' is not
obviously true if performance matters. This is likely to especially true if
single-precision calculations will do the job. (And, yes, I know about
Intel hardware but I don't see the need to slow a Sparc or Alpha FP unit
down to Intel speeds, especially older ones. I also know how to make C do
efficient float calculations using float libraries on Sparc, but that sort
of thing is a nightmare to configure portably, and also to link into S or 
R. It happens for free in Fortran.)


3) The problem is finding the external calls from Fortran code. In the base
code this should be not problem now we use the Fortran front-end to link.  
I have problems with quite a few packages that use Fortran, and have
translated some code myself just to avoid those. (It was a big problem in
the first release of MASS software for S-PLUS, and we removed all the 
Fortran to save ourselves the hastle of `it won't work on my XYZ system'
reports. We never made the Fortran work on HPs, whose Fortran name space
clashes with the C one, and it seemed that S had already grabbed some
critical symbols as C ones.)

I think in R we can do better than at present, if only I knew
exactly how. One idea is to have (effectively) a `hints' file that
configure uses to add a base set of libraries to FLIBS, but on Solaris
at least, using the Fortran command (f77 or g77) to link a dynamic library
does the job.  For linking with ld the base FLIBS would need to be

-lF77 -lM77 -lV77 -lsunmath -lm

_if_ f77 is used.  How viable is `use FC to link' on other platforms?

And to come back to beating a drum, if the dlopen option were RTLD_NOW
not RTLD_LAZY, these things would be easier to check. People keep sending
packages to CRAN that are incomplete (mclust seems to be now) and with
RTLD_NOW this is _much_ more likely to be noticed. Can we re-consider?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 08:39:59 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Sun, 11 Apr 1999 08:39:59 +0100 (BST)
Subject: R/S compatibility in passing a formula
In-Reply-To: <x267743tb4.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.9904110835440.3678-100000@auk.stats>

On 11 Apr 1999, Peter Dalgaard BSA wrote:

> Douglas Bates <bates@stat.wisc.edu> writes:
> 
> > In S3 if you are passing an evaluated formula to another function that
> > will store it and use it in printing (such as a model-fitting function), you
> > usually want to unclass the formula.  Otherwise, the formula that gets
> > stored looks very ugly when printed.  A trick to do the unclassing is to pass
> >  form = c( myFormula )
> > In R this has the effect of making form a list rather than a call.  It
> > seems that passing
> >  form = as.vector( myFormula )
> > will work in both dialects.  Anyone else have experience with this?
> 
> Apparently
> 
> (a) R does not print the class on a formula (because print.formula
> unclasses it)
> (b) as.vector does not unclass in R but does in S3. Try
> class(as.vector(form)) 
> 
> So the result of as.vector *looks* alike, but isn't. Smells like
> trouble... 
> 
> Whatever is wrong with using unclass() for unclassing anyway??

Because it is oldUnclass in recent S's, and having to use code translators
for S3/R/S-PLUS 5.x is a pain!   Nevertheless, that is what I do: write
oldUnclass() and translate.  (The reverse does not work: in S-PLUS 5 one
sometimes needs unclass()).

(I am pickily using S-PLUS 5 not S4: there is no public version of S4, but
S-PLUS 5 is quite different from S4 as documented in Chambers, 1998.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Sun Apr 11 21:15:35 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 12 Apr 1999 08:15:35 +1200 (NZST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <Pine.BSF.3.96.990412081348.339A-100000@g.ihaka.slip.auckland.ac.nz>


On Sun, 11 Apr 1999, Prof Brian D Ripley wrote:

> And to come back to beating a drum, if the dlopen option were RTLD_NOW
> not RTLD_LAZY, these things would be easier to check. People keep sending
> packages to CRAN that are incomplete (mclust seems to be now) and with
> RTLD_NOW this is _much_ more likely to be noticed. Can we re-consider?

I've changed in the devel (non) branch.  Let's see if it bites anyone 
(HPUX?). 

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Sun Apr 11 22:53:48 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Sun, 11 Apr 1999 23:53:48 +0200
Subject: [R] repeated measurements libraries v0.4 (PR#164)
Message-ID: <199904112153.XAA05566@blueberry.kubism.ku.dk>

On Fri, 9 Apr 1999, Jim Lindsey wrote:

> I have just uploaded version 0.4 of my libraries to the CRAN site.
> Hopefully, they will shortly become available.

Jim,

You have shipped growth with symbolic links to rmutil, and that is not even
listed as a Depends: in the DESCRIPTION. Symbolic links do not even exist
on some file systems!  (What happens with a VFAT file system on Linux,
or an SMB-mounted one?)

Could you please re-package this with the missing files? And it would be
very helpful to have correct dependencies listed. For the Windows port I
have put up today I copied the files across from rmutil.

As you know, my preference would be to have your packages in a single
bundle. To get all the cross-links in the man page one has to install your
packages in a certain order, and it would be helpful to know what it is! I
_think_ it is reverse-alphabetical, but am not sure even if it can be done
on one pass now (it used not to be able to).  This sort of thing would be
much easier to get right with a single package.

Brian

[Is this the sort of bug you think I should be sending to r-help? I am
sending it to the R-bugs database, in any case, so please tell R-bugs when
it is fixed.]

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:20:18 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:20:18 +0200 (CEST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
References: <6r7lrk16hk.fsf@verdi.stat.wisc.edu>
 <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <14097.37026.863229.382113@pc87.maho.magnaeu.com>

>>>>> Prof Brian D Ripley writes:

> On 10 Apr 1999, Douglas Bates wrote:
>> >>>>> "Ross" == Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
>> 
Ross> To follow up the "eigen" issue.  What should our position on
Ross> translating Fortran into C be?  Should we leave as much code
Ross> as possible in Fortran or should we move it to C as much as
Ross> possible?
>> 
>> I can think of three different sets of circumstances:
>> a) creating new code: This one is obvious, just say "no" to Fortran.
>> b) enhancing existing code: For something small do the automatic
>> translation to C with f2c then modify the C sources and regard
>> those as the definitive version.  For a big Fortran routine, try
>> to write a C wrapper around it and make modifications in the
>> wrapper. 
>> c) using established code without modification (e.g. Eispack, Linpack):
>> Regard the Fortran sources as the definitive version and don't
>> translate.
>> 
>> Now that g77 is available and reasonably stable, a lot of the
>> motivation for using f2c is gone.  There are still the messy linkage
>> issues when calling Fortran from C but most of those are now resolved
>> by the configure script.  Passing character strings, etc. will
>> continue to be problematic but most of the legacy Fortran code we
>> would use will be strictly numerical routines with, we hope,
>> comparatively simple calling sequences.  (Lapack is an exception in
>> that it uses strings to declare options but we aren't using Lapack.)

> [A long reply: I am much-bitten here!]

> ...

> I think in R we can do better than at present, if only I knew exactly
> how. One idea is to have (effectively) a `hints' file that configure
> uses to add a base set of libraries to FLIBS, but on Solaris at least,
> using the Fortran command (f77 or g77) to link a dynamic library does
> the job.  For linking with ld the base FLIBS would need to be

> -lF77 -lM77 -lV77 -lsunmath -lm

> _if_ f77 is used.  How viable is `use FC to link' on other platforms?

Are you suggesting using the Fortran compiler as SHLIBLD?

Please help me understanding this a bit more.  The above `-lF77 ...'
would be the default FLIBS to use when compiling/linking Fortran?

Short term fix should be to use platform-specific overrides in basic
configure.  Another idea is to have configure scripts supported for add
ons.

(If I fully understood the problem, I think I could fix it ...)

=k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Mon Apr 12 07:35:01 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Mon, 12 Apr 1999 07:35:01 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <14097.37026.863229.382113@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.05.9904120734010.9192-100000@auk.stats>

On Mon, 12 Apr 1999, Kurt Hornik wrote:

> >>>>> Prof Brian D Ripley writes:
> > I think in R we can do better than at present, if only I knew exactly
> > how. One idea is to have (effectively) a `hints' file that configure
> > uses to add a base set of libraries to FLIBS, but on Solaris at least,
> > using the Fortran command (f77 or g77) to link a dynamic library does
> > the job.  For linking with ld the base FLIBS would need to be
> 
> > -lF77 -lM77 -lV77 -lsunmath -lm
> 
> > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> 
> Are you suggesting using the Fortran compiler as SHLIBLD?

Yes, at least on platforms where this is known to be safe.

> Please help me understanding this a bit more.  The above `-lF77 ...'
> would be the default FLIBS to use when compiling/linking Fortran?

On Solaris.

> Short term fix should be to use platform-specific overrides in basic
> configure.  Another idea is to have configure scripts supported for add
> ons.
> 
> (If I fully understood the problem, I think I could fix it ...)

Yes!


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:56:11 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:56:11 +0200
Subject: add-on packages
Message-ID: <199904120656.IAA14380@pc87.maho.magnaeu.com>

Some further infos/thoughts/... on our add-on packages.

Here are the results of running a simple counting script on my system
(at home, not all available packages installed there):

Packages found:            59
  with INDEX               59
  with TITLE               59
  with DESCRIPTION         26
    with License info      21
  with data                25
    with data/00Index      11
    with data/index.doc     6

This is quite alarming (of course, the standard packages from the main
distribution currently do not have DESCRIPTION files)!  PLEASE update
your packages, the DESCRIPTION file is definitely needed!

(Also, some packages still have old-style .doc data documentation.)

Fritz and I are thinking about automating an add-on checking mechanism.
In addition to the above, info on which packages pass `R CMD check' etc
could be provided on a regular basis.

We are also thinking about automating the package build process (e.g.,
`R CMD build pkg').  An `INDEX' and a data index could be generated
automatically.  At build time, comparison of object usage as is and as
documented could be done.  Information on undocumented objects could be
provided.  `R CMD check' could be run.  And so on ...

Btw, re `INDEX': currently, if I document several objects in one Rd
file, I get only one INDEX entry (which is obtained from \title{}).
This is not satisfactory.  Maybe we should have something like
	\index{NAME}{TEXT}
???

I also want to propose adding a "Maintainer" field in DESCRIPTION.  In
the future we could use this info for both automatic checking and bug
reporting.

Another interesting fact is data duplication.  More than 10 data sets
show up in more than one package.  Maybe we should add these to the main
distribution then?

Finally (again?), please make sure that your packages do not mask system
features.

Thanks,
-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 07:56:11 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 08:56:11 +0200
Subject: PLATFORMS
Message-ID: <199904120656.IAA14375@pc87.maho.magnaeu.com>

Hmm ... no recent success stories on building 0.64?
Below is what we currently know of.

Thanks for feedback in advance,
-k

***********************************************************************
SUCCESSFUL BUILDS

R is known to configure, compile and run correctly on at least the
following platforms.  

0.63.3	i386	Linux Debian 2.1
		Linux Redhat 5.1, 5.2
		Linux SuSe 5.3, 6.0
		FreeBSD 2.2.5

	alpha	DEC OSF 4.0

	sparc	Linux RedHat 5.2
		Sun Solaris 2.6, 2.7

	ppc	Linux LinuxPPC 4

0.64.0	i386	Linux Debian 2.0

	sparc	Sun Solaris 2.5.1, 2.6

	hppa	HPUX 10.20

See below for more details and contact information.

If you have success on any others, please notify us by filling in the
template and the end of this file.  Make sure to mention any changes you
had to make so we can update this file and our installation procedures.

NOTE: a `successful' build is one that passes `make check'!

NAME       	Douglas Bates
EMAIL      	bates@stat.wisc.edu
VERSION    	0.63.3
PLATFORM   	i386-unknown-linux
SYSTEM     	Debian 2.1
CC		egcs
FC		g77
MAKE		make

NAME		Martyn Plummer
EMAIL		plummer@iarc.fr
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.1
CC		gcc
FC		egcs-g77
MAKE		make

NAME		Göran Broström
EMAIL		gb@stat.umu.se
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          Redhat 5.2
CC		gcc
FC		egcs-g77
MAKE		make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 5.3
CC		egcs-2.91.57
FC		GNU Fortran 0.5.24-19980804
MAKE		GNU Make version 3.76.1
NOTES		native SuSE 5.3 gcc/g77 do not work

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC		egcs-2.91.60
FC		GNU Fortran 0.5.24-19980804
MAKE		GNU Make version 3.76.1

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.63.3
PLATFORM        i386-unknown-linux
SYSTEM          SuSE 6.0
CC		gcc
FC		egcs-g77
MAKE		make

NAME            Albrecht Gebhardt
EMAIL           albrecht.gebhardt@uni-klu.ac.at
VERSION         0.63.3
PLATFORM        alpha-dec-osf4.0
SYSTEM          Digital Unix 4.0E
CC		DEC C V5.8-009 on Digital UNIX V4.0 (Rev. 1091)
FC		DIGITAL Fortran 77 V5.1 for DIGITAL UNIX
MAKE		GNU Make version 3.76.1

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		cc SC4.2
FC		f77 SC4.2
MAKE      	GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.63.3
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		egcs 1.1 gcc
FC		egcs 1.1 g77
MAKE		GNU make

NAME		Thomas Lumley
EMAIL		thomas@biostat.washington.edu
VERSION		0.63.3
PLATFORM	sun-sparc-solaris2.7
SYSTEM		
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME       	Göran Broström
EMAIL      	gb@stat.umu.se
VERSION    	0.63.3
PLATFORM   	sun-sparc-linux
SYSTEM     	Redhat 5.2
CC		gcc version egcs-2.90.29 980515 (egcs-1.0.3 release)
FC		egcs-g77
MAKE 		make

NAME       	Kurt Hornik
EMAIL      	Kurt.Hornik@ci.tuwien.ac.at
VERSION    	0.64.0(1999/04/03)
PLATFORM   	i586-unknown-linux
SYSTEM     	Debian 2.0
CC 		gcc 2.7.2.3
FC		egcs-2.90.29 980515 (egcs-1.0.3 release)
MAKE		GNU make 3.76.1

NAME       	Nicholas Lee
EMAIL      	njl25@cam.ac.uk
VERSION    	0.64.0 Unstable
PLATFORM   	i586-unknown-linux
SYSTEM     	Debian 2.2 Unstable
CC		egcs-1.1.2 gcc
FC		egcs-1.1.2 g77
MAKE		make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		Sun make

NAME		Martin Maechler
EMAIL		maechler@stat.math.ethz.ch
VERSION         0.64(1999/04/01)
PLATFORM        sparc-sun-solaris2.5.1
SYSTEM          sun4u SUNW,Ultra-1
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		GNU make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		gcc 2.8.1
FC		f77 SC4.2
MAKE		Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		cc SC4.2
FC		f77 SC4.2
MAKE		Sun make

NAME            Brian Ripley
EMAIL           ripley@stats.ox.ac.uk
VERSION         0.64
PLATFORM        sun-sparc-solaris2.6
SYSTEM          
CC		egcs 1.1 gcc
FC		egcs 1.1 g77
MAKE		GNU make

NAME		Osman Buyukisik
EMAIL		osman@cinternet.net
VERSION         0.64
PLATFORM        hppa2.0
SYSTEM          hpux10.20
CC		egcs
FC		f2c
MAKE		GNU make

NAME		
EMAIL		
VERSION         
PLATFORM        
SYSTEM          
CC		
FC		
MAKE		
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon Apr 12 08:29:37 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 Apr 1999 09:29:37 +0200
Subject: eigen
In-Reply-To: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats> (message
 from Prof Brian D Ripley on Sat, 10 Apr 1999 06:21:47 +0100 (BST))
References: <Pine.GSO.4.05.9904100600140.14706-100000@auk.stats>
Message-ID: <199904120729.JAA00508@sophie.ethz.ch>

>>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

    BDR> On Sat, 10 Apr 1999, Ross Ihaka wrote:

      >> I don't know what the problem was, but I think I have a fix.  I
      >> have replaced src/appl/eigen.c by the original set of fortran
      >> eispack routines.  This seems to fix the problem on my Solaris
      >> box.

    BDR> The bug is that Fortran.h had <math.h>, now has "Mathlib.h", and
    BDR> something in there is trampling over error.c

    >> I suspect that this bug may have been there for a while.

    BDR> No, it _is_ a 0.64 change, 0.63.3 is unaffected.

    >> 
    >> I am still puzzled that it was not tripped on my FreeBSD box.  It must be
    >> the advanced compiler technology; it silently finds and fixes the bugs in
    >> your code as you compile it :-).

    BDR> Look to header files in such circumstances. Mathlib.h includes

    BDR> #include <errno.h>
    BDR> #include <limits.h>
    BDR> #include <float.h>
    BDR> #include <math.h>
    BDR> #include <stdlib.h>

    BDR> and on Solaris the culprit is the last one of these.
(grrreat)

    BDR> Guess what: there a load of abs/fabs errors in eigen.c.  On some
    BDR> systems abs is a macro, on others a function and on others it
    BDR> depends on the optimization level.

We must use a Mathlib.h -- src/nmath/  version of this

    >> Anyway could someone check that this change does the job on Linux etc.
    >> (I've committed in both branches).

    BDR> (Do you want to revert?)

Yes! -- The eigen.c has been massaged etc to be quite a bit more readable
     than its Fortran counterpart..


    BDR> What worries me is what else Mathlib.h might be trampling over.
    BDR> I think we need to check this over.

certainly
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 10:09:29 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 10:09:29 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904120909.KAA28372@toucan.stats.ox.ac.uk>

Martin M has suggested I widen this discussion to R-devel, and 

> I agree that we should increase them,
> but I'm not sure at all about the amount.
> 
> The default could even depend on the architecture (via "./configure")..

Views, please.

------------- Begin Forwarded Message -------------

Is is not time we increased the defaults a bit? As the base gets bigger
I hit 200k cons cells rather frequently. And 2Mb of heap seems low
compared to 3Mb of cons cells and 1.8Mb for the R binary.

How little memory do people have these data?  Except possibly on Windows
and old teaching labs I would have thought using 15Mb default for R
was very reasonable, which is about

--vsize 6Mb --nsize 300k

On Solaris that gives:

  PID USERNAME THR PRI NICE  SIZE   RES STATE   TIME    CPU COMMAND
 9308 ripley     1 -25    0   15M 8360K sleep   0:02  4.35% R.binary

as against the default

  PID USERNAME THR PRI NICE  SIZE   RES STATE   TIME    CPU COMMAND
 9309 ripley     1 -25    0 9664K 6416K sleep   0:02  4.66% R.binary

and that extra user memory makes a lot of difference.


------------- End Forwarded Message -------------


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From albrecht.gebhardt@uni-klu.ac.at  Mon Apr 12 10:30:20 1999
From: albrecht.gebhardt@uni-klu.ac.at (Albrecht Gebhardt)
Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.GSO.4.05.9904110750450.3678-100000@auk.stats>
Message-ID: <Pine.OSF.4.05.9904121125330.19966-100000@zidsrv.sci.uni-klu.ac.at>

On Sun, 11 Apr 1999, Prof Brian D Ripley wrote:

>
> ... some lines deleted ...
>
> 3) The problem is finding the external calls from Fortran code. In the base
> code this should be not problem now we use the Fortran front-end to link.  
> I have problems with quite a few packages that use Fortran, and have
> translated some code myself just to avoid those. (It was a big problem in
> the first release of MASS software for S-PLUS, and we removed all the 
> Fortran to save ourselves the hastle of `it won't work on my XYZ system'
> reports. We never made the Fortran work on HPs, whose Fortran name space
> clashes with the C one, and it seemed that S had already grabbed some
> critical symbols as C ones.)
> 
> I think in R we can do better than at present, if only I knew
> exactly how. One idea is to have (effectively) a `hints' file that
> configure uses to add a base set of libraries to FLIBS, but on Solaris
> at least, using the Fortran command (f77 or g77) to link a dynamic library
> does the job.  For linking with ld the base FLIBS would need to be
> 
> -lF77 -lM77 -lV77 -lsunmath -lm
> 
> _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> 

I'm not sure if it does matter here, but the only way to build R on my
Alphas currently is using Fortran as LDCMD:

in config.site:
LDCMD="f77 -g -nofor_main -fpe3 "

SHLIBLD is "ld -shared -expect_unresolved '*'".



Albrecht

-------------------------------------------------------------------------------
Albrecht Gebhardt                   email   : albrecht.gebhardt@uni-klu.ac.at
Institut fuer Mathematik            Tel.    : (++43 463) 2700/837
Universitaet Klagenfurt             Fax     : (++43 463) 2700/834
Villacher Str. 161
A-9020 Klagenfurt, Austria
-------------------------------------------------------------------------------


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 10:45:07 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 10:45:07 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
Message-ID: <199904120945.KAA28971@toucan.stats.ox.ac.uk>


> Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
> From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>
> > I think in R we can do better than at present, if only I knew
> > exactly how. One idea is to have (effectively) a `hints' file that
> > configure uses to add a base set of libraries to FLIBS, but on Solaris
> > at least, using the Fortran command (f77 or g77) to link a dynamic library
> > does the job.  For linking with ld the base FLIBS would need to be
> > 
> > -lF77 -lM77 -lV77 -lsunmath -lm
> > 
> > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> > 
> 
> I'm not sure if it does matter here, but the only way to build R on my
> Alphas currently is using Fortran as LDCMD:
> 
> in config.site:
> LDCMD="f77 "
> 
> SHLIBLD is "ld -shared -expect_unresolved '*'".

I would have expected

LDCMD=f77
LDFLAGS="-g -nofor_main -fpe3"
SHLIBLD=ld
SHLIBLDFLAGS="-shared -expect_unresolved '*'"

as the way to encode that.  Now my question amounts to

Does SHLIBLD=f77 work with those SHLIBLDFLAGS?
If not, can SHLIBLDFLAGS be modified to make it work?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From osman.buyukisik@ae.ge.com  Mon Apr 12 13:39:00 1999
From: osman.buyukisik@ae.ge.com (U-E59264-Osman F Buyukisik)
Date: Mon, 12 Apr 1999 08:39:00 -0400 (EDT)
Subject: R-0.65-April-12 on hpux10.20
Message-ID: <14097.59185.477055.292796@c1186.ae.ge.com>

Hello,
 It looks like demo("dyn.load") is broken for non ".so" extentions.

> demo("dyn.load")


        demo(dyn.load)
        ---- ~~~~~~~~

Type  <Return>   to start : 

> dyn.load("zero.so")
Error in dyn.load(x) : unable to load shared library "/home/absd00t/zero.so":
  can't open /home/absd00t/zero.so
> 
It looks like zero.R problem. It is looking for zero.* in my home
dir. If I do :
~>R COMPILE zero.c
gcc -I/usr/include/Motif1.1 -I/usr/include/X11R4 -I/home/absd00t/local/include -fpic -I/home/absd00t/local/lib/R/include -c zero.c -o zero.o
~>R SHLIB -o zero.sl zero.o
ld -b -o zero.sl zero.o -L/home/absd00t/local/lib  -lf2c -lm

~>R

R : Copyright 1999, The R Development Core Team
Version 0.65.0 Under development (unstable) (April 12, 1999)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type    "?license" or "?licence" for distribution details.

R is a collaborative project with many contributors.
Type    "?contributors" for a list.

Type    "demo()" for some demos, "help()" for on-line help, or
        "help.start()" for a HTML browser interface to help.
Type    "q()" to quit R.

> dyn.load("zero.sl")
> source("zero.R")   <--- after changing zero.so to zero.sl
[1] 1.5
[1] 1.50000002235174
> 

Seems to be working OK.
Osman
 
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 14:08:13 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 14:08:13 +0100 (BST)
Subject: R-0.65-April-12 on hpux10.20
Message-ID: <199904121308.OAA05354@toucan.stats.ox.ac.uk>

> From: U-E59264-Osman F Buyukisik <absd00t@c1186.ae.ge.com>
> 
> Hello,
>  It looks like demo("dyn.load") is broken for non ".so" extentions.

Broken? Has it ever worked?

You need

dyn.load(paste("zero", .Platform$dynlib.ext, sep="."))

and I will put that in the release branch as this is a bug fix.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Mon Apr 12 15:17:33 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 12 Apr 1999 09:17:33 -0500
Subject: --nsize and --vsize
In-Reply-To: Prof Brian Ripley's message of "Mon, 12 Apr 1999 10:09:29 +0100 (BST)"
References: <199904120909.KAA28372@toucan.stats.ox.ac.uk>
Message-ID: <6rlnfxly82.fsf@verdi.stat.wisc.edu>

I would agree that:
 - it is reasonable to increase the default vsize and nsize
 - the default sizes should probably be architecture dependent
 - If possible, the default sizes should also be picked up from
   ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
   environment variables and use them

I think that 16M for vsize and 800k for nsize could be good global
defaults on many architectures.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Mon Apr 12 16:24:39 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Mon, 12 Apr 1999 08:24:39 -0700 (PDT)
Subject: add-on packages
In-Reply-To: <199904120656.IAA14380@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>

On Mon, 12 Apr 1999, Kurt Hornik wrote:
> Another interesting fact is data duplication.  More than 10 data sets
> show up in more than one package.  Maybe we should add these to the main
> distribution then?

I don't think this follows. Disk space is much cheaper than name space
(perhaps even when we get the promised new features)

> 
> Finally (again?), please make sure that your packages do not mask system
> features.

Note that this requires quite frequent checking -- system features do keep
being added.

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Mon Apr 12 16:45:50 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 Apr 1999 17:45:50 +0200 (CEST)
Subject: add-on packages
In-Reply-To: <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>
References: <199904120656.IAA14380@pc87.maho.magnaeu.com>
 <Pine.GSO.4.10.9904120822210.412-100000@wompom.biostat.washington.edu>
Message-ID: <14098.5422.232593.587310@pc87.maho.magnaeu.com>

>>>>> Thomas Lumley writes:

> On Mon, 12 Apr 1999, Kurt Hornik wrote:

>> Another interesting fact is data duplication.  More than 10 data sets
>> show up in more than one package.  Maybe we should add these to the main
>> distribution then?

> I don't think this follows. Disk space is much cheaper than name space
> (perhaps even when we get the promised new features)

O.k.

>> 
>> Finally (again?), please make sure that your packages do not mask system
>> features.

> Note that this requires quite frequent checking -- system features do
> keep being added.

I thought that this too could be a part of the automated process.
(After a successful `R CMD check', load the pkg and see if the warnings
occur.)

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Mon Apr 12 16:41:59 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 12 Apr 1999 11:41:59 -0400
Subject: Fortran vs C, easing using Fortran
References: <199904120945.KAA28971@toucan.stats.ox.ac.uk>
Message-ID: <37121447.77787569@bank-banque-canada.ca>

It seems to me that, at least for application packages, there is a strong
incentive to avoid both fortran and C. If eventual R, or a new language like
Omega, are to work in a "Java like" way across platforms, I think both fortran
and C are problems. Is that not correct?

I realize there is a performance issue, but I don't think it is as serious as it
was in old versions of Splus. I am not sure how slow my time series library
would be without the fortran. It used to be intolerable, but I have the
impression it may not be too bad now.

To some extent this must also apply to the core part of the language. Is there
not some incentive to remove, not add, both fortran and C except where they are
essential?

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 16:50:03 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 16:50:03 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904121550.QAA10948@toucan.stats.ox.ac.uk>


> To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
> Cc: R-devel@stat.math.ethz.ch
> Subject: Re: --nsize and --vsize
> From: Douglas Bates <bates@stat.wisc.edu>
> Date: 12 Apr 1999 09:17:33 -0500
> 
> I would agree that:
>  - it is reasonable to increase the default vsize and nsize
>  - the default sizes should probably be architecture dependent
>  - If possible, the default sizes should also be picked up from
>    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
>    environment variables and use them
> 
> I think that 16M for vsize and 800k for nsize could be good global
> defaults on many architectures.

But not I think for multi-user machines. That is 35Mb allocated (on Solaris)
and I would not want our students taking 35Mb for each R job, as the
current memory management really needs most of it resident. About half
that would be tolerable, hence my original figures.  We would like them 
to use perhaps 50Mb in total.

Also, that is too much for 64Mb Windows NT machines, and that is 
high-end for teaching labs.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From albrecht.gebhardt@uni-klu.ac.at  Mon Apr 12 17:27:46 1999
From: albrecht.gebhardt@uni-klu.ac.at (Albrecht Gebhardt)
Date: Mon, 12 Apr 1999 18:27:46 +0200 (MET DST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <199904120945.KAA28971@toucan.stats.ox.ac.uk>
Message-ID: <Pine.OSF.4.05.9904121806200.23217-100000@zidsrv.sci.uni-klu.ac.at>

On Mon, 12 Apr 1999, Prof Brian Ripley wrote:

> 
> > Date: Mon, 12 Apr 1999 11:30:20 +0200 (MET DST)
> > From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>
> > > I think in R we can do better than at present, if only I knew
> > > exactly how. One idea is to have (effectively) a `hints' file that
> > > configure uses to add a base set of libraries to FLIBS, but on Solaris
> > > at least, using the Fortran command (f77 or g77) to link a dynamic library
> > > does the job.  For linking with ld the base FLIBS would need to be
> > > 
> > > -lF77 -lM77 -lV77 -lsunmath -lm
> > > 
> > > _if_ f77 is used.  How viable is `use FC to link' on other platforms?
> > > 
> > 
> > I'm not sure if it does matter here, but the only way to build R on my
> > Alphas currently is using Fortran as LDCMD:
> > 
> > in config.site:
> > LDCMD="f77 "
> > 
> > SHLIBLD is "ld -shared -expect_unresolved '*'".
> 
> I would have expected
> 
> LDCMD=f77
> LDFLAGS="-g -nofor_main -fpe3"
> SHLIBLD=ld
> SHLIBLDFLAGS="-shared -expect_unresolved '*'"
> 
> as the way to encode that.  Now my question amounts to
> 
> Does SHLIBLD=f77 work with those SHLIBLDFLAGS?
> If not, can SHLIBLDFLAGS be modified to make it work?
> 

splitting 
   LDCMD="f77 -g -nofor_main -fpe3 "
into 
   LDCMD=f77
   LDFLAGS="-g -nofor_main -fpe3"
results in

root@delta[R]# ./configure
loading cache ./config.cache
checking for a BSD compatible install... (cached) /usr/local/bin/install -c
checking whether ln -s works... (cached) yes
checking for ranlib... (cached) ranlib
checking for bison... (cached) bison -y
checking for ar... (cached) ar
checking for latex... (cached) /usr/local/bin/latex
checking for dvips... (cached) /usr/local/bin/dvips
checking for makeindex... (cached) /usr/local/bin/makeindex
checking for perl... (cached) /usr/local/bin/perl
checking whether perl is perl 5... yes
checking for cc... (cached) cc
checking for underscore after Fortran symbols... configure: error: Nothing
worked - cannot use FORTRAN

setting SHLIBLD to f77 and SHLIBLDFLAGS="-shared" works.
(SHLIBLDFLAGS="-shared -expect_unresolved '*'" fails, f77 doesn't
understand this linker option, but no matter: it would only suppress some
warnings)
BTW, the value of SHLIBLDFLAGS specified in config.site gets never used:
it will be overwritten from the configure script with the host specific
versions of SHLIBLDFLAGS.
The same thing for SHLIBLD, this is hardcoded to "ld" in configure.in.
 
But I think there is no difference between
  SHLIBLD=ld
  SHLIBLDFLAGS="-shared -expect_unresolved '*'"
and
  SHLIBLD=f77
  SHLIBLDFLAGS="-shared"
because f77 also calls ld (ok, with the correct Fortran libraries,
libUfor.so, libFutil.so, libots.so). I guess this works because I link R
with LDCMD="f77 -nofor_main", so it already contains the symbols of the
Fortran libraries.

Albrecht
-------------------------------------------------------------------------------
Albrecht Gebhardt                   email   : albrecht.gebhardt@uni-klu.ac.at
Institut fuer Mathematik            Tel.    : (++43 463) 2700/837
Universitaet Klagenfurt             Fax     : (++43 463) 2700/834
Villacher Str. 161
A-9020 Klagenfurt, Austria
-------------------------------------------------------------------------------



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 12 17:32:38 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 12 Apr 1999 17:32:38 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
Message-ID: <199904121632.RAA11126@toucan.stats.ox.ac.uk>

>  From: Albrecht Gebhardt <albrecht.gebhardt@uni-klu.ac.at>

> But I think there is no difference between
>   SHLIBLD=ld
>   SHLIBLDFLAGS="-shared -expect_unresolved '*'"
> and
>   SHLIBLD=f77
>   SHLIBLDFLAGS="-shared"
> because f77 also calls ld (ok, with the correct Fortran libraries,
> libUfor.so, libFutil.so, libots.so). I guess this works because I link R
> with LDCMD="f77 -nofor_main", so it already contains the symbols of the
> Fortran libraries.

Thanks, it is the `ok, with the correct Fortran libraries' we are looking for
here.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Mon Apr 12 21:53:57 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 Apr 1999 08:53:57 +1200 (NZST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <37121447.77787569@bank-banque-canada.ca>
Message-ID: <Pine.BSF.3.96.990413083608.275D-100000@g.ihaka.slip.auckland.ac.nz>


On Mon, 12 Apr 1999, Paul Gilbert wrote:

> It seems to me that, at least for application packages, there is a strong
> incentive to avoid both fortran and C. If eventual R, or a new language like
> Omega, are to work in a "Java like" way across platforms, I think both fortran
> and C are problems. Is that not correct?

IMHO: Java is (currently) too slow for production numerical work and I
suspect that this will remain the case for some time.  Java gets around
this by providing a way of calling Fortran and C.

I once heard an informed opinion that it would hard to get a language like
S to perform within a factor of 10 of optimized C or Fortran.  Most of the
time we can live with a factor of 10, but sometimes ...

There is also the issue of the code base available in Fortran (and to a
lesser extent in C).  It's a resource which can't be ignored.
 
> I realize there is a performance issue, but I don't think it is as serious as it
> was in old versions of Splus. I am not sure how slow my time series library
> would be without the fortran. It used to be intolerable, but I have the
> impression it may not be too bad now.

For the most part, the numerical methods in S are implemented in Fortran
I think. So even if you don't see it, it's there.

> To some extent this must also apply to the core part of the language. Is there
> not some incentive to remove, not add, both fortran and C except where they are
> essential?

Actually, I quite like Fortran for expressing numerical computations (yes
I should probably keep my dirty habits to myself :-).  I'd prefer Algol60
but that's not really an option. I'd certainly like foreign language calls
to remain an option.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Mon Apr 12 23:41:12 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Mon, 12 Apr 1999 23:41:12 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.HPP.3.96.990412233602.25145B-100000@tiger.statslab.cam.ac.uk>


On 12 Apr 1999, Douglas Bates wrote:

> I would agree that:
>  - it is reasonable to increase the default vsize and nsize
>  - the default sizes should probably be architecture dependent
>  - If possible, the default sizes should also be picked up from
>    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
>    environment variables and use them
> 
> I think that 16M for vsize and 800k for nsize could be good global
> defaults on many architectures.

If the environment variables where used (best solution), wouldn't it be
better to tell people in the memory exhaustion at startup warning message
that this option existed.  Rather than defaulting to a potentially
wasteful use of memory. 


Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>  Tue Apr 13 00:02:21 1999
From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk> (Nicholas Lee)
Date: Tue, 13 Apr 1999 00:02:21 +0100 (BST)
Subject: Fortran vs C, easing using Fortran
In-Reply-To: <Pine.BSF.3.96.990413083608.275D-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <Pine.HPP.3.96.990412231928.25145A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Ross Ihaka wrote:

> On Mon, 12 Apr 1999, Paul Gilbert wrote:

> > Omega, are to work in a "Java like" way across platforms, I think both fortran
> > and C are problems. Is that not correct?
> 
> IMHO: Java is (currently) too slow for production numerical work and I
> suspect that this will remain the case for some time.  Java gets around
> this by providing a way of calling Fortran and C.

The addage I've seen seen concerning Java currently is, "Write Once, Test
Everywhere."  Quite a part from this, the language itself isn't completely
stable and (free) optimised compilers always lag language modifications.


 
> I once heard an informed opinion that it would hard to get a language like
> S to perform within a factor of 10 of optimized C or Fortran.  Most of the
> time we can live with a factor of 10, but sometimes ...

I thought that R compiler you where talking about, was a way to go? ;)

> > I realize there is a performance issue, but I don't think it is as serious as it
> > was in old versions of Splus. I am not sure how slow my time series library
> > would be without the fortran. It used to be intolerable, but I have the
> > impression it may not be too bad now.

The difference performance of computers and amounts of avaiable memory,
would make retrospective benchmarks trickly. 

 

Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 06:06:51 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 13 Apr 1999 06:06:51 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <Pine.HPP.3.96.990412233602.25145B-100000@tiger.statslab.cam.ac.uk>
Message-ID: <Pine.GSO.4.05.9904130604390.17276-100000@auk.stats>

On Mon, 12 Apr 1999, Nicholas Lee wrote:

> 
> On 12 Apr 1999, Douglas Bates wrote:
> 
> > I would agree that:
> >  - it is reasonable to increase the default vsize and nsize
> >  - the default sizes should probably be architecture dependent
> >  - If possible, the default sizes should also be picked up from
> >    ${HOME}/.Renviron.  For example, look for R_VSIZE and R_NSIZE
> >    environment variables and use them
> > 
> > I think that 16M for vsize and 800k for nsize could be good global
> > defaults on many architectures.
> 
> If the environment variables where used (best solution), wouldn't it be
> better to tell people in the memory exhaustion at startup warning message
> that this option existed.  Rather than defaulting to a potentially
> wasteful use of memory. 

Well, the flags exist now.  The `potentially wasteful' part is running out
of memory after a lot of work.  My comment is that at present the workspace
is less than half the total memory used: If you are going to use 10Mb
by default, why not use 15?


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 07:45:54 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 13 Apr 1999 07:45:54 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>

Based on the discussion so far, I have committed changes to 
`Version 0.64.0 Patched' that

  Uses R_NSIZE and R_VSIZE if set.

  Allows --nsize and --vsize to override these.

  Retains the previous minimum settings (200k and 2M) but if the user sets
  nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
  loaded.)

This is in system.unix.c, so Unix-only. (I see no reason not to so
this under Windows too, although there are other ways there).

The only snag I see is that there is no way to change this on an
installation-wide basis except to edit bin/R or include/Defn.h
and re-compile, but I guess that (especially the first) is safe enough.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 09:50:02 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 10:50:02 +0200
Subject: --nsize and --vsize
In-Reply-To: Prof Brian D Ripley's message of "Tue, 13 Apr 1999 07:45:54 +0100 (BST)"
References: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>
Message-ID: <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>

Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

>   Allows --nsize and --vsize to override these.
> 
>   Retains the previous minimum settings (200k and 2M) but if the user sets
>   nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
>   loaded.)
...
> The only snag I see is that there is no way to change this on an
> installation-wide basis except to edit bin/R or include/Defn.h
> and re-compile, but I guess that (especially the first) is safe enough.

Isn't that essentially the original purpose of using a shell script
(Win/Mac notwithstanding)? If we want it even easier, we could have
bin/R doing something like

...
$R_ENV=${R_ENV:-$RHOME/site/Renviron.sh}
[ -x $R_ENV ] && source $R_ENV
$R_NSIZE=${R_NSIZE:-250K}
...



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 13 11:02:10 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Tue, 13 Apr 1999 12:02:10 +0200
Subject: make check (PR#165)
Message-ID: <199904131002.MAA10093@blueberry.kubism.ku.dk>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Type: text/plain; charset=us-ascii

R 0.64.0 on RedHat Linux 5.1

I decided to add a "make check" command in the R RPM spec file
to ensure that R works properly before packaging it up.  I
found (by sabotaging one of the *.Rout.save files) that errors
found by "make check" are ignored and do not cause make to exit
abnormally. This means that there is no way for rpm to know that
the checks have failed, and the RPM package gets built anyway.

I changed this by removing the "-" flag in test-All, as in the
attached patch. I'm sure there was a reason the flag was there,
but it is a problem for me, so I'm submitting this as a bug
report.

Martyn


--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Disposition: attachment; filename="R-makecheck.patch"
Content-Transfer-Encoding: 7bit
Content-Description: R-makecheck.patch
Content-Type: text/plain;
 charset=us-ascii; name=R-makecheck.patch; SizeOnDisk=306

# Remove "ignore" flag from test-All so that
# build will fail if "make check" fails.
#
--- Makefile.in	Wed Jan  6 16:37:37 1999
+++ Makefile.in.patched	Tue Apr 13 11:00:42 1999
@@ -151,4 +151,4 @@
 
 check test:: test-All
 test-All test-Examples::
-	-@(cd tests && $(MAKE) $@)
+	@(cd tests && $(MAKE) $@)

--_=XFMail.1.3.p0.Linux:990413120342:8241=_--
End of MIME message

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 13 11:03:42 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Tue, 13 Apr 1999 12:03:42 +0200 (CEST)
Subject: make check
Message-ID: <XFMail.990413120342.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Type: text/plain; charset=us-ascii

R 0.64.0 on RedHat Linux 5.1

I decided to add a "make check" command in the R RPM spec file
to ensure that R works properly before packaging it up.  I
found (by sabotaging one of the *.Rout.save files) that errors
found by "make check" are ignored and do not cause make to exit
abnormally. This means that there is no way for rpm to know that
the checks have failed, and the RPM package gets built anyway.

I changed this by removing the "-" flag in test-All, as in the
attached patch. I'm sure there was a reason the flag was there,
but it is a problem for me, so I'm submitting this as a bug
report.

Martyn


--_=XFMail.1.3.p0.Linux:990413120342:8241=_
Content-Disposition: attachment; filename="R-makecheck.patch"
Content-Transfer-Encoding: 7bit
Content-Description: R-makecheck.patch
Content-Type: text/plain;
 charset=us-ascii; name=R-makecheck.patch; SizeOnDisk=306

# Remove "ignore" flag from test-All so that
# build will fail if "make check" fails.
#
--- Makefile.in	Wed Jan  6 16:37:37 1999
+++ Makefile.in.patched	Tue Apr 13 11:00:42 1999
@@ -151,4 +151,4 @@
 
 check test:: test-All
 test-All test-Examples::
-	-@(cd tests && $(MAKE) $@)
+	@(cd tests && $(MAKE) $@)

--_=XFMail.1.3.p0.Linux:990413120342:8241=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Tue Apr 13 11:14:26 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 Apr 1999 12:14:26 +0200 (CEST)
Subject: --nsize and --vsize
In-Reply-To: <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>
References: <Pine.GSO.4.05.9904130729001.2009-100000@auk.stats>
 <x2vhf0hpl1.fsf@blueberry.kubism.ku.dk>
Message-ID: <14099.6402.52677.10185@pc87.maho.magnaeu.com>

>>>>> Peter Dalgaard BSA writes:

> Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
>> Allows --nsize and --vsize to override these.
>> 
>> Retains the previous minimum settings (200k and 2M) but if the user sets
>> nothing uses 250K and 6M.  (Those just about allow MASS+lme to be
>> loaded.)
> ...
>> The only snag I see is that there is no way to change this on an
>> installation-wide basis except to edit bin/R or include/Defn.h
>> and re-compile, but I guess that (especially the first) is safe enough.

> Isn't that essentially the original purpose of using a shell script
> (Win/Mac notwithstanding)? If we want it even easier, we could have
> bin/R doing something like

> ...
> $R_ENV=${R_ENV:-$RHOME/site/Renviron.sh}
> [ -x $R_ENV ] && source $R_ENV
> $R_NSIZE=${R_NSIZE:-250K}
> ...

Something like that, similar to forthcoming R `rc' files (now profile):

	system rc from R_HOME/VERSION/...
	site rc from R_HOME/site/.../Rrc
	user rc from ./.Rrc or ~/.Rrc

	system environ from R_HOME/VERSION/...
	site environ from R_HOME/site/.../Renviron
	user environ from ./.Renviron or ~/.Renviron

Of course, then we'd need options

	--no-user-env
	--no-site-env

and I think I'd maybe want (for 1.0)

	--no-user-file => --no-user-rc
	--no-site-file => --no-site-rc

or (maybe better) keep what we have and interpret it as `files' so that
neither rc no env file would be used.

-k

Btw, I'd use `-r' ...

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Tue Apr 13 11:39:00 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Tue, 13 Apr 1999 11:39:00 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <Pine.GSO.4.05.9904130604390.17276-100000@auk.stats>
Message-ID: <Pine.HPP.3.96.990413112824.25549A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Prof Brian D Ripley wrote:

> Well, the flags exist now.  The `potentially wasteful' part is running out

The flags exist, but in the adage of the lazy programmer, "less
keystrokes, means less RSI/bugs."   One nice option would be for R to probe
the size of the .RData file, and rather than dieing on you if it's too
large, giving you option of loading it with XX extra memory.

> of memory after a lot of work.  My comment is that at present the workspace
> is less than half the total memory used: If you are going to use 10Mb
> by default, why not use 15?

This is always going to be the case since R uses a static memory heap.
So the question arises; if the default is 15, why not 20...? 


The best solution would be for system wide config flags or ENVIRONMENT
variables, as this would allow people to set a memory usage policy given
the amount of library functions they have, general memory usage patterns,
and personal inclinations. 


Nicholas 

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Tue Apr 13 11:53:36 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Tue, 13 Apr 1999 11:53:36 +0100 (BST)
Subject: --nsize and --vsize
Message-ID: <199904131053.LAA17041@toucan.stats.ox.ac.uk>


> Date: Tue, 13 Apr 1999 11:39:00 +0100 (BST)
> From: Nicholas Lee <N.J.Lee@statslab.cam.ac.uk>
> 
> On Tue, 13 Apr 1999, Prof Brian D Ripley wrote:
> 
> > Well, the flags exist now.  The `potentially wasteful' part is running out
> 
> The flags exist, but in the adage of the lazy programmer, "less
> keystrokes, means less RSI/bugs."   One nice option would be for R to probe
> the size of the .RData file, and rather than dieing on you if it's too
> large, giving you option of loading it with XX extra memory.

Fine. Please write the code to do this and submit it to us. (It would be
good to see your name in ?contributors.)

For the rest (why 15M?, best policy), please catch up with your reading
of R-devel.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From N.J.Lee@statslab.cam.ac.uk  Tue Apr 13 13:59:17 1999
From: N.J.Lee@statslab.cam.ac.uk (Nicholas Lee)
Date: Tue, 13 Apr 1999 13:59:17 +0100 (BST)
Subject: --nsize and --vsize
In-Reply-To: <199904131053.LAA17041@toucan.stats.ox.ac.uk>
Message-ID: <Pine.HPP.3.96.990413124738.25580A-100000@tiger.statslab.cam.ac.uk>


On Tue, 13 Apr 1999, Prof Brian Ripley wrote:

> > The flags exist, but in the adage of the lazy programmer, "less
> > keystrokes, means less RSI/bugs."   One nice option would be for R to probe


Here is a quick solution in the R.sh.in file: (Although it might be nicer
to do this via getenv("R_VSIZE") in the system.c) 

[ -f ${HOME}/.Renviron ] && . ${HOME}/.Renviron
[ "$R_VSIZE" != "" ] && ARG_STACK="$ARG_STACK --vsize $R_VSIZE"
[ "$R_NSIZE" != "" ] && ARG_STACK="$ARG_STACK --nsize $R_NSIZE"

exec ${RHOME}/bin/${RBINARY} $ARG_STACK "$@"


The only problem with this is:
-->8--
$ echo "R_VSIZE=20M" > ~/.Renviron  (or export R_VSIZE=20M)
$ R --vsize 4M
WARNING: invalid v(ector heap)size '4194304' ignored;using default = 20M

R : Copyright 1999, The R Development Core Team
[...]
> 
-->8--

I assume that --(v|n)size should override enviroment defaults?  

So we could fix that, by accepting the second --vsize option from $@,
instead of the first --vsize from the $ARG_STACK. 

That probably means some mickying around with: 

if(value < R_NSize || value > Max_Nsize) 
    REprintf("WARNING: ...
else
    R_NSize = value;


So what should the default action be?

> > the size of the .RData file, and rather than dieing on you if it's too
> > large, giving you option of loading it with XX extra memory.

Since InitMemory() is called before R_InitialData(), this might be
trickly.  Either involving some magic in the shell script wrapper or
pre-checking the size of the .RData file before calling InitMemory.


Nicholas

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 13 18:29:17 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Tue, 13 Apr 1999 19:29:17 +0200
Subject: outer fails with group generic operations on factors (PR#166)
Message-ID: <199904131729.TAA18570@biostat.ku.dk>

B <- A <- factor(c("a", "b"))
outer(A, B, "!=")
Warning: "FUN" not meaningful for factors
     [,1] [,2]
[1,]   NA   NA
[2,]   NA   NA

Now, this used to work in 0.63.2, but someone `improved' outer. There
it did an implicit as.numeric. The problem is that get in match.fun does
not understand group generics, and gets

Browse[1]> FUN
.Primitive("!=")

This _should_ launch Ops.factor, but does not.

> "!="(A, B)
[1] FALSE FALSE
> get("!=")(A, B)
Warning: "" not meaningful for factors
[1] NA NA



This causes misclass.tree(, detail=F) in package tree to fail.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.6
 arch = sparc
 os = solaris2.6
 system = sparc, solaris2.6
 status = 
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 8
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 19:03:01 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 20:03:01 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: ripley@stats.ox.ac.uk's message of "Tue, 13 Apr 1999 19:29:17 +0200"
References: <199904131729.TAA18570@biostat.ku.dk>
Message-ID: <x2g164gzze.fsf@blueberry.kubism.ku.dk>

ripley@stats.ox.ac.uk writes:

> Browse[1]> FUN
> .Primitive("!=")
> 
> This _should_ launch Ops.factor, but does not.
> 
> > "!="(A, B)
> [1] FALSE FALSE
> > get("!=")(A, B)
> Warning: "" not meaningful for factors
> [1] NA NA
> 

Actually, it *does* launch Ops.factor, but it gets confused by garbage
in .Generic. The bug is this line in DispatchGroup:

    sprintf(generic, "%s", CHAR(PRINTNAME(CAR(call))));

which presumably should rather look at the "op" arg. 

I'll have a closer look.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 13 19:42:38 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 13 Apr 1999 20:42:38 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: Peter Dalgaard BSA's message of "13 Apr 1999 20:03:01 +0200"
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk>
Message-ID: <x2btgsgy5d.fsf@blueberry.kubism.ku.dk>

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> Actually, it *does* launch Ops.factor, but it gets confused by garbage
> in .Generic. The bug is this line in DispatchGroup:
> 
>     sprintf(generic, "%s", CHAR(PRINTNAME(CAR(call))));
> 
> which presumably should rather look at the "op" arg. 
> 
> I'll have a closer look.

It *apparently* works to change the above line to:

 sprintf(generic, "%s", PRIMNAME(op));

"make check" completes (haven't checked the output yet), but can we
*really* be sure that "op" is a .Primitive at that point?

Anyone know better?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Tue Apr 13 21:51:52 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 Apr 1999 08:51:52 +1200 (NZST)
Subject: --nsize and --vsize
In-Reply-To: <199904131053.LAA17041@toucan.stats.ox.ac.uk>
Message-ID: <Pine.BSF.3.96.990414084552.244D-100000@g.ihaka.slip.auckland.ac.nz>


On Tue, 13 Apr 1999, Prof Brian Ripley wrote:

> Fine. Please write the code to do this and submit it to us. (It would be
> good to see your name in ?contributors.)

Egads, Another Aucklander!

Looks like we're singlehandedly curing the "small number of people in the
field" problem which John Chambers mentioned :-). 

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 14 07:31:01 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 Apr 1999 08:31:01 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: <x2g164gzze.fsf@blueberry.kubism.ku.dk> (message from Peter
 Dalgaard BSA on 13 Apr 1999 20:03:01 +0200)
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk>
Message-ID: <199904140631.IAA29602@sophie.ethz.ch>

Which reminds me of another long-standing  
UseMethod / NextMethod / Dispatch problem that I've never traced/solved..

Look at the  $RHOME/tests/mode-methods.R   file !
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 14 09:21:40 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 14 Apr 1999 10:21:40 +0200
Subject: outer fails with group generic operations on factors (PR#166)
In-Reply-To: Martin Maechler's message of "Wed, 14 Apr 1999 08:31:01 +0200"
References: <199904131729.TAA18570@biostat.ku.dk> <x2g164gzze.fsf@blueberry.kubism.ku.dk> <199904140631.IAA29602@sophie.ethz.ch>
Message-ID: <x27lrfa9yj.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> Which reminds me of another long-standing  
> UseMethod / NextMethod / Dispatch problem that I've never traced/solved..
> 
> Look at the  $RHOME/tests/mode-methods.R   file !

..i.e. this:
abc <- function(x, ...) {
    if (is.null(class(x))) class(x) <- data.class(x)
    UseMethod("abc")
}

will dispatch on the data class in S but not in R.

This puzzles me, because normally you can't mess with the arguments of
a generic function, in *either* language:

> cde<-function(x,...){x<-x*2;UseMethod("print")}
> cde(2)
[1] 2

So, either it's because class<- is non-duplicating in S, or S is doing
something *really* strange here. 

Hmm, then again: class<- *is* non-duplicating in R:

> x<-1
> y<-.Alias(x)
> class(x)<-'foo'
> y
[1] 1
attr(,"class")
[1] "foo"

I think this is related to evaluation of promises:

> f<-function(x)substitute(x)
> f(sin(1))
sin(1)
> f<-function(x){x;substitute(x)}
> f(sin(1))
sin(1)
> f<-function(x){class(x)<-'foo';substitute(x)}
> f(sin(1))
[1] 0.841471
attr(,"class")
[1] "foo"

Notice that just forcing evaluation of x does not destroy the link
between x and the argument expression, but changing its class does.
This is probably what shouldn't happen.

You can get the dispatching done by using

abc <- function(x, ...) {
    if (is.null(class(x))) {
	class(x) <- data.class(x)
	abc(x, ...)
    } else
        UseMethod("abc")
}

which (seemingly) works in both languages, at least as long as you
don't have to mess with sys.parent()

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Wed Apr 14 10:23:20 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Wed, 14 Apr 1999 11:23:20 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904140923.LAA25445@biostat.ku.dk>

       (opening new bug report thread, on suggestion of BDR ..)

I said on vaguely related topic:

 MM> There's  another long-standing  
 MM> UseMethod / NextMethod / Dispatch problem that I've never traced/solved..
 MM>  
 MM> Look at the  $RHOME/tests/mode-methods.R   file !

Peter Dalgaard already remarked :

 PD> ..i.e. this:

 PD> abc <- function(x, ...) {
 PD>     if (is.null(class(x))) class(x) <- data.class(x)
 PD>     UseMethod("abc")
 PD> }
 PD> 
 PD> will dispatch on the data class in S but not in R.
 PD> 
 PD> This puzzles me, because normally you can't mess with the arguments of
 PD> a generic function, in *either* language:
 PD> 
 PD> > cde<-function(x,...){x<-x*2;UseMethod("print")}
 PD> > cde(2)
 PD> [1] 2
 PD> 
 PD> So, either it's because class<- is non-duplicating in S, or S is doing
 PD> something *really* strange here. 
 PD> 
 PD> Hmm, then again: class<- *is* non-duplicating in R:
 PD> 
 PD> > x<-1
 PD> > y<-.Alias(x)
 PD> > class(x)<-'foo'
 PD> > y
 PD> [1] 1
 PD> attr(,"class")
 PD> [1] "foo"
 PD> 
 PD> I think this is related to evaluation of promises:
 PD> 
 PD> > f<-function(x)substitute(x)
 PD> > f(sin(1))
 PD> sin(1)
 PD> > f<-function(x){x;substitute(x)}
 PD> > f(sin(1))
 PD> sin(1)
 PD> > f<-function(x){class(x)<-'foo';substitute(x)}
 PD> > f(sin(1))
 PD> [1] 0.841471
 PD> attr(,"class")
 PD> [1] "foo"
 PD> 
 PD> Notice that just forcing evaluation of x does not destroy the link
 PD> between x and the argument expression, but changing its class does.
 PD> This is probably what shouldn't happen.
 PD> 
 PD> You can get the dispatching done by using
 PD> 
 PD> abc <- function(x, ...) {
 PD>     if (is.null(class(x))) {
 PD> 	class(x) <- data.class(x)
 PD> 	abc(x, ...)
 PD>     } else
 PD>         UseMethod("abc")
 PD> }
 PD> 
 PD> which (seemingly) works in both languages, at least as long as you
 PD> don't have to mess with sys.parent()

So we don't know if this is a bug in R.
However, R is behaving inexpectedly to ``Joe Average-User''
and at least we should know if (and why)
we want to be different than S here.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 14 15:29:54 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 14 Apr 1999 10:29:54 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <199904140923.LAA25445@biostat.ku.dk>
Message-ID: <Pine.SV4.4.05.9904141016170.18981-100000@hsph.harvard.edu>


I'm pretty sure we've been through this one several times already,
although probably in different guises.
The discussion in the white book, section A.6 is rather specific about
this. And as near as I can tell is contrary to what S does. I don't think
that you want to do what S does.

Do you really want to have a language that accepts any change in x?
It is rather hard to see how it's object oriented then!
Or, alternatively do you really want to see if the only thing that
has changed about x is its class and that will be ok?
What about the other arguments?
The whole point of UseMethod is that we got an object x, with a
particular class and now we're going to do the right thing.
If you wanted to do the right thing with an object of a different
class then you need to do that before you call UseMethod.

Basically, one of the differences between UseMethod and NextMethod is
that with the first you don't get to change anything in the body of
the function, or at least, if you do then it will be ignored. If you
want to change things, do so and then call the generic.

UseMethod believes that the x in the call was evaluated and will
use that value in the call to the method.
NextMethod looks in the local environment for an x, uses one if it
finds one (otherwise gets the x in the call).
Semantically different, well documented and if Joe User doesn't
understand it's because S doesn't do what it says it does and
people write bad code (but generally not as bad as mine ;-).


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 14 17:00:19 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 14 Apr 1999 12:00:19 -0400 (EDT)
Subject: options
In-Reply-To: <6rlnfxly82.fsf@verdi.stat.wisc.edu>
Message-ID: <Pine.SV4.4.05.9904141155440.5911-100000@hsph.harvard.edu>


 Do we have a policy on checking for valid options?

In working on the warning system I tried to get S to
give a warning. So I went:

 options(object.size= -9)

 but it didn't, it exited in a rather confused state.

Is it the responsibility of the function retrieving the
option to set the value to something sensible. The user
can set them to any old thing but we will just use the
default (regardless of the state of options). Or do we
actively try to maintain the options in a "reliable state"?

As near as I can tell we currently do the former (some of the
time).



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 14 23:17:11 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 00:17:11 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Robert Gentleman's message of "Wed, 14 Apr 1999 10:29:54 -0400 (EDT)"
References: <Pine.SV4.4.05.9904141016170.18981-100000@hsph.harvard.edu>
Message-ID: <x2ogkqlue0.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

> Do you really want to have a language that accepts any change in x?
> It is rather hard to see how it's object oriented then!
> Or, alternatively do you really want to see if the only thing that
> has changed about x is its class and that will be ok?
> What about the other arguments?
> The whole point of UseMethod is that we got an object x, with a
> particular class and now we're going to do the right thing.
> If you wanted to do the right thing with an object of a different
> class then you need to do that before you call UseMethod.

I'm inclined to agree here. On the other hand, what might be the case
is that you could make class<- be a little more careful with its
argument so that UseMethod would see the modified x. Sneaky, but
compatible, and *perhaps* not very hard to do. How often is this kind
of construct (class(x)<-foo;UseMethod()) used in actual S code?

> Semantically different, well documented and if Joe User doesn't
> understand it's because S doesn't do what it says it does and
> people write bad code (but generally not as bad as mine ;-).

- and Joe User generally gets in trouble with methods anyway...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Wed Apr 14 23:37:26 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 15 Apr 1999 00:37:26 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904142237.AAA25670@biostat.ku.dk>

On 15 Apr 1999, Peter Dalgaard BSA wrote:

> Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> 
> > Do you really want to have a language that accepts any change in x?
> > It is rather hard to see how it's object oriented then!
> > Or, alternatively do you really want to see if the only thing that
> > has changed about x is its class and that will be ok?
> > What about the other arguments?
> > The whole point of UseMethod is that we got an object x, with a
> > particular class and now we're going to do the right thing.
> > If you wanted to do the right thing with an object of a different
> > class then you need to do that before you call UseMethod.
> 
> I'm inclined to agree here. On the other hand, what might be the case
> is that you could make class<- be a little more careful with its
> argument so that UseMethod would see the modified x. Sneaky, but
> compatible, and *perhaps* not very hard to do. How often is this kind
> of construct (class(x)<-foo;UseMethod()) used in actual S code?

Often by certain people with a massive presence!

We have indeed been here before.  In our lda function we do

class(x) <- data.class(x)
UseMethod("lda")

That fails to use the new class in R, and according to `your' reading of
the White book (but not mine nor apparently the author of S's) should do
so. `You' suggested

   UseMethod("lda", x, ...)

which works in some versions of S-PLUS 3.x but crashes the DEC Alpha
version and works on no version of S-PLUS 5.x. Hence I have

lda <- function(x, ...)
{
   if(is.null(class(x))) class(x) <- data.class(x)
#ifdef R
   UseMethod("lda", x, ...)
#ifdef SP3
   UseMethod("lda")
}

and in SP5 I do something with new-style classes.

> - and Joe User generally gets in trouble with methods anyway...

and not just Joe User....

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 15 07:39:49 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 15 Apr 1999 08:39:49 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904150639.IAA26078@biostat.ku.dk>

On Wed, 14 Apr 1999, Robert Gentleman wrote:

> On Wed, 14 Apr 1999, Prof Brian D Ripley wrote:
> 
> > On 15 Apr 1999, Peter Dalgaard BSA wrote:
> > 
> > > Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> > > 
> > > > Do you really want to have a language that accepts any change in x?
> > > > It is rather hard to see how it's object oriented then!
> > > > Or, alternatively do you really want to see if the only thing that
> > > > has changed about x is its class and that will be ok?
> > > > What about the other arguments?
> > > > The whole point of UseMethod is that we got an object x, with a
> > > > particular class and now we're going to do the right thing.
> > > > If you wanted to do the right thing with an object of a different
> > > > class then you need to do that before you call UseMethod.
> > > 
> > > I'm inclined to agree here. On the other hand, what might be the case
> > > is that you could make class<- be a little more careful with its
> > > argument so that UseMethod would see the modified x. Sneaky, but
> > > compatible, and *perhaps* not very hard to do. How often is this kind
> > > of construct (class(x)<-foo;UseMethod()) used in actual S code?
> > 
> > Often by certain people with a massive presence!
> > 
> > We have indeed been here before.  In our lda function we do
> > 
> > class(x) <- data.class(x)
> > UseMethod("lda")
> > 
> > That fails to use the new class in R, and according to `your' reading of
> > the White book (but not mine nor apparently the author of S's) should do
> > so. `You' suggested
> 
>  If you could point out the error of my ways I would appreciate it.

I did not mean to imply that you were wrong, rather that the White Book
can be read both ways (and it seems has been).

> But, it as I understand it, UseMethod is supposed to call the method
> with the arguments the same as those that called the generic. You
> must evaluate x to figure out what method to call, but I don't see
> how you can change x (adding classes is changing it).

Then why are

UseMethod("foo")
UseMethod("foo", x)

different in R? (They are: lda works.) The actual definition of UseMethod
in S is

       UseMethod(generic, object, ...)

and by the standard evaluation model, `object' is subject to lazy
evaluation. Nothing I can see in the White Book says otherwise. Indeed,
page 467 says the arguments are `re-matched by the standard rules'. It then
says `The method will see argument matches as it would if the user's call
had been directly to the method'.  I think those claims are contradictory,
and in particular whichever way they are read suggest my pair of calls
should be the same.

[In S UseMethod("foo") is semantic shorthand for UseMethod("foo", <name of
first argument of caller>), according to the help page.]

To make matters worse, in S it is a common mistake to have

foo <- function(x, ...) UseMethod("foo")
foo.lm <- function(y, ...) { .... }

and that change of name of argument causes re-evaluation.  What happens in
R?  This makes an apparently small point, that generics should have the
same argument name as S, potentially rather important. I know of four
outstanding discrepancies:

R: deviance <- function (x, ...) UseMethod("deviance")
S: deviance <- function (x, ...) UseMethod("deviance")

and ditto for coef, fitted, residuals (which I had not realized, in part
because some of these only recently acquited defaults).

There are inconsistencies in the current R code: any objections if
I change these to uniformly follow S and use `object'?


The other common one is `print'. As in

> print
function (x, ...) 
UseMethod("print")
> print.socket
function (socket) 
{
    cat("Socket connection #", socket$socket, "to", socket$host, 
        "on port", socket$port, "\n")
}

print methods should have first argument x, a ... argument _and_ return
invisible(x) for an unchanged x (in S, at least).  print.plot
does not even have an argument, so how does that ever work?

>   I realize it is frustrating and if you think it's important
> you should change it. But, by doing that you move the language
> further away from being object oriented. 

What we do need is to get this documented!  In particular, in R

> ?UseMethod

Class Methods

     UseMethod(name)

is incomplete, and I only know about UseMethod("foo", x, ...) because
`you' (Kurt?) suggested I use it. 

BTW, I have never believed S3's claim to be `object-oriented': it has a
class-based dispatcher. S has changed (although it remains to be seen if
users will follow) and I would be happy for R to be different from both.
However, as Bill and I are currently trying to write about this for V&R3v2,
I would not like R to change dramatically after the next few months!


Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 14:37:16 1999
From: rgentlem@hsph.harvard.edu (rgentlem@hsph.harvard.edu)
Date: Thu, 15 Apr 1999 15:37:16 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904151337.PAA00928@biostat.ku.dk>


I've done some editing to get things together (hopefully without
changing the semantics)

On Thu, 15 Apr 1999, Prof Brian D Ripley wrote:

> On Wed, 14 Apr 1999, Robert Gentleman wrote:
> 
> > On Wed, 14 Apr 1999, Prof Brian D Ripley wrote:
> > 
> > > On 15 Apr 1999, Peter Dalgaard BSA wrote:
> > > 
> > > > Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> > > > 
> 
> I did not mean to imply that you were wrong, rather that the White Book
> can be read both ways (and it seems has been).
> 
> > But, it as I understand it, UseMethod is supposed to call the method
> > with the arguments the same as those that called the generic. You
> > must evaluate x to figure out what method to call, but I don't see
> > how you can change x (adding classes is changing it).
> 
> Then why are
> 
> UseMethod("foo")
> UseMethod("foo", x)
> different
> 
> 
> and by the standard evaluation model, `object' is subject to lazy
> evaluation. Nothing I can see in the White Book says otherwise. Indeed,
> page 467 says the arguments are `re-matched by the standard rules'. It then
> says `The method will see argument matches as it would if the user's call
> had been directly to the method'.  I think those claims are contradictory,
> and in particular whichever way they are read suggest my pair of calls
> should be the same.
> 
> [In S UseMethod("foo") is semantic shorthand for UseMethod("foo", <name of
> first argument of caller>), according to the help page.]
> 

  Now, with my reading, the method will see the argument as it would
if the users call had been directly to the the method, coupled with
the later comment (top of p. 469) that for NextMethod you must take local
bindings for the arguments, yields
   with UseMethod you don't take local bindings, the method gets what
the generic did, but it will rematch (argument names and positions
may have changed). That means you need to ignore what happened
inside of the generic.

  Now, we have the variable definition problem raise it's head,
  UseMethod("foo")
  UseMethod("foo",x)
  If the second version doesn't use the local binding of x then
 UseMethod behaves differently, in terms of how it treats its arguments
 than every other function (which is ok, we just need to be specific
 about it).
  So we have to make a decision, UseMethod does what S does (which is
 fine) or it doesn't.

> To make matters worse, in S it is a common mistake to have
> 
> foo <- function(x, ...) UseMethod("foo")
> foo.lm <- function(y, ...) { .... }
> 
> and that change of name of argument causes re-evaluation.  What happens in
> R?  
  The standard argument matching system takes over. If there was an
argument y=blah, in the ... then it will get matched to y in foo.lm
even though something different was matched to x in the call to the 
generic. I don't believe that a reevaluation takes place in either 
situation. If x was evaluated and that is what is matched then we
look in the value side of the expression, see that it's there and
carry on. If we match to something new then the standard rules take
over.
  Promises are basically cells with three slots, an unevaluated
expression, an environment in which to carry out the evaluation
of that expression and a value. When we want a value, we look in
the value slot first, if there is no value, we evaluate the
expression and stick the value into the value slot. So promises
should never be evaluated twice.

 For those not bored, here is a difference between R and S that 
we may not want.
bar<-function(w,...) {
    UseMethod("bar")
  }
 bar.foo<-function(y, w) print(w)
x<-30
class(x)<-"foo"

Now in R,
> bar(x,10)
[1] 10
> bar(x,y=10)
[1] 30
attr(,"class")
[1] "foo"

Notice that if the arguments are not named we use default matching and
that the symbolic name for the first argument in the generic is not
carried over.

In S bar(x,10) and bar(x,y=10) both evaluate to the same thing,
[1] 30
attr(,"class")
[1] "foo"
it appears that the name w has been applied to the first argument and
that is carried with it for subsequent evaluations.

  I'm not sure what you meant by "the change of name causes reevaluation,
when I try
> bar(x<-x+1)
I get,
[1] 31
attr(, "class"):
[1] "foo"
[1] 31
attr(, "class"):
[1] "foo"
  which is only one evaluation (and the same in R)

> This makes an apparently small point, that generics should have the
> same argument name as S, potentially rather important. I know of four
> outstanding discrepancies:
> 
> R: deviance <- function (x, ...) UseMethod("deviance")
> S: deviance <- function (x, ...) UseMethod("deviance")
> 
> and ditto for coef, fitted, residuals (which I had not realized, in part
> because some of these only recently acquited defaults).
> 
> There are inconsistencies in the current R code: any objections if
> I change these to uniformly follow S and use `object'?

  Change to your hearts content. I think we want something that works
and that makes sense.
> What we do need is to get this documented!  In particular, in R
> 
> > ?UseMethod
> 
> Class Methods
> 
>      UseMethod(name)
> 


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr 15 15:25:07 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 15 Apr 1999 10:25:07 -0400
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
References: <199904151337.PAA00928@biostat.ku.dk>
Message-ID: <3715F6C2.81A6B0F8@bank-banque-canada.ca>

> To make matters worse, in S it is a common mistake to have
> foo <- function(x, ...) UseMethod("foo")
> foo.lm <- function(y, ...) { .... }

I've tried very hard not to do this, but it sure would be nice to have a good
automatic way to check it. Any suggestions?

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Thu Apr 15 17:07:39 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Fri, 16 Apr 1999 01:37:39 +0930 (CST)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <199904151337.PAA00928@biostat.ku.dk>
References: <199904151337.PAA00928@biostat.ku.dk>
Message-ID: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>

Blundering late into this discussion I'm going to take a chance
here and venture an opinion on what does happen in S3 UseMethod,
regardless of what interpretations are made of A.6 in the white
book.  This is by the "suck it and see" method, the only one I
trust.  (The chance I take is in supposing this to be useful...)

1. At the time of the UseMethod call the principal argument is
   examined, and evaluated if necessary, and the class it has at
   that stage is the one used for method dispatch.

2. All non-missing arguments are passed on to the method with the
   values they were supplied with at the time of the original
   call, not the changed values they may have at the time of
   dispatch, (including the principal argument).

3. Missing arguments that have been given values at the time of
   method dispatch, as well as local variables, retain their
   current values when control passes to the method.

4. Supplying a second argument to UseMethod() allows some other
   argument than the first to act as the principal argument.

5. Default values for arguments in the method supercede defaults
   supplied in the generic.

The method directly occupies the frame of the generic, but
arguments actually supplied to the generic re-assume their
original supplied values (even though changes to the principal
argument prior to method dispatch may determine mathod dispatch.)

So, for example, if the principal argument is not missing, has no
class at the call and is given class "xyz" by the generic, the
"xyz" method is dispatched, but the object corresponding to the
principal argument inside the method is the original classless
object.  (I would have thought that this was the major reason to
have a function like data.class in the first place.  What other
serious use does it have?)  To verify *from within the method*
that the principal argument had the class implied by the method,
you have to inspect the .Class guaranteed variable, not the
current class of the principal argument itself, which may be
wildly at variance.

"Missing" arguments on the original call remain missing unless
the generic has given them values prior to method dispatch, in
which case they behave like local variables and retain their
local supplied values.  If defaults are needed, the most recent
one is used.

Now, how does R differ?

Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 17:38:27 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 12:38:27 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <Pine.SV4.4.05.9904151213320.1352-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Bill Venables wrote:

> Blundering late into this discussion I'm going to take a chance
> here and venture an opinion on what does happen in S3 UseMethod,
> regardless of what interpretations are made of A.6 in the white
> book.  This is by the "suck it and see" method, the only one I
> trust.  (The chance I take is in supposing this to be useful...)
> 
> 1. At the time of the UseMethod call the principal argument is
>    examined, and evaluated if necessary, and the class it has at
>    that stage is the one used for method dispatch.
> 
> 2. All non-missing arguments are passed on to the method with the
>    values they were supplied with at the time of the original
>    call, not the changed values they may have at the time of
>    dispatch, (including the principal argument).
> 
> 3. Missing arguments that have been given values at the time of
>    method dispatch, as well as local variables, retain their
>    current values when control passes to the method.
> 
> 4. Supplying a second argument to UseMethod() allows some other
>    argument than the first to act as the principal argument.
> 
> 5. Default values for arguments in the method supercede defaults
>    supplied in the generic.
> 
> The method directly occupies the frame of the generic, but
> arguments actually supplied to the generic re-assume their
> original supplied values (even though changes to the principal
> argument prior to method dispatch may determine mathod dispatch.)

  I don't think that's what S does. My experiments suggest that S
takes the current value of the principal argument regardless of
what was passed in. I asked JMC and if I understood him then that's
what is being done.
  As for other arguments, well it seems to pick things up at the point
that UseMethod is called from.
  For example,
  bar<-function(w, y, ...)
{
        y <- 12
        w <- 3
        UseMethod("bar")
}
  bar.default<-function(y, w) {
     print(w)
     print(y)
  }

  x<-30
  bar(x)

  yields:
[1] 3
[1] 12
[1] 12

  So, x was changed, y (even though missing from the original call
 now exists) and the names given to the arguments in the call to
 the generic have been used to match in the call to the method.

 In R, (0.65)
 I get 
  > Error: Argument "w" is missing, with no default.


 One small change (and back to S) 
  bar<- function(w, v, ...)
{
        y <- 12
        w <- 3
        UseMethod("bar")
}

  Now, for bar(x,20) I still get,
[1] 3
[1] 12
[1] 12
 
  I don't think that's what you want. But my guess as to the semantics
is the following.
  When UseMethod is called the generic is determined by the class
of the principal argument at that point. That method is grabbed
and it's arguments are matched using the frame of the currently
executing method (not the arguments in the call to the currently 
active method). Then that method is evaluated using a new frame,
but the bindings achieved from the match. 

We can do this; but do we want to? There is something particularly
unsettling about the method matching args from the currently active frame
rather than from the call to the generic.

  I'm working with:
S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
S : Copyright AT&T.
Version 3.4 Release 1 for Sun SPARC, SunOS 5.3 : 1996 

> 
> So, for example, if the principal argument is not missing, has no
> class at the call and is given class "xyz" by the generic, the
> "xyz" method is dispatched, but the object corresponding to the
> principal argument inside the method is the original classless
> object.  (I would have thought that this was the major reason to
> have a function like data.class in the first place.  What other
> serious use does it have?)  To verify *from within the method*
> that the principal argument had the class implied by the method,
> you have to inspect the .Class guaranteed variable, not the
> current class of the principal argument itself, which may be
> wildly at variance.
> 
> "Missing" arguments on the original call remain missing unless
> the generic has given them values prior to method dispatch, in
> which case they behave like local variables and retain their
> local supplied values.  If defaults are needed, the most recent
> one is used.
> 
> Now, how does R differ?
> 
> Bill Venables.
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 18:00:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 19:00:14 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Bill Venables's message of "Fri, 16 Apr 1999 01:37:39 +0930 (CST)"
References: <199904151337.PAA00928@biostat.ku.dk> <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <x2aew9g6ox.fsf@blueberry.kubism.ku.dk>

Bill Venables <wvenable@arcola.stats.adelaide.edu.au> writes:

> Blundering late into this discussion I'm going to take a chance
> here and venture an opinion on what does happen in S3 UseMethod,
> regardless of what interpretations are made of A.6 in the white
> book.  This is by the "suck it and see" method, the only one I
> trust.  (The chance I take is in supposing this to be useful...)
> 
> 1. At the time of the UseMethod call the principal argument is
>    examined, and evaluated if necessary, and the class it has at
>    that stage is the one used for method dispatch.
> 
> 2. All non-missing arguments are passed on to the method with the
>    values they were supplied with at the time of the original
>    call, not the changed values they may have at the time of
>    dispatch, (including the principal argument).
> 
> 3. Missing arguments that have been given values at the time of
>    method dispatch, as well as local variables, retain their
>    current values when control passes to the method.
> 
> 4. Supplying a second argument to UseMethod() allows some other
>    argument than the first to act as the principal argument.
> 
> 5. Default values for arguments in the method supercede defaults
>    supplied in the generic.
> 
> The method directly occupies the frame of the generic, but
> arguments actually supplied to the generic re-assume their
> original supplied values (even though changes to the principal
> argument prior to method dispatch may determine mathod dispatch.)

Erm, does that cover this case?:

>  f<-function(x){x<-2;print(substitute(x));UseMethod("print")}  
> f(4)
[1] 2
[1] 4
> f((4))
(4)
[1] 2

(It may, I'm just too tired to see it...)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 21:32:28 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 16:32:28 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <x2aew9g6ox.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904151628020.16888-100000@hsph.harvard.edu>



On 15 Apr 1999, Peter Dalgaard BSA wrote:

> Erm, does that cover this case?:
> 
> >  f<-function(x){x<-2;print(substitute(x));UseMethod("print")}  
> > f(4)
> [1] 2
> [1] 4
> > f((4))
> (4)
> [1] 2
> 
> (It may, I'm just too tired to see it...)

  Wow! That's peculiar. 
  R does the rather boring

> f<-function(x){x<-2;print(substitute(x));UseMethod("print")}
> f(4)
[1] 2
[1] 4
> f((4))
[1] 2
[1] 4

  Does that mean that our implementaion of substitute is not quite
right? The documentation suggests that you get the expression typed as
the value of a formal argument; right now we're getting the current
value.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 22:50:21 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Thu, 15 Apr 1999 23:50:21 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
Message-ID: <199904152150.XAA01121@biostat.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>   Does that mean that our implementaion of substitute is not quite
> right? The documentation suggests that you get the expression typed as
> the value of a formal argument; right now we're getting the current
> value.

No. It means that S's implementation is quite wrong...

R's substitute works by fairly clean rules of (lazy) evaluation: If
you pass it a an expression containing x and x is a PROMSXP, you get
the argument expression. If you change x before the substitute, you get
the current value (unless you used x<-delay(something), in which case
you get the unevaluated something). 

S does --- something else:

> f<-function(x){x<-2;substitute(x)}
> f(5)
[1] 2
> y<-5     
> f(y)
y

This, I *really* don't think we want to emulate.

The documentation is badly off, though... and the quote() doc is
really off target. (I've written about this before, but it never found
its way to the help page, obviously).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 22:50:07 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 15 Apr 1999 23:50:07 +0200
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: Robert Gentleman's message of "Thu, 15 Apr 1999 16:32:28 -0400 (EDT)"
References: <Pine.SV4.4.05.9904151628020.16888-100000@hsph.harvard.edu>
Message-ID: <x2zp49d04w.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>   Does that mean that our implementaion of substitute is not quite
> right? The documentation suggests that you get the expression typed as
> the value of a formal argument; right now we're getting the current
> value.

No. It means that S's implementation is quite wrong...

R's substitute works by fairly clean rules of (lazy) evaluation: If
you pass it a an expression containing x and x is a PROMSXP, you get
the argument expression. If you change x before the substitute, you get
the current value (unless you used x<-delay(something), in which case
you get the unevaluated something). 

S does --- something else:

> f<-function(x){x<-2;substitute(x)}
> f(5)
[1] 2
> y<-5     
> f(y)
y

This, I *really* don't think we want to emulate.

The documentation is badly off, though... and the quote() doc is
really off target. (I've written about this before, but it never found
its way to the help page, obviously).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 15 23:17:16 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 15 Apr 1999 18:17:16 -0400 (EDT)
Subject: debug
In-Reply-To: <199904131002.MAA10093@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904151806220.21765-100000@hsph.harvard.edu>

I've just committed a fix for debugging functions that do not have
{'s around the body (funs with one line basically). Let me know if you
have problems. 

(all my stuff is going in 0.65 and I'll try to migrate it over once
I think it's ok)


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 15 23:28:31 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 16 Apr 1999 00:28:31 +0200
Subject: debug
In-Reply-To: Robert Gentleman's message of "Thu, 15 Apr 1999 18:17:16 -0400 (EDT)"
References: <Pine.SV4.4.05.9904151806220.21765-100000@hsph.harvard.edu>
Message-ID: <x2wvzdcycw.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

> I've just committed a fix for debugging functions that do not have
> {'s around the body (funs with one line basically). Let me know if you
> have problems. 

One thing:

example(esoph)

is bailing out in a glm() call, and of course make check does too.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Fri Apr 16 07:20:54 1999
From: wvenable@arcola.stats.adelaide.edu.au (Bill Venables)
Date: Fri, 16 Apr 1999 15:50:54 +0930 (CST)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
References: <199904151337.PAA00928@biostat.ku.dk>
 <14102.3787.848394.976662@arcola.stats.adelaide.edu.au>
Message-ID: <14102.54983.17904.253771@arcola.stats.adelaide.edu.au>

Well, I have to admit that I have egg all over my face this
time, and if you don't want to have the long-winded justification
I suggest you pass to your next email...

--

In my defence I was misled by what can only be called an S3 bug,
now probably unfixable since some code probably depends on it.
Here is the most succinct expression of it I can devise:

S3:

foo <- function(x) {
  class(x) <- "bar"
  x <- x - 1
  UseMethod("foo")
}
foo.bar <- function(x) invisible(print(x))


Now with one kind of actual argument method dispatch occurs, but
he *original* value is passed on:

> foo(10)
[1] 10

but with any other kind the *modified* value is passed:

> fred <- 10
> foo(fred)
[1] 9
attr(, "class"):
[1] "bar"

and most egregiously:

> foo((10))
[1] 9
attr(, "class"):
[1] "bar"



On the other hand in S4 this anomaly is at least fixed.

S4 (using backward compatibility):

foo <- function(x) {
  oldClass(x) <- "bar"
  x <- x - 1
  UseMethod("foo")
}
foo.bar <- function(x) invisible(print(x))

> foo(10)
[1] 9
attr(, "class"):
[1] "bar"
> foo((10))
[1] 9
attr(, "class"):
[1] "bar"

There are other differences with S3, though.  For example, local
variables generated in the frame of the generic *are* passed to
the method in S3, but *are not* passed to the method in S4.

What a mess!

One clear moral seems to be don't do anything more inside a
generic function than you really need to do.  Keep it *very*
simple indeed.


I'm grateful to you guys for bringing up this matter right now,
but I'm sorry to be working it all out in front of you like this!

Bill Venables.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr 16 13:05:15 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 16 Apr 1999 14:05:15 +0200
Subject: Segfault from evalq(return()) (PR#168)
Message-ID: <199904161205.OAA01677@biostat.ku.dk>

Luke Tierney brought this up while we were discussing the semantics of
a possible let() or local() call:

> evalq(return())
Segmentation fault (core dumped)

This is not just caused by trying to pop an empty stack:

> f<-function(x)evalq(return())
> f(2)
Segmentation fault (core dumped)


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Fri Apr 16 13:10:41 1999
From: p.dalgaard@biostat.ku.dk (p.dalgaard@biostat.ku.dk)
Date: Fri, 16 Apr 1999 14:10:41 +0200
Subject: deparse drops () sometimes (PR#169)
Message-ID: <199904161210.OAA01687@biostat.ku.dk>

Shortest example is this:

> function()(g)()
function () 
(g)

It executes OK, but editing a function with one of these in will
introduce an error in an uexpected place.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 16 14:04:30 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 16 Apr 1999 09:04:30 -0400 (EDT)
Subject: R's UseMethod() does not dispatch on changed class() (PR#167)
In-Reply-To: <14102.54983.17904.253771@arcola.stats.adelaide.edu.au>
Message-ID: <Pine.SV4.4.05.9904160858520.25362-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Bill Venables wrote:

> Well, I have to admit that I have egg all over my face this
> time, and if you don't want to have the long-winded justification
> I suggest you pass to your next email...
> 
> --
> 
> In my defence I was misled by what can only be called an S3 bug,
> now probably unfixable since some code probably depends on it.

  Great examples. I am coming to understand the S3 model. Now,
 does anyone want to say what we want? Brian, you probably use this
 stuff more than most. Do you want to say what you want and I'll
 see what can be done to duplicate it. Anyone else that wants to
 chime in?

> 
> 
> One clear moral seems to be don't do anything more inside a
> generic function than you really need to do.  Keep it *very*
> simple indeed.
> 
   I recall JMC saying something like, all generic functions
 should be one line long; a call to the appropriate UseMethod.

   My own belief in this regard is that once you start down the
  OO road the object is immutable (otherwise what is the point?).
  Unfortunately the flexibility of S-like languages makes this
  impossible to enforce. There is also the issue of when do you 
  "start down the OO road", I always felt it was with the call
  to the generic but perhaps it's with the call to UseMethod.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr 16 17:22:01 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 16 Apr 1999 12:22:01 -0400
Subject: NextMethod
Message-ID: <371763A9.D2FF89C6@bank-banque-canada.ca>

>> One clear moral seems to be don't do anything more inside a
>> generic function than you really need to do.  Keep it *very*
>> simple indeed.
>>
>  I recall JMC saying something like, all generic functions
> should be one line long; a call to the appropriate UseMethod.

It certainly is encouraging to know that others also have been confused by
aspects of UseMethod. I've mostly kept my generic functions to one lined based
on the "keep it simple, stupid" principle. It's nice to have more impressive
references.

The "if it's not broken don't fix it" principle makes me reluctant to consider
the following, but...

In cleaning up parts of my library I realized that many of my old summary
methods actually print things instead of returning an object for a print method.
Some of these use NextMethod, and I've always been even more confused by
NextMethod than by UseMethod. Is the following a good model of how this should
be done:

summary.level1.level2 <- function(object)
{ r <- list("level2 before")
  r <- append(r,NextMethod("summary"))
  r <- append(r,"level2 after")
  class(r) <- "summary.level1.level2"
  r
}

print.summary.level1.level2 <- function(x)
 { cat(x[[1]])
   print(x[[2]])
   cat(x[[3]])
   invisible(x)
 }


z <- 1:3
class(z) <- c("level1.level2", "level1")
summary(z)

TIA
Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 16 17:50:53 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 16 Apr 1999 12:50:53 -0400 (EDT)
Subject: NextMethod
In-Reply-To: <371763A9.D2FF89C6@bank-banque-canada.ca>
Message-ID: <Pine.SV4.4.05.9904161235440.795-100000@hsph.harvard.edu>



On Fri, 16 Apr 1999, Paul Gilbert wrote:

> In cleaning up parts of my library I realized that many of my old summary
> methods actually print things instead of returning an object for a print method.
> Some of these use NextMethod, and I've always been even more confused by
> NextMethod than by UseMethod. Is the following a good model of how this should
> be done:
> 
> summary.level1.level2 <- function(object)
> { r <- list("level2 before")
>   r <- append(r,NextMethod("summary"))
>   r <- append(r,"level2 after")
>   class(r) <- "summary.level1.level2"
>   r
> }
> 
> print.summary.level1.level2 <- function(x)
>  { cat(x[[1]])
>    print(x[[2]])
>    cat(x[[3]])
>    invisible(x)
>  }
> 
> 
> z <- 1:3
> class(z) <- c("level1.level2", "level1")
> summary(z)
> 
   You haven't really said what you want to do in enough detail for
me to give you an answer.
   If an object has several class attributes then NextMethod is
a way to move down the heirarchy. While it is much more general
almost every use is of the form that you used in summary.level1.level2;
first do some preprocessing, second call the default, do some post
processing and return. One big difference between NextMethod and UseMethod
is that UseMethod does not return (so putting stuff after it is
pointless).
   You can put any class you want on the return value. If you
want to have objects of class, summary.level1.level2, that's fine.
But if you want to have objects of class Tsobj.summary (returned
by all sorts of functions, but filtered through a single print)
then you can do that as well.
   I don't see the point of, class(z) <- c("level1.level2", "level1"),
in my R, since I don't have a summary.level1 function (which you may
have), I do get a call to summary.default as a result of NextMethod.
But NextMethod does first search for a function called summary.level1,
if it finds one then that will be evaluated.
   So, you really have to be careful. If you want to call a particular
function then you should do that by name. If you want to handle certain
attributes (for level1.level2) and then attributes for any other classes
(in this case level1) then NextMethod is your man. But if you want
to do some level1.level2 stuff and then call summary.default, don't
use NextMethod. 
    There are other differences between NextMethod and UseMethod (and
those differences are different between R and S; you need to read
the as yet unwritten R documentation to see what they really are :-)

robert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Fri Apr 16 20:08:45 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 16 Apr 1999 15:08:45 -0400
Subject: NextMethod
References: <Pine.SV4.4.05.9904161235440.795-100000@hsph.harvard.edu>
Message-ID: <37178ABC.5299C80F@bank-banque-canada.ca>

> since I don't have a summary.level1 function (which you may

Whoops, I missed a part:

summary.level1 <- function(object)
{ r<- "level1"
  class(r) <- "summary.level1"
  r
 }

print.summary.level1 <- function(x) { cat(x) }

>  You haven't really said what you want to do in enough detail for
>  me to give you an answer.
>    If an object has several class attributes then NextMethod is
>  a way to move down the heirarchy.

I guess my first question was a very general one: Is this approach to moving
through the heirarchy to  construct a summary and print it likely to be fairly
robust as R and S evolve? Despite my lack of detail I think you answered that in
general it is.

Some of your other comments made me realize that my whole understanding of class
heirarchy is not good. In particular, I had thought of a more specific class
something like a sub-class: a specific class being associated with a particular
general class.  An object could be  c("level2a", "level1") or c("level2b",
"level1") but it would not logically be c("level2", "level1a") or c("level2",
"level1b").

>From what you've said I guess that is wrong. The class heirarchy should be
associated only with a specific object, not thought of as a logical structure
for all objects having their most specific class in common.

So, in my example

summary.level1.level2 <- function(object)
{ r <- list("level2 before")
  r <- append(r,NextMethod("summary"))
  r <- append(r,"level2 after")
  class(r) <- "summary.level1.level2"
  r
}

I could replace NextMethod("summary") with summary.level1(object) because I know
that any object of class "level1.level2" always inherits from "level1". (This is
part of the reason for my naming convention "level1.level2" for the specific
class.) But if I did this replacement and then called summary with an object of
class c("level1.level2", "level1b"), I would get a different result.
My way of thinking about this has not caused me any problems, I just have not
used inheritance  to its full power.

If I still have this all wrong please let me know.

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Tue Apr 20 18:18:35 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: Tue, 20 Apr 1999 12:18:35 -0500 (CDT)
Subject: eigenvalue/eigenvector calculations
Message-ID: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>

Some of you may have seen a message on s-news by Stefan Steinhaus
regarding his paper on "Comparison of mathematical programs for data
analysis".  He compares S-PLUS 4.5 with several other programs.  He
does not include R in the comparisons.  On p. 28 of his report he
gives the URL the Auckland site along with URL's for two other systems
but comments that "I didn't received (sic) any support for my work by
the software developers".  I'm not sure what that means.

Anyway, one of his comparisons for timing is for the calculation of the
determinant of a 1000x1000 matrix of uniform (0,1) random numbers.  It
is not the wisest computation because it is usually Infinity but we
may still want to look at some of the properties.  He used
 determinant <- function(x) prod(eigen(x)$values)
There are many problems with this calculation and I address some of
them in a note to him with a copy to S-news.

I was cross-checking my results in R and came up with the following
peculiar behaviour.  If you use only.values = TRUE in eigen, you get
noticeably different eigenvalues and I don't think it is just a matter
of the ordering of the results.  Their products are noticeably
different.

R : Copyright 1999, The R Development Core Team
Version 0.64.0  (April 8, 1999)

> x <- array( runif( 10000 ), c(100, 100))
> determinant <- function(x) prod(eigen(x)$values)
> det1 <- function(x) prod(eigen(x, only.values = TRUE)$values)
> det2 <- function(x) prod(diag(qr(x)$qr)) * (-1)^(ncol(x) - 1)
> system.time(print(determinant(x)))
[1] -27320631-8.050401e-10i
[1] 0.06 0.04 0.00 0.00 0.00
> system.time(print(det1(x)))
[1] 36072865748-5.155196e-06i
[1] 0.06 0.00 0.00 0.00 0.00
> system.time(print(det2(x)))
[1] -9.854994e+25
[1] 0.03 0.00 0.00 0.00 0.00
> all(eigen(x,only.values=TRUE)$values == eigen(x)$values)
[1] FALSE
> rel.diff <- function(x,y) Mod(x-y)/Mod(x)
> rel.diff(eigen(x,only.values=TRUE)$values, eigen(x)$values)
  [1] 1.395689e-07 1.793713e-04 1.793713e-04 7.604683e-06 7.604683e-06
  [6] 6.027408e-05 6.027408e-05 2.001094e+00 1.887877e+00 2.088785e+00
 [11] 1.889478e+00 1.263914e+00 4.822391e-04 4.822391e-04 1.033824e-13
 [16] 1.582459e-05 1.590463e+00 1.684538e+00 1.861574e+00 1.891079e+00
 [21] 4.260913e-01 1.762078e+00 1.796430e+00 1.483012e+00 5.403557e-01
 [26] 5.403557e-01 1.217432e+00 1.217432e+00 5.188953e-01 5.188953e-01
 [31] 1.621965e+00 1.942157e+00 1.815673e+00 1.625482e+00 1.914144e+00
 [36] 1.914177e+00 1.728506e+00 1.724235e+00 7.271222e-01 7.271222e-01
 [41] 9.928653e-01 1.971190e+00 1.931997e+00 1.920628e+00 1.816204e+00
 [46] 1.946860e+00 1.565290e+00 8.955887e-01 1.924923e+00 1.388633e+00
 [51] 1.960728e+00 1.822560e+00 1.059483e+00 1.585604e+00 1.105094e+00
 [56] 5.622539e-02 5.622539e-02 1.795988e+00 1.846025e+00 1.333497e-01
 [61] 1.418881e+00 1.418881e+00 9.874141e-02 2.524210e-01 1.615536e+00
 [66] 1.195681e+00 1.793995e+00 6.952189e-01 1.268999e-01 1.472427e+00
 [71] 1.446002e+00 1.627224e-01 1.870035e+00 1.888633e+00 1.145509e-01
 [76] 1.625031e-01 1.860097e+00 1.469557e-01 1.438975e+00 1.505856e+00
 [81] 1.955270e+00 1.260539e+00 1.440042e+00 1.575450e-01 1.469263e-01
 [86] 1.769835e+00 1.780567e+00 2.119072e-01 3.139617e-01 2.748911e-01
 [91] 3.652874e-01 2.611222e-01 1.746714e+00 1.345816e-01 1.560194e+00
 [96] 1.225182e+00 2.020903e-01 1.836618e+00 1.962674e+00 9.724950e-16

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Tue Apr 20 18:44:59 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 20 Apr 1999 13:44:59 -0400
Subject: eigenvalue/eigenvector calculations
References: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>
Message-ID: <371CBD1B.A0206ED3@bank-banque-canada.ca>

> was cross-checking my results in R and came up with the following
>peculiar behaviour.  If you use only.values = TRUE in eigen, you get
>noticeably different eigenvalues and I don't think it is just a matter

This might be related to the problem (bad values from eigen) I reported a couple
of weeks ago. I think it was tracked down to a problem in the header files. As I
understand it, the bug has been around for awhile,  but may not always bite -
unless you're using a snapshot where it might be fixed. (I've reverted to 0.63.3
as it didn't seem to cause me a problem there.)

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Tue Apr 20 19:17:07 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Tue, 20 Apr 1999 19:17:07 +0100 (BST)
Subject: eigenvalue/eigenvector calculations
In-Reply-To: <m10ZeAN-0000ZSC@verdi.stat.wisc.edu>
Message-ID: <Pine.GSO.4.05.9904201914460.13546-100000@auk.stats>

On Tue, 20 Apr 1999, Douglas Bates wrote:

> I was cross-checking my results in R and came up with the following
> peculiar behaviour.  If you use only.values = TRUE in eigen, you get
> noticeably different eigenvalues and I don't think it is just a matter
> of the ordering of the results.  Their products are noticeably
> different.
> 
> R : Copyright 1999, The R Development Core Team
> Version 0.64.0  (April 8, 1999)
> 

That's the problem. On

R : Copyright 1999, The R Development Core Team
Version 0.64.0 Patched (unreleased snapshot) (April 19, 1999)

> all(eigen(x,only.values=TRUE)$values == eigen(x)$values)
[1] TRUE

As the NEWS says:

BUG FIXES

    o   eigen() now should work (again) in all cases.

There is quite a long list of bug fixes in 0.64.0, so I recommend the
R-release version.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Tue Apr 20 22:15:26 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 20 Apr 1999 16:15:26 -0500
Subject: eigenvalue calculations
Message-ID: <6rvher56z5.fsf@verdi.stat.wisc.edu>

I should have remembered that there was a problem with eigen() in
0.64.0.  In the patched versions of R-release (available under
src/devel at the CRAN sites) that bug has been fixed.

In case anyone else is interested, I redid the determinant
calculations in 
 Version 0.64.0 Patched (unreleased snapshot) (April 19, 1999)
using the method from Stephan Steinhaus's script (det0), the method
based on calculating the eigenvalues alone (det1) and the method based
on the QR decomposition (det2).  The results from the three methods
are consistent except that the eigenvalue methods both produce a
non-trivial imaginary component.

I enclose the timing results below.  Notice that the determinant
becomes extremely large as the matrix size increases and that the
error introduced by the complex arithmetic grows with it.

R> det0 <- function(x) prod(eigen(x)$values)
R> det1 <- function(x) prod(eigen(x, only = TRUE)$values)
R> det2 <- function(x) prod(diag(qr(x)$qr))*(-1)^(ncol(x)-1)
R> x1 <- array(runif(100*100), c(100,100))
R> x2 <- array(runif(200*200), c(200,200))
R> x3 <- array(runif(300*300), c(300,300))
R> system.time(print(det0(x1)))
[1] -9.267e+24+912457728i
[1] 1.36 0.00 2.00 0.00 0.00
R> system.time(print(det1(x1)))
[1] -9.267e+24+1041334272i
[1] 0.32 0.00 0.00 0.00 0.00
R> system.time(print(det2(x1)))
[1] -9.267e+24
[1] 0.04 0.00 0.00 0.00 0.00
R> system.time(print(det0(x2)))
[1] -9.4162e+79-1.458e+64i
[1] 10.28  0.00 11.00  0.00  0.00
R> system.time(print(det1(x2)))
[1] -9.4162e+79-2.9602e+64i
[1] 2.7 0.0 3.0 0.0 0.0
R> system.time(print(det2(x2)))
[1] -9.4162e+79
[1] 0.36 0.00 1.00 0.00 0.00
R> system.time(print(det0(x3)))
[1] -5.6519e+145+2.9732e+130i
[1] 34.86  0.01 34.00  0.00  0.00
R> system.time(print(det1(x3)))
[1] -5.6519e+145+9.494e+129i
[1] 10.49  0.00 10.00  0.00  0.00
R> system.time(print(det2(x3)))
[1] -5.6519e+145
[1] 1.49 0.00 1.00 0.00 0.00
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 06:15:17 1999
From: pd@biostat.ku.dk (Peter Dalgaard BSA)
Date: Wed, 21 Apr 1999 07:15:17 +0200
Subject: Bug list summary (automatic post)
Message-ID: <199904210515.HAA09383@biostat.ku.dk>

=================================================
This is an automated summary of the status of the R-bugs
repository.

Note that this may be neither complete nor perfectly
correct at any given instance: Not all bugs are reported,
and some reported bugs may have been fixed, but the
repository not yet updated.

Some bug fixes are difficult to verify because they pertain
to specific hardware or operating system versions. If you
have information to contribute, please do so.

If you happen to know how to fix a problem please send
patches to the bug repository, too.

New bugs are reported either through the web
interface at r-bugs.biostat.ku.dk or via email to
r-bugs@biostat.ku.dk. The bug.report() function can be
used to automate parts of the procedure on many systems.
Followups on older bugs can be done by including the string
"(PR#999)" in the Subject of an email (change 999 to the
actual reference number, of course!).
=================================================

Directory:  Accuracy

* PR# 138 *
Subject: Re: [R] bug? and New bug.
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 10 Mar 1999 17:21:16 +0100

Directory:  Add-ons

* PR# 137 *
Subject: funfits
From: "Alvaro A. Novo" <novo@uiuc.edu>
Date: Tue, 9 Mar 1999 22:24:54 -0600

Directory:  Analyses

none

Directory:  Documentation

* PR# 146 *
Subject: nlm docs
From: Patrick Lindsey <plindsey@alpha.luc.ac.be>
Date: Wed, 24 Mar 1999 15:48:41 +0100 (MET)

Directory:  Graphics

* PR# 38 *
Subject: possible bugs
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Sun, 6 Sep 1998 15:59:34 -0400 (EDT)
--ylim problem which appears solved
--Postscript overflow still with us (22feb99)
* PR# 61 *
Subject: points(...,  cex = ..)  is pretty wrong...
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 2 Nov 1998 19:15:06 +0100
--Symbols getting decentered when too large cex for X. Still there 22feb99  
* PR# 66 *
Subject: Bug with bounding box?
From: johnp@tip.csiro.au
Date: Thu, 3 Dec 1998 02:15:38 +0100
--Yes, this appears to have x/y reversed. The supplied example gives 
--%%Orientation: Landscape
--%%BoundingBox: 18 18 824 577 
--but the convention is to rotate the paper but leave the coordinate system.
* PR# 69 *
Subject: Some graphics bugs
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 04 Dec 1998 11:42:50 -0000 ()
Date: 04-Dec-98
--Various anomalies with text size and alignment. 2B appears to be solved. The 
--rest is still there (22feb99)
* PR# 79 *
Subject: apology: text(locator(),"sometext") works
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Tue, 15 Dec 1998 19:45:29 -0500 (EST)
--Clipping discrepancy x11/PS
* PR# 106 *
Subject: border-arg. in persp
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Fri, 29 Jan 1999 11:12:39 +0100
--No effect of arg. Still here 22feb99. Segfault with border=0 seems gone now. 
* PR# 114 *
Subject: PostScript Level 1/2 bug
From: ben@eno.princeton.edu
Date: Mon, 8 Feb 1999 00:07:20 +0100
--Not sure whether this is really PS lev 1/2 issue.
--/Font5 /Symbol findfont definefont
--(missing scalefont?)
* PR# 120 *
Subject: graphics bug: type="l"
From: Matthew Wiener <mcw@ln.nimh.nih.gov>
Date: Tue, 16 Feb 1999 15:30:25 -0500 (EST)
--X server problem drawing > 64K lines at once. Workaround?
* PR# 123 *
Subject: Text in plot
From: Ennapadam Venkatraman <venkat@biosta.mskcc.org>
Date: Thu, 18 Feb 1999 13:05:37 -0500
--Multiline text not working
* PR# 130 *
Subject: lty=0 -- shouldn't it give an invisible line?
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 28 Feb 1999 21:45:43 +0100
* PR# 149 *
Subject: plot.formula and pch=
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 25 Mar 1999 21:22:44 +0100
* PR# 150 *
Subject: R: error report
From: Adelchi Azzalini <adelchi.azzalini@jrc.it>
Date: Fri, 26 Mar 1999 09:39:05 +0000
* PR# 153 *
Subject: image + x11
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Wed, 31 Mar 1999 14:09:53 +0200

Directory:  In-Out

* PR# 125 *
Subject: scan rejects complex
From: John.Peters@tip.csiro.au (John Peters)
Date: Mon, 22 Feb 1999 10:08:14 +1100 (EST)
* PR# 129 *
Subject: Formatting in formatC and format
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 28 Feb 1999 08:53:34 +0000 (GMT)
--Documentation and ``merge'' of format() and formatC() would be desired - MM

Directory:  Installation

* PR# 95 *
Subject: patch to 63.2
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 15 Jan 1999 11:00:25 +0100 (MET)
--An incident where the 0.63.2 patches didn't take. So far the only one. 
--Maybe caused by patching unclean sources?

Directory:  Language

* PR# 40 *
Subject:  fac1 : fac2 -- fails {no "cross" anymore in seq.c} 
From: maechler@stat.math.ethz.ch
Date: Wed, 16 Sep 1998 08:42:12 +0200
--still there 17feb99
* PR# 85 *
Subject:  A bug in data.entry? 
From: Yusuke Uchiyama <me@naxgul.kais.kyoto-u.ac.jp>
Date: Wed, 23 Dec 1998 11:03:03 GMT
--still there 17feb99
* PR# 89 *
Subject: lapply -- Recall bug
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 6 Jan 1999 15:04:14 +0100
--This is *nasty*.
* PR# 105 *
Subject: an old bug resurfaces
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Fri, 29 Jan 1999 08:28:32 +0100 (MET)
--Model formulas. Proper fix probably requires extensive rewrite of model formula
--parser, which would make in non-S-compatible.
* PR# 113 *
Subject: cat data types
From: John Peters <johnp@tip.CSIRO.AU>
Date: Fri, 5 Feb 1999 18:31:52 +1100 (EDT)
--Cannot cat a name. (Docs fixed to reflect this by Kurt, 22feb99)
* PR# 118 *
Subject: Function parsing
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
Date: Wed, 10 Feb 1999 13:42:01 +0000 (GMT)
--comment placement.
* PR# 139 *
Subject: : for factors
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 11 Mar 1999 09:30:04 +0100

Directory:  Low-level

* PR# 37 *
Subject: S.h compatibility issues
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 6 Sep 1998 19:58:47 +0100 (BST)
* PR# 101 *
Subject: Re: [R] Re: R-0.63.2 for Windows - some comments
From: Guido Masarotto <guido@hal.stat.unipd.it>
Date: Fri, 22 Jan 1999 12:40:26 +0100
--This is really about fixed buffer sizes in printutils.c
* PR# 135 *
Subject: summary() of lm() problem
From: Simon Fear <fears@roycastle.liv.ac.uk>
Date: Tue, 9 Mar 1999 13:18:37 -0000 
--lm (?) AND Windows problem;  Win solved (fudged) for 0.63.3
--
--Another low-level buffer-size problem
* PR# 140 *
Subject: rbind dimnames with complex
From: oncley@ucar.edu
Date: Thu, 11 Mar 1999 17:15:14 +0100

Directory:  Misc

* PR# 91 *
Subject: possible bug
From: Rashid Nassar <rnassar@duke.edu>
Date: Sat, 9 Jan 1999 14:50:58 -0500 (EST)
--Remaining issue is whether we can do something more friendly than dumping 
--users into vi?

Directory:  Models

* PR# 121 *
Subject:  model.frame mangles time series 
From: Peter Dalgaard BSA <pd@biostat.ku.dk>
Date: Thu, 18 Feb 1999 15:47:24 +0100
--Subset in C code + attributes = mess
--Switch to interpreted ("[")

Directory:  Startup

* PR# 21 *
Subject: Restoring large image files
From: Martyn Plummer <plummer@iarc.fr>
Date: Fri, 21 Aug 1998 13:29:16 -0000 ()

Directory:  System-specific

none

Directory:  TooMuchAtOnce

* PR# 53 *
Subject: 0.62.3 bugs, incompatibilities and problems
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 12 Oct 1998 09:43:51 +0200 (MET DST)
* PR# 76 *
Subject: R-0.63.0
From: Rashid Nassar <rnassar@acpub.duke.edu>
Date: Fri, 11 Dec 1998 23:20:08 -0500 (EST)

Directory:  Windows

none

Directory:  incoming

* PR# 132 *
Subject: Re: [R] zero-offset matrices
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 02 Mar 1999 16:59:48 +0100
* PR# 144 *
Subject: glm throws erroneous(?)'names attribute must be the same length as the vector' 
From: wagman@enteract.com
Date: Thu, 18 Mar 1999 08:58:47 +0100
* PR# 145 *
Subject: R-0.63.3 package on IRIX 6.5 machine
From: Jayshree Sarma <jsarma@cs.gmu.edu>
Date: Tue, 23 Mar 1999 16:54:20 -0500 (EST)
* PR# 148 *
Subject: Missing Warning in :
From: Andreas Weingessel <Andreas.Weingessel@ci.tuwien.ac.at>
Date: Thu, 25 Mar 1999 13:34:12 +0100
* PR# 151 *
Subject: problems with formals and get
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Mon, 29 Mar 1999 09:29:05 +0200 (MET DST)
* PR# 160 *
Subject: core dump
From: Jim Lindsey <jlindsey@alpha.luc.ac.be>
Date: Wed, 7 Apr 1999 16:30:39 +0200 (MET DST)
* PR# 163 *
Subject: IRIX compile
From: mtim@farm.ecs.umass.edu
Date: Sat, 10 Apr 1999 19:35:43 +0200
* PR# 164 *
Subject: Re: [R] repeated measurements libraries v0.4
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Sun, 11 Apr 1999 22:52:34 +0100 (BST)
* PR# 165 *
Subject: make check
From: Martyn Plummer <plummer@iarc.fr>
Date: Tue, 13 Apr 1999 12:03:42 +0200 (CEST)
* PR# 166 *
Subject: outer fails with group generic operations on factors
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Tue, 13 Apr 1999 18:28:53 +0100 (BST)
* PR# 167 *
Subject: R's UseMethod() does not dispatch on changed class()
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 14 Apr 1999 11:22:10 +0200
* PR# 168 *
Subject: Segfault from evalq(return())
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 16 Apr 1999 14:05:12 +0200
* PR# 169 *
Subject: deparse drops () sometimes
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 16 Apr 1999 14:10:39 +0200
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 21 08:49:03 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 Apr 1999 09:49:03 +0200
Subject: eigenvalue calculations
In-Reply-To: <6rvher56z5.fsf@verdi.stat.wisc.edu> (message from Douglas Bates
 on 20 Apr 1999 16:15:26 -0500)
References: <6rvher56z5.fsf@verdi.stat.wisc.edu>
Message-ID: <199904210749.JAA14072@sophie.ethz.ch>

I've added some hints and the det2() function 
to the help pages (*.Rd) of `eigen' and `qr'.

Martin
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pwhiting@fury.ittc.ukans.edu  Wed Apr 21 12:43:00 1999
From: pwhiting@fury.ittc.ukans.edu (pwhiting@fury.ittc.ukans.edu)
Date: Wed, 21 Apr 1999 13:43:00 +0200
Subject: [MAILER-DAEMON@biostat.ku.dk: Returned mail: /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs] (PR#170)
Message-ID: <199904211143.NAA09587@biostat.ku.dk>


--rwEMma7ioTxnRzrJ
Content-Type: text/plain; charset=us-ascii

at the bottom is a bug report - however I have include the bounce
headers in case you want to fix the mailer too.  This was the
result of an online bug submission via http://r-bugs.biostat.ku.dk/cgi-bin/R.

pete

--rwEMma7ioTxnRzrJ
Content-Type: message/rfc822
Content-Description: Forwarded message from Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>

Return-Path: <>
Received: from stephens.ittc.ukans.edu (stephens.ittc.ukans.edu [129.237.125.220])
	by fury.ittc.ukans.edu (8.8.7/8.8.7) with ESMTP id GAA11879
	for <pwhiting@fury.ittc.ukans.edu>; Wed, 21 Apr 1999 06:35:58 -0500
Received: from gate1.sprintlink.net (gate1.sprintlink.net [199.0.233.2])
	by stephens.ittc.ukans.edu (8.9.1/8.9.1/ITTC-NOSPAM-1.0) with SMTP id GAA17594
	for <pwhiting@ittc.ukans.edu>; Wed, 21 Apr 1999 06:35:45 -0500 (CDT)
Received: from elle.res.sprintlink.net by gate1.sprintlink.net
          via smtpd (for stephens.ittc.ukans.edu [129.237.125.220]) with SMTP; 21 Apr 1999 11:35:45 UT
Received: from gate1dmz0-qe0.res.sprintlink.net (gate1dmz.res.sprintlink.net [199.0.234.1])
	by elle.res.sprintlink.net (8.8.5/8.8.5) with SMTP id HAA13854
	for <pwhiting@sprint.net>; Wed, 21 Apr 1999 07:35:45 -0400 (EDT)
Received: from jay.sprintlink.net ([199.0.233.7]) by gate1dmz0-qe0.res.sprintlink.net
          via smtpd (for elle.res.sprintlink.net [199.0.234.34]) with SMTP; 21 Apr 1999 11:35:45 UT
Received: from biostat.ku.dk (blueberry.kubism.ku.dk [130.225.108.193])
	by jay.sprintlink.net (8.8.5/0.0.0) with ESMTP id HAA19423
	for <pwhiting@sprint.net>; Wed, 21 Apr 1999 07:35:44 -0400 (EDT)
Received: from localhost (localhost)
	by biostat.ku.dk (8.8.7/8.8.7) with internal id NAA09576;
	Wed, 21 Apr 1999 13:37:45 +0200
Date: Wed, 21 Apr 1999 13:37:45 +0200
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
Message-Id: <199904211137.NAA09576@biostat.ku.dk>
To: <pwhiting@sprint.net>
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
	boundary="NAA09576.924694665/biostat.ku.dk"
Subject: Returned mail: /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs
Auto-Submitted: auto-generated (failure)

This is a MIME-encapsulated message

--NAA09576.924694665/biostat.ku.dk

The original message was received at Wed, 21 Apr 1999 13:37:43 +0200
from blueberry.kubism.ku.dk [130.225.108.193]

   ----- The following addresses had permanent fatal errors -----
"|/home/sfe1/r-bugs/bin/new_message Rnew"
    (expanded from: <R-bugs@biostat.ku.dk>)

   ----- Transcript of session follows -----
550 /home/sfe1/r-bugs/.forward: line 1: "|/home/sfe1/r-bugs/bin/new_message Rnew"... User r-bugs@biostat.ku.dk doesn't have a valid shell for mailing to programs

--NAA09576.924694665/biostat.ku.dk
Content-Type: message/delivery-status

Reporting-MTA: dns; biostat.ku.dk
Received-From-MTA: DNS; blueberry.kubism.ku.dk
Arrival-Date: Wed, 21 Apr 1999 13:37:43 +0200

Final-Recipient: RFC822; r-bugs@biostat.ku.dk
X-Actual-Recipient: RFC822; "|/home/sfe1/r-bugs/bin/new_message Rnew"@biostat.ku.dk
Action: failed
Status: 5.7.1
Last-Attempt-Date: Wed, 21 Apr 1999 13:37:45 +0200

--NAA09576.924694665/biostat.ku.dk
Content-Type: message/rfc822

Return-Path: <pwhiting@sprint.net>
Received: from localhost (blueberry.kubism.ku.dk [130.225.108.193])
	by biostat.ku.dk (8.8.7/8.8.7) with ESMTP id NAA09575
	for <R-bugs@biostat.ku.dk>; Wed, 21 Apr 1999 13:37:43 +0200
Date: Wed, 21 Apr 1999 13:37:43 +0200
From: pwhiting@sprint.net
Message-Id: <199904211137.NAA09575@biostat.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: GConvert error when using pictex

Full_Name: Peter Whiting
Version: 0.64.0
OS: linux
Submission from: (NULL) (168.191.164.23)


I get an error whenever I try to plot a histogram in pictex.
The error doesn't occur for X11 or postscript.

> x<-c(1,2,3)
> pictex()
> hist(x)
Error: Bad units specified in GConvert, please report!

platform   i686-unknown-linux           
arch       i686                         
os         linux                        
system     i686, linux                  
status     Patched (unreleased snapshot)
status.rev 0                            
major      0                            
minor      64.0                         
year       1999                         
month      April                        
day        15                           
language   R                            

pete

--NAA09576.924694665/biostat.ku.dk--

--rwEMma7ioTxnRzrJ--

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 13:04:19 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 14:04:19 +0200
Subject: test2 (PR#171)
Message-ID: <199904211204.OAA09626@biostat.ku.dk>


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 13:51:32 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 14:51:32 +0200 (MET DST)
Subject: Test (PR#172)
Message-ID: <199904211251.OAA24086@pubhealth.ku.dk>

Full_Name: Peter D
Version: --
OS: --
Submission from: (NULL) (127.0.0.1)


Trouble with mail config --solved?

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 21 14:20:18 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 21 Apr 1999 15:20:18 +0200
Subject: Test (PR#172)
In-Reply-To: pd@biostat.ku.dk's message of "Wed, 21 Apr 1999 14:51:32 +0200 (MET DST)"
References: <199904211251.OAA24086@pubhealth.ku.dk>
Message-ID: <x2hfqaxg8d.fsf@blueberry.kubism.ku.dk>

pd@biostat.ku.dk writes:

> Full_Name: Peter D
> Version: --
> OS: --
> Submission from: (NULL) (127.0.0.1)
> 
> 
> Trouble with mail config --solved?

OK, the problem seems to be gone now. Sorry for the disturbance.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pwhiting@sprint.net  Wed Apr 21 17:18:48 1999
From: pwhiting@sprint.net (pwhiting@sprint.net)
Date: Wed, 21 Apr 1999 18:18:48 +0200 (MET DST)
Subject: GConvert error when using pictex (PR#173)
Message-ID: <199904211618.SAA26673@pubhealth.ku.dk>


[I'm refiling this one due to mailer config messup]

I get an error whenever I try to plot a histogram in pictex.
The error doesn't occur for X11 or postscript.

> x<-c(1,2,3)
> pictex()
> hist(x)
Error: Bad units specified in GConvert, please report!

platform   i686-unknown-linux           
arch       i686                         
os         linux                        
system     i686, linux                  
status     Patched (unreleased snapshot)
status.rev 0                            
major      0                            
minor      64.0                         
year       1999                         
month      April                        
day        15                           
language   R                            

pete

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From thomas@biostat.washington.edu  Wed Apr 21 17:20:29 1999
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 Apr 1999 09:20:29 -0700 (PDT)
Subject: survival5
In-Reply-To: <199904211602.SAA24704@sophie.ethz.ch>
Message-ID: <Pine.GSO.4.10.9904210907360.13904-100000@wompom.biostat.washington.edu>

A nearly complete port of the new survival5 package has been sent to CRAN
and will soon be appearing on a mirror near you in the contrib/devel
area.

This new package, the successor to survival4, has a more stable likelihood
maximiser for parametric survival models and incorporates penalised
likelihoods for adding smoothing splines, ridge regression, and
(approximately) frailties to survival models. User-defined penalties are
also possible.

It is in the devel area for two reasons

(1) There are some tests I want to run against S-PLUS, and we don't have
survival5 installed for S-PLUS yet.

(2) It calls R internal functions to implement the penalised regression.
The API for these has not been standardised yet and you need to install
the package from an R source tree. 


Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Wed Apr 21 17:28:41 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 21 Apr 1999 18:28:41 +0200
Subject: GConvert error when using pictex (PR#173)
In-Reply-To: pwhiting@sprint.net's message of "Wed, 21 Apr 1999 18:18:48 +0200 (MET DST)"
References: <199904211618.SAA26673@pubhealth.ku.dk>
Message-ID: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>

pwhiting@sprint.net writes:

> [I'm refiling this one due to mailer config messup]
   ^^^

Oops. Me, that is. Whereas it *can* be figured out from the headers, I
probably should have signed that one....

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed Apr 21 17:37:58 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 Apr 1999 18:37:58 +0200
Subject: GConvert error when using pictex (PR#173)  (PR#150)
In-Reply-To: <199904211618.SAA26673@pubhealth.ku.dk> (pwhiting@sprint.net)
References: <199904211618.SAA26673@pubhealth.ku.dk>
Message-ID: <199904211637.SAA24863@sophie.ethz.ch>

Thank you for the report!

>>>>> "pwhiting" == pwhiting  <pwhiting@sprint.net> writes:

    pwhiting> I get an error whenever I try to plot a histogram in pictex.
    pwhiting> The error doesn't occur for X11 or postscript.

    pw>> x<-c(1,2,3); pictex() ; hist(x)
    pwhiting> Error: Bad units specified in GConvert, please report!


I believe that your report is just a much more compact example
of the same
bug reported on March 26, by Adelchi Azzalini, report no.150.

By the way:  The [Graphics] section at  http://R-bugs.biostat.ku.dk/
	     has quite a few bugs, some of which should really be addressed
	     rather sooner than later....
	     
I don't think the R-core team has any commitments on working on these,
but I think we should...

Martin
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pd@biostat.ku.dk  Wed Apr 21 18:36:25 1999
From: pd@biostat.ku.dk (pd@biostat.ku.dk)
Date: Wed, 21 Apr 1999 19:36:25 +0200 (MET DST)
Subject: do.call() mangles expressions in arguments (PR#174)
Message-ID: <199904211736.TAA26994@pubhealth.ku.dk>


> f<-function(x)x
> f(expression(print("Oops")))
expression(print("Oops"))
> do.call("f",list(expression(print("Oops"))))
[1] "Oops"

Something in the do_docall code causes an extra eval of the
argument. Causes trouble with math expressions in labels in 
boxplot (do.call("title",...))

--please do not edit the information below--

Version:
 platform = i586-unknown-linux
 arch = i586
 os = linux
 system = i586, linux
 status = Patched (unreleased snapshot)
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 22
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Wed Apr 21 21:46:41 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Wed, 21 Apr 1999 16:46:41 -0400 (EDT)
Subject: make check isn't quite right
In-Reply-To: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>

If I don't build the help pages at the start and then
do make check, 
  the examples for the base man pages get made but not
for any of the packages:

> example("smooth",package="eda")
Error: No help file found for'smooth'
Execution halted



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ihaka@stat.auckland.ac.nz  Wed Apr 21 22:49:39 1999
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 Apr 1999 09:49:39 +1200 (NZST)
Subject: do.call() mangles expressions in arguments (PR#174)
In-Reply-To: <199904211736.TAA26994@pubhealth.ku.dk>
Message-ID: <Pine.BSF.4.05.9904220938180.3355-100000@g.ihaka.slip.auckland.ac.nz>



On Wed, 21 Apr 1999 pd@biostat.ku.dk wrote:

> 
> > f<-function(x)x
> > f(expression(print("Oops")))
> expression(print("Oops"))
> > do.call("f",list(expression(print("Oops"))))
> [1] "Oops"
> 
> Something in the do_docall code causes an extra eval of the
> argument. Causes trouble with math expressions in labels in 
> boxplot (do.call("title",...))

I think this is correct behavior.  The function "list" evaluates its
arguments and when it does the "expression" call gets evaluated.

I think that it is boxplot that needs to be fixed.  There needs to be some
form of quoting for the title (and xlab, ylab arguments).  It isn't
completely obvious to me what the right solution is.  It may require a
redesign of boxplot and bxp.

	Ross

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 00:21:18 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 01:21:18 +0200
Subject: do.call() mangles expressions in arguments (PR#174)
In-Reply-To: Ross Ihaka's message of "Thu, 22 Apr 1999 09:49:39 +1200 (NZST)"
References: <Pine.BSF.4.05.9904220938180.3355-100000@g.ihaka.slip.auckland.ac.nz>
Message-ID: <x2vhepblw1.fsf@blueberry.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> On Wed, 21 Apr 1999 pd@biostat.ku.dk wrote:
> 
> > 
> > > f<-function(x)x
> > > f(expression(print("Oops")))
> > expression(print("Oops"))
> > > do.call("f",list(expression(print("Oops"))))
> > [1] "Oops"
> > 
> > Something in the do_docall code causes an extra eval of the
> > argument. Causes trouble with math expressions in labels in 
> > boxplot (do.call("title",...))
> 
> I think this is correct behavior.  The function "list" evaluates its
> arguments and when it does the "expression" call gets evaluated.

Oh yes! (D**n! I know I decided to take it easy for a few days, but I
seem to have displaced my brain in the process.) 

> I think that it is boxplot that needs to be fixed.  There needs to be some
> form of quoting for the title (and xlab, ylab arguments).  It isn't
> completely obvious to me what the right solution is.  It may require a
> redesign of boxplot and bxp.

Hmm. The following seems to work for the xlabs problem at least:

    for (i in 1:length(pars)) pars[[i]] <- as.call(c(as.name("expression"), 
        pars[[i]]))
    if (plot) {
        bxp(groups, width, varwidth = varwidth, notch = notch,
    ...etc...

(one might want to guard that assignment by an if(is.expression())
thing) 


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From wvenable@arcola.stats.adelaide.edu.au  Thu Apr 22 04:45:26 1999
From: wvenable@arcola.stats.adelaide.edu.au (wvenable@arcola.stats.adelaide.edu.au)
Date: Thu, 22 Apr 1999 05:45:26 +0200 (MET DST)
Subject: Assigning to a list within a loop (PR#175)
Message-ID: <199904220345.FAA28639@pubhealth.ku.dk>

We noticed this bug in more complex code, but this succinctly
describes the phenomenon.

If you do not re-initialize a each time in the following loop,
the final value only is assigned to all places when the loop is
complete.

> a <- b <- list()
> for(i in 1:5) {
+	a$alpha <- i
+	b[[i]] <- a
+	}
> unlist(b)
alpha alpha alpha alpha alpha 
    5     5     5     5     5 

If a is re-created each time, however the correct behaviour
happens:


> b <- list()
> for(i in 1:5) {
+	  a <- list(alpha = i)
+	  b[[i]] <- a
+	  }
> unlist(b)
alpha alpha alpha alpha alpha 
    1     2     3     4     5 

> version
           _                 
platform   i586-unknown-linux
arch       i586              
os         linux             
system     i586, linux       
status                       
status.rev 0                 
major      0                 
minor      64.0              
year       1999              
month      April             
day        8                 
language   R                 
>

Bill Venables & Berwin Turlach.

-- 
-----------------------------------------------------------------
Bill Venables, Statistician, CMIS Environmetrics Project.

Physical address:                            Postal address:
CSIRO Marine Laboratories,                   PO Box 120,       
233 Middle St, Cleveland, Queensland         Cleveland, Qld, 4163
AUSTRALIA                                    AUSTRALIA

Telephone: +61 7 3826 7251     Email: Bill.Venables@cmis.csiro.au     
      Fax: +61 7 3826 7304

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr 22 07:30:29 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 Apr 1999 08:30:29 +0200 (CEST)
Subject: make check isn't quite right
In-Reply-To: <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>
References: <x2aew2x7ie.fsf@blueberry.kubism.ku.dk>
 <Pine.SV4.4.05.9904211644330.29773-100000@hsph.harvard.edu>
Message-ID: <14110.49669.12978.909618@pc87.maho.magnaeu.com>

>>>>> Robert Gentleman writes:

> If I don't build the help pages at the start and then
> do make check, 
>   the examples for the base man pages get made but not
> for any of the packages:

>> example("smooth",package="eda")
> Error: No help file found for'smooth'
> Execution halted

Your observation is correct.  What currently happens is something like

	make R
	for pkg in PKGS; do
	  maybe rebuild pkg examples/help pages
	  try to run the examples
	done

This will fail if the tests for pkg1 assume that pkg2 help/examples must
be there.

We could easily change the `make R' to `make; make help; make examples'
but I am not sure that this is the right thing.  Conceptually, `eda' is
an add-on package and all that must be there is base (Rlang/Rstat), so I
think the example should be changed.

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 22 07:45:53 1999
From: ripley@stats.ox.ac.uk (Prof Brian D Ripley)
Date: Thu, 22 Apr 1999 07:45:53 +0100 (BST)
Subject: make check isn't quite right
In-Reply-To: <14110.49669.12978.909618@pc87.maho.magnaeu.com>
Message-ID: <Pine.GSO.4.05.9904220736000.4204-100000@auk.stats>

On Thu, 22 Apr 1999, Kurt Hornik wrote:

> >>>>> Robert Gentleman writes:
> 
> > If I don't build the help pages at the start and then
> > do make check, 
> >   the examples for the base man pages get made but not
> > for any of the packages:
> 
> >> example("smooth",package="eda")
> > Error: No help file found for'smooth'
> > Execution halted
> 
> Your observation is correct.  What currently happens is something like
> 
> 	make R
> 	for pkg in PKGS; do
> 	  maybe rebuild pkg examples/help pages
> 	  try to run the examples
> 	done
> 
> This will fail if the tests for pkg1 assume that pkg2 help/examples must
> be there.
> 
> We could easily change the `make R' to `make; make help; make examples'
> but I am not sure that this is the right thing.  Conceptually, `eda' is
> an add-on package and all that must be there is base (Rlang/Rstat), so I
> think the example should be changed.

I think 

-- the example is a nice one for human readers
-- it is a useful test on the codebase (at least one version I created
   of example failed it).

My problem is with

> > Error: No help file found for'smooth'
> > Execution halted

Now if we could keep running, we would get to see _all_ the problems
and be able to ignore those we knew about. 

Alternatively, I could fix the specific case, and make this a warning and
do-nothing condition.  I am inclined to do that anyway. The only
knock-on effect I can see is that some examples call other examples, and if
the included ones are missing then the main example main fail in an
unanticipated way.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Thu Apr 22 13:52:34 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 Apr 1999 14:52:34 +0200 (CEST)
Subject: R on AIX
Message-ID: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>


I tried to build R on AIX and after 2 minor bugfixes everything seems
to work fine except for dynamic loading of code.

In a previous mail I found that Fabrizio Moro succeeded using

	SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg" 

which compiles fine for me, I get also no error messages upon
dynloading, but no symbols are available afterwards, i.e. is.loaded
fails (I tried also with trailing underscores etc.).

Has anybody some experience which flags to use?

I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
compiles but produces incorrect code, i.e., some computations are
wrong).

Make check succeeds until eda :-)

.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu Apr 22 14:04:30 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 Apr 1999 15:04:30 +0200
Subject: R on AIX
In-Reply-To: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at> (message from
 Friedrich Leisch on Thu, 22 Apr 1999 14:52:34 +0200 (CEST))
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>
Message-ID: <199904221304.PAA05194@sophie.ethz.ch>

>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:

    FrL> I tried to build R on AIX and after 2 minor bugfixes everything
    FrL> seems to work fine except for dynamic loading of code.

    FrL> In a previous mail I found that Fabrizio Moro succeeded using

    FrL>   SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg"

    FrL> which compiles fine for me, I get also no error messages upon
    FrL> dynloading, but no symbols are available afterwards,
    FrL> i.e. is.loaded fails (I tried also with trailing underscores
    FrL> etc.).

Yes.  Unfortunately, Fabrizio (nor me) followed up on that mail telling you
that we (Fabrizio and me) ended up with the exact same symptomps as you
have.

I gave up at that time; Fabrizio continues to use S-plus on AIX
(and R on Linux, to some extentes at least)...
... yes a sad story,  but I think we both ended up with the impression that
AIX is half broken environment anyway 
 --- at least if you want to compile software that has no problems at all
     on other architectures...


    FrL> Has anybody some experience which flags to use?

    FrL> I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
    FrL> compiles but produces incorrect code, i.e., some computations are
    FrL> wrong).

    FrL> Make check succeeds until eda :-)

exactly. The first time, dyn.load is needed....

Martin.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Kurt.Hornik@ci.tuwien.ac.at  Thu Apr 22 14:20:19 1999
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 Apr 1999 15:20:19 +0200 (CEST)
Subject: R on AIX
In-Reply-To: <199904221304.PAA05194@sophie.ethz.ch>
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at>
 <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <14111.8723.93389.159193@pc87.maho.magnaeu.com>

>>>>> Martin Maechler writes:

>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:
FrL> I tried to build R on AIX and after 2 minor bugfixes everything
FrL> seems to work fine except for dynamic loading of code.

FrL> In a previous mail I found that Fabrizio Moro succeeded using

FrL> SHLIBLDFLAGS="-bM:S1L -bnoentry -bnogc -berok -lc -lm -lodm -lcfg"

FrL> which compiles fine for me, I get also no error messages upon
FrL> dynloading, but no symbols are available afterwards,
FrL> i.e. is.loaded fails (I tried also with trailing underscores
FrL> etc.).

> Yes.  Unfortunately, Fabrizio (nor me) followed up on that mail telling you
> that we (Fabrizio and me) ended up with the exact same symptomps as you
> have.

> I gave up at that time; Fabrizio continues to use S-plus on AIX
> (and R on Linux, to some extentes at least)...
> ... yes a sad story,  but I think we both ended up with the impression that
> AIX is half broken environment anyway 
>  --- at least if you want to compile software that has no problems at all
>      on other architectures...


FrL> Has anybody some experience which flags to use?

FrL> I use an rs6000-ibm-aix4.2.1.0 and the native cc, f77 and ld (gcc
FrL> compiles but produces incorrect code, i.e., some computations are
FrL> wrong).

FrL> Make check succeeds until eda :-)

> exactly. The first time, dyn.load is needed....

It might help to look into other software for which dynloading works
under AIX.  Three potential examples come to mind:

	Xlisp-stat
	Octave
	Tcl

Anyone willing to have a look?

-k
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 14:19:03 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 15:19:03 +0200
Subject: R on AIX
In-Reply-To: Martin Maechler's message of "Thu, 22 Apr 1999 15:04:30 +0200"
References: <14111.7058.52732.38138@galadriel.ci.tuwien.ac.at> <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <x2r9pchjy0.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> that we (Fabrizio and me) ended up with the exact same symptomps as you
> have.
> 
> I gave up at that time; Fabrizio continues to use S-plus on AIX
> (and R on Linux, to some extentes at least)...
> ... yes a sad story,  but I think we both ended up with the impression that
> AIX is half broken environment anyway 
>  --- at least if you want to compile software that has no problems at all
>      on other architectures...

Have you tried following up on pointers from DejaNews? A quick search
on "aix dynamic link" turned up this one:

---snip
On Tue, 23 Mar 1999 22:44:30 -0000, PaulT <News@ecosmart.demon.co.uk> wrote:

>I am trying to create a 'c' link libary for use with java I'm struggling
>because
>documentation indicates that the -G option should be used with
>cc to create a dynamic library, but it is not available for AIX  v4.

Check the makefile in the /usr/J1.1.6/jni_example/c directory, these contain
the proper command line flags.

-- 
Jens-Uwe Mager  <pgp-mailto:62CFDB25>
---snap


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Thu Apr 22 14:26:01 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Thu, 22 Apr 1999 15:26:01 +0200 (DFT)
Subject: R on AIX
In-Reply-To: <199904221304.PAA05194@sophie.ethz.ch>
Message-ID: <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>

We have R running on AIX (several OS versions between 4.1 and 4.3) and we
are able to load code dynamically. Our solution was essentially developed
by Heiner Schwarte. We use a different version of dynload.c and the linker
is called like this:

  $(F77) -o module.so  \   
           -bM:SRE -bE:module.exp -bnoentry  $(OBJECTS)  $(LIBDIR) $(LIBS)

where module.exp contains all symbols that have to be exported.

Arne

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Thu Apr 22 15:21:00 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 Apr 1999 16:21:00 +0200 (CEST)
Subject: R on AIX
In-Reply-To: <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>
References: <199904221304.PAA05194@sophie.ethz.ch>
 <Pine.A41.4.02.9904221520130.28198-100000@gauss.mathematik.uni-essen.de>
Message-ID: <14111.12364.351689.643342@galadriel.ci.tuwien.ac.at>

>>>>> On Thu, 22 Apr 1999 15:26:01 +0200 (DFT),
>>>>> Arne Kovac (AK) wrote:

AK> We have R running on AIX (several OS versions between 4.1 and 4.3) and we
AK> are able to load code dynamically. Our solution was essentially developed
AK> by Heiner Schwarte. We use a different version of dynload.c and the linker
AK> is called like this:

AK>   $(F77) -o module.so  \   
AK>            -bM:SRE -bE:module.exp -bnoentry  $(OBJECTS)  $(LIBDIR) $(LIBS)

AK> where module.exp contains all symbols that have to be exported.

Have you got modified Makefiles to automate this procedure, i.e.,
create the export file and which libs to include?

What's your `different version of dynload.c'?

.f
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Arne.Kovac@uni-essen.de  Thu Apr 22 15:41:54 1999
From: Arne.Kovac@uni-essen.de (Arne Kovac)
Date: Thu, 22 Apr 1999 16:41:54 +0200 (DFT)
Subject: R on AIX
In-Reply-To: <14111.12364.351689.643342@galadriel.ci.tuwien.ac.at>
Message-ID: <Pine.A41.4.02.9904221628420.14640-100000@cauchy.mathematik.uni-essen.de>

On Thu, 22 Apr 1999, Friedrich Leisch wrote:

> Have you got modified Makefiles to automate this procedure, i.e.,
> create the export file and which libs to include?

No, I'm afraid we extend our module.exp every time we write a new
function... Not very convenient, and even worse, adding a new library is
always a pain. But AIX users get used to that...

> What's your `different version of dynload.c'?

I attach it below. I am quite sure that you should be able to compile a
working version of R, if you use AIX 4.2.x and R<=0.63.1. However, I
wouldn't give any promises for AIX 4.3 and/or R 0.64. Recently I reported
on this list about my installation problems and I don't know whether they
are caused by the new OS or R version.

Arne

----------
/*
 *  R : A Computer Langage for Statistical Data Analysis
 *  Copyright (C) 1995  Robert Gentleman and Ross Ihaka
 *  Copyright (C) 1997  The R Core Team
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */


/*  Dynamic Loading Support
 *
 *  This module provides support for run-time loading of shared libraries
 *  access to symbols within such libraries via .C and .Fortran.  This is
 *  done under Unix with dlopen, dlclose and dlsym (the exception is
 *  hpux, where we use compatibility code provided by Luke Tierney.
 *  There are two cases:
 *
 *
 *  1. The dlopen interface is available.
 *
 *  In this case all symbol location is done using the dlopen routines.
 *  We maintain a list of currently loaded shared libraries in an array
 *  called "LoadedDLL" with the number of currenly loaded libraries
 *  being "CountDLL".  To locate a symbol, we probe the loaded libraries
 *  in order until the symbol is located.  If we do not find a symbol
 *  in the loaded libraries, we search the executable itself.  This
 *  search is not very efficient, but this probably pales into
 *  insignificance when compared with the inefficiencies in the R
 *  interpreter.
 *
 *  Loading and unloading of shared libraries is done via the routines
 *  AddDLL and DeleteDLL.  These routines maintain the list of currently
 *  loaded libraries.  When a library is added, any existing reference
 *  to that library are deleted and then the library is inserted at the
 *  start of the search list.  This way, symbols in more recently loaded
 *  libraries are found first.
 *
 *
 *  2. The dlopen interface is not available.
 *
 *  In this case we use the table "CFunTabEntry" to locate functions
 *  in the executable.  We do this by straight linear search through
 *  the table.  Note that the content of the table is created at
 *  system build time from the list in ../appl/ROUTINES.
 */

#include "Defn.h"
#include "Mathlib.h"
#include <string.h>
#include <stdlib.h>
#include <sys/param.h>

typedef int (*DL_FUNC)();
typedef struct {
        char *name;
        DL_FUNC func;
} CFunTabEntry;  
#include "FFDecl.h"
#include "FFDecl.h"

	/* This provides a table of built-in C and Fortran functions */

static CFunTabEntry CFunTab[] =
{
#include "FFTab.h"
        {NULL, NULL}
};      

	/* The following code loads in a compatibility module */
	/* written by Luke Tierney to support S version 4 on */
	/* Hewlett-Packard machines.  The relevant defines are */
	/* set up by autoconfigure */

#ifdef HAVE_DLFCN_H
#include <dlfcn.h>
#else
#ifdef HAVE_DL_H
#include "hpdlfcn.c"
#define HAVE_DLFCN_H
#endif
#endif

#ifdef HAVE_DLFCN_H
#ifndef RTLD_LAZY
#define RTLD_LAZY 1
#endif

struct libhandlelist
{
  void *ptr;
  char *librarypath;
  struct libhandlelist *next;
};

static struct libhandlelist *list = NULL;

static void 
add_ptr (void *p, char *name)
{
  struct libhandlelist *tmp;
  if (p == NULL)
    return;
  tmp = (struct libhandlelist *) malloc (sizeof (struct libhandlelist));
  tmp->ptr = p;
  tmp->librarypath = (char *) malloc (sizeof (char) * (strlen (name) + 1));
  strcpy (tmp->librarypath, name);
  tmp->next = list;
  list = tmp;
}

/* Inserts the specified DLL at the start of the DLL list */
/* All the other entries are "moved down" by one. */
/* Returns 1 if the library was successfully added */
/* and returns 0 if there library table is full or */
/* or if dlopen fails for some reason. */

static int AddDLL(char *path)
{
  void *handle;
  handle = dlopen(path, RTLD_LAZY|RTLD_GLOBAL);
  if(handle == NULL){
	printf("%s\n",dlerror());
    return 0;
}
  add_ptr(handle,path);
  return 1;
}

static void RemoveFromHashTable (void *);

/* Remove the specified DLL from the current DLL list */
/* Returns 1 if the DLL was found and removed from */
/* the list and returns 0 otherwise. */

static int DeleteDLL(char *path)
{
  struct libhandlelist *ptr, *oldptr=NULL;
  ptr = list;
  while (ptr != NULL)
    {
      if (strcmp (ptr->librarypath, path) == 0)
	{
	  RemoveFromHashTable (ptr->ptr);
	  dlclose (ptr->ptr);
	  free (ptr->librarypath);
	  if (list == ptr)
	    list = ptr->next;
	  else
	    oldptr->next = ptr->next;
	  free (ptr);
	  return 1;
	}
      oldptr = ptr;
      ptr = ptr->next;
    }
  return 0;
}

typedef struct HashTabElem
  {
    CFunTabEntry data;
    struct HashTabElem *next;
    void *libraryhandle;
  }
HashTabElem;


/* HashTable stores name - pointer pairs with chaining. Sometimes      */
/* the hashtable  will be expanded and reorganized. The implementation */
/* is entirely elementary.  Possible sizes of the table are 2^p+1      */
/* where p is a positive integer.                                      */

static HashTabElem **HashTable;
static int HASHSIZE;
static int NumberElem;


static int 
HashCode (char *symbol)
{
  unsigned int code = 0;
  char *p = symbol;

  while (*p)
    code = 8 * code + *p++;
  return code % HASHSIZE;
}


static void 
HashInstall (char *name, DL_FUNC func, void *libhandle)
{
  int key;
  HashTabElem *newptr;
  newptr = (HashTabElem *) malloc (sizeof (HashTabElem));
  (newptr->data).name = (char *) malloc (strlen (name) + 1);
  strcpy ((newptr->data).name, name);
  (newptr->data).func = func;
  newptr->libraryhandle = libhandle;
  NumberElem++;
  key = HashCode (name);
  newptr->next = HashTable[key];
  HashTable[key] = newptr;
}


static void 
HashExpand ()
{
  int oldsize;
  int i;
  HashTabElem **OldTable;
  HashTabElem *ptr, *newptr;
  oldsize = HASHSIZE;
  OldTable = HashTable;
  HASHSIZE = 2 * HASHSIZE - 1;
  NumberElem = 0;
  HashTable = (HashTabElem **) malloc (HASHSIZE *
				       sizeof (HashTabElem *));
  for (i = 0; i < HASHSIZE; i++)
    HashTable[i] = NULL;

  for (i = 0; i < oldsize; i++)
    {
      ptr = OldTable[i];
      while (ptr != NULL)
	{
	  HashInstall (ptr->data.name, ptr->data.func, ptr->libraryhandle);
	  newptr = ptr->next;
	  free (ptr->data.name);
	  free (ptr);
	  ptr = newptr;
	}
    }
  free (OldTable);
}

static DL_FUNC 
HashLookup (char *symbol)
{
  int key;
  HashTabElem *ptr;
  key = HashCode (symbol);
  ptr = HashTable[key];
  while (ptr != NULL)
    {
      if (strcmp (symbol, (ptr->data).name) == 0)
	return (ptr->data).func;
      ptr = ptr->next;
    }
  return NULL;
}


static void 
RemoveFromHashTable (void *handle)
{
  int key;
  HashTabElem *ptr, *oldptr=NULL;
  for (key = 0; key < HASHSIZE; key++)
    {
      ptr = HashTable[key];
      while (ptr != NULL)
	{
	  if (ptr->libraryhandle == handle)
	    {
	      if (HashTable[key] == ptr)
		{
		  HashTable[key] = ptr->next;
		  free ((ptr->data).name);
		  free (ptr);
		  ptr = HashTable[key];
		}
	      else
		{
		  oldptr->next = ptr->next;
		  free ((ptr->data).name);
		  free (ptr);
		  ptr = oldptr->next;
		}
	    }
	  else
	    {
	      oldptr = ptr;
	      ptr = ptr->next;
	    }
	}
    }
}



/* findDynProc checks whether one of the libraries    */
/* that have been loaded contains the symbol name and */
/* returns a pointer to that symbol and the library   */ 
/* handle upon success.                               */


DL_FUNC 
findDynProc (char const *name, void **handle)
{
  struct libhandlelist *tmp;
  DL_FUNC fcnptr;
  for (tmp = list; tmp != NULL; tmp = tmp->next)
    {
      /* The following line is not legal ANSI C. */
      /* It is only meant to be used in systems supporting */
      /* the dlopen() interface, in which systems data and  */
      /* function pointers _are_ the same size and _can_   */
      /* be cast without loss of information.              */
      fcnptr = (DL_FUNC) dlsym (tmp->ptr, name);
      if (fcnptr != NULL)
	{
	  *handle = tmp->ptr;
	  return fcnptr;
	}
    }
  return NULL;
}


DL_FUNC R_FindSymbol(char const *name)
{
  char buf[MAXIDSIZE+1];
  DL_FUNC fcnptr=NULL;
  void *libhandle;
  sprintf(buf, "%s", name);
     if (!(fcnptr = HashLookup (buf)))
    {
      if ((fcnptr = findDynProc (buf, &libhandle)))
	{
	  if ((1.0 * NumberElem) / HASHSIZE > 0.5)
	    HashExpand ();
	  HashInstall (buf, fcnptr, libhandle);
	}
    }
if(fcnptr!=NULL)
return fcnptr;
  sprintf(buf, "%s_", name);
  
     if (!(fcnptr = HashLookup (buf)))
    {
      if ((fcnptr = findDynProc (buf, &libhandle)))
	{
	  if ((1.0 * NumberElem) / HASHSIZE > 0.5)
	    HashExpand ();
	  HashInstall (buf, fcnptr, libhandle);
	}
    }

 return fcnptr;
}


void 
InitFunctionHashing ()
{
  int n;
  int i, size = 3;
#ifdef OLD
  NaokSymbol = install ("NAOK");
  DupSymbol = install ("DUP");
#endif
  n = sizeof (CFunTab) / sizeof (CFunTabEntry);
  while (size < n/2 )
    size = 2 * size - 1;
  HASHSIZE = size;
  NumberElem = 0;
  HashTable = (HashTabElem **) malloc (HASHSIZE * sizeof (HashTabElem *));
  for (i = 0; i < HASHSIZE; i++)
    HashTable[i] = NULL;
  for (i = 0; CFunTab[i].name; i++)
    HashInstall (CFunTab[i].name, CFunTab[i].func, NULL);
  HashExpand ();
}


static void GetFullDLLPath(SEXP call, char *buf, char *path)
{
	if(path[0] != '/') {
		if(!getwd(buf))
			errorcall(call, "can't get working directory!\n");
		strcat(buf, "/");
		strcat(buf, path);
	}
	else strcpy(buf, path);
}

	/* do_dynload implements the R-Interface for the */
	/* loading of shared libraries */

SEXP do_dynload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	char buf[2*MAXPATHLEN];
	checkArity(op,args);
	if (!isString(CAR(args)) || length(CAR(args)) < 1)
		errorcall(call, "character argument expected\n");
	GetFullDLLPath(call, buf, CHAR(STRING(CAR(args))[0]));
	DeleteDLL(buf);
	if(!AddDLL(buf))
		errorcall(call, "unable to load shared library \"%s\"\n", buf);
	return R_NilValue;
}

SEXP do_dynunload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	char buf[2*MAXPATHLEN];
	checkArity(op,args);
	if (!isString(CAR(args)) || length(CAR(args)) < 1)
		errorcall(call, "character argument expected\n");
	GetFullDLLPath(call, buf, CHAR(STRING(CAR(args))[0]));
	if(!DeleteDLL(buf))
		errorcall(call, "shared library \"%s\" was not loaded\n", buf);
	return R_NilValue;
}

#else

void InitFunctionHashing()
{
#ifdef OLD
        NaokSymbol = install("NAOK");
        DupSymbol = install("DUP");
#endif
}

DL_FUNC R_FindSymbol(char const *name)
{
	int i;
	for(i=0 ; CFunTab[i].name ; i++)
		if(!strcmp(name, CFunTab[i].name))
			return CFunTab[i].func;
	return (DL_FUNC)0;
}

SEXP do_dynload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	error("no dyn.load support in this R version\n");
}

SEXP do_dynunload(SEXP call, SEXP op, SEXP args, SEXP env)
{
	error("no dyn.load support in this R version\n");
}

#endif



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 22 16:14:51 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 22 Apr 1999 11:14:51 -0400 (EDT)
Subject: Assigning to a list within a loop (PR#175)
In-Reply-To: <199904220345.FAA28639@pubhealth.ku.dk>
Message-ID: <Pine.SV4.4.05.9904221109250.7304-100000@hsph.harvard.edu>



On Thu, 22 Apr 1999 wvenable@arcola.stats.adelaide.edu.au wrote:

> We noticed this bug in more complex code, but this succinctly
> describes the phenomenon.
> 
> If you do not re-initialize a each time in the following loop,
> the final value only is assigned to all places when the loop is
> complete.
> 
> > a <- b <- list()
> > for(i in 1:5) {
> +	a$alpha <- i
> +	b[[i]] <- a
> +	}
> > unlist(b)
> alpha alpha alpha alpha alpha 
>     5     5     5     5     5 
> 
> If a is re-created each time, however the correct behaviour
> happens:
> 
> 
> > b <- list()
> > for(i in 1:5) {
> +	  a <- list(alpha = i)
> +	  b[[i]] <- a
> +	  }
> > unlist(b)
> alpha alpha alpha alpha alpha 
>     1     2     3     4     5 
> 
> > version
>            _                 
> platform   i586-unknown-linux
> arch       i586              
> os         linux             
> system     i586, linux       
> status                       
> status.rev 0                 
> major      0                 
> minor      64.0              
> year       1999              
> month      April             
> day        8                 
> language   R                 
> >
> 
> Bill Venables & Berwin Turlach.
> 
  I think that worse things could happen, the problem seems to be around
 line 1486 of subassign (the first line is missing in the current source)

  1486              if( NAMED(y) ) y = duplicate(y);
  1487              VECTOR(x)[offset] = y;
  1488              break;
  1489

  I think that you need to duplicate y, and have added that line;
  but perhaps what you need to do is to increment NAMED of y(???)
  I'll commit it if Ross doesn't yell too loud

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Thu Apr 22 17:59:44 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Thu, 22 Apr 1999 18:59:44 +0200 (CEST)
Subject: mvfft
Message-ID: <XFMail.990422185944.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Type: text/plain; charset=us-ascii

R-0.64.0 on RedHat Linux 5.1

Some problems with multivariate fast fourier transform. I
have attached the dump of a 30 x 3 matrix that seems to
reliably reproduce these problems

1) mvfft doesn't like vectors. It complains about not having
   enough memory:

R> mvfft(xx[,1])
Error: heap memory (2048 Kb) exhausted [needed 1024 Kb more]
       See "help(Memory)" on how to increase the heap size.

What in fact is happening here is that do_mvfft tries to
get the dimensions of the argument (fourier.c: 125), but 
gets junk instead, since the argument is not an array.

2) mvfft causes a segmentation fault or gets stuck in a loop

R> mvfft(xx)

Program received signal SIGSEGV, Segmentation fault.
0x80d36cb in fftmx (a=0x40617eb0, b=0x40617eb8, ntot=30, n=30, nspan=30, 
    isn=-2, m=3, kt=0, at=0x407c8f58, ck=0x407c8f80, bt=0x407c8fa8, 
    sk=0x407c8fd0, np=0x407c8ee4, nfac=0x8115a78) at fft.c:558
558         bt[j] = b[k1] - b[k2];
(gdb) print bt[j]
Cannot access memory at address 0x407cb000.
(gdb) print kspan
$4 = 0

We're in a loop here where kspan is the increment for k1 and decrement
for k2. The loop breaks when k1 < k2, but somehow kspan is zero.  How it
got there, I can't say, as we're in goto hell at this point.

Martyn

--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Disposition: attachment; filename="dumpdata"
Content-Transfer-Encoding: 7bit
Content-Description: dumpdata
Content-Type: text/plain; charset=us-ascii; name=dumpdata; SizeOnDisk=946

"xx" <-
structure(c(2.80791, 2.92504, 3.02911, 2.85911, 3.28071, 3.43015, 
2.3898, 1.67055, 3.81164, 2.43832, 2.92065, 1.37547, 3.23811, 
2.96203, 2.83998, 2.36596, 3.51832, 2.59301, 3.08633, 2.87675, 
3.16977, 2.81822, 2.48206, 3.28322, 2.51132, 3.01153, 3.25603, 
2.98599, 2.93238, 2.12555, 1.15452, 0.625684, 0.708469, 0.984351, 
0.576846, 0.228625, 1.40307, 1.21012, 0.143615, 1.4046, 1.32799, 
0.0254974, 1.17005, 1.28567, 1.51562, 0.842245, 0.852613, 0.780749, 
0.967637, 0.810536, 0.858167, 0.960625, 0.613509, 1.38389, 1.22199, 
0.93934, 0.479022, 0.684411, 0.907639, 0.694256, 0.637226, 0.698318, 
0.404093, 0.979977, 1.42097, 0.761441, 1.0802, 2.09035, 2.85473, 
2.44305, 1.81988, 1.78082, 1.69385, 0.643862, 1.5311, 0.960032, 
0.69531, 0.821253, 0.49187, 0.394229, 0.806075, 0.557793, 0.694918, 
1.46079, 1.56847, 0.823876, 0.73726, 0.698766, 0.800476, 1.45114
), .Dim = c(30, 3), .Dimnames = list(NULL, c("alpha", "beta", 
"sigma")))

--_=XFMail.1.3.p0.Linux:990422185944:4782=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Thu Apr 22 17:54:53 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Thu, 22 Apr 1999 18:54:53 +0200 (MET DST)
Subject: mvfft (PR#176)
Message-ID: <199904221654.SAA07496@pubhealth.ku.dk>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Type: text/plain; charset=us-ascii

R-0.64.0 on RedHat Linux 5.1

Some problems with multivariate fast fourier transform. I
have attached the dump of a 30 x 3 matrix that seems to
reliably reproduce these problems

1) mvfft doesn't like vectors. It complains about not having
   enough memory:

R> mvfft(xx[,1])
Error: heap memory (2048 Kb) exhausted [needed 1024 Kb more]
       See "help(Memory)" on how to increase the heap size.

What in fact is happening here is that do_mvfft tries to
get the dimensions of the argument (fourier.c: 125), but 
gets junk instead, since the argument is not an array.

2) mvfft causes a segmentation fault or gets stuck in a loop

R> mvfft(xx)

Program received signal SIGSEGV, Segmentation fault.
0x80d36cb in fftmx (a=0x40617eb0, b=0x40617eb8, ntot=30, n=30, nspan=30, 
    isn=-2, m=3, kt=0, at=0x407c8f58, ck=0x407c8f80, bt=0x407c8fa8, 
    sk=0x407c8fd0, np=0x407c8ee4, nfac=0x8115a78) at fft.c:558
558         bt[j] = b[k1] - b[k2];
(gdb) print bt[j]
Cannot access memory at address 0x407cb000.
(gdb) print kspan
$4 = 0

We're in a loop here where kspan is the increment for k1 and decrement
for k2. The loop breaks when k1 < k2, but somehow kspan is zero.  How it
got there, I can't say, as we're in goto hell at this point.

Martyn

--_=XFMail.1.3.p0.Linux:990422185944:4782=_
Content-Disposition: attachment; filename="dumpdata"
Content-Transfer-Encoding: 7bit
Content-Description: dumpdata
Content-Type: text/plain; charset=us-ascii; name=dumpdata; SizeOnDisk=946

"xx" <-
structure(c(2.80791, 2.92504, 3.02911, 2.85911, 3.28071, 3.43015, 
2.3898, 1.67055, 3.81164, 2.43832, 2.92065, 1.37547, 3.23811, 
2.96203, 2.83998, 2.36596, 3.51832, 2.59301, 3.08633, 2.87675, 
3.16977, 2.81822, 2.48206, 3.28322, 2.51132, 3.01153, 3.25603, 
2.98599, 2.93238, 2.12555, 1.15452, 0.625684, 0.708469, 0.984351, 
0.576846, 0.228625, 1.40307, 1.21012, 0.143615, 1.4046, 1.32799, 
0.0254974, 1.17005, 1.28567, 1.51562, 0.842245, 0.852613, 0.780749, 
0.967637, 0.810536, 0.858167, 0.960625, 0.613509, 1.38389, 1.22199, 
0.93934, 0.479022, 0.684411, 0.907639, 0.694256, 0.637226, 0.698318, 
0.404093, 0.979977, 1.42097, 0.761441, 1.0802, 2.09035, 2.85473, 
2.44305, 1.81988, 1.78082, 1.69385, 0.643862, 1.5311, 0.960032, 
0.69531, 0.821253, 0.49187, 0.394229, 0.806075, 0.557793, 0.694918, 
1.46079, 1.56847, 0.823876, 0.73726, 0.698766, 0.800476, 1.45114
), .Dim = c(30, 3), .Dimnames = list(NULL, c("alpha", "beta", 
"sigma")))

--_=XFMail.1.3.p0.Linux:990422185944:4782=_--
End of MIME message

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Thu Apr 22 20:06:05 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Thu, 22 Apr 1999 15:06:05 -0400 (EDT)
Subject: options
In-Reply-To: <199904220345.FAA28639@pubhealth.ku.dk>
Message-ID: <Pine.SV4.4.05.9904221440170.7304-100000@hsph.harvard.edu>


 Before I go too far down the wrong track we need to think a little bit
about how "options" is going to behave in a threaded environment. The
reason for this is that S uses "options" to control most of the error
handling.
 I'm sure that we want thread specific behaviour and that seems to imply
that "options" is going to have to be thread specific. Without worrying
about how we are going to achieve that, does anyone have any qualms
about this?
 Duncan has said that in S, when he threaded it, options was a frame 0
object and frame 0 was thread specific. We don't really have frames.
Conceptually it seems that we are going to have to stick an environment
between GlobalEnv and any evaluation envs where that environment 
contains thread specific items (perhaps all assignments along that
thread).


  As for error handling S offers:
    error, interrupt, and warning.expression
  as options. All of which are supposed to be expressions with no
arguments (no free variables I assume) that are evaluated when an
error, an interrupt or a warning occurs (if warning.expression is
non-null then options("warn") is ignored).
  I should get those in today.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 22 22:55:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 22 Apr 1999 23:55:14 +0200
Subject: options
In-Reply-To: Robert Gentleman's message of "Thu, 22 Apr 1999 15:06:05 -0400 (EDT)"
References: <Pine.SV4.4.05.9904221440170.7304-100000@hsph.harvard.edu>
Message-ID: <x2ogkggw1p.fsf@blueberry.kubism.ku.dk>

Robert Gentleman <rgentlem@hsph.harvard.edu> writes:

>  Duncan has said that in S, when he threaded it, options was a frame 0
> object and frame 0 was thread specific. We don't really have frames.
> Conceptually it seems that we are going to have to stick an environment
> between GlobalEnv and any evaluation envs where that environment 
> contains thread specific items (perhaps all assignments along that
> thread).

Hmm. Ross has also been talking about "frame 0" when talking about
attachments to position 1. Does that fit in?

If I get the picture right (I've never tried threads in S), there may
be an alternative where the thread-specific environment sits on top of
the the environment from which the thread is started, rather than
GlobalEnv.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Fri Apr 23 14:33:52 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Fri, 23 Apr 1999 09:33:52 -0400 (EDT)
Subject: options and other things
In-Reply-To: <x2ogkggw1p.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904230925260.20965-100000@hsph.harvard.edu>



On 22 Apr 1999, Peter Dalgaard BSA wrote:

> Robert Gentleman <rgentlem@hsph.harvard.edu> writes:
> 
> >  Duncan has said that in S, when he threaded it, options was a frame 0
> > object and frame 0 was thread specific. We don't really have frames.
> > Conceptually it seems that we are going to have to stick an environment
> > between GlobalEnv and any evaluation envs where that environment 
> > contains thread specific items (perhaps all assignments along that
> > thread).
> 
> Hmm. Ross has also been talking about "frame 0" when talking about
> attachments to position 1. Does that fit in?
> 
> If I get the picture right (I've never tried threads in S), there may
> be an alternative where the thread-specific environment sits on top of
> the the environment from which the thread is started, rather than
> GlobalEnv.
> 
Brian's comment is correct, only Duncan and John ever played with threaded
S and it currently doesn't work with some high probability (and Duncan
said he didn't think it ever would be publicly available).

I guess what I'm thinking is that all threads get started from GlobalEnv,
but that there has to be an extra thread specific env stuck in right
on top of GlobalEnv and before any evaluation envs (so that thread 
specific info can be handled appropriately).

However, having done a little reading over the past few days I'm a bit
discouraged about how difficult it will be to get this stuff correct.
According to at least one author, threads are hard but they are infinitely
easier than signal catching/exception handling. So making a function
thread-safe is possible (not all C level ones that we use are) making
it reentrant on an asynchronous signal is much more difficult.

I am also coming quickly to the belief that POSIX might be the right
coding standard for R. It at least has some standard stuff for letting
you know (at compile time) what level of thread safety is available in
the C library. 

Does that have bad implications for you and Guido, Brian? I'm a bit
worried because alot of the signal handling is if-def'd for Unix only.
Perhaps it should shift and be if-def'd for the correct level of 
POSIX?

What about the Mac?

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri Apr 23 18:13:32 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 23 Apr 1999 19:13:32 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: <199904220944.LAA10647@gwen.stat.unipd.it.>
References: <199904220944.LAA10647@gwen.stat.unipd.it.>
Message-ID: <199904231713.TAA15277@sophie.ethz.ch>

Dear Prof Azzalini,

You have an interesting example of  recursive use of  uniroot().
    [re-cited at the end]
However, note that R currently has the same problem as S-plus:

Uniroot() doesn't work reliably, recursively.
When you found it to be better, you were just lucky.

The relevant file in R's source,   src/main/optimize.c
says 

   /* WARNING : As things stand, these routines should not be called
    *	     recursively because of the way global variables are used.
    *	     This could be fixed by saving and restoring these global variables.
    */

--------

Fellow R-code developpers :  

       Does anyone of you feel like fixing these?
       Would be really nice and useful!

       (and you will become famous in the R community ... :-)

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum SOL G1;	Sonneggstr.33
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1086			<><

>>>>> "AA" == Adelchi Azzalini <aa@gwen.stat.unipd.it> writes 
      to S-news on 22 Apr 1999 :

    AA> Dear S+ users,

    AA> has anyone experienced problems with uniroot(), in Splus 4.5?  
    AA> In my case, it locates a (non-existing) solution outside the 
    AA> given search interval. The S-news database on Statlib does not
    AA> show anything of this sort.

    AA> In the sample problem below, a root is searched in  the 
    AA> interval ( 0.02418690, 0.07753657), with an existing solution
    AA> near  0.05408. 
    AA> However uniroot comes up with the the answer -0.6160564 (!)

    AA> The code below should reproduce the problem.
    AA> Possibly, the problem is due to the recursive call to uniroot().
    AA> However, R 0.64 produces more sensible answers.

    AA> Regards
    AA> Adelchi Azzalini

    AA> #---------------------------------------------------

    AA> f.dev <- function(mu,y,crit) f.deviance(mu,y,F)-crit

    AA> f.deviance <- function(mu, y, display=F){
    AA> g <- function(x,d) mean(d/(1+x*d))
    AA> epsilon<-(1e-8)
    AA> W<-rep(NA,length=length(mu))
    AA> for(i in 1:length(mu)) {
    AA> d <- (y-mu[i])
    AA> interv<- c(-1/max(d)+epsilon,-1/min(d)-epsilon)
    AA> root <- uniroot(g,interval=interv,d=d) 
    AA> lambda<-root$root
    AA> W[i] <- 2*sum(log(1+lambda*d))
    AA> if(is.na(W[i])| W[i]<0) warning("W<0 or W==NA")
    AA> }
    AA> if(length(mu)>1 & display) plot(mu,W,type="l")
    AA> return(W)
    AA> }

    AA> #-----------------
    AA> #  sample problem:
    AA> #
    AA> y <- c(0.8931869, 0.6805792, 0.8349237, rep(0,97))
    AA> interv <- c( 0.02418690, 0.07753657)
    AA> crit <- 2.705543

    AA> print(f.dev(interv,y,crit))
    AA> # [1] -2.705491  3.881472

    AA> print(f.dev(0.05408, y,crit))
    AA> # [1] -0.0001011083

    AA> uniroot(f.dev, interval=interv, y=y, crit=crit)$root
    AA> # [1] -0.6160564
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgutwin@us.ibm.com  Fri Apr 23 19:08:57 1999
From: pgutwin@us.ibm.com (pgutwin@us.ibm.com)
Date: Fri, 23 Apr 1999 20:08:57 +0200 (MET DST)
Subject: R won't compile on Redhat 5.2 (PR#177)
Message-ID: <199904231808.UAA17927@pubhealth.ku.dk>

Full_Name: Paul Gutwin
Version: R-0.64.0
OS: Redhat 5.2
Submission from: (NULL) (198.133.22.73)


I built a new Linux machine, and was trying to install R on it. I get the
following
message during the build:

make[2]: Entering directory `/usr/src/R-0.64.0/src/nmath'
gcc -g -O2 -I../include -I../../src/include  -c mlutils.c -o mlutils.o
gcc -g -O2 -I../include -I../../src/include  -c d1mach.c -o d1mach.o
gcc: Internal compiler error: program cc1 got fatal signal 6
make[2]: *** [d1mach.o] Error 1
make[2]: Leaving directory `/usr/src/R-0.64.0/src/nmath'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/usr/src/R-0.64.0/src'
make: *** [R] Error 1

I've built R on an older Linux system without trouble.



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sat Apr 24 00:50:48 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 24 Apr 1999 01:50:48 +0200
Subject: R won't compile on Redhat 5.2 (PR#177)
In-Reply-To: pgutwin@us.ibm.com's message of "Fri, 23 Apr 1999 20:08:57 +0200 (MET DST)"
References: <199904231808.UAA17927@pubhealth.ku.dk>
Message-ID: <x2k8v2dhgn.fsf@blueberry.kubism.ku.dk>

pgutwin@us.ibm.com writes:

> I built a new Linux machine, and was trying to install R on it. I get the
> following
> message during the build:
> 
> make[2]: Entering directory `/usr/src/R-0.64.0/src/nmath'
> gcc -g -O2 -I../include -I../../src/include  -c mlutils.c -o mlutils.o
> gcc -g -O2 -I../include -I../../src/include  -c d1mach.c -o d1mach.o
> gcc: Internal compiler error: program cc1 got fatal signal 6

> I've built R on an older Linux system without trouble.

That looks like a system problem more than anything else. R gets
rebuilt on RedHat 5.2 a couple of times per day, usually. Are you sure
your RAM sticks are seated properly, etc.?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Sun Apr 25 00:41:04 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 25 Apr 1999 01:41:04 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Martin Maechler's message of "Fri, 23 Apr 1999 19:13:32 +0200"
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch>
Message-ID: <x2yajhh9in.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> Dear Prof Azzalini,
> 
> You have an interesting example of  recursive use of  uniroot().
...
> Fellow R-code developpers :  
> 
>        Does anyone of you feel like fixing these?
>        Would be really nice and useful!
> 
>        (and you will become famous in the R community ... :-)

Well, uniroot calls zeroin which is a FORTRAN routine. As long as this
is the case, all bets are off as to whether or not it will be
reentrant on any given system. In principle, it is not, and FORTRAN
just plain states that "you cannot do that", but if your compiler
happens to be f2c-like, and no global storage is involved, then it
*might* work after all. The example doesn't work on my system either.

The only sensible thing to do to get this to work is to rewite zeroin
in C. According to the comments in the file, it is a transcription of
an Algol60 program, so it is probably not hard to convert it to
another Algol descendant.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From naras@stat.stanford.edu  Mon Apr 26 00:55:36 1999
From: naras@stat.stanford.edu (Balasubramanian Narasimhan)
Date: Sun, 25 Apr 1999 16:55:36 -0700 (PDT)
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Your message of "25 Apr 1999 01:41:04 +0200"
 <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
Message-ID: <19990425165536M.naras@stat.Stanford.EDU>

>>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    Peter> The only sensible thing to do to get this to work is to
    Peter> rewite zeroin in C. According to the comments in the file,
    Peter> it is a transcription of an Algol60 program, so it is
    Peter> probably not hard to convert it to another Algol
    Peter> descendant.

Agreed, but there's no need for a rewrite. A C version has been
available in Netlib for some time.

________________________________________________________________
B. Narasimhan                            naras@stat.stanford.edu
                             http://www-stat.stanford.edu/~naras





-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From adelchi.azzalini@jrc.it  Mon Apr 26 10:12:35 1999
From: adelchi.azzalini@jrc.it (Adelchi Azzalini)
Date: Mon, 26 Apr 1999 10:12:35 +0100
Subject: [S] uniroot -- doesn't work recursively
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch> <x2yajhh9in.fsf@blueberry.kubism.ku.dk>
Message-ID: <37242E03.63BEAB06@jrc.it>

Martin Maechler wrote:

) However, note that R currently has the same problem as S-plus:

) Uniroot() doesn't work reliably, recursively.
) When you found it to be better, you were just lucky.

Right.  I realised later on that R seemed to behave better but 
it could not work properly since it calls a Fortran (66? 77?) routine.
It just happen to produce less obviously wrong answers than Splus.
In fact more tests confirm wrong answers, but not as non-sensical 
as those from Splus.

To get around the problem,  I have replaced  f(x)=0 by f^2(x)=min,
where f(x)is computed with the aid of uniroot(), and the minimization
is solved by optimize(). This works.

Peter Dalgaard BSA wrote:
> 
> Martin Maechler <maechler@stat.math.ethz.ch> writes:
> 
> 
> Well, uniroot calls zeroin which is a FORTRAN routine. As long as this
> is the case, all bets are off as to whether or not it will be
> reentrant on any given system. In principle, it is not, and FORTRAN
> just plain states that "you cannot do that", but if your compiler
> happens to be f2c-like, and no global storage is involved, then it
> *might* work after all. The example doesn't work on my system either.
> 
> The only sensible thing to do to get this to work is to rewite zeroin
> in C. According to the comments in the file, it is a transcription of
> an Algol60 program, so it is probably not hard to convert it to
> another Algol descendant.
> 

My R 0.64 is obtained from the binary file distributed by CRAN in Wien
(compiled by Guido Masarotto?), so I do not know which the compiler is 
used.

Thanks for your comments

Regards
Adelchi Azzalini
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 13:57:21 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 14:57:21 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Balasubramanian Narasimhan's message of "Sun, 25 Apr 1999 16:55:36 -0700 (PDT)"
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU>
Message-ID: <x2r9p7v8su.fsf@blueberry.kubism.ku.dk>

Balasubramanian Narasimhan <naras@stat.stanford.edu> writes:

> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
> 
>     Peter> The only sensible thing to do to get this to work is to
>     Peter> rewite zeroin in C. According to the comments in the file,
>     Peter> it is a transcription of an Algol60 program, so it is
>     Peter> probably not hard to convert it to another Algol
>     Peter> descendant.
> 
> Agreed, but there's no need for a rewrite. A C version has been
> available in Netlib for some time.

Thanks for the pointer, Naras! 

Found, adapted and inserted (in my private source tree for now). It
wasn't a complete drop-in replacement since it didn't support max.iter
and didn't return convergence info, but close enough.

Unfortunately, closer inspection revealed that the Fortran-ness of
zeroin was not the only problem, there's also trouble with global
storage used by the wrapper routine. And since C doesn't have lexical
scoping, that stuff needs to be passed around via arguments. Oh
well...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon Apr 26 14:19:37 1999
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 26 Apr 1999 15:19:37 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: <x2r9p7v8su.fsf@blueberry.kubism.ku.dk> (message from Peter
 Dalgaard BSA on 26 Apr 1999 14:57:21 +0200)
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU> <x2r9p7v8su.fsf@blueberry.kubism.ku.dk>
Message-ID: <199904261319.PAA04686@sophie.ethz.ch>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> Balasubramanian Narasimhan <naras@stat.stanford.edu> writes:
    >> >>>>> "Peter" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
    >> writes:
    >> 
    Peter> The only sensible thing to do to get this to work is to rewite
    Peter> zeroin in C. According to the comments in the file, it is a
    Peter> transcription of an Algol60 program, so it is probably not hard
    Peter> to convert it to another Algol descendant.
    >>  Agreed, but there's no need for a rewrite. A C version has been
    >> available in Netlib for some time.

    PD> Thanks for the pointer, Naras!

    PD> Found, adapted and inserted (in my private source tree for now). It
    PD> wasn't a complete drop-in replacement since it didn't support
    PD> max.iter and didn't return convergence info, but close enough.

The max.iter and convergence info are things that Jim Lindsey and I had
ADDED to the original netlib/Fortran code.
It's the ``value-added'' part of the R (vs. S-plus) code...

    PD> Unfortunately, closer inspection revealed that the Fortran-ness of
    PD> zeroin was not the only problem, there's also trouble with global
    PD> storage used by the wrapper routine. And since C doesn't have
    PD> lexical scoping, that stuff needs to be passed around via
    PD> arguments. Oh well...

yes (I think that's what the comment in optimize.c [the wrapper] meant
     that I had cited here...).
and  YES  it would be really nice if that could be done, finally.

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 14:27:29 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 15:27:29 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Martin Maechler's message of "Mon, 26 Apr 1999 15:19:37 +0200"
References: <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <19990425165536M.naras@stat.Stanford.EDU> <x2r9p7v8su.fsf@blueberry.kubism.ku.dk> <199904261319.PAA04686@sophie.ethz.ch>
Message-ID: <x2pv4rv7em.fsf@blueberry.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

>     PD> zeroin was not the only problem, there's also trouble with global
>     PD> storage used by the wrapper routine. And since C doesn't have
>     PD> lexical scoping, that stuff needs to be passed around via
>     PD> arguments. Oh well...
> 
> yes (I think that's what the comment in optimize.c [the wrapper] meant
>      that I had cited here...).
> and  YES  it would be really nice if that could be done, finally.

It is done now. (Actually took about as much time as writing the email
griping about it...)

>      uniroot(f.dev, interval=interv, y=y, crit=crit)     
$root
[1] 0.05408745

$f.root
[1] 0.0009728222

$iter
[1] 5

$estim.prec
[1] 6.103516e-05

I'll commit my stuff in a moment.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Mon Apr 26 15:54:51 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 26 Apr 1999 16:54:51 +0200
Subject: [S] uniroot -- doesn't work recursively
In-Reply-To: Adelchi Azzalini's message of "Mon, 26 Apr 1999 10:12:35 +0100"
References: <199904220944.LAA10647@gwen.stat.unipd.it.> <199904231713.TAA15277@sophie.ethz.ch> <x2yajhh9in.fsf@blueberry.kubism.ku.dk> <37242E03.63BEAB06@jrc.it>
Message-ID: <x2n1zvv3d0.fsf@blueberry.kubism.ku.dk>

Adelchi Azzalini <adelchi.azzalini@jrc.it> writes:

> Martin Maechler wrote:
> 
> ) However, note that R currently has the same problem as S-plus:
> 
> ) Uniroot() doesn't work reliably, recursively.
> ) When you found it to be better, you were just lucky.
> 
> Right.  I realised later on that R seemed to behave better but 
> it could not work properly since it calls a Fortran (66? 77?) routine.
> It just happen to produce less obviously wrong answers than Splus.
> In fact more tests confirm wrong answers, but not as non-sensical 
> as those from Splus.

The development version now has a reentrant uniroot(). Those of you
outside R-core who are interested can get it in the next development
snapshot. (and perhaps remind me what is the proper typecast to avoid
the following error message...)

optimize.c: In function `do_zeroin':
optimize.c:205: warning: passing arg 3 of `zeroin' from incompatible pointer type

Binaries are a bit further into the future, I'm afraid.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Mon Apr 26 17:47:23 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 26 Apr 1999 12:47:23 -0400
Subject: [R] random sequence
References: <0FAS00HIDRIZW5@hermes.ucd.ie>
Message-ID: <3724989B.D57AC481@bank-banque-canada.ca>

>How can I get the same stream of random numbers in R and S?

I'd like to do this too.  I think you need to extract the RNG C code from R and
compile then dynload it into S. If you get it working please let me know.

Thanks,

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Prof Brian Ripley <ripley@stats.ox.ac.uk>  Mon Apr 26 18:10:32 1999
From: Prof Brian Ripley <ripley@stats.ox.ac.uk> (Prof Brian Ripley)
Date: Mon, 26 Apr 1999 18:10:32 +0100 (BST)
Subject: [R] random sequence
Message-ID: <199904261710.SAA08747@toucan.stats.ox.ac.uk>

> Date: Mon, 26 Apr 1999 12:47:23 -0400
> From: Paul Gilbert <pgilbert@bank-banque-canada.ca>
> 
> >How can I get the same stream of random numbers in R and S?
> 
> I'd like to do this too.  I think you need to extract the RNG C code from R 
and
> compile then dynload it into S. If you get it working please let me know.


What exactly do you want?  My class exercise is to implement the
Wichmann-Hill algorithm in C/Fortran and use it with S-PLUS! But
while one is at it, why not use a decent generator with both?

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From rgentlem@hsph.harvard.edu  Mon Apr 26 21:08:02 1999
From: rgentlem@hsph.harvard.edu (Robert Gentleman)
Date: Mon, 26 Apr 1999 16:08:02 -0400 (EDT)
Subject: problems with formals and get (PR#151)
In-Reply-To: <x2d80ruru1.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.SV4.4.05.9904261603320.27933-100000@hsph.harvard.edu>

Peter wrote:


jlindsey@alpha.luc.ac.be writes:

> With 0.63.3, try
> 
> test <- function(){
>       fn <- function(a) print("hello")
>       print(is.function(fn))
>       print(names(formals("fn")))}
> test()
> 
> if fn is not quoted in the last line of test, it works properly.

This version of formals seems to work better:

function (fun = sys.function(sys.parent())) 
{
    if (is.character(fun)) 
        fun <- get(fun, mode = "function", envir =
sys.frame(sys.parent()))
    .Internal(formals(fun))
}

> test <- function(){
>       fn <- function() print("hello")
>       formals(fn) <- alist(a=,b=)
>       return(fn)}
> formals(test())
> 
> now try with line 3 of test changed to
>       formals(fn) <- alist(a=)

This is a bug, originating in sys.call:

> xx<-function(...)sys.call()
> xx(a=)
xx()
> xx(a=,b=)
xx(a = , b = )



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~

Bzzt: the bug was in gram.y not in sys.call.
It should be fixed now. If an arg list only had one element and
that element didn't have a default the arglist was being
stripped.

I also committed Peter's improved version of formals.

All this is in the 0.65 (unstable) branch.


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Tue Apr 27 12:52:05 1999
From: plummer@iarc.fr (Martyn Plummer)
Date: Tue, 27 Apr 1999 13:52:05 +0200 (CEST)
Subject: mvfft (PR#176)
Message-ID: <XFMail.990427135205.plummer@iarc.fr>

This message is in MIME format
--_=XFMail.1.3.p0.Linux:990427135205:436=_
Content-Type: text/plain; charset=us-ascii

This should fix it.
1) Check that the dimensions are not null.
2) Call fft_factor before each call to fft_work.  The array nfac
   is set by fft_factor and overwritten by fftmx (in src/appl/fft.c,
   called by fft_work). Since nfac is not an argument of fft_work,
   nor of fft_factor it is not easy to spot the bug!

--_=XFMail.1.3.p0.Linux:990427135205:436=_
Content-Disposition: attachment; filename="fourier.diff"
Content-Transfer-Encoding: 7bit
Content-Description: fourier.diff
Content-Type: text/plain; charset=us-ascii; name=fourier.diff; SizeOnDisk=833

diff -uNr R-0.64.0/src/main/fourier.c R-fixed/src/main/fourier.c
--- R-0.64.0/src/main/fourier.c	Fri Feb  5 07:44:44 1999
+++ R-fixed/src/main/fourier.c	Tue Apr 27 12:44:48 1999
@@ -123,7 +123,7 @@
     z = CAR(args);
 
     d = getAttrib(z, R_DimSymbol);
-    if (length(d) > 2)
+    if (d == R_NilValue || length(d) > 2)
 	errorcall(call, "vector-valued series required\n");
     n = INTEGER(d)[0];
     p = INTEGER(d)[1];
@@ -156,9 +156,11 @@
 	    errorcall(call, "fft factorization error\n");
 	work = (double*)R_alloc(4 * maxf, sizeof(double));
 	iwork = (int*)R_alloc(maxp, sizeof(int));
-	for (i = 0; i < p; i++)
+	for (i = 0; i < p; i++) {
+	    fft_factor(n, &maxf, &maxp);
 	    fft_work(&(COMPLEX(z)[i*n].r), &(COMPLEX(z)[i*n].i),
 		     1, n, 1, inv, work, iwork);
+        }
 	vmaxset(vmax);
     }
     UNPROTECT(1);

--_=XFMail.1.3.p0.Linux:990427135205:436=_--
End of MIME message
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Tue Apr 27 17:54:48 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 27 Apr 1999 12:54:48 -0400
Subject: ts
Message-ID: <3725EBD8.9C58131C@bank-banque-canada.ca>

ts() is giving me problems on Solaris:

R : Copyright 1999, The R Development Core Team
Version 0.64.0  (April 8, 1999)
...
> z <- ts(matrix(1:20,10,2), start=c(1969,1), frequency=12)
> max(abs(z-z))
Error: invalid time series parameters specified
> traceback()
[1] "max(abs(z - z))"
> max(abs(z+z))
Error: invalid time series parameters specified
>

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Tue Apr 27 18:32:05 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Tue, 27 Apr 1999 19:32:05 +0200 (MET DST)
Subject: Multivariate ts -- arithmetic bug [ for SOME time-series ] (PR#178)
Message-ID: <199904271732.TAA18748@pubhealth.ku.dk>


Paul wrote to R-devel :

    PaulG> ts() is giving me problems on Solaris:
    PaulG> R : Copyright 1999, The R Development Core Team
    PaulG> Version 0.64.0  (April 8, 1999)
    PaulG> ...
    >> z <- ts(matrix(1:20,10,2), start=c(1969,1), frequency=12)
    >> max(abs(z-z))
    PaulG> Error: invalid time series parameters specified
    >> traceback()
    PaulG> [1] "max(abs(z - z))"
    >> max(abs(z+z))
    PaulG> Error: invalid time series parameters specified

This is a SEVERE (new?) bug.

it's already visible as

  > z <- ts(matrix(1:48,ncol=2), start=c(1969,1), frequency=12);  z+z
  Error: invalid time series parameters specified

Note that not all multivariate  ts show the problem; e.g.,

  > data(presidents) # also a multivariate ts
  > p <- presidents
  > p + p
  > 3 * p

all work

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Tue Apr 27 22:38:32 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 27 Apr 1999 23:38:32 +0200
Subject: Multivariate ts -- arithmetic bug [ for SOME time-series ] (PR#178)
In-Reply-To: maechler@stat.math.ethz.ch's message of "Tue, 27 Apr 1999 19:32:05 +0200 (MET DST)"
References: <199904271732.TAA18748@pubhealth.ku.dk>
Message-ID: <x2aevt7nhj.fsf@blueberry.kubism.ku.dk>

maechler@stat.math.ethz.ch writes:


> This is a SEVERE (new?) bug.
> 
> it's already visible as
> 
>   > z <- ts(matrix(1:48,ncol=2), start=c(1969,1), frequency=12);  z+z
>   Error: invalid time series parameters specified

Found and squashed (setting tsp attrib before dims on the result is a
bad idea, since tspgets checks with for consistency with nrows(vec)!).
Committed for 0.64.1.

> 
> Note that not all multivariate  ts show the problem; e.g.,
> 
>   > data(presidents) # also a multivariate ts
>   > p <- presidents
>   > p + p
>   > 3 * p
> 
> all work

Erm. That one isn't multivariate:

> dim(p)
NULL

It's just getting prettyprinted in 4 columns because it happens to be
quarterly data...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From Friedrich.Leisch@ci.tuwien.ac.at  Wed Apr 28 16:31:47 1999
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Wed, 28 Apr 1999 17:31:47 +0200 (CEST)
Subject: configure for packages
Message-ID: <14119.10723.632172.658144@galadriel.ci.tuwien.ac.at>


when I get a working connection to auckland again I will commit a new
version of the INSTALL script which allows packages to run configure
befor anything else is done (hence create Makefiles and patch R code
depending on if some lib's are found etc.)

R INSTALL now works as follows:

	cd pkgdir
	if ./configure exists run it
	do everything as has been done until now
	if ./cleanup exists and flag --clean was used, run ./cleanup 

i.e., you can add 2 execs to the top-level directory of a package
which perform pre-installation configuration and post-installation
cleanup. cleanup should remove all files that were created by
configure.

the configure script may be created by autoconf but of course must
not.

I have put a new version of the e1071 package onto CRAN which uses
configure to search for the netpbm library. It currently only looks
for libnetpbm (correct for debian linux sytems). If the functions
pnm_readpnm & friends are contained in another lib on your system,
please let me know such that I can modify configure.in accordingly (or
better: send me the patched version :-))

.f







-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From ripley@stats.ox.ac.uk  Thu Apr 29 09:48:58 1999
From: ripley@stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Thu, 29 Apr 1999 10:48:58 +0200 (MET DST)
Subject: Problems with setting .Random.seed (PR#179)
Message-ID: <199904290848.KAA01351@pubhealth.ku.dk>

I have commited fixes for 0.64.1 for

(1) From: Mai Zhou <mai@ms.uky.edu>
> .Random.seed <- c(1, 1:2)
> .Random.seed
[1] 1 1 2
> runif(5)
Warning: Wrong length .Random.seed; forgot initial RNGkind? set to
Wichmann-Hill[1] 0.02253721 0.84832584  ........

Here the length of the seed was being tested before the kind was
picked out, so the length of the previous type was used.

(2) 
> .Random.seed <- c(0, 30269, 30307, 30323)
> runif(1)
[1] 0
> .Random.seed
[1] 0 0 0 0

and it remains zero thereafter.

This was particularly invidious as the help has said (for a long time,
despite my commenting several times, even in the `R Complements')

          The seed, `.Random.seed[-1] == r[1:3]' is an
          integer vector of length 3, where each `r[i]' is
          in `1:p[i]', where `p' is the length 3 vector of
          primes, `p = (30269, 30307, 30323)'. The

This should be (and will be) 1:(p[1] - 1).

(3) The help page now says what the length of the seed is and the
restrictions for the "Marsaglia-Multicarry" and "Super-Duper" kinds
and corrects the description of the latter.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From pgilbert@bank-banque-canada.ca  Thu Apr 29 18:28:33 1999
From: pgilbert@bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 29 Apr 1999 13:28:33 -0400
Subject: another ts problem
Message-ID: <372896C1.862C5EB8@bank-banque-canada.ca>

My previous ts problem is fixed in today's snapshot but ...

R : Copyright 1999, The R Development Core Team
Version 0.64.0 Patched (unreleased snapshot) (April 29, 1999)
...
> z <- ts(matrix(rnorm(300),100,3),start=c(1961,1), frequency=12)
> all(z==z)
Error: invalid time series parameters specified
>

Paul Gilbert

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr 29 19:04:49 1999
From: bates@stat.wisc.edu (Douglas Bates)
Date: 29 Apr 1999 13:04:49 -0500
Subject: gdb and f77
Message-ID: <6ru2tz5mm6.fsf@verdi.stat.wisc.edu>

I am trying to debug some code that uses the nlm optimizer but with
analytic gradient and hessian.  The optimization code itself is
written in Fortran ($RSRC/src/appl/uncmin.f).  I compiled 
 Version 0.64.0 Patched (unreleased snapshot) (April 29, 1999)
with the -g flag and ran it under gdb.  When I set a breakpoint at
heschk_ I can trace the execution and I can print the values of local
scalar variables or scalar arguments.  When I try to print the values
of array elements I am always getting a segmentation violation, either 
under the automatic choice of language (Fortran) or manually setting
the language to C.

Has anyone had experience with using gdb on Fortran code compiled with 
g77?  If so, can you tell me what syntax I should use to access an
array element.

This is the sort of thing that happens:
 ...
 ) at uncmin.f:1052
 Current language:  auto; currently fortran
 (gdb) set lang c
 Warning: the current language does not match this frame.
 (gdb) p j
 $1 = 1
 (gdb) p udiag
 $2 = (double precision (*)[536870911]) 0x421aee98
 (gdb) p udiag[1]

 Debugger segmentation fault
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 29 20:41:37 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 29 Apr 1999 21:41:37 +0200
Subject: another ts problem
In-Reply-To: Paul Gilbert's message of "Thu, 29 Apr 1999 13:28:33 -0400"
References: <372896C1.862C5EB8@bank-banque-canada.ca>
Message-ID: <x2d80nuscu.fsf@blueberry.kubism.ku.dk>

Paul Gilbert <pgilbert@bank-banque-canada.ca> writes:

> My previous ts problem is fixed in today's snapshot but ...

> > z <- ts(matrix(rnorm(300),100,3),start=c(1961,1), frequency=12)
> > all(z==z)
> Error: invalid time series parameters specified
> >

Pah! Exact same error, but in do_relop (relop.c)... Will fix.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From p.dalgaard@biostat.ku.dk  Thu Apr 29 21:14:14 1999
From: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: 29 Apr 1999 22:14:14 +0200
Subject: another ts problem
In-Reply-To: Peter Dalgaard BSA's message of "29 Apr 1999 21:41:37 +0200"
References: <372896C1.862C5EB8@bank-banque-canada.ca> <x2d80nuscu.fsf@blueberry.kubism.ku.dk>
Message-ID: <x24slzfall.fsf@blueberry.kubism.ku.dk>


> Pah! Exact same error, but in do_relop (relop.c)... Will fix.

..and the patch is this:

diff -c -r1.8.2.1 relop.c
*** /tmp/T0a005Bn       Fri Apr 30 08:03:10 1999
--- relop.c     Fri Apr 30 08:03:10 1999
***************
*** 136,146 ****
      }
  
      PROTECT(x);
-     if (xts || yts) {
-       setAttrib(x, R_TspSymbol, tsp);
-       setAttrib(x, R_ClassSymbol, class);
-       UNPROTECT(2);
-     }
      if (dims != R_NilValue) {
        setAttrib(x, R_DimSymbol, dims);
        if (xnames != R_NilValue)
--- 136,141 ----
***************
*** 154,159 ****
--- 149,159 ----
        else if (length(x) == length(ynames))
            setAttrib(x, R_NamesSymbol, ynames);
      }
+     if (xts || yts) {
+       setAttrib(x, R_TspSymbol, tsp);
+       setAttrib(x, R_ClassSymbol, class);
+       UNPROTECT(2);
+     }
  
      UNPROTECT(4);
      return x;

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From bates@stat.wisc.edu  Thu Apr 29 23:09:37 1999
From: bates@stat.wisc.edu (bates@stat.wisc.edu)
Date: Fri, 30 Apr 1999 00:09:37 +0200 (MET DST)
Subject: nlm on a function in the Math group (PR#180)
Message-ID: <199904292209.AAA07303@pubhealth.ku.dk>

If nlm is called with a function in the Math group it causes a
segmentation violation in DispatchGroup.  For example
 R> nlm( sin, -0.5, print.level = 2 )

 Process R segmentation fault at Thu Apr 29 17:10:15 1999

--please do not edit the information below--

Version:
 platform = i686-unknown-linux
 arch = i686
 os = linux
 system = i686, linux
 status = Patched (unreleased snapshot)
 status.rev = 0
 major = 0
 minor = 64.0
 year = 1999
 month = April
 day = 29
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From J.C.Rougier@durham.ac.uk  Fri Apr 30 09:48:13 1999
From: J.C.Rougier@durham.ac.uk (J.C.Rougier@durham.ac.uk)
Date: Fri, 30 Apr 1999 10:48:13 +0200 (MET DST)
Subject: polygon() help file (PR#181)
Message-ID: <199904300848.KAA08594@pubhealth.ku.dk>

A minor point, but the polygon() help file needs a small amount of
attention (0.63.2).  First, there appears to be no \usage{} line.  Second,
the default is not to leave the border undrawn, as documented, but to draw
the border in par("fg").

Cheers, Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE

"[B]egin upon the precept ... that the things we see are to be 
 weighed in the scale with what we know"  (Meredith, 1879, The Egoist)



-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From maechler@stat.math.ethz.ch  Fri Apr 30 12:39:15 1999
From: maechler@stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Fri, 30 Apr 1999 13:39:15 +0200 (MET DST)
Subject: polygon() help file (PR#181)
Message-ID: <199904301139.NAA09111@pubhealth.ku.dk>

>>>>> "JonR" == J C Rougier <J.C.Rougier@durham.ac.uk> writes:

    JonR> A minor point, but the polygon() help file needs a small amount
    JonR> of attention (0.63.2).  First, there appears to be no \usage{}
    JonR> line.  Second, the default is not to leave the border undrawn, as
    JonR> documented, but to draw the border in par("fg").

Done [for 0.64.1],
thanks a lot!

Yes, all of you, please send bug reports even as small as that one to
R-bugs !

Martin

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

From plummer@iarc.fr  Fri Apr 30 17:54:31 1999
From: plummer@iarc.fr (plummer@iarc.fr)
Date: Fri, 30 Apr 1999 18:54:31 +0200 (MET DST)
Subject: par help page  errors (PR#182)
Message-ID: <199904301654.SAA09919@pubhealth.ku.dk>

R 0.64.0

In the help page for par(), the parameters "oma"
and "omi" are described as vectors of the form
c(xb, xt, yl, yr)
whereas they are
c(xb,yl,xt,yr)

Martyn

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._


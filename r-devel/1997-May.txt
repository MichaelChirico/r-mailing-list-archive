From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May  1 16:47:36 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 1 May 97 17:47:36 +0200
Subject: R-alpha: ==NULL
In-Reply-To: <Pine.SUN.3.95.970430093849.302A-100000@zen> (message from Thomas
 Lumley on Wed, 30 Apr 1997 09:42:52 -0700 (PDT))
Message-ID: <9705011547.AA01745@>

>>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    Tom> Any comparison with NULL generates an error Error: comparison is
    Tom> possible only for vector types whereas in S(-PLUS) it gives NA,
    Tom> which seems more sensible.

    Tom> Along similar lines, comparison with a length 0 vector returns
    Tom> logical(0) in R but NA in S.

Is n't  logical(0)  more  logical than  NA ?

I agree that it would be best  (convenience)
if   'NULL==1' returned the same as 'numeric(0)==1'.

At the moment, I don't see why compatibility with S  should be important
here:
		if( NULL == anything)  
or, e.g.,	if( numeric(0) == numeric(0) )

give an error anyway, i.e., you have to test for length 0 _anyway_
in the cases where one comparison argument may have zero length.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May  1 17:28:48 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 1 May 1997 09:28:48 -0700 (PDT)
Subject: R-alpha: ==NULL
In-Reply-To: <9705011547.AA01745@>
Message-ID: <Pine.SUN.3.95.970501092039.11571A-100000@avon>

On Thu, 1 May 1997, Martin Maechler wrote:

> >>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:
	^^^^^ Aaargh! Not "Tom", please.
> 
>     Tom> Any comparison with NULL generates an error Error: comparison is
>     Tom> possible only for vector types whereas in S(-PLUS) it gives NA,
>     Tom> which seems more sensible.
> 
>     Tom> Along similar lines, comparison with a length 0 vector returns
>     Tom> logical(0) in R but NA in S.
> 
> Is n't  logical(0)  more  logical than  NA ?

I didn't (previously) make any comment on this -- I only said that NA was
more logical than an error message.  However, the advantage of returning
NA is that NA | TRUE is TRUE, NA & FALSE is FALSE, which doesn't happen
with logical(0). Also, from a compatibility point of view one of them is
tested with is.na(), the other with length(), so it can matter which one
you use.  Of course no-one should deliberately write code where it
matters, but these things happen. 

It seems in fact that logical(0) | TRUE causes R to freeze (R0.49,
sparc solaris).


Thomas Lumley
------------------------------------------------------+-----
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May  1 21:28:56 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 01 May 1997 22:28:56 +0200
Subject: R-alpha: eigen()
Message-ID: <x2lo5zgcmv.fsf@bush.kubism.ku.dk>


eigen() seems to work for symmetric matrices only. This is out of sync
with the help file.

> trpr.37
           0         1         2         3         4
0 1.00000000 0.0000000 0.0000000 0.0000000 0.0000000
1 0.44444444 0.5555556 0.0000000 0.0000000 0.0000000
2 0.02439024 0.2439024 0.7317073 0.0000000 0.0000000
3 0.00000000 0.0000000 0.2307692 0.7692308 0.0000000
4 0.00000000 0.0000000 0.0000000 0.3636364 0.6363636
> eigen(trpr.37)
$values
[1] 0.1760338 0.3173947 0.7351695 1.1361504 1.3281087

$vectors
           [,1]        [,2]       [,3]       [,4]      [,5]
[1,] -0.3707705 -0.27063913 -0.3559571  0.3273765 0.7452536
[2,]  0.7110188  0.41060304  0.1696518  0.1176558 0.5321961
[3,] -0.4307468  0.09222746  0.7735674 -0.3164802 0.3276966
[4,]  0.3249070 -0.57094755 -0.1300796 -0.7136115 0.2056509
[5,] -0.2566594  0.65090138 -0.4787334 -0.5192116 0.1081065

--Huh? 0,0,0,0,1 should be an eigenvector with e.v. 0.6363636.

> eigen(t(trpr.37))
$values
[1] 0.5555556 0.6363636 0.7317073 0.7692308 1.0000000

$vectors
     [,1] [,2] [,3] [,4] [,5]
[1,]    0    0    0    0    1
[2,]    1    0    0    0    0
[3,]    0    0    1    0    0
[4,]    0    0    0    1    0
[5,]    0    1    0    0    0

-- Doesn't look right, check:

> t(trpr.37)%*%eigen(t(trpr.37))$vectors
       [,1]      [,2]       [,3]      [,4] [,5]
0 0.4444444 0.0000000 0.02439024 0.0000000    1
1 0.5555556 0.0000000 0.24390244 0.0000000    0
2 0.0000000 0.0000000 0.73170732 0.2307692    0
3 0.0000000 0.3636364 0.00000000 0.7692308    0
4 0.0000000 0.6363636 0.00000000 0.0000000    0

-- which is obviously not proportional to the "eigenvectors". What
happens is that the matrices get symmetrified by duplicating the lower
triangle onto the upper one.

BTW. Who was it who talked about matrix exponentials a while back? I
could use such code now...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Fri May  2 05:34:19 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Fri, 2 May 1997 16:34:19 +1200 (NZST)
Subject: R-alpha: ==NULL
Message-ID: <199705020434.QAA00772@stat3.stat.auckland.ac.nz>

Well, we thought
  logical(0) & T should return logical(0)
  logical(0) | T should return logical(0)

  already we have NA | T returns T
             and  NA & T returns NA


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May  2 10:28:11 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 2 May 97 11:28:11 +0200
Subject: R-alpha: ==NULL
In-Reply-To: <Pine.SUN.3.95.970501092039.11571A-100000@avon> (message from
 Thomas Lumley on Thu, 1 May 1997 09:28:48 -0700 (PDT))
Message-ID: <9705020928.AA02005@>

>>>>> "ThLu" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    ThLu> On Thu, 1 May 1997, Martin Maechler wrote:
    >> >>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:
    ThLu>    ^^^^^ Aaargh! Not "Tom", please.

Excuse me!

    >> ....

    >>  Is n't logical(0) more logical than NA ?

    ThLu> I didn't (previously) make any comment on this -- I only said
    ThLu> that NA was more logical than an error message.  However, the
    ThLu> advantage of returning NA is that NA | TRUE is TRUE, NA & FALSE
    ThLu> is FALSE, which doesn't happen with logical(0). Also, from a
    ThLu> compatibility point of view one of them is tested with is.na(),
    ThLu> the other with length(), so it can matter which one you use.  Of
    ThLu> course no-one should deliberately write code where it matters,
    ThLu> but these things happen.

Ok, given the above argument, returning NA is logical, too.
However, I'd also argue that  
	logical(0) | TRUE	-> TRUE
	logical(0) & FALSE      -> FALSE

	logical(0) & TRUE	-> logical(0)
	logical(0) | FALSE      -> logical(0)

    ThLu> It seems in fact that logical(0) | TRUE causes R to freeze
    ThLu> (R0.49, sparc solaris).

Yes:

> logical(0) | TRUE
Warning in logical(0) | TRUE : longer object length
        is not a multiple of shorter object length
Floating exception
~~~~~~~~~~~~~~~~~~ [and 'core' dump]
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From nobu@psrc.isac.co.jp  Sun May  4 09:27:10 1997
From: nobu@psrc.isac.co.jp (Nobuhiro Yasutomi)
Date: Sun, 04 May 1997 17:27:10 +0900
Subject: R-alpha: abline not recognized coef member of list
Message-ID: <9705040827.AA06356@derrida.psrc.isac.co.jp>

Hello, R developers.

  I found a little different behavior of R with S.

  at R-0.49:
    > a
    [1] 12 23 22 34 44 54 55 70 78
    > plot(a)
    > abline(lsfit(seq(1,len=length(a)), a))
    Error: no applicable method for "coefficients"

  at S (from AT&T '92) result draw coefficient line without error.
Then I think to need define a function as followed:

    coefficients.default <- function(x) x$coef

---
Nobuhiro Yasutomi, ISAC, Inc.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May  7 13:28:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 7 May 97 14:28:16 +0200
Subject: R-alpha: contr.helmert: bug (??) don't have the SAME problem
In-Reply-To: <x27mhbmrbw.fsf@bush.kubism.ku.dk> (message from Peter Dalgaard
 BSA on 07 May 1997 13:53:07 +0200)
Message-ID: <9705071228.AA01474@>

[I diverged to  R-devel]

Peter, I cannot reproduce your bug
I can type

	solve(cbind(c(1,1,1,1),contr.helmert(4)))

many times, and never get an error.
Also,

 for(n in 2:7) { 
  A <- cbind(rep(1,n), contr.helmert(n)); print(A); print(solve(A),digits=4)}

is just fine.

But then I do

> version
$platform
[1] "sparc-sun-solaris2.5"

$arch
[1] "sparc"

$os
[1] "solaris2.5"

$system
[1] "sparc, solaris2.5"

$status
[1] "Beta"

$status.rev
[1] "0"

$major
[1] "0"

$minor
[1] "49"

$year
[1] "1997"

$language
[1] "R"


Process R segmentation violation at Wed May  7 14:22:57 1997
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

And this seems reproducible now.
Also under SunOS4 gcc (above was Solaris, Sun's cc).

Martin
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Wed May  7 15:10:03 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 07 May 1997 16:10:03 +0200
Subject: R-alpha: Re: contr.helmert: bug (??) don't have the SAME problem
In-Reply-To: Martin Maechler's message of Wed, 7 May 97 14:28:16 +0200
References: <9705071228.AA01474@>
Message-ID: <x24tcfmkzo.fsf@bush.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> 
> [I diverged to  R-devel]
> 
> Peter, I cannot reproduce your bug
> I can type
> 
> 	solve(cbind(c(1,1,1,1),contr.helmert(4)))
> 
> many times, and never get an error.
...
> Process R segmentation violation at Wed May  7 14:22:57 1997
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Also, it seems to behave differently in different circumstances. When
I reported it, I had started R from a read-only directory. In my home
directory, I get this:

> A<-contr.helmert(4)
> X<-cbind(c(1,1,1,1),A)
Error: Unimplemented feature in duplicate
> ls()
Error: Unimplemented feature in duplicate
> > ls
Error: Unimplemented feature in deparse2buff

Can you say "random memory overwrite"?

<imagine long and arduous gdb session here>

In main/bind.c:753, I see
STRING(CADR(dn))[j++] = blank;

Later on, during garbage collection, the same memory location gets
marked, setting a bit in the pointer, which gets accessed a split
second later, and... kerunch! 

I suspect that should have said ...=duplicate(blank)  , right? Or is
it the marking process in gcc. Hmm... not sure I got it straight
there, but somehow the "blank" value, which is a SEXP (aka *SEXPREC)
is getting treated as a SEXPREC.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May  7 16:00:24 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 7 May 1997 08:00:24 -0700 (PDT)
Subject: R-alpha: Re: contr.helmert bug
In-Reply-To: <x24tcfmkzo.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970507075642.2722B-100000@zen>


I have a probably related problem. Sporadically, an attempt to do

a[,1,1,drop=F]

or similar subsetting on a 3-d matrix causes a segfault at line 83 of
attrib.c.  In a previous version this happened reliably when dimensions
were lost from multi-d arrays and was due to incorrect handling of the
dimnames attributes which crashed attrib.c at that point when the dimnames
were accessed.

Is the same sort of thing happening again?


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Wed May  7 16:25:49 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 07 May 1997 17:25:49 +0200
Subject: R-alpha: cbind/memory-bug, (was Re: contr.helmert bug)
In-Reply-To: Thomas Lumley's message of Wed, 7 May 1997 08:00:24 -0700 (PDT)
References: <Pine.SUN.3.95.970507075642.2722B-100000@zen>
Message-ID: <x2207jmhhe.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> I have a probably related problem. Sporadically, an attempt to do
> 
> a[,1,1,drop=F]
> 
> or similar subsetting on a 3-d matrix causes a segfault at line 83 of
> attrib.c.  In a previous version this happened reliably when dimensions
> were lost from multi-d arrays and was due to incorrect handling of the
> dimnames attributes which crashed attrib.c at that point when the dimnames
> were accessed.
> 
> Is the same sort of thing happening again?

Not at all unlikely. As far as I can see, this doesn't really have
anything to do with contr.helmert, but with cbind, dimnames, and
garbage collection. Contr.helmert only comes in due to the fact that
it provokes a garbage collection at a critical time. Your examples
don't involve the garbage collector, but it might still tickle the
same bug...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 05:32:48 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 8 May 1997 16:32:48 +1200 (NZST)
Subject: R-alpha: Equations in Plots
Message-ID: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>

Paul Murrell and I are making some progress with making mathematical
expressions available in graphs.  The idea is to use R expressions to
represent the mathematical expressions.  So far we have (or will soon
have):

	R		LaTeX

	x^i		x^i
	x[i]		x_i
	alpha		\alpha
	Alpha		\Alpha
	hat(x)		\hat{x}	\widehat{x}
	bar(x)		\bar{x} \overline{x}
	x+y		x+y
	x-y		x-y
	x/y		x/y
	(x)		(x)
	{x}		{x}
	frac(x,y)	\frac{x}{y}
	cdots		\cdots
	ldots		\ldots
	
We are wondering how far to go with this process.  Does the above
cover what people want, or are there important omitted features
(we don't really want to do all of TeX).

We are prototyping this in lisp and it will be a little while before
it finds its way onto R.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 05:34:27 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 8 May 1997 16:34:27 +1200 (NZST)
Subject: R-alpha: Memory errors and cbind
Message-ID: <199705080434.QAA12659@stat1.stat.auckland.ac.nz>

Robert and I think we have a fix for the memory errors which are
happening with cbind.  I am getting a largish patch ready for this and
a range of other problems.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May  8 16:52:48 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 8 May 1997 08:52:48 -0700 (PDT)
Subject: R-alpha: Equations in Plots
In-Reply-To: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970508085100.3538A-100000@zen>

On Thu, 8 May 1997, Ross Ihaka wrote:

> Paul Murrell and I are making some progress with making mathematical
> expressions available in graphs.  The idea is to use R expressions to
> represent the mathematical expressions.  So far we have (or will soon
> have):
<things> 	
> We are wondering how far to go with this process.  Does the above
> cover what people want, or are there important omitted features
> (we don't really want to do all of TeX).
> 
I would really like to have the whole Greek alphabet or at least rho, mu
sigma and chi.


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Thu May  8 17:52:28 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Thu, 8 May 1997 11:52:28 -0500 (CDT)
Subject: R-alpha: machine-independent .Rdata
Message-ID: <9705081652.AA11157@nokomis.stat.umn.edu>

If a move toward machine-independent representation seems reasonable,
it may be worth looking at some of the binary data exchange formats
used by nasa and others,

	CDF http://nssdc.gsfc.nasa.gov/cdf/cdf_home.html
	netCDF http://www.unidata.ucar.edu/packages/netcdf/index.html
	HDF http://hdf.ncsa.uiuc.edu/

There may also be something useful in the "Scientific Data Format
Information FAQ"
(http://www.cv.nrao.edu/fits/traffic/scidataformats/faq.html).

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 22:49:39 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 May 1997 09:49:39 +1200 (NZST)
Subject: R-alpha: Equations in Plots
In-Reply-To: <Pine.SUN.3.95.970508085100.3538A-100000@zen>
References: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>
 <Pine.SUN.3.95.970508085100.3538A-100000@zen>
Message-ID: <199705082149.JAA16280@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > I would really like to have the whole Greek alphabet or at least rho, mu
 > sigma and chi.

I don't see a smiley so I'll bite ...  When I said "alpha" I meant by
implication the entire greek alphabet (upper and lower case).  I was
really asking if it would be a problem that we don't have big
"operators" like \sum, \prod, \lim, \int etc.  Expressions this
complex are probably better banished to a caption.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 22:56:04 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 May 1997 09:56:04 +1200 (NZST)
Subject: R-alpha: machine-independent .Rdata
In-Reply-To: <9705081652.AA11157@nokomis.stat.umn.edu>
References: <9705081652.AA11157@nokomis.stat.umn.edu>
Message-ID: <199705082156.JAA16354@stat1.stat.auckland.ac.nz>

Luke Tierney writes:
 > If a move toward machine-independent representation seems reasonable,
 > it may be worth looking at some of the binary data exchange formats
 > used by nasa and others,
 > 
 > 	CDF http://nssdc.gsfc.nasa.gov/cdf/cdf_home.html
 > 	netCDF http://www.unidata.ucar.edu/packages/netcdf/index.html
 > 	HDF http://hdf.ncsa.uiuc.edu/
 > 
 > There may also be something useful in the "Scientific Data Format
 > Information FAQ"
 > (http://www.cv.nrao.edu/fits/traffic/scidataformats/faq.html).

I've certainly given this and xdr the odd microsecond of thought.  A
platform independent data format would be very nice.  If someone would
like to look at this - or assign it as homework to a student (mine's
doing equations in plots :-) it would be very useful.  You don't have
to plug it into R, just find out what's invoved.

I'm about to be faced with a third year data analysis course with 100+
students so it won't be me ...
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May  9 14:38:33 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 9 May 97 15:38:33 +0200
Subject: R-alpha: R-0.49 / S-plus: "default argument evaluation" bugs and woes
Message-ID: <9705091338.AA02212@>


There is a problem with  'default argument evaluation'
when I use an existing function name as argument name :

sintest <- function(x, y = 2, sin= sin(pi/4))
{
  ## Purpose: Test of   "default argument evaluation"
  ## -------- Fails for  R-0.49.  Martin Maechler, Date:  9 May 97.
  c(x=x, y=y, sin=sin)
}

## R-0.49:
R> sintest(1)
##> Error in sintest(1) : recursive default argument reference

## S-plus 3.4  (being 100% ok):
S> sintest(1)
  x y       sin 
  1 2 0.7071068
 Warning messages:
   looking for function "sin", ignored local non-function in: sintest(1)

-------------------------------------------------------
The following shows bugs, both in R and S:

sintest2 <- function(x ,y = 2)
{
  ## Purpose: Test of   "default argument evaluation"
  ## -------- Fails for  S-plus 3.4.  Martin Maechler, Date:  9 May 97.
  c(x=x, y=y, sin=sin)
}

R> sintest2(1)
[[1]]
[1] 1

[[2]]
[1] 2

[[3]]
<primitive: sin>

--------------- is almost okay, 
		the buglet being that the names have been dropped from the list.

But watch this:
S> sintest2(1)
function(x = 1, y = 2, sin.x)
sin2 = .Internal(sin(x), "do_math", T, 109)

--- returning a function 

	((now we see, why S's way of treating functions as
	  lists sometimes badly sucks)).
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Fri May  9 15:52:13 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Fri, 9 May 1997 09:52:13 -0500 (CDT)
Subject: R-alpha: R-0.49 / S-plus: "default argument evaluation" bugs and woes
In-Reply-To: <9705091338.AA02212@> from "Martin Maechler" at May 9, 97 03:38:33 pm
Message-ID: <9705091452.AA24334@nokomis.stat.umn.edu>

Martin Maechler wrote:
> 
> 
> There is a problem with  'default argument evaluation'
> when I use an existing function name as argument name :
> 
> sintest <- function(x, y = 2, sin= sin(pi/4))
> {
>   ## Purpose: Test of   "default argument evaluation"
>   ## -------- Fails for  R-0.49.  Martin Maechler, Date:  9 May 97.
>   c(x=x, y=y, sin=sin)
> }
> 
> ## R-0.49:
> R> sintest(1)
> ##> Error in sintest(1) : recursive default argument reference
> 
> ## S-plus 3.4  (being 100% ok):
> S> sintest(1)
>   x y       sin 
>   1 2 0.7071068
>  Warning messages:
>    looking for function "sin", ignored local non-function in: sintest(1)
> 
> -------------------------------------------------------
> The following shows bugs, both in R and S:
> 
> sintest2 <- function(x ,y = 2)
> {
>   ## Purpose: Test of   "default argument evaluation"
>   ## -------- Fails for  S-plus 3.4.  Martin Maechler, Date:  9 May 97.
>   c(x=x, y=y, sin=sin)
> }
> 
> R> sintest2(1)
> [[1]]
> [1] 1
> 
> [[2]]
> [1] 2
> 
> [[3]]
> <primitive: sin>
> 

For better or worse, S and R allow default expressions to contain
references variables that are (or rather may be) created in the
function body, so (in R and Splus)

> x<-1
> f<-function(a,b=x) { if (a) x<-2; b}
> f()
Error: Argument "a" is missing, with no default
> f(T)
[1] 2
> f(F)
[1] 1

More traditional lexical scoping would make the reference to x in the
default always be global, but lots of code would break. I think we're
stuck with this behavior as a corollary to the way S wants default
arguments to work.

Actually S is a bit inconsistent in its error message -- if you have a
non-function argument it gives the same message as R,

> g<-function(x=x) x
>g()
Error in g(): Recursive occurrence of default argument "x"
Dumped

Also in R's lexical scoping you probably do want the argument name to
shadow any outer definitions if you want to be able to define default
arguments that are recursive functions, e.g.

> g<-function(n, nfac=function(x) { if (x <= 1) 1 else nfac(x-1)*x }) nfac(n);
> g(6)
[1] 720

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Fri May  9 23:34:26 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Fri, 9 May 1997 23:34:26 +0100 (BST)
Subject: R-alpha: plot, axis & log
Message-ID: <Pine.LNX.3.95.970509230406.4111A-100000@figaro.stats.bris.ac.uk>

The following commands crash:

> plot(1:4,axes=F,log="x")
> axis(1,c(1,2,3,4))
zsh: segmentation fault  R

Lines 35-37 of axis():

35:        else {
36:                ind <- (usr[1] <= at & at <= usr[2])
37:        }

should be replaced by

        else {
                if (log)
                        ind <- (10^usr[1] <= at & at <= 10^usr[2])
                else ind <- (usr[1] <= at & at <= usr[2])
        }

Moreover, there should be a check if length(at) equals zero before calling
the internal axis command.

But wait, there's more:

> plot(1:4,log="x")
> plot(1:4)

The second call of plot produces an empty plot. The following sequence
works:

> plot(1:4,log="x")
> par(xlog=F)
> plot(1:4)        

Why does R have the graphical parameters "xlog" and "ylog"? They do not
seem to work for me and are not used by S-Plus.

Arne 

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Sat May 10 18:41:46 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Sat, 10 May 1997 17:41:46 +0000 (GMT)
Subject: R-alpha: Another error in axis
Message-ID: <Pine.LNX.3.95.970510173453.3432B-100000@figaro.stats.bris.ac.uk>

The commands

> plot(1:4,axes=F)
> axis(1,c(4,3,2,1))

produce the tick-marks but not the labels (except the last one). Sorting
the vector at in axis() seems to work, ie should lines 35-40 should read:

        else {
                at <- sort(at)
                if (log)
                        ind <- (10^usr[1] <= at & at <= 10^usr[2])
                else ind <- (usr[1] <= at & at <= usr[2])
        }


Arne

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Sat May 10 22:33:15 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Sat, 10 May 1997 14:33:15 -0700 (PDT)
Subject: R-alpha: r-beta: lm.influence
In-Reply-To: <9705091338.AA02212@>
Message-ID: <Pine.SOL.3.95.970510141405.1061A-100000@gorn>


lm.influence() doesn't work correctly on weighted models (and thus on glm
objects).


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Sun May 11 21:08:32 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Sun, 11 May 1997 20:08:32 +0000 (GMT)
Subject: R-alpha: Logarithmic scales
Message-ID: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>

Here are another three problems with logarithmic scales:

1) segments() does not work with logarithmic scales. I suggest to change
lines 962-973 in "plot.c":

    for (i = 0; i < n; i++) {
        if (FINITE(xt(x0[i%nx0])) && FINITE(yt(y0[i%ny0]))
            && FINITE(xt(x1[i%nx1])) && FINITE(yt(y1[i%ny1]))) {
            GP->col = INTEGER(col)[i % ncol];
            if(GP->col == NA_INTEGER) GP->col = colsave;
            GP->lty = INTEGER(lty)[i % nlty];
            GStartPath();
            GMoveTo(XMAP(xt(x0[i % nx0])), YMAP(yt(y0[i % ny0])));
            GLineTo(XMAP(xt(x1[i % nx1])), YMAP(yt(y1[i % ny1])));
            GEndPath();
        }
    }

2) rect() does not work either. Unfortunately, do_rect() in "plot.c" 
overrides the yt() function... What about this (lines 983-1031):

SEXP do_rect(SEXP call, SEXP op, SEXP args, SEXP env)
{
    SEXP sxl, sxr, syb, sys, col, lty, border;
    double *xl, *xr, *yb, *ys;
    int i, n, nxl, nxr, nyb, nys;
    int ncol, nlty, nborder;
    int colsave, ltysave;

    GCheckState();

    if(length(args) < 4) errorcall(call, "too few arguments\n");
    xypoints(call, args, &n);

    sxl = CAR(args); nxl = length(sxl); args = CDR(args);
    syb = CAR(args); nyb = length(syb); args = CDR(args);
    sxr = CAR(args); nxr = length(sxr); args = CDR(args);
    sys = CAR(args); nys = length(sys); args = CDR(args);

    PROTECT(col = FixupCol(GetPar("col", args)));
    ncol = LENGTH(col);

    PROTECT(border =  FixupCol(GetPar("border", args)));
    nborder = LENGTH(border);

    PROTECT(lty = FixupLty(GetPar("lty", args)));
    nlty = length(lty);

    xl = REAL(sxl);
    xr = REAL(sxr);
    yb = REAL(syb);
    ys = REAL(sys);

    ltysave = GP->lty;
    colsave = GP->col;
    GMode(1);
    for (i = 0; i < n; i++) {
        if (FINITE(xt(xl[i%nxl])) && FINITE(yt(yb[i%nyb]))
            && FINITE(xt(xr[i%nxr])) && FINITE(yt(ys[i%nys])))
                GRect(XMAP(xt(xl[i % nxl])), YMAP(yt(yb[i % nyb])),
                      XMAP(xt(xr[i % nxr])), YMAP(yt(ys[i % nys])),
                    INTEGER(col)[i % ncol],
                    INTEGER(border)[i % nborder]);
    }
    GMode(0);
    GP->col = colsave;
    GP->lty = ltysave;
    UNPROTECT(3);
    return R_NilValue;
}

3) The legend() function needs changes as well. I attach my
quick hack below, but I think there are better solutions... :-)

legend <-
function (x, y, legend, fill, col = "black", lty, pch, bty = "o", 
        bg = par("bg"), xjust = 0, yjust = 1, ...) 
{
        xlog <- par("xlog")
        ylog <- par("ylog")
        if (xlog) 
                x <- log10(x)
        if (ylog) 
                y <- log10(y)
        xchar <- xinch(par("cin")[1])
        ychar <- yinch(par("cin")[2]) * 1.2
        xbox <- xinch(par("cin")[2] * 0.8)
        ybox <- yinch(par("cin")[2] * 0.8)
        yline <- 2 * xchar
        w <- 2 * xchar + max(strwidth(legend))
        h <- (length(legend) + 1) * ychar
        if (missing(y)) {
                if (is.list(x)) {
                        y <- x$y
                        x <- x$x
                }
        }
        if (!is.numeric(x) || !is.numeric(y)) 
                stop("non-numeric coordinates")
        if (length(x) <= 0 || length(x) != length(y)) 
                stop("differing coordinate lengths")
        if (length(x) != 1) {
                x <- mean(x)
                y <- mean(y)
                xjust <- 0.5
                yjust <- 0.5
        }
        if (!missing(fill)) {
                w <- w + xchar + xbox
        }
        if (!missing(pch)) {
                if (is.character(pch) && nchar(pch) > 1) {
                        np <- nchar(pch)
                        pch <- substr(rep(pch[1], np), 1:np, 
                                1:np)
                }
                w <- w + 1.5 * xchar
        }
        if (!missing(lty)) 
                w <- w + 3 * xchar
        x <- x - xjust * w
        y <- y + (1 - yjust) * h
        xt <- rep(x, length(legend)) + xchar
        yt <- y - (1:length(legend)) * ychar
        if (bty != "n") {
                if (xlog) {
                        x1 <- 10^x
                        x2 <- 10^(x + w)
                }
                else {
                        x1 <- x
                        x2 <- x + w
                }
                if (ylog) {
                        y1 <- 10^y
                        y2 <- 10^(y - h)
                }
                else {
                        y1 <- y
                        y2 <- y - h
                }
                rect(x1, y1, x2, y2, col = bg)
        }
        x <- x + xchar
        if (!missing(fill)) {
                if (xlog) {
                        x1 <- 10^xt
                        x2 <- 10^(xt + xbox)
                }
                else {
                        x1 <- xt
                        x2 <- xt + xbox
                }
                if (ylog) {
                        y1 <- 10^(yt - 0.5 * ybox)
                        y2 <- 10^(yt + 0.5 * ybox)
                }
                else {
                        y1 <- yt - 0.5 * ybox
                        y2 <- yt + 0.5 * ybox
                }
                rect(xt, yt - 0.5 * ybox, xt + xbox, yt + 0.5 * 
                        ybox, col = fill)
                xt <- xt + xbox + xchar
        }
        if (!missing(pch)) {
                if (xlog) 
                        x1 <- 10^(xt + 0.25 * xchar)
                else x1 <- xt + 0.25 * xchar
                if (ylog) 
                        y1 <- 10^yt
                else y1 <- yt
                points(x1, y1, pch, col = col)
                xt <- xt + 1.5 * xchar
        }
        if (!missing(lty)) {
                if (xlog) {
                        x1 <- 10^xt
                        x2 <- 10^(xt + 2 * xchar)
                }
                else {
                        x1 <- xt
                        x2 <- xt + 2 * xchar
                }
                if (ylog) 
                        y1 <- 10^yt
                else y1 <- yt
                segments(x1, y1, x2, y1, lty = lty, col = col)
                xt <- xt + 3 * xchar
        }
        if (xlog) 
                x1 <- 10^xt
        else x1 <- xt
        if (ylog) 
                y1 <- 10^yt
        else y1 <- yt
        text(x1, y1, text = legend, adj = c(0, 0.35))
}

Arne

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 01:35:25 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 12 May 1997 12:35:25 +1200 (NZST)
Subject: R-alpha: Hypergeometric Distribution
Message-ID: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>

A cut and paste typo has crept in and is rendering all values returned
for the hypergeometric distribution incorrect.  The problem is in
src/main/arithmetic.c in the function "math4".  The lines

        PROTECT(sy = allocVector(REALSXP, n));
        a = REAL(sa);
        b = REAL(sb);
        c = REAL(sc);
        d = REAL(sc);	/* <-- change this line */
        y = REAL(sy);

should read

        PROTECT(sy = allocVector(REALSXP, n));
        a = REAL(sa);
        b = REAL(sb);
        c = REAL(sc);
        d = REAL(sd);	/* corrected */
        y = REAL(sy);

This will be part of the official 2nd patch to 0.49, but I'm pointing it
out anyway.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Mon May 12 07:17:50 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 May 1997 08:17:50 +0200
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
Message-ID: <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> A cut and paste typo has crept in and is rendering all values returned
> for the hypergeometric distribution incorrect.  The problem is in
> src/main/arithmetic.c in the function "math4".  The lines

>         PROTECT(sy = allocVector(REALSXP, n));
>         a = REAL(sa);
>         b = REAL(sb);
>         c = REAL(sc);
>         d = REAL(sc);	/* <-- change this line */
>         y = REAL(sy);

> should read

>         PROTECT(sy = allocVector(REALSXP, n));
>         a = REAL(sa);
>         b = REAL(sb);
>         c = REAL(sc);
>         d = REAL(sd);	/* corrected */
>         y = REAL(sy);

> This will be part of the official 2nd patch to 0.49, but I'm pointing it
> out anyway.

Thanks for the patch.

It fixes the problem reported by myself on 25 Apr 1997 (makes my Fisher
test work again) and by Ennapadam Venkatraman <VENKAT@biosta.mskcc.org>
on 30 Apr 1997.

Note that the problem with `rhyper(5,200,250,60)' never returning still
seems to exist.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 09:03:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 10:03:50 +0200
Subject: R-alpha: Logarithmic scales -- patch to 'legend'
In-Reply-To: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>
 (message from Arne Kovac on Sun, 11 May 1997 20:08:32 +0000 (GMT))
Message-ID: <9705120803.AA00340@>

Arne, thank you for your very useful  bug findings and fixing.
Your first two "patches" to  plot.c  are really ok.

In your

>> 3) The legend() function needs changes as well. I attach my
>> quick hack below, but I think there are better solutions... :-)
>> 
>> legend <-
>> function (x, y, legend, fill, col = "black", lty, pch, bty = "o", 
>>         bg = par("bg"), xjust = 0, yjust = 1, ...) 
>> .....

there was one typo in the  ``if(!missing(fill))''  clause, you assigned
x1,..y2, but then did not use them.

Below I fixed this and found a way to make the whole  if(xlog) / (ylog)
things a little more concise.
This is a patch against "plain 0.49" ,  $RHOME/src/library/base/funs/ :

--- legend.~1~	Fri Jan 17 03:44:24 1997
+++ legend	Mon May 12 09:42:25 1997
@@ -2,13 +2,18 @@
 function(x, y, legend, fill, col="black", lty, pch, bty="o", bg=par("bg"),
 	xjust=0, yjust=1, ...)
 {
+	xlog <- par("xlog")
+	ylog <- par("ylog")
+	if (xlog) x <- log10(x)
+	if (ylog) y <- log10(y)
 	xchar <- xinch(par("cin")[1])
 	ychar <- yinch(par("cin")[2]) * 1.2
 	xbox <- xinch(par("cin")[2] * 0.8)
 	ybox <- yinch(par("cin")[2] * 0.8)
 	yline <- 2*xchar
 	w <- 2 * xchar + max(strwidth(legend))
-	h <- (length(legend)+1)*ychar
+	n.leg <- length(legend)
+	h <- (n.leg + 1) * ychar
 	if(missing(y)) {
 		if(is.list(x)) {
 			y <- x$y
@@ -39,23 +44,43 @@
 		w <- w + 3 * xchar
 	x <- x - xjust * w
 	y <- y + (1 - yjust) * h
-	xt <- rep(x, length(legend)) + xchar
-	yt <- y - (1:length(legend)) * ychar
-	if(bty != "n")
-		rect(x, y, x+w, y-h, col=bg)
+	xt <- rep(x, n.leg) + xchar
+	yt <- y - (1:n.leg) * ychar
+	if (bty != "n") {
+		xx <- c(x,x+w)
+		if (xlog) xx <- 10^xx
+		yy <- c(y,y-h)
+		if (ylog) yy <- 10^yy
+		rect(xx[1], yy[1], xx[2], yy[2], col = bg)
+	}
 	x <- x + xchar
 	if(!missing(fill)) {
-		rect(xt, yt - 0.5 * ybox,
-			xt + xbox, yt + 0.5 * ybox, col=fill)
+		xx <- c(xt,xt+xbox)
+		if (xlog) xx <- 10^xx
+		yy <- yt + c(-.5,.5) * ybox
+		if (ylog) yy <- 10^yy
+		rect(xx[1], yy[1], xx[2], yy[2], col = fill)
 		xt <- xt + xbox + xchar
 	}
 	if(!missing(pch)) {
-		points(xt + 0.25 * xchar, yt, pch, col=col)
+		x1 <- xt + 0.25 * xchar
+		if (xlog) x1 <- 10^x1
+		y1 <- yt
+		if (ylog) y1 <- 10^y1
+		points(x1, y1, pch, col = col)
 		xt <- xt + 1.5 * xchar
 	}
 	if(!missing(lty)) {
-		segments(xt, yt, xt + 2 * xchar, yt, lty=lty, col=col)
+		xx <- c(xt, xt + 2 * xchar)
+		if (xlog) xx <- 10^xx
+		y1 <- yt
+		if (ylog) y1 <- 10^y1
+		segments(xx[1], y1, xx[2], y1, lty = lty, col = col)
 		xt <- xt + 3 * xchar
 	}
-	text(xt, yt, text=legend, adj=c(0, 0.35))
+	x1 <- xt
+	y1 <- yt
+	if (xlog) x1 <- 10^x1
+	if (ylog) y1 <- 10^y1
+	text(x1, y1, text = legend, adj = c(0, 0.35))
 }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 09:39:39 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 10:39:39 +0200
Subject: R-alpha: fixing dhyper.c: another less important typo
In-Reply-To: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>
 (message from Arne Kovac on Sun, 11 May 1997 20:08:32 +0000 (GMT))
Message-ID: <9705120839.AA00361@>

Line 30 should be changed from

	if (NR <= 0 || NR <= 0 || n <= 0 || n > N)
to                      ^-- typo: "R" should be "B"
	if (NR < 0 || NB < 0 || n < 0 || n > N)

(NR==0 or NB == 0  should not be a DOMAIN_ERROR)
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 13:11:38 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 14:11:38 +0200
Subject: R-alpha: oops -- 2nd patch to 'legend'
In-Reply-To: <9705120803.AA00340@> (message from Martin Maechler on Mon, 12
 May 97 10:03:50 +0200)
Message-ID: <9705121211.AA00399@>

This time, I have at least tested it out under quite a few circumstances;
the last patch (a few hours ago) would FAIL in many cases!

--- legend.~1~	Fri Jan 17 03:44:24 1997
+++ legend	Mon May 12 12:07:23 1997
@@ -2,18 +2,23 @@
 function(x, y, legend, fill, col="black", lty, pch, bty="o", bg=par("bg"),
 	xjust=0, yjust=1, ...)
 {
+  xlog <- par("xlog")
+  ylog <- par("ylog")
+  if (xlog) x <- log10(x)
+  if (ylog) y <- log10(y)
 	xchar <- xinch(par("cin")[1])
 	ychar <- yinch(par("cin")[2]) * 1.2
 	xbox <- xinch(par("cin")[2] * 0.8)
 	ybox <- yinch(par("cin")[2] * 0.8)
 	yline <- 2*xchar
 	w <- 2 * xchar + max(strwidth(legend))
-	h <- (length(legend)+1)*ychar
+  n.leg <- length(legend)
+  h <- (n.leg + 1) * ychar
 	if(missing(y)) {
 		if(is.list(x)) {
 			y <- x$y
 			x <- x$x
-		}
+    } else stop("missing y")
 	}
 	if(!is.numeric(x) || !is.numeric(y))
 		stop("non-numeric coordinates")
@@ -39,23 +44,36 @@
 		w <- w + 3 * xchar
 	x <- x - xjust * w
 	y <- y + (1 - yjust) * h
-	xt <- rep(x, length(legend)) + xchar
-	yt <- y - (1:length(legend)) * ychar
+  xt <- rep(x, n.leg) + xchar
+  yt <- y - (1:n.leg) * ychar
 	if(bty != "n")
 		rect(x, y, x+w, y-h, col=bg)
 	x <- x + xchar
 	if(!missing(fill)) {
-		rect(xt, yt - 0.5 * ybox,
-			xt + xbox, yt + 0.5 * ybox, col=fill)
+    xx <- cbind(xt, xt + xbox)
+    if (xlog) xx <- 10^xx
+    yy <- yt + cbind(rep(-0.5,n.leg), 0.5) * ybox
+    if (ylog) yy <- 10^yy
+    rect(xx[,1], yy[,1], xx[,2], yy[,2], col = fill)
 		xt <- xt + xbox + xchar
 	}
 	if(!missing(pch)) {
-		points(xt + 0.25 * xchar, yt, pch, col=col)
+    x1 <- xt + 0.25 * xchar
+    if (xlog) x1 <- 10^x1
+    y1 <- yt
+    if (ylog) y1 <- 10^y1
+    points(x1, y1, pch, col = col)
 		xt <- xt + 1.5 * xchar
 	}
 	if(!missing(lty)) {
-		segments(xt, yt, xt + 2 * xchar, yt, lty=lty, col=col)
+    xx <- cbind(xt, xt + 2 * xchar)
+    if (xlog) xx <- 10^xx
+    y1 <- yt
+    if (ylog) y1 <- 10^y1
+    segments(xx[,1], y1, xx[,2], y1, lty = lty, col = col)
 		xt <- xt + 3 * xchar
 	}
+  if (xlog) xt <- 10^xt
+  if (ylog) yt <- 10^yt
 	text(xt, yt, text=legend, adj=c(0, 0.35))
 }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 14:25:18 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 15:25:18 +0200
Subject: R-alpha: ISO-latin-1 characters in strings -- print.default & PARSE(?) problems
Message-ID: <9705121325.AA00438@>


There seems to be a problem in print.default with some
ISO-latin1 characters (the chars AFTER ASCII in western Europe...)
if they appear in strings. 
(no problem if they are part of a function comment, see below).

Some of the characters lead to 4 character Hex-codes being printed instead:
"" ## ^u    prints as "0xFB"

If you use the funny characters in comments of functions, they are stored
and printed properly.

HOWEVER: In a few rare cases, the strings are not even PARSED properly;
	the line 'ISOdiv <- ..' below gives a SYNTAX error.

The following code shows the symptoms :
   -- ONLY if  the e-mail between here and your place is  8-bit clean! --
  (else: get it ftp://ftp.stat.math.ethz.ch/U/maechler/R/string-test.R )

frenchquotes <- "..."  ## <<...>>
frenchquotes

Umlaute <- " " # = "a "o "u  "A "O "U
Umlaute #- only the last one is not printed properly...

A.accents <- " " # `a 'a ^a "a oa ae  `A 'A ^A "A oA AE
A.accents
EI.accents <- " "
EI.accents
O.accents <- ""
O.accents

U.accents <- ""
U.accents

ISO24x <-  " " #octal 241..257
ISO26x <- " " #octal 260..277

##--- THIS IS a Problem: It gives a SYNTAX error !
ISOdiv <- "    " 
##-- One of these characters even was producing the same as  'q()' !!

aa_ function(x) {
  x^2
  ##- frenchquotes <- "..."  ## <<...>>
  ##- Umlaute <- " " # = "a "o "u  "A "O "U
  ##- A.accents <- " " # `a 'a ^a "a oa ae  `A 'A ^A "A oA AE
  ##- EI.accents <- " "
  ##- O.accents <- ""
  ##- U.accents <- ""
  ##-
  ##- ISO24x <-  " " #octal 241..257
  ##- ISO26x <- " " #octal 260..277
  ##- ISOdiv <- " " ##-- OMITTED further: SYNTAX error !!
}
aa
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 22:14:03 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 09:14:03 +1200 (NZST)
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
 <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
Message-ID: <199705122114.JAA02547@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:
 > Note that the problem with `rhyper(5,200,250,60)' never returning still
 > seems to exist.

We have a fix for this.  There was a typo in the underlying generator
code.  (I'm trying to avoid piecemeal fixes, but the dhyper / phyper /
qhyper one seemed rather nasty and the cause of a number of bug
reports).  More complete patch soon.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 22:15:35 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 09:15:35 +1200 (NZST)
Subject: R-alpha: XDR and Portable Data
Message-ID: <199705122115.JAA02567@stat1.stat.auckland.ac.nz>

While waiting for a "make" to finish this morning, I took down the Sun
"Network Programmers Reference Guide" and had a look at their
description of the XDR library.  Interestingly it looks like it can be
plugged into R with very little effort because our saveload code is
structured in exactly the right way.  So ..., contrary to what I said
before, I will have a bash at adding it.

It would still be useful to look at the other data formats.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 05:18:00 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 16:18:00 +1200 (NZST)
Subject: R-alpha: R-0.49 Patch 2
Message-ID: <199705130418.QAA07895@stat1.stat.auckland.ac.nz>

A second patch for R-0.49 is now available as

	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2.gz

and soon from mirror sites.

This patch fixes a variety of memory management problems and has
some updates for a number of numerical functions, including

	dhyper / phyper / qhyper / rhyper
	pbeta / qbeta
	qt
	qnorm

In addition, Thomas Lumley has provided some reworking of the
glm code.

I have nearly completed building a new TASKS lists and we are starting
work on the problems in it.  More patches will follow.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 07:11:31 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 08:11:31 +0200
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705122114.JAA02547@stat1.stat.auckland.ac.nz>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
 <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
 <199705122114.JAA02547@stat1.stat.auckland.ac.nz>
Message-ID: <199705130611.IAA06400@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> Kurt Hornik writes:
>> Note that the problem with `rhyper(5,200,250,60)' never returning still
>> seems to exist.

> We have a fix for this.  There was a typo in the underlying generator
> code.  (I'm trying to avoid piecemeal fixes, but the dhyper / phyper /
> qhyper one seemed rather nasty and the cause of a number of bug
> reports).  More complete patch soon.

Indeed, it does.  Also, my qt(0.975, 3) works now even if I compile with
"-O2 -g".

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 07:16:30 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 08:16:30 +0200
Subject: R-alpha: Re: R-beta: ls.print
In-Reply-To: <199704301411.QAA20329@hypatia.math.ethz.ch>
References: <199704301411.QAA20329@hypatia.math.ethz.ch>
Message-ID: <199705130616.IAA06418@aragorn.ci.tuwien.ac.at>

>>>>> Ennapadam Venkatraman writes:

> ls.print produces error that I don't seem to be able to trace.
> Output of the commands as follows: (hyeung is a 24x2 matrix of data)

> -------------------------------------------------
>> summary(hyeung)
>        x.1             x.2
>  Min.   : 28.0   Min.   : 10.0
>  1st Qu.: 72.0   1st Qu.: 87.5
>  Median : 86.5   Median : 92.5
>  Mean   : 81.0   Mean   : 82.5
>  3rd Qu.: 97.0   3rd Qu.:100.0
>  Max.   :100.0   Max.   :100.0

>> summary(lsfit(hyeung[,1],hyeung[,2]))
>           Length Class  Mode
> coef       2     -none- numeric
> residuals 24     -none- numeric
> intercept  1     -none- logical
> qr         6     -none- list

>> ls.print(lsfit(hyeung[,1],hyeung[,2]))
> trace: ls.print(lsfit(hyeung[, 1], hyeung[, 2]))
> Error: missing value in ``n1 : n2''

> -------------------------------------------------

> E. S. Venkatraman (venkat@biosta.mskcc.org)

The problem seems to be that

	ncol(ls.out$residuals)

gives NULL if ls.out is a vector.  An easy fix is to replace each
occurrence of ncol in ls.print() by NCOL.

A patch is appended below.

Btw, my help file for NCOL comes up with `.COL' rather than `NCOL'.  Can
anyone verify that?

-k

*** src/library/base/funs/lsfit.orig	Tue May 13 07:54:24 1997
--- src/library/base/funs/lsfit	Tue May 13 07:51:19 1997
*************** ls.print <- function(ls.out, digits=4, p
*** 256,265 ****
  
  	# construct coef table
  
! 	coef.table <- as.list(1:ncol(ls.out$residuals))
! 	if(ncol(ls.out$residuals)==1) coef <- matrix(ls.out$coef, nc=1)
  	else coef <- ls.out$coef
! 	for(i in 1:ncol(ls.out$residuals)) {
  		covmat <- (resss[i]/(n[i]-p)) * (qrinv%*%t(qrinv))
  		coef.table[[i]] <- cbind(coef[, i], diag(covmat)^.5,
  			coef[, i]/diag(covmat)^.5,
--- 256,265 ----
  
  	# construct coef table
  
! 	coef.table <- as.list(1:NCOL(ls.out$residuals))
! 	if(NCOL(ls.out$residuals)==1) coef <- matrix(ls.out$coef, nc=1)
  	else coef <- ls.out$coef
! 	for(i in 1:NCOL(ls.out$residuals)) {
  		covmat <- (resss[i]/(n[i]-p)) * (qrinv%*%t(qrinv))
  		coef.table[[i]] <- cbind(coef[, i], diag(covmat)^.5,
  			coef[, i]/diag(covmat)^.5,
*************** ls.print <- function(ls.out, digits=4, p
*** 270,276 ****
  		#print results
  
  		if(print.it) {
! 			if(ncol(ls.out$residuals)>1)
  				cat("Response:", colnames(ls.out$residuals)[i],
  				"\n\n")
  			cat(paste("Residual Standard Error=", format(round(
--- 270,276 ----
  		#print results
  
  		if(print.it) {
! 			if(NCOL(ls.out$residuals)>1)
  				cat("Response:", colnames(ls.out$residuals)[i],
  				"\n\n")
  			cat(paste("Residual Standard Error=", format(round(
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 13 09:12:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 13 May 97 10:12:50 +0200
Subject: R-alpha: Re: R-beta: ls.print
In-Reply-To: <199705130616.IAA06418@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Tue, 13 May 1997 08:16:30 +0200)
Message-ID: <9705130812.AA00712@>

Yes, I do confirm that the  Help page  (?NCOL) contains  '.COL'.

Apply the following patch (to doc2ms) in  $RHOME/etc , and "all is well":

--- doc2ms	Tue May 13 10:10:33 1997
+++ Old/doc2ms	Sun Nov 24 23:41:49 1996
@@ -122,8 +122,6 @@
 $2
 .DE
 ')
-define(DEQTEX,`')
-define(DEQHTML,`')
 END
 # Fix up the input to protect things that m4 is sensitive about.
 sed '
@@ -149,8 +147,8 @@
 s/M4_RQ/'\''/g
 s/M4_COMMA/,/g
 s/M4_IFELSE/ifelse/g
-s/^\.Internal/\\\&.Internal/
-s/^\.C/\\\&.C/
-s/^\.Fortran/\\\&.Fortran/
+s/^.Internal/\\\&.Internal/
+s/^.C/\\\&.C/
+s/^.Fortran/\\\&.Fortran/
 s/\\n/\\\\n/g
 '
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 10:07:06 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 11:07:06 +0200
Subject: R-alpha: R-0.49 patch 2
Message-ID: <199705130907.LAA07145@aragorn.ci.tuwien.ac.at>

Developers, watch out:

The patch seems to install the files with the new code for family and
glm into the man subdir of src/library/base rather than into funs.

(I already contacted Ross directly this morning for a quick fix, but
apparently missed him ... perhaps I should start working at 5:30 am.)

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 20:56:40 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 May 1997 07:56:40 +1200 (NZST)
Subject: R-alpha: Patch2
Message-ID: <199705131956.HAA12175@stat1.stat.auckland.ac.nz>

There is a problem with the patch I sent out yesterday. The patches for the glm
code are applied in the wrong place.  I have removed the patch file and will
have a real one available latter today.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Tue May 13 21:10:41 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Tue, 13 May 1997 13:10:41 -0700 (PDT)
Subject: R-alpha: batch mode.
In-Reply-To: <199705131956.HAA12175@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970513130620.1600B-100000@avon>


R0.49 (with and without the new patch applied to the correct places) fails
in batch mode. 
Solaris-gorn% more break.R
1+1

Solaris-gorn% ~/R49 <break.R

R : Copyright 1997, Robert Gentleman and Ross Ihaka
Version 0.49 Beta (April 23, 1997)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type "license()" for details.

[Previously saved workspace restored]

Error in par(args) : No device is active
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in internal par, 12 then 0
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in .Internal, 11 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in if, 9 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in <-, 7 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in {, 5 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
> 1+1
[1] 2
> 
> > 
Solaris-gorn% uname -a
SunOS gorn 5.5.1 Generic sun4u sparc SUNW,Ultra-1


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 21:29:22 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 May 1997 08:29:22 +1200 (NZST)
Subject: R-alpha: Revised Patch 2
Message-ID: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>

I have put the glm code in the right place and redone the patch.  To
help avoid confusion the new patch has an "a" appended to its name.
The patch can be obtained as:

	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2a.gz

Sorry for any problems this may have caused.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Tue May 13 21:32:19 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Tue, 13 May 1997 13:32:19 -0700 (PDT)
Subject: R-alpha: batch mode
In-Reply-To: <9705121211.AA00399@>
Message-ID: <Pine.SUN.3.95.970513133125.1659A-100000@avon>


The problem is not quite what I thought.

If I delete par(lwd=1) from my local .Rprofile the problem goes away.
Strange but true.

Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 14 07:04:20 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 14 May 1997 08:04:20 +0200
Subject: R-alpha: Revised Patch 2
In-Reply-To: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>
References: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>
Message-ID: <199705140604.IAA27457@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> I have put the glm code in the right place and redone the patch.  To
> help avoid confusion the new patch has an "a" appended to its name.
> The patch can be obtained as:

> 	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2a.gz

Thanks, works fine now.

For those who use my Debian Linux/GNU/ix86 packages, they have been
upgraded to 2a plus 3 more patches (legend, lsfit, doc2ms) recently
posted.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 14 08:17:23 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 May 97 09:17:23 +0200
Subject: R-alpha: batch mode. -- okay for me
In-Reply-To: <Pine.SUN.3.95.970513130620.1600B-100000@avon> (message from
 Thomas Lumley on Tue, 13 May 1997 13:10:41 -0700 (PDT))
Message-ID: <9705140717.AA01210@>

I can NOT confirm your batch problems.

For me, both

	echo "1+1" | R
and
	echo "1+1" > test.R
	R < test.R

work fine.
uname -a
	SunOS florence 5.5 Generic sun4u sparc SUNW,Ultra-1
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 14 15:57:08 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 14 May 1997 07:57:08 -0700 (PDT)
Subject: R-alpha: stop() in batch mode.
In-Reply-To: <9705140717.AA01210@>
Message-ID: <Pine.SUN.3.95.970514075254.2996A-100000@zen>

The batch mode stack imbalances appear to be confined to error reporting.
In particular the stop() command seems to trigger them.  

Solaris-gorn% more break.R
stop("Breaks R")

Solaris-gorn% ~/R49 <break.R 

R : Copyright 1997, Robert Gentleman and Ross Ihaka
Version 0.49 Beta (April 23, 1997)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type "license()" for details.

[Previously saved workspace restored]

> stop("Breaks R")
Error: Breaks R
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in stop, 2 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stop("Breaks R")
> 


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 14 17:58:09 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 May 97 18:58:09 +0200
Subject: R-alpha: stop() in batch mode [yes;  was not in  0.16.1]
In-Reply-To: <Pine.SUN.3.95.970514075254.2996A-100000@zen> (message from
 Thomas Lumley on Wed, 14 May 1997 07:57:08 -0700 (PDT))
Message-ID: <9705141658.AA01415@>

I do confirm this one  (SunOS + Solaris).

NOTE: The problem does NOT appear in  0.16.1 yet!
>>>>> "Th" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    Th> The batch mode stack imbalances appear to be confined to error
    Th> reporting.  In particular the stop() command seems to trigger them.

    Th> Solaris-gorn% more break.R stop("Breaks R")

    Th> Solaris-gorn% ~/R49 <break.R

    Th> R : Copyright 1997, Robert Gentleman and Ross Ihaka Version 0.49
    Th> Beta (April 23, 1997)

    Th> R is free software and comes with ABSOLUTELY NO WARRANTY.  You are
    Th> welcome to redistribute it under certain conditions.  Type
    Th> "license()" for details.

    Th> [Previously saved workspace restored]

    >> stop("Breaks R")
    Th> Error: Breaks R Execution halted Error: stack imbalance in
    Th> "unprotect" Execution halted stack imbalance in stop, 2 then 0
    Th> Error: stack imbalance in "unprotect" Execution halted Error: stack
    Th> imbalance in "unprotect" Execution halted stop("Breaks R")
    >>

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 15 05:16:47 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 15 May 1997 16:16:47 +1200 (NZST)
Subject: R-alpha: A Couple of Queries
Message-ID: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>

1) I have been working on making R libraries more like those in S.
I thought it might be advisable to discuss the ideas before springing
them on you.  What I have done is changed things so that each library
has its own frame on the search path.  E.g.

	> search()
	[1] ".GlobalEnv"   "library:base"
	> library("eda")
	> search()
	[1] ".GlobalEnv"   "library:eda"  "library:base"
	> ls(pos=2)
	[1] "coefficients.tukeyline"  "fitted.values.tukeyline"
	[3] "line"                    "medpolish"              
	[5] "plot.medpolish"          "print.medpolish"        
	[7] "print.tukeyline"         "residuals.tukeyline"    
	[9] "smooth"                 
	> assign("x", 10, pos=2)
	> ls(pos=2)
	 [1] "coefficients.tukeyline"  "fitted.values.tukeyline"
	 [3] "line"                    "medpolish"              
	 [5] "plot.medpolish"          "print.medpolish"        
	 [7] "print.tukeyline"         "residuals.tukeyline"    
	 [9] "smooth"                  "x"                      

All the search-path aware functions (ls, objects, assign, get, rm,
etc) now have a pos= argument which can be used to specify a frame to
work on.

I have not given S style path-names to the source of the libraries
because libraries are really internal objects rather than external
directories.

Libraries will have a .First and .Last functions.

I have not done anything about name-space clutter, but I have a couple
of ideas on name hiding which might be possible ( basically, every
library would have to "export" the names it wanted to be visible to
users).

I have not decided whether the user's global environment could be
detached or whether libraries or data objects could be attached before
it on the search path.


2) I am going ahead with implementing saving and restoring of data in
XDR format, so that there will be less trouble with heterogeneous Unix
networks.  Because the format of saved files will change, we must
either be incompatible or have some mechanism for restoring old save
files.  I would rather avoid the compatibility route if possible.
Would anyone be seriously inconvenienced if old data files could not
be restored?  (Its not hard to build in compatibility, it would just
take time which could be spend elsewhere).
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 15 10:04:51 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 15 May 1997 11:04:51 +0200
Subject: R-alpha: A Couple of Queries
In-Reply-To: Ross Ihaka's message of Thu, 15 May 1997 16:16:47 +1200 (NZST)
References: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
Message-ID: <x2lo5h85sb.fsf@bush.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> Would anyone be seriously inconvenienced if old data files could not
> be restored?  (Its not hard to build in compatibility, it would just
> take time which could be spend elsewhere).

I think the time would be well spent. Of course few people as of now
will have important data (only) in .RData format, and those that do
are probably clueful enough to save them in portable format before
upgrading. That situation won't last long, I suspect, (perhaps student
labs are *already* a problem?) and this might not be the last change
of the file format, so making sure that the program structure allows
loading of different file format revisions is likely to be useful
anyway.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Thu May 15 17:12:42 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Thu, 15 May 1997 09:12:42 -0700 (PDT)
Subject: R-alpha: A Couple of Queries
In-Reply-To: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970515090113.4417A-100000@zen>

On Thu, 15 May 1997, Ross Ihaka wrote:


> I have not done anything about name-space clutter, but I have a couple
> of ideas on name hiding which might be possible ( basically, every
> library would have to "export" the names it wanted to be visible to
> users).

This is certainly nice in principle, though not tremendously important at
the moment. It would be convenient to be able to declare functions in a
library that are global to the library but not accessible to the outside
world. 

> 2) I am going ahead with implementing saving and restoring of data in
> XDR format, so that there will be less trouble with heterogeneous Unix
> networks.  Because the format of saved files will change, we must
> either be incompatible or have some mechanism for restoring old save
> files.  I would rather avoid the compatibility route if possible.
> Would anyone be seriously inconvenienced if old data files could not
> be restored?  (Its not hard to build in compatibility, it would just
> take time which could be spend elsewhere).

For my purposes dump() will work fine for transferring old data files.

Will the changes give cross-platform (Mac/Win) portability too?

Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Thu May 15 21:20:57 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Fri, 16 May 1997 08:20:57 +1200 (NZST)
Subject: R-alpha: XDR
Message-ID: <199705152020.IAA00337@stat3.stat.auckland.ac.nz>


There are some 3rd party vendors that sell XDR support for windows/95/NT
however, they cost real money which is one of the things we don't have.
So in principle XDR is fine for cross-platform transfer in practice
it isn't likely.

robert
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 15 21:18:44 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 16 May 1997 08:18:44 +1200 (NZST)
Subject: R-alpha: A Couple of Queries
Message-ID: <199705152018.IAA02994@stat1.stat.auckland.ac.nz>

> > I have not done anything about name-space clutter, but I have a couple
> > of ideas on name hiding which might be possible ( basically, every
> > library would have to "export" the names it wanted to be visible to
> > users).

> This is certainly nice in principle, though not tremendously important at
> the moment. It would be convenient to be able to declare functions in a
> library that are global to the library but not accessible to the outside
> world. 

This is what I had in mind.  The functions in the library (and those
exported) could see all functions and data in the library, but only the
exported objects would be visible globally.  Of course, R scoping
can be used to provide this kind privacy, but you have to think
about setting up the libraries more carefully.

> > 2) I am going ahead with implementing saving and restoring of data in
> > XDR format, so that there will be less trouble with heterogeneous Unix
> > networks.  Because the format of saved files will change, we must
> > either be incompatible or have some mechanism for restoring old save
> > files.  I would rather avoid the compatibility route if possible.
> > Would anyone be seriously inconvenienced if old data files could not
> > be restored?  (Its not hard to build in compatibility, it would just
> > take time which could be spend elsewhere).

> For my purposes dump() will work fine for transferring old data files.

> Will the changes give cross-platform (Mac/Win) portability too?

This will depend on the availability of the XDR library for those
platforms.  I seem to recall that XDR is available for Windows at least.

I'm rather more concerned with Unix because it is common to have a mix
of platforms accessing the same data under Unix.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Fri May 16 05:59:17 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 16 May 1997 16:59:17 +1200 (NZST)
Subject: R-alpha: A Quick Way to Kill S ...
Message-ID: <199705160459.QAA16516@stat1.stat.auckland.ac.nz>

Start S and detach the directory at position 2.

	S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
	S : Copyright AT&T.
	Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
	Working data will be in /users/rdev/ihaka/.Data 
	> search()
	[1] "/users/rdev/ihaka/.Data"                             
	[2] "/usr/local/pkg/splus/splus-3.4/splus/.Functions"     
	[3] "/usr/local/pkg/splus/splus-3.4/stat/.Functions"      
	[4] "/usr/local/pkg/splus/splus-3.4/s/.Functions"         
	[5] "/usr/local/pkg/splus/splus-3.4/s/.Datasets"          
	[6] "/usr/local/pkg/splus/splus-3.4/stat/.Datasets"       
	[7] "/usr/local/pkg/splus/splus-3.4/splus/.Datasets"      
	[8] "/usr/local/pkg/splus/splus-3.4/library/trellis/.Data"
	> detach(pos=2,save="x")
	Error in UseMethod("assign", where): No specific or default method found
	Dumped
	> assign
	function(x, value, frame, where = NULL, ...)
	UseMethod("assign", where)
	> search()
	[1] "/users/rdev/ihaka/.Data"                             
	[2] ""                                                    
	[3] "/usr/local/pkg/splus/splus-3.4/stat/.Functions"      
	[4] "/usr/local/pkg/splus/splus-3.4/s/.Functions"         
	[5] "/usr/local/pkg/splus/splus-3.4/s/.Datasets"          
	[6] "/usr/local/pkg/splus/splus-3.4/stat/.Datasets"       
	[7] "/usr/local/pkg/splus/splus-3.4/splus/.Datasets"      
	[8] "/usr/local/pkg/splus/splus-3.4/library/trellis/.Data"
	System terminating: bad address

Ouch!

As you can see I've been playing with search paths.  I hope to have
more patches next week which will implement search paths for R more
completely (I think I'll skip the feature above).

I have also converted to using XDR for workspace saving (maintaining
backwards compatibility).  The bits of XDR we use are pretty simple
so it may be possible to create version for windows and	the mac.

Now I want to be able to attach saved workspaces, and perhaps
introduce some sort of "demand loadable" data object.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 16 17:39:46 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 16 May 1997 18:39:46 +0200
Subject: R-alpha: A Couple of Queries
In-Reply-To: <x2lo5h85sb.fsf@bush.kubism.ku.dk>
References: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
 <x2lo5h85sb.fsf@bush.kubism.ku.dk>
Message-ID: <199705161639.SAA07695@aragorn.ci.tuwien.ac.at>

>>>>> Peter Dalgaard BSA writes:

> Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
>> Would anyone be seriously inconvenienced if old data files could not
>> be restored?  (Its not hard to build in compatibility, it would just
>> take time which could be spend elsewhere).

> I think the time would be well spent. Of course few people as of now
> will have important data (only) in .RData format, and those that do
> are probably clueful enough to save them in portable format before
> upgrading. That situation won't last long, I suspect, (perhaps student
> labs are *already* a problem?) and this might not be the last change
> of the file format, so making sure that the program structure allows
> loading of different file format revisions is likely to be useful
> anyway.

Agreed.  I have a few .RData files, but I can live with recreating them.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From la-jassine@aix.pacwan.net  Fri May 16 16:16:24 1997
From: la-jassine@aix.pacwan.net (Paul Gilbert)
Date: Fri, 16 May 1997 12:16:24 -0300
Subject: R-alpha: A Couple of Queries
Message-ID: <1348302032-894051@aix.pacwan.net>

>1) I have been working on making R libraries more like those in S.
...
>	> library("eda")
>	> search()
>	[1] ".GlobalEnv"   "library:eda"  "library:base"

As I recall in S, library() adds to the end of the search list unless
First=T is specified. The function attach() works by putting things in
position 2.

>Libraries will have a .First and .Last functions.
As I recall these are called .First.lib and .Last.lib in S.

>I have not done anything about name-space clutter, but I have a couple
>of ideas on name hiding which might be possible ( basically, every
>library would have to "export" the names it wanted to be visible to
>users).

In theory this is probably the preferred way to do this, but I think
compatability with S may be more easily maintained if you explicitly hide
names which can be hidden.

...
>Would anyone be seriously inconvenienced if old data files could not
>be restored? 

This is not a problem for me. However, if you do it, a separate conversion
utility might be better as it is something for which there will eventually
be no need.

Also, on XDR, I  took a quick scan through the Bank  of Canada PADI code
which uses XDR, just to see if there might be any helpful hints.  I didn't
find too much, but there where a number of comments about "deleting NULL
pointers so that XDR does not barf," for what that's worth. Good luck.

Paul Gilbert

 P.S.  0.49 with patch2a seems to be working really well. The most serious
problem for my time series library is now eigen() for non-symmetric matrices.


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 18 20:50:16 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 19 May 1997 07:50:16 +1200 (NZST)
Subject: R-alpha: Eigenvalue Computation Query
Message-ID: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>

I have been looking at the "eigen" function and have reintroduced the
ability to compute (right) eigenvalues and vectors for non-symmetric
matrices.  I've also made "eigen" complex capable.

The code is based on the eispack entry points RS, RG, CH, CG (which is
what S appears to use too).  The problem with both the S and R
implementations is that they consume huge amounts of memory.  Some of
this is due to purely ".Fortran" overhead, which I think I can cure.
But some of the bloat is due to the inclusion of special eigenvalues-only
code from eispack.

The question is:

Should I drop this special code and always compute both eigenvalues
and eigenvectors?  This would substantially reduce code size, but might
increase computational cost in the case where only eigenvalues are
needed.


PS: For the lapack fans out there ...  I looked hard at using lapack
as an alternative to eispack, but it's written in a fashion which
does not make its addition to R as simple as linpack and eispack.
When we all have SMP desktop machines it will become more of an issue.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Tue May 20 02:09:01 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Mon, 19 May 1997 20:09:01 -0500 (CDT)
Subject: R-alpha: A Couple of Queries
In-Reply-To: <199705152018.IAA02994@stat1.stat.auckland.ac.nz> from "Ross Ihaka" at May 16, 97 08:18:44 am
Message-ID: <9705200109.AA26588@nokomis.stat.umn.edu>

Ross Ihaka wrote:
> 
> This is what I had in mind.  The functions in the library (and those
> exported) could see all functions and data in the library, but only the
> exported objects would be visible globally.  Of course, R scoping
> can be used to provide this kind privacy, but you have to think
> about setting up the libraries more carefully.
> 

Is your design consistent with (maybe not now but later) allowing a
library to specify a static search path component for code defined in
it that comes before entries added dynamically at runtime? THis would
allow a "uses" specification where a library definition specifies
other libraries it uses and can be sure these will be used and not
whatever happens to be attached earlier on the search path. Among
other things, this might allow something like

	LIBRARY: survival
	EXPORTS: coxph, ...
	USES: S.compatibility, S.syntax, ...
	.... insert Terry's latest code ...

So when the library is loaded, S syntax is used (if it differs from
R's) and when the body of a function like coxph is executed,
definitions from the S compatibility library will be called instead of
standard R ones (if they differ).  This would make it easier for R to
go its own way when it that seems appropriate without losing the
ability to use S code.

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 06:54:12 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 07:54:12 +0200
Subject: R-alpha: small doc bug
Message-ID: <199705200554.HAA25739@aragorn.ci.tuwien.ac.at>

The documentation for ls/objects has

	ls(name, pos=2, envir=sys.frame(sys.parent()),
           all.names=FALSE, pattern)

but the code has

	ls <-
	function (name, pos = -1, envir = NULL,
                  all.files = FALSE, pattern)

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 07:18:22 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 08:18:22 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
Message-ID: <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> I have been looking at the "eigen" function and have reintroduced the
> ability to compute (right) eigenvalues and vectors for non-symmetric
> matrices.  I've also made "eigen" complex capable.

> The code is based on the eispack entry points RS, RG, CH, CG (which is
> what S appears to use too).  The problem with both the S and R
> implementations is that they consume huge amounts of memory.  Some of
> this is due to purely ".Fortran" overhead, which I think I can cure.
> But some of the bloat is due to the inclusion of special eigenvalues-only
> code from eispack.

> The question is:

> Should I drop this special code and always compute both eigenvalues
> and eigenvectors?  This would substantially reduce code size, but might
> increase computational cost in the case where only eigenvalues are
> needed.

I'd say, reduce code size.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Friedrich.Leisch@ci.tuwien.ac.at  Tue May 20 08:26:06 1997
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Tue, 20 May 1997 09:26:06 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
 <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
Message-ID: <199705200726.JAA07429@galadriel.ci.tuwien.ac.at>

>>>>> On Tue, 20 May 1997 08:18:22 +0200,
>>>>> Kurt Hornik wrote:

>>>>> Ross Ihaka writes:
>> I have been looking at the "eigen" function and have reintroduced the
>> ability to compute (right) eigenvalues and vectors for non-symmetric
>> matrices.  I've also made "eigen" complex capable.

>> The code is based on the eispack entry points RS, RG, CH, CG (which is
>> what S appears to use too).  The problem with both the S and R
>> implementations is that they consume huge amounts of memory.  Some of
>> this is due to purely ".Fortran" overhead, which I think I can cure.
>> But some of the bloat is due to the inclusion of special eigenvalues-only
>> code from eispack.

>> The question is:

>> Should I drop this special code and always compute both eigenvalues
>> and eigenvectors?  This would substantially reduce code size, but might
>> increase computational cost in the case where only eigenvalues are
>> needed.

> I'd say, reduce code size.

probably one shouldn't disagree with his boss openly ... but we
are the ones actually doing all the simulations :-)

do you know how much the difference in computational cost is? if it's
worth the increase in code size I'd rather prefer only computing the
required eigenvalues

best,
fritz


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 20 10:24:18 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 20 May 1997 11:24:18 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: Friedrich Leisch's message of Tue, 20 May 1997 09:26:06 +0200
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
 <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
 <199705200726.JAA07429@galadriel.ci.tuwien.ac.at>
Message-ID: <x24tbywl6l.fsf@bush.kubism.ku.dk>

Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:

> > I'd say, reduce code size.
> 
> probably one shouldn't disagree with his boss openly ... but we
> are the ones actually doing all the simulations :-)
> 
> do you know how much the difference in computational cost is? if it's
> worth the increase in code size I'd rather prefer only computing the
> required eigenvalues

As I understand it, the difference is between getting all the
eigenvalues and all eigenvalues and -vectors. Getting only the top or
bottom few is not an option in Splus either, but that would be where
the real savings lie.

I'd say do the small thing now and rethink the whole numerics business
later (could we lift all of libcruft.a out of the octave source, for
instance?). If you need some special eispack routines, you can always
dyn.load them in.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 15:31:57 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 16:31:57 +0200
Subject: R-alpha: Re unified shell script
Message-ID: <199705201431.QAA27356@aragorn.ci.tuwien.ac.at>

Some time ago there was the suggestion to add a PLATFORM subdir level
for bin (and eventually the library subdirs with `binaries'), and the
idea to have the shell wrapper automagically call the right binary.

I mentioned that one might be able to use the shell variables OSTYPE and
HOSTTYPE for that, noticing however that e.g on my Debian Linux/GNU/ix86

		bash	tcsh
OSTYPE		Linux	linux
HOSTTYPE	i386	i386-linux

Hmm ... It seems (a colleague just checked that) that these variables
are not POSIX either, and hence I'd say rather useless for our purpose.

In the absence of a reliable run-time possibility to determine the
current platform, it seems to be natural to use `platform' as obtained
at compile-time for possibly distinguishing the various binaries etc,
and leave it at the discretion of the sysadmin to ensure that the R
script in the path calls the right binary.

If I am missing something obvious, please let me know.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 20 16:11:18 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 20 May 97 17:11:18 +0200
Subject: R-alpha: print 'problems': print(2^30, digits=12); comments at start of function()
Message-ID: <9705201511.AA00407@>

Both of these bugs are not a real harm,
however, they have been annoying me for too long ... ;-)

1)
 print(2^30, digits = 12) #-  exponential form; unnecessarily!

 formatC(2^30, digits = 12) #- shows you what you'd want above

 ## S-plus is okay here; note that the problem also affects
 ##	paste(.)  & format(.) :
 
 options(digits=10)
 paste(2^(4*1:8))
 
 S-plus gives

[1] "16"         "256"        "4096"       "65536"      "1048576"   
[6] "16777216"   "268435456"  "4294967296"

 whereas R gives

[1] "16"              "256"             "4096"            "65536"          
[5] "1048576"         "1.6777216e+07"   "2.68435456e+08"  "4.294967296e+09"



2) This one has been reported (in slightly different form)
   >> Date: Mon, 10 Mar 1997 09:46:37 +0100 (MET)
   >> From: Martyn Plummer <plummer@iarc.fr>
   >> To: r-testers@stat.math.ethz.ch

   >> #4) If you put a few lines of comments at the start of a function,
   >>     then the comments always appear *after* the first line of code. 

This is REALLY painful; try, e.g.,

fcat <- function(..., f.dig= 4, f.wid = f.dig +5, f.flag = ' ', nl = TRUE,
                 file = "", sep = " ",
                 fill = FALSE, labels = NULL, append = FALSE)
{
  ## Purpose: Formatted CAT -- for printing 'tables'
  ## ----------------------------------------------------------------------
  ## Author: Martin Maechler, Date: 12 May 97
  l <- unlist(lapply(list(...), formatC,
                     wid= f.wid, digits= f.dig, flag= f.flag))
  cat(l, if(nl)"\n", file=file, sep=sep, fill=fill,labels=labels, append=append)
}

# and look how it prints:
fcat

Even worse, some comments are silently lost (yes, I know in some
sitatuations,  S also loses comments) : 

ex <- 
##
## S version 4 likes comments like these.  
## ----------- They automagically become  on-line help.
## R just swallows them up into /dev/null...
##
function(a,b)
{
	a + b
}
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 20 17:24:48 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 20 May 97 18:24:48 +0200
Subject: R-alpha: rep(.) and aperm(.)  lose names(.) and dimnames(.)  -- Patch
Message-ID: <9705201624.AA00517@>

The following patches fix the problem.
For aperm, it's quite important to keep dimnames(.);
for rep(.), it's arguable, however S(-plus) does it...

However, it would probably be better to this in the '.Internal' code for
all attributes.

Patch to be applied in		$RHOME/src/library/base/funs/ 

--- rep~	Sun Nov 24 23:42:29 1996
+++ rep		Tue May 20 18:20:12 1997
@@ -5,6 +5,7 @@
 	if (missing(times))
 		times <- ceiling(length.out/length(x))
 	r<-.Internal(rep(x,times))
+	if(!is.null(nm <- names(x))) names(r) <- .Internal(rep(nm, times))
 	if (!missing(length.out))
 		return(r[1:length.out])
 	return(r)

--- aperm~	Sun Nov 24 23:42:20 1996
+++ aperm	Tue May 20 18:20:10 1997
@@ -7,5 +7,7 @@
 		if(!all(sort(perm)==1:length(perm)))
 			stop("perm is not a permutation")
 	}
-	.Internal(aperm(a,perm,resize))
+	r <- .Internal(aperm(a, perm, resize))
+	if(!is.null(dn <- dimnames(a))) dimnames(r) <- dn[perm]
+	r
 }

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 17:25:41 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 18:25:41 +0200
Subject: R-alpha: S_alloc
Message-ID: <199705201625.SAA27815@aragorn.ci.tuwien.ac.at>

Does anyone know what exactly S_alloc() does?  (Yes, it's porting time
again ...)

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Tue May 20 18:38:54 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Tue, 20 May 1997 12:38:54 -0500 (CDT)
Subject: R-alpha: S_alloc
In-Reply-To: <199705201625.SAA27815@aragorn.ci.tuwien.ac.at> from "Kurt Hornik" at May 20, 97 06:25:41 pm
Message-ID: <9705201738.AA09065@nokomis.stat.umn.edu>

Kurt Hornik wrote:
> 
> Does anyone know what exactly S_alloc() does?  (Yes, it's porting time
> again ...)
> 
> Thanks,
> -k
> =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> 

I believe it allocates zero'd memory like calloc but S is responsible
for freeing it (calling free on it probably has "unpredictable results
..."). S probably usually frees the memry on return from the function
call that got you into C code. In old versions of S I think this was
managed by saving/ resetting the sbrk on function entry/exit and
allocating above the current sbrk value. THis way memory used in a
function was recovered just by restoring the sbrk -- a nice
stack-based discipline. I think the current strategy is a bit
different both to allow portability and to improve memory recovery
during a function call. As a rasult, memory allocated may not be freed
right after the outer call returns, but since S doesn't have a garbage
collector as such it probably has to happen pretty soon after the
return.

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:46:18 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:46:18 +0200
Subject: R-alpha: planned update of ctest
Message-ID: <199705201746.TAA28426@aragorn.ci.tuwien.ac.at>

I am contemplating improving my ctest package as follows:

* Add exact p,q,r,s functions for the Wilcoxon distribution, and change
the test accordingly (make `exact' work).

* Make Fisher's test work for tables larger than 2 by 2.

* Perhaps add an exact unconditional test for 2 by 2 tables?

* Perhaps add something on estimating/testing relative risk and odds?

As clearly I'd like to minimize my efforts I'd be happy about any
suggestion for availability of code, and for a good interface for the
last idea.

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:50:56 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:50:56 +0200
Subject: R-alpha: elementary statistics
Message-ID: <199705201750.TAA28447@aragorn.ci.tuwien.ac.at>

A while ago, Peter wrote

In the same vein, we'll need plot.distrib() (based on Martins plot.step)
plot.KM() (Kaplan-Meier plots, ditto) and logrank.test(). I.e. all the
"statistical over-the-counter medicine". (And in teaching them we'll
ruthlessly ignore all the fine points of the fine language...)

Has anyone looked into this?

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:52:49 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:52:49 +0200
Subject: No subject
Message-ID: <199705201752.TAA28456@aragorn.ci.tuwien.ac.at>

And finally, for something completely different.  I am contemplating
teaching a course on `Statistical Computing' next semester.  Sort of a
basic introduction on statistical software, with emphasis on Xlisp-STAT
plus ViSta and, of course, R.

Would anyone have (or know of) material that I could use?

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 20 19:18:02 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 20 May 1997 20:18:02 +0200
Subject: R-alpha: planned update of ctest
In-Reply-To: Kurt Hornik's message of Tue, 20 May 1997 19:46:18 +0200
References: <199705201746.TAA28426@aragorn.ci.tuwien.ac.at>
Message-ID: <x2raf2uhwl.fsf@bush.kubism.ku.dk>

Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

> 
> I am contemplating improving my ctest package as follows:
> 
> * Add exact p,q,r,s functions for the Wilcoxon distribution, and change
> the test accordingly (make `exact' work).
> 
> * Make Fisher's test work for tables larger than 2 by 2.
> 
> * Perhaps add an exact unconditional test for 2 by 2 tables?
> 
> * Perhaps add something on estimating/testing relative risk and odds?
> 
> As clearly I'd like to minimize my efforts I'd be happy about any
> suggestion for availability of code, and for a good interface for the
> last idea.

As usual, all you'll get is suggestions for more enhancements:

* Order-based statistics with scores different from ranks (i.e. Van
der Waerdens test, etc.)

* Logrank test (a bit hefty to pull out the survival package for that)

* Stratified tests. I actually need those (Wilcoxon and K-W versions)
for a client, so I might put a new student computational assistant on
it. Not sure whether that will break her in or just break her,
though...

Re. relative risks, you can quite easily setup an exact test for 
RR=r (I forget, but it's something like multiplying the point
probabilities in Fishers test with r^x). Consequently, you can also
compute confidence intervals. One snag is the usual mess with the
definition of the two-sided p-value. I have previously used two sided
intervals consisting of those values that weren't significantly too
big [1] at the alpha/2 level nor significantly too small at the same
level, but I'm not altogether sure that holds.

[1] Yeah, yeah. "...for which the data were not significantly too
small, using a one-sided test", etc.
-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 09:19:14 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 10:19:14 +0200
Subject: R-alpha: plot.default(.) : (too?) many  "..."  ---  plot(.., lab =c(10,10,7)) fails
Message-ID: <9705210819.AA00743@>

A simple example:
	plot(1:10, 1:10, main = "TITLE", lab = c(10,10,7))
	 #> Error: invalid subscript type

The reason is the call to  axis(1, ...) in  plot.default(.).

plot.default has the  ...  arguments in order to pass the many different
possible 'par' options to it's own subfunctions.

Currently, plot.default has

 plot.xy(xy, type, col = col, pch = pch, cex = cex, bg = bg, lty = lty, ...)
 axis(1, ...)
 axis(2, ...)
 box(...)
 title(main = main, xlab = xlab, ylab = ylab, ...)


In order for this to work, all the subfunctions MUST be tolerant to all
possible argument specifications.
axis(.) is NOT  which leads to the above  Error.

A different approach would be to "analyze"  list(...),
extract relevant parameters and pass them to the different sub-functions of
plot.default(.).

BY THE WAY:

  It would be nice to be able to say

	par(reset = TRUE)  

  (or similar) for resetting all the graphical parameters to their (device-dependent)
  default values.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 21 11:31:05 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 21 May 1997 12:31:05 +0200
Subject: R-alpha: factors ...
Message-ID: <199705211031.MAA31074@aragorn.ci.tuwien.ac.at>

Perhaps someone can enlighten me here:

R> x <- factor(LETTERS[1:3])
R> x
[1] A B C
R> mode(x)
[1] "factor"
R> class(x)
[1] "factor"
R> mode(unclass(x))
[1] "factor"

S-PLUS has

> x <- factor(LETTERS[1:3])
> mode(x)
[1] "numeric"
> class(x)
[1] "factor"
> mode(unclass(x))
[1] "numeric"

???
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 21 11:32:45 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 21 May 1997 12:32:45 +0200
Subject: R-alpha: iris
Message-ID: <199705211032.MAA31089@aragorn.ci.tuwien.ac.at>

Also, why is the iris data set shipped with R different from the one
that comes with S-PLUS?

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 12:00:00 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 13:00:00 +0200
Subject: R-alpha: plot(1); axis(1, at=10) >>> Seg.fault  -- and a patch
Message-ID: <9705211100.AA00805@>


This problem has been mentioned  by Arne Kovac <maak@stats.bris.ac.uk>  on May 9-10.
The patch is really a replacement of 'axis' in  RHOME/src/library/base/funs/

It contains the fixes which where proposed Arne Kovac
and fixes (all?) the errors he/she (?) reported on May 9.

"axis" <-
function (which, at, labels = TRUE, ...) 
{
	if (which%%2 == 1) {
		axp <- par("xaxp")
		usr <- par("usr")[1:2]
		log <- par("xlog")
	}
	else {
		axp <- par("yaxp")
		usr <- par("usr")[3:4]
		log <- par("ylog")
	}
	if (missing(at)) {
		if (log) {
			if (usr[2] < usr[1] + 1) {
				at <- seq(axp[1], axp[2], length = axp[3] + 1)
			}
			else {
				p1 <- ceiling(min(usr))
				p2 <- floor(max(usr))
				if (p2 - p1 < 2) {
				 at <- c(1, 2, 5) * 10^rep(p1:p2, rep(3, p2 - p1 + 1))
				 at <- at[10^usr[1] <= at & at < 10^usr[2]]
				}
				else at <- 10^seq(p1, p2, by = 1)
			}
		}
		else at <- seq(axp[1], axp[2], length = axp[3] + 1)
		ind <- rep(TRUE, length(at))
	}
	else {
		ind <- (usr[1] <= at & at <= usr[2])
	}
	if (is.logical(labels)) {
		if (labels) {
			if (!log) 
				at[abs(at/(max(at) - min(at))) < 0.001] <- 0
			labels <- format(at, trim = T)
		}
		else labels <- rep("", length(at))
	}
	else labels <- format(labels, trim = T)
	.Internal(axis(which, as.double(at[ind]), labels[ind], ...))
}

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From la-jassine@aix.pacwan.net  Wed May 21 16:00:51 1997
From: la-jassine@aix.pacwan.net (Paul Gilbert)
Date: Wed, 21 May 1997 12:00:51 -0300
Subject: R-alpha: Eigenvalue Computation Query
Message-ID: <1347889984-174502@aix.pacwan.net>

Ross

>Should I drop this special code and always compute both eigenvalues
>and eigenvectors?  This would substantially reduce code size, but might
>increase computational cost in the case where only eigenvalues are
>needed.

I often need the eigenvalues only, but in my experience the main causes for
slowness is when I start using more memory than is physically available. (My
machine starts sounding like it does when I run S.) I would guess that
reducing code size may be more valuable than the specialized code.

Paul Gilbert

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 21 16:01:11 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 May 1997 08:01:11 -0700 (PDT)
Subject: R-alpha: factors ...
In-Reply-To: <199705211031.MAA31074@aragorn.ci.tuwien.ac.at>
Message-ID: <Pine.SUN.3.95.970521075757.7924A-100000@zen>

On Wed, 21 May 1997, Kurt Hornik wrote:

> Perhaps someone can enlighten me here:
> R> x <- factor(LETTERS[1:3])
> [1] "factor"
> 
> S-PLUS has
> > x <- factor(LETTERS[1:3])
> > mode(unclass(x))
> [1] "numeric"

It's a feature. R has a primitive factor type, S-PLUS doesn't and so loses
factorness with unclass(). You can use as.numeric() to coerce to numeric
in either system. 


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 18:04:35 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 19:04:35 +0200
Subject: R-alpha: Plot: Title above 'mfrow=c(2,2)' ??
Message-ID: <9705211704.AA01031@>


In S, I can have an "overall" title in a multi-figure plot :

    par(mfrow=c(2,2), oma = c(0,0,2,0))
    frame() #- !
    mtext("Sine Functions", cex=2, outer =T)
    x_1:100
    for(i in 1:4) plot(x, sin(i*pi*x/100), main=paste(i), type = 'l', col = 1+i)

In R, this doesn't work as it should,  with and without the 'frame()' 
statement.
((where is the bug?  It's not quite clear to me))

Is there a way at all to write an "overall" title in this situation ?

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 21 18:08:26 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 May 1997 10:08:26 -0700 (PDT)
Subject: R-alpha: Plot: Title above 'mfrow=c(2,2)' ??
In-Reply-To: <9705211704.AA01031@>
Message-ID: <Pine.SUN.3.95.970521100651.7972C-100000@zen>

On Wed, 21 May 1997, Martin Maechler wrote:

> In S, I can have an "overall" title in a multi-figure plot :
> 
> 
> Is there a way at all to write an "overall" title in this situation ?

 par(mfrow=c(2,2), oma = c(0,0,2,0))
 # do the plots
 par(mfrow=c(1,1))
 title(main="blah")



Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Wed May 21 21:26:43 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 May 1997 08:26:43 +1200 (NZST)
Subject: R-alpha: factors ...
Message-ID: <199705212026.IAA00840@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:

> Perhaps someone can enlighten me here:

> R> x <- factor(LETTERS[1:3])
> R> x
> [1] A B C
> R> mode(x)
> [1] "factor"
> R> class(x)
> [1] "factor"
> R> mode(unclass(x))
> [1] "factor"

> S-PLUS has

> > x <- factor(LETTERS[1:3])
> > mode(x)
> [1] "numeric"
> > class(x)
> [1] "factor"
> > mode(unclass(x))
> [1] "numeric"

> ???

Originally, factors in R were implemented as a special type.  This was
partly because we didn't have objects at the start, and partly because
S factors have a annoying habit of forgetting that they are factors.  E.g.

	> x <- factor(LETTERS[1:3])
	> c(x, 1)
	[1] 1 2 3 1
	> c(x,"a")
	[1] "1" "2" "3" "a"

However, in order to be compatible with S, a factor "x" needs to
satisfy inherits(x,"factor").  So we also attach "class" of factor to
them as well.  Any "class" manipulations use the "class" attribute but
all internal manipulations are based on the "mode".

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Wed May 21 21:29:24 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 May 1997 08:29:24 +1200 (NZST)
Subject: R-alpha: iris
Message-ID: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>

> Also, why is the iris data set shipped with R different from the one
> that comes with S-PLUS?

Do you mean the numbers in the data, or the fact that we have a data
frame and they have a 50x4x3 array?   (I've never understood why anyone
would have structured the iris data that way ...).
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 06:28:52 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 07:28:52 +0200
Subject: R-alpha: iris
In-Reply-To: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>
References: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>
Message-ID: <199705220528.HAA03991@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

>> Also, why is the iris data set shipped with R different from the one
>> that comes with S-PLUS?

> Do you mean the numbers in the data, or the fact that we have a data
> frame and they have a 50x4x3 array?   (I've never understood why anyone
> would have structured the iris data that way ...).

The latter.  I am playing a bit with porting Brian's `class' library,
and surprisingly the tests he has use the iris data set ...

The df makes more sense, right.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 12:25:46 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 13:25:46 +0200
Subject: No subject
Message-ID: <199705221125.NAA05423@aragorn.ci.tuwien.ac.at>

Does anyone have a description of the S help format?
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 13:07:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 14:07:16 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <199705221125.NAA05423@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Thu, 22 May 1997 13:25:46 +0200)
Message-ID: <9705221207.AA01336@>

>>>>> "Kurt" == Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

    Kurt> Does anyone have a description of the S help format?  -k

Not really, here is what you get from  ?prompt  in S-plus

 Construct Documentation for Function or Data


 DESCRIPTION:
	Produces a file that can be edited  and  then  nroffed  or
	troffed  to give documentation (a helpfile) for a function
	or dataset.

 USAGE:
	prompt(object, filename=<<see below>>)

 REQUIRED ARGUMENTS:
 object:   name or character string giving the name of a  function
	or data object.

 OPTIONAL ARGUMENTS:
 filename:   filename for resulting documentation; the default  is
	name.d, where name is the character string  resulting from
	deparsing the object name.

 SIDE EFFECTS:
	A file is written, containing an outline  for  documenting
	the  function  or  object.   A  message  is printed to the
	screen giving the name of the created file.  The file will
	eventually  be  used  by  the  help  function  to  produce
	documentation for the object.  As produced by prompt,  the
	file  for a function will contain the call to the function
	and individual sections for each of  the  arguments.   The
	file  for  a  data frame will contain the name of the data
	frame, its dimensions, and individual sections for each of
	the variables in the data frame.

 DETAILS:
	This is a generic function; there is  a  method  for  data
	frames and a default method.

	You will need to fill in the actual information about  the
	arguments,  a  description  of  the  value returned by the
	function, examples,  and  whatever  other  information  is
	appropriate.  Lines in the file that contain "~" should be
	replaced with  appropriate  information.   Arguments  that
	must  be  specified  in the name=value form should have an
	equal sign (=) added after name on the .AG name line.

	To add a section such as "WARNING" make a  line  beginning
	with  ".SH"  (for  example,  ".SH  WARNING")  and  put the
	information on subsequent  lines.  A  line  consisting  of
	".ul" italicizes the next line.

	The correct order of sections for help files created  with
	prompt.default  is as follows:  Title, Description, Usage,
	Required Arguments, Optional  Arguments,  ".GR"  (graphics
	parameters),   Value,   Side  Effects,  Warning,  Details,
	Background, References, See Also, Examples, Keywords.  The
	"Note"  section,  if  it  appears, may be anywhere between
	Side Effects and References.

	The correct order of sections for help files created  with
	prompt.data.frame  is  as  follows:   Title, Summary, Data
	Description, Source, Note, Warning, See Also, Examples.

	Be sure to leave the line .WR at the  end  of  file;  this
	wraps  things  up  neatly.   If  you  see the message trap
	botch, it is probably from a help file without a .WR.

	For a full description of the formatting macros  available
	in  help files, see the section Documenting Your Module in
	the  chapter  Developing  New  Modules   in   the   S-PLUS
	Programmer's Manual.

	Documentation for functions and data resides (as  ordinary
	text  files)  in  a  subdirectory  called  .Help under the
	directory containing the S-PLUS objects  themselves.   For
	example,  if  you  are documenting a function myfun in the
	directory /usr/me/.Data, the completed documentation  file
	should be moved into the .Help directory with the command

	     mv myfun.d /usr/me/.Data/.Help/myfun

	To see more about how documentation files  are  organized,
	look  at some examples.  Documentation files for functions
	are   in   the   directories    $SHOME/s/.Functions/.Help,
	$SHOME/stat/.Functions/.Help                           and
	$SHOME/splus/.Functions/.Help where $SHOME is  the  S-PLUS
	home directory.  Type

	     !echo $SHOME/s/.Functions/.Help

	from inside S-PLUS to see where this is on your machine.


	You can find more information in the chapter Enhancing  S-
	PLUS of the S-PLUS Installation and Maintenance Manual  in
	the sections entitled Adding Help Files for New  Functions
	and Modifying S-PLUS Keywords.

 SEE ALSO:
	The section "Documenting  Your  Module"  in  the   chapter
	"Developing   New  Modules"  of  the  S-PLUS  Programmer's
	Manual.

	help, help.start, Question.mark.

 EXAMPLES:
	prompt("mygrep")    # construct mygrep.d file
	!vi mygrep.d  # fix up the documentation
	!mkdir .Data/.Help  # if necessary, construct subdirectory
	!mv mygrep.d .Data/.Help/mygrep    # install

--------------------------
Why do you need it?

Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
It contains quite a bit of implicit documentation on the S-help format.
I've been using it a few times  more or less successfully.

YES:	This should come in the  $RHOME/etc/ directory !

- Martin
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Friedrich.Leisch@ci.tuwien.ac.at  Thu May 22 14:32:02 1997
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 May 1997 15:32:02 +0200
Subject: R-alpha: missing warning message
Message-ID: <199705221332.PAA08887@galadriel.ci.tuwien.ac.at>


In R it is possible to write nonsense 

R> 0.5:4:3:9:8:5
[1] 0.5 1.5 2.5 3.5 4.5

and never be warned about it, Splus does the expected thing:

Splus> 0.5:4:3:9:8:5
[1] 0.5 1.5 2.5 3.5 4.5
Warning messages:
1: Numerical expression has 4 elements: only the first used in: 0.5:4:3
2: Numerical expression has 3 elements: only the first used in: 0.5:4:3:9
3: Numerical expression has 9 elements: only the first used in: 0.5:4:3:9:8
4: Numerical expression has 8 elements: only the first used in: 0.5:4:3:9:8:5


Best,
Fritz

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 15:41:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 16:41:16 +0200
Subject: R-alpha: options(..) vs.  .Options  //  Re(1i) = 2.4976e-307
Message-ID: <9705221441.AA01396@>

The 	.Options

vector had been introduced a while ago after my suggestion
(see Ross's E-mail below).
.Options$digits is used be default in several  print methods (eg print.lm),
however, deparse(.) e.g., uses options()$width, and not .Options$width.

Another problem is that  .Options
is still not in the documentation (on-line help).
Before one could add it there, we'd need ``the specs''.

I think the (at least my) idea was that

	options(.)  queries or sets elements in the   .Options  list

and all functions -- including the internal ones -- use  .Options.
As far as I know, this is what S does.
Currently, this is NOT the case in R.

Ross said a while ago:

   >>> From: Ross Ihaka <ihaka@stat.auckland.ac.nz>
   >>> Date: Wed, 11 Dec 1996 17:10:59 +1300 (NZDT)
   >>> To: Martin Maechler <maechler@stat.math.ethz.ch>
   >>> Cc: R-testers mailing list <R-testers@stat.math.ethz.ch>
   >>> Subject: R-alpha: options() and .Options -- ?

    Ross> Martin Maechler writes:
    >> This is not a bug report, rather than some remarks as a
    >> "request for comments":
    >>
    >> It is clear that  options( foo = bar )
    >> sets the option and also updates the builtin()  .Options  list :
    >> 
    >> > options(myopt = pi)
    >> > .Options$my
    >> [1] 3.14159265
    >> 
    >> In S-plus, it was (is) possible to use .Options locally in a function
    >> frame in order to just affect some options during evaluation of that
    >> function.

    Ross> I have made some changes so that such local assignments to .Options
    Ross> will work.  The down side is that such assignments will also work at
    Ross> top level with the changes shadowing the real system options.

    Ross> This also may be ok.  It would have the advantage that options would
    Ross> then be preserved from session to session.  Is this a good idea or a
    Ross> bad idea?

----------
Different issue:

> Re(1i)
[1] 2.497599e-307

rather than  0  whereas  Im(as.complex(1)) gives 0 as it should.

- Martin Maechler
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 15:45:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 16:45:50 +0200
Subject: R-alpha: Re:  Re(1i) = 2.4976e-307
In-Reply-To: <9705221441.AA01396@> (message from Martin Maechler on Thu, 22
 May 97 16:41:16 +0200)
Message-ID: <9705221445.AA01404@>

It is really not 'Re',
but the parser for complex constants which is at fault:

> 1i - complex(imag=1)
[1] 2.497599e-307+0i
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May 22 17:22:07 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 22 May 1997 09:22:07 -0700 (PDT)
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <9705221207.AA01336@>
Message-ID: <Pine.SUN.3.95.970522091037.8749A-100000@zen>

> Why do you need it?
> 
> Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
> on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
> It contains quite a bit of implicit documentation on the S-help format.
> I've been using it a few times  more or less successfully.
> 
> YES:	This should come in the  $RHOME/etc/ directory !
> 
> - Martin

Largely because it isn't a very nice script.  The output is tolerable but
not great -- for example it doesn't use some of the proper R headings for
sections and it doesn't hyperlink the SEE ALSO section. These problems
don't really show up in the help() output but are more obvious in HTML. 

Someone (eg me in about a month from now if someone else hasn't done it
first) needs to work on improving it.  I suspect Kurt or his minions are
planning exactly that :-). 

On the related subject of regular expressions, I'm having trouble with the
\1 construction for the last matched expression
(eg  \([a-zA-Z][^:]*\):\1 which I think should match things of the form
blah:blah)
No matter how many extra \ characters I put in it doesn't work.


Thomas Lumley
-----------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 17:26:35 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 18:26:35 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <Pine.SUN.3.95.970522091037.8749A-100000@zen>
References: <9705221207.AA01336@>
 <Pine.SUN.3.95.970522091037.8749A-100000@zen>
Message-ID: <199705221626.SAA06171@aragorn.ci.tuwien.ac.at>

>>>>> Thomas Lumley writes:

>> Why do you need it?
>> 
>> Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
>> on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
>> It contains quite a bit of implicit documentation on the S-help format.
>> I've been using it a few times  more or less successfully.
>> 
>> YES:	This should come in the  $RHOME/etc/ directory !
>> 
>> - Martin

> Largely because it isn't a very nice script.  The output is tolerable but
> not great -- for example it doesn't use some of the proper R headings for
> sections and it doesn't hyperlink the SEE ALSO section. These problems
> don't really show up in the help() output but are more obvious in HTML. 

> Someone (eg me in about a month from now if someone else hasn't done it
> first) needs to work on improving it.  I suspect Kurt or his minions are
> planning exactly that :-).

Yes, that was the idea.  I sort of converted the script to perl today so
that Fritz can start his magic ... we'll see.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 22 17:32:43 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 22 May 1997 18:32:43 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: Thomas Lumley's message of Thu, 22 May 1997 09:22:07 -0700 (PDT)
References: <Pine.SUN.3.95.970522091037.8749A-100000@zen>
Message-ID: <x2n2pnh3h0.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> On the related subject of regular expressions, I'm having trouble with the
> \1 construction for the last matched expression
> (eg  \([a-zA-Z][^:]*\):\1 which I think should match things of the form
> blah:blah)
> No matter how many extra \ characters I put in it doesn't work.

In what connection? In egrep, consider taking some of them out:

$ egrep '([a-zA-Z][^:]*):\1'
blah:blah
blah:blah
a:a
a:a
A.
A:
A:A
A:A
A:AB
A:AB
AB:B
AB:B
AB:AB
AB:AB
AB:A


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Thu May 22 17:52:10 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Thu, 22 May 1997 09:52:10 -0700 (PDT)
Subject: R-alpha: R-beta: regex
In-Reply-To: <x2n2pnh3h0.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970522094711.8749D-100000@zen>

On 22 May 1997, Peter Dalgaard BSA wrote:
> 
> In what connection? In egrep, consider taking some of them out:
> 

I meant the grep() function in R (which needs \ to be quoted)
 grep("([A-Za-z][^:]*):\1","Ac:Ac",value=T)
character(0)
> grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
character(0)
> grep("([A-Za-z][^:]*):\\\1","Ac:Ac",value=T)
character(0)
> 
but
> grep("([A-Za-z][^:]*):","Ac:Ac",value=T)
[1] "Ac:Ac"


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Thu May 22 18:10:52 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Thu, 22 May 1997 12:10:52 -0500 (CDT)
Subject: R-alpha: options(..) vs.  .Options  //  Re(1i) = 2.4976e-307
In-Reply-To: <9705221441.AA01396@> from "Martin Maechler" at May 22, 97 04:41:16 pm
Message-ID: <9705221710.AA05868@nokomis.stat.umn.edu>

Martin Maechler wrote:
> 
> The 	.Options
> 
> vector had been introduced a while ago after my suggestion
> (see Ross's E-mail below).
> .Options$digits is used be default in several  print methods (eg print.lm),
> however, deparse(.) e.g., uses options()$width, and not .Options$width.
> 
> Another problem is that  .Options
> is still not in the documentation (on-line help).
> Before one could add it there, we'd need ``the specs''.
> 
> I think the (at least my) idea was that
> 
> 	options(.)  queries or sets elements in the   .Options  list
> 
> and all functions -- including the internal ones -- use  .Options.
> As far as I know, this is what S does.
> Currently, this is NOT the case in R.
> 

If I understand this right (which may be a big if :-)) this is a bit
tricky.  What S is trying to do is make .Options a dynamically scoped
variable. This seems to work fine from the user perspective, i.e. if I
do

	g<-function(x) print(x)
	f<-function(x) { .Options$digits<-3; g(x) }

then I get the "right thing"

> f(888888888)
[1] 8.89e+08
[1] 888888888

but actually writing your own functions that use .Options is tricky --

	g<-function() .Options$digits
	f<-function() { .Options$digits<-3; g() }

produces

> f()
[1] 7
> 

since the reference to .Options is governed by ordinary scoping rules.
So some convenient way of looking up the closest dynamic binding is
needed -- just referencing .Options in print.lm, for example, won't do
it. Current Splus defines several methods for print and summary that
just reference .Options, but unless some internal magic is being used
for this name, they won't work as expected.

luke



-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 22 18:15:44 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 22 May 1997 19:15:44 +0200
Subject: R-alpha: R-beta: regex
In-Reply-To: Thomas Lumley's message of Thu, 22 May 1997 09:52:10 -0700 (PDT)
References: <Pine.SUN.3.95.970522094711.8749D-100000@zen>
Message-ID: <x2k9krh1hb.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> 
> On 22 May 1997, Peter Dalgaard BSA wrote:
> > 
> > In what connection? In egrep, consider taking some of them out:
> > 
> 
> I meant the grep() function in R (which needs \ to be quoted)
>  grep("([A-Za-z][^:]*):\1","Ac:Ac",value=T)
> character(0)
> > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
> character(0)
> > grep("([A-Za-z][^:]*):\\\1","Ac:Ac",value=T)
> character(0)
> > 
> but
> > grep("([A-Za-z][^:]*):","Ac:Ac",value=T)
> [1] "Ac:Ac"
> 

I strongly suspect that no number of \s will make it work as long as
do_grep() in main/character.c contains this line:

        eflags = REG_NOSUB;



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 22 21:03:56 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 23 May 1997 08:03:56 +1200 (NZST)
Subject: R-alpha: missing warning message
Message-ID: <199705222003.IAA14092@stat1.stat.auckland.ac.nz>

> In R it is possible to write nonsense 

> R> 0.5:4:3:9:8:5
> [1] 0.5 1.5 2.5 3.5 4.5

> and never be warned about it, Splus does the expected thing:

> Splus> 0.5:4:3:9:8:5
> [1] 0.5 1.5 2.5 3.5 4.5
> Warning messages:
> 1: Numerical expression has 4 elements: only the first used in: 0.5:4:3
> 2: Numerical expression has 3 elements: only the first used in: 0.5:4:3:9
> 3: Numerical expression has 9 elements: only the first used in: 0.5:4:3:9:8
> 4: Numerical expression has 8 elements: only the first used in: 0.5:4:3:9:8:5

I'll put a warning in, but ...

This is one place where the recycling rule is violated.  I've thought
for a while about implementing

	m : n

in the following way

	c(m[1]:n[1] , m[2]:n[2] , ...)

with the shorter argument being recycled out to the length of the longer
one.  I have seen at least one application where this extended could
be used.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 22 22:30:31 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 23 May 1997 09:30:31 +1200 (NZST)
Subject: R-alpha: S-help  (and  S-help-to-R-help)
Message-ID: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>

Before you invest too much effort in fancy conversion scripts ...

I really want to change the documentation format to something based on
SGML - this should be much easier to parse than the present m4
macro-based stuff, and allow use to use more sophisticated tools for
the construction and processing of documentation.

Like much of R, the present solution was just a temporary hack ...
But it is something which is getting to the top of the list.

Any filter you create should have a back-end which could be (easily)
adapted to a new format.

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 06:02:04 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 07:02:04 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>
References: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>
Message-ID: <199705230502.HAA00661@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> Before you invest too much effort in fancy conversion scripts ...
> I really want to change the documentation format to something based on
> SGML - this should be much easier to parse than the present m4
> macro-based stuff, and allow use to use more sophisticated tools for
> the construction and processing of documentation.

Nothing fancy.  Thomas' script has a few (minor) problems, and I'd like
to fix them.

> Like much of R, the present solution was just a temporary hack ...
> But it is something which is getting to the top of the list.

> Any filter you create should have a back-end which could be (easily)
> adapted to a new format.

Hmm.  I think it's more like looking into the S help format to figure
out what is going on.  The new one which converts to SGML will perhaps
be somewhere in between converting to LaTeX and to current R help
format.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 06:33:03 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 07:33:03 +0200
Subject: R-alpha: apropos() available
Message-ID: <199705230533.HAA01011@aragorn.ci.tuwien.ac.at>

Martin and I have `written' a function apropos() for finding all objects
with names matching pattern.  I attach code and documentation.  Perhaps
one could include it in the distribution proper.

We are not sure about returning the position in the search list along
with the matching names found.  Martin thinks it should be on by
default, I think it should be off so that the functions does the same as
in Lisp systems ... Perhaps someone else can decide.

-k

*** apropos.R **********************************************************
apropos <- function (pattern) {
  x <- character(0)
  for (i in 1 : length(search()))
    x <- c(x, ls(pos =3D i, pattern =3D pattern))
  x
}

apropos <- function (pattern, where =3D FALSE) {
  ## Give all objects which match  _pattern_.
  ## By	Kurt Hornik & Martin M=E4chler, May 1997.
  x <- character(0)
  for (i in seq(search())) {
    ll <- length(li <- ls(pos =3D i, pattern =3D pattern))
    if (ll)
      if (where)
	x <- c(x, structure(li, names =3D rep(i, ll)))
      else
	x <- c(x, li)
  }
  x
}
*** apropos.d **********************************************************
TITLE(apropos @@ Find all objects with names matching a pattern)
USAGE(apropos(pattern, where =3D FALSE))
ARGUMENTS(
ARG(pattern @@ a regular expression to match against)
ARG(where @@ a logical indicating whether positions in the search list
should also be returned)
)
DESCRIPTION(
LANG(apropos) returns a vector of character strings giving the names of
all objects in the search list matching LANG(pattern).  If LANG(where)
is LANG(TRUE), their position in the search list is returned as their
names attribute.
)
EXAMPLES(
apropos("lm")
apropos("ls")
apropos("lq")
BLANK
# need the `\\'
apropos("\\[")
BLANK
# everything
length(apropos("."))
BLANK
# those starting with `pr'
apropos("^pr")
BLANK
# the 1-letter things
apropos("^.$")
# the 1-2-letter things
apropos("^..?$")
# the 2-to-4 letter things
apropos("^.{2,4}$")
BLANK
# the 8-and-more letter things
apropos("^.{8,}$")
table(nchar(apropos("^.{8,}$")))
)

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May 23 08:51:34 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 23 May 97 09:51:34 +0200
Subject: R-alpha: Re: S-help -- Ultimate doc.== source : $SPLUS/cmd/help.tr & help.nr
In-Reply-To: <199705221607.SAA06102@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Thu, 22 May 1997 18:07:49 +0200)
Message-ID: <9705230751.AA01646@>

Kurt,
if you really want to find out  what things an  S help file can contain,
you must learn some  nroff/troff  [ maybe use 'groff', the GNU one ].

As always, ultimate documentation is == source.
The definition of the S help is in
the two files
	$SPLUS/cmd/help.[nt]r
where nr ^= nroff, i.e.  ASCII   output
      tr ^= troff  i.e.  printed output (e.g via Postscript conversion)

help.tr starts with

.\" @(#)help.tr.pre version 2.33 created 9/22/95
.\" @(#)Copyright (c), 1987, 1995 StatSci, Inc.  All rights reserved.
.\"
.\" This file defines the macros that S-PLUS help files use.  This file
.\" 	was modified by the S-PLUS SETUP script to tailor it to your system.
.\"


The most important  [nt]roff command  here is
.de AB
	which stands for 'define the  AB  macro'
	which will be referenced by
.AB

------------

Further note:	

	S-plus uses a slightly different help file format than
	'vanilla S' from AT&T.

	E.g, they (StatSci) introduced the extra 
	
	.RA  for 'Required ARGUMENTS'
	.OA  for 'Optional Arguments'
	
	where Chambers et al. just use 'ARGUMENTS' which comes
	automatically before the first argument (with  .AG .... ) is set.
	
PPS:  S version 4 uses a COMPLETELY different system.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 13:01:33 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 14:01:33 +0200
Subject: No subject
Message-ID: <199705231201.OAA02114@aragorn.ci.tuwien.ac.at>

Still trying to port Brian's class TB ...

I need to find replacements for seed_in()/seed_out() and unif_rand().
Looks like the first works with GetSeeds()/PutSeeds().  Can anyone help
me with the second one?

THanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Fri May 23 20:17:28 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 23 May 1997 12:17:28 -0700 (PDT)
Subject: R-alpha: R-beta: regex
In-Reply-To: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970523121557.25867B-100000@data>

On 22 May 1997, Peter Dalgaard BSA wrote:

> > > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
> > character(0)

> I strongly suspect that no number of \s will make it work as long as
> do_grep() in main/character.c contains this line:
> 
>         eflags = REG_NOSUB; 

Is this a feature? If so, can it at least be made optional?


Thomas Lumley
------------------------------------------------------+-----
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Sat May 24 00:09:59 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 23 May 1997 16:09:59 -0700 (PDT)
Subject: R-alpha: var() and missing
In-Reply-To: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970523160648.27149A-100000@data>



var() handles missing values in a very strange way. It is not what the
documentation says
> var(c(NA,1:10))
[1] 0
> var(1:10)
[1] 9.166667
This is because sum() handles NA incorrectly
> sum(NA)
[1] 0
> sum(NA,na.rm=T)
[1] 0
> sum(NA,na.rm=F)
[1] 0

Also the documentation gives a pairwise= option to var() which isn't in
the function.


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sat May 24 20:55:28 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 25 May 1997 07:55:28 +1200 (NZST)
Subject: R-alpha: R-beta: regex
Message-ID: <199705241955.HAA26240@stat1.stat.auckland.ac.nz>

Just ignorance on my my part.  I thought that "grep" didn't do substitutions.
If it inhibits backreferences I'll kill it.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sat May 24 21:02:50 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 25 May 1997 08:02:50 +1200 (NZST)
Subject: R-alpha: var() and missing
Message-ID: <199705242002.IAA26269@stat1.stat.auckland.ac.nz>

> var() handles missing values in a very strange way. It is not what the
> documentation says
> > var(c(NA,1:10))
> [1] 0
> > var(1:10)
> [1] 9.166667
> This is because sum() handles NA incorrectly
> > sum(NA)
> [1] 0
> > sum(NA,na.rm=T)
> [1] 0
> > sum(NA,na.rm=F)
> [1] 0

This is a bug brought in by changes to complex arithmetic.  I have a
fix and will have a patch (later today I hope).

> Also the documentation gives a pairwise= option to var() which isn't in
> the function.

I think the interpreted front end doesn't match the real back-end.
I'll change it.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Sun May 25 14:35:04 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sun, 25 May 1997 15:35:04 +0200
Subject: R-alpha: generic write()
Message-ID: <199705251335.PAA08691@aragorn.ci.tuwien.ac.at>

Attached is a first shot at a generic write with my `old' write.table as
write.data.frame, suitably modified.  There is also a stupid generic
latex function, which is just there because it illustrates that the
extra arguments sep and eol are useful.

In playing with it, I noticed a few `problems'.

* The documentation for factor() says,

	If exclude is set to a zero length vector, then any NA values in
	x are used for form a new level for the factor.  This means that
	there will be no NA values in the result.

Perhaps I don't really understand this, but

R> x <- factor(c(1:3, NA), exclude=numeric(0))
R> x
[1]  1  2  3 NA
R> levels(x)
[1] "1" "2" "3"

???

* coerce.c has two error messages of the form

	error("use \"factor\", \"ordered\", \"cut\" or \"code\" to create factors\n");

but there is no function `code'.

* cat() is a bit inconsistent:

R> cat(x, sep = "&")
1&2&3&4R> cat(x, sep = "&\n")
1&
2&
3&
4
R>

Actually, a final newline is added whenever sep contains a newline.
>From src/main/builtin.c:

        nlsep = 0;
        for (i = 0; i < LENGTH(sepr); i++)
                if (strstr(CHAR(STRING(sepr)[i]), "\n")) nlsep = 1;

	...

        if ((pwidth != INT_MAX) || nlsep)
                Rprintf("\n");

I am not sure this is the right thing to do.

(In particular, it makes it rather messy to incrementally build data
files with `explicit' end-of-line strings (such as "\\") by appending
via cat().)

* I am not sure what should happen with names or dimnames when writing.

* I am also not sure what the optional argument quote should do.  Should
it quote UNCONDITIONALLY, or only the character strings?

-k

***********************************************************************
write <- function(x, file = "data", ...)  UseMethod("write")

write.default <-
function(x, file = "", append = FALSE, quote = FALSE, sep = " ", eol = "\n",
	 na = NA, ncolumns = if (is.character(x)) 1 else 5, ...) {
  if (is.matrix(x)) {
    write.data.frame(x, append = append, quote = quote, sep = sep,
		     eol = eol, na = na, col.names = FALSE, ...) 
  }
  else {
    if (is.factor(x))
      x <- levels(x)[x]
    else
      x <- as.vector(x)
    if (is.vector(x)) {
      x[is.na(x)] <- na
      if (quote)
	x <- paste("\"", x, "\"", sep = "")
      cat(x, file = file, sep = c(rep(sep, ncolumns - 1), eol),
	  append = append)
    }
    else
      stop("No suitable write method available")
  }
}

write.data.frame <-
function(x, file = "", append = FALSE, quote = FALSE, sep = " ", eol = "\n",
	 na = NA, row.names = TRUE, col.names = TRUE)
{
  if (is.data.frame(x) && is.logical(quote) && quote)
    quote <- which(unlist(lapply(x, is.character)))
  x <- as.matrix(x)
  p <- ncol(x)
  d <- dimnames(x)
  x[is.na(x)] <- na
  if (is.logical(quote))
    quote <- if (quote) 1 : p else NULL
  else if (is.numeric(quote)) {
    if (any(quote < 1 | quote > p))
      stop("invalid numbers in quote")
  }
  else
    stop("invalid quote specification")
      
  if (is.logical(row.names)) {
    if (row.names)
      x <- cbind(d[[1]], x)
  }
  else {
    row.names <- as.character(row.names)
    if (length(row.names) == nrow(x))
      x <- cbind(row.names, x)
    else
      stop("invalid row.names specification")
  }
  if (!is.null(quote) && (p < ncol(x)))
    quote <- c(0, quote) + 1

  if (is.logical(col.names))
    col.names <- if (col.names) d[[2]] else NULL
  else {
    col.names <- as.character(col.names)
    if (length(col.names) != p)
      stop("invalid col.names specification")
  }
  if (!is.null(col.names)) {
    if (append)
      warning("appending column names to file")
    if (!is.null(quote))
      col.names <- paste("\"", col.names, "\"", sep = "")
    cat(col.names, file = file, sep = rep(sep, p - 1), append = append)
    cat(eol, file = file, append = TRUE)
    append <- TRUE
  }

  for (i in quote)
    x[, i] <- paste("\"", x[, i], "\"", sep = "")

  cat(t(x), file = file, sep = c(rep(sep, ncol(x) - 1), eol),
      append = append)
}

latex <- function(x, file = "", ...)  UseMethod("latex")

latex.default <- 
function(x, file = "", ...) {
  write(x, file = file, sep = " & ", eol = " \\\\\n", ...)
}
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 20:54:59 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 07:54:59 +1200 (NZST)
Subject: R-alpha: generic write()
Message-ID: <199705251954.HAA29904@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:

>  Attached is a first shot at a generic write with my `old' write.table as
>  write.data.frame, suitably modified.  There is also a stupid generic
>  latex function, which is just there because it illustrates that the
>  extra arguments sep and eol are useful.
>
>  In playing with it, I noticed a few `problems'.
>
>  * The documentation for factor() says,
>
> 	If exclude is set to a zero length vector, then any NA values in
> 	x are used for form a new level for the factor.  This means that
> 	there will be no NA values in the result.
>
>  Perhaps I don't really understand this, but
>
>  R> x <- factor(c(1:3, NA), exclude=numeric(0))
>  R> x
>  [1]  1  2  3 NA
>  R> levels(x)
>  [1] "1" "2" "3"

Looks like a bug to me ...

>  * coerce.c has two error messages of the form
>
> 	error("use \"factor\", \"ordered\", \"cut\" or \"code\" to create factors\n");
>
>  but there is no function `code'.

A VERY old (pre- 0.1) error message

>  * cat() is a bit inconsistent:
>
>  R> cat(x, sep = "&")
>  1&2&3&4R> cat(x, sep = "&\n")
>  1&
>  2&
>  3&
>  4
>  R>
>
>  Actually, a final newline is added whenever sep contains a newline.
>  >From src/main/builtin.c:
>
>         nlsep = 0;
>         for (i = 0; i < LENGTH(sepr); i++)
>                 if (strstr(CHAR(STRING(sepr)[i]), "\n")) nlsep = 1;
>
> 	...
>
>         if ((pwidth != INT_MAX) || nlsep)
>                 Rprintf("\n");
>
>  I am not sure this is the right thing to do.
>
>  (In particular, it makes it rather messy to incrementally build data
>  files with `explicit' end-of-line strings (such as "\\") by appending
>  via cat().)
 
I will look at this a bit more (and compare with the AT&T prototype).

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Sun May 25 21:55:10 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Mon, 26 May 1997 08:55:10 +1200 (NZST)
Subject: R-alpha: cat
Message-ID: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>

Kurt,
  here's what S does (I recall going to some effort to duplicate the,
at times, seemingly unusual behaviour of cat)
S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
S : Copyright AT&T.
Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
Working data will be in /users/rdev/rgentlem/.Data 
>  x <- factor(c(1:3, NA), exclude=numeric(0))
> x
[1] 1  2  3  NA
> levels(x)
[1] "1"  "2"  "3"  "NA"
> cat(x, sep = "&")
1&2&3&4> cat(x, sep = "&\n")
1&
2&
3&
4
>

so, the behaviour of cat is the same (whether it's correct or not .....)

robert
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:01:12 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:01:12 +1200 (NZST)
Subject: R-alpha: Re:  Re(1i) = 2.4976e-307
In-Reply-To: <9705221445.AA01404@>
References: <9705221441.AA01396@>
 <9705221445.AA01404@>
Message-ID: <199705252201.KAA00938@stat1.stat.auckland.ac.nz>

Martin Maechler writes:
 > It is really not 'Re',
 > but the parser for complex constants which is at fault:
 > 
 > > 1i - complex(imag=1)
 > [1] 2.497599e-307+0i

This is an error in the function mkComplex.  It sets the imaginary
part, but leaves the real part uninitialized.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:05:43 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:05:43 +1200 (NZST)
Subject: R-alpha: R-beta: regex
In-Reply-To: <Pine.SUN.3.95.970523121557.25867B-100000@data>
References: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
 <Pine.SUN.3.95.970523121557.25867B-100000@data>
Message-ID: <199705252205.KAA01001@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > On 22 May 1997, Peter Dalgaard BSA wrote:
 > 
 > > > > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
 > > > character(0)
 > 
 > > I strongly suspect that no number of \s will make it work as long as
 > > do_grep() in main/character.c contains this line:
 > > 
 > >         eflags = REG_NOSUB; 
 > 
 > Is this a feature? If so, can it at least be made optional?

I have changed it to:

	eflags = 0;

Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:09:47 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:09:47 +1200 (NZST)
Subject: R-alpha: var() and missing
In-Reply-To: <Pine.SUN.3.95.970523160648.27149A-100000@data>
References: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
 <Pine.SUN.3.95.970523160648.27149A-100000@data>
Message-ID: <199705252209.KAA01030@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > 
 > 
 > var() handles missing values in a very strange way. It is not what the
 > documentation says
 > > var(c(NA,1:10))
 > [1] 0
 > > var(1:10)
 > [1] 9.166667
 > This is because sum() handles NA incorrectly
 > > sum(NA)
 > [1] 0
 > > sum(NA,na.rm=T)
 > [1] 0
 > > sum(NA,na.rm=F)
 > [1] 0
 > 
 > Also the documentation gives a pairwise= option to var() which isn't in
 > the function.

I did want to move toward an implementation which is more like
"na.action", rather than "na.rm".  Often computations based on
correlations based on all observations which are complete for pairs of
variables do make sense.

"var" seems to have been skipped.  What is the right strategy here?
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 08:02:10 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 09:02:10 +0200
Subject: R-alpha: 1:n is not integer
Message-ID: <9705270702.AA02619@>


This is from Snews of yesterday 

Snews> but the : operator creates integers as in
Snews> 
Snews> > is.integer(1:10)
Snews> [1] T
Snews> 
Snews> and even in
Snews> 
Snews> > is.integer(1:1)
Snews> [1] T

which reminds me of bug report  I had sent a while ago,
I think in pre-alpha times:

 MM>  In R,  1:n is   double (aka 'real') and not integer.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 16:29:15 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 17:29:15 +0200
Subject: R-alpha: signif( small , d) gives NA
Message-ID: <9705271529.AA02767@>

signif(.) is a <primitive> function.

Unfortunately, I couldn't even find WHERE in the source,
  signif(.) is defined.

Here are the symptoms:

xmin <- .Machine $ double.xmin
signif(xmin,3) #--> NA

umach <- unlist(.Machine)[paste("double.x", c("min","max"), sep='')]
for(dig in 1:10) {cat("dig=",dig,": "); print(signif(umach, digits = dig))}


-------
Why do I "complain"?  
	-- it breaks  str(.Machine), now that I've improved 'str'.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 27 16:56:30 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 27 May 1997 17:56:30 +0200
Subject: R-alpha: signif( small , d) gives NA
In-Reply-To: Martin Maechler's message of Tue, 27 May 97 17:29:15 +0200
References: <9705271529.AA02767@>
Message-ID: <x2bu5wyklt.fsf@bush.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> 
> signif(.) is a <primitive> function.
> 
> Unfortunately, I couldn't even find WHERE in the source,
>   signif(.) is defined.
>

In src/math/prec.c

> Here are the symptoms:
> 
> xmin <- .Machine $ double.xmin
> signif(xmin,3) #--> NA

Here is the disease:

> xmin
[1] 2.225074e-308
> xmin * 1e310
[1] NA

- and the cure:

> xmin * 1e300 * 1e10
[1] 222.5074

I'll leave it to you (or Ross) to find a clean and general way of
fixing the source...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 17:20:44 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 18:20:44 +0200
Subject: R-alpha: patch for formatC(..char.vector..)
Message-ID: <9705271620.AA02863@>

Apply this patch in  
	src/library/base/funs/


--- 049orig/format~	Thu Mar  6 16:59:56 1997
+++ format	Tue May 27 18:11:27 1997
@@ -22,8 +22,11 @@
 			width <- -width
 		}
 		pad <- sapply(pmax(0, width - nc), bl.string)
-		## for R <= 0.16 (incompatibility to S):
-		if(is.list(pad)) pad <- ""
+		## for R <= 0.49 (incompatibility to S), pad may be list:
+		if(is.list(pad)) {
+			pad[sapply(pad,length) == 0] <- list("")
+			pad <- unlist(pad)
+		}
 		if (flag == "-") 
 			return(paste(x, pad, sep = ""))
 		else    return(paste(pad, x, sep = ""))

AFTER applying the patch,

	tst.ch <- c("a", "ABC", "XYZ", "dd")
	cbind(formatC(tst.ch, wid = 3))

works okay.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 28 12:35:41 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 28 May 1997 13:35:41 +0200
Subject: R-alpha: cat
In-Reply-To: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>
References: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>
Message-ID: <199705281135.NAA18116@aragorn.ci.tuwien.ac.at>

>>>>> Robert Gentleman writes:

> Kurt,
>   here's what S does (I recall going to some effort to duplicate the,
> at times, seemingly unusual behaviour of cat)
> S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
> S : Copyright AT&T.
> Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
> Working data will be in /users/rdev/rgentlem/.Data 
>> x <- factor(c(1:3, NA), exclude=numeric(0))
>> x
> [1] 1  2  3  NA
>> levels(x)
> [1] "1"  "2"  "3"  "NA"
>> cat(x, sep = "&")
> 1&2&3&4> cat(x, sep = "&\n")
> 1&
> 2&
> 3&
> 4
>> 

> so, the behaviour of cat is the same (whether it's correct or not
> .....)

Yes, I noticed that too.  Perhaps R could add an argument which toggles
this behavior?  (Or is there an easy other way to get what I want?)

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 29 05:01:37 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 29 May 1997 16:01:37 +1200 (NZST)
Subject: R-alpha: 1:n is not integer
In-Reply-To: <9705270702.AA02619@>
References: <9705270702.AA02619@>
Message-ID: <199705290401.QAA15396@stat1.stat.auckland.ac.nz>

Martin Maechler writes:
 > 
 > This is from Snews of yesterday 
 > 
 > Snews> but the : operator creates integers as in
 > Snews> 
 > Snews> > is.integer(1:10)
 > Snews> [1] T
 > Snews> 
 > Snews> and even in
 > Snews> 
 > Snews> > is.integer(1:1)
 > Snews> [1] T
 > 
 > which reminds me of bug report  I had sent a while ago,
 > I think in pre-alpha times:
 > 
 >  MM>  In R,  1:n is   double (aka 'real') and not integer.

Is this a bug or feature.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 29 05:04:34 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 29 May 1997 16:04:34 +1200 (NZST)
Subject: R-alpha: 1:n is not integer
In-Reply-To: <199705290401.QAA15396@stat1.stat.auckland.ac.nz>
References: <9705270702.AA02619@>
 <199705290401.QAA15396@stat1.stat.auckland.ac.nz>
Message-ID: <199705290404.QAA15463@stat1.stat.auckland.ac.nz>

Ross Ihaka writes:
 > Is this a bug or feature.

Gaak!  Hit the wrong button.  Its on the list for changing.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May 30 17:24:15 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 30 May 97 18:24:15 +0200
Subject: R-alpha: bug report  and patch  for   rep(.)
Message-ID: <9705301624.AA03924@>


rep(1,0) gives	'Error: subscript out of bounds'

Here is the new  ../src/library/base/funs/rep	
		    -------------------------
(which contains two patches, the first of which I posted on May 20):

rep <- function(x, times, length.out)
{
	if (length(x) == 0)
		return(x)
	if (missing(times))
		times <- ceiling(length.out/length(x))
	r <- .Internal(rep(x,times))
	if(!is.null(nm <- names(x))) names(r) <- .Internal(rep(nm, times))
	if (!missing(length.out))
		return(r[if(length.out>0) 1:length.out else integer(0)])
	return(r)
}

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May  1 16:47:36 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 1 May 97 17:47:36 +0200
Subject: R-alpha: ==NULL
In-Reply-To: <Pine.SUN.3.95.970430093849.302A-100000@zen> (message from Thomas
 Lumley on Wed, 30 Apr 1997 09:42:52 -0700 (PDT))
Message-ID: <9705011547.AA01745@>

>>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    Tom> Any comparison with NULL generates an error Error: comparison is
    Tom> possible only for vector types whereas in S(-PLUS) it gives NA,
    Tom> which seems more sensible.

    Tom> Along similar lines, comparison with a length 0 vector returns
    Tom> logical(0) in R but NA in S.

Is n't  logical(0)  more  logical than  NA ?

I agree that it would be best  (convenience)
if   'NULL==1' returned the same as 'numeric(0)==1'.

At the moment, I don't see why compatibility with S  should be important
here:
		if( NULL == anything)  
or, e.g.,	if( numeric(0) == numeric(0) )

give an error anyway, i.e., you have to test for length 0 _anyway_
in the cases where one comparison argument may have zero length.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May  1 17:28:48 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 1 May 1997 09:28:48 -0700 (PDT)
Subject: R-alpha: ==NULL
In-Reply-To: <9705011547.AA01745@>
Message-ID: <Pine.SUN.3.95.970501092039.11571A-100000@avon>

On Thu, 1 May 1997, Martin Maechler wrote:

> >>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:
	^^^^^ Aaargh! Not "Tom", please.
> 
>     Tom> Any comparison with NULL generates an error Error: comparison is
>     Tom> possible only for vector types whereas in S(-PLUS) it gives NA,
>     Tom> which seems more sensible.
> 
>     Tom> Along similar lines, comparison with a length 0 vector returns
>     Tom> logical(0) in R but NA in S.
> 
> Is n't  logical(0)  more  logical than  NA ?

I didn't (previously) make any comment on this -- I only said that NA was
more logical than an error message.  However, the advantage of returning
NA is that NA | TRUE is TRUE, NA & FALSE is FALSE, which doesn't happen
with logical(0). Also, from a compatibility point of view one of them is
tested with is.na(), the other with length(), so it can matter which one
you use.  Of course no-one should deliberately write code where it
matters, but these things happen. 

It seems in fact that logical(0) | TRUE causes R to freeze (R0.49,
sparc solaris).


Thomas Lumley
------------------------------------------------------+-----
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May  1 21:28:56 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 01 May 1997 22:28:56 +0200
Subject: R-alpha: eigen()
Message-ID: <x2lo5zgcmv.fsf@bush.kubism.ku.dk>


eigen() seems to work for symmetric matrices only. This is out of sync
with the help file.

> trpr.37
           0         1         2         3         4
0 1.00000000 0.0000000 0.0000000 0.0000000 0.0000000
1 0.44444444 0.5555556 0.0000000 0.0000000 0.0000000
2 0.02439024 0.2439024 0.7317073 0.0000000 0.0000000
3 0.00000000 0.0000000 0.2307692 0.7692308 0.0000000
4 0.00000000 0.0000000 0.0000000 0.3636364 0.6363636
> eigen(trpr.37)
$values
[1] 0.1760338 0.3173947 0.7351695 1.1361504 1.3281087

$vectors
           [,1]        [,2]       [,3]       [,4]      [,5]
[1,] -0.3707705 -0.27063913 -0.3559571  0.3273765 0.7452536
[2,]  0.7110188  0.41060304  0.1696518  0.1176558 0.5321961
[3,] -0.4307468  0.09222746  0.7735674 -0.3164802 0.3276966
[4,]  0.3249070 -0.57094755 -0.1300796 -0.7136115 0.2056509
[5,] -0.2566594  0.65090138 -0.4787334 -0.5192116 0.1081065

--Huh? 0,0,0,0,1 should be an eigenvector with e.v. 0.6363636.

> eigen(t(trpr.37))
$values
[1] 0.5555556 0.6363636 0.7317073 0.7692308 1.0000000

$vectors
     [,1] [,2] [,3] [,4] [,5]
[1,]    0    0    0    0    1
[2,]    1    0    0    0    0
[3,]    0    0    1    0    0
[4,]    0    0    0    1    0
[5,]    0    1    0    0    0

-- Doesn't look right, check:

> t(trpr.37)%*%eigen(t(trpr.37))$vectors
       [,1]      [,2]       [,3]      [,4] [,5]
0 0.4444444 0.0000000 0.02439024 0.0000000    1
1 0.5555556 0.0000000 0.24390244 0.0000000    0
2 0.0000000 0.0000000 0.73170732 0.2307692    0
3 0.0000000 0.3636364 0.00000000 0.7692308    0
4 0.0000000 0.6363636 0.00000000 0.0000000    0

-- which is obviously not proportional to the "eigenvectors". What
happens is that the matrices get symmetrified by duplicating the lower
triangle onto the upper one.

BTW. Who was it who talked about matrix exponentials a while back? I
could use such code now...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Fri May  2 05:34:19 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Fri, 2 May 1997 16:34:19 +1200 (NZST)
Subject: R-alpha: ==NULL
Message-ID: <199705020434.QAA00772@stat3.stat.auckland.ac.nz>

Well, we thought
  logical(0) & T should return logical(0)
  logical(0) | T should return logical(0)

  already we have NA | T returns T
             and  NA & T returns NA


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May  2 10:28:11 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 2 May 97 11:28:11 +0200
Subject: R-alpha: ==NULL
In-Reply-To: <Pine.SUN.3.95.970501092039.11571A-100000@avon> (message from
 Thomas Lumley on Thu, 1 May 1997 09:28:48 -0700 (PDT))
Message-ID: <9705020928.AA02005@>

>>>>> "ThLu" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    ThLu> On Thu, 1 May 1997, Martin Maechler wrote:
    >> >>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:
    ThLu>    ^^^^^ Aaargh! Not "Tom", please.

Excuse me!

    >> ....

    >>  Is n't logical(0) more logical than NA ?

    ThLu> I didn't (previously) make any comment on this -- I only said
    ThLu> that NA was more logical than an error message.  However, the
    ThLu> advantage of returning NA is that NA | TRUE is TRUE, NA & FALSE
    ThLu> is FALSE, which doesn't happen with logical(0). Also, from a
    ThLu> compatibility point of view one of them is tested with is.na(),
    ThLu> the other with length(), so it can matter which one you use.  Of
    ThLu> course no-one should deliberately write code where it matters,
    ThLu> but these things happen.

Ok, given the above argument, returning NA is logical, too.
However, I'd also argue that  
	logical(0) | TRUE	-> TRUE
	logical(0) & FALSE      -> FALSE

	logical(0) & TRUE	-> logical(0)
	logical(0) | FALSE      -> logical(0)

    ThLu> It seems in fact that logical(0) | TRUE causes R to freeze
    ThLu> (R0.49, sparc solaris).

Yes:

> logical(0) | TRUE
Warning in logical(0) | TRUE : longer object length
        is not a multiple of shorter object length
Floating exception
~~~~~~~~~~~~~~~~~~ [and 'core' dump]
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From nobu@psrc.isac.co.jp  Sun May  4 09:27:10 1997
From: nobu@psrc.isac.co.jp (Nobuhiro Yasutomi)
Date: Sun, 04 May 1997 17:27:10 +0900
Subject: R-alpha: abline not recognized coef member of list
Message-ID: <9705040827.AA06356@derrida.psrc.isac.co.jp>

Hello, R developers.

  I found a little different behavior of R with S.

  at R-0.49:
    > a
    [1] 12 23 22 34 44 54 55 70 78
    > plot(a)
    > abline(lsfit(seq(1,len=length(a)), a))
    Error: no applicable method for "coefficients"

  at S (from AT&T '92) result draw coefficient line without error.
Then I think to need define a function as followed:

    coefficients.default <- function(x) x$coef

---
Nobuhiro Yasutomi, ISAC, Inc.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May  7 13:28:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 7 May 97 14:28:16 +0200
Subject: R-alpha: contr.helmert: bug (??) don't have the SAME problem
In-Reply-To: <x27mhbmrbw.fsf@bush.kubism.ku.dk> (message from Peter Dalgaard
 BSA on 07 May 1997 13:53:07 +0200)
Message-ID: <9705071228.AA01474@>

[I diverged to  R-devel]

Peter, I cannot reproduce your bug
I can type

	solve(cbind(c(1,1,1,1),contr.helmert(4)))

many times, and never get an error.
Also,

 for(n in 2:7) { 
  A <- cbind(rep(1,n), contr.helmert(n)); print(A); print(solve(A),digits=4)}

is just fine.

But then I do

> version
$platform
[1] "sparc-sun-solaris2.5"

$arch
[1] "sparc"

$os
[1] "solaris2.5"

$system
[1] "sparc, solaris2.5"

$status
[1] "Beta"

$status.rev
[1] "0"

$major
[1] "0"

$minor
[1] "49"

$year
[1] "1997"

$language
[1] "R"


Process R segmentation violation at Wed May  7 14:22:57 1997
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

And this seems reproducible now.
Also under SunOS4 gcc (above was Solaris, Sun's cc).

Martin
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Wed May  7 15:10:03 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 07 May 1997 16:10:03 +0200
Subject: R-alpha: Re: contr.helmert: bug (??) don't have the SAME problem
In-Reply-To: Martin Maechler's message of Wed, 7 May 97 14:28:16 +0200
References: <9705071228.AA01474@>
Message-ID: <x24tcfmkzo.fsf@bush.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> 
> [I diverged to  R-devel]
> 
> Peter, I cannot reproduce your bug
> I can type
> 
> 	solve(cbind(c(1,1,1,1),contr.helmert(4)))
> 
> many times, and never get an error.
...
> Process R segmentation violation at Wed May  7 14:22:57 1997
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Also, it seems to behave differently in different circumstances. When
I reported it, I had started R from a read-only directory. In my home
directory, I get this:

> A<-contr.helmert(4)
> X<-cbind(c(1,1,1,1),A)
Error: Unimplemented feature in duplicate
> ls()
Error: Unimplemented feature in duplicate
> > ls
Error: Unimplemented feature in deparse2buff

Can you say "random memory overwrite"?

<imagine long and arduous gdb session here>

In main/bind.c:753, I see
STRING(CADR(dn))[j++] = blank;

Later on, during garbage collection, the same memory location gets
marked, setting a bit in the pointer, which gets accessed a split
second later, and... kerunch! 

I suspect that should have said ...=duplicate(blank)  , right? Or is
it the marking process in gcc. Hmm... not sure I got it straight
there, but somehow the "blank" value, which is a SEXP (aka *SEXPREC)
is getting treated as a SEXPREC.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May  7 16:00:24 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 7 May 1997 08:00:24 -0700 (PDT)
Subject: R-alpha: Re: contr.helmert bug
In-Reply-To: <x24tcfmkzo.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970507075642.2722B-100000@zen>


I have a probably related problem. Sporadically, an attempt to do

a[,1,1,drop=F]

or similar subsetting on a 3-d matrix causes a segfault at line 83 of
attrib.c.  In a previous version this happened reliably when dimensions
were lost from multi-d arrays and was due to incorrect handling of the
dimnames attributes which crashed attrib.c at that point when the dimnames
were accessed.

Is the same sort of thing happening again?


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Wed May  7 16:25:49 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 07 May 1997 17:25:49 +0200
Subject: R-alpha: cbind/memory-bug, (was Re: contr.helmert bug)
In-Reply-To: Thomas Lumley's message of Wed, 7 May 1997 08:00:24 -0700 (PDT)
References: <Pine.SUN.3.95.970507075642.2722B-100000@zen>
Message-ID: <x2207jmhhe.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> I have a probably related problem. Sporadically, an attempt to do
> 
> a[,1,1,drop=F]
> 
> or similar subsetting on a 3-d matrix causes a segfault at line 83 of
> attrib.c.  In a previous version this happened reliably when dimensions
> were lost from multi-d arrays and was due to incorrect handling of the
> dimnames attributes which crashed attrib.c at that point when the dimnames
> were accessed.
> 
> Is the same sort of thing happening again?

Not at all unlikely. As far as I can see, this doesn't really have
anything to do with contr.helmert, but with cbind, dimnames, and
garbage collection. Contr.helmert only comes in due to the fact that
it provokes a garbage collection at a critical time. Your examples
don't involve the garbage collector, but it might still tickle the
same bug...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 05:32:48 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 8 May 1997 16:32:48 +1200 (NZST)
Subject: R-alpha: Equations in Plots
Message-ID: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>

Paul Murrell and I are making some progress with making mathematical
expressions available in graphs.  The idea is to use R expressions to
represent the mathematical expressions.  So far we have (or will soon
have):

	R		LaTeX

	x^i		x^i
	x[i]		x_i
	alpha		\alpha
	Alpha		\Alpha
	hat(x)		\hat{x}	\widehat{x}
	bar(x)		\bar{x} \overline{x}
	x+y		x+y
	x-y		x-y
	x/y		x/y
	(x)		(x)
	{x}		{x}
	frac(x,y)	\frac{x}{y}
	cdots		\cdots
	ldots		\ldots
	
We are wondering how far to go with this process.  Does the above
cover what people want, or are there important omitted features
(we don't really want to do all of TeX).

We are prototyping this in lisp and it will be a little while before
it finds its way onto R.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 05:34:27 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 8 May 1997 16:34:27 +1200 (NZST)
Subject: R-alpha: Memory errors and cbind
Message-ID: <199705080434.QAA12659@stat1.stat.auckland.ac.nz>

Robert and I think we have a fix for the memory errors which are
happening with cbind.  I am getting a largish patch ready for this and
a range of other problems.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May  8 16:52:48 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 8 May 1997 08:52:48 -0700 (PDT)
Subject: R-alpha: Equations in Plots
In-Reply-To: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970508085100.3538A-100000@zen>

On Thu, 8 May 1997, Ross Ihaka wrote:

> Paul Murrell and I are making some progress with making mathematical
> expressions available in graphs.  The idea is to use R expressions to
> represent the mathematical expressions.  So far we have (or will soon
> have):
<things> 	
> We are wondering how far to go with this process.  Does the above
> cover what people want, or are there important omitted features
> (we don't really want to do all of TeX).
> 
I would really like to have the whole Greek alphabet or at least rho, mu
sigma and chi.


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Thu May  8 17:52:28 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Thu, 8 May 1997 11:52:28 -0500 (CDT)
Subject: R-alpha: machine-independent .Rdata
Message-ID: <9705081652.AA11157@nokomis.stat.umn.edu>

If a move toward machine-independent representation seems reasonable,
it may be worth looking at some of the binary data exchange formats
used by nasa and others,

	CDF http://nssdc.gsfc.nasa.gov/cdf/cdf_home.html
	netCDF http://www.unidata.ucar.edu/packages/netcdf/index.html
	HDF http://hdf.ncsa.uiuc.edu/

There may also be something useful in the "Scientific Data Format
Information FAQ"
(http://www.cv.nrao.edu/fits/traffic/scidataformats/faq.html).

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 22:49:39 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 May 1997 09:49:39 +1200 (NZST)
Subject: R-alpha: Equations in Plots
In-Reply-To: <Pine.SUN.3.95.970508085100.3538A-100000@zen>
References: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>
 <Pine.SUN.3.95.970508085100.3538A-100000@zen>
Message-ID: <199705082149.JAA16280@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > I would really like to have the whole Greek alphabet or at least rho, mu
 > sigma and chi.

I don't see a smiley so I'll bite ...  When I said "alpha" I meant by
implication the entire greek alphabet (upper and lower case).  I was
really asking if it would be a problem that we don't have big
"operators" like \sum, \prod, \lim, \int etc.  Expressions this
complex are probably better banished to a caption.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 22:56:04 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 May 1997 09:56:04 +1200 (NZST)
Subject: R-alpha: machine-independent .Rdata
In-Reply-To: <9705081652.AA11157@nokomis.stat.umn.edu>
References: <9705081652.AA11157@nokomis.stat.umn.edu>
Message-ID: <199705082156.JAA16354@stat1.stat.auckland.ac.nz>

Luke Tierney writes:
 > If a move toward machine-independent representation seems reasonable,
 > it may be worth looking at some of the binary data exchange formats
 > used by nasa and others,
 > 
 > 	CDF http://nssdc.gsfc.nasa.gov/cdf/cdf_home.html
 > 	netCDF http://www.unidata.ucar.edu/packages/netcdf/index.html
 > 	HDF http://hdf.ncsa.uiuc.edu/
 > 
 > There may also be something useful in the "Scientific Data Format
 > Information FAQ"
 > (http://www.cv.nrao.edu/fits/traffic/scidataformats/faq.html).

I've certainly given this and xdr the odd microsecond of thought.  A
platform independent data format would be very nice.  If someone would
like to look at this - or assign it as homework to a student (mine's
doing equations in plots :-) it would be very useful.  You don't have
to plug it into R, just find out what's invoved.

I'm about to be faced with a third year data analysis course with 100+
students so it won't be me ...
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May  9 14:38:33 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 9 May 97 15:38:33 +0200
Subject: R-alpha: R-0.49 / S-plus: "default argument evaluation" bugs and woes
Message-ID: <9705091338.AA02212@>


There is a problem with  'default argument evaluation'
when I use an existing function name as argument name :

sintest <- function(x, y = 2, sin= sin(pi/4))
{
  ## Purpose: Test of   "default argument evaluation"
  ## -------- Fails for  R-0.49.  Martin Maechler, Date:  9 May 97.
  c(x=x, y=y, sin=sin)
}

## R-0.49:
R> sintest(1)
##> Error in sintest(1) : recursive default argument reference

## S-plus 3.4  (being 100% ok):
S> sintest(1)
  x y       sin 
  1 2 0.7071068
 Warning messages:
   looking for function "sin", ignored local non-function in: sintest(1)

-------------------------------------------------------
The following shows bugs, both in R and S:

sintest2 <- function(x ,y = 2)
{
  ## Purpose: Test of   "default argument evaluation"
  ## -------- Fails for  S-plus 3.4.  Martin Maechler, Date:  9 May 97.
  c(x=x, y=y, sin=sin)
}

R> sintest2(1)
[[1]]
[1] 1

[[2]]
[1] 2

[[3]]
<primitive: sin>

--------------- is almost okay, 
		the buglet being that the names have been dropped from the list.

But watch this:
S> sintest2(1)
function(x = 1, y = 2, sin.x)
sin2 = .Internal(sin(x), "do_math", T, 109)

--- returning a function 

	((now we see, why S's way of treating functions as
	  lists sometimes badly sucks)).
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Fri May  9 15:52:13 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Fri, 9 May 1997 09:52:13 -0500 (CDT)
Subject: R-alpha: R-0.49 / S-plus: "default argument evaluation" bugs and woes
In-Reply-To: <9705091338.AA02212@> from "Martin Maechler" at May 9, 97 03:38:33 pm
Message-ID: <9705091452.AA24334@nokomis.stat.umn.edu>

Martin Maechler wrote:
> 
> 
> There is a problem with  'default argument evaluation'
> when I use an existing function name as argument name :
> 
> sintest <- function(x, y = 2, sin= sin(pi/4))
> {
>   ## Purpose: Test of   "default argument evaluation"
>   ## -------- Fails for  R-0.49.  Martin Maechler, Date:  9 May 97.
>   c(x=x, y=y, sin=sin)
> }
> 
> ## R-0.49:
> R> sintest(1)
> ##> Error in sintest(1) : recursive default argument reference
> 
> ## S-plus 3.4  (being 100% ok):
> S> sintest(1)
>   x y       sin 
>   1 2 0.7071068
>  Warning messages:
>    looking for function "sin", ignored local non-function in: sintest(1)
> 
> -------------------------------------------------------
> The following shows bugs, both in R and S:
> 
> sintest2 <- function(x ,y = 2)
> {
>   ## Purpose: Test of   "default argument evaluation"
>   ## -------- Fails for  S-plus 3.4.  Martin Maechler, Date:  9 May 97.
>   c(x=x, y=y, sin=sin)
> }
> 
> R> sintest2(1)
> [[1]]
> [1] 1
> 
> [[2]]
> [1] 2
> 
> [[3]]
> <primitive: sin>
> 

For better or worse, S and R allow default expressions to contain
references variables that are (or rather may be) created in the
function body, so (in R and Splus)

> x<-1
> f<-function(a,b=x) { if (a) x<-2; b}
> f()
Error: Argument "a" is missing, with no default
> f(T)
[1] 2
> f(F)
[1] 1

More traditional lexical scoping would make the reference to x in the
default always be global, but lots of code would break. I think we're
stuck with this behavior as a corollary to the way S wants default
arguments to work.

Actually S is a bit inconsistent in its error message -- if you have a
non-function argument it gives the same message as R,

> g<-function(x=x) x
>g()
Error in g(): Recursive occurrence of default argument "x"
Dumped

Also in R's lexical scoping you probably do want the argument name to
shadow any outer definitions if you want to be able to define default
arguments that are recursive functions, e.g.

> g<-function(n, nfac=function(x) { if (x <= 1) 1 else nfac(x-1)*x }) nfac(n);
> g(6)
[1] 720

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Fri May  9 23:34:26 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Fri, 9 May 1997 23:34:26 +0100 (BST)
Subject: R-alpha: plot, axis & log
Message-ID: <Pine.LNX.3.95.970509230406.4111A-100000@figaro.stats.bris.ac.uk>

The following commands crash:

> plot(1:4,axes=F,log="x")
> axis(1,c(1,2,3,4))
zsh: segmentation fault  R

Lines 35-37 of axis():

35:        else {
36:                ind <- (usr[1] <= at & at <= usr[2])
37:        }

should be replaced by

        else {
                if (log)
                        ind <- (10^usr[1] <= at & at <= 10^usr[2])
                else ind <- (usr[1] <= at & at <= usr[2])
        }

Moreover, there should be a check if length(at) equals zero before calling
the internal axis command.

But wait, there's more:

> plot(1:4,log="x")
> plot(1:4)

The second call of plot produces an empty plot. The following sequence
works:

> plot(1:4,log="x")
> par(xlog=F)
> plot(1:4)        

Why does R have the graphical parameters "xlog" and "ylog"? They do not
seem to work for me and are not used by S-Plus.

Arne 

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Sat May 10 18:41:46 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Sat, 10 May 1997 17:41:46 +0000 (GMT)
Subject: R-alpha: Another error in axis
Message-ID: <Pine.LNX.3.95.970510173453.3432B-100000@figaro.stats.bris.ac.uk>

The commands

> plot(1:4,axes=F)
> axis(1,c(4,3,2,1))

produce the tick-marks but not the labels (except the last one). Sorting
the vector at in axis() seems to work, ie should lines 35-40 should read:

        else {
                at <- sort(at)
                if (log)
                        ind <- (10^usr[1] <= at & at <= 10^usr[2])
                else ind <- (usr[1] <= at & at <= usr[2])
        }


Arne

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Sat May 10 22:33:15 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Sat, 10 May 1997 14:33:15 -0700 (PDT)
Subject: R-alpha: r-beta: lm.influence
In-Reply-To: <9705091338.AA02212@>
Message-ID: <Pine.SOL.3.95.970510141405.1061A-100000@gorn>


lm.influence() doesn't work correctly on weighted models (and thus on glm
objects).


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Sun May 11 21:08:32 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Sun, 11 May 1997 20:08:32 +0000 (GMT)
Subject: R-alpha: Logarithmic scales
Message-ID: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>

Here are another three problems with logarithmic scales:

1) segments() does not work with logarithmic scales. I suggest to change
lines 962-973 in "plot.c":

    for (i = 0; i < n; i++) {
        if (FINITE(xt(x0[i%nx0])) && FINITE(yt(y0[i%ny0]))
            && FINITE(xt(x1[i%nx1])) && FINITE(yt(y1[i%ny1]))) {
            GP->col = INTEGER(col)[i % ncol];
            if(GP->col == NA_INTEGER) GP->col = colsave;
            GP->lty = INTEGER(lty)[i % nlty];
            GStartPath();
            GMoveTo(XMAP(xt(x0[i % nx0])), YMAP(yt(y0[i % ny0])));
            GLineTo(XMAP(xt(x1[i % nx1])), YMAP(yt(y1[i % ny1])));
            GEndPath();
        }
    }

2) rect() does not work either. Unfortunately, do_rect() in "plot.c" 
overrides the yt() function... What about this (lines 983-1031):

SEXP do_rect(SEXP call, SEXP op, SEXP args, SEXP env)
{
    SEXP sxl, sxr, syb, sys, col, lty, border;
    double *xl, *xr, *yb, *ys;
    int i, n, nxl, nxr, nyb, nys;
    int ncol, nlty, nborder;
    int colsave, ltysave;

    GCheckState();

    if(length(args) < 4) errorcall(call, "too few arguments\n");
    xypoints(call, args, &n);

    sxl = CAR(args); nxl = length(sxl); args = CDR(args);
    syb = CAR(args); nyb = length(syb); args = CDR(args);
    sxr = CAR(args); nxr = length(sxr); args = CDR(args);
    sys = CAR(args); nys = length(sys); args = CDR(args);

    PROTECT(col = FixupCol(GetPar("col", args)));
    ncol = LENGTH(col);

    PROTECT(border =  FixupCol(GetPar("border", args)));
    nborder = LENGTH(border);

    PROTECT(lty = FixupLty(GetPar("lty", args)));
    nlty = length(lty);

    xl = REAL(sxl);
    xr = REAL(sxr);
    yb = REAL(syb);
    ys = REAL(sys);

    ltysave = GP->lty;
    colsave = GP->col;
    GMode(1);
    for (i = 0; i < n; i++) {
        if (FINITE(xt(xl[i%nxl])) && FINITE(yt(yb[i%nyb]))
            && FINITE(xt(xr[i%nxr])) && FINITE(yt(ys[i%nys])))
                GRect(XMAP(xt(xl[i % nxl])), YMAP(yt(yb[i % nyb])),
                      XMAP(xt(xr[i % nxr])), YMAP(yt(ys[i % nys])),
                    INTEGER(col)[i % ncol],
                    INTEGER(border)[i % nborder]);
    }
    GMode(0);
    GP->col = colsave;
    GP->lty = ltysave;
    UNPROTECT(3);
    return R_NilValue;
}

3) The legend() function needs changes as well. I attach my
quick hack below, but I think there are better solutions... :-)

legend <-
function (x, y, legend, fill, col = "black", lty, pch, bty = "o", 
        bg = par("bg"), xjust = 0, yjust = 1, ...) 
{
        xlog <- par("xlog")
        ylog <- par("ylog")
        if (xlog) 
                x <- log10(x)
        if (ylog) 
                y <- log10(y)
        xchar <- xinch(par("cin")[1])
        ychar <- yinch(par("cin")[2]) * 1.2
        xbox <- xinch(par("cin")[2] * 0.8)
        ybox <- yinch(par("cin")[2] * 0.8)
        yline <- 2 * xchar
        w <- 2 * xchar + max(strwidth(legend))
        h <- (length(legend) + 1) * ychar
        if (missing(y)) {
                if (is.list(x)) {
                        y <- x$y
                        x <- x$x
                }
        }
        if (!is.numeric(x) || !is.numeric(y)) 
                stop("non-numeric coordinates")
        if (length(x) <= 0 || length(x) != length(y)) 
                stop("differing coordinate lengths")
        if (length(x) != 1) {
                x <- mean(x)
                y <- mean(y)
                xjust <- 0.5
                yjust <- 0.5
        }
        if (!missing(fill)) {
                w <- w + xchar + xbox
        }
        if (!missing(pch)) {
                if (is.character(pch) && nchar(pch) > 1) {
                        np <- nchar(pch)
                        pch <- substr(rep(pch[1], np), 1:np, 
                                1:np)
                }
                w <- w + 1.5 * xchar
        }
        if (!missing(lty)) 
                w <- w + 3 * xchar
        x <- x - xjust * w
        y <- y + (1 - yjust) * h
        xt <- rep(x, length(legend)) + xchar
        yt <- y - (1:length(legend)) * ychar
        if (bty != "n") {
                if (xlog) {
                        x1 <- 10^x
                        x2 <- 10^(x + w)
                }
                else {
                        x1 <- x
                        x2 <- x + w
                }
                if (ylog) {
                        y1 <- 10^y
                        y2 <- 10^(y - h)
                }
                else {
                        y1 <- y
                        y2 <- y - h
                }
                rect(x1, y1, x2, y2, col = bg)
        }
        x <- x + xchar
        if (!missing(fill)) {
                if (xlog) {
                        x1 <- 10^xt
                        x2 <- 10^(xt + xbox)
                }
                else {
                        x1 <- xt
                        x2 <- xt + xbox
                }
                if (ylog) {
                        y1 <- 10^(yt - 0.5 * ybox)
                        y2 <- 10^(yt + 0.5 * ybox)
                }
                else {
                        y1 <- yt - 0.5 * ybox
                        y2 <- yt + 0.5 * ybox
                }
                rect(xt, yt - 0.5 * ybox, xt + xbox, yt + 0.5 * 
                        ybox, col = fill)
                xt <- xt + xbox + xchar
        }
        if (!missing(pch)) {
                if (xlog) 
                        x1 <- 10^(xt + 0.25 * xchar)
                else x1 <- xt + 0.25 * xchar
                if (ylog) 
                        y1 <- 10^yt
                else y1 <- yt
                points(x1, y1, pch, col = col)
                xt <- xt + 1.5 * xchar
        }
        if (!missing(lty)) {
                if (xlog) {
                        x1 <- 10^xt
                        x2 <- 10^(xt + 2 * xchar)
                }
                else {
                        x1 <- xt
                        x2 <- xt + 2 * xchar
                }
                if (ylog) 
                        y1 <- 10^yt
                else y1 <- yt
                segments(x1, y1, x2, y1, lty = lty, col = col)
                xt <- xt + 3 * xchar
        }
        if (xlog) 
                x1 <- 10^xt
        else x1 <- xt
        if (ylog) 
                y1 <- 10^yt
        else y1 <- yt
        text(x1, y1, text = legend, adj = c(0, 0.35))
}

Arne

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 01:35:25 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 12 May 1997 12:35:25 +1200 (NZST)
Subject: R-alpha: Hypergeometric Distribution
Message-ID: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>

A cut and paste typo has crept in and is rendering all values returned
for the hypergeometric distribution incorrect.  The problem is in
src/main/arithmetic.c in the function "math4".  The lines

        PROTECT(sy = allocVector(REALSXP, n));
        a = REAL(sa);
        b = REAL(sb);
        c = REAL(sc);
        d = REAL(sc);	/* <-- change this line */
        y = REAL(sy);

should read

        PROTECT(sy = allocVector(REALSXP, n));
        a = REAL(sa);
        b = REAL(sb);
        c = REAL(sc);
        d = REAL(sd);	/* corrected */
        y = REAL(sy);

This will be part of the official 2nd patch to 0.49, but I'm pointing it
out anyway.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Mon May 12 07:17:50 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 May 1997 08:17:50 +0200
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
Message-ID: <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> A cut and paste typo has crept in and is rendering all values returned
> for the hypergeometric distribution incorrect.  The problem is in
> src/main/arithmetic.c in the function "math4".  The lines

>         PROTECT(sy = allocVector(REALSXP, n));
>         a = REAL(sa);
>         b = REAL(sb);
>         c = REAL(sc);
>         d = REAL(sc);	/* <-- change this line */
>         y = REAL(sy);

> should read

>         PROTECT(sy = allocVector(REALSXP, n));
>         a = REAL(sa);
>         b = REAL(sb);
>         c = REAL(sc);
>         d = REAL(sd);	/* corrected */
>         y = REAL(sy);

> This will be part of the official 2nd patch to 0.49, but I'm pointing it
> out anyway.

Thanks for the patch.

It fixes the problem reported by myself on 25 Apr 1997 (makes my Fisher
test work again) and by Ennapadam Venkatraman <VENKAT@biosta.mskcc.org>
on 30 Apr 1997.

Note that the problem with `rhyper(5,200,250,60)' never returning still
seems to exist.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 09:03:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 10:03:50 +0200
Subject: R-alpha: Logarithmic scales -- patch to 'legend'
In-Reply-To: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>
 (message from Arne Kovac on Sun, 11 May 1997 20:08:32 +0000 (GMT))
Message-ID: <9705120803.AA00340@>

Arne, thank you for your very useful  bug findings and fixing.
Your first two "patches" to  plot.c  are really ok.

In your

>> 3) The legend() function needs changes as well. I attach my
>> quick hack below, but I think there are better solutions... :-)
>> 
>> legend <-
>> function (x, y, legend, fill, col = "black", lty, pch, bty = "o", 
>>         bg = par("bg"), xjust = 0, yjust = 1, ...) 
>> .....

there was one typo in the  ``if(!missing(fill))''  clause, you assigned
x1,..y2, but then did not use them.

Below I fixed this and found a way to make the whole  if(xlog) / (ylog)
things a little more concise.
This is a patch against "plain 0.49" ,  $RHOME/src/library/base/funs/ :

--- legend.~1~	Fri Jan 17 03:44:24 1997
+++ legend	Mon May 12 09:42:25 1997
@@ -2,13 +2,18 @@
 function(x, y, legend, fill, col="black", lty, pch, bty="o", bg=par("bg"),
 	xjust=0, yjust=1, ...)
 {
+	xlog <- par("xlog")
+	ylog <- par("ylog")
+	if (xlog) x <- log10(x)
+	if (ylog) y <- log10(y)
 	xchar <- xinch(par("cin")[1])
 	ychar <- yinch(par("cin")[2]) * 1.2
 	xbox <- xinch(par("cin")[2] * 0.8)
 	ybox <- yinch(par("cin")[2] * 0.8)
 	yline <- 2*xchar
 	w <- 2 * xchar + max(strwidth(legend))
-	h <- (length(legend)+1)*ychar
+	n.leg <- length(legend)
+	h <- (n.leg + 1) * ychar
 	if(missing(y)) {
 		if(is.list(x)) {
 			y <- x$y
@@ -39,23 +44,43 @@
 		w <- w + 3 * xchar
 	x <- x - xjust * w
 	y <- y + (1 - yjust) * h
-	xt <- rep(x, length(legend)) + xchar
-	yt <- y - (1:length(legend)) * ychar
-	if(bty != "n")
-		rect(x, y, x+w, y-h, col=bg)
+	xt <- rep(x, n.leg) + xchar
+	yt <- y - (1:n.leg) * ychar
+	if (bty != "n") {
+		xx <- c(x,x+w)
+		if (xlog) xx <- 10^xx
+		yy <- c(y,y-h)
+		if (ylog) yy <- 10^yy
+		rect(xx[1], yy[1], xx[2], yy[2], col = bg)
+	}
 	x <- x + xchar
 	if(!missing(fill)) {
-		rect(xt, yt - 0.5 * ybox,
-			xt + xbox, yt + 0.5 * ybox, col=fill)
+		xx <- c(xt,xt+xbox)
+		if (xlog) xx <- 10^xx
+		yy <- yt + c(-.5,.5) * ybox
+		if (ylog) yy <- 10^yy
+		rect(xx[1], yy[1], xx[2], yy[2], col = fill)
 		xt <- xt + xbox + xchar
 	}
 	if(!missing(pch)) {
-		points(xt + 0.25 * xchar, yt, pch, col=col)
+		x1 <- xt + 0.25 * xchar
+		if (xlog) x1 <- 10^x1
+		y1 <- yt
+		if (ylog) y1 <- 10^y1
+		points(x1, y1, pch, col = col)
 		xt <- xt + 1.5 * xchar
 	}
 	if(!missing(lty)) {
-		segments(xt, yt, xt + 2 * xchar, yt, lty=lty, col=col)
+		xx <- c(xt, xt + 2 * xchar)
+		if (xlog) xx <- 10^xx
+		y1 <- yt
+		if (ylog) y1 <- 10^y1
+		segments(xx[1], y1, xx[2], y1, lty = lty, col = col)
 		xt <- xt + 3 * xchar
 	}
-	text(xt, yt, text=legend, adj=c(0, 0.35))
+	x1 <- xt
+	y1 <- yt
+	if (xlog) x1 <- 10^x1
+	if (ylog) y1 <- 10^y1
+	text(x1, y1, text = legend, adj = c(0, 0.35))
 }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 09:39:39 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 10:39:39 +0200
Subject: R-alpha: fixing dhyper.c: another less important typo
In-Reply-To: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>
 (message from Arne Kovac on Sun, 11 May 1997 20:08:32 +0000 (GMT))
Message-ID: <9705120839.AA00361@>

Line 30 should be changed from

	if (NR <= 0 || NR <= 0 || n <= 0 || n > N)
to                      ^-- typo: "R" should be "B"
	if (NR < 0 || NB < 0 || n < 0 || n > N)

(NR==0 or NB == 0  should not be a DOMAIN_ERROR)
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 13:11:38 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 14:11:38 +0200
Subject: R-alpha: oops -- 2nd patch to 'legend'
In-Reply-To: <9705120803.AA00340@> (message from Martin Maechler on Mon, 12
 May 97 10:03:50 +0200)
Message-ID: <9705121211.AA00399@>

This time, I have at least tested it out under quite a few circumstances;
the last patch (a few hours ago) would FAIL in many cases!

--- legend.~1~	Fri Jan 17 03:44:24 1997
+++ legend	Mon May 12 12:07:23 1997
@@ -2,18 +2,23 @@
 function(x, y, legend, fill, col="black", lty, pch, bty="o", bg=par("bg"),
 	xjust=0, yjust=1, ...)
 {
+  xlog <- par("xlog")
+  ylog <- par("ylog")
+  if (xlog) x <- log10(x)
+  if (ylog) y <- log10(y)
 	xchar <- xinch(par("cin")[1])
 	ychar <- yinch(par("cin")[2]) * 1.2
 	xbox <- xinch(par("cin")[2] * 0.8)
 	ybox <- yinch(par("cin")[2] * 0.8)
 	yline <- 2*xchar
 	w <- 2 * xchar + max(strwidth(legend))
-	h <- (length(legend)+1)*ychar
+  n.leg <- length(legend)
+  h <- (n.leg + 1) * ychar
 	if(missing(y)) {
 		if(is.list(x)) {
 			y <- x$y
 			x <- x$x
-		}
+    } else stop("missing y")
 	}
 	if(!is.numeric(x) || !is.numeric(y))
 		stop("non-numeric coordinates")
@@ -39,23 +44,36 @@
 		w <- w + 3 * xchar
 	x <- x - xjust * w
 	y <- y + (1 - yjust) * h
-	xt <- rep(x, length(legend)) + xchar
-	yt <- y - (1:length(legend)) * ychar
+  xt <- rep(x, n.leg) + xchar
+  yt <- y - (1:n.leg) * ychar
 	if(bty != "n")
 		rect(x, y, x+w, y-h, col=bg)
 	x <- x + xchar
 	if(!missing(fill)) {
-		rect(xt, yt - 0.5 * ybox,
-			xt + xbox, yt + 0.5 * ybox, col=fill)
+    xx <- cbind(xt, xt + xbox)
+    if (xlog) xx <- 10^xx
+    yy <- yt + cbind(rep(-0.5,n.leg), 0.5) * ybox
+    if (ylog) yy <- 10^yy
+    rect(xx[,1], yy[,1], xx[,2], yy[,2], col = fill)
 		xt <- xt + xbox + xchar
 	}
 	if(!missing(pch)) {
-		points(xt + 0.25 * xchar, yt, pch, col=col)
+    x1 <- xt + 0.25 * xchar
+    if (xlog) x1 <- 10^x1
+    y1 <- yt
+    if (ylog) y1 <- 10^y1
+    points(x1, y1, pch, col = col)
 		xt <- xt + 1.5 * xchar
 	}
 	if(!missing(lty)) {
-		segments(xt, yt, xt + 2 * xchar, yt, lty=lty, col=col)
+    xx <- cbind(xt, xt + 2 * xchar)
+    if (xlog) xx <- 10^xx
+    y1 <- yt
+    if (ylog) y1 <- 10^y1
+    segments(xx[,1], y1, xx[,2], y1, lty = lty, col = col)
 		xt <- xt + 3 * xchar
 	}
+  if (xlog) xt <- 10^xt
+  if (ylog) yt <- 10^yt
 	text(xt, yt, text=legend, adj=c(0, 0.35))
 }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 14:25:18 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 15:25:18 +0200
Subject: R-alpha: ISO-latin-1 characters in strings -- print.default & PARSE(?) problems
Message-ID: <9705121325.AA00438@>


There seems to be a problem in print.default with some
ISO-latin1 characters (the chars AFTER ASCII in western Europe...)
if they appear in strings. 
(no problem if they are part of a function comment, see below).

Some of the characters lead to 4 character Hex-codes being printed instead:
"" ## ^u    prints as "0xFB"

If you use the funny characters in comments of functions, they are stored
and printed properly.

HOWEVER: In a few rare cases, the strings are not even PARSED properly;
	the line 'ISOdiv <- ..' below gives a SYNTAX error.

The following code shows the symptoms :
   -- ONLY if  the e-mail between here and your place is  8-bit clean! --
  (else: get it ftp://ftp.stat.math.ethz.ch/U/maechler/R/string-test.R )

frenchquotes <- "..."  ## <<...>>
frenchquotes

Umlaute <- " " # = "a "o "u  "A "O "U
Umlaute #- only the last one is not printed properly...

A.accents <- " " # `a 'a ^a "a oa ae  `A 'A ^A "A oA AE
A.accents
EI.accents <- " "
EI.accents
O.accents <- ""
O.accents

U.accents <- ""
U.accents

ISO24x <-  " " #octal 241..257
ISO26x <- " " #octal 260..277

##--- THIS IS a Problem: It gives a SYNTAX error !
ISOdiv <- "    " 
##-- One of these characters even was producing the same as  'q()' !!

aa_ function(x) {
  x^2
  ##- frenchquotes <- "..."  ## <<...>>
  ##- Umlaute <- " " # = "a "o "u  "A "O "U
  ##- A.accents <- " " # `a 'a ^a "a oa ae  `A 'A ^A "A oA AE
  ##- EI.accents <- " "
  ##- O.accents <- ""
  ##- U.accents <- ""
  ##-
  ##- ISO24x <-  " " #octal 241..257
  ##- ISO26x <- " " #octal 260..277
  ##- ISOdiv <- " " ##-- OMITTED further: SYNTAX error !!
}
aa
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 22:14:03 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 09:14:03 +1200 (NZST)
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
 <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
Message-ID: <199705122114.JAA02547@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:
 > Note that the problem with `rhyper(5,200,250,60)' never returning still
 > seems to exist.

We have a fix for this.  There was a typo in the underlying generator
code.  (I'm trying to avoid piecemeal fixes, but the dhyper / phyper /
qhyper one seemed rather nasty and the cause of a number of bug
reports).  More complete patch soon.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 22:15:35 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 09:15:35 +1200 (NZST)
Subject: R-alpha: XDR and Portable Data
Message-ID: <199705122115.JAA02567@stat1.stat.auckland.ac.nz>

While waiting for a "make" to finish this morning, I took down the Sun
"Network Programmers Reference Guide" and had a look at their
description of the XDR library.  Interestingly it looks like it can be
plugged into R with very little effort because our saveload code is
structured in exactly the right way.  So ..., contrary to what I said
before, I will have a bash at adding it.

It would still be useful to look at the other data formats.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 05:18:00 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 16:18:00 +1200 (NZST)
Subject: R-alpha: R-0.49 Patch 2
Message-ID: <199705130418.QAA07895@stat1.stat.auckland.ac.nz>

A second patch for R-0.49 is now available as

	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2.gz

and soon from mirror sites.

This patch fixes a variety of memory management problems and has
some updates for a number of numerical functions, including

	dhyper / phyper / qhyper / rhyper
	pbeta / qbeta
	qt
	qnorm

In addition, Thomas Lumley has provided some reworking of the
glm code.

I have nearly completed building a new TASKS lists and we are starting
work on the problems in it.  More patches will follow.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 07:11:31 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 08:11:31 +0200
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705122114.JAA02547@stat1.stat.auckland.ac.nz>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
 <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
 <199705122114.JAA02547@stat1.stat.auckland.ac.nz>
Message-ID: <199705130611.IAA06400@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> Kurt Hornik writes:
>> Note that the problem with `rhyper(5,200,250,60)' never returning still
>> seems to exist.

> We have a fix for this.  There was a typo in the underlying generator
> code.  (I'm trying to avoid piecemeal fixes, but the dhyper / phyper /
> qhyper one seemed rather nasty and the cause of a number of bug
> reports).  More complete patch soon.

Indeed, it does.  Also, my qt(0.975, 3) works now even if I compile with
"-O2 -g".

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 07:16:30 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 08:16:30 +0200
Subject: R-alpha: Re: R-beta: ls.print
In-Reply-To: <199704301411.QAA20329@hypatia.math.ethz.ch>
References: <199704301411.QAA20329@hypatia.math.ethz.ch>
Message-ID: <199705130616.IAA06418@aragorn.ci.tuwien.ac.at>

>>>>> Ennapadam Venkatraman writes:

> ls.print produces error that I don't seem to be able to trace.
> Output of the commands as follows: (hyeung is a 24x2 matrix of data)

> -------------------------------------------------
>> summary(hyeung)
>        x.1             x.2
>  Min.   : 28.0   Min.   : 10.0
>  1st Qu.: 72.0   1st Qu.: 87.5
>  Median : 86.5   Median : 92.5
>  Mean   : 81.0   Mean   : 82.5
>  3rd Qu.: 97.0   3rd Qu.:100.0
>  Max.   :100.0   Max.   :100.0

>> summary(lsfit(hyeung[,1],hyeung[,2]))
>           Length Class  Mode
> coef       2     -none- numeric
> residuals 24     -none- numeric
> intercept  1     -none- logical
> qr         6     -none- list

>> ls.print(lsfit(hyeung[,1],hyeung[,2]))
> trace: ls.print(lsfit(hyeung[, 1], hyeung[, 2]))
> Error: missing value in ``n1 : n2''

> -------------------------------------------------

> E. S. Venkatraman (venkat@biosta.mskcc.org)

The problem seems to be that

	ncol(ls.out$residuals)

gives NULL if ls.out is a vector.  An easy fix is to replace each
occurrence of ncol in ls.print() by NCOL.

A patch is appended below.

Btw, my help file for NCOL comes up with `.COL' rather than `NCOL'.  Can
anyone verify that?

-k

*** src/library/base/funs/lsfit.orig	Tue May 13 07:54:24 1997
--- src/library/base/funs/lsfit	Tue May 13 07:51:19 1997
*************** ls.print <- function(ls.out, digits=4, p
*** 256,265 ****
  
  	# construct coef table
  
! 	coef.table <- as.list(1:ncol(ls.out$residuals))
! 	if(ncol(ls.out$residuals)==1) coef <- matrix(ls.out$coef, nc=1)
  	else coef <- ls.out$coef
! 	for(i in 1:ncol(ls.out$residuals)) {
  		covmat <- (resss[i]/(n[i]-p)) * (qrinv%*%t(qrinv))
  		coef.table[[i]] <- cbind(coef[, i], diag(covmat)^.5,
  			coef[, i]/diag(covmat)^.5,
--- 256,265 ----
  
  	# construct coef table
  
! 	coef.table <- as.list(1:NCOL(ls.out$residuals))
! 	if(NCOL(ls.out$residuals)==1) coef <- matrix(ls.out$coef, nc=1)
  	else coef <- ls.out$coef
! 	for(i in 1:NCOL(ls.out$residuals)) {
  		covmat <- (resss[i]/(n[i]-p)) * (qrinv%*%t(qrinv))
  		coef.table[[i]] <- cbind(coef[, i], diag(covmat)^.5,
  			coef[, i]/diag(covmat)^.5,
*************** ls.print <- function(ls.out, digits=4, p
*** 270,276 ****
  		#print results
  
  		if(print.it) {
! 			if(ncol(ls.out$residuals)>1)
  				cat("Response:", colnames(ls.out$residuals)[i],
  				"\n\n")
  			cat(paste("Residual Standard Error=", format(round(
--- 270,276 ----
  		#print results
  
  		if(print.it) {
! 			if(NCOL(ls.out$residuals)>1)
  				cat("Response:", colnames(ls.out$residuals)[i],
  				"\n\n")
  			cat(paste("Residual Standard Error=", format(round(
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 13 09:12:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 13 May 97 10:12:50 +0200
Subject: R-alpha: Re: R-beta: ls.print
In-Reply-To: <199705130616.IAA06418@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Tue, 13 May 1997 08:16:30 +0200)
Message-ID: <9705130812.AA00712@>

Yes, I do confirm that the  Help page  (?NCOL) contains  '.COL'.

Apply the following patch (to doc2ms) in  $RHOME/etc , and "all is well":

--- doc2ms	Tue May 13 10:10:33 1997
+++ Old/doc2ms	Sun Nov 24 23:41:49 1996
@@ -122,8 +122,6 @@
 $2
 .DE
 ')
-define(DEQTEX,`')
-define(DEQHTML,`')
 END
 # Fix up the input to protect things that m4 is sensitive about.
 sed '
@@ -149,8 +147,8 @@
 s/M4_RQ/'\''/g
 s/M4_COMMA/,/g
 s/M4_IFELSE/ifelse/g
-s/^\.Internal/\\\&.Internal/
-s/^\.C/\\\&.C/
-s/^\.Fortran/\\\&.Fortran/
+s/^.Internal/\\\&.Internal/
+s/^.C/\\\&.C/
+s/^.Fortran/\\\&.Fortran/
 s/\\n/\\\\n/g
 '
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 10:07:06 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 11:07:06 +0200
Subject: R-alpha: R-0.49 patch 2
Message-ID: <199705130907.LAA07145@aragorn.ci.tuwien.ac.at>

Developers, watch out:

The patch seems to install the files with the new code for family and
glm into the man subdir of src/library/base rather than into funs.

(I already contacted Ross directly this morning for a quick fix, but
apparently missed him ... perhaps I should start working at 5:30 am.)

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 20:56:40 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 May 1997 07:56:40 +1200 (NZST)
Subject: R-alpha: Patch2
Message-ID: <199705131956.HAA12175@stat1.stat.auckland.ac.nz>

There is a problem with the patch I sent out yesterday. The patches for the glm
code are applied in the wrong place.  I have removed the patch file and will
have a real one available latter today.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Tue May 13 21:10:41 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Tue, 13 May 1997 13:10:41 -0700 (PDT)
Subject: R-alpha: batch mode.
In-Reply-To: <199705131956.HAA12175@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970513130620.1600B-100000@avon>


R0.49 (with and without the new patch applied to the correct places) fails
in batch mode. 
Solaris-gorn% more break.R
1+1

Solaris-gorn% ~/R49 <break.R

R : Copyright 1997, Robert Gentleman and Ross Ihaka
Version 0.49 Beta (April 23, 1997)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type "license()" for details.

[Previously saved workspace restored]

Error in par(args) : No device is active
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in internal par, 12 then 0
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in .Internal, 11 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in if, 9 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in <-, 7 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in {, 5 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
> 1+1
[1] 2
> 
> > 
Solaris-gorn% uname -a
SunOS gorn 5.5.1 Generic sun4u sparc SUNW,Ultra-1


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 21:29:22 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 May 1997 08:29:22 +1200 (NZST)
Subject: R-alpha: Revised Patch 2
Message-ID: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>

I have put the glm code in the right place and redone the patch.  To
help avoid confusion the new patch has an "a" appended to its name.
The patch can be obtained as:

	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2a.gz

Sorry for any problems this may have caused.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Tue May 13 21:32:19 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Tue, 13 May 1997 13:32:19 -0700 (PDT)
Subject: R-alpha: batch mode
In-Reply-To: <9705121211.AA00399@>
Message-ID: <Pine.SUN.3.95.970513133125.1659A-100000@avon>


The problem is not quite what I thought.

If I delete par(lwd=1) from my local .Rprofile the problem goes away.
Strange but true.

Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 14 07:04:20 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 14 May 1997 08:04:20 +0200
Subject: R-alpha: Revised Patch 2
In-Reply-To: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>
References: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>
Message-ID: <199705140604.IAA27457@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> I have put the glm code in the right place and redone the patch.  To
> help avoid confusion the new patch has an "a" appended to its name.
> The patch can be obtained as:

> 	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2a.gz

Thanks, works fine now.

For those who use my Debian Linux/GNU/ix86 packages, they have been
upgraded to 2a plus 3 more patches (legend, lsfit, doc2ms) recently
posted.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 14 08:17:23 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 May 97 09:17:23 +0200
Subject: R-alpha: batch mode. -- okay for me
In-Reply-To: <Pine.SUN.3.95.970513130620.1600B-100000@avon> (message from
 Thomas Lumley on Tue, 13 May 1997 13:10:41 -0700 (PDT))
Message-ID: <9705140717.AA01210@>

I can NOT confirm your batch problems.

For me, both

	echo "1+1" | R
and
	echo "1+1" > test.R
	R < test.R

work fine.
uname -a
	SunOS florence 5.5 Generic sun4u sparc SUNW,Ultra-1
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 14 15:57:08 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 14 May 1997 07:57:08 -0700 (PDT)
Subject: R-alpha: stop() in batch mode.
In-Reply-To: <9705140717.AA01210@>
Message-ID: <Pine.SUN.3.95.970514075254.2996A-100000@zen>

The batch mode stack imbalances appear to be confined to error reporting.
In particular the stop() command seems to trigger them.  

Solaris-gorn% more break.R
stop("Breaks R")

Solaris-gorn% ~/R49 <break.R 

R : Copyright 1997, Robert Gentleman and Ross Ihaka
Version 0.49 Beta (April 23, 1997)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type "license()" for details.

[Previously saved workspace restored]

> stop("Breaks R")
Error: Breaks R
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in stop, 2 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stop("Breaks R")
> 


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 14 17:58:09 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 May 97 18:58:09 +0200
Subject: R-alpha: stop() in batch mode [yes;  was not in  0.16.1]
In-Reply-To: <Pine.SUN.3.95.970514075254.2996A-100000@zen> (message from
 Thomas Lumley on Wed, 14 May 1997 07:57:08 -0700 (PDT))
Message-ID: <9705141658.AA01415@>

I do confirm this one  (SunOS + Solaris).

NOTE: The problem does NOT appear in  0.16.1 yet!
>>>>> "Th" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    Th> The batch mode stack imbalances appear to be confined to error
    Th> reporting.  In particular the stop() command seems to trigger them.

    Th> Solaris-gorn% more break.R stop("Breaks R")

    Th> Solaris-gorn% ~/R49 <break.R

    Th> R : Copyright 1997, Robert Gentleman and Ross Ihaka Version 0.49
    Th> Beta (April 23, 1997)

    Th> R is free software and comes with ABSOLUTELY NO WARRANTY.  You are
    Th> welcome to redistribute it under certain conditions.  Type
    Th> "license()" for details.

    Th> [Previously saved workspace restored]

    >> stop("Breaks R")
    Th> Error: Breaks R Execution halted Error: stack imbalance in
    Th> "unprotect" Execution halted stack imbalance in stop, 2 then 0
    Th> Error: stack imbalance in "unprotect" Execution halted Error: stack
    Th> imbalance in "unprotect" Execution halted stop("Breaks R")
    >>

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 15 05:16:47 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 15 May 1997 16:16:47 +1200 (NZST)
Subject: R-alpha: A Couple of Queries
Message-ID: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>

1) I have been working on making R libraries more like those in S.
I thought it might be advisable to discuss the ideas before springing
them on you.  What I have done is changed things so that each library
has its own frame on the search path.  E.g.

	> search()
	[1] ".GlobalEnv"   "library:base"
	> library("eda")
	> search()
	[1] ".GlobalEnv"   "library:eda"  "library:base"
	> ls(pos=2)
	[1] "coefficients.tukeyline"  "fitted.values.tukeyline"
	[3] "line"                    "medpolish"              
	[5] "plot.medpolish"          "print.medpolish"        
	[7] "print.tukeyline"         "residuals.tukeyline"    
	[9] "smooth"                 
	> assign("x", 10, pos=2)
	> ls(pos=2)
	 [1] "coefficients.tukeyline"  "fitted.values.tukeyline"
	 [3] "line"                    "medpolish"              
	 [5] "plot.medpolish"          "print.medpolish"        
	 [7] "print.tukeyline"         "residuals.tukeyline"    
	 [9] "smooth"                  "x"                      

All the search-path aware functions (ls, objects, assign, get, rm,
etc) now have a pos= argument which can be used to specify a frame to
work on.

I have not given S style path-names to the source of the libraries
because libraries are really internal objects rather than external
directories.

Libraries will have a .First and .Last functions.

I have not done anything about name-space clutter, but I have a couple
of ideas on name hiding which might be possible ( basically, every
library would have to "export" the names it wanted to be visible to
users).

I have not decided whether the user's global environment could be
detached or whether libraries or data objects could be attached before
it on the search path.


2) I am going ahead with implementing saving and restoring of data in
XDR format, so that there will be less trouble with heterogeneous Unix
networks.  Because the format of saved files will change, we must
either be incompatible or have some mechanism for restoring old save
files.  I would rather avoid the compatibility route if possible.
Would anyone be seriously inconvenienced if old data files could not
be restored?  (Its not hard to build in compatibility, it would just
take time which could be spend elsewhere).
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 15 10:04:51 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 15 May 1997 11:04:51 +0200
Subject: R-alpha: A Couple of Queries
In-Reply-To: Ross Ihaka's message of Thu, 15 May 1997 16:16:47 +1200 (NZST)
References: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
Message-ID: <x2lo5h85sb.fsf@bush.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> Would anyone be seriously inconvenienced if old data files could not
> be restored?  (Its not hard to build in compatibility, it would just
> take time which could be spend elsewhere).

I think the time would be well spent. Of course few people as of now
will have important data (only) in .RData format, and those that do
are probably clueful enough to save them in portable format before
upgrading. That situation won't last long, I suspect, (perhaps student
labs are *already* a problem?) and this might not be the last change
of the file format, so making sure that the program structure allows
loading of different file format revisions is likely to be useful
anyway.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Thu May 15 17:12:42 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Thu, 15 May 1997 09:12:42 -0700 (PDT)
Subject: R-alpha: A Couple of Queries
In-Reply-To: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970515090113.4417A-100000@zen>

On Thu, 15 May 1997, Ross Ihaka wrote:


> I have not done anything about name-space clutter, but I have a couple
> of ideas on name hiding which might be possible ( basically, every
> library would have to "export" the names it wanted to be visible to
> users).

This is certainly nice in principle, though not tremendously important at
the moment. It would be convenient to be able to declare functions in a
library that are global to the library but not accessible to the outside
world. 

> 2) I am going ahead with implementing saving and restoring of data in
> XDR format, so that there will be less trouble with heterogeneous Unix
> networks.  Because the format of saved files will change, we must
> either be incompatible or have some mechanism for restoring old save
> files.  I would rather avoid the compatibility route if possible.
> Would anyone be seriously inconvenienced if old data files could not
> be restored?  (Its not hard to build in compatibility, it would just
> take time which could be spend elsewhere).

For my purposes dump() will work fine for transferring old data files.

Will the changes give cross-platform (Mac/Win) portability too?

Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Thu May 15 21:20:57 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Fri, 16 May 1997 08:20:57 +1200 (NZST)
Subject: R-alpha: XDR
Message-ID: <199705152020.IAA00337@stat3.stat.auckland.ac.nz>


There are some 3rd party vendors that sell XDR support for windows/95/NT
however, they cost real money which is one of the things we don't have.
So in principle XDR is fine for cross-platform transfer in practice
it isn't likely.

robert
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 15 21:18:44 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 16 May 1997 08:18:44 +1200 (NZST)
Subject: R-alpha: A Couple of Queries
Message-ID: <199705152018.IAA02994@stat1.stat.auckland.ac.nz>

> > I have not done anything about name-space clutter, but I have a couple
> > of ideas on name hiding which might be possible ( basically, every
> > library would have to "export" the names it wanted to be visible to
> > users).

> This is certainly nice in principle, though not tremendously important at
> the moment. It would be convenient to be able to declare functions in a
> library that are global to the library but not accessible to the outside
> world. 

This is what I had in mind.  The functions in the library (and those
exported) could see all functions and data in the library, but only the
exported objects would be visible globally.  Of course, R scoping
can be used to provide this kind privacy, but you have to think
about setting up the libraries more carefully.

> > 2) I am going ahead with implementing saving and restoring of data in
> > XDR format, so that there will be less trouble with heterogeneous Unix
> > networks.  Because the format of saved files will change, we must
> > either be incompatible or have some mechanism for restoring old save
> > files.  I would rather avoid the compatibility route if possible.
> > Would anyone be seriously inconvenienced if old data files could not
> > be restored?  (Its not hard to build in compatibility, it would just
> > take time which could be spend elsewhere).

> For my purposes dump() will work fine for transferring old data files.

> Will the changes give cross-platform (Mac/Win) portability too?

This will depend on the availability of the XDR library for those
platforms.  I seem to recall that XDR is available for Windows at least.

I'm rather more concerned with Unix because it is common to have a mix
of platforms accessing the same data under Unix.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Fri May 16 05:59:17 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 16 May 1997 16:59:17 +1200 (NZST)
Subject: R-alpha: A Quick Way to Kill S ...
Message-ID: <199705160459.QAA16516@stat1.stat.auckland.ac.nz>

Start S and detach the directory at position 2.

	S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
	S : Copyright AT&T.
	Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
	Working data will be in /users/rdev/ihaka/.Data 
	> search()
	[1] "/users/rdev/ihaka/.Data"                             
	[2] "/usr/local/pkg/splus/splus-3.4/splus/.Functions"     
	[3] "/usr/local/pkg/splus/splus-3.4/stat/.Functions"      
	[4] "/usr/local/pkg/splus/splus-3.4/s/.Functions"         
	[5] "/usr/local/pkg/splus/splus-3.4/s/.Datasets"          
	[6] "/usr/local/pkg/splus/splus-3.4/stat/.Datasets"       
	[7] "/usr/local/pkg/splus/splus-3.4/splus/.Datasets"      
	[8] "/usr/local/pkg/splus/splus-3.4/library/trellis/.Data"
	> detach(pos=2,save="x")
	Error in UseMethod("assign", where): No specific or default method found
	Dumped
	> assign
	function(x, value, frame, where = NULL, ...)
	UseMethod("assign", where)
	> search()
	[1] "/users/rdev/ihaka/.Data"                             
	[2] ""                                                    
	[3] "/usr/local/pkg/splus/splus-3.4/stat/.Functions"      
	[4] "/usr/local/pkg/splus/splus-3.4/s/.Functions"         
	[5] "/usr/local/pkg/splus/splus-3.4/s/.Datasets"          
	[6] "/usr/local/pkg/splus/splus-3.4/stat/.Datasets"       
	[7] "/usr/local/pkg/splus/splus-3.4/splus/.Datasets"      
	[8] "/usr/local/pkg/splus/splus-3.4/library/trellis/.Data"
	System terminating: bad address

Ouch!

As you can see I've been playing with search paths.  I hope to have
more patches next week which will implement search paths for R more
completely (I think I'll skip the feature above).

I have also converted to using XDR for workspace saving (maintaining
backwards compatibility).  The bits of XDR we use are pretty simple
so it may be possible to create version for windows and	the mac.

Now I want to be able to attach saved workspaces, and perhaps
introduce some sort of "demand loadable" data object.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 16 17:39:46 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 16 May 1997 18:39:46 +0200
Subject: R-alpha: A Couple of Queries
In-Reply-To: <x2lo5h85sb.fsf@bush.kubism.ku.dk>
References: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
 <x2lo5h85sb.fsf@bush.kubism.ku.dk>
Message-ID: <199705161639.SAA07695@aragorn.ci.tuwien.ac.at>

>>>>> Peter Dalgaard BSA writes:

> Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
>> Would anyone be seriously inconvenienced if old data files could not
>> be restored?  (Its not hard to build in compatibility, it would just
>> take time which could be spend elsewhere).

> I think the time would be well spent. Of course few people as of now
> will have important data (only) in .RData format, and those that do
> are probably clueful enough to save them in portable format before
> upgrading. That situation won't last long, I suspect, (perhaps student
> labs are *already* a problem?) and this might not be the last change
> of the file format, so making sure that the program structure allows
> loading of different file format revisions is likely to be useful
> anyway.

Agreed.  I have a few .RData files, but I can live with recreating them.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From la-jassine@aix.pacwan.net  Fri May 16 16:16:24 1997
From: la-jassine@aix.pacwan.net (Paul Gilbert)
Date: Fri, 16 May 1997 12:16:24 -0300
Subject: R-alpha: A Couple of Queries
Message-ID: <1348302032-894051@aix.pacwan.net>

>1) I have been working on making R libraries more like those in S.
...
>	> library("eda")
>	> search()
>	[1] ".GlobalEnv"   "library:eda"  "library:base"

As I recall in S, library() adds to the end of the search list unless
First=T is specified. The function attach() works by putting things in
position 2.

>Libraries will have a .First and .Last functions.
As I recall these are called .First.lib and .Last.lib in S.

>I have not done anything about name-space clutter, but I have a couple
>of ideas on name hiding which might be possible ( basically, every
>library would have to "export" the names it wanted to be visible to
>users).

In theory this is probably the preferred way to do this, but I think
compatability with S may be more easily maintained if you explicitly hide
names which can be hidden.

...
>Would anyone be seriously inconvenienced if old data files could not
>be restored? 

This is not a problem for me. However, if you do it, a separate conversion
utility might be better as it is something for which there will eventually
be no need.

Also, on XDR, I  took a quick scan through the Bank  of Canada PADI code
which uses XDR, just to see if there might be any helpful hints.  I didn't
find too much, but there where a number of comments about "deleting NULL
pointers so that XDR does not barf," for what that's worth. Good luck.

Paul Gilbert

 P.S.  0.49 with patch2a seems to be working really well. The most serious
problem for my time series library is now eigen() for non-symmetric matrices.


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 18 20:50:16 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 19 May 1997 07:50:16 +1200 (NZST)
Subject: R-alpha: Eigenvalue Computation Query
Message-ID: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>

I have been looking at the "eigen" function and have reintroduced the
ability to compute (right) eigenvalues and vectors for non-symmetric
matrices.  I've also made "eigen" complex capable.

The code is based on the eispack entry points RS, RG, CH, CG (which is
what S appears to use too).  The problem with both the S and R
implementations is that they consume huge amounts of memory.  Some of
this is due to purely ".Fortran" overhead, which I think I can cure.
But some of the bloat is due to the inclusion of special eigenvalues-only
code from eispack.

The question is:

Should I drop this special code and always compute both eigenvalues
and eigenvectors?  This would substantially reduce code size, but might
increase computational cost in the case where only eigenvalues are
needed.


PS: For the lapack fans out there ...  I looked hard at using lapack
as an alternative to eispack, but it's written in a fashion which
does not make its addition to R as simple as linpack and eispack.
When we all have SMP desktop machines it will become more of an issue.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Tue May 20 02:09:01 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Mon, 19 May 1997 20:09:01 -0500 (CDT)
Subject: R-alpha: A Couple of Queries
In-Reply-To: <199705152018.IAA02994@stat1.stat.auckland.ac.nz> from "Ross Ihaka" at May 16, 97 08:18:44 am
Message-ID: <9705200109.AA26588@nokomis.stat.umn.edu>

Ross Ihaka wrote:
> 
> This is what I had in mind.  The functions in the library (and those
> exported) could see all functions and data in the library, but only the
> exported objects would be visible globally.  Of course, R scoping
> can be used to provide this kind privacy, but you have to think
> about setting up the libraries more carefully.
> 

Is your design consistent with (maybe not now but later) allowing a
library to specify a static search path component for code defined in
it that comes before entries added dynamically at runtime? THis would
allow a "uses" specification where a library definition specifies
other libraries it uses and can be sure these will be used and not
whatever happens to be attached earlier on the search path. Among
other things, this might allow something like

	LIBRARY: survival
	EXPORTS: coxph, ...
	USES: S.compatibility, S.syntax, ...
	.... insert Terry's latest code ...

So when the library is loaded, S syntax is used (if it differs from
R's) and when the body of a function like coxph is executed,
definitions from the S compatibility library will be called instead of
standard R ones (if they differ).  This would make it easier for R to
go its own way when it that seems appropriate without losing the
ability to use S code.

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 06:54:12 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 07:54:12 +0200
Subject: R-alpha: small doc bug
Message-ID: <199705200554.HAA25739@aragorn.ci.tuwien.ac.at>

The documentation for ls/objects has

	ls(name, pos=2, envir=sys.frame(sys.parent()),
           all.names=FALSE, pattern)

but the code has

	ls <-
	function (name, pos = -1, envir = NULL,
                  all.files = FALSE, pattern)

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 07:18:22 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 08:18:22 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
Message-ID: <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> I have been looking at the "eigen" function and have reintroduced the
> ability to compute (right) eigenvalues and vectors for non-symmetric
> matrices.  I've also made "eigen" complex capable.

> The code is based on the eispack entry points RS, RG, CH, CG (which is
> what S appears to use too).  The problem with both the S and R
> implementations is that they consume huge amounts of memory.  Some of
> this is due to purely ".Fortran" overhead, which I think I can cure.
> But some of the bloat is due to the inclusion of special eigenvalues-only
> code from eispack.

> The question is:

> Should I drop this special code and always compute both eigenvalues
> and eigenvectors?  This would substantially reduce code size, but might
> increase computational cost in the case where only eigenvalues are
> needed.

I'd say, reduce code size.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Friedrich.Leisch@ci.tuwien.ac.at  Tue May 20 08:26:06 1997
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Tue, 20 May 1997 09:26:06 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
 <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
Message-ID: <199705200726.JAA07429@galadriel.ci.tuwien.ac.at>

>>>>> On Tue, 20 May 1997 08:18:22 +0200,
>>>>> Kurt Hornik wrote:

>>>>> Ross Ihaka writes:
>> I have been looking at the "eigen" function and have reintroduced the
>> ability to compute (right) eigenvalues and vectors for non-symmetric
>> matrices.  I've also made "eigen" complex capable.

>> The code is based on the eispack entry points RS, RG, CH, CG (which is
>> what S appears to use too).  The problem with both the S and R
>> implementations is that they consume huge amounts of memory.  Some of
>> this is due to purely ".Fortran" overhead, which I think I can cure.
>> But some of the bloat is due to the inclusion of special eigenvalues-only
>> code from eispack.

>> The question is:

>> Should I drop this special code and always compute both eigenvalues
>> and eigenvectors?  This would substantially reduce code size, but might
>> increase computational cost in the case where only eigenvalues are
>> needed.

> I'd say, reduce code size.

probably one shouldn't disagree with his boss openly ... but we
are the ones actually doing all the simulations :-)

do you know how much the difference in computational cost is? if it's
worth the increase in code size I'd rather prefer only computing the
required eigenvalues

best,
fritz


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 20 10:24:18 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 20 May 1997 11:24:18 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: Friedrich Leisch's message of Tue, 20 May 1997 09:26:06 +0200
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
 <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
 <199705200726.JAA07429@galadriel.ci.tuwien.ac.at>
Message-ID: <x24tbywl6l.fsf@bush.kubism.ku.dk>

Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:

> > I'd say, reduce code size.
> 
> probably one shouldn't disagree with his boss openly ... but we
> are the ones actually doing all the simulations :-)
> 
> do you know how much the difference in computational cost is? if it's
> worth the increase in code size I'd rather prefer only computing the
> required eigenvalues

As I understand it, the difference is between getting all the
eigenvalues and all eigenvalues and -vectors. Getting only the top or
bottom few is not an option in Splus either, but that would be where
the real savings lie.

I'd say do the small thing now and rethink the whole numerics business
later (could we lift all of libcruft.a out of the octave source, for
instance?). If you need some special eispack routines, you can always
dyn.load them in.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 15:31:57 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 16:31:57 +0200
Subject: R-alpha: Re unified shell script
Message-ID: <199705201431.QAA27356@aragorn.ci.tuwien.ac.at>

Some time ago there was the suggestion to add a PLATFORM subdir level
for bin (and eventually the library subdirs with `binaries'), and the
idea to have the shell wrapper automagically call the right binary.

I mentioned that one might be able to use the shell variables OSTYPE and
HOSTTYPE for that, noticing however that e.g on my Debian Linux/GNU/ix86

		bash	tcsh
OSTYPE		Linux	linux
HOSTTYPE	i386	i386-linux

Hmm ... It seems (a colleague just checked that) that these variables
are not POSIX either, and hence I'd say rather useless for our purpose.

In the absence of a reliable run-time possibility to determine the
current platform, it seems to be natural to use `platform' as obtained
at compile-time for possibly distinguishing the various binaries etc,
and leave it at the discretion of the sysadmin to ensure that the R
script in the path calls the right binary.

If I am missing something obvious, please let me know.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 20 16:11:18 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 20 May 97 17:11:18 +0200
Subject: R-alpha: print 'problems': print(2^30, digits=12); comments at start of function()
Message-ID: <9705201511.AA00407@>

Both of these bugs are not a real harm,
however, they have been annoying me for too long ... ;-)

1)
 print(2^30, digits = 12) #-  exponential form; unnecessarily!

 formatC(2^30, digits = 12) #- shows you what you'd want above

 ## S-plus is okay here; note that the problem also affects
 ##	paste(.)  & format(.) :
 
 options(digits=10)
 paste(2^(4*1:8))
 
 S-plus gives

[1] "16"         "256"        "4096"       "65536"      "1048576"   
[6] "16777216"   "268435456"  "4294967296"

 whereas R gives

[1] "16"              "256"             "4096"            "65536"          
[5] "1048576"         "1.6777216e+07"   "2.68435456e+08"  "4.294967296e+09"



2) This one has been reported (in slightly different form)
   >> Date: Mon, 10 Mar 1997 09:46:37 +0100 (MET)
   >> From: Martyn Plummer <plummer@iarc.fr>
   >> To: r-testers@stat.math.ethz.ch

   >> #4) If you put a few lines of comments at the start of a function,
   >>     then the comments always appear *after* the first line of code. 

This is REALLY painful; try, e.g.,

fcat <- function(..., f.dig= 4, f.wid = f.dig +5, f.flag = ' ', nl = TRUE,
                 file = "", sep = " ",
                 fill = FALSE, labels = NULL, append = FALSE)
{
  ## Purpose: Formatted CAT -- for printing 'tables'
  ## ----------------------------------------------------------------------
  ## Author: Martin Maechler, Date: 12 May 97
  l <- unlist(lapply(list(...), formatC,
                     wid= f.wid, digits= f.dig, flag= f.flag))
  cat(l, if(nl)"\n", file=file, sep=sep, fill=fill,labels=labels, append=append)
}

# and look how it prints:
fcat

Even worse, some comments are silently lost (yes, I know in some
sitatuations,  S also loses comments) : 

ex <- 
##
## S version 4 likes comments like these.  
## ----------- They automagically become  on-line help.
## R just swallows them up into /dev/null...
##
function(a,b)
{
	a + b
}
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 20 17:24:48 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 20 May 97 18:24:48 +0200
Subject: R-alpha: rep(.) and aperm(.)  lose names(.) and dimnames(.)  -- Patch
Message-ID: <9705201624.AA00517@>

The following patches fix the problem.
For aperm, it's quite important to keep dimnames(.);
for rep(.), it's arguable, however S(-plus) does it...

However, it would probably be better to this in the '.Internal' code for
all attributes.

Patch to be applied in		$RHOME/src/library/base/funs/ 

--- rep~	Sun Nov 24 23:42:29 1996
+++ rep		Tue May 20 18:20:12 1997
@@ -5,6 +5,7 @@
 	if (missing(times))
 		times <- ceiling(length.out/length(x))
 	r<-.Internal(rep(x,times))
+	if(!is.null(nm <- names(x))) names(r) <- .Internal(rep(nm, times))
 	if (!missing(length.out))
 		return(r[1:length.out])
 	return(r)

--- aperm~	Sun Nov 24 23:42:20 1996
+++ aperm	Tue May 20 18:20:10 1997
@@ -7,5 +7,7 @@
 		if(!all(sort(perm)==1:length(perm)))
 			stop("perm is not a permutation")
 	}
-	.Internal(aperm(a,perm,resize))
+	r <- .Internal(aperm(a, perm, resize))
+	if(!is.null(dn <- dimnames(a))) dimnames(r) <- dn[perm]
+	r
 }

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 17:25:41 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 18:25:41 +0200
Subject: R-alpha: S_alloc
Message-ID: <199705201625.SAA27815@aragorn.ci.tuwien.ac.at>

Does anyone know what exactly S_alloc() does?  (Yes, it's porting time
again ...)

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Tue May 20 18:38:54 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Tue, 20 May 1997 12:38:54 -0500 (CDT)
Subject: R-alpha: S_alloc
In-Reply-To: <199705201625.SAA27815@aragorn.ci.tuwien.ac.at> from "Kurt Hornik" at May 20, 97 06:25:41 pm
Message-ID: <9705201738.AA09065@nokomis.stat.umn.edu>

Kurt Hornik wrote:
> 
> Does anyone know what exactly S_alloc() does?  (Yes, it's porting time
> again ...)
> 
> Thanks,
> -k
> =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> 

I believe it allocates zero'd memory like calloc but S is responsible
for freeing it (calling free on it probably has "unpredictable results
..."). S probably usually frees the memry on return from the function
call that got you into C code. In old versions of S I think this was
managed by saving/ resetting the sbrk on function entry/exit and
allocating above the current sbrk value. THis way memory used in a
function was recovered just by restoring the sbrk -- a nice
stack-based discipline. I think the current strategy is a bit
different both to allow portability and to improve memory recovery
during a function call. As a rasult, memory allocated may not be freed
right after the outer call returns, but since S doesn't have a garbage
collector as such it probably has to happen pretty soon after the
return.

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:46:18 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:46:18 +0200
Subject: R-alpha: planned update of ctest
Message-ID: <199705201746.TAA28426@aragorn.ci.tuwien.ac.at>

I am contemplating improving my ctest package as follows:

* Add exact p,q,r,s functions for the Wilcoxon distribution, and change
the test accordingly (make `exact' work).

* Make Fisher's test work for tables larger than 2 by 2.

* Perhaps add an exact unconditional test for 2 by 2 tables?

* Perhaps add something on estimating/testing relative risk and odds?

As clearly I'd like to minimize my efforts I'd be happy about any
suggestion for availability of code, and for a good interface for the
last idea.

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:50:56 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:50:56 +0200
Subject: R-alpha: elementary statistics
Message-ID: <199705201750.TAA28447@aragorn.ci.tuwien.ac.at>

A while ago, Peter wrote

In the same vein, we'll need plot.distrib() (based on Martins plot.step)
plot.KM() (Kaplan-Meier plots, ditto) and logrank.test(). I.e. all the
"statistical over-the-counter medicine". (And in teaching them we'll
ruthlessly ignore all the fine points of the fine language...)

Has anyone looked into this?

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:52:49 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:52:49 +0200
Subject: No subject
Message-ID: <199705201752.TAA28456@aragorn.ci.tuwien.ac.at>

And finally, for something completely different.  I am contemplating
teaching a course on `Statistical Computing' next semester.  Sort of a
basic introduction on statistical software, with emphasis on Xlisp-STAT
plus ViSta and, of course, R.

Would anyone have (or know of) material that I could use?

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 20 19:18:02 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 20 May 1997 20:18:02 +0200
Subject: R-alpha: planned update of ctest
In-Reply-To: Kurt Hornik's message of Tue, 20 May 1997 19:46:18 +0200
References: <199705201746.TAA28426@aragorn.ci.tuwien.ac.at>
Message-ID: <x2raf2uhwl.fsf@bush.kubism.ku.dk>

Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

> 
> I am contemplating improving my ctest package as follows:
> 
> * Add exact p,q,r,s functions for the Wilcoxon distribution, and change
> the test accordingly (make `exact' work).
> 
> * Make Fisher's test work for tables larger than 2 by 2.
> 
> * Perhaps add an exact unconditional test for 2 by 2 tables?
> 
> * Perhaps add something on estimating/testing relative risk and odds?
> 
> As clearly I'd like to minimize my efforts I'd be happy about any
> suggestion for availability of code, and for a good interface for the
> last idea.

As usual, all you'll get is suggestions for more enhancements:

* Order-based statistics with scores different from ranks (i.e. Van
der Waerdens test, etc.)

* Logrank test (a bit hefty to pull out the survival package for that)

* Stratified tests. I actually need those (Wilcoxon and K-W versions)
for a client, so I might put a new student computational assistant on
it. Not sure whether that will break her in or just break her,
though...

Re. relative risks, you can quite easily setup an exact test for 
RR=r (I forget, but it's something like multiplying the point
probabilities in Fishers test with r^x). Consequently, you can also
compute confidence intervals. One snag is the usual mess with the
definition of the two-sided p-value. I have previously used two sided
intervals consisting of those values that weren't significantly too
big [1] at the alpha/2 level nor significantly too small at the same
level, but I'm not altogether sure that holds.

[1] Yeah, yeah. "...for which the data were not significantly too
small, using a one-sided test", etc.
-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 09:19:14 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 10:19:14 +0200
Subject: R-alpha: plot.default(.) : (too?) many  "..."  ---  plot(.., lab =c(10,10,7)) fails
Message-ID: <9705210819.AA00743@>

A simple example:
	plot(1:10, 1:10, main = "TITLE", lab = c(10,10,7))
	 #> Error: invalid subscript type

The reason is the call to  axis(1, ...) in  plot.default(.).

plot.default has the  ...  arguments in order to pass the many different
possible 'par' options to it's own subfunctions.

Currently, plot.default has

 plot.xy(xy, type, col = col, pch = pch, cex = cex, bg = bg, lty = lty, ...)
 axis(1, ...)
 axis(2, ...)
 box(...)
 title(main = main, xlab = xlab, ylab = ylab, ...)


In order for this to work, all the subfunctions MUST be tolerant to all
possible argument specifications.
axis(.) is NOT  which leads to the above  Error.

A different approach would be to "analyze"  list(...),
extract relevant parameters and pass them to the different sub-functions of
plot.default(.).

BY THE WAY:

  It would be nice to be able to say

	par(reset = TRUE)  

  (or similar) for resetting all the graphical parameters to their (device-dependent)
  default values.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 21 11:31:05 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 21 May 1997 12:31:05 +0200
Subject: R-alpha: factors ...
Message-ID: <199705211031.MAA31074@aragorn.ci.tuwien.ac.at>

Perhaps someone can enlighten me here:

R> x <- factor(LETTERS[1:3])
R> x
[1] A B C
R> mode(x)
[1] "factor"
R> class(x)
[1] "factor"
R> mode(unclass(x))
[1] "factor"

S-PLUS has

> x <- factor(LETTERS[1:3])
> mode(x)
[1] "numeric"
> class(x)
[1] "factor"
> mode(unclass(x))
[1] "numeric"

???
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 21 11:32:45 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 21 May 1997 12:32:45 +0200
Subject: R-alpha: iris
Message-ID: <199705211032.MAA31089@aragorn.ci.tuwien.ac.at>

Also, why is the iris data set shipped with R different from the one
that comes with S-PLUS?

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 12:00:00 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 13:00:00 +0200
Subject: R-alpha: plot(1); axis(1, at=10) >>> Seg.fault  -- and a patch
Message-ID: <9705211100.AA00805@>


This problem has been mentioned  by Arne Kovac <maak@stats.bris.ac.uk>  on May 9-10.
The patch is really a replacement of 'axis' in  RHOME/src/library/base/funs/

It contains the fixes which where proposed Arne Kovac
and fixes (all?) the errors he/she (?) reported on May 9.

"axis" <-
function (which, at, labels = TRUE, ...) 
{
	if (which%%2 == 1) {
		axp <- par("xaxp")
		usr <- par("usr")[1:2]
		log <- par("xlog")
	}
	else {
		axp <- par("yaxp")
		usr <- par("usr")[3:4]
		log <- par("ylog")
	}
	if (missing(at)) {
		if (log) {
			if (usr[2] < usr[1] + 1) {
				at <- seq(axp[1], axp[2], length = axp[3] + 1)
			}
			else {
				p1 <- ceiling(min(usr))
				p2 <- floor(max(usr))
				if (p2 - p1 < 2) {
				 at <- c(1, 2, 5) * 10^rep(p1:p2, rep(3, p2 - p1 + 1))
				 at <- at[10^usr[1] <= at & at < 10^usr[2]]
				}
				else at <- 10^seq(p1, p2, by = 1)
			}
		}
		else at <- seq(axp[1], axp[2], length = axp[3] + 1)
		ind <- rep(TRUE, length(at))
	}
	else {
		ind <- (usr[1] <= at & at <= usr[2])
	}
	if (is.logical(labels)) {
		if (labels) {
			if (!log) 
				at[abs(at/(max(at) - min(at))) < 0.001] <- 0
			labels <- format(at, trim = T)
		}
		else labels <- rep("", length(at))
	}
	else labels <- format(labels, trim = T)
	.Internal(axis(which, as.double(at[ind]), labels[ind], ...))
}

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From la-jassine@aix.pacwan.net  Wed May 21 16:00:51 1997
From: la-jassine@aix.pacwan.net (Paul Gilbert)
Date: Wed, 21 May 1997 12:00:51 -0300
Subject: R-alpha: Eigenvalue Computation Query
Message-ID: <1347889984-174502@aix.pacwan.net>

Ross

>Should I drop this special code and always compute both eigenvalues
>and eigenvectors?  This would substantially reduce code size, but might
>increase computational cost in the case where only eigenvalues are
>needed.

I often need the eigenvalues only, but in my experience the main causes for
slowness is when I start using more memory than is physically available. (My
machine starts sounding like it does when I run S.) I would guess that
reducing code size may be more valuable than the specialized code.

Paul Gilbert

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 21 16:01:11 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 May 1997 08:01:11 -0700 (PDT)
Subject: R-alpha: factors ...
In-Reply-To: <199705211031.MAA31074@aragorn.ci.tuwien.ac.at>
Message-ID: <Pine.SUN.3.95.970521075757.7924A-100000@zen>

On Wed, 21 May 1997, Kurt Hornik wrote:

> Perhaps someone can enlighten me here:
> R> x <- factor(LETTERS[1:3])
> [1] "factor"
> 
> S-PLUS has
> > x <- factor(LETTERS[1:3])
> > mode(unclass(x))
> [1] "numeric"

It's a feature. R has a primitive factor type, S-PLUS doesn't and so loses
factorness with unclass(). You can use as.numeric() to coerce to numeric
in either system. 


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 18:04:35 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 19:04:35 +0200
Subject: R-alpha: Plot: Title above 'mfrow=c(2,2)' ??
Message-ID: <9705211704.AA01031@>


In S, I can have an "overall" title in a multi-figure plot :

    par(mfrow=c(2,2), oma = c(0,0,2,0))
    frame() #- !
    mtext("Sine Functions", cex=2, outer =T)
    x_1:100
    for(i in 1:4) plot(x, sin(i*pi*x/100), main=paste(i), type = 'l', col = 1+i)

In R, this doesn't work as it should,  with and without the 'frame()' 
statement.
((where is the bug?  It's not quite clear to me))

Is there a way at all to write an "overall" title in this situation ?

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 21 18:08:26 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 May 1997 10:08:26 -0700 (PDT)
Subject: R-alpha: Plot: Title above 'mfrow=c(2,2)' ??
In-Reply-To: <9705211704.AA01031@>
Message-ID: <Pine.SUN.3.95.970521100651.7972C-100000@zen>

On Wed, 21 May 1997, Martin Maechler wrote:

> In S, I can have an "overall" title in a multi-figure plot :
> 
> 
> Is there a way at all to write an "overall" title in this situation ?

 par(mfrow=c(2,2), oma = c(0,0,2,0))
 # do the plots
 par(mfrow=c(1,1))
 title(main="blah")



Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Wed May 21 21:26:43 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 May 1997 08:26:43 +1200 (NZST)
Subject: R-alpha: factors ...
Message-ID: <199705212026.IAA00840@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:

> Perhaps someone can enlighten me here:

> R> x <- factor(LETTERS[1:3])
> R> x
> [1] A B C
> R> mode(x)
> [1] "factor"
> R> class(x)
> [1] "factor"
> R> mode(unclass(x))
> [1] "factor"

> S-PLUS has

> > x <- factor(LETTERS[1:3])
> > mode(x)
> [1] "numeric"
> > class(x)
> [1] "factor"
> > mode(unclass(x))
> [1] "numeric"

> ???

Originally, factors in R were implemented as a special type.  This was
partly because we didn't have objects at the start, and partly because
S factors have a annoying habit of forgetting that they are factors.  E.g.

	> x <- factor(LETTERS[1:3])
	> c(x, 1)
	[1] 1 2 3 1
	> c(x,"a")
	[1] "1" "2" "3" "a"

However, in order to be compatible with S, a factor "x" needs to
satisfy inherits(x,"factor").  So we also attach "class" of factor to
them as well.  Any "class" manipulations use the "class" attribute but
all internal manipulations are based on the "mode".

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Wed May 21 21:29:24 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 May 1997 08:29:24 +1200 (NZST)
Subject: R-alpha: iris
Message-ID: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>

> Also, why is the iris data set shipped with R different from the one
> that comes with S-PLUS?

Do you mean the numbers in the data, or the fact that we have a data
frame and they have a 50x4x3 array?   (I've never understood why anyone
would have structured the iris data that way ...).
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 06:28:52 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 07:28:52 +0200
Subject: R-alpha: iris
In-Reply-To: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>
References: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>
Message-ID: <199705220528.HAA03991@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

>> Also, why is the iris data set shipped with R different from the one
>> that comes with S-PLUS?

> Do you mean the numbers in the data, or the fact that we have a data
> frame and they have a 50x4x3 array?   (I've never understood why anyone
> would have structured the iris data that way ...).

The latter.  I am playing a bit with porting Brian's `class' library,
and surprisingly the tests he has use the iris data set ...

The df makes more sense, right.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 12:25:46 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 13:25:46 +0200
Subject: No subject
Message-ID: <199705221125.NAA05423@aragorn.ci.tuwien.ac.at>

Does anyone have a description of the S help format?
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 13:07:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 14:07:16 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <199705221125.NAA05423@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Thu, 22 May 1997 13:25:46 +0200)
Message-ID: <9705221207.AA01336@>

>>>>> "Kurt" == Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

    Kurt> Does anyone have a description of the S help format?  -k

Not really, here is what you get from  ?prompt  in S-plus

 Construct Documentation for Function or Data


 DESCRIPTION:
	Produces a file that can be edited  and  then  nroffed  or
	troffed  to give documentation (a helpfile) for a function
	or dataset.

 USAGE:
	prompt(object, filename=<<see below>>)

 REQUIRED ARGUMENTS:
 object:   name or character string giving the name of a  function
	or data object.

 OPTIONAL ARGUMENTS:
 filename:   filename for resulting documentation; the default  is
	name.d, where name is the character string  resulting from
	deparsing the object name.

 SIDE EFFECTS:
	A file is written, containing an outline  for  documenting
	the  function  or  object.   A  message  is printed to the
	screen giving the name of the created file.  The file will
	eventually  be  used  by  the  help  function  to  produce
	documentation for the object.  As produced by prompt,  the
	file  for a function will contain the call to the function
	and individual sections for each of  the  arguments.   The
	file  for  a  data frame will contain the name of the data
	frame, its dimensions, and individual sections for each of
	the variables in the data frame.

 DETAILS:
	This is a generic function; there is  a  method  for  data
	frames and a default method.

	You will need to fill in the actual information about  the
	arguments,  a  description  of  the  value returned by the
	function, examples,  and  whatever  other  information  is
	appropriate.  Lines in the file that contain "~" should be
	replaced with  appropriate  information.   Arguments  that
	must  be  specified  in the name=value form should have an
	equal sign (=) added after name on the .AG name line.

	To add a section such as "WARNING" make a  line  beginning
	with  ".SH"  (for  example,  ".SH  WARNING")  and  put the
	information on subsequent  lines.  A  line  consisting  of
	".ul" italicizes the next line.

	The correct order of sections for help files created  with
	prompt.default  is as follows:  Title, Description, Usage,
	Required Arguments, Optional  Arguments,  ".GR"  (graphics
	parameters),   Value,   Side  Effects,  Warning,  Details,
	Background, References, See Also, Examples, Keywords.  The
	"Note"  section,  if  it  appears, may be anywhere between
	Side Effects and References.

	The correct order of sections for help files created  with
	prompt.data.frame  is  as  follows:   Title, Summary, Data
	Description, Source, Note, Warning, See Also, Examples.

	Be sure to leave the line .WR at the  end  of  file;  this
	wraps  things  up  neatly.   If  you  see the message trap
	botch, it is probably from a help file without a .WR.

	For a full description of the formatting macros  available
	in  help files, see the section Documenting Your Module in
	the  chapter  Developing  New  Modules   in   the   S-PLUS
	Programmer's Manual.

	Documentation for functions and data resides (as  ordinary
	text  files)  in  a  subdirectory  called  .Help under the
	directory containing the S-PLUS objects  themselves.   For
	example,  if  you  are documenting a function myfun in the
	directory /usr/me/.Data, the completed documentation  file
	should be moved into the .Help directory with the command

	     mv myfun.d /usr/me/.Data/.Help/myfun

	To see more about how documentation files  are  organized,
	look  at some examples.  Documentation files for functions
	are   in   the   directories    $SHOME/s/.Functions/.Help,
	$SHOME/stat/.Functions/.Help                           and
	$SHOME/splus/.Functions/.Help where $SHOME is  the  S-PLUS
	home directory.  Type

	     !echo $SHOME/s/.Functions/.Help

	from inside S-PLUS to see where this is on your machine.


	You can find more information in the chapter Enhancing  S-
	PLUS of the S-PLUS Installation and Maintenance Manual  in
	the sections entitled Adding Help Files for New  Functions
	and Modifying S-PLUS Keywords.

 SEE ALSO:
	The section "Documenting  Your  Module"  in  the   chapter
	"Developing   New  Modules"  of  the  S-PLUS  Programmer's
	Manual.

	help, help.start, Question.mark.

 EXAMPLES:
	prompt("mygrep")    # construct mygrep.d file
	!vi mygrep.d  # fix up the documentation
	!mkdir .Data/.Help  # if necessary, construct subdirectory
	!mv mygrep.d .Data/.Help/mygrep    # install

--------------------------
Why do you need it?

Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
It contains quite a bit of implicit documentation on the S-help format.
I've been using it a few times  more or less successfully.

YES:	This should come in the  $RHOME/etc/ directory !

- Martin
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Friedrich.Leisch@ci.tuwien.ac.at  Thu May 22 14:32:02 1997
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 May 1997 15:32:02 +0200
Subject: R-alpha: missing warning message
Message-ID: <199705221332.PAA08887@galadriel.ci.tuwien.ac.at>


In R it is possible to write nonsense 

R> 0.5:4:3:9:8:5
[1] 0.5 1.5 2.5 3.5 4.5

and never be warned about it, Splus does the expected thing:

Splus> 0.5:4:3:9:8:5
[1] 0.5 1.5 2.5 3.5 4.5
Warning messages:
1: Numerical expression has 4 elements: only the first used in: 0.5:4:3
2: Numerical expression has 3 elements: only the first used in: 0.5:4:3:9
3: Numerical expression has 9 elements: only the first used in: 0.5:4:3:9:8
4: Numerical expression has 8 elements: only the first used in: 0.5:4:3:9:8:5


Best,
Fritz

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 15:41:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 16:41:16 +0200
Subject: R-alpha: options(..) vs.  .Options  //  Re(1i) = 2.4976e-307
Message-ID: <9705221441.AA01396@>

The 	.Options

vector had been introduced a while ago after my suggestion
(see Ross's E-mail below).
.Options$digits is used be default in several  print methods (eg print.lm),
however, deparse(.) e.g., uses options()$width, and not .Options$width.

Another problem is that  .Options
is still not in the documentation (on-line help).
Before one could add it there, we'd need ``the specs''.

I think the (at least my) idea was that

	options(.)  queries or sets elements in the   .Options  list

and all functions -- including the internal ones -- use  .Options.
As far as I know, this is what S does.
Currently, this is NOT the case in R.

Ross said a while ago:

   >>> From: Ross Ihaka <ihaka@stat.auckland.ac.nz>
   >>> Date: Wed, 11 Dec 1996 17:10:59 +1300 (NZDT)
   >>> To: Martin Maechler <maechler@stat.math.ethz.ch>
   >>> Cc: R-testers mailing list <R-testers@stat.math.ethz.ch>
   >>> Subject: R-alpha: options() and .Options -- ?

    Ross> Martin Maechler writes:
    >> This is not a bug report, rather than some remarks as a
    >> "request for comments":
    >>
    >> It is clear that  options( foo = bar )
    >> sets the option and also updates the builtin()  .Options  list :
    >> 
    >> > options(myopt = pi)
    >> > .Options$my
    >> [1] 3.14159265
    >> 
    >> In S-plus, it was (is) possible to use .Options locally in a function
    >> frame in order to just affect some options during evaluation of that
    >> function.

    Ross> I have made some changes so that such local assignments to .Options
    Ross> will work.  The down side is that such assignments will also work at
    Ross> top level with the changes shadowing the real system options.

    Ross> This also may be ok.  It would have the advantage that options would
    Ross> then be preserved from session to session.  Is this a good idea or a
    Ross> bad idea?

----------
Different issue:

> Re(1i)
[1] 2.497599e-307

rather than  0  whereas  Im(as.complex(1)) gives 0 as it should.

- Martin Maechler
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 15:45:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 16:45:50 +0200
Subject: R-alpha: Re:  Re(1i) = 2.4976e-307
In-Reply-To: <9705221441.AA01396@> (message from Martin Maechler on Thu, 22
 May 97 16:41:16 +0200)
Message-ID: <9705221445.AA01404@>

It is really not 'Re',
but the parser for complex constants which is at fault:

> 1i - complex(imag=1)
[1] 2.497599e-307+0i
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May 22 17:22:07 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 22 May 1997 09:22:07 -0700 (PDT)
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <9705221207.AA01336@>
Message-ID: <Pine.SUN.3.95.970522091037.8749A-100000@zen>

> Why do you need it?
> 
> Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
> on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
> It contains quite a bit of implicit documentation on the S-help format.
> I've been using it a few times  more or less successfully.
> 
> YES:	This should come in the  $RHOME/etc/ directory !
> 
> - Martin

Largely because it isn't a very nice script.  The output is tolerable but
not great -- for example it doesn't use some of the proper R headings for
sections and it doesn't hyperlink the SEE ALSO section. These problems
don't really show up in the help() output but are more obvious in HTML. 

Someone (eg me in about a month from now if someone else hasn't done it
first) needs to work on improving it.  I suspect Kurt or his minions are
planning exactly that :-). 

On the related subject of regular expressions, I'm having trouble with the
\1 construction for the last matched expression
(eg  \([a-zA-Z][^:]*\):\1 which I think should match things of the form
blah:blah)
No matter how many extra \ characters I put in it doesn't work.


Thomas Lumley
-----------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 17:26:35 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 18:26:35 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <Pine.SUN.3.95.970522091037.8749A-100000@zen>
References: <9705221207.AA01336@>
 <Pine.SUN.3.95.970522091037.8749A-100000@zen>
Message-ID: <199705221626.SAA06171@aragorn.ci.tuwien.ac.at>

>>>>> Thomas Lumley writes:

>> Why do you need it?
>> 
>> Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
>> on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
>> It contains quite a bit of implicit documentation on the S-help format.
>> I've been using it a few times  more or less successfully.
>> 
>> YES:	This should come in the  $RHOME/etc/ directory !
>> 
>> - Martin

> Largely because it isn't a very nice script.  The output is tolerable but
> not great -- for example it doesn't use some of the proper R headings for
> sections and it doesn't hyperlink the SEE ALSO section. These problems
> don't really show up in the help() output but are more obvious in HTML. 

> Someone (eg me in about a month from now if someone else hasn't done it
> first) needs to work on improving it.  I suspect Kurt or his minions are
> planning exactly that :-).

Yes, that was the idea.  I sort of converted the script to perl today so
that Fritz can start his magic ... we'll see.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 22 17:32:43 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 22 May 1997 18:32:43 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: Thomas Lumley's message of Thu, 22 May 1997 09:22:07 -0700 (PDT)
References: <Pine.SUN.3.95.970522091037.8749A-100000@zen>
Message-ID: <x2n2pnh3h0.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> On the related subject of regular expressions, I'm having trouble with the
> \1 construction for the last matched expression
> (eg  \([a-zA-Z][^:]*\):\1 which I think should match things of the form
> blah:blah)
> No matter how many extra \ characters I put in it doesn't work.

In what connection? In egrep, consider taking some of them out:

$ egrep '([a-zA-Z][^:]*):\1'
blah:blah
blah:blah
a:a
a:a
A.
A:
A:A
A:A
A:AB
A:AB
AB:B
AB:B
AB:AB
AB:AB
AB:A


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Thu May 22 17:52:10 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Thu, 22 May 1997 09:52:10 -0700 (PDT)
Subject: R-alpha: R-beta: regex
In-Reply-To: <x2n2pnh3h0.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970522094711.8749D-100000@zen>

On 22 May 1997, Peter Dalgaard BSA wrote:
> 
> In what connection? In egrep, consider taking some of them out:
> 

I meant the grep() function in R (which needs \ to be quoted)
 grep("([A-Za-z][^:]*):\1","Ac:Ac",value=T)
character(0)
> grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
character(0)
> grep("([A-Za-z][^:]*):\\\1","Ac:Ac",value=T)
character(0)
> 
but
> grep("([A-Za-z][^:]*):","Ac:Ac",value=T)
[1] "Ac:Ac"


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Thu May 22 18:10:52 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Thu, 22 May 1997 12:10:52 -0500 (CDT)
Subject: R-alpha: options(..) vs.  .Options  //  Re(1i) = 2.4976e-307
In-Reply-To: <9705221441.AA01396@> from "Martin Maechler" at May 22, 97 04:41:16 pm
Message-ID: <9705221710.AA05868@nokomis.stat.umn.edu>

Martin Maechler wrote:
> 
> The 	.Options
> 
> vector had been introduced a while ago after my suggestion
> (see Ross's E-mail below).
> .Options$digits is used be default in several  print methods (eg print.lm),
> however, deparse(.) e.g., uses options()$width, and not .Options$width.
> 
> Another problem is that  .Options
> is still not in the documentation (on-line help).
> Before one could add it there, we'd need ``the specs''.
> 
> I think the (at least my) idea was that
> 
> 	options(.)  queries or sets elements in the   .Options  list
> 
> and all functions -- including the internal ones -- use  .Options.
> As far as I know, this is what S does.
> Currently, this is NOT the case in R.
> 

If I understand this right (which may be a big if :-)) this is a bit
tricky.  What S is trying to do is make .Options a dynamically scoped
variable. This seems to work fine from the user perspective, i.e. if I
do

	g<-function(x) print(x)
	f<-function(x) { .Options$digits<-3; g(x) }

then I get the "right thing"

> f(888888888)
[1] 8.89e+08
[1] 888888888

but actually writing your own functions that use .Options is tricky --

	g<-function() .Options$digits
	f<-function() { .Options$digits<-3; g() }

produces

> f()
[1] 7
> 

since the reference to .Options is governed by ordinary scoping rules.
So some convenient way of looking up the closest dynamic binding is
needed -- just referencing .Options in print.lm, for example, won't do
it. Current Splus defines several methods for print and summary that
just reference .Options, but unless some internal magic is being used
for this name, they won't work as expected.

luke



-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 22 18:15:44 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 22 May 1997 19:15:44 +0200
Subject: R-alpha: R-beta: regex
In-Reply-To: Thomas Lumley's message of Thu, 22 May 1997 09:52:10 -0700 (PDT)
References: <Pine.SUN.3.95.970522094711.8749D-100000@zen>
Message-ID: <x2k9krh1hb.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> 
> On 22 May 1997, Peter Dalgaard BSA wrote:
> > 
> > In what connection? In egrep, consider taking some of them out:
> > 
> 
> I meant the grep() function in R (which needs \ to be quoted)
>  grep("([A-Za-z][^:]*):\1","Ac:Ac",value=T)
> character(0)
> > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
> character(0)
> > grep("([A-Za-z][^:]*):\\\1","Ac:Ac",value=T)
> character(0)
> > 
> but
> > grep("([A-Za-z][^:]*):","Ac:Ac",value=T)
> [1] "Ac:Ac"
> 

I strongly suspect that no number of \s will make it work as long as
do_grep() in main/character.c contains this line:

        eflags = REG_NOSUB;



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 22 21:03:56 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 23 May 1997 08:03:56 +1200 (NZST)
Subject: R-alpha: missing warning message
Message-ID: <199705222003.IAA14092@stat1.stat.auckland.ac.nz>

> In R it is possible to write nonsense 

> R> 0.5:4:3:9:8:5
> [1] 0.5 1.5 2.5 3.5 4.5

> and never be warned about it, Splus does the expected thing:

> Splus> 0.5:4:3:9:8:5
> [1] 0.5 1.5 2.5 3.5 4.5
> Warning messages:
> 1: Numerical expression has 4 elements: only the first used in: 0.5:4:3
> 2: Numerical expression has 3 elements: only the first used in: 0.5:4:3:9
> 3: Numerical expression has 9 elements: only the first used in: 0.5:4:3:9:8
> 4: Numerical expression has 8 elements: only the first used in: 0.5:4:3:9:8:5

I'll put a warning in, but ...

This is one place where the recycling rule is violated.  I've thought
for a while about implementing

	m : n

in the following way

	c(m[1]:n[1] , m[2]:n[2] , ...)

with the shorter argument being recycled out to the length of the longer
one.  I have seen at least one application where this extended could
be used.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 22 22:30:31 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 23 May 1997 09:30:31 +1200 (NZST)
Subject: R-alpha: S-help  (and  S-help-to-R-help)
Message-ID: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>

Before you invest too much effort in fancy conversion scripts ...

I really want to change the documentation format to something based on
SGML - this should be much easier to parse than the present m4
macro-based stuff, and allow use to use more sophisticated tools for
the construction and processing of documentation.

Like much of R, the present solution was just a temporary hack ...
But it is something which is getting to the top of the list.

Any filter you create should have a back-end which could be (easily)
adapted to a new format.

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 06:02:04 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 07:02:04 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>
References: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>
Message-ID: <199705230502.HAA00661@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> Before you invest too much effort in fancy conversion scripts ...
> I really want to change the documentation format to something based on
> SGML - this should be much easier to parse than the present m4
> macro-based stuff, and allow use to use more sophisticated tools for
> the construction and processing of documentation.

Nothing fancy.  Thomas' script has a few (minor) problems, and I'd like
to fix them.

> Like much of R, the present solution was just a temporary hack ...
> But it is something which is getting to the top of the list.

> Any filter you create should have a back-end which could be (easily)
> adapted to a new format.

Hmm.  I think it's more like looking into the S help format to figure
out what is going on.  The new one which converts to SGML will perhaps
be somewhere in between converting to LaTeX and to current R help
format.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 06:33:03 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 07:33:03 +0200
Subject: R-alpha: apropos() available
Message-ID: <199705230533.HAA01011@aragorn.ci.tuwien.ac.at>

Martin and I have `written' a function apropos() for finding all objects
with names matching pattern.  I attach code and documentation.  Perhaps
one could include it in the distribution proper.

We are not sure about returning the position in the search list along
with the matching names found.  Martin thinks it should be on by
default, I think it should be off so that the functions does the same as
in Lisp systems ... Perhaps someone else can decide.

-k

*** apropos.R **********************************************************
apropos <- function (pattern) {
  x <- character(0)
  for (i in 1 : length(search()))
    x <- c(x, ls(pos =3D i, pattern =3D pattern))
  x
}

apropos <- function (pattern, where =3D FALSE) {
  ## Give all objects which match  _pattern_.
  ## By	Kurt Hornik & Martin M=E4chler, May 1997.
  x <- character(0)
  for (i in seq(search())) {
    ll <- length(li <- ls(pos =3D i, pattern =3D pattern))
    if (ll)
      if (where)
	x <- c(x, structure(li, names =3D rep(i, ll)))
      else
	x <- c(x, li)
  }
  x
}
*** apropos.d **********************************************************
TITLE(apropos @@ Find all objects with names matching a pattern)
USAGE(apropos(pattern, where =3D FALSE))
ARGUMENTS(
ARG(pattern @@ a regular expression to match against)
ARG(where @@ a logical indicating whether positions in the search list
should also be returned)
)
DESCRIPTION(
LANG(apropos) returns a vector of character strings giving the names of
all objects in the search list matching LANG(pattern).  If LANG(where)
is LANG(TRUE), their position in the search list is returned as their
names attribute.
)
EXAMPLES(
apropos("lm")
apropos("ls")
apropos("lq")
BLANK
# need the `\\'
apropos("\\[")
BLANK
# everything
length(apropos("."))
BLANK
# those starting with `pr'
apropos("^pr")
BLANK
# the 1-letter things
apropos("^.$")
# the 1-2-letter things
apropos("^..?$")
# the 2-to-4 letter things
apropos("^.{2,4}$")
BLANK
# the 8-and-more letter things
apropos("^.{8,}$")
table(nchar(apropos("^.{8,}$")))
)

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May 23 08:51:34 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 23 May 97 09:51:34 +0200
Subject: R-alpha: Re: S-help -- Ultimate doc.== source : $SPLUS/cmd/help.tr & help.nr
In-Reply-To: <199705221607.SAA06102@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Thu, 22 May 1997 18:07:49 +0200)
Message-ID: <9705230751.AA01646@>

Kurt,
if you really want to find out  what things an  S help file can contain,
you must learn some  nroff/troff  [ maybe use 'groff', the GNU one ].

As always, ultimate documentation is == source.
The definition of the S help is in
the two files
	$SPLUS/cmd/help.[nt]r
where nr ^= nroff, i.e.  ASCII   output
      tr ^= troff  i.e.  printed output (e.g via Postscript conversion)

help.tr starts with

.\" @(#)help.tr.pre version 2.33 created 9/22/95
.\" @(#)Copyright (c), 1987, 1995 StatSci, Inc.  All rights reserved.
.\"
.\" This file defines the macros that S-PLUS help files use.  This file
.\" 	was modified by the S-PLUS SETUP script to tailor it to your system.
.\"


The most important  [nt]roff command  here is
.de AB
	which stands for 'define the  AB  macro'
	which will be referenced by
.AB

------------

Further note:	

	S-plus uses a slightly different help file format than
	'vanilla S' from AT&T.

	E.g, they (StatSci) introduced the extra 
	
	.RA  for 'Required ARGUMENTS'
	.OA  for 'Optional Arguments'
	
	where Chambers et al. just use 'ARGUMENTS' which comes
	automatically before the first argument (with  .AG .... ) is set.
	
PPS:  S version 4 uses a COMPLETELY different system.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 13:01:33 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 14:01:33 +0200
Subject: No subject
Message-ID: <199705231201.OAA02114@aragorn.ci.tuwien.ac.at>

Still trying to port Brian's class TB ...

I need to find replacements for seed_in()/seed_out() and unif_rand().
Looks like the first works with GetSeeds()/PutSeeds().  Can anyone help
me with the second one?

THanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Fri May 23 20:17:28 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 23 May 1997 12:17:28 -0700 (PDT)
Subject: R-alpha: R-beta: regex
In-Reply-To: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970523121557.25867B-100000@data>

On 22 May 1997, Peter Dalgaard BSA wrote:

> > > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
> > character(0)

> I strongly suspect that no number of \s will make it work as long as
> do_grep() in main/character.c contains this line:
> 
>         eflags = REG_NOSUB; 

Is this a feature? If so, can it at least be made optional?


Thomas Lumley
------------------------------------------------------+-----
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Sat May 24 00:09:59 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 23 May 1997 16:09:59 -0700 (PDT)
Subject: R-alpha: var() and missing
In-Reply-To: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970523160648.27149A-100000@data>



var() handles missing values in a very strange way. It is not what the
documentation says
> var(c(NA,1:10))
[1] 0
> var(1:10)
[1] 9.166667
This is because sum() handles NA incorrectly
> sum(NA)
[1] 0
> sum(NA,na.rm=T)
[1] 0
> sum(NA,na.rm=F)
[1] 0

Also the documentation gives a pairwise= option to var() which isn't in
the function.


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sat May 24 20:55:28 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 25 May 1997 07:55:28 +1200 (NZST)
Subject: R-alpha: R-beta: regex
Message-ID: <199705241955.HAA26240@stat1.stat.auckland.ac.nz>

Just ignorance on my my part.  I thought that "grep" didn't do substitutions.
If it inhibits backreferences I'll kill it.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sat May 24 21:02:50 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 25 May 1997 08:02:50 +1200 (NZST)
Subject: R-alpha: var() and missing
Message-ID: <199705242002.IAA26269@stat1.stat.auckland.ac.nz>

> var() handles missing values in a very strange way. It is not what the
> documentation says
> > var(c(NA,1:10))
> [1] 0
> > var(1:10)
> [1] 9.166667
> This is because sum() handles NA incorrectly
> > sum(NA)
> [1] 0
> > sum(NA,na.rm=T)
> [1] 0
> > sum(NA,na.rm=F)
> [1] 0

This is a bug brought in by changes to complex arithmetic.  I have a
fix and will have a patch (later today I hope).

> Also the documentation gives a pairwise= option to var() which isn't in
> the function.

I think the interpreted front end doesn't match the real back-end.
I'll change it.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Sun May 25 14:35:04 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sun, 25 May 1997 15:35:04 +0200
Subject: R-alpha: generic write()
Message-ID: <199705251335.PAA08691@aragorn.ci.tuwien.ac.at>

Attached is a first shot at a generic write with my `old' write.table as
write.data.frame, suitably modified.  There is also a stupid generic
latex function, which is just there because it illustrates that the
extra arguments sep and eol are useful.

In playing with it, I noticed a few `problems'.

* The documentation for factor() says,

	If exclude is set to a zero length vector, then any NA values in
	x are used for form a new level for the factor.  This means that
	there will be no NA values in the result.

Perhaps I don't really understand this, but

R> x <- factor(c(1:3, NA), exclude=numeric(0))
R> x
[1]  1  2  3 NA
R> levels(x)
[1] "1" "2" "3"

???

* coerce.c has two error messages of the form

	error("use \"factor\", \"ordered\", \"cut\" or \"code\" to create factors\n");

but there is no function `code'.

* cat() is a bit inconsistent:

R> cat(x, sep = "&")
1&2&3&4R> cat(x, sep = "&\n")
1&
2&
3&
4
R>

Actually, a final newline is added whenever sep contains a newline.
>From src/main/builtin.c:

        nlsep = 0;
        for (i = 0; i < LENGTH(sepr); i++)
                if (strstr(CHAR(STRING(sepr)[i]), "\n")) nlsep = 1;

	...

        if ((pwidth != INT_MAX) || nlsep)
                Rprintf("\n");

I am not sure this is the right thing to do.

(In particular, it makes it rather messy to incrementally build data
files with `explicit' end-of-line strings (such as "\\") by appending
via cat().)

* I am not sure what should happen with names or dimnames when writing.

* I am also not sure what the optional argument quote should do.  Should
it quote UNCONDITIONALLY, or only the character strings?

-k

***********************************************************************
write <- function(x, file = "data", ...)  UseMethod("write")

write.default <-
function(x, file = "", append = FALSE, quote = FALSE, sep = " ", eol = "\n",
	 na = NA, ncolumns = if (is.character(x)) 1 else 5, ...) {
  if (is.matrix(x)) {
    write.data.frame(x, append = append, quote = quote, sep = sep,
		     eol = eol, na = na, col.names = FALSE, ...) 
  }
  else {
    if (is.factor(x))
      x <- levels(x)[x]
    else
      x <- as.vector(x)
    if (is.vector(x)) {
      x[is.na(x)] <- na
      if (quote)
	x <- paste("\"", x, "\"", sep = "")
      cat(x, file = file, sep = c(rep(sep, ncolumns - 1), eol),
	  append = append)
    }
    else
      stop("No suitable write method available")
  }
}

write.data.frame <-
function(x, file = "", append = FALSE, quote = FALSE, sep = " ", eol = "\n",
	 na = NA, row.names = TRUE, col.names = TRUE)
{
  if (is.data.frame(x) && is.logical(quote) && quote)
    quote <- which(unlist(lapply(x, is.character)))
  x <- as.matrix(x)
  p <- ncol(x)
  d <- dimnames(x)
  x[is.na(x)] <- na
  if (is.logical(quote))
    quote <- if (quote) 1 : p else NULL
  else if (is.numeric(quote)) {
    if (any(quote < 1 | quote > p))
      stop("invalid numbers in quote")
  }
  else
    stop("invalid quote specification")
      
  if (is.logical(row.names)) {
    if (row.names)
      x <- cbind(d[[1]], x)
  }
  else {
    row.names <- as.character(row.names)
    if (length(row.names) == nrow(x))
      x <- cbind(row.names, x)
    else
      stop("invalid row.names specification")
  }
  if (!is.null(quote) && (p < ncol(x)))
    quote <- c(0, quote) + 1

  if (is.logical(col.names))
    col.names <- if (col.names) d[[2]] else NULL
  else {
    col.names <- as.character(col.names)
    if (length(col.names) != p)
      stop("invalid col.names specification")
  }
  if (!is.null(col.names)) {
    if (append)
      warning("appending column names to file")
    if (!is.null(quote))
      col.names <- paste("\"", col.names, "\"", sep = "")
    cat(col.names, file = file, sep = rep(sep, p - 1), append = append)
    cat(eol, file = file, append = TRUE)
    append <- TRUE
  }

  for (i in quote)
    x[, i] <- paste("\"", x[, i], "\"", sep = "")

  cat(t(x), file = file, sep = c(rep(sep, ncol(x) - 1), eol),
      append = append)
}

latex <- function(x, file = "", ...)  UseMethod("latex")

latex.default <- 
function(x, file = "", ...) {
  write(x, file = file, sep = " & ", eol = " \\\\\n", ...)
}
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 20:54:59 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 07:54:59 +1200 (NZST)
Subject: R-alpha: generic write()
Message-ID: <199705251954.HAA29904@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:

>  Attached is a first shot at a generic write with my `old' write.table as
>  write.data.frame, suitably modified.  There is also a stupid generic
>  latex function, which is just there because it illustrates that the
>  extra arguments sep and eol are useful.
>
>  In playing with it, I noticed a few `problems'.
>
>  * The documentation for factor() says,
>
> 	If exclude is set to a zero length vector, then any NA values in
> 	x are used for form a new level for the factor.  This means that
> 	there will be no NA values in the result.
>
>  Perhaps I don't really understand this, but
>
>  R> x <- factor(c(1:3, NA), exclude=numeric(0))
>  R> x
>  [1]  1  2  3 NA
>  R> levels(x)
>  [1] "1" "2" "3"

Looks like a bug to me ...

>  * coerce.c has two error messages of the form
>
> 	error("use \"factor\", \"ordered\", \"cut\" or \"code\" to create factors\n");
>
>  but there is no function `code'.

A VERY old (pre- 0.1) error message

>  * cat() is a bit inconsistent:
>
>  R> cat(x, sep = "&")
>  1&2&3&4R> cat(x, sep = "&\n")
>  1&
>  2&
>  3&
>  4
>  R>
>
>  Actually, a final newline is added whenever sep contains a newline.
>  >From src/main/builtin.c:
>
>         nlsep = 0;
>         for (i = 0; i < LENGTH(sepr); i++)
>                 if (strstr(CHAR(STRING(sepr)[i]), "\n")) nlsep = 1;
>
> 	...
>
>         if ((pwidth != INT_MAX) || nlsep)
>                 Rprintf("\n");
>
>  I am not sure this is the right thing to do.
>
>  (In particular, it makes it rather messy to incrementally build data
>  files with `explicit' end-of-line strings (such as "\\") by appending
>  via cat().)
 
I will look at this a bit more (and compare with the AT&T prototype).

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Sun May 25 21:55:10 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Mon, 26 May 1997 08:55:10 +1200 (NZST)
Subject: R-alpha: cat
Message-ID: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>

Kurt,
  here's what S does (I recall going to some effort to duplicate the,
at times, seemingly unusual behaviour of cat)
S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
S : Copyright AT&T.
Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
Working data will be in /users/rdev/rgentlem/.Data 
>  x <- factor(c(1:3, NA), exclude=numeric(0))
> x
[1] 1  2  3  NA
> levels(x)
[1] "1"  "2"  "3"  "NA"
> cat(x, sep = "&")
1&2&3&4> cat(x, sep = "&\n")
1&
2&
3&
4
>

so, the behaviour of cat is the same (whether it's correct or not .....)

robert
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:01:12 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:01:12 +1200 (NZST)
Subject: R-alpha: Re:  Re(1i) = 2.4976e-307
In-Reply-To: <9705221445.AA01404@>
References: <9705221441.AA01396@>
 <9705221445.AA01404@>
Message-ID: <199705252201.KAA00938@stat1.stat.auckland.ac.nz>

Martin Maechler writes:
 > It is really not 'Re',
 > but the parser for complex constants which is at fault:
 > 
 > > 1i - complex(imag=1)
 > [1] 2.497599e-307+0i

This is an error in the function mkComplex.  It sets the imaginary
part, but leaves the real part uninitialized.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:05:43 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:05:43 +1200 (NZST)
Subject: R-alpha: R-beta: regex
In-Reply-To: <Pine.SUN.3.95.970523121557.25867B-100000@data>
References: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
 <Pine.SUN.3.95.970523121557.25867B-100000@data>
Message-ID: <199705252205.KAA01001@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > On 22 May 1997, Peter Dalgaard BSA wrote:
 > 
 > > > > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
 > > > character(0)
 > 
 > > I strongly suspect that no number of \s will make it work as long as
 > > do_grep() in main/character.c contains this line:
 > > 
 > >         eflags = REG_NOSUB; 
 > 
 > Is this a feature? If so, can it at least be made optional?

I have changed it to:

	eflags = 0;

Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:09:47 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:09:47 +1200 (NZST)
Subject: R-alpha: var() and missing
In-Reply-To: <Pine.SUN.3.95.970523160648.27149A-100000@data>
References: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
 <Pine.SUN.3.95.970523160648.27149A-100000@data>
Message-ID: <199705252209.KAA01030@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > 
 > 
 > var() handles missing values in a very strange way. It is not what the
 > documentation says
 > > var(c(NA,1:10))
 > [1] 0
 > > var(1:10)
 > [1] 9.166667
 > This is because sum() handles NA incorrectly
 > > sum(NA)
 > [1] 0
 > > sum(NA,na.rm=T)
 > [1] 0
 > > sum(NA,na.rm=F)
 > [1] 0
 > 
 > Also the documentation gives a pairwise= option to var() which isn't in
 > the function.

I did want to move toward an implementation which is more like
"na.action", rather than "na.rm".  Often computations based on
correlations based on all observations which are complete for pairs of
variables do make sense.

"var" seems to have been skipped.  What is the right strategy here?
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 08:02:10 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 09:02:10 +0200
Subject: R-alpha: 1:n is not integer
Message-ID: <9705270702.AA02619@>


This is from Snews of yesterday 

Snews> but the : operator creates integers as in
Snews> 
Snews> > is.integer(1:10)
Snews> [1] T
Snews> 
Snews> and even in
Snews> 
Snews> > is.integer(1:1)
Snews> [1] T

which reminds me of bug report  I had sent a while ago,
I think in pre-alpha times:

 MM>  In R,  1:n is   double (aka 'real') and not integer.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 16:29:15 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 17:29:15 +0200
Subject: R-alpha: signif( small , d) gives NA
Message-ID: <9705271529.AA02767@>

signif(.) is a <primitive> function.

Unfortunately, I couldn't even find WHERE in the source,
  signif(.) is defined.

Here are the symptoms:

xmin <- .Machine $ double.xmin
signif(xmin,3) #--> NA

umach <- unlist(.Machine)[paste("double.x", c("min","max"), sep='')]
for(dig in 1:10) {cat("dig=",dig,": "); print(signif(umach, digits = dig))}


-------
Why do I "complain"?  
	-- it breaks  str(.Machine), now that I've improved 'str'.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 27 16:56:30 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 27 May 1997 17:56:30 +0200
Subject: R-alpha: signif( small , d) gives NA
In-Reply-To: Martin Maechler's message of Tue, 27 May 97 17:29:15 +0200
References: <9705271529.AA02767@>
Message-ID: <x2bu5wyklt.fsf@bush.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> 
> signif(.) is a <primitive> function.
> 
> Unfortunately, I couldn't even find WHERE in the source,
>   signif(.) is defined.
>

In src/math/prec.c

> Here are the symptoms:
> 
> xmin <- .Machine $ double.xmin
> signif(xmin,3) #--> NA

Here is the disease:

> xmin
[1] 2.225074e-308
> xmin * 1e310
[1] NA

- and the cure:

> xmin * 1e300 * 1e10
[1] 222.5074

I'll leave it to you (or Ross) to find a clean and general way of
fixing the source...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 17:20:44 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 18:20:44 +0200
Subject: R-alpha: patch for formatC(..char.vector..)
Message-ID: <9705271620.AA02863@>

Apply this patch in  
	src/library/base/funs/


--- 049orig/format~	Thu Mar  6 16:59:56 1997
+++ format	Tue May 27 18:11:27 1997
@@ -22,8 +22,11 @@
 			width <- -width
 		}
 		pad <- sapply(pmax(0, width - nc), bl.string)
-		## for R <= 0.16 (incompatibility to S):
-		if(is.list(pad)) pad <- ""
+		## for R <= 0.49 (incompatibility to S), pad may be list:
+		if(is.list(pad)) {
+			pad[sapply(pad,length) == 0] <- list("")
+			pad <- unlist(pad)
+		}
 		if (flag == "-") 
 			return(paste(x, pad, sep = ""))
 		else    return(paste(pad, x, sep = ""))

AFTER applying the patch,

	tst.ch <- c("a", "ABC", "XYZ", "dd")
	cbind(formatC(tst.ch, wid = 3))

works okay.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 28 12:35:41 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 28 May 1997 13:35:41 +0200
Subject: R-alpha: cat
In-Reply-To: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>
References: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>
Message-ID: <199705281135.NAA18116@aragorn.ci.tuwien.ac.at>

>>>>> Robert Gentleman writes:

> Kurt,
>   here's what S does (I recall going to some effort to duplicate the,
> at times, seemingly unusual behaviour of cat)
> S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
> S : Copyright AT&T.
> Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
> Working data will be in /users/rdev/rgentlem/.Data 
>> x <- factor(c(1:3, NA), exclude=numeric(0))
>> x
> [1] 1  2  3  NA
>> levels(x)
> [1] "1"  "2"  "3"  "NA"
>> cat(x, sep = "&")
> 1&2&3&4> cat(x, sep = "&\n")
> 1&
> 2&
> 3&
> 4
>> 

> so, the behaviour of cat is the same (whether it's correct or not
> .....)

Yes, I noticed that too.  Perhaps R could add an argument which toggles
this behavior?  (Or is there an easy other way to get what I want?)

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 29 05:01:37 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 29 May 1997 16:01:37 +1200 (NZST)
Subject: R-alpha: 1:n is not integer
In-Reply-To: <9705270702.AA02619@>
References: <9705270702.AA02619@>
Message-ID: <199705290401.QAA15396@stat1.stat.auckland.ac.nz>

Martin Maechler writes:
 > 
 > This is from Snews of yesterday 
 > 
 > Snews> but the : operator creates integers as in
 > Snews> 
 > Snews> > is.integer(1:10)
 > Snews> [1] T
 > Snews> 
 > Snews> and even in
 > Snews> 
 > Snews> > is.integer(1:1)
 > Snews> [1] T
 > 
 > which reminds me of bug report  I had sent a while ago,
 > I think in pre-alpha times:
 > 
 >  MM>  In R,  1:n is   double (aka 'real') and not integer.

Is this a bug or feature.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 29 05:04:34 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 29 May 1997 16:04:34 +1200 (NZST)
Subject: R-alpha: 1:n is not integer
In-Reply-To: <199705290401.QAA15396@stat1.stat.auckland.ac.nz>
References: <9705270702.AA02619@>
 <199705290401.QAA15396@stat1.stat.auckland.ac.nz>
Message-ID: <199705290404.QAA15463@stat1.stat.auckland.ac.nz>

Ross Ihaka writes:
 > Is this a bug or feature.

Gaak!  Hit the wrong button.  Its on the list for changing.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May 30 17:24:15 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 30 May 97 18:24:15 +0200
Subject: R-alpha: bug report  and patch  for   rep(.)
Message-ID: <9705301624.AA03924@>


rep(1,0) gives	'Error: subscript out of bounds'

Here is the new  ../src/library/base/funs/rep	
		    -------------------------
(which contains two patches, the first of which I posted on May 20):

rep <- function(x, times, length.out)
{
	if (length(x) == 0)
		return(x)
	if (missing(times))
		times <- ceiling(length.out/length(x))
	r <- .Internal(rep(x,times))
	if(!is.null(nm <- names(x))) names(r) <- .Internal(rep(nm, times))
	if (!missing(length.out))
		return(r[if(length.out>0) 1:length.out else integer(0)])
	return(r)
}

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May  1 16:47:36 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 1 May 97 17:47:36 +0200
Subject: R-alpha: ==NULL
In-Reply-To: <Pine.SUN.3.95.970430093849.302A-100000@zen> (message from Thomas
 Lumley on Wed, 30 Apr 1997 09:42:52 -0700 (PDT))
Message-ID: <9705011547.AA01745@>

>>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    Tom> Any comparison with NULL generates an error Error: comparison is
    Tom> possible only for vector types whereas in S(-PLUS) it gives NA,
    Tom> which seems more sensible.

    Tom> Along similar lines, comparison with a length 0 vector returns
    Tom> logical(0) in R but NA in S.

Is n't  logical(0)  more  logical than  NA ?

I agree that it would be best  (convenience)
if   'NULL==1' returned the same as 'numeric(0)==1'.

At the moment, I don't see why compatibility with S  should be important
here:
		if( NULL == anything)  
or, e.g.,	if( numeric(0) == numeric(0) )

give an error anyway, i.e., you have to test for length 0 _anyway_
in the cases where one comparison argument may have zero length.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May  1 17:28:48 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 1 May 1997 09:28:48 -0700 (PDT)
Subject: R-alpha: ==NULL
In-Reply-To: <9705011547.AA01745@>
Message-ID: <Pine.SUN.3.95.970501092039.11571A-100000@avon>

On Thu, 1 May 1997, Martin Maechler wrote:

> >>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:
	^^^^^ Aaargh! Not "Tom", please.
> 
>     Tom> Any comparison with NULL generates an error Error: comparison is
>     Tom> possible only for vector types whereas in S(-PLUS) it gives NA,
>     Tom> which seems more sensible.
> 
>     Tom> Along similar lines, comparison with a length 0 vector returns
>     Tom> logical(0) in R but NA in S.
> 
> Is n't  logical(0)  more  logical than  NA ?

I didn't (previously) make any comment on this -- I only said that NA was
more logical than an error message.  However, the advantage of returning
NA is that NA | TRUE is TRUE, NA & FALSE is FALSE, which doesn't happen
with logical(0). Also, from a compatibility point of view one of them is
tested with is.na(), the other with length(), so it can matter which one
you use.  Of course no-one should deliberately write code where it
matters, but these things happen. 

It seems in fact that logical(0) | TRUE causes R to freeze (R0.49,
sparc solaris).


Thomas Lumley
------------------------------------------------------+-----
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May  1 21:28:56 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 01 May 1997 22:28:56 +0200
Subject: R-alpha: eigen()
Message-ID: <x2lo5zgcmv.fsf@bush.kubism.ku.dk>


eigen() seems to work for symmetric matrices only. This is out of sync
with the help file.

> trpr.37
           0         1         2         3         4
0 1.00000000 0.0000000 0.0000000 0.0000000 0.0000000
1 0.44444444 0.5555556 0.0000000 0.0000000 0.0000000
2 0.02439024 0.2439024 0.7317073 0.0000000 0.0000000
3 0.00000000 0.0000000 0.2307692 0.7692308 0.0000000
4 0.00000000 0.0000000 0.0000000 0.3636364 0.6363636
> eigen(trpr.37)
$values
[1] 0.1760338 0.3173947 0.7351695 1.1361504 1.3281087

$vectors
           [,1]        [,2]       [,3]       [,4]      [,5]
[1,] -0.3707705 -0.27063913 -0.3559571  0.3273765 0.7452536
[2,]  0.7110188  0.41060304  0.1696518  0.1176558 0.5321961
[3,] -0.4307468  0.09222746  0.7735674 -0.3164802 0.3276966
[4,]  0.3249070 -0.57094755 -0.1300796 -0.7136115 0.2056509
[5,] -0.2566594  0.65090138 -0.4787334 -0.5192116 0.1081065

--Huh? 0,0,0,0,1 should be an eigenvector with e.v. 0.6363636.

> eigen(t(trpr.37))
$values
[1] 0.5555556 0.6363636 0.7317073 0.7692308 1.0000000

$vectors
     [,1] [,2] [,3] [,4] [,5]
[1,]    0    0    0    0    1
[2,]    1    0    0    0    0
[3,]    0    0    1    0    0
[4,]    0    0    0    1    0
[5,]    0    1    0    0    0

-- Doesn't look right, check:

> t(trpr.37)%*%eigen(t(trpr.37))$vectors
       [,1]      [,2]       [,3]      [,4] [,5]
0 0.4444444 0.0000000 0.02439024 0.0000000    1
1 0.5555556 0.0000000 0.24390244 0.0000000    0
2 0.0000000 0.0000000 0.73170732 0.2307692    0
3 0.0000000 0.3636364 0.00000000 0.7692308    0
4 0.0000000 0.6363636 0.00000000 0.0000000    0

-- which is obviously not proportional to the "eigenvectors". What
happens is that the matrices get symmetrified by duplicating the lower
triangle onto the upper one.

BTW. Who was it who talked about matrix exponentials a while back? I
could use such code now...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Fri May  2 05:34:19 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Fri, 2 May 1997 16:34:19 +1200 (NZST)
Subject: R-alpha: ==NULL
Message-ID: <199705020434.QAA00772@stat3.stat.auckland.ac.nz>

Well, we thought
  logical(0) & T should return logical(0)
  logical(0) | T should return logical(0)

  already we have NA | T returns T
             and  NA & T returns NA


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May  2 10:28:11 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 2 May 97 11:28:11 +0200
Subject: R-alpha: ==NULL
In-Reply-To: <Pine.SUN.3.95.970501092039.11571A-100000@avon> (message from
 Thomas Lumley on Thu, 1 May 1997 09:28:48 -0700 (PDT))
Message-ID: <9705020928.AA02005@>

>>>>> "ThLu" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    ThLu> On Thu, 1 May 1997, Martin Maechler wrote:
    >> >>>>> "Tom" == Thomas Lumley <thomas@biostat.washington.edu> writes:
    ThLu>    ^^^^^ Aaargh! Not "Tom", please.

Excuse me!

    >> ....

    >>  Is n't logical(0) more logical than NA ?

    ThLu> I didn't (previously) make any comment on this -- I only said
    ThLu> that NA was more logical than an error message.  However, the
    ThLu> advantage of returning NA is that NA | TRUE is TRUE, NA & FALSE
    ThLu> is FALSE, which doesn't happen with logical(0). Also, from a
    ThLu> compatibility point of view one of them is tested with is.na(),
    ThLu> the other with length(), so it can matter which one you use.  Of
    ThLu> course no-one should deliberately write code where it matters,
    ThLu> but these things happen.

Ok, given the above argument, returning NA is logical, too.
However, I'd also argue that  
	logical(0) | TRUE	-> TRUE
	logical(0) & FALSE      -> FALSE

	logical(0) & TRUE	-> logical(0)
	logical(0) | FALSE      -> logical(0)

    ThLu> It seems in fact that logical(0) | TRUE causes R to freeze
    ThLu> (R0.49, sparc solaris).

Yes:

> logical(0) | TRUE
Warning in logical(0) | TRUE : longer object length
        is not a multiple of shorter object length
Floating exception
~~~~~~~~~~~~~~~~~~ [and 'core' dump]
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From nobu@psrc.isac.co.jp  Sun May  4 09:27:10 1997
From: nobu@psrc.isac.co.jp (Nobuhiro Yasutomi)
Date: Sun, 04 May 1997 17:27:10 +0900
Subject: R-alpha: abline not recognized coef member of list
Message-ID: <9705040827.AA06356@derrida.psrc.isac.co.jp>

Hello, R developers.

  I found a little different behavior of R with S.

  at R-0.49:
    > a
    [1] 12 23 22 34 44 54 55 70 78
    > plot(a)
    > abline(lsfit(seq(1,len=length(a)), a))
    Error: no applicable method for "coefficients"

  at S (from AT&T '92) result draw coefficient line without error.
Then I think to need define a function as followed:

    coefficients.default <- function(x) x$coef

---
Nobuhiro Yasutomi, ISAC, Inc.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May  7 13:28:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 7 May 97 14:28:16 +0200
Subject: R-alpha: contr.helmert: bug (??) don't have the SAME problem
In-Reply-To: <x27mhbmrbw.fsf@bush.kubism.ku.dk> (message from Peter Dalgaard
 BSA on 07 May 1997 13:53:07 +0200)
Message-ID: <9705071228.AA01474@>

[I diverged to  R-devel]

Peter, I cannot reproduce your bug
I can type

	solve(cbind(c(1,1,1,1),contr.helmert(4)))

many times, and never get an error.
Also,

 for(n in 2:7) { 
  A <- cbind(rep(1,n), contr.helmert(n)); print(A); print(solve(A),digits=4)}

is just fine.

But then I do

> version
$platform
[1] "sparc-sun-solaris2.5"

$arch
[1] "sparc"

$os
[1] "solaris2.5"

$system
[1] "sparc, solaris2.5"

$status
[1] "Beta"

$status.rev
[1] "0"

$major
[1] "0"

$minor
[1] "49"

$year
[1] "1997"

$language
[1] "R"


Process R segmentation violation at Wed May  7 14:22:57 1997
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

And this seems reproducible now.
Also under SunOS4 gcc (above was Solaris, Sun's cc).

Martin
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Wed May  7 15:10:03 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 07 May 1997 16:10:03 +0200
Subject: R-alpha: Re: contr.helmert: bug (??) don't have the SAME problem
In-Reply-To: Martin Maechler's message of Wed, 7 May 97 14:28:16 +0200
References: <9705071228.AA01474@>
Message-ID: <x24tcfmkzo.fsf@bush.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> 
> [I diverged to  R-devel]
> 
> Peter, I cannot reproduce your bug
> I can type
> 
> 	solve(cbind(c(1,1,1,1),contr.helmert(4)))
> 
> many times, and never get an error.
...
> Process R segmentation violation at Wed May  7 14:22:57 1997
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Also, it seems to behave differently in different circumstances. When
I reported it, I had started R from a read-only directory. In my home
directory, I get this:

> A<-contr.helmert(4)
> X<-cbind(c(1,1,1,1),A)
Error: Unimplemented feature in duplicate
> ls()
Error: Unimplemented feature in duplicate
> > ls
Error: Unimplemented feature in deparse2buff

Can you say "random memory overwrite"?

<imagine long and arduous gdb session here>

In main/bind.c:753, I see
STRING(CADR(dn))[j++] = blank;

Later on, during garbage collection, the same memory location gets
marked, setting a bit in the pointer, which gets accessed a split
second later, and... kerunch! 

I suspect that should have said ...=duplicate(blank)  , right? Or is
it the marking process in gcc. Hmm... not sure I got it straight
there, but somehow the "blank" value, which is a SEXP (aka *SEXPREC)
is getting treated as a SEXPREC.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May  7 16:00:24 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 7 May 1997 08:00:24 -0700 (PDT)
Subject: R-alpha: Re: contr.helmert bug
In-Reply-To: <x24tcfmkzo.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970507075642.2722B-100000@zen>


I have a probably related problem. Sporadically, an attempt to do

a[,1,1,drop=F]

or similar subsetting on a 3-d matrix causes a segfault at line 83 of
attrib.c.  In a previous version this happened reliably when dimensions
were lost from multi-d arrays and was due to incorrect handling of the
dimnames attributes which crashed attrib.c at that point when the dimnames
were accessed.

Is the same sort of thing happening again?


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Wed May  7 16:25:49 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 07 May 1997 17:25:49 +0200
Subject: R-alpha: cbind/memory-bug, (was Re: contr.helmert bug)
In-Reply-To: Thomas Lumley's message of Wed, 7 May 1997 08:00:24 -0700 (PDT)
References: <Pine.SUN.3.95.970507075642.2722B-100000@zen>
Message-ID: <x2207jmhhe.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> I have a probably related problem. Sporadically, an attempt to do
> 
> a[,1,1,drop=F]
> 
> or similar subsetting on a 3-d matrix causes a segfault at line 83 of
> attrib.c.  In a previous version this happened reliably when dimensions
> were lost from multi-d arrays and was due to incorrect handling of the
> dimnames attributes which crashed attrib.c at that point when the dimnames
> were accessed.
> 
> Is the same sort of thing happening again?

Not at all unlikely. As far as I can see, this doesn't really have
anything to do with contr.helmert, but with cbind, dimnames, and
garbage collection. Contr.helmert only comes in due to the fact that
it provokes a garbage collection at a critical time. Your examples
don't involve the garbage collector, but it might still tickle the
same bug...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 05:32:48 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 8 May 1997 16:32:48 +1200 (NZST)
Subject: R-alpha: Equations in Plots
Message-ID: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>

Paul Murrell and I are making some progress with making mathematical
expressions available in graphs.  The idea is to use R expressions to
represent the mathematical expressions.  So far we have (or will soon
have):

	R		LaTeX

	x^i		x^i
	x[i]		x_i
	alpha		\alpha
	Alpha		\Alpha
	hat(x)		\hat{x}	\widehat{x}
	bar(x)		\bar{x} \overline{x}
	x+y		x+y
	x-y		x-y
	x/y		x/y
	(x)		(x)
	{x}		{x}
	frac(x,y)	\frac{x}{y}
	cdots		\cdots
	ldots		\ldots
	
We are wondering how far to go with this process.  Does the above
cover what people want, or are there important omitted features
(we don't really want to do all of TeX).

We are prototyping this in lisp and it will be a little while before
it finds its way onto R.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 05:34:27 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 8 May 1997 16:34:27 +1200 (NZST)
Subject: R-alpha: Memory errors and cbind
Message-ID: <199705080434.QAA12659@stat1.stat.auckland.ac.nz>

Robert and I think we have a fix for the memory errors which are
happening with cbind.  I am getting a largish patch ready for this and
a range of other problems.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May  8 16:52:48 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 8 May 1997 08:52:48 -0700 (PDT)
Subject: R-alpha: Equations in Plots
In-Reply-To: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970508085100.3538A-100000@zen>

On Thu, 8 May 1997, Ross Ihaka wrote:

> Paul Murrell and I are making some progress with making mathematical
> expressions available in graphs.  The idea is to use R expressions to
> represent the mathematical expressions.  So far we have (or will soon
> have):
<things> 	
> We are wondering how far to go with this process.  Does the above
> cover what people want, or are there important omitted features
> (we don't really want to do all of TeX).
> 
I would really like to have the whole Greek alphabet or at least rho, mu
sigma and chi.


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Thu May  8 17:52:28 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Thu, 8 May 1997 11:52:28 -0500 (CDT)
Subject: R-alpha: machine-independent .Rdata
Message-ID: <9705081652.AA11157@nokomis.stat.umn.edu>

If a move toward machine-independent representation seems reasonable,
it may be worth looking at some of the binary data exchange formats
used by nasa and others,

	CDF http://nssdc.gsfc.nasa.gov/cdf/cdf_home.html
	netCDF http://www.unidata.ucar.edu/packages/netcdf/index.html
	HDF http://hdf.ncsa.uiuc.edu/

There may also be something useful in the "Scientific Data Format
Information FAQ"
(http://www.cv.nrao.edu/fits/traffic/scidataformats/faq.html).

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 22:49:39 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 May 1997 09:49:39 +1200 (NZST)
Subject: R-alpha: Equations in Plots
In-Reply-To: <Pine.SUN.3.95.970508085100.3538A-100000@zen>
References: <199705080432.QAA12631@stat1.stat.auckland.ac.nz>
 <Pine.SUN.3.95.970508085100.3538A-100000@zen>
Message-ID: <199705082149.JAA16280@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > I would really like to have the whole Greek alphabet or at least rho, mu
 > sigma and chi.

I don't see a smiley so I'll bite ...  When I said "alpha" I meant by
implication the entire greek alphabet (upper and lower case).  I was
really asking if it would be a problem that we don't have big
"operators" like \sum, \prod, \lim, \int etc.  Expressions this
complex are probably better banished to a caption.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May  8 22:56:04 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 9 May 1997 09:56:04 +1200 (NZST)
Subject: R-alpha: machine-independent .Rdata
In-Reply-To: <9705081652.AA11157@nokomis.stat.umn.edu>
References: <9705081652.AA11157@nokomis.stat.umn.edu>
Message-ID: <199705082156.JAA16354@stat1.stat.auckland.ac.nz>

Luke Tierney writes:
 > If a move toward machine-independent representation seems reasonable,
 > it may be worth looking at some of the binary data exchange formats
 > used by nasa and others,
 > 
 > 	CDF http://nssdc.gsfc.nasa.gov/cdf/cdf_home.html
 > 	netCDF http://www.unidata.ucar.edu/packages/netcdf/index.html
 > 	HDF http://hdf.ncsa.uiuc.edu/
 > 
 > There may also be something useful in the "Scientific Data Format
 > Information FAQ"
 > (http://www.cv.nrao.edu/fits/traffic/scidataformats/faq.html).

I've certainly given this and xdr the odd microsecond of thought.  A
platform independent data format would be very nice.  If someone would
like to look at this - or assign it as homework to a student (mine's
doing equations in plots :-) it would be very useful.  You don't have
to plug it into R, just find out what's invoved.

I'm about to be faced with a third year data analysis course with 100+
students so it won't be me ...
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May  9 14:38:33 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 9 May 97 15:38:33 +0200
Subject: R-alpha: R-0.49 / S-plus: "default argument evaluation" bugs and woes
Message-ID: <9705091338.AA02212@>


There is a problem with  'default argument evaluation'
when I use an existing function name as argument name :

sintest <- function(x, y = 2, sin= sin(pi/4))
{
  ## Purpose: Test of   "default argument evaluation"
  ## -------- Fails for  R-0.49.  Martin Maechler, Date:  9 May 97.
  c(x=x, y=y, sin=sin)
}

## R-0.49:
R> sintest(1)
##> Error in sintest(1) : recursive default argument reference

## S-plus 3.4  (being 100% ok):
S> sintest(1)
  x y       sin 
  1 2 0.7071068
 Warning messages:
   looking for function "sin", ignored local non-function in: sintest(1)

-------------------------------------------------------
The following shows bugs, both in R and S:

sintest2 <- function(x ,y = 2)
{
  ## Purpose: Test of   "default argument evaluation"
  ## -------- Fails for  S-plus 3.4.  Martin Maechler, Date:  9 May 97.
  c(x=x, y=y, sin=sin)
}

R> sintest2(1)
[[1]]
[1] 1

[[2]]
[1] 2

[[3]]
<primitive: sin>

--------------- is almost okay, 
		the buglet being that the names have been dropped from the list.

But watch this:
S> sintest2(1)
function(x = 1, y = 2, sin.x)
sin2 = .Internal(sin(x), "do_math", T, 109)

--- returning a function 

	((now we see, why S's way of treating functions as
	  lists sometimes badly sucks)).
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Fri May  9 15:52:13 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Fri, 9 May 1997 09:52:13 -0500 (CDT)
Subject: R-alpha: R-0.49 / S-plus: "default argument evaluation" bugs and woes
In-Reply-To: <9705091338.AA02212@> from "Martin Maechler" at May 9, 97 03:38:33 pm
Message-ID: <9705091452.AA24334@nokomis.stat.umn.edu>

Martin Maechler wrote:
> 
> 
> There is a problem with  'default argument evaluation'
> when I use an existing function name as argument name :
> 
> sintest <- function(x, y = 2, sin= sin(pi/4))
> {
>   ## Purpose: Test of   "default argument evaluation"
>   ## -------- Fails for  R-0.49.  Martin Maechler, Date:  9 May 97.
>   c(x=x, y=y, sin=sin)
> }
> 
> ## R-0.49:
> R> sintest(1)
> ##> Error in sintest(1) : recursive default argument reference
> 
> ## S-plus 3.4  (being 100% ok):
> S> sintest(1)
>   x y       sin 
>   1 2 0.7071068
>  Warning messages:
>    looking for function "sin", ignored local non-function in: sintest(1)
> 
> -------------------------------------------------------
> The following shows bugs, both in R and S:
> 
> sintest2 <- function(x ,y = 2)
> {
>   ## Purpose: Test of   "default argument evaluation"
>   ## -------- Fails for  S-plus 3.4.  Martin Maechler, Date:  9 May 97.
>   c(x=x, y=y, sin=sin)
> }
> 
> R> sintest2(1)
> [[1]]
> [1] 1
> 
> [[2]]
> [1] 2
> 
> [[3]]
> <primitive: sin>
> 

For better or worse, S and R allow default expressions to contain
references variables that are (or rather may be) created in the
function body, so (in R and Splus)

> x<-1
> f<-function(a,b=x) { if (a) x<-2; b}
> f()
Error: Argument "a" is missing, with no default
> f(T)
[1] 2
> f(F)
[1] 1

More traditional lexical scoping would make the reference to x in the
default always be global, but lots of code would break. I think we're
stuck with this behavior as a corollary to the way S wants default
arguments to work.

Actually S is a bit inconsistent in its error message -- if you have a
non-function argument it gives the same message as R,

> g<-function(x=x) x
>g()
Error in g(): Recursive occurrence of default argument "x"
Dumped

Also in R's lexical scoping you probably do want the argument name to
shadow any outer definitions if you want to be able to define default
arguments that are recursive functions, e.g.

> g<-function(n, nfac=function(x) { if (x <= 1) 1 else nfac(x-1)*x }) nfac(n);
> g(6)
[1] 720

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Fri May  9 23:34:26 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Fri, 9 May 1997 23:34:26 +0100 (BST)
Subject: R-alpha: plot, axis & log
Message-ID: <Pine.LNX.3.95.970509230406.4111A-100000@figaro.stats.bris.ac.uk>

The following commands crash:

> plot(1:4,axes=F,log="x")
> axis(1,c(1,2,3,4))
zsh: segmentation fault  R

Lines 35-37 of axis():

35:        else {
36:                ind <- (usr[1] <= at & at <= usr[2])
37:        }

should be replaced by

        else {
                if (log)
                        ind <- (10^usr[1] <= at & at <= 10^usr[2])
                else ind <- (usr[1] <= at & at <= usr[2])
        }

Moreover, there should be a check if length(at) equals zero before calling
the internal axis command.

But wait, there's more:

> plot(1:4,log="x")
> plot(1:4)

The second call of plot produces an empty plot. The following sequence
works:

> plot(1:4,log="x")
> par(xlog=F)
> plot(1:4)        

Why does R have the graphical parameters "xlog" and "ylog"? They do not
seem to work for me and are not used by S-Plus.

Arne 

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Sat May 10 18:41:46 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Sat, 10 May 1997 17:41:46 +0000 (GMT)
Subject: R-alpha: Another error in axis
Message-ID: <Pine.LNX.3.95.970510173453.3432B-100000@figaro.stats.bris.ac.uk>

The commands

> plot(1:4,axes=F)
> axis(1,c(4,3,2,1))

produce the tick-marks but not the labels (except the last one). Sorting
the vector at in axis() seems to work, ie should lines 35-40 should read:

        else {
                at <- sort(at)
                if (log)
                        ind <- (10^usr[1] <= at & at <= 10^usr[2])
                else ind <- (usr[1] <= at & at <= usr[2])
        }


Arne

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Sat May 10 22:33:15 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Sat, 10 May 1997 14:33:15 -0700 (PDT)
Subject: R-alpha: r-beta: lm.influence
In-Reply-To: <9705091338.AA02212@>
Message-ID: <Pine.SOL.3.95.970510141405.1061A-100000@gorn>


lm.influence() doesn't work correctly on weighted models (and thus on glm
objects).


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Arne Kovac <maak@stats.bris.ac.uk>  Sun May 11 21:08:32 1997
From: Arne Kovac <maak@stats.bris.ac.uk> (Arne Kovac)
Date: Sun, 11 May 1997 20:08:32 +0000 (GMT)
Subject: R-alpha: Logarithmic scales
Message-ID: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>

Here are another three problems with logarithmic scales:

1) segments() does not work with logarithmic scales. I suggest to change
lines 962-973 in "plot.c":

    for (i = 0; i < n; i++) {
        if (FINITE(xt(x0[i%nx0])) && FINITE(yt(y0[i%ny0]))
            && FINITE(xt(x1[i%nx1])) && FINITE(yt(y1[i%ny1]))) {
            GP->col = INTEGER(col)[i % ncol];
            if(GP->col == NA_INTEGER) GP->col = colsave;
            GP->lty = INTEGER(lty)[i % nlty];
            GStartPath();
            GMoveTo(XMAP(xt(x0[i % nx0])), YMAP(yt(y0[i % ny0])));
            GLineTo(XMAP(xt(x1[i % nx1])), YMAP(yt(y1[i % ny1])));
            GEndPath();
        }
    }

2) rect() does not work either. Unfortunately, do_rect() in "plot.c" 
overrides the yt() function... What about this (lines 983-1031):

SEXP do_rect(SEXP call, SEXP op, SEXP args, SEXP env)
{
    SEXP sxl, sxr, syb, sys, col, lty, border;
    double *xl, *xr, *yb, *ys;
    int i, n, nxl, nxr, nyb, nys;
    int ncol, nlty, nborder;
    int colsave, ltysave;

    GCheckState();

    if(length(args) < 4) errorcall(call, "too few arguments\n");
    xypoints(call, args, &n);

    sxl = CAR(args); nxl = length(sxl); args = CDR(args);
    syb = CAR(args); nyb = length(syb); args = CDR(args);
    sxr = CAR(args); nxr = length(sxr); args = CDR(args);
    sys = CAR(args); nys = length(sys); args = CDR(args);

    PROTECT(col = FixupCol(GetPar("col", args)));
    ncol = LENGTH(col);

    PROTECT(border =  FixupCol(GetPar("border", args)));
    nborder = LENGTH(border);

    PROTECT(lty = FixupLty(GetPar("lty", args)));
    nlty = length(lty);

    xl = REAL(sxl);
    xr = REAL(sxr);
    yb = REAL(syb);
    ys = REAL(sys);

    ltysave = GP->lty;
    colsave = GP->col;
    GMode(1);
    for (i = 0; i < n; i++) {
        if (FINITE(xt(xl[i%nxl])) && FINITE(yt(yb[i%nyb]))
            && FINITE(xt(xr[i%nxr])) && FINITE(yt(ys[i%nys])))
                GRect(XMAP(xt(xl[i % nxl])), YMAP(yt(yb[i % nyb])),
                      XMAP(xt(xr[i % nxr])), YMAP(yt(ys[i % nys])),
                    INTEGER(col)[i % ncol],
                    INTEGER(border)[i % nborder]);
    }
    GMode(0);
    GP->col = colsave;
    GP->lty = ltysave;
    UNPROTECT(3);
    return R_NilValue;
}

3) The legend() function needs changes as well. I attach my
quick hack below, but I think there are better solutions... :-)

legend <-
function (x, y, legend, fill, col = "black", lty, pch, bty = "o", 
        bg = par("bg"), xjust = 0, yjust = 1, ...) 
{
        xlog <- par("xlog")
        ylog <- par("ylog")
        if (xlog) 
                x <- log10(x)
        if (ylog) 
                y <- log10(y)
        xchar <- xinch(par("cin")[1])
        ychar <- yinch(par("cin")[2]) * 1.2
        xbox <- xinch(par("cin")[2] * 0.8)
        ybox <- yinch(par("cin")[2] * 0.8)
        yline <- 2 * xchar
        w <- 2 * xchar + max(strwidth(legend))
        h <- (length(legend) + 1) * ychar
        if (missing(y)) {
                if (is.list(x)) {
                        y <- x$y
                        x <- x$x
                }
        }
        if (!is.numeric(x) || !is.numeric(y)) 
                stop("non-numeric coordinates")
        if (length(x) <= 0 || length(x) != length(y)) 
                stop("differing coordinate lengths")
        if (length(x) != 1) {
                x <- mean(x)
                y <- mean(y)
                xjust <- 0.5
                yjust <- 0.5
        }
        if (!missing(fill)) {
                w <- w + xchar + xbox
        }
        if (!missing(pch)) {
                if (is.character(pch) && nchar(pch) > 1) {
                        np <- nchar(pch)
                        pch <- substr(rep(pch[1], np), 1:np, 
                                1:np)
                }
                w <- w + 1.5 * xchar
        }
        if (!missing(lty)) 
                w <- w + 3 * xchar
        x <- x - xjust * w
        y <- y + (1 - yjust) * h
        xt <- rep(x, length(legend)) + xchar
        yt <- y - (1:length(legend)) * ychar
        if (bty != "n") {
                if (xlog) {
                        x1 <- 10^x
                        x2 <- 10^(x + w)
                }
                else {
                        x1 <- x
                        x2 <- x + w
                }
                if (ylog) {
                        y1 <- 10^y
                        y2 <- 10^(y - h)
                }
                else {
                        y1 <- y
                        y2 <- y - h
                }
                rect(x1, y1, x2, y2, col = bg)
        }
        x <- x + xchar
        if (!missing(fill)) {
                if (xlog) {
                        x1 <- 10^xt
                        x2 <- 10^(xt + xbox)
                }
                else {
                        x1 <- xt
                        x2 <- xt + xbox
                }
                if (ylog) {
                        y1 <- 10^(yt - 0.5 * ybox)
                        y2 <- 10^(yt + 0.5 * ybox)
                }
                else {
                        y1 <- yt - 0.5 * ybox
                        y2 <- yt + 0.5 * ybox
                }
                rect(xt, yt - 0.5 * ybox, xt + xbox, yt + 0.5 * 
                        ybox, col = fill)
                xt <- xt + xbox + xchar
        }
        if (!missing(pch)) {
                if (xlog) 
                        x1 <- 10^(xt + 0.25 * xchar)
                else x1 <- xt + 0.25 * xchar
                if (ylog) 
                        y1 <- 10^yt
                else y1 <- yt
                points(x1, y1, pch, col = col)
                xt <- xt + 1.5 * xchar
        }
        if (!missing(lty)) {
                if (xlog) {
                        x1 <- 10^xt
                        x2 <- 10^(xt + 2 * xchar)
                }
                else {
                        x1 <- xt
                        x2 <- xt + 2 * xchar
                }
                if (ylog) 
                        y1 <- 10^yt
                else y1 <- yt
                segments(x1, y1, x2, y1, lty = lty, col = col)
                xt <- xt + 3 * xchar
        }
        if (xlog) 
                x1 <- 10^xt
        else x1 <- xt
        if (ylog) 
                y1 <- 10^yt
        else y1 <- yt
        text(x1, y1, text = legend, adj = c(0, 0.35))
}

Arne

-- 
Arne Kovac
School of Mathematics                    Phone: +44 (0117) 942 7551
University of Bristol                    A.Kovac@bristol.ac.uk    
University Walk, Bristol, BS8 1TW, U.K.  http://www.stats.bris.ac.uk/~maak


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 01:35:25 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 12 May 1997 12:35:25 +1200 (NZST)
Subject: R-alpha: Hypergeometric Distribution
Message-ID: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>

A cut and paste typo has crept in and is rendering all values returned
for the hypergeometric distribution incorrect.  The problem is in
src/main/arithmetic.c in the function "math4".  The lines

        PROTECT(sy = allocVector(REALSXP, n));
        a = REAL(sa);
        b = REAL(sb);
        c = REAL(sc);
        d = REAL(sc);	/* <-- change this line */
        y = REAL(sy);

should read

        PROTECT(sy = allocVector(REALSXP, n));
        a = REAL(sa);
        b = REAL(sb);
        c = REAL(sc);
        d = REAL(sd);	/* corrected */
        y = REAL(sy);

This will be part of the official 2nd patch to 0.49, but I'm pointing it
out anyway.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Mon May 12 07:17:50 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Mon, 12 May 1997 08:17:50 +0200
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
Message-ID: <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> A cut and paste typo has crept in and is rendering all values returned
> for the hypergeometric distribution incorrect.  The problem is in
> src/main/arithmetic.c in the function "math4".  The lines

>         PROTECT(sy = allocVector(REALSXP, n));
>         a = REAL(sa);
>         b = REAL(sb);
>         c = REAL(sc);
>         d = REAL(sc);	/* <-- change this line */
>         y = REAL(sy);

> should read

>         PROTECT(sy = allocVector(REALSXP, n));
>         a = REAL(sa);
>         b = REAL(sb);
>         c = REAL(sc);
>         d = REAL(sd);	/* corrected */
>         y = REAL(sy);

> This will be part of the official 2nd patch to 0.49, but I'm pointing it
> out anyway.

Thanks for the patch.

It fixes the problem reported by myself on 25 Apr 1997 (makes my Fisher
test work again) and by Ennapadam Venkatraman <VENKAT@biosta.mskcc.org>
on 30 Apr 1997.

Note that the problem with `rhyper(5,200,250,60)' never returning still
seems to exist.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 09:03:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 10:03:50 +0200
Subject: R-alpha: Logarithmic scales -- patch to 'legend'
In-Reply-To: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>
 (message from Arne Kovac on Sun, 11 May 1997 20:08:32 +0000 (GMT))
Message-ID: <9705120803.AA00340@>

Arne, thank you for your very useful  bug findings and fixing.
Your first two "patches" to  plot.c  are really ok.

In your

>> 3) The legend() function needs changes as well. I attach my
>> quick hack below, but I think there are better solutions... :-)
>> 
>> legend <-
>> function (x, y, legend, fill, col = "black", lty, pch, bty = "o", 
>>         bg = par("bg"), xjust = 0, yjust = 1, ...) 
>> .....

there was one typo in the  ``if(!missing(fill))''  clause, you assigned
x1,..y2, but then did not use them.

Below I fixed this and found a way to make the whole  if(xlog) / (ylog)
things a little more concise.
This is a patch against "plain 0.49" ,  $RHOME/src/library/base/funs/ :

--- legend.~1~	Fri Jan 17 03:44:24 1997
+++ legend	Mon May 12 09:42:25 1997
@@ -2,13 +2,18 @@
 function(x, y, legend, fill, col="black", lty, pch, bty="o", bg=par("bg"),
 	xjust=0, yjust=1, ...)
 {
+	xlog <- par("xlog")
+	ylog <- par("ylog")
+	if (xlog) x <- log10(x)
+	if (ylog) y <- log10(y)
 	xchar <- xinch(par("cin")[1])
 	ychar <- yinch(par("cin")[2]) * 1.2
 	xbox <- xinch(par("cin")[2] * 0.8)
 	ybox <- yinch(par("cin")[2] * 0.8)
 	yline <- 2*xchar
 	w <- 2 * xchar + max(strwidth(legend))
-	h <- (length(legend)+1)*ychar
+	n.leg <- length(legend)
+	h <- (n.leg + 1) * ychar
 	if(missing(y)) {
 		if(is.list(x)) {
 			y <- x$y
@@ -39,23 +44,43 @@
 		w <- w + 3 * xchar
 	x <- x - xjust * w
 	y <- y + (1 - yjust) * h
-	xt <- rep(x, length(legend)) + xchar
-	yt <- y - (1:length(legend)) * ychar
-	if(bty != "n")
-		rect(x, y, x+w, y-h, col=bg)
+	xt <- rep(x, n.leg) + xchar
+	yt <- y - (1:n.leg) * ychar
+	if (bty != "n") {
+		xx <- c(x,x+w)
+		if (xlog) xx <- 10^xx
+		yy <- c(y,y-h)
+		if (ylog) yy <- 10^yy
+		rect(xx[1], yy[1], xx[2], yy[2], col = bg)
+	}
 	x <- x + xchar
 	if(!missing(fill)) {
-		rect(xt, yt - 0.5 * ybox,
-			xt + xbox, yt + 0.5 * ybox, col=fill)
+		xx <- c(xt,xt+xbox)
+		if (xlog) xx <- 10^xx
+		yy <- yt + c(-.5,.5) * ybox
+		if (ylog) yy <- 10^yy
+		rect(xx[1], yy[1], xx[2], yy[2], col = fill)
 		xt <- xt + xbox + xchar
 	}
 	if(!missing(pch)) {
-		points(xt + 0.25 * xchar, yt, pch, col=col)
+		x1 <- xt + 0.25 * xchar
+		if (xlog) x1 <- 10^x1
+		y1 <- yt
+		if (ylog) y1 <- 10^y1
+		points(x1, y1, pch, col = col)
 		xt <- xt + 1.5 * xchar
 	}
 	if(!missing(lty)) {
-		segments(xt, yt, xt + 2 * xchar, yt, lty=lty, col=col)
+		xx <- c(xt, xt + 2 * xchar)
+		if (xlog) xx <- 10^xx
+		y1 <- yt
+		if (ylog) y1 <- 10^y1
+		segments(xx[1], y1, xx[2], y1, lty = lty, col = col)
 		xt <- xt + 3 * xchar
 	}
-	text(xt, yt, text=legend, adj=c(0, 0.35))
+	x1 <- xt
+	y1 <- yt
+	if (xlog) x1 <- 10^x1
+	if (ylog) y1 <- 10^y1
+	text(x1, y1, text = legend, adj = c(0, 0.35))
 }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 09:39:39 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 10:39:39 +0200
Subject: R-alpha: fixing dhyper.c: another less important typo
In-Reply-To: <Pine.LNX.3.95.970511195559.1367B-100000@figaro.stats.bris.ac.uk>
 (message from Arne Kovac on Sun, 11 May 1997 20:08:32 +0000 (GMT))
Message-ID: <9705120839.AA00361@>

Line 30 should be changed from

	if (NR <= 0 || NR <= 0 || n <= 0 || n > N)
to                      ^-- typo: "R" should be "B"
	if (NR < 0 || NB < 0 || n < 0 || n > N)

(NR==0 or NB == 0  should not be a DOMAIN_ERROR)
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 13:11:38 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 14:11:38 +0200
Subject: R-alpha: oops -- 2nd patch to 'legend'
In-Reply-To: <9705120803.AA00340@> (message from Martin Maechler on Mon, 12
 May 97 10:03:50 +0200)
Message-ID: <9705121211.AA00399@>

This time, I have at least tested it out under quite a few circumstances;
the last patch (a few hours ago) would FAIL in many cases!

--- legend.~1~	Fri Jan 17 03:44:24 1997
+++ legend	Mon May 12 12:07:23 1997
@@ -2,18 +2,23 @@
 function(x, y, legend, fill, col="black", lty, pch, bty="o", bg=par("bg"),
 	xjust=0, yjust=1, ...)
 {
+  xlog <- par("xlog")
+  ylog <- par("ylog")
+  if (xlog) x <- log10(x)
+  if (ylog) y <- log10(y)
 	xchar <- xinch(par("cin")[1])
 	ychar <- yinch(par("cin")[2]) * 1.2
 	xbox <- xinch(par("cin")[2] * 0.8)
 	ybox <- yinch(par("cin")[2] * 0.8)
 	yline <- 2*xchar
 	w <- 2 * xchar + max(strwidth(legend))
-	h <- (length(legend)+1)*ychar
+  n.leg <- length(legend)
+  h <- (n.leg + 1) * ychar
 	if(missing(y)) {
 		if(is.list(x)) {
 			y <- x$y
 			x <- x$x
-		}
+    } else stop("missing y")
 	}
 	if(!is.numeric(x) || !is.numeric(y))
 		stop("non-numeric coordinates")
@@ -39,23 +44,36 @@
 		w <- w + 3 * xchar
 	x <- x - xjust * w
 	y <- y + (1 - yjust) * h
-	xt <- rep(x, length(legend)) + xchar
-	yt <- y - (1:length(legend)) * ychar
+  xt <- rep(x, n.leg) + xchar
+  yt <- y - (1:n.leg) * ychar
 	if(bty != "n")
 		rect(x, y, x+w, y-h, col=bg)
 	x <- x + xchar
 	if(!missing(fill)) {
-		rect(xt, yt - 0.5 * ybox,
-			xt + xbox, yt + 0.5 * ybox, col=fill)
+    xx <- cbind(xt, xt + xbox)
+    if (xlog) xx <- 10^xx
+    yy <- yt + cbind(rep(-0.5,n.leg), 0.5) * ybox
+    if (ylog) yy <- 10^yy
+    rect(xx[,1], yy[,1], xx[,2], yy[,2], col = fill)
 		xt <- xt + xbox + xchar
 	}
 	if(!missing(pch)) {
-		points(xt + 0.25 * xchar, yt, pch, col=col)
+    x1 <- xt + 0.25 * xchar
+    if (xlog) x1 <- 10^x1
+    y1 <- yt
+    if (ylog) y1 <- 10^y1
+    points(x1, y1, pch, col = col)
 		xt <- xt + 1.5 * xchar
 	}
 	if(!missing(lty)) {
-		segments(xt, yt, xt + 2 * xchar, yt, lty=lty, col=col)
+    xx <- cbind(xt, xt + 2 * xchar)
+    if (xlog) xx <- 10^xx
+    y1 <- yt
+    if (ylog) y1 <- 10^y1
+    segments(xx[,1], y1, xx[,2], y1, lty = lty, col = col)
 		xt <- xt + 3 * xchar
 	}
+  if (xlog) xt <- 10^xt
+  if (ylog) yt <- 10^yt
 	text(xt, yt, text=legend, adj=c(0, 0.35))
 }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Mon May 12 14:25:18 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Mon, 12 May 97 15:25:18 +0200
Subject: R-alpha: ISO-latin-1 characters in strings -- print.default & PARSE(?) problems
Message-ID: <9705121325.AA00438@>


There seems to be a problem in print.default with some
ISO-latin1 characters (the chars AFTER ASCII in western Europe...)
if they appear in strings. 
(no problem if they are part of a function comment, see below).

Some of the characters lead to 4 character Hex-codes being printed instead:
"" ## ^u    prints as "0xFB"

If you use the funny characters in comments of functions, they are stored
and printed properly.

HOWEVER: In a few rare cases, the strings are not even PARSED properly;
	the line 'ISOdiv <- ..' below gives a SYNTAX error.

The following code shows the symptoms :
   -- ONLY if  the e-mail between here and your place is  8-bit clean! --
  (else: get it ftp://ftp.stat.math.ethz.ch/U/maechler/R/string-test.R )

frenchquotes <- "..."  ## <<...>>
frenchquotes

Umlaute <- " " # = "a "o "u  "A "O "U
Umlaute #- only the last one is not printed properly...

A.accents <- " " # `a 'a ^a "a oa ae  `A 'A ^A "A oA AE
A.accents
EI.accents <- " "
EI.accents
O.accents <- ""
O.accents

U.accents <- ""
U.accents

ISO24x <-  " " #octal 241..257
ISO26x <- " " #octal 260..277

##--- THIS IS a Problem: It gives a SYNTAX error !
ISOdiv <- "    " 
##-- One of these characters even was producing the same as  'q()' !!

aa_ function(x) {
  x^2
  ##- frenchquotes <- "..."  ## <<...>>
  ##- Umlaute <- " " # = "a "o "u  "A "O "U
  ##- A.accents <- " " # `a 'a ^a "a oa ae  `A 'A ^A "A oA AE
  ##- EI.accents <- " "
  ##- O.accents <- ""
  ##- U.accents <- ""
  ##-
  ##- ISO24x <-  " " #octal 241..257
  ##- ISO26x <- " " #octal 260..277
  ##- ISOdiv <- " " ##-- OMITTED further: SYNTAX error !!
}
aa
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 22:14:03 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 09:14:03 +1200 (NZST)
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
 <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
Message-ID: <199705122114.JAA02547@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:
 > Note that the problem with `rhyper(5,200,250,60)' never returning still
 > seems to exist.

We have a fix for this.  There was a typo in the underlying generator
code.  (I'm trying to avoid piecemeal fixes, but the dhyper / phyper /
qhyper one seemed rather nasty and the cause of a number of bug
reports).  More complete patch soon.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Mon May 12 22:15:35 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 09:15:35 +1200 (NZST)
Subject: R-alpha: XDR and Portable Data
Message-ID: <199705122115.JAA02567@stat1.stat.auckland.ac.nz>

While waiting for a "make" to finish this morning, I took down the Sun
"Network Programmers Reference Guide" and had a look at their
description of the XDR library.  Interestingly it looks like it can be
plugged into R with very little effort because our saveload code is
structured in exactly the right way.  So ..., contrary to what I said
before, I will have a bash at adding it.

It would still be useful to look at the other data formats.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 05:18:00 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Tue, 13 May 1997 16:18:00 +1200 (NZST)
Subject: R-alpha: R-0.49 Patch 2
Message-ID: <199705130418.QAA07895@stat1.stat.auckland.ac.nz>

A second patch for R-0.49 is now available as

	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2.gz

and soon from mirror sites.

This patch fixes a variety of memory management problems and has
some updates for a number of numerical functions, including

	dhyper / phyper / qhyper / rhyper
	pbeta / qbeta
	qt
	qnorm

In addition, Thomas Lumley has provided some reworking of the
glm code.

I have nearly completed building a new TASKS lists and we are starting
work on the problems in it.  More patches will follow.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 07:11:31 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 08:11:31 +0200
Subject: R-alpha: Hypergeometric Distribution
In-Reply-To: <199705122114.JAA02547@stat1.stat.auckland.ac.nz>
References: <199705120035.MAA05932@stat1.stat.auckland.ac.nz>
 <199705120617.IAA26676@aragorn.ci.tuwien.ac.at>
 <199705122114.JAA02547@stat1.stat.auckland.ac.nz>
Message-ID: <199705130611.IAA06400@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> Kurt Hornik writes:
>> Note that the problem with `rhyper(5,200,250,60)' never returning still
>> seems to exist.

> We have a fix for this.  There was a typo in the underlying generator
> code.  (I'm trying to avoid piecemeal fixes, but the dhyper / phyper /
> qhyper one seemed rather nasty and the cause of a number of bug
> reports).  More complete patch soon.

Indeed, it does.  Also, my qt(0.975, 3) works now even if I compile with
"-O2 -g".

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 07:16:30 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 08:16:30 +0200
Subject: R-alpha: Re: R-beta: ls.print
In-Reply-To: <199704301411.QAA20329@hypatia.math.ethz.ch>
References: <199704301411.QAA20329@hypatia.math.ethz.ch>
Message-ID: <199705130616.IAA06418@aragorn.ci.tuwien.ac.at>

>>>>> Ennapadam Venkatraman writes:

> ls.print produces error that I don't seem to be able to trace.
> Output of the commands as follows: (hyeung is a 24x2 matrix of data)

> -------------------------------------------------
>> summary(hyeung)
>        x.1             x.2
>  Min.   : 28.0   Min.   : 10.0
>  1st Qu.: 72.0   1st Qu.: 87.5
>  Median : 86.5   Median : 92.5
>  Mean   : 81.0   Mean   : 82.5
>  3rd Qu.: 97.0   3rd Qu.:100.0
>  Max.   :100.0   Max.   :100.0

>> summary(lsfit(hyeung[,1],hyeung[,2]))
>           Length Class  Mode
> coef       2     -none- numeric
> residuals 24     -none- numeric
> intercept  1     -none- logical
> qr         6     -none- list

>> ls.print(lsfit(hyeung[,1],hyeung[,2]))
> trace: ls.print(lsfit(hyeung[, 1], hyeung[, 2]))
> Error: missing value in ``n1 : n2''

> -------------------------------------------------

> E. S. Venkatraman (venkat@biosta.mskcc.org)

The problem seems to be that

	ncol(ls.out$residuals)

gives NULL if ls.out is a vector.  An easy fix is to replace each
occurrence of ncol in ls.print() by NCOL.

A patch is appended below.

Btw, my help file for NCOL comes up with `.COL' rather than `NCOL'.  Can
anyone verify that?

-k

*** src/library/base/funs/lsfit.orig	Tue May 13 07:54:24 1997
--- src/library/base/funs/lsfit	Tue May 13 07:51:19 1997
*************** ls.print <- function(ls.out, digits=4, p
*** 256,265 ****
  
  	# construct coef table
  
! 	coef.table <- as.list(1:ncol(ls.out$residuals))
! 	if(ncol(ls.out$residuals)==1) coef <- matrix(ls.out$coef, nc=1)
  	else coef <- ls.out$coef
! 	for(i in 1:ncol(ls.out$residuals)) {
  		covmat <- (resss[i]/(n[i]-p)) * (qrinv%*%t(qrinv))
  		coef.table[[i]] <- cbind(coef[, i], diag(covmat)^.5,
  			coef[, i]/diag(covmat)^.5,
--- 256,265 ----
  
  	# construct coef table
  
! 	coef.table <- as.list(1:NCOL(ls.out$residuals))
! 	if(NCOL(ls.out$residuals)==1) coef <- matrix(ls.out$coef, nc=1)
  	else coef <- ls.out$coef
! 	for(i in 1:NCOL(ls.out$residuals)) {
  		covmat <- (resss[i]/(n[i]-p)) * (qrinv%*%t(qrinv))
  		coef.table[[i]] <- cbind(coef[, i], diag(covmat)^.5,
  			coef[, i]/diag(covmat)^.5,
*************** ls.print <- function(ls.out, digits=4, p
*** 270,276 ****
  		#print results
  
  		if(print.it) {
! 			if(ncol(ls.out$residuals)>1)
  				cat("Response:", colnames(ls.out$residuals)[i],
  				"\n\n")
  			cat(paste("Residual Standard Error=", format(round(
--- 270,276 ----
  		#print results
  
  		if(print.it) {
! 			if(NCOL(ls.out$residuals)>1)
  				cat("Response:", colnames(ls.out$residuals)[i],
  				"\n\n")
  			cat(paste("Residual Standard Error=", format(round(
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 13 09:12:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 13 May 97 10:12:50 +0200
Subject: R-alpha: Re: R-beta: ls.print
In-Reply-To: <199705130616.IAA06418@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Tue, 13 May 1997 08:16:30 +0200)
Message-ID: <9705130812.AA00712@>

Yes, I do confirm that the  Help page  (?NCOL) contains  '.COL'.

Apply the following patch (to doc2ms) in  $RHOME/etc , and "all is well":

--- doc2ms	Tue May 13 10:10:33 1997
+++ Old/doc2ms	Sun Nov 24 23:41:49 1996
@@ -122,8 +122,6 @@
 $2
 .DE
 ')
-define(DEQTEX,`')
-define(DEQHTML,`')
 END
 # Fix up the input to protect things that m4 is sensitive about.
 sed '
@@ -149,8 +147,8 @@
 s/M4_RQ/'\''/g
 s/M4_COMMA/,/g
 s/M4_IFELSE/ifelse/g
-s/^\.Internal/\\\&.Internal/
-s/^\.C/\\\&.C/
-s/^\.Fortran/\\\&.Fortran/
+s/^.Internal/\\\&.Internal/
+s/^.C/\\\&.C/
+s/^.Fortran/\\\&.Fortran/
 s/\\n/\\\\n/g
 '
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 13 10:07:06 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 13 May 1997 11:07:06 +0200
Subject: R-alpha: R-0.49 patch 2
Message-ID: <199705130907.LAA07145@aragorn.ci.tuwien.ac.at>

Developers, watch out:

The patch seems to install the files with the new code for family and
glm into the man subdir of src/library/base rather than into funs.

(I already contacted Ross directly this morning for a quick fix, but
apparently missed him ... perhaps I should start working at 5:30 am.)

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 20:56:40 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 May 1997 07:56:40 +1200 (NZST)
Subject: R-alpha: Patch2
Message-ID: <199705131956.HAA12175@stat1.stat.auckland.ac.nz>

There is a problem with the patch I sent out yesterday. The patches for the glm
code are applied in the wrong place.  I have removed the patch file and will
have a real one available latter today.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Tue May 13 21:10:41 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Tue, 13 May 1997 13:10:41 -0700 (PDT)
Subject: R-alpha: batch mode.
In-Reply-To: <199705131956.HAA12175@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970513130620.1600B-100000@avon>


R0.49 (with and without the new patch applied to the correct places) fails
in batch mode. 
Solaris-gorn% more break.R
1+1

Solaris-gorn% ~/R49 <break.R

R : Copyright 1997, Robert Gentleman and Ross Ihaka
Version 0.49 Beta (April 23, 1997)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type "license()" for details.

[Previously saved workspace restored]

Error in par(args) : No device is active
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in internal par, 12 then 0
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in .Internal, 11 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in if, 9 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in <-, 7 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in {, 5 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
> 1+1
[1] 2
> 
> > 
Solaris-gorn% uname -a
SunOS gorn 5.5.1 Generic sun4u sparc SUNW,Ultra-1


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Tue May 13 21:29:22 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Wed, 14 May 1997 08:29:22 +1200 (NZST)
Subject: R-alpha: Revised Patch 2
Message-ID: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>

I have put the glm code in the right place and redone the patch.  To
help avoid confusion the new patch has an "a" appended to its name.
The patch can be obtained as:

	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2a.gz

Sorry for any problems this may have caused.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Tue May 13 21:32:19 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Tue, 13 May 1997 13:32:19 -0700 (PDT)
Subject: R-alpha: batch mode
In-Reply-To: <9705121211.AA00399@>
Message-ID: <Pine.SUN.3.95.970513133125.1659A-100000@avon>


The problem is not quite what I thought.

If I delete par(lwd=1) from my local .Rprofile the problem goes away.
Strange but true.

Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 14 07:04:20 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 14 May 1997 08:04:20 +0200
Subject: R-alpha: Revised Patch 2
In-Reply-To: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>
References: <199705132029.IAA12601@stat1.stat.auckland.ac.nz>
Message-ID: <199705140604.IAA27457@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> I have put the glm code in the right place and redone the patch.  To
> help avoid confusion the new patch has an "a" appended to its name.
> The patch can be obtained as:

> 	ftp://stat.auckland.ac.nz/pub/R/R-0.49.patch2a.gz

Thanks, works fine now.

For those who use my Debian Linux/GNU/ix86 packages, they have been
upgraded to 2a plus 3 more patches (legend, lsfit, doc2ms) recently
posted.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 14 08:17:23 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 May 97 09:17:23 +0200
Subject: R-alpha: batch mode. -- okay for me
In-Reply-To: <Pine.SUN.3.95.970513130620.1600B-100000@avon> (message from
 Thomas Lumley on Tue, 13 May 1997 13:10:41 -0700 (PDT))
Message-ID: <9705140717.AA01210@>

I can NOT confirm your batch problems.

For me, both

	echo "1+1" | R
and
	echo "1+1" > test.R
	R < test.R

work fine.
uname -a
	SunOS florence 5.5 Generic sun4u sparc SUNW,Ultra-1
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 14 15:57:08 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 14 May 1997 07:57:08 -0700 (PDT)
Subject: R-alpha: stop() in batch mode.
In-Reply-To: <9705140717.AA01210@>
Message-ID: <Pine.SUN.3.95.970514075254.2996A-100000@zen>

The batch mode stack imbalances appear to be confined to error reporting.
In particular the stop() command seems to trigger them.  

Solaris-gorn% more break.R
stop("Breaks R")

Solaris-gorn% ~/R49 <break.R 

R : Copyright 1997, Robert Gentleman and Ross Ihaka
Version 0.49 Beta (April 23, 1997)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type "license()" for details.

[Previously saved workspace restored]

> stop("Breaks R")
Error: Breaks R
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stack imbalance in stop, 2 then 0
Error: stack imbalance in "unprotect"
Execution halted
Error: stack imbalance in "unprotect"
Execution halted
stop("Breaks R")
> 


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 14 17:58:09 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 14 May 97 18:58:09 +0200
Subject: R-alpha: stop() in batch mode [yes;  was not in  0.16.1]
In-Reply-To: <Pine.SUN.3.95.970514075254.2996A-100000@zen> (message from
 Thomas Lumley on Wed, 14 May 1997 07:57:08 -0700 (PDT))
Message-ID: <9705141658.AA01415@>

I do confirm this one  (SunOS + Solaris).

NOTE: The problem does NOT appear in  0.16.1 yet!
>>>>> "Th" == Thomas Lumley <thomas@biostat.washington.edu> writes:

    Th> The batch mode stack imbalances appear to be confined to error
    Th> reporting.  In particular the stop() command seems to trigger them.

    Th> Solaris-gorn% more break.R stop("Breaks R")

    Th> Solaris-gorn% ~/R49 <break.R

    Th> R : Copyright 1997, Robert Gentleman and Ross Ihaka Version 0.49
    Th> Beta (April 23, 1997)

    Th> R is free software and comes with ABSOLUTELY NO WARRANTY.  You are
    Th> welcome to redistribute it under certain conditions.  Type
    Th> "license()" for details.

    Th> [Previously saved workspace restored]

    >> stop("Breaks R")
    Th> Error: Breaks R Execution halted Error: stack imbalance in
    Th> "unprotect" Execution halted stack imbalance in stop, 2 then 0
    Th> Error: stack imbalance in "unprotect" Execution halted Error: stack
    Th> imbalance in "unprotect" Execution halted stop("Breaks R")
    >>

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 15 05:16:47 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 15 May 1997 16:16:47 +1200 (NZST)
Subject: R-alpha: A Couple of Queries
Message-ID: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>

1) I have been working on making R libraries more like those in S.
I thought it might be advisable to discuss the ideas before springing
them on you.  What I have done is changed things so that each library
has its own frame on the search path.  E.g.

	> search()
	[1] ".GlobalEnv"   "library:base"
	> library("eda")
	> search()
	[1] ".GlobalEnv"   "library:eda"  "library:base"
	> ls(pos=2)
	[1] "coefficients.tukeyline"  "fitted.values.tukeyline"
	[3] "line"                    "medpolish"              
	[5] "plot.medpolish"          "print.medpolish"        
	[7] "print.tukeyline"         "residuals.tukeyline"    
	[9] "smooth"                 
	> assign("x", 10, pos=2)
	> ls(pos=2)
	 [1] "coefficients.tukeyline"  "fitted.values.tukeyline"
	 [3] "line"                    "medpolish"              
	 [5] "plot.medpolish"          "print.medpolish"        
	 [7] "print.tukeyline"         "residuals.tukeyline"    
	 [9] "smooth"                  "x"                      

All the search-path aware functions (ls, objects, assign, get, rm,
etc) now have a pos= argument which can be used to specify a frame to
work on.

I have not given S style path-names to the source of the libraries
because libraries are really internal objects rather than external
directories.

Libraries will have a .First and .Last functions.

I have not done anything about name-space clutter, but I have a couple
of ideas on name hiding which might be possible ( basically, every
library would have to "export" the names it wanted to be visible to
users).

I have not decided whether the user's global environment could be
detached or whether libraries or data objects could be attached before
it on the search path.


2) I am going ahead with implementing saving and restoring of data in
XDR format, so that there will be less trouble with heterogeneous Unix
networks.  Because the format of saved files will change, we must
either be incompatible or have some mechanism for restoring old save
files.  I would rather avoid the compatibility route if possible.
Would anyone be seriously inconvenienced if old data files could not
be restored?  (Its not hard to build in compatibility, it would just
take time which could be spend elsewhere).
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 15 10:04:51 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 15 May 1997 11:04:51 +0200
Subject: R-alpha: A Couple of Queries
In-Reply-To: Ross Ihaka's message of Thu, 15 May 1997 16:16:47 +1200 (NZST)
References: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
Message-ID: <x2lo5h85sb.fsf@bush.kubism.ku.dk>

Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:

> Would anyone be seriously inconvenienced if old data files could not
> be restored?  (Its not hard to build in compatibility, it would just
> take time which could be spend elsewhere).

I think the time would be well spent. Of course few people as of now
will have important data (only) in .RData format, and those that do
are probably clueful enough to save them in portable format before
upgrading. That situation won't last long, I suspect, (perhaps student
labs are *already* a problem?) and this might not be the last change
of the file format, so making sure that the program structure allows
loading of different file format revisions is likely to be useful
anyway.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Thu May 15 17:12:42 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Thu, 15 May 1997 09:12:42 -0700 (PDT)
Subject: R-alpha: A Couple of Queries
In-Reply-To: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
Message-ID: <Pine.SUN.3.95.970515090113.4417A-100000@zen>

On Thu, 15 May 1997, Ross Ihaka wrote:


> I have not done anything about name-space clutter, but I have a couple
> of ideas on name hiding which might be possible ( basically, every
> library would have to "export" the names it wanted to be visible to
> users).

This is certainly nice in principle, though not tremendously important at
the moment. It would be convenient to be able to declare functions in a
library that are global to the library but not accessible to the outside
world. 

> 2) I am going ahead with implementing saving and restoring of data in
> XDR format, so that there will be less trouble with heterogeneous Unix
> networks.  Because the format of saved files will change, we must
> either be incompatible or have some mechanism for restoring old save
> files.  I would rather avoid the compatibility route if possible.
> Would anyone be seriously inconvenienced if old data files could not
> be restored?  (Its not hard to build in compatibility, it would just
> take time which could be spend elsewhere).

For my purposes dump() will work fine for transferring old data files.

Will the changes give cross-platform (Mac/Win) portability too?

Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Thu May 15 21:20:57 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Fri, 16 May 1997 08:20:57 +1200 (NZST)
Subject: R-alpha: XDR
Message-ID: <199705152020.IAA00337@stat3.stat.auckland.ac.nz>


There are some 3rd party vendors that sell XDR support for windows/95/NT
however, they cost real money which is one of the things we don't have.
So in principle XDR is fine for cross-platform transfer in practice
it isn't likely.

robert
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 15 21:18:44 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 16 May 1997 08:18:44 +1200 (NZST)
Subject: R-alpha: A Couple of Queries
Message-ID: <199705152018.IAA02994@stat1.stat.auckland.ac.nz>

> > I have not done anything about name-space clutter, but I have a couple
> > of ideas on name hiding which might be possible ( basically, every
> > library would have to "export" the names it wanted to be visible to
> > users).

> This is certainly nice in principle, though not tremendously important at
> the moment. It would be convenient to be able to declare functions in a
> library that are global to the library but not accessible to the outside
> world. 

This is what I had in mind.  The functions in the library (and those
exported) could see all functions and data in the library, but only the
exported objects would be visible globally.  Of course, R scoping
can be used to provide this kind privacy, but you have to think
about setting up the libraries more carefully.

> > 2) I am going ahead with implementing saving and restoring of data in
> > XDR format, so that there will be less trouble with heterogeneous Unix
> > networks.  Because the format of saved files will change, we must
> > either be incompatible or have some mechanism for restoring old save
> > files.  I would rather avoid the compatibility route if possible.
> > Would anyone be seriously inconvenienced if old data files could not
> > be restored?  (Its not hard to build in compatibility, it would just
> > take time which could be spend elsewhere).

> For my purposes dump() will work fine for transferring old data files.

> Will the changes give cross-platform (Mac/Win) portability too?

This will depend on the availability of the XDR library for those
platforms.  I seem to recall that XDR is available for Windows at least.

I'm rather more concerned with Unix because it is common to have a mix
of platforms accessing the same data under Unix.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Fri May 16 05:59:17 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 16 May 1997 16:59:17 +1200 (NZST)
Subject: R-alpha: A Quick Way to Kill S ...
Message-ID: <199705160459.QAA16516@stat1.stat.auckland.ac.nz>

Start S and detach the directory at position 2.

	S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
	S : Copyright AT&T.
	Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
	Working data will be in /users/rdev/ihaka/.Data 
	> search()
	[1] "/users/rdev/ihaka/.Data"                             
	[2] "/usr/local/pkg/splus/splus-3.4/splus/.Functions"     
	[3] "/usr/local/pkg/splus/splus-3.4/stat/.Functions"      
	[4] "/usr/local/pkg/splus/splus-3.4/s/.Functions"         
	[5] "/usr/local/pkg/splus/splus-3.4/s/.Datasets"          
	[6] "/usr/local/pkg/splus/splus-3.4/stat/.Datasets"       
	[7] "/usr/local/pkg/splus/splus-3.4/splus/.Datasets"      
	[8] "/usr/local/pkg/splus/splus-3.4/library/trellis/.Data"
	> detach(pos=2,save="x")
	Error in UseMethod("assign", where): No specific or default method found
	Dumped
	> assign
	function(x, value, frame, where = NULL, ...)
	UseMethod("assign", where)
	> search()
	[1] "/users/rdev/ihaka/.Data"                             
	[2] ""                                                    
	[3] "/usr/local/pkg/splus/splus-3.4/stat/.Functions"      
	[4] "/usr/local/pkg/splus/splus-3.4/s/.Functions"         
	[5] "/usr/local/pkg/splus/splus-3.4/s/.Datasets"          
	[6] "/usr/local/pkg/splus/splus-3.4/stat/.Datasets"       
	[7] "/usr/local/pkg/splus/splus-3.4/splus/.Datasets"      
	[8] "/usr/local/pkg/splus/splus-3.4/library/trellis/.Data"
	System terminating: bad address

Ouch!

As you can see I've been playing with search paths.  I hope to have
more patches next week which will implement search paths for R more
completely (I think I'll skip the feature above).

I have also converted to using XDR for workspace saving (maintaining
backwards compatibility).  The bits of XDR we use are pretty simple
so it may be possible to create version for windows and	the mac.

Now I want to be able to attach saved workspaces, and perhaps
introduce some sort of "demand loadable" data object.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 16 17:39:46 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 16 May 1997 18:39:46 +0200
Subject: R-alpha: A Couple of Queries
In-Reply-To: <x2lo5h85sb.fsf@bush.kubism.ku.dk>
References: <199705150416.QAA29118@stat1.stat.auckland.ac.nz>
 <x2lo5h85sb.fsf@bush.kubism.ku.dk>
Message-ID: <199705161639.SAA07695@aragorn.ci.tuwien.ac.at>

>>>>> Peter Dalgaard BSA writes:

> Ross Ihaka <ihaka@stat.auckland.ac.nz> writes:
>> Would anyone be seriously inconvenienced if old data files could not
>> be restored?  (Its not hard to build in compatibility, it would just
>> take time which could be spend elsewhere).

> I think the time would be well spent. Of course few people as of now
> will have important data (only) in .RData format, and those that do
> are probably clueful enough to save them in portable format before
> upgrading. That situation won't last long, I suspect, (perhaps student
> labs are *already* a problem?) and this might not be the last change
> of the file format, so making sure that the program structure allows
> loading of different file format revisions is likely to be useful
> anyway.

Agreed.  I have a few .RData files, but I can live with recreating them.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From la-jassine@aix.pacwan.net  Fri May 16 16:16:24 1997
From: la-jassine@aix.pacwan.net (Paul Gilbert)
Date: Fri, 16 May 1997 12:16:24 -0300
Subject: R-alpha: A Couple of Queries
Message-ID: <1348302032-894051@aix.pacwan.net>

>1) I have been working on making R libraries more like those in S.
...
>	> library("eda")
>	> search()
>	[1] ".GlobalEnv"   "library:eda"  "library:base"

As I recall in S, library() adds to the end of the search list unless
First=T is specified. The function attach() works by putting things in
position 2.

>Libraries will have a .First and .Last functions.
As I recall these are called .First.lib and .Last.lib in S.

>I have not done anything about name-space clutter, but I have a couple
>of ideas on name hiding which might be possible ( basically, every
>library would have to "export" the names it wanted to be visible to
>users).

In theory this is probably the preferred way to do this, but I think
compatability with S may be more easily maintained if you explicitly hide
names which can be hidden.

...
>Would anyone be seriously inconvenienced if old data files could not
>be restored? 

This is not a problem for me. However, if you do it, a separate conversion
utility might be better as it is something for which there will eventually
be no need.

Also, on XDR, I  took a quick scan through the Bank  of Canada PADI code
which uses XDR, just to see if there might be any helpful hints.  I didn't
find too much, but there where a number of comments about "deleting NULL
pointers so that XDR does not barf," for what that's worth. Good luck.

Paul Gilbert

 P.S.  0.49 with patch2a seems to be working really well. The most serious
problem for my time series library is now eigen() for non-symmetric matrices.


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 18 20:50:16 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 19 May 1997 07:50:16 +1200 (NZST)
Subject: R-alpha: Eigenvalue Computation Query
Message-ID: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>

I have been looking at the "eigen" function and have reintroduced the
ability to compute (right) eigenvalues and vectors for non-symmetric
matrices.  I've also made "eigen" complex capable.

The code is based on the eispack entry points RS, RG, CH, CG (which is
what S appears to use too).  The problem with both the S and R
implementations is that they consume huge amounts of memory.  Some of
this is due to purely ".Fortran" overhead, which I think I can cure.
But some of the bloat is due to the inclusion of special eigenvalues-only
code from eispack.

The question is:

Should I drop this special code and always compute both eigenvalues
and eigenvectors?  This would substantially reduce code size, but might
increase computational cost in the case where only eigenvalues are
needed.


PS: For the lapack fans out there ...  I looked hard at using lapack
as an alternative to eispack, but it's written in a fashion which
does not make its addition to R as simple as linpack and eispack.
When we all have SMP desktop machines it will become more of an issue.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Tue May 20 02:09:01 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Mon, 19 May 1997 20:09:01 -0500 (CDT)
Subject: R-alpha: A Couple of Queries
In-Reply-To: <199705152018.IAA02994@stat1.stat.auckland.ac.nz> from "Ross Ihaka" at May 16, 97 08:18:44 am
Message-ID: <9705200109.AA26588@nokomis.stat.umn.edu>

Ross Ihaka wrote:
> 
> This is what I had in mind.  The functions in the library (and those
> exported) could see all functions and data in the library, but only the
> exported objects would be visible globally.  Of course, R scoping
> can be used to provide this kind privacy, but you have to think
> about setting up the libraries more carefully.
> 

Is your design consistent with (maybe not now but later) allowing a
library to specify a static search path component for code defined in
it that comes before entries added dynamically at runtime? THis would
allow a "uses" specification where a library definition specifies
other libraries it uses and can be sure these will be used and not
whatever happens to be attached earlier on the search path. Among
other things, this might allow something like

	LIBRARY: survival
	EXPORTS: coxph, ...
	USES: S.compatibility, S.syntax, ...
	.... insert Terry's latest code ...

So when the library is loaded, S syntax is used (if it differs from
R's) and when the body of a function like coxph is executed,
definitions from the S compatibility library will be called instead of
standard R ones (if they differ).  This would make it easier for R to
go its own way when it that seems appropriate without losing the
ability to use S code.

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 06:54:12 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 07:54:12 +0200
Subject: R-alpha: small doc bug
Message-ID: <199705200554.HAA25739@aragorn.ci.tuwien.ac.at>

The documentation for ls/objects has

	ls(name, pos=2, envir=sys.frame(sys.parent()),
           all.names=FALSE, pattern)

but the code has

	ls <-
	function (name, pos = -1, envir = NULL,
                  all.files = FALSE, pattern)

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 07:18:22 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 08:18:22 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
Message-ID: <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> I have been looking at the "eigen" function and have reintroduced the
> ability to compute (right) eigenvalues and vectors for non-symmetric
> matrices.  I've also made "eigen" complex capable.

> The code is based on the eispack entry points RS, RG, CH, CG (which is
> what S appears to use too).  The problem with both the S and R
> implementations is that they consume huge amounts of memory.  Some of
> this is due to purely ".Fortran" overhead, which I think I can cure.
> But some of the bloat is due to the inclusion of special eigenvalues-only
> code from eispack.

> The question is:

> Should I drop this special code and always compute both eigenvalues
> and eigenvectors?  This would substantially reduce code size, but might
> increase computational cost in the case where only eigenvalues are
> needed.

I'd say, reduce code size.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Friedrich.Leisch@ci.tuwien.ac.at  Tue May 20 08:26:06 1997
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Tue, 20 May 1997 09:26:06 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
 <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
Message-ID: <199705200726.JAA07429@galadriel.ci.tuwien.ac.at>

>>>>> On Tue, 20 May 1997 08:18:22 +0200,
>>>>> Kurt Hornik wrote:

>>>>> Ross Ihaka writes:
>> I have been looking at the "eigen" function and have reintroduced the
>> ability to compute (right) eigenvalues and vectors for non-symmetric
>> matrices.  I've also made "eigen" complex capable.

>> The code is based on the eispack entry points RS, RG, CH, CG (which is
>> what S appears to use too).  The problem with both the S and R
>> implementations is that they consume huge amounts of memory.  Some of
>> this is due to purely ".Fortran" overhead, which I think I can cure.
>> But some of the bloat is due to the inclusion of special eigenvalues-only
>> code from eispack.

>> The question is:

>> Should I drop this special code and always compute both eigenvalues
>> and eigenvectors?  This would substantially reduce code size, but might
>> increase computational cost in the case where only eigenvalues are
>> needed.

> I'd say, reduce code size.

probably one shouldn't disagree with his boss openly ... but we
are the ones actually doing all the simulations :-)

do you know how much the difference in computational cost is? if it's
worth the increase in code size I'd rather prefer only computing the
required eigenvalues

best,
fritz


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 20 10:24:18 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 20 May 1997 11:24:18 +0200
Subject: R-alpha: Eigenvalue Computation Query
In-Reply-To: Friedrich Leisch's message of Tue, 20 May 1997 09:26:06 +0200
References: <199705181950.HAA23297@stat1.stat.auckland.ac.nz>
 <199705200618.IAA25854@aragorn.ci.tuwien.ac.at>
 <199705200726.JAA07429@galadriel.ci.tuwien.ac.at>
Message-ID: <x24tbywl6l.fsf@bush.kubism.ku.dk>

Friedrich Leisch <Friedrich.Leisch@ci.tuwien.ac.at> writes:

> > I'd say, reduce code size.
> 
> probably one shouldn't disagree with his boss openly ... but we
> are the ones actually doing all the simulations :-)
> 
> do you know how much the difference in computational cost is? if it's
> worth the increase in code size I'd rather prefer only computing the
> required eigenvalues

As I understand it, the difference is between getting all the
eigenvalues and all eigenvalues and -vectors. Getting only the top or
bottom few is not an option in Splus either, but that would be where
the real savings lie.

I'd say do the small thing now and rethink the whole numerics business
later (could we lift all of libcruft.a out of the octave source, for
instance?). If you need some special eispack routines, you can always
dyn.load them in.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 15:31:57 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 16:31:57 +0200
Subject: R-alpha: Re unified shell script
Message-ID: <199705201431.QAA27356@aragorn.ci.tuwien.ac.at>

Some time ago there was the suggestion to add a PLATFORM subdir level
for bin (and eventually the library subdirs with `binaries'), and the
idea to have the shell wrapper automagically call the right binary.

I mentioned that one might be able to use the shell variables OSTYPE and
HOSTTYPE for that, noticing however that e.g on my Debian Linux/GNU/ix86

		bash	tcsh
OSTYPE		Linux	linux
HOSTTYPE	i386	i386-linux

Hmm ... It seems (a colleague just checked that) that these variables
are not POSIX either, and hence I'd say rather useless for our purpose.

In the absence of a reliable run-time possibility to determine the
current platform, it seems to be natural to use `platform' as obtained
at compile-time for possibly distinguishing the various binaries etc,
and leave it at the discretion of the sysadmin to ensure that the R
script in the path calls the right binary.

If I am missing something obvious, please let me know.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 20 16:11:18 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 20 May 97 17:11:18 +0200
Subject: R-alpha: print 'problems': print(2^30, digits=12); comments at start of function()
Message-ID: <9705201511.AA00407@>

Both of these bugs are not a real harm,
however, they have been annoying me for too long ... ;-)

1)
 print(2^30, digits = 12) #-  exponential form; unnecessarily!

 formatC(2^30, digits = 12) #- shows you what you'd want above

 ## S-plus is okay here; note that the problem also affects
 ##	paste(.)  & format(.) :
 
 options(digits=10)
 paste(2^(4*1:8))
 
 S-plus gives

[1] "16"         "256"        "4096"       "65536"      "1048576"   
[6] "16777216"   "268435456"  "4294967296"

 whereas R gives

[1] "16"              "256"             "4096"            "65536"          
[5] "1048576"         "1.6777216e+07"   "2.68435456e+08"  "4.294967296e+09"



2) This one has been reported (in slightly different form)
   >> Date: Mon, 10 Mar 1997 09:46:37 +0100 (MET)
   >> From: Martyn Plummer <plummer@iarc.fr>
   >> To: r-testers@stat.math.ethz.ch

   >> #4) If you put a few lines of comments at the start of a function,
   >>     then the comments always appear *after* the first line of code. 

This is REALLY painful; try, e.g.,

fcat <- function(..., f.dig= 4, f.wid = f.dig +5, f.flag = ' ', nl = TRUE,
                 file = "", sep = " ",
                 fill = FALSE, labels = NULL, append = FALSE)
{
  ## Purpose: Formatted CAT -- for printing 'tables'
  ## ----------------------------------------------------------------------
  ## Author: Martin Maechler, Date: 12 May 97
  l <- unlist(lapply(list(...), formatC,
                     wid= f.wid, digits= f.dig, flag= f.flag))
  cat(l, if(nl)"\n", file=file, sep=sep, fill=fill,labels=labels, append=append)
}

# and look how it prints:
fcat

Even worse, some comments are silently lost (yes, I know in some
sitatuations,  S also loses comments) : 

ex <- 
##
## S version 4 likes comments like these.  
## ----------- They automagically become  on-line help.
## R just swallows them up into /dev/null...
##
function(a,b)
{
	a + b
}
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 20 17:24:48 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 20 May 97 18:24:48 +0200
Subject: R-alpha: rep(.) and aperm(.)  lose names(.) and dimnames(.)  -- Patch
Message-ID: <9705201624.AA00517@>

The following patches fix the problem.
For aperm, it's quite important to keep dimnames(.);
for rep(.), it's arguable, however S(-plus) does it...

However, it would probably be better to this in the '.Internal' code for
all attributes.

Patch to be applied in		$RHOME/src/library/base/funs/ 

--- rep~	Sun Nov 24 23:42:29 1996
+++ rep		Tue May 20 18:20:12 1997
@@ -5,6 +5,7 @@
 	if (missing(times))
 		times <- ceiling(length.out/length(x))
 	r<-.Internal(rep(x,times))
+	if(!is.null(nm <- names(x))) names(r) <- .Internal(rep(nm, times))
 	if (!missing(length.out))
 		return(r[1:length.out])
 	return(r)

--- aperm~	Sun Nov 24 23:42:20 1996
+++ aperm	Tue May 20 18:20:10 1997
@@ -7,5 +7,7 @@
 		if(!all(sort(perm)==1:length(perm)))
 			stop("perm is not a permutation")
 	}
-	.Internal(aperm(a,perm,resize))
+	r <- .Internal(aperm(a, perm, resize))
+	if(!is.null(dn <- dimnames(a))) dimnames(r) <- dn[perm]
+	r
 }

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 17:25:41 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 18:25:41 +0200
Subject: R-alpha: S_alloc
Message-ID: <199705201625.SAA27815@aragorn.ci.tuwien.ac.at>

Does anyone know what exactly S_alloc() does?  (Yes, it's porting time
again ...)

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Tue May 20 18:38:54 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Tue, 20 May 1997 12:38:54 -0500 (CDT)
Subject: R-alpha: S_alloc
In-Reply-To: <199705201625.SAA27815@aragorn.ci.tuwien.ac.at> from "Kurt Hornik" at May 20, 97 06:25:41 pm
Message-ID: <9705201738.AA09065@nokomis.stat.umn.edu>

Kurt Hornik wrote:
> 
> Does anyone know what exactly S_alloc() does?  (Yes, it's porting time
> again ...)
> 
> Thanks,
> -k
> =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> 

I believe it allocates zero'd memory like calloc but S is responsible
for freeing it (calling free on it probably has "unpredictable results
..."). S probably usually frees the memry on return from the function
call that got you into C code. In old versions of S I think this was
managed by saving/ resetting the sbrk on function entry/exit and
allocating above the current sbrk value. THis way memory used in a
function was recovered just by restoring the sbrk -- a nice
stack-based discipline. I think the current strategy is a bit
different both to allow portability and to improve memory recovery
during a function call. As a rasult, memory allocated may not be freed
right after the outer call returns, but since S doesn't have a garbage
collector as such it probably has to happen pretty soon after the
return.

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:46:18 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:46:18 +0200
Subject: R-alpha: planned update of ctest
Message-ID: <199705201746.TAA28426@aragorn.ci.tuwien.ac.at>

I am contemplating improving my ctest package as follows:

* Add exact p,q,r,s functions for the Wilcoxon distribution, and change
the test accordingly (make `exact' work).

* Make Fisher's test work for tables larger than 2 by 2.

* Perhaps add an exact unconditional test for 2 by 2 tables?

* Perhaps add something on estimating/testing relative risk and odds?

As clearly I'd like to minimize my efforts I'd be happy about any
suggestion for availability of code, and for a good interface for the
last idea.

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:50:56 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:50:56 +0200
Subject: R-alpha: elementary statistics
Message-ID: <199705201750.TAA28447@aragorn.ci.tuwien.ac.at>

A while ago, Peter wrote

In the same vein, we'll need plot.distrib() (based on Martins plot.step)
plot.KM() (Kaplan-Meier plots, ditto) and logrank.test(). I.e. all the
"statistical over-the-counter medicine". (And in teaching them we'll
ruthlessly ignore all the fine points of the fine language...)

Has anyone looked into this?

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Tue May 20 18:52:49 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Tue, 20 May 1997 19:52:49 +0200
Subject: No subject
Message-ID: <199705201752.TAA28456@aragorn.ci.tuwien.ac.at>

And finally, for something completely different.  I am contemplating
teaching a course on `Statistical Computing' next semester.  Sort of a
basic introduction on statistical software, with emphasis on Xlisp-STAT
plus ViSta and, of course, R.

Would anyone have (or know of) material that I could use?

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 20 19:18:02 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 20 May 1997 20:18:02 +0200
Subject: R-alpha: planned update of ctest
In-Reply-To: Kurt Hornik's message of Tue, 20 May 1997 19:46:18 +0200
References: <199705201746.TAA28426@aragorn.ci.tuwien.ac.at>
Message-ID: <x2raf2uhwl.fsf@bush.kubism.ku.dk>

Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

> 
> I am contemplating improving my ctest package as follows:
> 
> * Add exact p,q,r,s functions for the Wilcoxon distribution, and change
> the test accordingly (make `exact' work).
> 
> * Make Fisher's test work for tables larger than 2 by 2.
> 
> * Perhaps add an exact unconditional test for 2 by 2 tables?
> 
> * Perhaps add something on estimating/testing relative risk and odds?
> 
> As clearly I'd like to minimize my efforts I'd be happy about any
> suggestion for availability of code, and for a good interface for the
> last idea.

As usual, all you'll get is suggestions for more enhancements:

* Order-based statistics with scores different from ranks (i.e. Van
der Waerdens test, etc.)

* Logrank test (a bit hefty to pull out the survival package for that)

* Stratified tests. I actually need those (Wilcoxon and K-W versions)
for a client, so I might put a new student computational assistant on
it. Not sure whether that will break her in or just break her,
though...

Re. relative risks, you can quite easily setup an exact test for 
RR=r (I forget, but it's something like multiplying the point
probabilities in Fishers test with r^x). Consequently, you can also
compute confidence intervals. One snag is the usual mess with the
definition of the two-sided p-value. I have previously used two sided
intervals consisting of those values that weren't significantly too
big [1] at the alpha/2 level nor significantly too small at the same
level, but I'm not altogether sure that holds.

[1] Yeah, yeah. "...for which the data were not significantly too
small, using a one-sided test", etc.
-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 09:19:14 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 10:19:14 +0200
Subject: R-alpha: plot.default(.) : (too?) many  "..."  ---  plot(.., lab =c(10,10,7)) fails
Message-ID: <9705210819.AA00743@>

A simple example:
	plot(1:10, 1:10, main = "TITLE", lab = c(10,10,7))
	 #> Error: invalid subscript type

The reason is the call to  axis(1, ...) in  plot.default(.).

plot.default has the  ...  arguments in order to pass the many different
possible 'par' options to it's own subfunctions.

Currently, plot.default has

 plot.xy(xy, type, col = col, pch = pch, cex = cex, bg = bg, lty = lty, ...)
 axis(1, ...)
 axis(2, ...)
 box(...)
 title(main = main, xlab = xlab, ylab = ylab, ...)


In order for this to work, all the subfunctions MUST be tolerant to all
possible argument specifications.
axis(.) is NOT  which leads to the above  Error.

A different approach would be to "analyze"  list(...),
extract relevant parameters and pass them to the different sub-functions of
plot.default(.).

BY THE WAY:

  It would be nice to be able to say

	par(reset = TRUE)  

  (or similar) for resetting all the graphical parameters to their (device-dependent)
  default values.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 21 11:31:05 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 21 May 1997 12:31:05 +0200
Subject: R-alpha: factors ...
Message-ID: <199705211031.MAA31074@aragorn.ci.tuwien.ac.at>

Perhaps someone can enlighten me here:

R> x <- factor(LETTERS[1:3])
R> x
[1] A B C
R> mode(x)
[1] "factor"
R> class(x)
[1] "factor"
R> mode(unclass(x))
[1] "factor"

S-PLUS has

> x <- factor(LETTERS[1:3])
> mode(x)
[1] "numeric"
> class(x)
[1] "factor"
> mode(unclass(x))
[1] "numeric"

???
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 21 11:32:45 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 21 May 1997 12:32:45 +0200
Subject: R-alpha: iris
Message-ID: <199705211032.MAA31089@aragorn.ci.tuwien.ac.at>

Also, why is the iris data set shipped with R different from the one
that comes with S-PLUS?

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 12:00:00 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 13:00:00 +0200
Subject: R-alpha: plot(1); axis(1, at=10) >>> Seg.fault  -- and a patch
Message-ID: <9705211100.AA00805@>


This problem has been mentioned  by Arne Kovac <maak@stats.bris.ac.uk>  on May 9-10.
The patch is really a replacement of 'axis' in  RHOME/src/library/base/funs/

It contains the fixes which where proposed Arne Kovac
and fixes (all?) the errors he/she (?) reported on May 9.

"axis" <-
function (which, at, labels = TRUE, ...) 
{
	if (which%%2 == 1) {
		axp <- par("xaxp")
		usr <- par("usr")[1:2]
		log <- par("xlog")
	}
	else {
		axp <- par("yaxp")
		usr <- par("usr")[3:4]
		log <- par("ylog")
	}
	if (missing(at)) {
		if (log) {
			if (usr[2] < usr[1] + 1) {
				at <- seq(axp[1], axp[2], length = axp[3] + 1)
			}
			else {
				p1 <- ceiling(min(usr))
				p2 <- floor(max(usr))
				if (p2 - p1 < 2) {
				 at <- c(1, 2, 5) * 10^rep(p1:p2, rep(3, p2 - p1 + 1))
				 at <- at[10^usr[1] <= at & at < 10^usr[2]]
				}
				else at <- 10^seq(p1, p2, by = 1)
			}
		}
		else at <- seq(axp[1], axp[2], length = axp[3] + 1)
		ind <- rep(TRUE, length(at))
	}
	else {
		ind <- (usr[1] <= at & at <= usr[2])
	}
	if (is.logical(labels)) {
		if (labels) {
			if (!log) 
				at[abs(at/(max(at) - min(at))) < 0.001] <- 0
			labels <- format(at, trim = T)
		}
		else labels <- rep("", length(at))
	}
	else labels <- format(labels, trim = T)
	.Internal(axis(which, as.double(at[ind]), labels[ind], ...))
}

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From la-jassine@aix.pacwan.net  Wed May 21 16:00:51 1997
From: la-jassine@aix.pacwan.net (Paul Gilbert)
Date: Wed, 21 May 1997 12:00:51 -0300
Subject: R-alpha: Eigenvalue Computation Query
Message-ID: <1347889984-174502@aix.pacwan.net>

Ross

>Should I drop this special code and always compute both eigenvalues
>and eigenvectors?  This would substantially reduce code size, but might
>increase computational cost in the case where only eigenvalues are
>needed.

I often need the eigenvalues only, but in my experience the main causes for
slowness is when I start using more memory than is physically available. (My
machine starts sounding like it does when I run S.) I would guess that
reducing code size may be more valuable than the specialized code.

Paul Gilbert

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 21 16:01:11 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 May 1997 08:01:11 -0700 (PDT)
Subject: R-alpha: factors ...
In-Reply-To: <199705211031.MAA31074@aragorn.ci.tuwien.ac.at>
Message-ID: <Pine.SUN.3.95.970521075757.7924A-100000@zen>

On Wed, 21 May 1997, Kurt Hornik wrote:

> Perhaps someone can enlighten me here:
> R> x <- factor(LETTERS[1:3])
> [1] "factor"
> 
> S-PLUS has
> > x <- factor(LETTERS[1:3])
> > mode(unclass(x))
> [1] "numeric"

It's a feature. R has a primitive factor type, S-PLUS doesn't and so loses
factorness with unclass(). You can use as.numeric() to coerce to numeric
in either system. 


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Wed May 21 18:04:35 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Wed, 21 May 97 19:04:35 +0200
Subject: R-alpha: Plot: Title above 'mfrow=c(2,2)' ??
Message-ID: <9705211704.AA01031@>


In S, I can have an "overall" title in a multi-figure plot :

    par(mfrow=c(2,2), oma = c(0,0,2,0))
    frame() #- !
    mtext("Sine Functions", cex=2, outer =T)
    x_1:100
    for(i in 1:4) plot(x, sin(i*pi*x/100), main=paste(i), type = 'l', col = 1+i)

In R, this doesn't work as it should,  with and without the 'frame()' 
statement.
((where is the bug?  It's not quite clear to me))

Is there a way at all to write an "overall" title in this situation ?

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Wed May 21 18:08:26 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Wed, 21 May 1997 10:08:26 -0700 (PDT)
Subject: R-alpha: Plot: Title above 'mfrow=c(2,2)' ??
In-Reply-To: <9705211704.AA01031@>
Message-ID: <Pine.SUN.3.95.970521100651.7972C-100000@zen>

On Wed, 21 May 1997, Martin Maechler wrote:

> In S, I can have an "overall" title in a multi-figure plot :
> 
> 
> Is there a way at all to write an "overall" title in this situation ?

 par(mfrow=c(2,2), oma = c(0,0,2,0))
 # do the plots
 par(mfrow=c(1,1))
 title(main="blah")



Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Wed May 21 21:26:43 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 May 1997 08:26:43 +1200 (NZST)
Subject: R-alpha: factors ...
Message-ID: <199705212026.IAA00840@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:

> Perhaps someone can enlighten me here:

> R> x <- factor(LETTERS[1:3])
> R> x
> [1] A B C
> R> mode(x)
> [1] "factor"
> R> class(x)
> [1] "factor"
> R> mode(unclass(x))
> [1] "factor"

> S-PLUS has

> > x <- factor(LETTERS[1:3])
> > mode(x)
> [1] "numeric"
> > class(x)
> [1] "factor"
> > mode(unclass(x))
> [1] "numeric"

> ???

Originally, factors in R were implemented as a special type.  This was
partly because we didn't have objects at the start, and partly because
S factors have a annoying habit of forgetting that they are factors.  E.g.

	> x <- factor(LETTERS[1:3])
	> c(x, 1)
	[1] 1 2 3 1
	> c(x,"a")
	[1] "1" "2" "3" "a"

However, in order to be compatible with S, a factor "x" needs to
satisfy inherits(x,"factor").  So we also attach "class" of factor to
them as well.  Any "class" manipulations use the "class" attribute but
all internal manipulations are based on the "mode".

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Wed May 21 21:29:24 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 22 May 1997 08:29:24 +1200 (NZST)
Subject: R-alpha: iris
Message-ID: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>

> Also, why is the iris data set shipped with R different from the one
> that comes with S-PLUS?

Do you mean the numbers in the data, or the fact that we have a data
frame and they have a 50x4x3 array?   (I've never understood why anyone
would have structured the iris data that way ...).
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 06:28:52 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 07:28:52 +0200
Subject: R-alpha: iris
In-Reply-To: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>
References: <199705212029.IAA00868@stat1.stat.auckland.ac.nz>
Message-ID: <199705220528.HAA03991@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

>> Also, why is the iris data set shipped with R different from the one
>> that comes with S-PLUS?

> Do you mean the numbers in the data, or the fact that we have a data
> frame and they have a 50x4x3 array?   (I've never understood why anyone
> would have structured the iris data that way ...).

The latter.  I am playing a bit with porting Brian's `class' library,
and surprisingly the tests he has use the iris data set ...

The df makes more sense, right.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 12:25:46 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 13:25:46 +0200
Subject: No subject
Message-ID: <199705221125.NAA05423@aragorn.ci.tuwien.ac.at>

Does anyone have a description of the S help format?
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 13:07:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 14:07:16 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <199705221125.NAA05423@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Thu, 22 May 1997 13:25:46 +0200)
Message-ID: <9705221207.AA01336@>

>>>>> "Kurt" == Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at> writes:

    Kurt> Does anyone have a description of the S help format?  -k

Not really, here is what you get from  ?prompt  in S-plus

 Construct Documentation for Function or Data


 DESCRIPTION:
	Produces a file that can be edited  and  then  nroffed  or
	troffed  to give documentation (a helpfile) for a function
	or dataset.

 USAGE:
	prompt(object, filename=<<see below>>)

 REQUIRED ARGUMENTS:
 object:   name or character string giving the name of a  function
	or data object.

 OPTIONAL ARGUMENTS:
 filename:   filename for resulting documentation; the default  is
	name.d, where name is the character string  resulting from
	deparsing the object name.

 SIDE EFFECTS:
	A file is written, containing an outline  for  documenting
	the  function  or  object.   A  message  is printed to the
	screen giving the name of the created file.  The file will
	eventually  be  used  by  the  help  function  to  produce
	documentation for the object.  As produced by prompt,  the
	file  for a function will contain the call to the function
	and individual sections for each of  the  arguments.   The
	file  for  a  data frame will contain the name of the data
	frame, its dimensions, and individual sections for each of
	the variables in the data frame.

 DETAILS:
	This is a generic function; there is  a  method  for  data
	frames and a default method.

	You will need to fill in the actual information about  the
	arguments,  a  description  of  the  value returned by the
	function, examples,  and  whatever  other  information  is
	appropriate.  Lines in the file that contain "~" should be
	replaced with  appropriate  information.   Arguments  that
	must  be  specified  in the name=value form should have an
	equal sign (=) added after name on the .AG name line.

	To add a section such as "WARNING" make a  line  beginning
	with  ".SH"  (for  example,  ".SH  WARNING")  and  put the
	information on subsequent  lines.  A  line  consisting  of
	".ul" italicizes the next line.

	The correct order of sections for help files created  with
	prompt.default  is as follows:  Title, Description, Usage,
	Required Arguments, Optional  Arguments,  ".GR"  (graphics
	parameters),   Value,   Side  Effects,  Warning,  Details,
	Background, References, See Also, Examples, Keywords.  The
	"Note"  section,  if  it  appears, may be anywhere between
	Side Effects and References.

	The correct order of sections for help files created  with
	prompt.data.frame  is  as  follows:   Title, Summary, Data
	Description, Source, Note, Warning, See Also, Examples.

	Be sure to leave the line .WR at the  end  of  file;  this
	wraps  things  up  neatly.   If  you  see the message trap
	botch, it is probably from a help file without a .WR.

	For a full description of the formatting macros  available
	in  help files, see the section Documenting Your Module in
	the  chapter  Developing  New  Modules   in   the   S-PLUS
	Programmer's Manual.

	Documentation for functions and data resides (as  ordinary
	text  files)  in  a  subdirectory  called  .Help under the
	directory containing the S-PLUS objects  themselves.   For
	example,  if  you  are documenting a function myfun in the
	directory /usr/me/.Data, the completed documentation  file
	should be moved into the .Help directory with the command

	     mv myfun.d /usr/me/.Data/.Help/myfun

	To see more about how documentation files  are  organized,
	look  at some examples.  Documentation files for functions
	are   in   the   directories    $SHOME/s/.Functions/.Help,
	$SHOME/stat/.Functions/.Help                           and
	$SHOME/splus/.Functions/.Help where $SHOME is  the  S-PLUS
	home directory.  Type

	     !echo $SHOME/s/.Functions/.Help

	from inside S-PLUS to see where this is on your machine.


	You can find more information in the chapter Enhancing  S-
	PLUS of the S-PLUS Installation and Maintenance Manual  in
	the sections entitled Adding Help Files for New  Functions
	and Modifying S-PLUS Keywords.

 SEE ALSO:
	The section "Documenting  Your  Module"  in  the   chapter
	"Developing   New  Modules"  of  the  S-PLUS  Programmer's
	Manual.

	help, help.start, Question.mark.

 EXAMPLES:
	prompt("mygrep")    # construct mygrep.d file
	!vi mygrep.d  # fix up the documentation
	!mkdir .Data/.Help  # if necessary, construct subdirectory
	!mv mygrep.d .Data/.Help/mygrep    # install

--------------------------
Why do you need it?

Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
It contains quite a bit of implicit documentation on the S-help format.
I've been using it a few times  more or less successfully.

YES:	This should come in the  $RHOME/etc/ directory !

- Martin
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Friedrich.Leisch@ci.tuwien.ac.at  Thu May 22 14:32:02 1997
From: Friedrich.Leisch@ci.tuwien.ac.at (Friedrich Leisch)
Date: Thu, 22 May 1997 15:32:02 +0200
Subject: R-alpha: missing warning message
Message-ID: <199705221332.PAA08887@galadriel.ci.tuwien.ac.at>


In R it is possible to write nonsense 

R> 0.5:4:3:9:8:5
[1] 0.5 1.5 2.5 3.5 4.5

and never be warned about it, Splus does the expected thing:

Splus> 0.5:4:3:9:8:5
[1] 0.5 1.5 2.5 3.5 4.5
Warning messages:
1: Numerical expression has 4 elements: only the first used in: 0.5:4:3
2: Numerical expression has 3 elements: only the first used in: 0.5:4:3:9
3: Numerical expression has 9 elements: only the first used in: 0.5:4:3:9:8
4: Numerical expression has 8 elements: only the first used in: 0.5:4:3:9:8:5


Best,
Fritz

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 15:41:16 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 16:41:16 +0200
Subject: R-alpha: options(..) vs.  .Options  //  Re(1i) = 2.4976e-307
Message-ID: <9705221441.AA01396@>

The 	.Options

vector had been introduced a while ago after my suggestion
(see Ross's E-mail below).
.Options$digits is used be default in several  print methods (eg print.lm),
however, deparse(.) e.g., uses options()$width, and not .Options$width.

Another problem is that  .Options
is still not in the documentation (on-line help).
Before one could add it there, we'd need ``the specs''.

I think the (at least my) idea was that

	options(.)  queries or sets elements in the   .Options  list

and all functions -- including the internal ones -- use  .Options.
As far as I know, this is what S does.
Currently, this is NOT the case in R.

Ross said a while ago:

   >>> From: Ross Ihaka <ihaka@stat.auckland.ac.nz>
   >>> Date: Wed, 11 Dec 1996 17:10:59 +1300 (NZDT)
   >>> To: Martin Maechler <maechler@stat.math.ethz.ch>
   >>> Cc: R-testers mailing list <R-testers@stat.math.ethz.ch>
   >>> Subject: R-alpha: options() and .Options -- ?

    Ross> Martin Maechler writes:
    >> This is not a bug report, rather than some remarks as a
    >> "request for comments":
    >>
    >> It is clear that  options( foo = bar )
    >> sets the option and also updates the builtin()  .Options  list :
    >> 
    >> > options(myopt = pi)
    >> > .Options$my
    >> [1] 3.14159265
    >> 
    >> In S-plus, it was (is) possible to use .Options locally in a function
    >> frame in order to just affect some options during evaluation of that
    >> function.

    Ross> I have made some changes so that such local assignments to .Options
    Ross> will work.  The down side is that such assignments will also work at
    Ross> top level with the changes shadowing the real system options.

    Ross> This also may be ok.  It would have the advantage that options would
    Ross> then be preserved from session to session.  Is this a good idea or a
    Ross> bad idea?

----------
Different issue:

> Re(1i)
[1] 2.497599e-307

rather than  0  whereas  Im(as.complex(1)) gives 0 as it should.

- Martin Maechler
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Thu May 22 15:45:50 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Thu, 22 May 97 16:45:50 +0200
Subject: R-alpha: Re:  Re(1i) = 2.4976e-307
In-Reply-To: <9705221441.AA01396@> (message from Martin Maechler on Thu, 22
 May 97 16:41:16 +0200)
Message-ID: <9705221445.AA01404@>

It is really not 'Re',
but the parser for complex constants which is at fault:

> 1i - complex(imag=1)
[1] 2.497599e-307+0i
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Thu May 22 17:22:07 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Thu, 22 May 1997 09:22:07 -0700 (PDT)
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <9705221207.AA01336@>
Message-ID: <Pine.SUN.3.95.970522091037.8749A-100000@zen>

> Why do you need it?
> 
> Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
> on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
> It contains quite a bit of implicit documentation on the S-help format.
> I've been using it a few times  more or less successfully.
> 
> YES:	This should come in the  $RHOME/etc/ directory !
> 
> - Martin

Largely because it isn't a very nice script.  The output is tolerable but
not great -- for example it doesn't use some of the proper R headings for
sections and it doesn't hyperlink the SEE ALSO section. These problems
don't really show up in the help() output but are more obvious in HTML. 

Someone (eg me in about a month from now if someone else hasn't done it
first) needs to work on improving it.  I suspect Kurt or his minions are
planning exactly that :-). 

On the related subject of regular expressions, I'm having trouble with the
\1 construction for the last matched expression
(eg  \([a-zA-Z][^:]*\):\1 which I think should match things of the form
blah:blah)
No matter how many extra \ characters I put in it doesn't work.


Thomas Lumley
-----------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Thu May 22 17:26:35 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Thu, 22 May 1997 18:26:35 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <Pine.SUN.3.95.970522091037.8749A-100000@zen>
References: <9705221207.AA01336@>
 <Pine.SUN.3.95.970522091037.8749A-100000@zen>
Message-ID: <199705221626.SAA06171@aragorn.ci.tuwien.ac.at>

>>>>> Thomas Lumley writes:

>> Why do you need it?
>> 
>> Thomas Lumley has posted a nice 'S-help-to-Rhelp' script on the R-testers list
>> on  Tue, 24 Sep 1996 08:53:34 -0700 (PDT).
>> It contains quite a bit of implicit documentation on the S-help format.
>> I've been using it a few times  more or less successfully.
>> 
>> YES:	This should come in the  $RHOME/etc/ directory !
>> 
>> - Martin

> Largely because it isn't a very nice script.  The output is tolerable but
> not great -- for example it doesn't use some of the proper R headings for
> sections and it doesn't hyperlink the SEE ALSO section. These problems
> don't really show up in the help() output but are more obvious in HTML. 

> Someone (eg me in about a month from now if someone else hasn't done it
> first) needs to work on improving it.  I suspect Kurt or his minions are
> planning exactly that :-).

Yes, that was the idea.  I sort of converted the script to perl today so
that Fritz can start his magic ... we'll see.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 22 17:32:43 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 22 May 1997 18:32:43 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: Thomas Lumley's message of Thu, 22 May 1997 09:22:07 -0700 (PDT)
References: <Pine.SUN.3.95.970522091037.8749A-100000@zen>
Message-ID: <x2n2pnh3h0.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> On the related subject of regular expressions, I'm having trouble with the
> \1 construction for the last matched expression
> (eg  \([a-zA-Z][^:]*\):\1 which I think should match things of the form
> blah:blah)
> No matter how many extra \ characters I put in it doesn't work.

In what connection? In egrep, consider taking some of them out:

$ egrep '([a-zA-Z][^:]*):\1'
blah:blah
blah:blah
a:a
a:a
A.
A:
A:A
A:A
A:AB
A:AB
AB:B
AB:B
AB:AB
AB:AB
AB:A


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Thomas Lumley <thomas@biostat.washington.edu>  Thu May 22 17:52:10 1997
From: Thomas Lumley <thomas@biostat.washington.edu> (Thomas Lumley)
Date: Thu, 22 May 1997 09:52:10 -0700 (PDT)
Subject: R-alpha: R-beta: regex
In-Reply-To: <x2n2pnh3h0.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970522094711.8749D-100000@zen>

On 22 May 1997, Peter Dalgaard BSA wrote:
> 
> In what connection? In egrep, consider taking some of them out:
> 

I meant the grep() function in R (which needs \ to be quoted)
 grep("([A-Za-z][^:]*):\1","Ac:Ac",value=T)
character(0)
> grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
character(0)
> grep("([A-Za-z][^:]*):\\\1","Ac:Ac",value=T)
character(0)
> 
but
> grep("([A-Za-z][^:]*):","Ac:Ac",value=T)
[1] "Ac:Ac"


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From luke@stat.umn.edu  Thu May 22 18:10:52 1997
From: luke@stat.umn.edu (Luke Tierney)
Date: Thu, 22 May 1997 12:10:52 -0500 (CDT)
Subject: R-alpha: options(..) vs.  .Options  //  Re(1i) = 2.4976e-307
In-Reply-To: <9705221441.AA01396@> from "Martin Maechler" at May 22, 97 04:41:16 pm
Message-ID: <9705221710.AA05868@nokomis.stat.umn.edu>

Martin Maechler wrote:
> 
> The 	.Options
> 
> vector had been introduced a while ago after my suggestion
> (see Ross's E-mail below).
> .Options$digits is used be default in several  print methods (eg print.lm),
> however, deparse(.) e.g., uses options()$width, and not .Options$width.
> 
> Another problem is that  .Options
> is still not in the documentation (on-line help).
> Before one could add it there, we'd need ``the specs''.
> 
> I think the (at least my) idea was that
> 
> 	options(.)  queries or sets elements in the   .Options  list
> 
> and all functions -- including the internal ones -- use  .Options.
> As far as I know, this is what S does.
> Currently, this is NOT the case in R.
> 

If I understand this right (which may be a big if :-)) this is a bit
tricky.  What S is trying to do is make .Options a dynamically scoped
variable. This seems to work fine from the user perspective, i.e. if I
do

	g<-function(x) print(x)
	f<-function(x) { .Options$digits<-3; g(x) }

then I get the "right thing"

> f(888888888)
[1] 8.89e+08
[1] 888888888

but actually writing your own functions that use .Options is tricky --

	g<-function() .Options$digits
	f<-function() { .Options$digits<-3; g() }

produces

> f()
[1] 7
> 

since the reference to .Options is governed by ordinary scoping rules.
So some convenient way of looking up the closest dynamic binding is
needed -- just referencing .Options in print.lm, for example, won't do
it. Current Splus defines several methods for print and summary that
just reference .Options, but unless some internal magic is being used
for this name, they won't work as expected.

luke



-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
206 Church Street                            email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Thu May 22 18:15:44 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 22 May 1997 19:15:44 +0200
Subject: R-alpha: R-beta: regex
In-Reply-To: Thomas Lumley's message of Thu, 22 May 1997 09:52:10 -0700 (PDT)
References: <Pine.SUN.3.95.970522094711.8749D-100000@zen>
Message-ID: <x2k9krh1hb.fsf@bush.kubism.ku.dk>

Thomas Lumley <thomas@biostat.washington.edu> writes:

> 
> On 22 May 1997, Peter Dalgaard BSA wrote:
> > 
> > In what connection? In egrep, consider taking some of them out:
> > 
> 
> I meant the grep() function in R (which needs \ to be quoted)
>  grep("([A-Za-z][^:]*):\1","Ac:Ac",value=T)
> character(0)
> > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
> character(0)
> > grep("([A-Za-z][^:]*):\\\1","Ac:Ac",value=T)
> character(0)
> > 
> but
> > grep("([A-Za-z][^:]*):","Ac:Ac",value=T)
> [1] "Ac:Ac"
> 

I strongly suspect that no number of \s will make it work as long as
do_grep() in main/character.c contains this line:

        eflags = REG_NOSUB;



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 22 21:03:56 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 23 May 1997 08:03:56 +1200 (NZST)
Subject: R-alpha: missing warning message
Message-ID: <199705222003.IAA14092@stat1.stat.auckland.ac.nz>

> In R it is possible to write nonsense 

> R> 0.5:4:3:9:8:5
> [1] 0.5 1.5 2.5 3.5 4.5

> and never be warned about it, Splus does the expected thing:

> Splus> 0.5:4:3:9:8:5
> [1] 0.5 1.5 2.5 3.5 4.5
> Warning messages:
> 1: Numerical expression has 4 elements: only the first used in: 0.5:4:3
> 2: Numerical expression has 3 elements: only the first used in: 0.5:4:3:9
> 3: Numerical expression has 9 elements: only the first used in: 0.5:4:3:9:8
> 4: Numerical expression has 8 elements: only the first used in: 0.5:4:3:9:8:5

I'll put a warning in, but ...

This is one place where the recycling rule is violated.  I've thought
for a while about implementing

	m : n

in the following way

	c(m[1]:n[1] , m[2]:n[2] , ...)

with the shorter argument being recycled out to the length of the longer
one.  I have seen at least one application where this extended could
be used.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 22 22:30:31 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Fri, 23 May 1997 09:30:31 +1200 (NZST)
Subject: R-alpha: S-help  (and  S-help-to-R-help)
Message-ID: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>

Before you invest too much effort in fancy conversion scripts ...

I really want to change the documentation format to something based on
SGML - this should be much easier to parse than the present m4
macro-based stuff, and allow use to use more sophisticated tools for
the construction and processing of documentation.

Like much of R, the present solution was just a temporary hack ...
But it is something which is getting to the top of the list.

Any filter you create should have a back-end which could be (easily)
adapted to a new format.

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 06:02:04 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 07:02:04 +0200
Subject: R-alpha: S-help  (and  S-help-to-R-help)
In-Reply-To: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>
References: <199705222130.JAA14823@stat1.stat.auckland.ac.nz>
Message-ID: <199705230502.HAA00661@aragorn.ci.tuwien.ac.at>

>>>>> Ross Ihaka writes:

> Before you invest too much effort in fancy conversion scripts ...
> I really want to change the documentation format to something based on
> SGML - this should be much easier to parse than the present m4
> macro-based stuff, and allow use to use more sophisticated tools for
> the construction and processing of documentation.

Nothing fancy.  Thomas' script has a few (minor) problems, and I'd like
to fix them.

> Like much of R, the present solution was just a temporary hack ...
> But it is something which is getting to the top of the list.

> Any filter you create should have a back-end which could be (easily)
> adapted to a new format.

Hmm.  I think it's more like looking into the S help format to figure
out what is going on.  The new one which converts to SGML will perhaps
be somewhere in between converting to LaTeX and to current R help
format.

-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 06:33:03 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 07:33:03 +0200
Subject: R-alpha: apropos() available
Message-ID: <199705230533.HAA01011@aragorn.ci.tuwien.ac.at>

Martin and I have `written' a function apropos() for finding all objects
with names matching pattern.  I attach code and documentation.  Perhaps
one could include it in the distribution proper.

We are not sure about returning the position in the search list along
with the matching names found.  Martin thinks it should be on by
default, I think it should be off so that the functions does the same as
in Lisp systems ... Perhaps someone else can decide.

-k

*** apropos.R **********************************************************
apropos <- function (pattern) {
  x <- character(0)
  for (i in 1 : length(search()))
    x <- c(x, ls(pos =3D i, pattern =3D pattern))
  x
}

apropos <- function (pattern, where =3D FALSE) {
  ## Give all objects which match  _pattern_.
  ## By	Kurt Hornik & Martin M=E4chler, May 1997.
  x <- character(0)
  for (i in seq(search())) {
    ll <- length(li <- ls(pos =3D i, pattern =3D pattern))
    if (ll)
      if (where)
	x <- c(x, structure(li, names =3D rep(i, ll)))
      else
	x <- c(x, li)
  }
  x
}
*** apropos.d **********************************************************
TITLE(apropos @@ Find all objects with names matching a pattern)
USAGE(apropos(pattern, where =3D FALSE))
ARGUMENTS(
ARG(pattern @@ a regular expression to match against)
ARG(where @@ a logical indicating whether positions in the search list
should also be returned)
)
DESCRIPTION(
LANG(apropos) returns a vector of character strings giving the names of
all objects in the search list matching LANG(pattern).  If LANG(where)
is LANG(TRUE), their position in the search list is returned as their
names attribute.
)
EXAMPLES(
apropos("lm")
apropos("ls")
apropos("lq")
BLANK
# need the `\\'
apropos("\\[")
BLANK
# everything
length(apropos("."))
BLANK
# those starting with `pr'
apropos("^pr")
BLANK
# the 1-letter things
apropos("^.$")
# the 1-2-letter things
apropos("^..?$")
# the 2-to-4 letter things
apropos("^.{2,4}$")
BLANK
# the 8-and-more letter things
apropos("^.{8,}$")
table(nchar(apropos("^.{8,}$")))
)

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May 23 08:51:34 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 23 May 97 09:51:34 +0200
Subject: R-alpha: Re: S-help -- Ultimate doc.== source : $SPLUS/cmd/help.tr & help.nr
In-Reply-To: <199705221607.SAA06102@aragorn.ci.tuwien.ac.at> (message from
 Kurt Hornik on Thu, 22 May 1997 18:07:49 +0200)
Message-ID: <9705230751.AA01646@>

Kurt,
if you really want to find out  what things an  S help file can contain,
you must learn some  nroff/troff  [ maybe use 'groff', the GNU one ].

As always, ultimate documentation is == source.
The definition of the S help is in
the two files
	$SPLUS/cmd/help.[nt]r
where nr ^= nroff, i.e.  ASCII   output
      tr ^= troff  i.e.  printed output (e.g via Postscript conversion)

help.tr starts with

.\" @(#)help.tr.pre version 2.33 created 9/22/95
.\" @(#)Copyright (c), 1987, 1995 StatSci, Inc.  All rights reserved.
.\"
.\" This file defines the macros that S-PLUS help files use.  This file
.\" 	was modified by the S-PLUS SETUP script to tailor it to your system.
.\"


The most important  [nt]roff command  here is
.de AB
	which stands for 'define the  AB  macro'
	which will be referenced by
.AB

------------

Further note:	

	S-plus uses a slightly different help file format than
	'vanilla S' from AT&T.

	E.g, they (StatSci) introduced the extra 
	
	.RA  for 'Required ARGUMENTS'
	.OA  for 'Optional Arguments'
	
	where Chambers et al. just use 'ARGUMENTS' which comes
	automatically before the first argument (with  .AG .... ) is set.
	
PPS:  S version 4 uses a COMPLETELY different system.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Fri May 23 13:01:33 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Fri, 23 May 1997 14:01:33 +0200
Subject: No subject
Message-ID: <199705231201.OAA02114@aragorn.ci.tuwien.ac.at>

Still trying to port Brian's class TB ...

I need to find replacements for seed_in()/seed_out() and unif_rand().
Looks like the first works with GetSeeds()/PutSeeds().  Can anyone help
me with the second one?

THanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Fri May 23 20:17:28 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 23 May 1997 12:17:28 -0700 (PDT)
Subject: R-alpha: R-beta: regex
In-Reply-To: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970523121557.25867B-100000@data>

On 22 May 1997, Peter Dalgaard BSA wrote:

> > > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
> > character(0)

> I strongly suspect that no number of \s will make it work as long as
> do_grep() in main/character.c contains this line:
> 
>         eflags = REG_NOSUB; 

Is this a feature? If so, can it at least be made optional?


Thomas Lumley
------------------------------------------------------+-----
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From thomas@biostat.washington.edu  Sat May 24 00:09:59 1997
From: thomas@biostat.washington.edu (Thomas Lumley)
Date: Fri, 23 May 1997 16:09:59 -0700 (PDT)
Subject: R-alpha: var() and missing
In-Reply-To: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
Message-ID: <Pine.SUN.3.95.970523160648.27149A-100000@data>



var() handles missing values in a very strange way. It is not what the
documentation says
> var(c(NA,1:10))
[1] 0
> var(1:10)
[1] 9.166667
This is because sum() handles NA incorrectly
> sum(NA)
[1] 0
> sum(NA,na.rm=T)
[1] 0
> sum(NA,na.rm=F)
[1] 0

Also the documentation gives a pairwise= option to var() which isn't in
the function.


Thomas Lumley
------------------------------------------------------+------
Biostatistics		: "Never attribute to malice what  :
Uni of Washington	:  can be adequately explained by  :
Box 357232		:  incompetence" - Hanlon's Razor  :
Seattle WA 98195-7232	:				   :
------------------------------------------------------------

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sat May 24 20:55:28 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 25 May 1997 07:55:28 +1200 (NZST)
Subject: R-alpha: R-beta: regex
Message-ID: <199705241955.HAA26240@stat1.stat.auckland.ac.nz>

Just ignorance on my my part.  I thought that "grep" didn't do substitutions.
If it inhibits backreferences I'll kill it.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sat May 24 21:02:50 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Sun, 25 May 1997 08:02:50 +1200 (NZST)
Subject: R-alpha: var() and missing
Message-ID: <199705242002.IAA26269@stat1.stat.auckland.ac.nz>

> var() handles missing values in a very strange way. It is not what the
> documentation says
> > var(c(NA,1:10))
> [1] 0
> > var(1:10)
> [1] 9.166667
> This is because sum() handles NA incorrectly
> > sum(NA)
> [1] 0
> > sum(NA,na.rm=T)
> [1] 0
> > sum(NA,na.rm=F)
> [1] 0

This is a bug brought in by changes to complex arithmetic.  I have a
fix and will have a patch (later today I hope).

> Also the documentation gives a pairwise= option to var() which isn't in
> the function.

I think the interpreted front end doesn't match the real back-end.
I'll change it.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Sun May 25 14:35:04 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Sun, 25 May 1997 15:35:04 +0200
Subject: R-alpha: generic write()
Message-ID: <199705251335.PAA08691@aragorn.ci.tuwien.ac.at>

Attached is a first shot at a generic write with my `old' write.table as
write.data.frame, suitably modified.  There is also a stupid generic
latex function, which is just there because it illustrates that the
extra arguments sep and eol are useful.

In playing with it, I noticed a few `problems'.

* The documentation for factor() says,

	If exclude is set to a zero length vector, then any NA values in
	x are used for form a new level for the factor.  This means that
	there will be no NA values in the result.

Perhaps I don't really understand this, but

R> x <- factor(c(1:3, NA), exclude=numeric(0))
R> x
[1]  1  2  3 NA
R> levels(x)
[1] "1" "2" "3"

???

* coerce.c has two error messages of the form

	error("use \"factor\", \"ordered\", \"cut\" or \"code\" to create factors\n");

but there is no function `code'.

* cat() is a bit inconsistent:

R> cat(x, sep = "&")
1&2&3&4R> cat(x, sep = "&\n")
1&
2&
3&
4
R>

Actually, a final newline is added whenever sep contains a newline.
>From src/main/builtin.c:

        nlsep = 0;
        for (i = 0; i < LENGTH(sepr); i++)
                if (strstr(CHAR(STRING(sepr)[i]), "\n")) nlsep = 1;

	...

        if ((pwidth != INT_MAX) || nlsep)
                Rprintf("\n");

I am not sure this is the right thing to do.

(In particular, it makes it rather messy to incrementally build data
files with `explicit' end-of-line strings (such as "\\") by appending
via cat().)

* I am not sure what should happen with names or dimnames when writing.

* I am also not sure what the optional argument quote should do.  Should
it quote UNCONDITIONALLY, or only the character strings?

-k

***********************************************************************
write <- function(x, file = "data", ...)  UseMethod("write")

write.default <-
function(x, file = "", append = FALSE, quote = FALSE, sep = " ", eol = "\n",
	 na = NA, ncolumns = if (is.character(x)) 1 else 5, ...) {
  if (is.matrix(x)) {
    write.data.frame(x, append = append, quote = quote, sep = sep,
		     eol = eol, na = na, col.names = FALSE, ...) 
  }
  else {
    if (is.factor(x))
      x <- levels(x)[x]
    else
      x <- as.vector(x)
    if (is.vector(x)) {
      x[is.na(x)] <- na
      if (quote)
	x <- paste("\"", x, "\"", sep = "")
      cat(x, file = file, sep = c(rep(sep, ncolumns - 1), eol),
	  append = append)
    }
    else
      stop("No suitable write method available")
  }
}

write.data.frame <-
function(x, file = "", append = FALSE, quote = FALSE, sep = " ", eol = "\n",
	 na = NA, row.names = TRUE, col.names = TRUE)
{
  if (is.data.frame(x) && is.logical(quote) && quote)
    quote <- which(unlist(lapply(x, is.character)))
  x <- as.matrix(x)
  p <- ncol(x)
  d <- dimnames(x)
  x[is.na(x)] <- na
  if (is.logical(quote))
    quote <- if (quote) 1 : p else NULL
  else if (is.numeric(quote)) {
    if (any(quote < 1 | quote > p))
      stop("invalid numbers in quote")
  }
  else
    stop("invalid quote specification")
      
  if (is.logical(row.names)) {
    if (row.names)
      x <- cbind(d[[1]], x)
  }
  else {
    row.names <- as.character(row.names)
    if (length(row.names) == nrow(x))
      x <- cbind(row.names, x)
    else
      stop("invalid row.names specification")
  }
  if (!is.null(quote) && (p < ncol(x)))
    quote <- c(0, quote) + 1

  if (is.logical(col.names))
    col.names <- if (col.names) d[[2]] else NULL
  else {
    col.names <- as.character(col.names)
    if (length(col.names) != p)
      stop("invalid col.names specification")
  }
  if (!is.null(col.names)) {
    if (append)
      warning("appending column names to file")
    if (!is.null(quote))
      col.names <- paste("\"", col.names, "\"", sep = "")
    cat(col.names, file = file, sep = rep(sep, p - 1), append = append)
    cat(eol, file = file, append = TRUE)
    append <- TRUE
  }

  for (i in quote)
    x[, i] <- paste("\"", x[, i], "\"", sep = "")

  cat(t(x), file = file, sep = c(rep(sep, ncol(x) - 1), eol),
      append = append)
}

latex <- function(x, file = "", ...)  UseMethod("latex")

latex.default <- 
function(x, file = "", ...) {
  write(x, file = file, sep = " & ", eol = " \\\\\n", ...)
}
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 20:54:59 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 07:54:59 +1200 (NZST)
Subject: R-alpha: generic write()
Message-ID: <199705251954.HAA29904@stat1.stat.auckland.ac.nz>

Kurt Hornik writes:

>  Attached is a first shot at a generic write with my `old' write.table as
>  write.data.frame, suitably modified.  There is also a stupid generic
>  latex function, which is just there because it illustrates that the
>  extra arguments sep and eol are useful.
>
>  In playing with it, I noticed a few `problems'.
>
>  * The documentation for factor() says,
>
> 	If exclude is set to a zero length vector, then any NA values in
> 	x are used for form a new level for the factor.  This means that
> 	there will be no NA values in the result.
>
>  Perhaps I don't really understand this, but
>
>  R> x <- factor(c(1:3, NA), exclude=numeric(0))
>  R> x
>  [1]  1  2  3 NA
>  R> levels(x)
>  [1] "1" "2" "3"

Looks like a bug to me ...

>  * coerce.c has two error messages of the form
>
> 	error("use \"factor\", \"ordered\", \"cut\" or \"code\" to create factors\n");
>
>  but there is no function `code'.

A VERY old (pre- 0.1) error message

>  * cat() is a bit inconsistent:
>
>  R> cat(x, sep = "&")
>  1&2&3&4R> cat(x, sep = "&\n")
>  1&
>  2&
>  3&
>  4
>  R>
>
>  Actually, a final newline is added whenever sep contains a newline.
>  >From src/main/builtin.c:
>
>         nlsep = 0;
>         for (i = 0; i < LENGTH(sepr); i++)
>                 if (strstr(CHAR(STRING(sepr)[i]), "\n")) nlsep = 1;
>
> 	...
>
>         if ((pwidth != INT_MAX) || nlsep)
>                 Rprintf("\n");
>
>  I am not sure this is the right thing to do.
>
>  (In particular, it makes it rather messy to incrementally build data
>  files with `explicit' end-of-line strings (such as "\\") by appending
>  via cat().)
 
I will look at this a bit more (and compare with the AT&T prototype).

	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From rgentlem@stat.auckland.ac.nz  Sun May 25 21:55:10 1997
From: rgentlem@stat.auckland.ac.nz (Robert Gentleman)
Date: Mon, 26 May 1997 08:55:10 +1200 (NZST)
Subject: R-alpha: cat
Message-ID: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>

Kurt,
  here's what S does (I recall going to some effort to duplicate the,
at times, seemingly unusual behaviour of cat)
S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
S : Copyright AT&T.
Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
Working data will be in /users/rdev/rgentlem/.Data 
>  x <- factor(c(1:3, NA), exclude=numeric(0))
> x
[1] 1  2  3  NA
> levels(x)
[1] "1"  "2"  "3"  "NA"
> cat(x, sep = "&")
1&2&3&4> cat(x, sep = "&\n")
1&
2&
3&
4
>

so, the behaviour of cat is the same (whether it's correct or not .....)

robert
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:01:12 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:01:12 +1200 (NZST)
Subject: R-alpha: Re:  Re(1i) = 2.4976e-307
In-Reply-To: <9705221445.AA01404@>
References: <9705221441.AA01396@>
 <9705221445.AA01404@>
Message-ID: <199705252201.KAA00938@stat1.stat.auckland.ac.nz>

Martin Maechler writes:
 > It is really not 'Re',
 > but the parser for complex constants which is at fault:
 > 
 > > 1i - complex(imag=1)
 > [1] 2.497599e-307+0i

This is an error in the function mkComplex.  It sets the imaginary
part, but leaves the real part uninitialized.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:05:43 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:05:43 +1200 (NZST)
Subject: R-alpha: R-beta: regex
In-Reply-To: <Pine.SUN.3.95.970523121557.25867B-100000@data>
References: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
 <Pine.SUN.3.95.970523121557.25867B-100000@data>
Message-ID: <199705252205.KAA01001@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > On 22 May 1997, Peter Dalgaard BSA wrote:
 > 
 > > > > grep("([A-Za-z][^:]*):\\1","Ac:Ac",value=T)
 > > > character(0)
 > 
 > > I strongly suspect that no number of \s will make it work as long as
 > > do_grep() in main/character.c contains this line:
 > > 
 > >         eflags = REG_NOSUB; 
 > 
 > Is this a feature? If so, can it at least be made optional?

I have changed it to:

	eflags = 0;

Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Sun May 25 23:09:47 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Mon, 26 May 1997 10:09:47 +1200 (NZST)
Subject: R-alpha: var() and missing
In-Reply-To: <Pine.SUN.3.95.970523160648.27149A-100000@data>
References: <x2k9krh1hb.fsf@bush.kubism.ku.dk>
 <Pine.SUN.3.95.970523160648.27149A-100000@data>
Message-ID: <199705252209.KAA01030@stat1.stat.auckland.ac.nz>

Thomas Lumley writes:
 > 
 > 
 > var() handles missing values in a very strange way. It is not what the
 > documentation says
 > > var(c(NA,1:10))
 > [1] 0
 > > var(1:10)
 > [1] 9.166667
 > This is because sum() handles NA incorrectly
 > > sum(NA)
 > [1] 0
 > > sum(NA,na.rm=T)
 > [1] 0
 > > sum(NA,na.rm=F)
 > [1] 0
 > 
 > Also the documentation gives a pairwise= option to var() which isn't in
 > the function.

I did want to move toward an implementation which is more like
"na.action", rather than "na.rm".  Often computations based on
correlations based on all observations which are complete for pairs of
variables do make sense.

"var" seems to have been skipped.  What is the right strategy here?
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 08:02:10 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 09:02:10 +0200
Subject: R-alpha: 1:n is not integer
Message-ID: <9705270702.AA02619@>


This is from Snews of yesterday 

Snews> but the : operator creates integers as in
Snews> 
Snews> > is.integer(1:10)
Snews> [1] T
Snews> 
Snews> and even in
Snews> 
Snews> > is.integer(1:1)
Snews> [1] T

which reminds me of bug report  I had sent a while ago,
I think in pre-alpha times:

 MM>  In R,  1:n is   double (aka 'real') and not integer.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 16:29:15 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 17:29:15 +0200
Subject: R-alpha: signif( small , d) gives NA
Message-ID: <9705271529.AA02767@>

signif(.) is a <primitive> function.

Unfortunately, I couldn't even find WHERE in the source,
  signif(.) is defined.

Here are the symptoms:

xmin <- .Machine $ double.xmin
signif(xmin,3) #--> NA

umach <- unlist(.Machine)[paste("double.x", c("min","max"), sep='')]
for(dig in 1:10) {cat("dig=",dig,": "); print(signif(umach, digits = dig))}


-------
Why do I "complain"?  
	-- it breaks  str(.Machine), now that I've improved 'str'.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From p.dalgaard@kubism.ku.dk  Tue May 27 16:56:30 1997
From: p.dalgaard@kubism.ku.dk (Peter Dalgaard BSA)
Date: 27 May 1997 17:56:30 +0200
Subject: R-alpha: signif( small , d) gives NA
In-Reply-To: Martin Maechler's message of Tue, 27 May 97 17:29:15 +0200
References: <9705271529.AA02767@>
Message-ID: <x2bu5wyklt.fsf@bush.kubism.ku.dk>

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> 
> signif(.) is a <primitive> function.
> 
> Unfortunately, I couldn't even find WHERE in the source,
>   signif(.) is defined.
>

In src/math/prec.c

> Here are the symptoms:
> 
> xmin <- .Machine $ double.xmin
> signif(xmin,3) #--> NA

Here is the disease:

> xmin
[1] 2.225074e-308
> xmin * 1e310
[1] NA

- and the cure:

> xmin * 1e300 * 1e10
[1] 222.5074

I'll leave it to you (or Ross) to find a clean and general way of
fixing the source...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Tue May 27 17:20:44 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Tue, 27 May 97 18:20:44 +0200
Subject: R-alpha: patch for formatC(..char.vector..)
Message-ID: <9705271620.AA02863@>

Apply this patch in  
	src/library/base/funs/


--- 049orig/format~	Thu Mar  6 16:59:56 1997
+++ format	Tue May 27 18:11:27 1997
@@ -22,8 +22,11 @@
 			width <- -width
 		}
 		pad <- sapply(pmax(0, width - nc), bl.string)
-		## for R <= 0.16 (incompatibility to S):
-		if(is.list(pad)) pad <- ""
+		## for R <= 0.49 (incompatibility to S), pad may be list:
+		if(is.list(pad)) {
+			pad[sapply(pad,length) == 0] <- list("")
+			pad <- unlist(pad)
+		}
 		if (flag == "-") 
 			return(paste(x, pad, sep = ""))
 		else    return(paste(pad, x, sep = ""))

AFTER applying the patch,

	tst.ch <- c("a", "ABC", "XYZ", "dd")
	cbind(formatC(tst.ch, wid = 3))

works okay.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Kurt.Hornik@ci.tuwien.ac.at  Wed May 28 12:35:41 1997
From: Kurt.Hornik@ci.tuwien.ac.at (Kurt Hornik)
Date: Wed, 28 May 1997 13:35:41 +0200
Subject: R-alpha: cat
In-Reply-To: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>
References: <199705252055.IAA28592@stat13.stat.auckland.ac.nz>
Message-ID: <199705281135.NAA18116@aragorn.ci.tuwien.ac.at>

>>>>> Robert Gentleman writes:

> Kurt,
>   here's what S does (I recall going to some effort to duplicate the,
> at times, seemingly unusual behaviour of cat)
> S-PLUS : Copyright (c) 1988, 1996 MathSoft, Inc.
> S : Copyright AT&T.
> Version 3.4 Release 1 for Sun SPARC, SunOS 4.1.3_U1 : 1996 
> Working data will be in /users/rdev/rgentlem/.Data 
>> x <- factor(c(1:3, NA), exclude=numeric(0))
>> x
> [1] 1  2  3  NA
>> levels(x)
> [1] "1"  "2"  "3"  "NA"
>> cat(x, sep = "&")
> 1&2&3&4> cat(x, sep = "&\n")
> 1&
> 2&
> 3&
> 4
>> 

> so, the behaviour of cat is the same (whether it's correct or not
> .....)

Yes, I noticed that too.  Perhaps R could add an argument which toggles
this behavior?  (Or is there an easy other way to get what I want?)

Thanks,
-k
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 29 05:01:37 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 29 May 1997 16:01:37 +1200 (NZST)
Subject: R-alpha: 1:n is not integer
In-Reply-To: <9705270702.AA02619@>
References: <9705270702.AA02619@>
Message-ID: <199705290401.QAA15396@stat1.stat.auckland.ac.nz>

Martin Maechler writes:
 > 
 > This is from Snews of yesterday 
 > 
 > Snews> but the : operator creates integers as in
 > Snews> 
 > Snews> > is.integer(1:10)
 > Snews> [1] T
 > Snews> 
 > Snews> and even in
 > Snews> 
 > Snews> > is.integer(1:1)
 > Snews> [1] T
 > 
 > which reminds me of bug report  I had sent a while ago,
 > I think in pre-alpha times:
 > 
 >  MM>  In R,  1:n is   double (aka 'real') and not integer.

Is this a bug or feature.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From ihaka@stat.auckland.ac.nz  Thu May 29 05:04:34 1997
From: ihaka@stat.auckland.ac.nz (Ross Ihaka)
Date: Thu, 29 May 1997 16:04:34 +1200 (NZST)
Subject: R-alpha: 1:n is not integer
In-Reply-To: <199705290401.QAA15396@stat1.stat.auckland.ac.nz>
References: <9705270702.AA02619@>
 <199705290401.QAA15396@stat1.stat.auckland.ac.nz>
Message-ID: <199705290404.QAA15463@stat1.stat.auckland.ac.nz>

Ross Ihaka writes:
 > Is this a bug or feature.

Gaak!  Hit the wrong button.  Its on the list for changing.
	Ross
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

From Martin Maechler <maechler@stat.math.ethz.ch>  Fri May 30 17:24:15 1997
From: Martin Maechler <maechler@stat.math.ethz.ch> (Martin Maechler)
Date: Fri, 30 May 97 18:24:15 +0200
Subject: R-alpha: bug report  and patch  for   rep(.)
Message-ID: <9705301624.AA03924@>


rep(1,0) gives	'Error: subscript out of bounds'

Here is the new  ../src/library/base/funs/rep	
		    -------------------------
(which contains two patches, the first of which I posted on May 20):

rep <- function(x, times, length.out)
{
	if (length(x) == 0)
		return(x)
	if (missing(times))
		times <- ceiling(length.out/length(x))
	r <- .Internal(rep(x,times))
	if(!is.null(nm <- names(x))) names(r) <- .Internal(rep(nm, times))
	if (!missing(length.out))
		return(r[if(length.out>0) 1:length.out else integer(0)])
	return(r)
}

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-


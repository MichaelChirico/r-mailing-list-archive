From c@@rd|@g@bor @end|ng |rom gm@||@com  Sun Mar  9 17:51:04 2025
From: c@@rd|@g@bor @end|ng |rom gm@||@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Sun, 9 Mar 2025 17:51:04 +0100
Subject: [R-SIG-Mac] R 4.4.3 build has -ldeflate in LIBS
Message-ID: <CABtg=KmTkkAcdLXSE_0geN+VD-k0Ayt4cMzcOV165je4Or1cmQ@mail.gmail.com>

I wonder if it is necessary or beneficial to have -ldeflate in LIBS
for the new R 4.4.3 build. This makes source package installations
fail if the package links to R, and libdeflate is not installed. E.g.
for

install.packages("asciicast", type = "source")

...
clang -arch arm64  -L/opt/R/arm64/lib -o rem r.o common.o
-F/Library/Frameworks/R.framework/Versions/4.4-arm64 -framework R
-L/opt/R/arm64/lib -lpcre2-8 -ldeflate -llzma -lbz2 -lz -licucore -ldl
-lm -liconv
ld: library 'deflate' not found
clang: error: linker command failed with exit code 1 (use -v to see invocation)
...

As far as I can tell libdeflate is not actually needed when compiling
the package.

The R-devel builds have the same, and also have -lzstd. The latter
seems ok, at least on Sequoia, I don't know about earlier macOS
versions.

Gabor



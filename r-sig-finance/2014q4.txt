From treydog999 at gmail.com  Wed Oct  1 04:55:45 2014
From: treydog999 at gmail.com (Derek Wong)
Date: Tue, 30 Sep 2014 21:55:45 -0500
Subject: [R-SIG-Finance] quantstrat help - simple combine error using
 windows and walk.forward
In-Reply-To: <CAPPM_gTBryA5oBkhtN7nbJd+WnG-wFje_Q2KQ=rXM4YJg3XvMQ@mail.gmail.com>
References: <CALQudT9u8Fa++0u+di_ibjV9FuFGqdRoWLtQq4V6LhAVNyKSRA@mail.gmail.com>
	<CALQudT9az9UtqdvhkeH0HrLSh5-mcnaUdm2stZW_BuB6+mDXuA@mail.gmail.com>
	<CAK2H+ecJV49j9st69nsGr5pck9=0FYTac9scTdXb90j1kktfdQ@mail.gmail.com>
	<CALQudT-zjBJMnz9jFDyY=R79gWTN=khT-C-EA1kuu+0veLtSUg@mail.gmail.com>
	<CAPPM_gTBryA5oBkhtN7nbJd+WnG-wFje_Q2KQ=rXM4YJg3XvMQ@mail.gmail.com>
Message-ID: <CALQudT-RJgHF734fYTetbbZdWxM_YyRu1bPikP3rPUEDC+g_Jg@mail.gmail.com>

Hi Josh,

Sorry about the HTML mistake, I am new to using something like
r-sig-finance mailing list, I didn't realize I was posting
incorrectly. In regards to the personal correspondence, I didnt full
understand that it was operating system independent, I thought that
because windows has problems with MC solutions that could have been
the issue. I have tried doing using the doRedis package and it just
runs for hours on end., but never showing a result. I am guessing it
should not take 4+ hours to run this, but i can not see and additional
output in R so i am not sure how far along it got..  Although the
server console does show

10 changes in 300 seconds. Saving...
fork operation complete
Background saving terminated success.


I have also tried using registerdoSEQ() think that was a guaranteed
way of seeing the results however i recieve an error. here is the
output. I have checked if i had the iterators package installed and
loaded which I do. So i do not know where it is trying to call this
function. I did a search for help on iter assuming it was a built in
function but did not find anything.

> registerDoSEQ()
>
> result <- walk.forward(pairStrat,
+                        paramset.label = "BBOPT",
+                        portfolio.st = portfolio1.st,
+                        account.st = account.st,
+                        period = "months",
+                        k.training = 6,
+                        k.testing = 3,
+                        obj.func = my.obj.func,
+                        obj.args = list(x=quote(result$apply.paramset)),
+                        audit.prefix = "wfa",
+                        anchored = FALSE,
+                        verbose = TRUE)
[1] "=== training BBOPT on 2009-01-02/2009-06-30"
Error in eval(expr, envir, enclos) : could not find function "iter"



All Code with  appended doRedis and doSEQ -------- (hopefully this
posts correctly)



#Kindly contributed to quantstrat by Garrett See
#code borrowed heavily from existing quantstrat demos

# This is a simple pairs trading example intended to illustrate how you can
# extend existing quantstrat functionality.  It uses addPosLimits to specify
# levels and position limits, and shows how to pass a custom order sizing
# function to osFUN

# Note that it would be easier to build a spread first and treat it as a single
# instrument instead of dealing with a portfolio of stocks.

## given 2 stocks, calculate the ratio of their notional values.  If the ratio
# falls below it's 2 stdev band, then when it crosses back above it, buy stock 1
# and sell stock 2.  If the ratio rises above it's 2 stdev band, then when it
# crosses back below it, sell stock 1 and buy stock 2.  If the ratio crosses
# its moving average, then flatten any open positions.

# The Qty of Stock A that it buys (sells) = MaxPos / lvls
# The Qty of Stock B that is sells (buys) = MaxPos * Ratio / lvls

require(quantstrat)

suppressWarnings(rm("order_book.pair1",pos=.strategy))
suppressWarnings(rm("account.pairs", "portfolio.pair1", pos=.blotter))
suppressWarnings(rm("initDate", "endDate", "startDate", "initEq", "SD", "N",
                    "symb1", "symb2", "portfolio1.st", "account.st",
                    "pairStrat", "out1"))

##### PLACE DEMO AND TEST DATES HERE #################
#
#if(isTRUE(options('in_test')$in_test))
#  # use test dates
#  {initDate="2011-01-01"
#  endDate="2012-12-31"
#  } else
#  # use demo defaults
#  {initDate="1999-12-31"
#  endDate=Sys.Date()}

initDate <- '2009-01-01'
endDate <- '2011-05-01'
startDate <- '2009-01-02'
initEq <- 100000
SD <- 2
N <- 20

MaxPos <- 1500  #max position in stockA;
# max position in stock B will be max * ratio, i.e. no hard position limit in
# Stock B
lvls <- 3  #how many times to fade; Each order's qty will = MaxPos/lvls

symb1 <- 'SPY' #change these to try other pairs
symb2 <- 'DIA' #if you change them, make sure position limits still make sense

portfolio1.st <- 'pair1'
account.st <- 'pairs'

getSymbols(c(symb1, symb2), from=startDate, to=endDate, adjust=TRUE)

# The following function is used to make sure the timestamps of all symbols are
# the same deletes rows where one of the stocks is missing data
alignSymbols <- function(symbols, env=.GlobalEnv) {
  # This is a simplified version of qmao::alignSymbols()
  if (length(symbols) < 2)
    stop("Must provide at least 2 symbols")
  if (any(!is.character(symbols)))
    stop("Symbols must be vector of character strings.")
  ff <- get(symbols[1],env=env)
  for (sym in symbols[-1]) {
    tmp.sym <- get(sym,env=env)
    ff <- merge(ff, tmp.sym, all=FALSE)
  }
  for (sym in symbols) {
    assign(sym,ff[,grep(sym, colnames(ff))], env=env)
  }
  symbols
}
alignSymbols(c(symb1, symb2))

# Define Instruments
currency("USD")
stock(symb1, currency="USD", multiplier=1)
stock(symb2, currency="USD", multiplier=1)

# Initialize Portfolio, Account, and Orders
initPortf(name=portfolio1.st, c(symb1,symb2), initDate=initDate)
initAcct(account.st, portfolios=portfolio1.st, initDate=initDate, initEq=initEq)
initOrders(portfolio=portfolio1.st, initDate=initDate)

# osFUN will need to know which symbol is leg 1 and which is leg 2 as well as
# what the values are for MaxPos and lvls.  So, create a slot in portfolio to
# hold this info.
pair <- c(1, 2, MaxPos, lvls)
names(pair) <- c(symb1, symb2, "MaxPos", "lvls")
.blotter[[paste('portfolio', portfolio1.st, sep='.')]]$pair <- pair

# Create initial position limits and levels by symbol
# allow 3 entries for long and short if lvls=3.
addPosLimit(portfolio=portfolio1.st, timestamp=initDate, symbol=symb1,
            maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos, shortlevels=lvls)
addPosLimit(portfolio=portfolio1.st, timestamp=initDate, symbol=symb2,
            maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos, shortlevels=lvls)

# Create a strategy object
pairStrat <- strategy('pairStrat')

# Indicator function
calcRatio <- function(x) {
  #returns the ratio of notional close prices for 2 symbols
  x1 <- get(x[1])
  x2 <- get(x[2])
  mult1 <- getInstrument(x[1])$multiplier
  mult2 <- getInstrument(x[2])$multiplier
  rat <- (mult1 * Cl(x1)) / (mult2 * Cl(x2))
  colnames(rat) <- 'Ratio'
  rat
}
# Indicator used for determining entry/exits
Ratio <- calcRatio(c(symb1[1], symb2[1]))

# Store hedge ratio in portfolio so that it's available for order sizing
# function. In this example, the hedge ratio happens to be the same as the
# Ratio indicator.
.blotter[[paste('portfolio',portfolio1.st,sep='.')]]$HedgeRatio <- Ratio
#and make a function to get the most recent HedgeRatio
getHedgeRatio <- function(portfolio, timestamp) {
  portf <- getPortfolio(portfolio)
  timestamp <- format(timestamp,"%Y-%m-%d %H:%M:%S")
  # above line ensures you don't get last value of next day if using intraday
  # data and timestamp=midnight
  toDate <- paste("::", timestamp, sep="")
  Ratio <- last(portf$HedgeRatio[toDate])
  as.numeric(Ratio)
}

# Create an indicator - BBands on the Ratio
pairStrat <- add.indicator(strategy=pairStrat, name = "calcRatio",
                           arguments=list(x=c(symb1,symb2)))
pairStrat <- add.indicator(strategy=pairStrat, name = "BBands",
                           arguments=list(HLC=quote(Ratio), sd=SD, n=N,
                                          maType='SMA'),
                           label = "BBands")

#applyIndicators(strategy=pairStrat,mktdata=get(symb1[1])) #for debugging

# Create signals - buy when crossing lower band from below, sell when crossing
# upper band from above, flatten when crossing mavg from above or from below
pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","up"),
                                       relationship="lt"),
                        label="cross.up")
pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","dn"),
                                       relationship="gt"),
                        label="cross.dn")
pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","mavg"),
                                       relationship="lt"),
                        label="cross.mid.fa")
pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","mavg"),
                                       relationship="gt"),
                        label="cross.mid.fb")

# make an order sizing function
#######################_ORDER SIZING FUNCTION_##################################
# check to see which stock it is. If it's the second stock, reverse orderqty and
# orderside
osSpreadMaxPos <- function (data, timestamp, orderqty, ordertype, orderside,
                            portfolio, symbol, ruletype, ..., orderprice) {
  portf <- getPortfolio(portfolio)
  #check to make sure pair slot has the things needed for this function
  if (!any(portf$pair == 1) && !(any(portf$pair == 2)))
    stop('pair must contain both values 1 and 2')
  if (!any(names(portf$pair) == "MaxPos") || !any(names(portf$pair) == "lvls"))
    stop('pair must contain MaxPos and lvls')

  if (portf$pair[symbol] == 1) legside <- "long"
  if (portf$pair[symbol] == 2) legside <- "short"
  MaxPos <- portf$pair["MaxPos"]
  lvls <- portf$pair["lvls"]
  ratio <- getHedgeRatio(portfolio, timestamp)
  pos <- getPosQty(portfolio, symbol, timestamp)
  PosLimit <- getPosLimit(portfolio, symbol, timestamp)
  qty <- orderqty
  if (legside == "short") {#symbol is 2nd leg
    ## Comment out next line to use equal ordersizes for each stock.
    addPosLimit(portfolio=portfolio, timestamp=timestamp, symbol=symbol,
                maxpos=round(MaxPos*ratio,0), longlevels=lvls,
                minpos=round(-MaxPos*ratio,0), shortlevels=lvls)
    ##
    qty <- -orderqty #switch orderqty for Stock B
  }

  if (qty > 0) orderside = 'long'
  if (qty < 0) orderside = 'short'

  orderqty <- osMaxPos(data=data,timestamp=timestamp, orderqty=qty,
                       ordertype=ordertype, orderside=orderside,
                       portfolio=portfolio, symbol=symbol, ruletype=ruletype,
                       ...)

  #Add the order here instead of in the ruleSignal function
  if (!is.null(orderqty) & !orderqty == 0 & !is.null(orderprice)) {
    addOrder(portfolio=portfolio, symbol=symbol,
             timestamp=timestamp, qty=orderqty, price=as.numeric(orderprice),
             ordertype=ordertype, side=orderside, replace=FALSE,
             status="open", ...=...)
  }
  return(0) #so that ruleSignal function doesn't also try to place an order
}
################################################################################

# Create entry and exit rules for longs  and for shorts. Both symbols will get
# the same buy/sell signals, but osMaxPos will reverse those for the second
# symbol.
# orderqty's are bigger than PosLimits allow. osMaxPos will adjust the orderqty
# down to 1/3 the max allowed. (1/3 is because we are using 3 levels in
# PosLimit)
pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.dn", sigval=TRUE,
                                     orderqty=1e6, ordertype='market',
                                     orderside=NULL, osFUN='osSpreadMaxPos'),
                      type='enter')
pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.up", sigval=TRUE,
                                     orderqty=-1e6, ordertype='market',
                                     orderside=NULL, osFUN='osSpreadMaxPos'),
                      type='enter')
pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.mid.fb", sigval=TRUE,
                                     orderqty='all', ordertype='market',
                                     orderside=NULL),
                      type='exit')
pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.mid.fa", sigval=TRUE,
                                     orderqty='all', ordertype='market',
                                     orderside=NULL),
                      type='exit')


## for debugging
# applySignals(strategy=pairStrat,
#              mktdata=applyIndicators(strategy=pairStrat, mktdata=get(symb1)))
##

out1<-applyStrategy(strategy=pairStrat, portfolios=portfolio1.st)

updatePortf(Portfolio=portfolio1.st,
            Dates=paste("::", as.Date(Sys.time()), sep=''))
updateAcct(account.st, Dates=paste(startDate, endDate, sep="::"))
updateEndEq(account.st, Dates=paste(startDate, endDate, sep="::"))
getEndEq(account.st, Sys.time())

dev.new()
chart.Posn(Portfolio=portfolio1.st, Symbol=symb1)
dev.new()
chart.Posn(Portfolio=portfolio1.st, Symbol=symb2)
dev.new()
chartSeries(Cl(get(symb1))/Cl(get(symb2)), TA="addBBands(n=N,sd=SD)")

ret1 <- PortfReturns(account.st)
ret1$total <- rowSums(ret1)
#ret1

if("package:PerformanceAnalytics" %in% search() ||
     require("PerformanceAnalytics",quietly=TRUE)) {
  #  getSymbols("SPY", from='1999-01-01')
  #  SPY.ret <- Return.calculate(SPY$SPY.Close)
  #  tmp <- merge(SPY.ret,ret1$total,all=FALSE)
  dev.new()
  charts.PerformanceSummary(ret1$total, geometric=FALSE, wealth.index=TRUE)
}


###############################################################################
# R (http://r-project.org/) Quantitative Strategy Model Framework
#
# Package Copyright (c) 2009-2012
# Peter Carl, Dirk Eddelbuettel, Brian G. Peterson, Jeffrey Ryan, and
Joshua Ulrich
#
# This library is distributed under the terms of the GNU Public License (GPL)
# for full details see the file COPYING
#
# $Id$
#
###############################################################################

##### PLACE THIS BLOCK AT END OF DEMO SCRIPT ###################
# book  = getOrderBook(port)
# stats = tradeStats(port)
# rets  = PortfReturns(acct)
################################################################

#Distribution Initialization
pairStrat <- add.distribution(strategy = pairStrat,
                 paramset.label ="BBOPT",
                 component.type = "indicator",
                 component.label = "BBands",
                 variable = list(n = seq(10,200, by = 10)),
                 label = "n")

pairStrat <- add.distribution(strategy = pairStrat,
                 paramset.label ="BBOPT",
                 component.type = "indicator",
                 component.label = "BBands",
                 variable = list(sd = seq(1,5,by = 0.5)),
                 label = "sd")


# Objective Function
my.obj.func <- function(x)
{
  # pick one of the following objective functions (uncomment)

  #return(max(x$tradeStats$Max.Drawdown) == x$tradeStats$Max.Drawdown)

  return(max(x$tradeStats$Net.Trading.PL) == x$tradeStats$Net.Trading.PL)

}

#WFA - Comment out selected method
# require(doParallel)
# cl <- makePSOCKcluster(2)
# registerDoParallel(cl)
#
# require(doRedis)
# registerDoRedis('jobs')
# startLocalWorkers(n=2, queue='jobs')
# print(getDoParWorkers())

registerDoSEQ()

result <- walk.forward(pairStrat,
                       paramset.label = "BBOPT",
                       portfolio.st = portfolio1.st,
                       account.st = account.st,
                       period = "months",
                       k.training = 6,
                       k.testing = 3,
                       obj.func = my.obj.func,
                       obj.args = list(x=quote(result$apply.paramset)),
                       audit.prefix = "wfa",
                       anchored = FALSE,
                       verbose = TRUE)







I


On Tue, Sep 30, 2014 at 10:34 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>  Tue, Sep 30, 2014 at 10:25 AM, Derek Wong <treydog999 at gmail.com> wrote:
>> Mark,
>>
>> Thank you for the reply. I really appreciate you taking the time to look at
>> it. However in my previous email/post and my current code I do not see a
>> line that shows
>>
>> portfolio1.st <- 'pair1'account.st <- 'pairs'
>>
> You're posting in HTML, which the posting guild tells you not to do.
> The list server must convert your HTML into plain text, which often
> mangles your original message.  For example, look at how your message
> was received at Nabble:
> http://r.789695.n4.nabble.com/quantstrat-help-simple-combine-error-using-windows-and-walk-forward-td4697468.html
>
>> they should be two separate lines. Either way I have run the entire code
>> and will show the area I am focusing on. Which is the end using the
>> walk.forward() function, as everything else in the code runs perfectly for
>> me using R 3.1.1 in windows or ubuntu.
>>
> As I said in our personal correspondence, "the problem is that the
> calcRatio function is not being exported to the nodes.  This is
> probably related to bug #5814
> (https://r-forge.r-project.org/tracker/index.php?func=detail&aid=5814&group_id=316&atid=1269)."
>
> This is going to be a problem with a socket cluster on any operating
> system.  It will work if you don't run in parallel, or if you run on
> almost anything other than a socket cluster (e.g. redis, fork
> [multicore], etc).
>
> Best,
> Josh
>
>
>> Code I am focusing on:
>>
>> # Objective Function
>> my.obj.func <- function(x)
>> {
>>   # pick one of the following objective functions (uncomment)
>>
>>   #return(max(x$tradeStats$Max.Drawdown) == x$tradeStats$Max.Drawdown)
>>
>>   return(max(x$tradeStats$Net.Trading.PL) == x$tradeStats$Net.Trading.PL)
>>
>> }
>>
>> #WFA
>> require(doParallel)
>> cl <- makePSOCKcluster(2)
>> registerDoParallel(cl)
>>
>> result <- walk.forward(pairStrat,
>>                        paramset.label = "BBOPT",
>>                        portfolio.st = portfolio1.st,
>>                        account.st = account.st,
>>                        period = "months",
>>                        k.training = 6,
>>                        k.testing = 3,
>>                        obj.func = my.obj.func,
>>                        obj.args = list(x=quote(result$apply.paramset)),
>>                        audit.prefix = "wfa",
>>                        anchored = FALSE,
>>                        verbose = TRUE)
>>
>>
>> Output below:
>>> # Objective Function
>>> my.obj.func <- function(x)
>> + {
>> +   # pick one of the following objective functions (uncomment)
>> +
>> +   #return(max(x$tradeStats$Max.Drawdown) == x$tradeStats$Max.Drawdown)
>> +
>> +   return(max(x$tradeStats$Net.Trading.PL) == x$tradeStats$Net.Trading.PL)
>> +
>> + }
>>>
>>> #WFA
>>> require(doParallel)
>>> cl <- makePSOCKcluster(2)
>>> registerDoParallel(cl)
>>>
>>> result <- walk.forward(pairStrat,
>> +                        paramset.label = "BBOPT",
>> +                        portfolio.st = portfolio1.st,
>> +                        account.st = account.st,
>> +                        period = "months",
>> +                        k.training = 6,
>> +                        k.testing = 3,
>> +                        obj.func = my.obj.func,
>> +                        obj.args = list(x=quote(result$apply.paramset)),
>> +                        audit.prefix = "wfa",
>> +                        anchored = FALSE,
>> +                        verbose = TRUE)
>> [1] "=== training BBOPT on 2009-01-02/2009-06-30"
>> automatically exporting the following variables from the local environment:
>>   account, account.st, calc, env.instrument, mktdata, orderbook,
>> paramset.label, portfolio, portfolio.st, strategy, user.args, user.func
>> explicitly exporting variables(s): clone.portfolio, clone.orderbook,
>> install.param.combo
>> numValues: 180, numResults: 0, stopped: TRUE
>> got results for task 1
>> numValues: 180, numResults: 1, stopped: TRUE
>> returning status FALSE
>> got results for task 2
>> <SNIP>
>> got results for task 180
>> numValues: 180, numResults: 180, stopped: TRUE
>> first call to combine function
>> evaluating call object to combine results:
>>   fun(result.1, result.2, result.3, result.4, result.5, result.6,
>>    <SNIP>
>>     result.177, result.178, result.179, result.180)
>> error calling combine function:
>> <simpleError in fun(result.1, result.2, result.3, result.4, result.5,
>> result.6,     result.7, result.8, result.9, result.10, result.11,
>> result.12,     result.13, result.14, result.15, result.16, result.17,
>> result.18,     result.19, result.20, result.21, result.22,
>> <SNIP>
>> result.171,     result.172, result.173, result.174, result.175, result.176,
>>     result.177, result.178, result.179, result.180): attempt to select less
>> than one element>
>> Error in walk.forward(pairStrat, paramset.label = "BBOPT", portfolio.st =
>> portfolio1.st,  :
>>   obj.func() returned empty result
>> In addition: Warning messages:
>> 1: In e$fun(obj, substitute(ex), parent.frame(), e$data) :
>>   already exporting variable(s): env.instrument
>> 2: In max(x$tradeStats$Net.Trading.PL) :
>>   no non-missing arguments to max; returning -Inf
>>
>>
>>
>> Thanks again
>>
>> Derek
>>
>> On Tue, Sep 30, 2014 at 8:20 AM, Mark Knecht <markknecht at gmail.com> wrote:
>>
>>> On Tue, Sep 30, 2014 at 12:34 AM, Derek Wong <treydog999 at gmail.com> wrote:
>>> > Hello,
>>> >
>>> > I have been able to reproduce this error in Ubuntu based system as well
>>> not
>>> > just on windows. I was wondering if anyone had any insights or ways to to
>>> > solve this or create a work around.  If there is any additional
>>> information
>>> > you require let me know. Please I would really appreciate help on this.
>>> It
>>> > is totally out of my depth and I am hoping that this fine community can
>>> > help.
>>> >
>>>
>>> Derek,
>>>    I have no time to do any debugging of this but the first error on my
>>> Gentoo system running RStudio and R-3.1.1 is actually this line:
>>>
>>> portfolio1.st <- 'pair1'account.st <- 'pairs'
>>>
>>> which does look like bad code to me.
>>>
>>>    One 'problem' with a number of demos that are out there is that the demo
>>> author may be using the development version of a specific package which
>>> then results in end user types (like me) having problems.
>>>
>>>    I suggest you run this code line-by-line and then post back a few lines
>>> preceding the breakdown. Maybe someone can give better input than
>>> I can. Also, please edit/snip your responses to add focus to the exact
>>> issue.
>>>
>>> Good luck,
>>> Mark
>>>
>>> > On Wed, Sep 24, 2014 at 9:36 PM, Derek Wong <treydog999 at gmail.com>
>>> wrote:
>>> >
>>> >> Hello,
>>> >>
>>> >> I am having a lot of trouble with using walk.forward.in windows. i get
>>> >> the following error. This may be related to bug #5814. If someone could
>>> >> please help me i would really appreciate it. The reproducible code
>>> below is
>>> >> based on the pair_trade example. Thanks.
>>> >>
>>> >> error calling combine function:
>>> >> <simpleError in fun(result.1, result.2, result.3, result.4, result.5,
>>> >> result.6,     result.7, result.8, result.9, result.10, result.11,
>>> <SNIP>
>>> >> result.172, result.173, result.174, result.175, result.176,
>>>  result.177,
>>> >> result.178, result.179, result.180): attempt to select less than one
>>> >> element>
>>> >> Error in walk.forward(pairStrat, paramset.label = "BBOPT", portfolio.st
>>> =
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com


From markknecht at gmail.com  Wed Oct  1 16:28:50 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 1 Oct 2014 07:28:50 -0700
Subject: [R-SIG-Finance] Order book / mktdata cbind issue (offset?)
Message-ID: <CAK2H+ecLR-3B7WGhG-hwQ6ykas1jedBOF0Jkxvz6isvcWhrA4Q@mail.gmail.com>

Hi,
   Using quantstrat-0.9.1632 I had the idea that I should be able to
cbind mktdata & order book together to trace out what's happening in a
strategy. I wanted to see the orders lined up against strategy
indicators, signals & prices so that I could reconcile in my mind
what's happening. Unfortunately I find that the order book indexes
seem to be offset by a small amount from the mktdata indexes. Is this
by design and if so is there some way for me to line them back up?

   The code below takes a 1 month portion of both xts object as
example. From the order book there is only one trade with an index of
964742409 (really 964742408.64???) which indeed is not in the index
list from mktdata. The mktdata index with the same date is apparently
964742400.

   Why is this happening? Is there some documentation for me to read?

   I will supply a complete strategy if required but it seems to
happen with all the demos. I'm getting the order book using as
appropriate:

oB = getOrders(portfolio.st, stock.str, status="closed")

Thanks in advance,
Mark



library(quantstrat)

oB_Part = structure(c("100", "145.72", "market", "long", NA, "closed",
"2000-07-31 00:00:00", "Open", "ocolong", "0", "LE", ""), class = c("xts",
"zoo"), .indexCLASS = "Date", .indexTZ = "UTC", tclass = "Date",
tzone = "UTC", index = structure(964742408.64, tzone = "UTC", tclass = "Date"),
.Dim = c(1L,
12L), .Dimnames = list(NULL, c("Order.Qty", "Order.Price", "Order.Type",
"Order.Side", "Order.Threshold", "Order.Status", "Order.StatusTime",
"Prefer", "Order.Set", "Txn.Fees", "Rule", "Time.In.Force")))

mktdata_Part = structure(c(145.44, 146.38, 144.94, 146.69, 147.88,
147.47, 149.28,
149.98, 150.44, 150.98, 150.62, 149.47, 149, 149.75, 148.12,
147.75, 146.97, 145.94, 145.72, 142.94, 147.44, 146.66, 146.47,
148.78, 148.91, 149.12, 150.12, 150.38, 151.25, 151.98, 150.62,
149.91, 150.62, 149.75, 148.86, 147.84, 147.16, 146.62, 145.91,
144.12, 145.19, 144.38, 144.22, 146.25, 147.53, 147.16, 148.69,
149.19, 149.67, 150.69, 149.34, 148.25, 148.81, 147.69, 146.56,
146.78, 145.64, 144.69, 141.52, 142.06, 147.28, 144.62, 145.75,
148.09, 147.84, 148.16, 149.12, 149.78, 151.25, 151, 149.77,
148.56, 150.62, 147.69, 146.84, 147.31, 145.88, 145.38, 142.09,
143, 1436600, 2748200, 5963200, 3034800, 2816100, 5431600, 5883000,
5356000, 5341900, 4208300, 4262100, 8506800, 4538900, 5656900,
5628500, 4757100, 12062500, 7652600, 6229500, 5265500, 112.89,
110.86, 111.72, 113.52, 113.33, 113.57, 114.31, 114.81, 115.94,
115.75, 114.8, 113.88, 115.46, 113.21, 112.56, 112.92, 111.82,
111.43, 108.92, 109.61, 0.1308, 0.1308, 0.1308, 0.0756, 0.0756,
0.0756, 0.0756, 0.0756, 0.0537, 0.0537, 0.0537, 0.0537, 0.0537,
0.037, 0.037, 0.037, 0.037, 0.037, 0.0186, 0.0186, 6e-04, 6e-04,
6e-04, 0.0065, 0.0065, 0.0065, 0.0065, 0.0065, 0.0191, 0.0191,
0.0191, 0.0191, 0.0191, 0.0216, 0.0216, 0.0216, 0.0216, 0.0216,
0.0217, 0.0217, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0), class = c("xts", "zoo"), .indexCLASS = "Date",
.indexTZ = "UTC", tclass = "Date", tzone = "UTC", src = "R_ETFAdjust",
updated = structure(1412172075.13977, class = c("POSIXct",
"POSIXt")), index = structure(c(962582400, 962755200, 962841600,
962928000, 963187200, 963273600, 963360000, 963446400, 963532800,
963792000, 963878400, 963964800, 964051200, 964137600, 964396800,
964483200, 964569600, 964656000, 964742400, 965001600), tzone = "UTC",
tclass = "Date"), .Dim = c(20L,
11L), .Dimnames = list(NULL, c("SPY.Open", "SPY.High", "SPY.Low",
"SPY.Close", "SPY.Volume", "SPY.Adjusted", "Best", "Sym", "Long",
"LEsig", "LXsig")))

.index(oB_Part)

.index(mktdata_Part)

.index(oB_Part) %in% .index(mktdata_Part)

tmp1=cbind(mktdata_Part, oB_Part)

.


From wfreitas at bvmf.com.br  Wed Oct  1 20:24:48 2014
From: wfreitas at bvmf.com.br (Wilson Nascimento De Freitas)
Date: Wed, 1 Oct 2014 18:24:48 +0000
Subject: [R-SIG-Finance] RES:  GBSVolatility not working on vectors?
In-Reply-To: <542420B5.5040602@nexgo.de>
References: <CAGaLYZoww76rHYd2nXF8=Hqv4r4WHqAscEL71HVVrQh=p9_aww@mail.gmail.com>
	<54240B55.8070103@nexgo.de> <542420B5.5040602@nexgo.de>
Message-ID: <d18c75369ea740439b57aeb67ddbc846@GRUPR80MB217.lamprd80.prod.outlook.com>

Hi,

I ran that code with a data.frame of ~ 20K records.

https://gist.github.com/wilsonfreitas/9835012

Note that theo_price might be a wrapper of GBSOption (or any other function).

wf

-----Mensagem original-----
De: r-sig-finance-bounces at r-project.org [mailto:r-sig-finance-bounces at r-project.org] Em nome de Joachim Breit
Enviada em: quinta-feira, 25 de setembro de 2014 11:04
Para: r-sig-finance at r-project.org
Assunto: Re: [R-SIG-Finance] GBSVolatility not working on vectors?

Rejoiced too soon.

It worked with my mini-dataframe but when doing it with the big one I got:

Fehler in uniroot(.fGBSVolatility, interval = c(-10, 10), price = price,  :
   f() values at end points not of opposite sign



Am 25.09.2014 14:32, schrieb Joachim Breit:
> Cool, that works.
> I'm a beginner (since a decade or so :-) Did not know Vectorize()
>
> Thank you so much!
>
> Am 25.09.2014 14:17, schrieb Shivam:
>>> dtemp$iva  <- Vectorize(GBSVolatility)(price = dtemp$ask, TypeFlag =
>>> dtemp$cp,
>> S = dtemp$c , X = dtemp$strike, Time = dtemp$ntd / 253.8, r =
>> pmax(dtemp$rb, 0), b = pmax(dtemp$rb, 0))
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R
> questions should go.
>

_______________________________________________
R-SIG-Finance at r-project.org mailing list https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.
'
________________________________

Esta mensagem pode conter informa??o confidencial e/ou privilegiada. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o dever? utilizar, copiar, alterar, divulgar a informa??o nela contida ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor avise imediatamente o remetente, respondendo o e-mail e em seguida apague-o. Agradecemos sua coopera??o.

This message may contain confidential and/or privileged information. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose, change, take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message. Thank you for your cooperation.
'

From alexios at 4dscape.com  Wed Oct  1 20:37:59 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Wed, 01 Oct 2014 19:37:59 +0100
Subject: [R-SIG-Finance] seasonality in rugarch
In-Reply-To: <f41074db013659fb23b3ab33de61ce8d@stevens.edu>
References: <f41074db013659fb23b3ab33de61ce8d@stevens.edu>
Message-ID: <542C4A07.3070908@4dscape.com>

rugarch only supports ARFIMA(p,d,q) models.

1. First try fitting the returns using the "forecast" package which 
supports SARIMA.
2. If you are satisfied with the residuals, pass them to rugarch (with 
armaOrder=c(0,0), include.mean=F and nothing else).

Alexios


On 30/09/2014 20:11, aschmid1 wrote:
> Hi,
> I'm working with a sample that has a strong weekly seasonality and
> wonder if rugarch can handle a multiplicative ARIMA(p,d,q)P,D,Q)s. I
> tried additive seasonal model for which I simply put 51 dummy variables
> as external regressors into the mean but, alas, the model does not
> converge (rugarch-->warning: failed to invert hessian) with or without
> dummies.
> Here is my script:
>
> spec1111 = ugarchspec(variance.model = list(model = "sGARCH", garchOrder
> = c(1,1)), mean.model = list(armaOrder = c(1,1), include.mean = T,
> external.regressors = X), distribution.model = "sged")
>
> fit1111<-ugarchfit(data=inp[,2], spec=spec1111, solver = "hybrid",
> solver.control = list(trace = TRUE, tol=1e-4, delta=1e-6))
>
>
> Thanks! Alec
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>


From mcewan.gareth at gmail.com  Thu Oct  2 08:33:20 2014
From: mcewan.gareth at gmail.com (Gareth McEwan)
Date: Thu, 2 Oct 2014 08:33:20 +0200
Subject: [R-SIG-Finance] EGARCH help - writing out the model
Message-ID: <CALGfFMYt5cY3MhSUML8Wogcs2TKAHQDaK9YYSQ5utx7fjJPKFQ@mail.gmail.com>

Hi there

I need some help writing out the EGARCH model from ugarchfit output. The
output is as follows:

Optimal Parameters
------------------------------------
        Estimate  Std. Error  t value Pr(>|t|)
omega   -1.57247    0.418627  -3.7562 0.000172
alpha1  -0.17550    0.119734  -1.4657 0.142722
beta1    0.91097    0.023007  39.5962 0.000000
gamma1   0.99365    0.222110   4.4737 0.000008
shape    2.85842    0.551750   5.1806 0.000000

	[[alternative HTML version deleted]]


From mcewan.gareth at gmail.com  Thu Oct  2 08:43:35 2014
From: mcewan.gareth at gmail.com (Gareth McEwan)
Date: Thu, 2 Oct 2014 08:43:35 +0200
Subject: [R-SIG-Finance] EGARCH help - writing out the model
Message-ID: <CALGfFMbFW5V0nhXVYwn285k4stJsW7-Go9uv83ZOxPztebPCNw@mail.gmail.com>

Hi there

I need help writing out the EGARCH model from ugarchfit output. The output
is as follows:

Optimal Parameters
------------------------------------
                 Estimate   Std. Error    t value     Pr(>|t|)
omega     -1.57247    0.418627   -3.7562     0.000172
alpha1     -0.17550    0.119734   -1.4657     0.142722
beta1        0.91097    0.023007   39.5962    0.000000
gamma1   0.99365    0.222110     4.4737    0.000008
shape       2.85842    0.551750     5.1806    0.000000

I am referring to page 7 of
"Introduction_to_the_rugarch_package.pdf" Version 1.3-3. Trying to specify
eq.14.

Would "omega" be the first bracketed term on the right hand side (RHS)?
Would "alpha1" refer to the "alpha(j)*z(t-j)" where j=1? So, would I leave
the "z(t-j)" as simply "z(t-1)" in the specification?
Would "beta1" refer to the last term on the RHS?
And would "gamma1" refer to the gamma in "gamma(j){abs(z(t-j) -
E[abs(z(t-j))]} in the middle of the RHS?

This seems right to me, but I wanted to check with the group.

Thank you very much.

Regards
Gareth

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Thu Oct  2 10:22:09 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Thu, 02 Oct 2014 09:22:09 +0100
Subject: [R-SIG-Finance] EGARCH help - writing out the model
In-Reply-To: <CALGfFMbFW5V0nhXVYwn285k4stJsW7-Go9uv83ZOxPztebPCNw@mail.gmail.com>
References: <CALGfFMbFW5V0nhXVYwn285k4stJsW7-Go9uv83ZOxPztebPCNw@mail.gmail.com>
Message-ID: <542D0B31.4060304@4dscape.com>

Yes, the names used to represent coefficients in the code are the names
used to represent them in the equations of the vignette.

Alexios

On 02/10/2014 07:43, Gareth McEwan wrote:
> Hi there
> 
> I need help writing out the EGARCH model from ugarchfit output. The output
> is as follows:
> 
> Optimal Parameters
> ------------------------------------
>                  Estimate   Std. Error    t value     Pr(>|t|)
> omega     -1.57247    0.418627   -3.7562     0.000172
> alpha1     -0.17550    0.119734   -1.4657     0.142722
> beta1        0.91097    0.023007   39.5962    0.000000
> gamma1   0.99365    0.222110     4.4737    0.000008
> shape       2.85842    0.551750     5.1806    0.000000
> 
> I am referring to page 7 of
> "Introduction_to_the_rugarch_package.pdf" Version 1.3-3. Trying to specify
> eq.14.
> 
> Would "omega" be the first bracketed term on the right hand side (RHS)?
> Would "alpha1" refer to the "alpha(j)*z(t-j)" where j=1? So, would I leave
> the "z(t-j)" as simply "z(t-1)" in the specification?
> Would "beta1" refer to the last term on the RHS?
> And would "gamma1" refer to the gamma in "gamma(j){abs(z(t-j) -
> E[abs(z(t-j))]} in the middle of the RHS?
> 
> This seems right to me, but I wanted to check with the group.
> 
> Thank you very much.
> 
> Regards
> Gareth
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From optionsraghu at gmail.com  Thu Oct  2 13:24:32 2014
From: optionsraghu at gmail.com (Raghuraman Ramachandran)
Date: Thu, 2 Oct 2014 12:24:32 +0100
Subject: [R-SIG-Finance] subsetting based on date and time of an xts?
Message-ID: <CADgEnDko-fCp=ViYuX7VgME2DGzV0Dt-5DtUyMxO6me84ydihw@mail.gmail.com>

Dear guRus

I have an xts variable res which is as below:

>str(res)
An ?xts? object on 2014-09-03 23:30:00/2014-10-01 21:45:00 containing:
  Data: num [1:1837, 1] 1991 1991 1991 1991 1991 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : chr "Data"
  Indexed by objects of class: [POSIXct,POSIXt] TZ:
  xts Attributes:
List of 4
 $ from   : chr "20140911  22:00:00"
 $ to     : chr "20141001  22:00:00"
 $ src    : chr "IB"
 $ updated: POSIXct[1:1], format: "2014-10-02 10:59:31.125498"

How do I build a new xts out of this which is a time series that
starts and ends at particular times everyday. As an example if I want
the data series to start at 2014-09-03 14:30:00 and end at 2014-09-03
21:15:00 and then continue with 2014-09-04 14:30:00 and end at
2014-09-04 21:15:00 and so on please?

Basically I am trying to rbind multilple subsets of the xts data based
on time everyday.

Many thanks for the kind assistance,
R


From optionsraghu at gmail.com  Thu Oct  2 13:38:40 2014
From: optionsraghu at gmail.com (Raghuraman Ramachandran)
Date: Thu, 2 Oct 2014 12:38:40 +0100
Subject: [R-SIG-Finance] subsetting based on date and time of an xts?
In-Reply-To: <CADgEnDko-fCp=ViYuX7VgME2DGzV0Dt-5DtUyMxO6me84ydihw@mail.gmail.com>
References: <CADgEnDko-fCp=ViYuX7VgME2DGzV0Dt-5DtUyMxO6me84ydihw@mail.gmail.com>
Message-ID: <CADgEnDnJkvF9WQqD_x3Q8p=qDns+Sy31gTd6gnWtcz-=-ZudPA@mail.gmail.com>

guRus

My sincere apologies for rushing into this question! I realised this
is as simple as

res1=res["T14:30:00/T21:15:00"]

Many thanks
R

On Thu, Oct 2, 2014 at 12:24 PM, Raghuraman Ramachandran
<optionsraghu at gmail.com> wrote:
> Dear guRus
>
> I have an xts variable res which is as below:
>
>>str(res)
> An ?xts? object on 2014-09-03 23:30:00/2014-10-01 21:45:00 containing:
>   Data: num [1:1837, 1] 1991 1991 1991 1991 1991 ...
>  - attr(*, "dimnames")=List of 2
>   ..$ : NULL
>   ..$ : chr "Data"
>   Indexed by objects of class: [POSIXct,POSIXt] TZ:
>   xts Attributes:
> List of 4
>  $ from   : chr "20140911  22:00:00"
>  $ to     : chr "20141001  22:00:00"
>  $ src    : chr "IB"
>  $ updated: POSIXct[1:1], format: "2014-10-02 10:59:31.125498"
>
> How do I build a new xts out of this which is a time series that
> starts and ends at particular times everyday. As an example if I want
> the data series to start at 2014-09-03 14:30:00 and end at 2014-09-03
> 21:15:00 and then continue with 2014-09-04 14:30:00 and end at
> 2014-09-04 21:15:00 and so on please?
>
> Basically I am trying to rbind multilple subsets of the xts data based
> on time everyday.
>
> Many thanks for the kind assistance,
> R


From markknecht at gmail.com  Mon Oct  6 16:39:00 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Mon, 6 Oct 2014 07:39:00 -0700
Subject: [R-SIG-Finance] Order book / mktdata cbind issue (offset?)
In-Reply-To: <CAK2H+ecLR-3B7WGhG-hwQ6ykas1jedBOF0Jkxvz6isvcWhrA4Q@mail.gmail.com>
References: <CAK2H+ecLR-3B7WGhG-hwQ6ykas1jedBOF0Jkxvz6isvcWhrA4Q@mail.gmail.com>
Message-ID: <CAK2H+eeTCn9dcZ2ZtGx00TbR6R0D52-xpVKz3KB0QH142Bmckg@mail.gmail.com>

On Wed, Oct 1, 2014 at 7:28 AM, Mark Knecht <markknecht at gmail.com> wrote:
<SNIP>
>
> oB = getOrders(portfolio.st, stock.str, status="closed")
>
> Thanks in advance,
> Mark

Ah, I now see what's going on. Very cool.

Cheers,
Mark


From markknecht at gmail.com  Mon Oct  6 17:14:57 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Mon, 6 Oct 2014 08:14:57 -0700
Subject: [R-SIG-Finance] Order book / mktdata cbind issue (offset?)
In-Reply-To: <CAK2H+eeTCn9dcZ2ZtGx00TbR6R0D52-xpVKz3KB0QH142Bmckg@mail.gmail.com>
References: <CAK2H+ecLR-3B7WGhG-hwQ6ykas1jedBOF0Jkxvz6isvcWhrA4Q@mail.gmail.com>
	<CAK2H+eeTCn9dcZ2ZtGx00TbR6R0D52-xpVKz3KB0QH142Bmckg@mail.gmail.com>
Message-ID: <CAK2H+edUuXzpF+DVHVxTqAbed8O_AEg3gMhKnVU962wVjXBtgQ@mail.gmail.com>

On Mon, Oct 6, 2014 at 7:39 AM, Mark Knecht <markknecht at gmail.com> wrote:
> On Wed, Oct 1, 2014 at 7:28 AM, Mark Knecht <markknecht at gmail.com> wrote:
> <SNIP>
>>
>> oB = getOrders(portfolio.st, stock.str, status="closed")
>>
>> Thanks in advance,
>> Mark
>
> Ah, I now see what's going on. Very cool.
>
> Cheers,
> Mark

NOTE: I will attempt to post something back here later today or
tomorrow so that others review & comment if interested.


From zadig_1 at excite.com  Tue Oct  7 02:40:46 2014
From: zadig_1 at excite.com (ce)
Date: Mon, 06 Oct 2014 20:40:46 -0400
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
Message-ID: <20141006204046.17874@web006.roc2.bluetie.com>


My test program gives in tradeStats output some Profit factors as  Inf  .  I guess because Gross.Losses are zero .
Is it normal or am I doing something wrong ?

     Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
ABTL   270.967742      270.96774       0.00000     270.96774      0.00000

     Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
ABTL               NA        100.00000          0.00000           Inf


From ilya.kipnis at gmail.com  Tue Oct  7 02:44:42 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 6 Oct 2014 20:44:42 -0400
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
In-Reply-To: <20141006204046.17874@web006.roc2.bluetie.com>
References: <20141006204046.17874@web006.roc2.bluetie.com>
Message-ID: <CA+oJuEEAmtKqXwN24KrLVHy=BokK+1ie1LSEMwL3P83aBe_0Mw@mail.gmail.com>

Profit factor is defined as the absolute value of gross profits over gross
losses. What is anything divided by zero?

On Mon, Oct 6, 2014 at 8:40 PM, ce <zadig_1 at excite.com> wrote:

>
> My test program gives in tradeStats output some Profit factors as  Inf  .
> I guess because Gross.Losses are zero .
> Is it normal or am I doing something wrong ?
>
>      Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
> ABTL   270.967742      270.96774       0.00000     270.96774      0.00000
>
>      Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
> ABTL               NA        100.00000          0.00000           Inf
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From zadig_1 at excite.com  Tue Oct  7 02:54:05 2014
From: zadig_1 at excite.com (ce)
Date: Mon, 06 Oct 2014 20:54:05 -0400
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
Message-ID: <20141006205405.16878@web006.roc2.bluetie.com>


most resources says  profit factor = gross profit / gross loss

one example is http://www.tradingmarkets.com/recent/whats_your_profit_factor_heres_an_assignment_for_you-657965.html


-----Original Message-----
From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
Date: 10/06/2014 08:45 PM
To: "ce" <zadig_1 at excite.com>
CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?

Profit factor is defined as the absolute value of gross profits over gross losses. What is anything divided by zero?

On Mon, Oct 6, 2014 at 8:40 PM, ce <zadig_1 at excite.com> wrote:

My test program gives in tradeStats output some Profit factors as? Inf? .? I guess because Gross.Losses are zero .
Is it normal or am I doing something wrong ?

? ? ?Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
ABTL? ?270.967742? ? ? 270.96774? ? ? ?0.00000? ? ?270.96774? ? ? 0.00000

? ? ?Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
ABTL? ? ? ? ? ? ? ?NA? ? ? ? 100.00000? ? ? ? ? 0.00000? ? ? ? ? ?Inf

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From ilya.kipnis at gmail.com  Tue Oct  7 03:26:23 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 6 Oct 2014 21:26:23 -0400
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
In-Reply-To: <20141006205405.16878@web006.roc2.bluetie.com>
References: <20141006205405.16878@web006.roc2.bluetie.com>
Message-ID: <CA+oJuEHhieS0kKUQ1BYC1w4vaCmyq6O9S5DKC_eOFvEeCHYJTg@mail.gmail.com>

That depends if gross loss is computed as positive or negative. Tradestats
computes it as a negative quantity.

On Mon, Oct 6, 2014 at 8:54 PM, ce <zadig_1 at excite.com> wrote:

>
> most resources says  profit factor = gross profit / gross loss
>
> one example is
> http://www.tradingmarkets.com/recent/whats_your_profit_factor_heres_an_assignment_for_you-657965.html
>
>
> -----Original Message-----
> From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
> Date: 10/06/2014 08:45 PM
> To: "ce" <zadig_1 at excite.com>
> CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
> Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
>
> Profit factor is defined as the absolute value of gross profits over gross
> losses. What is anything divided by zero?
>
> On Mon, Oct 6, 2014 at 8:40 PM, ce <zadig_1 at excite.com> wrote:
>
> My test program gives in tradeStats output some Profit factors as  Inf  .
> I guess because Gross.Losses are zero .
> Is it normal or am I doing something wrong ?
>
>      Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
> ABTL   270.967742      270.96774       0.00000     270.96774      0.00000
>
>      Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
> ABTL               NA        100.00000          0.00000           Inf
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
>
>

	[[alternative HTML version deleted]]


From zadig_1 at excite.com  Tue Oct  7 03:35:54 2014
From: zadig_1 at excite.com (ce)
Date: Mon, 06 Oct 2014 21:35:54 -0400
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
Message-ID: <20141006213554.30632@web007.roc2.bluetie.com>


Which ever way it calculates abs(0) is still 0 . Gross Profit / 0 is Inf .


-----Original Message-----
From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
Date: 10/06/2014 09:26 PM
To: "ce" <zadig_1 at excite.com>
CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?

That depends if gross loss is computed as positive or negative. Tradestats computes it as a negative quantity.

On Mon, Oct 6, 2014 at 8:54 PM, ce <zadig_1 at excite.com> wrote:

most resources says? profit factor = gross profit / gross loss

one example is http://www.tradingmarkets.com/recent/whats_your_profit_factor_heres_an_assignment_for_you-657965.html


-----Original Message-----
From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
Date: 10/06/2014 08:45 PM
To: "ce" <zadig_1 at excite.com>
CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?

Profit factor is defined as the absolute value of gross profits over gross losses. What is anything divided by zero?

On Mon, Oct 6, 2014 at 8:40 PM, ce <zadig_1 at excite.com> wrote:

My test program gives in tradeStats output some Profit factors as? Inf? .? I guess because Gross.Losses are zero .
Is it normal or am I doing something wrong ?

? ? ?Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
ABTL? ?270.967742? ? ? 270.96774? ? ? ?0.00000? ? ?270.96774? ? ? 0.00000

? ? ?Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
ABTL? ? ? ? ? ? ? ?NA? ? ? ? 100.00000? ? ? ? ? 0.00000? ? ? ? ? ?Inf

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From ilya.kipnis at gmail.com  Tue Oct  7 03:47:54 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 6 Oct 2014 21:47:54 -0400
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
In-Reply-To: <20141006213554.30632@web007.roc2.bluetie.com>
References: <20141006213554.30632@web007.roc2.bluetie.com>
Message-ID: <CA+oJuEFNqbVoZXiSYPZaxY2cpdeA2EXHhHuh9SgS0YUB_60q7Q@mail.gmail.com>

So there's your answer.

On Mon, Oct 6, 2014 at 9:35 PM, ce <zadig_1 at excite.com> wrote:

>
> Which ever way it calculates abs(0) is still 0 . Gross Profit / 0 is Inf .
>
>
> -----Original Message-----
> From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
> Date: 10/06/2014 09:26 PM
> To: "ce" <zadig_1 at excite.com>
> CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
> Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
>
> That depends if gross loss is computed as positive or negative. Tradestats
> computes it as a negative quantity.
>
> On Mon, Oct 6, 2014 at 8:54 PM, ce <zadig_1 at excite.com> wrote:
>
> most resources says  profit factor = gross profit / gross loss
>
> one example is
> http://www.tradingmarkets.com/recent/whats_your_profit_factor_heres_an_assignment_for_you-657965.html
>
>
> -----Original Message-----
> From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
> Date: 10/06/2014 08:45 PM
> To: "ce" <zadig_1 at excite.com>
> CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
> Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
>
> Profit factor is defined as the absolute value of gross profits over gross
> losses. What is anything divided by zero?
>
> On Mon, Oct 6, 2014 at 8:40 PM, ce <zadig_1 at excite.com> wrote:
>
> My test program gives in tradeStats output some Profit factors as  Inf  .
> I guess because Gross.Losses are zero .
> Is it normal or am I doing something wrong ?
>
>      Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
> ABTL   270.967742      270.96774       0.00000     270.96774      0.00000
>
>      Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
> ABTL               NA        100.00000          0.00000           Inf
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
>
>
>
>
>
>
>
>

	[[alternative HTML version deleted]]


From zadig_1 at excite.com  Tue Oct  7 04:00:40 2014
From: zadig_1 at excite.com (ce)
Date: Mon, 06 Oct 2014 22:00:40 -0400
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
Message-ID: <20141006220040.21130@web010.roc2.bluetie.com>

yes but in the output I pasted Gross Profit is 270.96774 , so  I have some profit, no loss meaning ????


-----Original Message-----
From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
Date: 10/06/2014 09:48 PM
To: "ce" <zadig_1 at excite.com>
CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?

So theres your answer.

On Mon, Oct 6, 2014 at 9:35 PM, ce <zadig_1 at excite.com> wrote:

Which ever way it calculates abs(0) is still 0 . Gross Profit / 0 is Inf .


-----Original Message-----
From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
Date: 10/06/2014 09:26 PM
To: "ce" <zadig_1 at excite.com>
CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?

That depends if gross loss is computed as positive or negative. Tradestats computes it as a negative quantity.

On Mon, Oct 6, 2014 at 8:54 PM, ce <zadig_1 at excite.com> wrote:

most resources says? profit factor = gross profit / gross loss

one example is http://www.tradingmarkets.com/recent/whats_your_profit_factor_heres_an_assignment_for_you-657965.html


-----Original Message-----
From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
Date: 10/06/2014 08:45 PM
To: "ce" <zadig_1 at excite.com>
CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?

Profit factor is defined as the absolute value of gross profits over gross losses. What is anything divided by zero?

On Mon, Oct 6, 2014 at 8:40 PM, ce <zadig_1 at excite.com> wrote:

My test program gives in tradeStats output some Profit factors as? Inf? .? I guess because Gross.Losses are zero .
Is it normal or am I doing something wrong ?

? ? ?Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
ABTL? ?270.967742? ? ? 270.96774? ? ? ?0.00000? ? ?270.96774? ? ? 0.00000

? ? ?Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
ABTL? ? ? ? ? ? ? ?NA? ? ? ? 100.00000? ? ? ? ? 0.00000? ? ? ? ? ?Inf

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From josh.m.ulrich at gmail.com  Tue Oct  7 04:04:21 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 6 Oct 2014 21:04:21 -0500
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
In-Reply-To: <20141006220040.21130@web010.roc2.bluetie.com>
References: <20141006220040.21130@web010.roc2.bluetie.com>
Message-ID: <CAPPM_gQi+K+PiEiTUxzV=ynoR8-c=-NSDq=0CJvu+jFE9HpaFg@mail.gmail.com>

The source code is available to you.  Please look at it.  You have no
losing trades.  What do you expect your gross losses to be?
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Mon, Oct 6, 2014 at 9:00 PM, ce <zadig_1 at excite.com> wrote:
> yes but in the output I pasted Gross Profit is 270.96774 , so  I have some profit, no loss meaning ????
>
>
> -----Original Message-----
> From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
> Date: 10/06/2014 09:48 PM
> To: "ce" <zadig_1 at excite.com>
> CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
> Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
>
> So theres your answer.
>
> On Mon, Oct 6, 2014 at 9:35 PM, ce <zadig_1 at excite.com> wrote:
>
> Which ever way it calculates abs(0) is still 0 . Gross Profit / 0 is Inf .
>
>
> -----Original Message-----
> From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
> Date: 10/06/2014 09:26 PM
> To: "ce" <zadig_1 at excite.com>
> CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
> Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
>
> That depends if gross loss is computed as positive or negative. Tradestats computes it as a negative quantity.
>
> On Mon, Oct 6, 2014 at 8:54 PM, ce <zadig_1 at excite.com> wrote:
>
> most resources says  profit factor = gross profit / gross loss
>
> one example is http://www.tradingmarkets.com/recent/whats_your_profit_factor_heres_an_assignment_for_you-657965.html
>
>
> -----Original Message-----
> From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
> Date: 10/06/2014 08:45 PM
> To: "ce" <zadig_1 at excite.com>
> CC: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
> Subject: Re: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
>
> Profit factor is defined as the absolute value of gross profits over gross losses. What is anything divided by zero?
>
> On Mon, Oct 6, 2014 at 8:40 PM, ce <zadig_1 at excite.com> wrote:
>
> My test program gives in tradeStats output some Profit factors as  Inf  .  I guess because Gross.Losses are zero .
> Is it normal or am I doing something wrong ?
>
>      Med.Trade.PL Largest.Winner Largest.Loser Gross.Profits Gross.Losses
> ABTL   270.967742      270.96774       0.00000     270.96774      0.00000
>
>      Std.Dev.Trade.PL Percent.Positive Percent.Negative Profit.Factor
> ABTL               NA        100.00000          0.00000           Inf
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From daniel.cegielka at gmail.com  Tue Oct  7 07:38:06 2014
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Tue, 7 Oct 2014 07:38:06 +0200
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
In-Reply-To: <CAPPM_gQi+K+PiEiTUxzV=ynoR8-c=-NSDq=0CJvu+jFE9HpaFg@mail.gmail.com>
References: <20141006220040.21130@web010.roc2.bluetie.com>
	<CAPPM_gQi+K+PiEiTUxzV=ynoR8-c=-NSDq=0CJvu+jFE9HpaFg@mail.gmail.com>
Message-ID: <CAPLrYESeTPWevbjgRV3mxoJ1sR21-BWhv-TJpd3HGNrO3TUpaw@mail.gmail.com>

https://github.com/rforge/blotter/blob/master/pkg/blotter/R/tradeStats.R#L147

GrossProfits <- sum(PL.gt0)
GrossLosses <- sum(PL.lt0)
if(GrossLosses == 0) ProfitFactor <- NA
else  ProfitFactor <- abs(GrossProfits/GrossLosses)

Daniel


From daniel.cegielka at gmail.com  Tue Oct  7 08:22:37 2014
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Tue, 7 Oct 2014 08:22:37 +0200
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
In-Reply-To: <CAPLrYESeTPWevbjgRV3mxoJ1sR21-BWhv-TJpd3HGNrO3TUpaw@mail.gmail.com>
References: <20141006220040.21130@web010.roc2.bluetie.com>
	<CAPPM_gQi+K+PiEiTUxzV=ynoR8-c=-NSDq=0CJvu+jFE9HpaFg@mail.gmail.com>
	<CAPLrYESeTPWevbjgRV3mxoJ1sR21-BWhv-TJpd3HGNrO3TUpaw@mail.gmail.com>
Message-ID: <CAPLrYESopf5iZPrtGU76N2XaEMf8KLsf5o8MkMT-vuY4dn-Gyg@mail.gmail.com>

2014-10-07 7:38 GMT+02:00 Daniel Cegie?ka <daniel.cegielka at gmail.com>:
> https://github.com/rforge/blotter/blob/master/pkg/blotter/R/tradeStats.R#L147
>
> GrossProfits <- sum(PL.gt0)
> GrossLosses <- sum(PL.lt0)
> if(GrossLosses == 0) ProfitFactor <- NA
> else  ProfitFactor <- abs(GrossProfits/GrossLosses)

more compact:

GrossProfits <- sum(PL.gt0)
GrossLosses <- sum(PL.lt0)
ProfitFactor <- ifelse(GrossLosses == 0, NA, abs(GrossProfits/GrossLosses))

Maybe we should add more such checks to the code (for div ops)? eg:

AnnSharpe  <- ifelse(StdDailyPL == 0, NA, AvgDailyPL/StdDailyPL * sqrt(252))
AvgWinLoss <- ifelse(AvgLossTrade == 0, NA, AvgWinTrade/-AvgLossTrade)
MedWinLoss <- ifelse(MedLossTrade == 0, NA, MedWinTrade/-MedLossTrade)
ProfitToMaxDraw  <- ifelse(MaxDrawdown == 0, NA, -TotalNetProfit / MaxDrawdown)

btw. NA looks better than Inf.

Daniel


From brian at braverock.com  Tue Oct  7 17:52:58 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 07 Oct 2014 10:52:58 -0500
Subject: [R-SIG-Finance] blotter tradeStats Profit.factor is Infinite ?
In-Reply-To: <CAPLrYESopf5iZPrtGU76N2XaEMf8KLsf5o8MkMT-vuY4dn-Gyg@mail.gmail.com>
References: <20141006220040.21130@web010.roc2.bluetie.com>	<CAPPM_gQi+K+PiEiTUxzV=ynoR8-c=-NSDq=0CJvu+jFE9HpaFg@mail.gmail.com>	<CAPLrYESeTPWevbjgRV3mxoJ1sR21-BWhv-TJpd3HGNrO3TUpaw@mail.gmail.com>
	<CAPLrYESopf5iZPrtGU76N2XaEMf8KLsf5o8MkMT-vuY4dn-Gyg@mail.gmail.com>
Message-ID: <54340C5A.7020108@braverock.com>

On 10/07/2014 01:22 AM, Daniel Cegie?ka wrote:
> 2014-10-07 7:38 GMT+02:00 Daniel Cegie?ka <daniel.cegielka at gmail.com>:
>> https://github.com/rforge/blotter/blob/master/pkg/blotter/R/tradeStats.R#L147
>>
>> GrossProfits <- sum(PL.gt0)
>> GrossLosses <- sum(PL.lt0)
>> if(GrossLosses == 0) ProfitFactor <- NA
>> else  ProfitFactor <- abs(GrossProfits/GrossLosses)
>
> more compact:
>
> GrossProfits <- sum(PL.gt0)
> GrossLosses <- sum(PL.lt0)
> ProfitFactor <- ifelse(GrossLosses == 0, NA, abs(GrossProfits/GrossLosses))
>
> Maybe we should add more such checks to the code (for div ops)? eg:
>
> AnnSharpe  <- ifelse(StdDailyPL == 0, NA, AvgDailyPL/StdDailyPL * sqrt(252))
> AvgWinLoss <- ifelse(AvgLossTrade == 0, NA, AvgWinTrade/-AvgLossTrade)
> MedWinLoss <- ifelse(MedLossTrade == 0, NA, MedWinTrade/-MedLossTrade)
> ProfitToMaxDraw  <- ifelse(MaxDrawdown == 0, NA, -TotalNetProfit / MaxDrawdown)
>
> btw. NA looks better than Inf.

Thanks, patches applied in svn r1637.

Of course, a backtest with zero losing trades is implausibly perfect...

Regards,

Brian


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From daniel.cegielka at gmail.com  Tue Oct  7 22:26:23 2014
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Tue, 7 Oct 2014 22:26:23 +0200
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
Message-ID: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>

http://cran.r-project.org/web/packages/Defaults/index.html

That's a pretty important package that is required by quantmod.

Jeff? :)

best,
Daniel


From brian at braverock.com  Tue Oct  7 22:40:44 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 07 Oct 2014 15:40:44 -0500
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
Message-ID: <54344FCC.8080700@braverock.com>

On 10/07/2014 03:26 PM, Daniel Cegie?ka wrote:
> http://cran.r-project.org/web/packages/Defaults/index.html
>
> That's a pretty important package that is required by quantmod.

Yes.

Defaults makes use of unlockBindings to change loaded package 
namespaces.  That's no longer allowed by CRAN.

So, we'll need to modify getSymbols to not require it.

The old chartSeries uses it too, but we'll be replacing that soon, so 
I'm not worried about that dependency.

Regards,

Brian


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From josh.m.ulrich at gmail.com  Wed Oct  8 04:14:34 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 7 Oct 2014 21:14:34 -0500
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <54344FCC.8080700@braverock.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
	<54344FCC.8080700@braverock.com>
Message-ID: <CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>

I just pushed an updated quantmod_0.4-2 to R-Forge.  Most of the
Defaults-related issues have been addressed, except for
getSymbols.MySQL and setTA/unsetTA.  Feedback would be much
appreciated.
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Tue, Oct 7, 2014 at 3:40 PM, Brian G. Peterson <brian at braverock.com> wrote:
> On 10/07/2014 03:26 PM, Daniel Cegie?ka wrote:
>>
>> http://cran.r-project.org/web/packages/Defaults/index.html
>>
>> That's a pretty important package that is required by quantmod.
>
>
> Yes.
>
> Defaults makes use of unlockBindings to change loaded package namespaces.
> That's no longer allowed by CRAN.
>
> So, we'll need to modify getSymbols to not require it.
>
> The old chartSeries uses it too, but we'll be replacing that soon, so I'm
> not worried about that dependency.
>
> Regards,
>
> Brian
>
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


From junluke at gmail.com  Wed Oct  8 05:11:55 2014
From: junluke at gmail.com (jun wang)
Date: Tue, 7 Oct 2014 23:11:55 -0400
Subject: [R-SIG-Finance] SPA test in ttr Test
Message-ID: <CAPD4hGCg3DJ4M1+KKeNzQrWtLECEfEGFYFN0B2bSxroj8mTcag@mail.gmail.com>

Hi, All,

I am using dataSnoop in the ttr Test package to do superior predict ability
test for my models. And i had the following errors:

 spa <- dataSnoop(a,bSamples=3,test="SPA")

Preparing to Analyze 24 Parameterizations of TTR
Error in na.fail.default(as.ts(x)) : missing values in object
In addition: Warning messages:
1: In log(x) : NaNs produced
2: In log(x) : NaNs produced

where a is the difference between the base models loss function and the
loss function of other models. Should "a " be always positive?

Best,
Jun

	[[alternative HTML version deleted]]


From markknecht at gmail.com  Wed Oct  8 16:43:22 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 8 Oct 2014 07:43:22 -0700
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
	<54344FCC.8080700@braverock.com>
	<CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>
Message-ID: <CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>

On Tue, Oct 7, 2014 at 7:14 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> I just pushed an updated quantmod_0.4-2 to R-Forge.  Most of the
> Defaults-related issues have been addressed, except for
> getSymbols.MySQL and setTA/unsetTA.  Feedback would be much
> appreciated.
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>
>
> On Tue, Oct 7, 2014 at 3:40 PM, Brian G. Peterson <brian at braverock.com> wrote:
>> On 10/07/2014 03:26 PM, Daniel Cegie?ka wrote:
>>>
>>> http://cran.r-project.org/web/packages/Defaults/index.html
>>>
>>> That's a pretty important package that is required by quantmod.
>>
>>
>> Yes.
>>
>> Defaults makes use of unlockBindings to change loaded package namespaces.
>> That's no longer allowed by CRAN.
>>
>> So, we'll need to modify getSymbols to not require it.
>>
>> The old chartSeries uses it too, but we'll be replacing that soon, so I'm
>> not worried about that dependency.
>>
>> Regards,
>>
>> Brian
>>
>>
>> --
>> Brian G. Peterson
>> http://braverock.com/brian/
>> Ph: 773-459-4973
>> IM: bgpbraverock
>>
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


OK, it seems to work but requires me to modify long working code to remove
setDefaults and then put the database stuff in the actual call. Is
this the way this
is intended to work in the future and I should modify my files?

I'm pretty sure the data is coming from MySQL as AAPL is not in the ETF
database and it fails if I add it to the symbol list:

> source('~/.active-rstudio-document')
[1] "From MySQL --  SPY"
[1] "From MySQL --  IWM"
[1] "From MySQL --  QQQ"
[1] "From MySQL --  AAPL"
Error in Symbols[[i]] : subscript out of bounds
In addition: Warning message:
In getSymbols.MySQL(Symbols = "AAPL", env = <environment>, verbose = FALSE,  :
  could not load symbol(s):  AAPL

>

The code I ran is at the bottom.

Thanks,
Mark


> source('~/R/Test Cases/RMySQL-Test.R')
Loading required package: xts
Loading required package: zoo

Attaching package: ?zoo?

The following objects are masked from ?package:base?:

    as.Date, as.Date.numeric

Loading required package: TTR
Version 0.4-0 included new data defaults. See ?getSymbols.
Loading required package: DBI
[1] "From MySQL --  SPY"
    As of 0.4-0, ?getSymbols? uses env=parent.frame() and
 auto.assign=TRUE by default.

 This  behavior  will be  phased out in 0.5-0  when the call  will
 default to use auto.assign=FALSE. getOption("getSymbols.env") and
 getOptions("getSymbols.auto.assign") are now checked for alternate defaults

 This message is shown once per session and may be disabled by setting
 options("getSymbols.warning4.0"=FALSE). See ?getSymbol for more details
[1] "From MySQL --  IWM"
[1] "From MySQL --  QQQ"

>


llibrary(quantmod)
library(RMySQL)

Sys.setenv(TZ = "UTC")
DataStart = "1990-01-01"
DataEnd = format(Sys.time(), "%Y-%m-%d")
SymbolSrc = "yahoo"
dbName = "R_ETF"
MyAdjust = TRUE
UseMySQL = TRUE

SymbolList = c("SPY","IWM","QQQ")

if (UseMySQL){
  if (MyAdjust) { dbName = paste0(dbName, "Adjust")}
  dbc = dbConnect(MySQL(), dbname=dbName)
#   setDefaults(getSymbols.MySQL, user="mark",
password="MyTempPassword", dbname=dbName)
}

if (!UseMySQL){
  for (i in 1:length(SymbolList)){
    print(paste("From ",SymbolSrc," -- ",SymbolList[i]))
    getSymbolsCont(SymbolList[i], from = DataStart, to = DataEnd,
adjust = MyAdjust, src=SymbolSrc)
  }
} else {
  for (i in 1:length(SymbolList)){
    print(paste("From MySQL -- ",SymbolList[i]))
 #   getSymbols(SymbolList[i], src="MySQL")
    getSymbols(SymbolList[i], src="MySQL", user="mark",
password="MyTempPassword", dbname=dbName)
    assign(SymbolList[i], get(SymbolList[i])[paste0(DataStart,"/",DataEnd)])
  }
  dbDisconnect(dbc)
}


From daniel.cegielka at gmail.com  Wed Oct  8 18:27:25 2014
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Wed, 8 Oct 2014 18:27:25 +0200
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
	<54344FCC.8080700@braverock.com>
	<CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>
	<CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>
Message-ID: <CAPLrYER4w9bUESo7a88UGn4P2BzKJ0YHKHkAZc_XQ=nEHVzxjA@mail.gmail.com>

Thank you for this information. This solves annoying problems that
have recently emerged in this topic, but as Mark pointed out, the
complete removal of Defaults may take much more time.

Best regards,
Daniel


From markknecht at gmail.com  Wed Oct  8 18:43:21 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 8 Oct 2014 09:43:21 -0700
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <CAPLrYER4w9bUESo7a88UGn4P2BzKJ0YHKHkAZc_XQ=nEHVzxjA@mail.gmail.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
	<54344FCC.8080700@braverock.com>
	<CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>
	<CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>
	<CAPLrYER4w9bUESo7a88UGn4P2BzKJ0YHKHkAZc_XQ=nEHVzxjA@mail.gmail.com>
Message-ID: <CAK2H+edBhPENUnMNo2=3AcycnrQmx5ecafhsOqtKSQu3+paj2w@mail.gmail.com>

On Wed, Oct 8, 2014 at 9:27 AM, Daniel Cegie?ka
<daniel.cegielka at gmail.com> wrote:
> Thank you for this information. This solves annoying problems that
> have recently emerged in this topic, but as Mark pointed out, the
> complete removal of Defaults may take much more time.
>
> Best regards,
> Daniel

For getSymbols.MySQL only:

WRT to coding I'm certainly not the best person to do it but if
getSymbols.MySQL ,
or even just some other support function, read the .my.cnf file then
we'd probably
have a more standard long term solution with (slightly) better
security. I'm coding
up a simple function to do that for my simple needs. It doesn't seem
like it should
be an overly difficult task. The basic file format is:

mark at c2RAID6 ~ $ cat .my.cnf
[client]
user = mark
password = MyTempPassword
host = localhost

mark at c2RAID6 ~ $

so finding the [client] group and then gathering user & password would be
enough to handle the security part of the MySQL access.

> args(getSymbols.MySQL)
function (Symbols, env, return.class = "xts", db.fields = c("date",
    "o", "h", "l", "c", "v", "a"), field.names = NULL, user = NULL,
    password = NULL, dbname = NULL, host = "localhost", port = 3306,
    ...)
NULL

>

If the function was called from within getSymbols.MySQL then the
user & password would remain private and be destroyed when exiting
getSymbols.MySQL which would yield better security. (I think...) The user
could still pass in the values if he didn't want to do this on every call.

I need to learn to handle strings better... :-)

- Mark


From gsee000 at gmail.com  Wed Oct  8 18:56:40 2014
From: gsee000 at gmail.com (G See)
Date: Wed, 8 Oct 2014 11:56:40 -0500
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
	<54344FCC.8080700@braverock.com>
	<CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>
	<CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>
Message-ID: <CA+xi=qY0D2gS2t8r6YL3eWSq9HdCecAkjtpRfxDeoqHR=0RprQ@mail.gmail.com>

Out of curiosity, did you try _not_ changing your current code, but
instead adding library(Defaults) to the top of the script?  It's not
ideal, but Defaults _is_ still available
(http://cran.r-project.org/src/contrib/Archive/Defaults/).  That could
buy you some time until you come up with something better.

Just a (possibly bad) thought.
Garrett

On Wed, Oct 8, 2014 at 9:43 AM, Mark Knecht <markknecht at gmail.com> wrote:
> On Tue, Oct 7, 2014 at 7:14 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>> I just pushed an updated quantmod_0.4-2 to R-Forge.  Most of the
>> Defaults-related issues have been addressed, except for
>> getSymbols.MySQL and setTA/unsetTA.  Feedback would be much
>> appreciated.
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com
>>
>>
>> On Tue, Oct 7, 2014 at 3:40 PM, Brian G. Peterson <brian at braverock.com> wrote:
>>> On 10/07/2014 03:26 PM, Daniel Cegie?ka wrote:
>>>>
>>>> http://cran.r-project.org/web/packages/Defaults/index.html
>>>>
>>>> That's a pretty important package that is required by quantmod.
>>>
>>>
>>> Yes.
>>>
>>> Defaults makes use of unlockBindings to change loaded package namespaces.
>>> That's no longer allowed by CRAN.
>>>
>>> So, we'll need to modify getSymbols to not require it.
>>>
>>> The old chartSeries uses it too, but we'll be replacing that soon, so I'm
>>> not worried about that dependency.
>>>
>>> Regards,
>>>
>>> Brian
>>>
>>>
>>> --
>>> Brian G. Peterson
>>> http://braverock.com/brian/
>>> Ph: 773-459-4973
>>> IM: bgpbraverock
>>>
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>>> should go.
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.
>
>
> OK, it seems to work but requires me to modify long working code to remove
> setDefaults and then put the database stuff in the actual call. Is
> this the way this
> is intended to work in the future and I should modify my files?
>
> I'm pretty sure the data is coming from MySQL as AAPL is not in the ETF
> database and it fails if I add it to the symbol list:
>
>> source('~/.active-rstudio-document')
> [1] "From MySQL --  SPY"
> [1] "From MySQL --  IWM"
> [1] "From MySQL --  QQQ"
> [1] "From MySQL --  AAPL"
> Error in Symbols[[i]] : subscript out of bounds
> In addition: Warning message:
> In getSymbols.MySQL(Symbols = "AAPL", env = <environment>, verbose = FALSE,  :
>   could not load symbol(s):  AAPL
>
>>
>
> The code I ran is at the bottom.
>
> Thanks,
> Mark
>
>
>> source('~/R/Test Cases/RMySQL-Test.R')
> Loading required package: xts
> Loading required package: zoo
>
> Attaching package: ?zoo?
>
> The following objects are masked from ?package:base?:
>
>     as.Date, as.Date.numeric
>
> Loading required package: TTR
> Version 0.4-0 included new data defaults. See ?getSymbols.
> Loading required package: DBI
> [1] "From MySQL --  SPY"
>     As of 0.4-0, ?getSymbols? uses env=parent.frame() and
>  auto.assign=TRUE by default.
>
>  This  behavior  will be  phased out in 0.5-0  when the call  will
>  default to use auto.assign=FALSE. getOption("getSymbols.env") and
>  getOptions("getSymbols.auto.assign") are now checked for alternate defaults
>
>  This message is shown once per session and may be disabled by setting
>  options("getSymbols.warning4.0"=FALSE). See ?getSymbol for more details
> [1] "From MySQL --  IWM"
> [1] "From MySQL --  QQQ"
>
>>
>
>
> llibrary(quantmod)
> library(RMySQL)
>
> Sys.setenv(TZ = "UTC")
> DataStart = "1990-01-01"
> DataEnd = format(Sys.time(), "%Y-%m-%d")
> SymbolSrc = "yahoo"
> dbName = "R_ETF"
> MyAdjust = TRUE
> UseMySQL = TRUE
>
> SymbolList = c("SPY","IWM","QQQ")
>
> if (UseMySQL){
>   if (MyAdjust) { dbName = paste0(dbName, "Adjust")}
>   dbc = dbConnect(MySQL(), dbname=dbName)
> #   setDefaults(getSymbols.MySQL, user="mark",
> password="MyTempPassword", dbname=dbName)
> }
>
> if (!UseMySQL){
>   for (i in 1:length(SymbolList)){
>     print(paste("From ",SymbolSrc," -- ",SymbolList[i]))
>     getSymbolsCont(SymbolList[i], from = DataStart, to = DataEnd,
> adjust = MyAdjust, src=SymbolSrc)
>   }
> } else {
>   for (i in 1:length(SymbolList)){
>     print(paste("From MySQL -- ",SymbolList[i]))
>  #   getSymbols(SymbolList[i], src="MySQL")
>     getSymbols(SymbolList[i], src="MySQL", user="mark",
> password="MyTempPassword", dbname=dbName)
>     assign(SymbolList[i], get(SymbolList[i])[paste0(DataStart,"/",DataEnd)])
>   }
>   dbDisconnect(dbc)
> }
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From markknecht at gmail.com  Wed Oct  8 19:19:22 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 8 Oct 2014 10:19:22 -0700
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <CA+xi=qY0D2gS2t8r6YL3eWSq9HdCecAkjtpRfxDeoqHR=0RprQ@mail.gmail.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
	<54344FCC.8080700@braverock.com>
	<CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>
	<CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>
	<CA+xi=qY0D2gS2t8r6YL3eWSq9HdCecAkjtpRfxDeoqHR=0RprQ@mail.gmail.com>
Message-ID: <CAK2H+ecr2WHrBj6V1bY-0noCZGQpCUQewtoiRnQweHv7hHAhgQ@mail.gmail.com>

On Wed, Oct 8, 2014 at 9:56 AM, G See <gsee000 at gmail.com> wrote:
> Out of curiosity, did you try _not_ changing your current code, but
> instead adding library(Defaults) to the top of the script?  It's not
> ideal, but Defaults _is_ still available
> (http://cran.r-project.org/src/contrib/Archive/Defaults/).  That could
> buy you some time until you come up with something better.
>
> Just a (possibly bad) thought.
> Garrett
>

I did not but for whatever reason it didn't seem to work for me. SetDefaults is
apparently found and the defaults are in therebut getSymbols.MySQL didn't
apparently pick up. SPY is not returned, QQQ is when I pass the info
in explicitly.
I'm probably doing something stupid...

- Mark

> library(quantmod)
> library(RMySQL)
> library(Defaults)
>
>
> dbName = "R_ETF"
>
> getDefaults()
[1] "getSymbols.MySQL"
>
> dbc = dbConnect(MySQL(), dbname=dbName)
> setDefaults(getSymbols.MySQL, user="mark", password="MyTempPassword", dbname=dbName)
>
> getDefaults()
[1] "getSymbols.MySQL"
>
> getDefaults("getSymbols.MySQL")
$user
[1] "'mark'"

$password
[1] "'MyTempPassword'"

$dbname
[1] "dbName"

>
> getSymbols("SPY", src="MySQL")
Error in getSymbols.MySQL(Symbols = "SPY", env = <environment>,
verbose = FALSE,  :
  At least one connection argument ( ?user? ?password? ?dbname? ) is not set
>
> getSymbols("QQQ", src="MySQL", user="mark", password="MyTempPassword", dbname=dbName)
[1] "QQQ"

>



library(quantmod)
library(RMySQL)
library(Defaults)


dbName = "R_ETF"

getDefaults()

dbc = dbConnect(MySQL(), dbname=dbName)
setDefaults(getSymbols.MySQL, user="mark", password="MyTempPassword",
dbname=dbName)

getDefaults()

getDefaults("getSymbols.MySQL")

getSymbols("SPY", src="MySQL")

getSymbols("QQQ", src="MySQL", user="mark", password="MyTempPassword",
dbname=dbName)


From cduranceau at nial.ky  Wed Oct  8 22:24:27 2014
From: cduranceau at nial.ky (Charles Duranceau)
Date: Wed, 8 Oct 2014 20:24:27 +0000
Subject: [R-SIG-Finance] Return.rebalancing contemporaneous calculation
Message-ID: <253B4FA1ECEEB54DB661809CB67734552A09A2F6@NOR-EXC01.northview.local>

Hi,
I'm working with "Performance Analytics" for calculating portfolio returns using the function Return.rebalancing. I don't understand why the results - portfolio returns - are lagged by 1 period when compared to Return.portfolio (assuming weight are time invariant).

I read the definition that explain the rebalancing is taken place in the next period but since the input are returns (like in  Return.portfolio) they should be consolidated on same period.
Is there a way not losing the first input?

Here few lines to illustrate my question

pfmf2003<-Return.rebalancing(mfr2003,wghts1)
pfstat<-Return.portfolio(mfr2003,c(1,0))
** wghts1 = 1 for the period

Results
                        portfolio.Rebal       portfolio.returns.
2003-05-31      0.0087336245         0.203679369
2003-06-30      0.1093073593         0.008733624
2003-07-31     -0.0351219512         0.109307359
2003-08-31     -0.0404448938        -0.035121951
2003-09-30     -0.0063224447        -0.040444894



many thanks

Charles


**********************************************************************************************************************************************************
The contents of this email and any attachments are confidential to the intended recipient.  They may not be disclosed to or used by or copied in any way by anyone other than the intended recipient.  If this email is received in error, please contact Northview Investment Advisors Ltd. on + 1 345 943 2828 quoting the name of the sender and the email address to which it has been sent and then delete it.

Please further note that neither Northview Investment Advisors Ltd. nor the sender accepts any responsibility for viruses and it is your responsibility to scan or otherwise check this email and any attachments.

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Oct  8 22:33:28 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 08 Oct 2014 15:33:28 -0500
Subject: [R-SIG-Finance] Return.rebalancing contemporaneous calculation
In-Reply-To: <253B4FA1ECEEB54DB661809CB67734552A09A2F6@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB67734552A09A2F6@NOR-EXC01.northview.local>
Message-ID: <54359F98.1080308@braverock.com>

On 10/08/2014 03:24 PM, Charles Duranceau wrote:
> Hi,
> I'm working with "PerformanceAnalytics" for calculating portfolio returns using the function Return.rebalancing. I don't understand why the results - portfolio returns - are lagged by 1 period when compared to Return.portfolio (assuming weight are time invariant).
>
> I read the definition that explain the rebalancing is taken place in the next period but since the input are returns (like in  Return.portfolio) they should be consolidated on same period.
> Is there a way not losing the first input?
>
> Here few lines to illustrate my question
>
> pfmf2003<-Return.rebalancing(mfr2003,wghts1)
> pfstat<-Return.portfolio(mfr2003,c(1,0))
> ** wghts1 = 1 for the period
>
> Results
>                          portfolio.Rebal       portfolio.returns.
> 2003-05-31      0.0087336245         0.203679369
> 2003-06-30      0.1093073593         0.008733624
> 2003-07-31     -0.0351219512         0.109307359
> 2003-08-31     -0.0404448938        -0.035121951
> 2003-09-30     -0.0063224447        -0.040444894

Return.portfolio and Return.rebalancing are the same function in current
CRAN version, and have been in the R-Forge version for quite a while.

Can you give us your sessionInfo, and a fully reproducible example?

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From weihanliu2002 at yahoo.com  Thu Oct  9 01:39:22 2014
From: weihanliu2002 at yahoo.com (Wei-han Liu)
Date: Wed, 8 Oct 2014 23:39:22 +0000 (UTC)
Subject: [R-SIG-Finance] plm package: variable lengths differ
Message-ID: <2143195744.677925.1412811562819.JavaMail.yahoo@jws10740.mail.gq1.yahoo.com>

Hi R users:
I am conducting high frequency data analysis based on plm package. It works fine for the dataset with lower data frequency but not for 1-min dataset. Listed below is the error message:pooltest(form, ?data ?= ?E, ?effect ?= ?"individual", ?model ?= ?"within")Error in model.frame.default(terms(formula, lhs = lhs, rhs = rhs, data = data), ?:? variable lengths differ (found for 'lag(IOB, k = 1)')Calls: pooltest ... model.frame.Formula -> model.frame -> model.frame.defaultExecution halted
I have encountered the same error message when I tried the other functions for testing and estimation in package plm. I check the original dataset and all the columns are of the same length but the error message indicates otherwise:?variable lengths differ (found for 'lag(IOB, k = 1)').?lag(IOB, k = 1) denotes the lagged term of variable IOB with one period.?
I googled and found some people raised the similar question but no helpful tip is provided yet. For example,?R help - length of variable in mlogit

| ? |
| ? |  | ? | ? | ? | ? | ? |
| R help - length of variable in mlogitlength of variable in mlogit. Dear all, does anybody have experience with building logits in Mlogit? I want to test the use of a couple of alternative specific vari... |
|  |
| View on r.789695.n4.nabble.com | Preview by Yahoo |
|  |
| ? |

 ?Could some people share advice and help in this regard?
Best regards,
Weihan
	[[alternative HTML version deleted]]


From markknecht at gmail.com  Thu Oct  9 22:05:53 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Thu, 9 Oct 2014 13:05:53 -0700
Subject: [R-SIG-Finance] quantstrat - model transactions on specific dates
Message-ID: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>

Hi,
   I suspect I'm making this far more difficult than it needs to be,
however I've spent time looking on Stack Overflow and couldn't find an
answer. Hopefully someone here can point me in the right direction.
Thanks in advance.

   I would like to do something in quantstrat like set up an initial
buy for all symbols in a portfolio on a certain date. To that end I
want a signal column that says the date is matching my buy date and
then I'l execute a specific rule. However signals need to match
columns which led me to wanting the index in a column as a value. To
that end the code below basically does this but returns  a numerical
value which (I think) is referenced to 1970-01-01.

> tail(IndexAsXts)
           xtsIndex
2014-10-01    16344
2014-10-02    16345
2014-10-03    16346
2014-10-06    16349
2014-10-07    16350
2014-10-08    16351

>

   Anyway, how do I turn these numeric values back into dates that I
could test against 'testDate'?

Thanks,
Mark



require(quantstrat)

Sys.setenv(TZ="UTC")

symbol = "SPY"
getSymbols(symbol,src="yahoo",from="2014-01-01")

testDate = "2014-03-11"

xtsIndex = function(data){
  xtsIndex = reclass(index(data), match.to=data)
  colnames(xtsIndex)="xtsIndex"
  return(xtsIndex)
}

IndexAsXts = xtsIndex(get(symbol))

tail(IndexAsXts)

#Find origin

LastVal = last(IndexAsXts)
OriginDate = index(LastVal) - as.numeric(LastVal)
print(OriginDate)

tail(as.POSIXct(coredata(IndexAsXts), origin=OriginDate,
tz=Sys.getenv("TZ")), 5)


From markknecht at gmail.com  Thu Oct  9 22:26:04 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Thu, 9 Oct 2014 13:26:04 -0700
Subject: [R-SIG-Finance] quantstrat - model transactions on specific
	dates
In-Reply-To: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>
References: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>
Message-ID: <CAK2H+eff1RBwvdcuY3uokk0pCZ4K2+QoSFr98X6VYjYbh45MTQ@mail.gmail.com>

On Thu, Oct 9, 2014 at 1:05 PM, Mark Knecht <markknecht at gmail.com> wrote:
> Hi,
>    I suspect I'm making this far more difficult than it needs to be,
> however I've spent time looking on Stack Overflow and couldn't find an
> answer. Hopefully someone here can point me in the right direction.
> Thanks in advance.
>
>    I would like to do something in quantstrat like set up an initial
> buy for all symbols in a portfolio on a certain date. To that end I
> want a signal column that says the date is matching my buy date and
> then I'l execute a specific rule. However signals need to match
> columns which led me to wanting the index in a column as a value. To
> that end the code below basically does this but returns  a numerical
> value which (I think) is referenced to 1970-01-01.
>
>> tail(IndexAsXts)
>            xtsIndex
> 2014-10-01    16344
> 2014-10-02    16345
> 2014-10-03    16346
> 2014-10-06    16349
> 2014-10-07    16350
> 2014-10-08    16351
>
>>
>
>    Anyway, how do I turn these numeric values back into dates that I
> could test against 'testDate'?
>
> Thanks,
> Mark
>
>
>
> require(quantstrat)
>
> Sys.setenv(TZ="UTC")
>
> symbol = "SPY"
> getSymbols(symbol,src="yahoo",from="2014-01-01")
>
> testDate = "2014-03-11"
>
> xtsIndex = function(data){
>   xtsIndex = reclass(index(data), match.to=data)
>   colnames(xtsIndex)="xtsIndex"
>   return(xtsIndex)
> }
>
> IndexAsXts = xtsIndex(get(symbol))
>
> tail(IndexAsXts)
>
> #Find origin
>
> LastVal = last(IndexAsXts)
> OriginDate = index(LastVal) - as.numeric(LastVal)
> print(OriginDate)
>
> tail(as.POSIXct(coredata(IndexAsXts), origin=OriginDate,
> tz=Sys.getenv("TZ")), 5)

Humm...It gets considerably closer with

getSymbols(symbol,src="yahoo",from="2014-01-01",
           index.class=c("POSIXt","POSIXct"))


From brian at braverock.com  Thu Oct  9 22:31:44 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Thu, 09 Oct 2014 15:31:44 -0500
Subject: [R-SIG-Finance] quantstrat - model transactions on specific
	dates
In-Reply-To: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>
References: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>
Message-ID: <5436F0B0.90106@braverock.com>

On 10/09/2014 03:05 PM, Mark Knecht wrote:
>     I would like to do something in quantstrat like set up an initial
> buy for all symbols in a portfolio on a certain date. To that end I
> want a signal column that says the date is matching my buy date and
> then I'l execute a specific rule. However signals need to match
> columns which led me to wanting the index in a column as a value. To
> that end the code below basically does this but returns  a numerical
> value which (I think) is referenced to 1970-01-01.

It seems to me that the simplest thing would be to just establish your 
initial portfolio.

Initialize the portfolio, then construct a data.frame for the txnData 
argument of addTxns.

Call addTxns before calling applyStrategy.

Alternately, you could modify sigFlatten to essentially do the opposite, 
and initiate on a certain time.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From josh.m.ulrich at gmail.com  Thu Oct  9 22:35:16 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 9 Oct 2014 15:35:16 -0500
Subject: [R-SIG-Finance] quantstrat - model transactions on specific
	dates
In-Reply-To: <5436F0B0.90106@braverock.com>
References: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>
	<5436F0B0.90106@braverock.com>
Message-ID: <CAPPM_gQdV0==Wde2DMY0qr1KsioXEAUh7A0rg7WUt5M9T1xnjA@mail.gmail.com>

On Thu, Oct 9, 2014 at 3:31 PM, Brian G. Peterson <brian at braverock.com> wrote:
> On 10/09/2014 03:05 PM, Mark Knecht wrote:
>>
>>     I would like to do something in quantstrat like set up an initial
>> buy for all symbols in a portfolio on a certain date. To that end I
>> want a signal column that says the date is matching my buy date and
>> then I'l execute a specific rule. However signals need to match
>> columns which led me to wanting the index in a column as a value. To
>> that end the code below basically does this but returns  a numerical
>> value which (I think) is referenced to 1970-01-01.
>
> It seems to me that the simplest thing would be to just establish your
> initial portfolio.
>
> Initialize the portfolio, then construct a data.frame for the txnData
> argument of addTxns.
>
> Call addTxns before calling applyStrategy.
>
> Alternately, you could modify sigFlatten to essentially do the opposite, and
> initiate on a certain time.
>
You're thinking of sigTimestamp (which was based on sigFlatten, but
I'm not sure was ever made public).  Mark, I think sigTimestamp is
what you're looking for.

> Regards,
>
> Brian
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>

--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From markknecht at gmail.com  Thu Oct  9 23:00:27 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Thu, 9 Oct 2014 14:00:27 -0700
Subject: [R-SIG-Finance] quantstrat - model transactions on specific
	dates
In-Reply-To: <CAPPM_gQdV0==Wde2DMY0qr1KsioXEAUh7A0rg7WUt5M9T1xnjA@mail.gmail.com>
References: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>
	<5436F0B0.90106@braverock.com>
	<CAPPM_gQdV0==Wde2DMY0qr1KsioXEAUh7A0rg7WUt5M9T1xnjA@mail.gmail.com>
Message-ID: <CAK2H+efw2PrRYVv8xt9y0Y7guouwVZum9PJ_wgQ0B3moGErPdw@mail.gmail.com>

On Thu, Oct 9, 2014 at 1:35 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> On Thu, Oct 9, 2014 at 3:31 PM, Brian G. Peterson <brian at braverock.com> wrote:
>> On 10/09/2014 03:05 PM, Mark Knecht wrote:
>>>
>>>     I would like to do something in quantstrat like set up an initial
>>> buy for all symbols in a portfolio on a certain date. To that end I
>>> want a signal column that says the date is matching my buy date and
>>> then I'l execute a specific rule. However signals need to match
>>> columns which led me to wanting the index in a column as a value. To
>>> that end the code below basically does this but returns  a numerical
>>> value which (I think) is referenced to 1970-01-01.
>>
>> It seems to me that the simplest thing would be to just establish your
>> initial portfolio.
>>
>> Initialize the portfolio, then construct a data.frame for the txnData
>> argument of addTxns.
>>
>> Call addTxns before calling applyStrategy.
>>
>> Alternately, you could modify sigFlatten to essentially do the opposite, and
>> initiate on a certain time.
>>
> You're thinking of sigTimestamp (which was based on sigFlatten, but
> I'm not sure was ever made public).  Mark, I think sigTimestamp is
> what you're looking for.
>
>> Regards,
>>
>> Brian
>>


Brian & Joshua,
   Thanks. I'll investigate them both.

   Longer term though I think my general question may still come up.
I've been looking at rebalancing at the portfolio level. Best I can
tell the applyStrategy.rebalance function rebalances individual stocks
based on the last entry date of that stock but not, for instance, on a
specific date like the a calendar quarter. (I wasn't going to post
this all right now until I was really sure so don't take this too
seriously.) Anyway I want to write something like what Faber &
Richardson wrote about in 'The Ivy Portfolio' where the whole
portfolio is rebalanced on a given date, like end-of-month,
independent of whether I'm using the 10 month SMA or not. For that
reason I figured I might need a way to match indexes to dates going
though time.

   Anyway, enough for now. Thanks for all your help guys!

Cheers,
Mark


From brian at braverock.com  Thu Oct  9 23:16:28 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Thu, 09 Oct 2014 16:16:28 -0500
Subject: [R-SIG-Finance] quantstrat - model transactions on specific
	dates
In-Reply-To: <CAK2H+efw2PrRYVv8xt9y0Y7guouwVZum9PJ_wgQ0B3moGErPdw@mail.gmail.com>
References: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>	<5436F0B0.90106@braverock.com>	<CAPPM_gQdV0==Wde2DMY0qr1KsioXEAUh7A0rg7WUt5M9T1xnjA@mail.gmail.com>
	<CAK2H+efw2PrRYVv8xt9y0Y7guouwVZum9PJ_wgQ0B3moGErPdw@mail.gmail.com>
Message-ID: <5436FB2C.2090309@braverock.com>

On 10/09/2014 04:00 PM, Mark Knecht wrote:
> Best I can
> tell the applyStrategy.rebalance function rebalances individual stocks
> based on the last entry date of that stock but not, for instance, on a
> specific date like the a calendar quarter. (I wasn't going to post
> this all right now until I was really sure so don't take this too
> seriously.) Anyway I want to write something like what Faber &
> Richardson wrote about in 'The Ivy Portfolio' where the whole
> portfolio is rebalanced on a given date, like end-of-month,
> independent of whether I'm using the 10 month SMA or not. For that
> reason I figured I might need a way to match indexes to dates going
> though time.

see the faber_rebal demo.

The rebalance_on argument will call the rebalancing rule(s) on whatever 
periodicity you tell it to, you'll have to have something for them to do.

In the demo, I just changed max order size, but there's no reason you 
couldn't write a (strategy specific) rebalancing rule that wouldn't read 
all the positions, and do transactions on the rebalance date.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From markknecht at gmail.com  Thu Oct  9 23:43:24 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Thu, 9 Oct 2014 14:43:24 -0700
Subject: [R-SIG-Finance] quantstrat - model transactions on specific
	dates
In-Reply-To: <5436FB2C.2090309@braverock.com>
References: <CAK2H+ec_y8ZvpBvAxryK6N0UNcyj0=MTZdpn1RwntwXdqjo_NQ@mail.gmail.com>
	<5436F0B0.90106@braverock.com>
	<CAPPM_gQdV0==Wde2DMY0qr1KsioXEAUh7A0rg7WUt5M9T1xnjA@mail.gmail.com>
	<CAK2H+efw2PrRYVv8xt9y0Y7guouwVZum9PJ_wgQ0B3moGErPdw@mail.gmail.com>
	<5436FB2C.2090309@braverock.com>
Message-ID: <CAK2H+ef+DnzjZPK+n7OL3nT_ExZykOaWkVyNKhurv316RRn+KQ@mail.gmail.com>

On Thu, Oct 9, 2014 at 2:16 PM, Brian G. Peterson <brian at braverock.com> wrote:
> On 10/09/2014 04:00 PM, Mark Knecht wrote:
>>
>> Best I can
>> tell the applyStrategy.rebalance function rebalances individual stocks
>> based on the last entry date of that stock but not, for instance, on a
>> specific date like the a calendar quarter. (I wasn't going to post
>> this all right now until I was really sure so don't take this too
>> seriously.) Anyway I want to write something like what Faber &
>> Richardson wrote about in 'The Ivy Portfolio' where the whole
>> portfolio is rebalanced on a given date, like end-of-month,
>> independent of whether I'm using the 10 month SMA or not. For that
>> reason I figured I might need a way to match indexes to dates going
>> though time.
>
>
> see the faber_rebal demo.
>
> The rebalance_on argument will call the rebalancing rule(s) on whatever
> periodicity you tell it to, you'll have to have something for them to do.
>
> In the demo, I just changed max order size, but there's no reason you
> couldn't write a (strategy specific) rebalancing rule that wouldn't read all
> the positions, and do transactions on the rebalance date.
>
>
> Regards,
>
> Brian

Brian,
   Yes, that's what I'm thinking I'll need to do. Josh's suggestion
about using sigTimestamp looks like it could also be part of that.

   The code below (for casual readers or people coming later) is based
on the faber_rebal demo and generates generates faberTxns which shows
all the stocks trades together in one place. They are being rebalanced
but the trades occur at different times which is what I want to play
with. Also, this code includes the index as a testable column (not
used but generated as a test) and I moved the start date on the SPY,
for comparison purposes, to be the first entry date of whatever stock
executes first.

Thanks,
Mark


#This code is based on the faber_rebal demo file
#Thanks to those who wrote and debugged it
require(quantstrat)

Sys.setenv(TZ="UTC")

portfolio.st = "faber"
account.st   = "faber"
strategy.st  = "faber"

# Try to clean up in case the demo was run previously
suppressWarnings(rm("account.faber","portfolio.faber",pos=.blotter))
suppressWarnings(rm("ltaccount", "ltportfolio", "ClosePrice",
"CurrentDate", "equity",
                    "GSPC", "stratFaber", "initDate", "initEq",
"Posn", "UnitSize", "verbose"))
suppressWarnings(rm("order_book.faber",pos=.strategy))

initDate='1997-12-31'
initEq=100000
currency("USD")
symbols = c("XLF", "XLP", "XLE", "XLY", "XLV", "XLI", "XLB", "XLK", "XLU")

xtsIndex = function(data){
  xtsIndex = reclass(index(data), match.to=data)
  colnames(xtsIndex)="xtsIndex"
  return(xtsIndex)
}

for(symbol in symbols){
  stock(symbol, currency="USD",multiplier=1)
}

getSymbols(symbols, src='yahoo', index.class=c("POSIXt","POSIXct"),
from='1999-01-01')
for(symbol in symbols) {
  if (symbol == symbols[1]){
    tmpData = Cl(get(symbol))
  }else{
    tmpData = cbind(tmpData, Cl(get(symbol)))
  }
}
#Find first common data date
tmpData = tmpData[complete.cases(tmpData)]
startDate = first(index(tmpData))
print(startDate)
#rm(tmpData)

for(symbol in symbols) {
  x<-get(symbol)
  x<-to.monthly(x,indexAt='lastof',drop.time=TRUE)
  indexFormat(x)<-'%Y-%m-%d'
  colnames(x)<-gsub("x",symbol,colnames(x))
#  x = x[paste0(startDate,"/")]
  assign(symbol,x)
}


initPortf(portfolio.st, symbols=symbols, initDate=initDate)
initAcct(account.st, portfolios=portfolio.st, initDate=initDate, initEq=100000)
initOrders(portfolio=portfolio.st, initDate=initDate)

# set intial position limits
posval<-initEq/length(symbols)
for(symbol in symbols){
  pos<-round((posval/first(getPrice(get(symbol)))[,1]),-2)
  addPosLimit(portfolio.st,symbol,initDate, maxpos=pos,minpos=-pos)
}
print("setup completed")

# Initialize a strategy object
strategy(strategy.st, store=TRUE)


add.indicator(strategy.st, name = "SMA", arguments = list(x =
quote(Cl(mktdata)), n=10), label="SMA10")
add.indicator(strategy.st, name = "xtsIndex", arguments = list(data =
quote(mktdata)), label="Index")

add.signal(strategy.st,name="sigCrossover",arguments =
list(columns=c("Close","SMA10"),relationship="gte"),label="Cl.gt.SMA")
add.signal(strategy.st,name="sigCrossover",arguments =
list(columns=c("Close","SMA10"),relationship="lt"),label="Cl.lt.SMA")

add.rule(strategy.st, name='ruleSignal', arguments =
list(sigcol="Cl.gt.SMA", sigval=TRUE, orderqty=100000,
osFUN='osMaxPos', ordertype='market', orderside='long',
pricemethod='market',TxnFees=-5), type='enter', path.dep=TRUE)
#add.rule(strategy.st, name='ruleSignal', arguments =
list(sigcol="Cl.lt.SMA", sigval=TRUE, orderqty='all',
ordertype='market', orderside='long',
pricemethod='market',TxnFees=-5), type='exit', path.dep=TRUE)

# # add rebalancing rule
add.rule(strategy.st, 'rulePctEquity',
         arguments=list(rebalance_on='quarters',
                        trade.percent=1/length(symbols),

refprice=quote(last(getPrice(mktdata)[paste('::',as.character(curIndex),sep='')][,1])),
                        digits=0
         ),
         type='rebalance',
         label='rebalance'
)

# Process the strategy and generate trades
start_t<-Sys.time()
out<-applyStrategy.rebalancing(strategy=strategy.st , portfolios=portfolio.st)
#out<-applyStrategy(strategy=strategy.st , portfolios=portfolio.st)
end_t<-Sys.time()
print("Strategy Loop:")
print(end_t-start_t)


start_t<-Sys.time()
updatePortf(Portfolio=portfolio.st,Dates=paste('::',as.Date(Sys.time()),sep=''))
updateAcct(account.st)
end_t<-Sys.time()
print("trade blotter portfolio update:")
print(end_t-start_t)

# hack for new quantmod graphics, remove later
themelist<-chart_theme()
themelist$col$up.col<-'lightgreen'
themelist$col$dn.col<-'pink'

#dev.new() #Removed for RStudio
layout(mat=matrix(1:(length(symbols)+1),ncol=2))
for(symbol in symbols){
  chart.Posn(Portfolio=portfolio.st,Symbol=symbol,theme=themelist,TA="add_SMA(n=10,col='darkgreen')")
}

ret1 <- PortfReturns(portfolio.st)
ret1$total <- rowSums(ret1)

faber.stats<-tradeStats(portfolio.st)[,c('Net.Trading.PL','Max.Drawdown','Num.Trades','Profit.Factor','Std.Dev.Trade.PL','Largest.Winner','Largest.Loser','Max.Equity','Min.Equity')]
faber.stats = t(round(faber.stats,2))
View(faber.stats)

#Plot all the individual equities
par(mfrow=c(1,1))
plot.zoo(cumprod(1+ret1[,1:(ncol(ret1)-1)]), screens=1,
col=rainbow(n=ncol(ret1)-1))

#Get # of shares and txn prices

for (i in 1:length(symbols)){
  tmp1 = getTxns(portfolio.st,symbols[i])[,1:2]
  colnames(tmp1) = c(paste0(symbols[i],".sh"), paste0(symbols[i],".pr"))
#  print(tmp1)
  if (i == 1){
    faberTxns = tmp1
  }else{
    faberTxns = cbind(faberTxns, tmp1)
  }
}

View(faberTxns)

ComparisonDate = index(faberTxns)[2]

if("package:PerformanceAnalytics" %in% search() ||
require("PerformanceAnalytics",quietly=TRUE)){
  getSymbols("SPY", src='yahoo', index.class=c("POSIXt","POSIXct"),
from=ComparisonDate)
  SPY<-to.monthly(SPY, indexAt='lastof')
  SPY.ret <- Return.calculate(SPY$SPY.Close)
  #  dev.new() #Removed for RStudio
  charts.PerformanceSummary(cbind(ret1$total,SPY.ret),
geometric=FALSE, wealth.index=TRUE)
}


From thomas.fuller at coherentlogic.com  Fri Oct 10 15:42:15 2014
From: thomas.fuller at coherentlogic.com (Thomas Fuller)
Date: Fri, 10 Oct 2014 09:42:15 -0400
Subject: [R-SIG-Finance] R Open Secrets API 1.0.0 Released
Message-ID: <CAM0JZ3=t4THbyKNo2KpjingU9sD8b-xwwnD37QMmRChUrCnr6g@mail.gmail.com>

Hi Folks,

I'd like to draw your attention to the R Open Secrets API version 1.0.0
which has been released recently.

*From https://www.opensecrets.org/about/
<https://www.opensecrets.org/about/>*

"

*Our Mission: Inform, Empower & AdvocateThe Center for Responsive Politics
is the nation's premier research group tracking money in U.S. politics and
its effect on elections and public policy. Nonpartisan, independent and
nonprofit, the organization aims to create a more educated voter, an
involved citizenry and a more transparent and responsive government.*"

Here's the link to the package page, if you're interested:

*http://cran.r-project.org/web/packages/ropensecretsapi/
<http://cran.r-project.org/web/packages/ropensecretsapi/>*

and please find an example script that will allow you to work with some of
the data here:

*http://coherentlogic.com/middleware-development/r-package-for-the-opensecrets-org-api/
<http://coherentlogic.com/middleware-development/r-package-for-the-opensecrets-org-api/>*

Feedback and questions are welcomed,

Tom

	[[alternative HTML version deleted]]


From kunalshah305 at gmail.com  Sat Oct 11 17:13:17 2014
From: kunalshah305 at gmail.com (Kunal Shah)
Date: Sat, 11 Oct 2014 20:43:17 +0530
Subject: [R-SIG-Finance] Talking to C# API (Any reference to learn the same)
Message-ID: <CAOPdpkY-t6ETZD2JeHzhA50P-J0W4_g0naUhSyuMNYvd+1i08A@mail.gmail.com>

Hello,

I have 250 R scripts.

*Input*
Each of them needs a real time data feed from a C# interface. The real time
datafeed updates at a speed of approx 3 times a second. Also the data array
size is increasing every minute. (1 minute time frame)

*Output*
I want to output say 4 variables from each of the R codes back to C#
execution engine

I wish to know the complete process. Can I get some references for the same?

Since R cannot be multi threaded, can this be done easily? What is the best
possible way?


Regards

	[[alternative HTML version deleted]]


From markknecht at gmail.com  Sat Oct 11 19:04:42 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Sat, 11 Oct 2014 10:04:42 -0700
Subject: [R-SIG-Finance] Talking to C# API (Any reference to learn the
	same)
In-Reply-To: <CAOPdpkY-t6ETZD2JeHzhA50P-J0W4_g0naUhSyuMNYvd+1i08A@mail.gmail.com>
References: <CAOPdpkY-t6ETZD2JeHzhA50P-J0W4_g0naUhSyuMNYvd+1i08A@mail.gmail.com>
Message-ID: <CAK2H+ecUGLRESTiKXB48RFUeo3DWPiDDax5bDB4qcCsnV0dxtQ@mail.gmail.com>

On Sat, Oct 11, 2014 at 8:13 AM, Kunal Shah <kunalshah305 at gmail.com> wrote:
> Hello,
>
> I have 250 R scripts.
>
> *Input*
> Each of them needs a real time data feed from a C# interface. The real time
> datafeed updates at a speed of approx 3 times a second. Also the data array
> size is increasing every minute. (1 minute time frame)
>
> *Output*
> I want to output say 4 variables from each of the R codes back to C#
> execution engine
>
> I wish to know the complete process. Can I get some references for the same?
>
> Since R cannot be multi threaded, can this be done easily? What is the best
> possible way?
>

I think you want to look at the Rcpp package. I've not used it myself
but it seems to address your interface issue.

As for 'multi-threading' I think in a very specific way you might look
at the foreach package and then the multi-processing packages like
doMC and doParallel. I'm using doMC & doParallel on Linux and have as
many as 12 identical processes (parameter exploration ala the
quantstratIII demo) running at the same time. If you need more than
the number of cores on your machine then I think you want ReDis but
I've never used it. There's web pages out there talking about it
though.

HTH,
Mark


From josh.m.ulrich at gmail.com  Sat Oct 11 19:12:21 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 11 Oct 2014 12:12:21 -0500
Subject: [R-SIG-Finance] Talking to C# API (Any reference to learn the
	same)
In-Reply-To: <CAK2H+ecUGLRESTiKXB48RFUeo3DWPiDDax5bDB4qcCsnV0dxtQ@mail.gmail.com>
References: <CAOPdpkY-t6ETZD2JeHzhA50P-J0W4_g0naUhSyuMNYvd+1i08A@mail.gmail.com>
	<CAK2H+ecUGLRESTiKXB48RFUeo3DWPiDDax5bDB4qcCsnV0dxtQ@mail.gmail.com>
Message-ID: <CAPPM_gQ6Xc4=OC5UrEaKt+QsPDuOpnP6OjBNoq2Wq3jhAE78yA@mail.gmail.com>

On Sat, Oct 11, 2014 at 12:04 PM, Mark Knecht <markknecht at gmail.com> wrote:
> On Sat, Oct 11, 2014 at 8:13 AM, Kunal Shah <kunalshah305 at gmail.com> wrote:
>> Hello,
>>
>> I have 250 R scripts.
>>
>> *Input*
>> Each of them needs a real time data feed from a C# interface. The real time
>> datafeed updates at a speed of approx 3 times a second. Also the data array
>> size is increasing every minute. (1 minute time frame)
>>
>> *Output*
>> I want to output say 4 variables from each of the R codes back to C#
>> execution engine
>>
>> I wish to know the complete process. Can I get some references for the same?
>>
>> Since R cannot be multi threaded, can this be done easily? What is the best
>> possible way?
>>
While you may be working on a financial application, your question has
nothing to do with finance, and is therefore off-topic for this list.

>
> I think you want to look at the Rcpp package. I've not used it myself
> but it seems to address your interface issue.
>
No, it doesn't.  C++ != C# (they're not even close; C# is closer to Java).

> As for 'multi-threading' I think in a very specific way you might look
> at the foreach package and then the multi-processing packages like
> doMC and doParallel. I'm using doMC & doParallel on Linux and have as
> many as 12 identical processes (parameter exploration ala the
> quantstratIII demo) running at the same time. If you need more than
> the number of cores on your machine then I think you want ReDis but
> I've never used it. There's web pages out there talking about it
> though.
>
> HTH,
> Mark
>

--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From markknecht at gmail.com  Sat Oct 11 19:24:47 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Sat, 11 Oct 2014 10:24:47 -0700
Subject: [R-SIG-Finance] Talking to C# API (Any reference to learn the
	same)
In-Reply-To: <CAPPM_gQ6Xc4=OC5UrEaKt+QsPDuOpnP6OjBNoq2Wq3jhAE78yA@mail.gmail.com>
References: <CAOPdpkY-t6ETZD2JeHzhA50P-J0W4_g0naUhSyuMNYvd+1i08A@mail.gmail.com>
	<CAK2H+ecUGLRESTiKXB48RFUeo3DWPiDDax5bDB4qcCsnV0dxtQ@mail.gmail.com>
	<CAPPM_gQ6Xc4=OC5UrEaKt+QsPDuOpnP6OjBNoq2Wq3jhAE78yA@mail.gmail.com>
Message-ID: <CAK2H+efBN4v2D4ezhjki8cufw3U_8VL4c24v9fmz7V9MFzXOHg@mail.gmail.com>

<SNIP>
>>> I want to output say 4 variables from each of the R codes back to C#
>>> execution engine
<SNIP>
>> I think you want to look at the Rcpp package. I've not used it myself
>> but it seems to address your interface issue.
>>
> No, it doesn't.  C++ != C# (they're not even close; C# is closer to Java).


How right you are! That's what I get for trying to help in an area I
know less than zero about.

Sorry.

- Mark


From sureshnageswaran at yahoo.com  Sun Oct 12 23:07:40 2014
From: sureshnageswaran at yahoo.com (Suresh Nageswaran)
Date: Sun, 12 Oct 2014 14:07:40 -0700
Subject: [R-SIG-Finance] Talking to C# API (Any reference to learn the
	same)
In-Reply-To: <CAOPdpkY-t6ETZD2JeHzhA50P-J0W4_g0naUhSyuMNYvd+1i08A@mail.gmail.com>
References: <CAOPdpkY-t6ETZD2JeHzhA50P-J0W4_g0naUhSyuMNYvd+1i08A@mail.gmail.com>
Message-ID: <1413148060.19767.YahooMailNeo@web122301.mail.ne1.yahoo.com>

Kunal -

Your basic problem is around options for high performance inter-process communications. Since you mention C#, I'm going to assume your target applications are all running on Windows.

So you have several options under Windows including shared memory, pipes, queues, DMA etc.

>From what I've seen, named pipes are the fastest way to do any kind of IPC on Windows. On a single core, individual pipe data xfer can take less than 4 ms. On multiple cores, this can degrade to 25ms, but still  far faster than your 333 ms (1000 ms / 3) requirement.

Start with figuring out how to make DLL calls within R. Then configure your R programs as Named Pipe clients i.e. get them to make those calls. 


Named Pipes (Windows)

  
          
Named Pipes (Windows)
A named pipe is a named, one-way or duplex pipe for communication between the pipe server and one or more pipe clients.   
View on msdn.microsoft.com Preview by Yahoo  
  
 
Hope this helps.

Cheers
Suresh


>________________________________
> From: Kunal Shah <kunalshah305 at gmail.com>
>To: r-sig-finance at r-project.org 
>Sent: Saturday, October 11, 2014 11:13 AM
>Subject: [R-SIG-Finance] Talking to C# API (Any reference to learn the same)
> 
>
>Hello,
>
>I have 250 R scripts.
>
>*Input*
>Each of them needs a real time data feed from a C# interface. The real time
>datafeed updates at a speed of approx 3 times a second. Also the data array
>size is increasing every minute. (1 minute time frame)
>
>*Output*
>I want to output say 4 variables from each of the R codes back to C#
>execution engine
>
>I wish to know the complete process. Can I get some references for the same?
>
>Since R cannot be multi threaded, can this be done easily? What is the best
>possible way?
>
>
>Regards
>
>    [[alternative HTML version deleted]]
>
>_______________________________________________
>R-SIG-Finance at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>-- Subscriber-posting only. If you want to post, subscribe first.
>-- Also note that this is not the r-help list where general R questions should go.
>
>
>
	[[alternative HTML version deleted]]


From zadig_1 at excite.com  Sun Oct 12 23:35:29 2014
From: zadig_1 at excite.com (ce)
Date: Sun, 12 Oct 2014 17:35:29 -0400
Subject: [R-SIG-Finance] Blotter package would it work for cross currencies
Message-ID: <20141012173529.30615@web006.roc2.bluetie.com>


I would like to know it blotter package can be used to calculate performance/returns  of cross currencies like GBP.EUR ?
I can create a stock


From zadig_1 at excite.com  Sun Oct 12 23:39:29 2014
From: zadig_1 at excite.com (ce)
Date: Sun, 12 Oct 2014 17:39:29 -0400
Subject: [R-SIG-Finance] Blotter package would it work for cross currencies
Message-ID: <20141012173929.5672@web006.roc2.bluetie.com>


Sorry for the double post. 

I would like to know it blotter package can be used to calculate performance/returns  of a portfolio mixed with cross currencies like GBP.EUR , CAD.CHF ?
I can create a stock with

stock("GBP",currency="EUR",multiplier=1)


but functions like PortfReturns , getEndEq don't seem to care about currency ?


From brian at braverock.com  Sun Oct 12 23:50:34 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 12 Oct 2014 16:50:34 -0500
Subject: [R-SIG-Finance] Blotter package would it work for cross
	currencies
In-Reply-To: <20141012173929.5672@web006.roc2.bluetie.com>
References: <20141012173929.5672@web006.roc2.bluetie.com>
Message-ID: <543AF7AA.7060801@braverock.com>

Yes, it can, with a few minor difficulties.

To start with, you need to choose the currency of your Portfolios and 
Account.  Other wise it will default to USD.

also, you will want to specify your instruments correctly.  they are
of type exchange_rate.  See documentation and examples in the 
FinancialInstrument package.

Brian

On 10/12/2014 04:39 PM, ce wrote:
>
> Sorry for the double post.
>
> I would like to know it blotter package can be used to calculate performance/returns  of a portfolio mixed with cross currencies like GBP.EUR , CAD.CHF ?
> I can create a stock with
>
> stock("GBP",currency="EUR",multiplier=1)
>
>
> but functions like PortfReturns , getEndEq don't seem to care about currency ?


From 1111938 at qq.com  Mon Oct 13 10:44:34 2014
From: 1111938 at qq.com (domodo)
Date: Mon, 13 Oct 2014 01:44:34 -0700 (PDT)
Subject: [R-SIG-Finance] hans123 for intraday-data in R ?
Message-ID: <1413189874772-4698258.post@n4.nabble.com>

hi,guys,it spent me several days to consider how to code strategy 'hans123'
in R and quantstrat pakage.

the trouble is,it's hard to judge when to get  specific price ( for example,
get the highest high between 13:00 to 17:00 as the up band price ), any help
would be apprciated.

regards.



--
View this message in context: http://r.789695.n4.nabble.com/hans123-for-intraday-data-in-R-tp4698258.html
Sent from the Rmetrics mailing list archive at Nabble.com.


From josh.m.ulrich at gmail.com  Mon Oct 13 16:00:46 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 13 Oct 2014 09:00:46 -0500
Subject: [R-SIG-Finance] hans123 for intraday-data in R ?
In-Reply-To: <1413189874772-4698258.post@n4.nabble.com>
References: <1413189874772-4698258.post@n4.nabble.com>
Message-ID: <CAPPM_gTj7+Hugc8R6Qq8k3DwWd=DeqfSoKCEj1fTL+40y4X_oA@mail.gmail.com>

On Mon, Oct 13, 2014 at 3:44 AM, domodo <1111938 at qq.com> wrote:
> hi,guys,it spent me several days to consider how to code strategy 'hans123'
> in R and quantstrat pakage.
>
> the trouble is,it's hard to judge when to get  specific price ( for example,
> get the highest high between 13:00 to 17:00 as the up band price ), any help
> would be apprciated.
>
It's hard to judge what you're referring to when you only provide a
vague description.  If you want to increase the probability that
someone helps you, please provide a minimal, reproducible example.

> regards.
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/hans123-for-intraday-data-in-R-tp4698258.html
> Sent from the Rmetrics mailing list archive at Nabble.com.
>

--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From markknecht at gmail.com  Mon Oct 13 16:29:02 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Mon, 13 Oct 2014 07:29:02 -0700
Subject: [R-SIG-Finance] quantstrat - trailingStop offsets?
Message-ID: <CAK2H+edYASn0bbvWytohDmB8BJtd8zDMYFNmCW+2-K7knAVpvw@mail.gmail.com>

Good morning,
   Base question: Are there any quantstrat examples showing how to set
a minimum profit target before a trailing stop kicks in?

   For example, for a risk stop of 5% and a trailing stop of 3%, I
don't want to the trailing stop to be executed until I have met a
minimum profit of at least 2% resulting in a maximum approximate loss
of 1% if the trailing stop executes.

   I don't see anything in addOrder to do that but I suspect there's
someway to handle it.

Thanks,
Mark


From markknecht at gmail.com  Mon Oct 13 16:44:07 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Mon, 13 Oct 2014 07:44:07 -0700
Subject: [R-SIG-Finance] quantstrat - trailingStop offsets?
In-Reply-To: <CAK2H+edYASn0bbvWytohDmB8BJtd8zDMYFNmCW+2-K7knAVpvw@mail.gmail.com>
References: <CAK2H+edYASn0bbvWytohDmB8BJtd8zDMYFNmCW+2-K7knAVpvw@mail.gmail.com>
Message-ID: <CAK2H+ecvyUensjCORx=1GF=SsA=A_REjpxo+57ebtecsbQC51A@mail.gmail.com>

On Mon, Oct 13, 2014 at 7:29 AM, Mark Knecht <markknecht at gmail.com> wrote:
> Good morning,
>    Base question: Are there any quantstrat examples showing how to set
> a minimum profit target before a trailing stop kicks in?
>
>    For example, for a risk stop of 5% and a trailing stop of 3%, I
> don't want to the trailing stop to be executed until I have met a
> minimum profit of at least 2% resulting in a maximum approximate loss
> of 1% if the trailing stop executes.
>
>    I don't see anything in addOrder to do that but I suspect there's
> someway to handle it.
>
> Thanks,
> Mark

I think this is possibly intended to be done in the order sizing
function by setting the size to zero until the minimum gain is met.

<SNIP>
      orderqty <- osFUN(strategy = strategy, data = mktdata,
                        timestamp = timestamp, orderqty = orderqty,
ordertype = ordertype,
                        orderside = orderside, portfolio = portfolio,
                        symbol = symbol, ... = ..., ruletype = ruletype,
                        orderprice = as.numeric(orderprice))
    }
    if (!is.null(orderqty) && orderqty != 0 && length(orderprice)) {
      addOrder(portfolio = portfolio, symbol = symbol,
               timestamp = timestamp, qty = orderqty, price =
as.numeric(orderprice),
               ordertype = ordertype, side = orderside, orderset = orderset,
               threshold = threshold, status = "open", replace = replace,
               delay = delay, tmult = tmult, ... = ..., prefer = prefer,
               TxnFees = TxnFees, label = label, time.in.force = time.in.force)
    }
<SNIP>

If there's a more canned way to do it I'd appreciate understanding it
but for now I'll proceed in that direction.

Sorry for the noise,
Mark


From brian at braverock.com  Mon Oct 13 16:52:05 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 13 Oct 2014 09:52:05 -0500
Subject: [R-SIG-Finance] quantstrat - trailingStop offsets?
In-Reply-To: <CAK2H+edYASn0bbvWytohDmB8BJtd8zDMYFNmCW+2-K7knAVpvw@mail.gmail.com>
References: <CAK2H+edYASn0bbvWytohDmB8BJtd8zDMYFNmCW+2-K7knAVpvw@mail.gmail.com>
Message-ID: <543BE715.8000909@braverock.com>

On 10/13/2014 09:29 AM, Mark Knecht wrote:
> Good morning,
>     Base question: Are there any quantstrat examples showing how to set
> a minimum profit target before a trailing stop kicks in?
>
>     For example, for a risk stop of 5% and a trailing stop of 3%, I
> don't want to the trailing stop to be executed until I have met a
> minimum profit of at least 2% resulting in a maximum approximate loss
> of 1% if the trailing stop executes.

If your risk stop is 5% and your trailing stop is 3%, there's no reason 
not to just enter the trailing stop at 3%, thus limiting your loss to 3% 
or less.  The risk stop would never be triggered.

Or am I missing what you're asking to do?

There are a number of ways to trigger orders in quantstrat.

Simple signals trigger a rule.  This is how your entry most likely works.

'chain' rule orders are triggered by a fill.  for example, your entry 
order is filled, and the chain rule for that entry will trigger. You can 
see examples of this in the luxor scripts where stop loss and take 
profit orders are entered after a position is initiated.

order sets create an OCO relationship between related orders.  in the 
example above, your stop and profit taking order would be an orderset. 
if one is filled, the other is canceled.

in the case of 'I only want to enter an order if my existing position 
has moved x% in my favor', I guess I'd ask 'why?' and 'how do you plan 
to do this in production?'.  I see very little difference in your 
example between 'enter my trailing stop at -3% after I've gone up 2%, 
but until then, use a 5% stop' and the much simpler 'enter a trailing 
stop at 3% when I get my entry fill'.

All that said, you could do what I think you say you want by triggering 
a signal for 2% above your entry signal.  The rule for that signal would 
cancel the 5% risk stop and add the 3% trailing stop.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From markknecht at gmail.com  Mon Oct 13 17:32:38 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Mon, 13 Oct 2014 08:32:38 -0700
Subject: [R-SIG-Finance] quantstrat - trailingStop offsets?
In-Reply-To: <543BE715.8000909@braverock.com>
References: <CAK2H+edYASn0bbvWytohDmB8BJtd8zDMYFNmCW+2-K7knAVpvw@mail.gmail.com>
	<543BE715.8000909@braverock.com>
Message-ID: <CAK2H+eehpJNCSmbEf2DJGoePKK-AUC=-LQENdK3_Lpf0zsM79Q@mail.gmail.com>

On Mon, Oct 13, 2014 at 7:52 AM, Brian G. Peterson <brian at braverock.com> wrote:
> On 10/13/2014 09:29 AM, Mark Knecht wrote:
>>
>> Good morning,
>>     Base question: Are there any quantstrat examples showing how to set
>> a minimum profit target before a trailing stop kicks in?
>>
>>     For example, for a risk stop of 5% and a trailing stop of 3%, I
>> don't want to the trailing stop to be executed until I have met a
>> minimum profit of at least 2% resulting in a maximum approximate loss
>> of 1% if the trailing stop executes.
>
>
> If your risk stop is 5% and your trailing stop is 3%, there's no reason not
> to just enter the trailing stop at 3%, thus limiting your loss to 3% or
> less.  The risk stop would never be triggered.
>

If the entry is 'efficient' to the extent that the entry price within
3% of the low
before the market starts moving in my direction then, yes, you are right. There
wouldn't be any advantage.

On the other hand, if the entry is not efficient and I'm in too early
then I want
to give it more breathing room (5%) before it starts moving. In this example
I define 'moving' as 2% in my favor.

Granted, position size for a fixed dollar risk is smaller.


> Or am I missing what you're asking to do?
>

No, I think you do understand based on the last idea at the end.

> There are a number of ways to trigger orders in quantstrat.
>
> Simple signals trigger a rule.  This is how your entry most likely works.
>
> 'chain' rule orders are triggered by a fill.  for example, your entry order
> is filled, and the chain rule for that entry will trigger. You can see
> examples of this in the luxor scripts where stop loss and take profit orders
> are entered after a position is initiated.
>
> order sets create an OCO relationship between related orders.  in the
> example above, your stop and profit taking order would be an orderset. if
> one is filled, the other is canceled.
>

OK, Joshua pointed me at order sets in luxor.5.strategy.ordersets.R so
I'm looking there.

> in the case of 'I only want to enter an order if my existing position has
> moved x% in my favor', I guess I'd ask 'why?' and 'how do you plan to do
> this in production?'.  I see very little difference in your example between
> 'enter my trailing stop at -3% after I've gone up 2%, but until then, use a
> 5% stop' and the much simpler 'enter a trailing stop at 3% when I get my
> entry fill'.
>

Maybe I'm driven too much by TradeStation history but many traders
there look for some sort of a 'break even' exit if the trade doesn't meet
a profit target. I.e - I'm targeting a 5% win. I'l accept a 5% loss until I get
to a 3% profit at which time I will expect to break even worst case.

(That's different than what I proposed at the outset where I would accept a
1% loss if I make it to 2% gain max before it falls back, but I am pretty sure
you see the idea.)

> All that said, you could do what I think you say you want by triggering a
> signal for 2% above your entry signal.  The rule for that signal would
> cancel the 5% risk stop and add the 3% trailing stop.
>

So I'll need to figure out what you mean by 'cancel' but the wording
seems like what I'm looking for.

General code idea?

If (MaxGain < 2%){
   enable.rule('luxor','chain','StopLoss',enabled=TRUE)
   enable.rule('luxor','chain','StopTrailing',enabled=FALSE)
}else{
  enable.rule('luxor','chain','StopLoss',enabled=FALSE)
   enable.rule('luxor','chain','StopTrailing',enabled=TRUE)
}

Does quantstrat allow the state of a rule be dynamic like that?

> Regards,
>
> Brian
>

Much thanks!

Cheers,
Mark


From ilya.kipnis at gmail.com  Tue Oct 14 02:58:19 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 13 Oct 2014 20:58:19 -0400
Subject: [R-SIG-Finance] Possible graphical bug in PerfA
Message-ID: <CA+oJuEEKWFNiobTy=f7VOQXmw3e4q3dU_=4LR7XF3jMYw39+ug@mail.gmail.com>

minimum reproducible example:

data(edhec)
riskRet <- t(rbind(Return.annualized(edhec), maxDrawdown(edhec)))
riskRet <- riskRet[1:4,]
chart.RiskReturnScatter(riskRet, method="nocalc", colorset=c("red",
"black", "blue", "green"))

Output: two dots in red, two dots in black
Expected: one in red, black, blue, green.

sessionInfo:

R version 3.1.1 (2014-07-10)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C         LC_TIME=C
 [4] LC_COLLATE=C         LC_MONETARY=C        LC_MESSAGES=C
 [7] LC_PAPER=C           LC_NAME=C            LC_ADDRESS=C
[10] LC_TELEPHONE=C       LC_MEASUREMENT=C     LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
 [1] downloader_0.3                Quandl_2.3.2
 [3] IKTrading_1.0                 quantstrat_0.8.2
 [5] foreach_1.4.1                 blotter_0.8.19
 [7] PerformanceAnalytics_1.4.3541 FinancialInstrument_1.1.9
 [9] quantmod_0.4-1                Defaults_1.1-1
[11] TTR_0.22-0.1                  Rcpp_0.11.2
[13] xts_0.9-7                     zoo_1.7-11
[15] devtools_1.3

loaded via a namespace (and not attached):
 [1] RCurl_1.95-4.1  RJSONIO_1.3-0   codetools_0.2-8 digest_0.6.3
 [5] evaluate_0.5.5  grid_3.1.1      httr_0.2        iterators_1.0.6
 [9] lattice_0.20-29 memoise_0.1     parallel_3.1.1  stringr_0.6.2
[13] tools_3.1.1     whisker_0.3-2

	[[alternative HTML version deleted]]


From aschmid1 at stevens.edu  Tue Oct 14 03:35:28 2014
From: aschmid1 at stevens.edu (aschmid1)
Date: Mon, 13 Oct 2014 21:35:28 -0400
Subject: [R-SIG-Finance] a problem with stockPortfolio without short selling
Message-ID: <255317988df5fc0d72ea49dc735f6d2d@stevens.edu>

Hi,
Here is my script:

> library(stockPortfolio)
> ticker<-c("SPY", "XLK", "XLE", "XLY", "XLU")
> stockData <- getReturns(ticker, freq="day", get="overlapOnly", 
> start='2010-01-02', end='2012-12-31')
> modelS<-stockModel(stockData, model='SIM', index=1)
> opS<-optimalPort(modelS)

So far, so good... Then I do the same without short selling:


> modelL<-stockModel(stockData, model='SIM', index=1, shortSelling="n")
> opL<-optimalPort(modelL)

... and get an error message: "Error in model$COV[these, these] : 
incorrect number of dimensions"

Note that covariances of modelS and modelL are equal:

> modelS$COV==modelL$COV
      [,1] [,2] [,3] [,4]
[1,] TRUE TRUE TRUE TRUE
[2,] TRUE TRUE TRUE TRUE
[3,] TRUE TRUE TRUE TRUE
[4,] TRUE TRUE TRUE TRUE


Thanks! Alec


From cduranceau at nial.ky  Tue Oct 14 23:09:34 2014
From: cduranceau at nial.ky (Charles Duranceau)
Date: Tue, 14 Oct 2014 21:09:34 +0000
Subject: [R-SIG-Finance] Return.rebalancing contemporaneous calculation
In-Reply-To: <54359F98.1080308@braverock.com>
References: <253B4FA1ECEEB54DB661809CB67734552A09A2F6@NOR-EXC01.northview.local>
	<54359F98.1080308@braverock.com>
Message-ID: <253B4FA1ECEEB54DB661809CB67734552A09AA85@NOR-EXC01.northview.local>

Hello Brian, 
Thank you for your feedback. 

Version Info: 
platform       x86_64-w64-mingw32          
arch           x86_64                      
os             mingw32                     
system         x86_64, mingw32             
status                                     
major          3                           
minor          1.0                         
year           2014                        
month          04                          
day            10                          
svn rev        65387                       
language       R                           
version.string R version 3.1.0 (2014-04-10)
nickname       Spring Dance               

Package: 
 "PerformanceAnalytics" VERSION 1.4.3541 from CRAN   ---- project.org/bin/windows/contrib/3.1/PerformanceAnalytics_1.4.3541.zip

Here's a detailed example:

# Define Returns
mret=data.frame(ra=c(0.1,0.11,0.09),rb=c(0.25,0.2,-0.4),rc=c(0.15,0.12,0.02))
time_index<-seq(as.Date("2003/05/01"), by = "month", length.out = 3)-1             # last day of the month
mret<-as.xts(mret,time_index)
weight_constant<-c(0.5,0.2,0.3)
ret_pfolio<-Return.portfolio(mret,weight_constant,geometric = FALSE)


weight_reb<-t(matrix(weight_constant,3,3))
weight_reb<-as.xts(weight_reb,time_index)                                                                  # fixed for the analysis
ret_rebal<-Return.rebalancing(mret,weight_reb,geometric = FALSE)

cbind(ret_pfolio,ret_rebal)



Thank you
Best Regards

-----Original Message-----
From: r-sig-finance-bounces at r-project.org [mailto:r-sig-finance-bounces at r-project.org] On Behalf Of Brian G. Peterson
Sent: Wednesday, October 08, 2014 3:33 PM
To: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Return.rebalancing contemporaneous calculation

On 10/08/2014 03:24 PM, Charles Duranceau wrote:
> Hi,
> I'm working with "PerformanceAnalytics" for calculating portfolio returns using the function Return.rebalancing. I don't understand why the results - portfolio returns - are lagged by 1 period when compared to Return.portfolio (assuming weight are time invariant).
>
> I read the definition that explain the rebalancing is taken place in the next period but since the input are returns (like in  Return.portfolio) they should be consolidated on same period.
> Is there a way not losing the first input?
>
> Here few lines to illustrate my question
>
> pfmf2003<-Return.rebalancing(mfr2003,wghts1)
> pfstat<-Return.portfolio(mfr2003,c(1,0))
> ** wghts1 = 1 for the period
>
> Results
>                          portfolio.Rebal       portfolio.returns.
> 2003-05-31      0.0087336245         0.203679369
> 2003-06-30      0.1093073593         0.008733624
> 2003-07-31     -0.0351219512         0.109307359
> 2003-08-31     -0.0404448938        -0.035121951
> 2003-09-30     -0.0063224447        -0.040444894

Return.portfolio and Return.rebalancing are the same function in current CRAN version, and have been in the R-Forge version for quite a while.

Can you give us your sessionInfo, and a fully reproducible example?

Brian

--
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock

_______________________________________________
R-SIG-Finance at r-project.org mailing list https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From rossbennett34 at gmail.com  Wed Oct 15 03:09:20 2014
From: rossbennett34 at gmail.com (Ross Bennett)
Date: Tue, 14 Oct 2014 20:09:20 -0500
Subject: [R-SIG-Finance] Return.rebalancing contemporaneous calculation
In-Reply-To: <253B4FA1ECEEB54DB661809CB67734552A09AA85@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB67734552A09A2F6@NOR-EXC01.northview.local>
	<54359F98.1080308@braverock.com>
	<253B4FA1ECEEB54DB661809CB67734552A09AA85@NOR-EXC01.northview.local>
Message-ID: <CAEESW=Vd2=dfzG5X6rWp=NaPQ6W9U3+jyxMo5Up8oY6FVFtSew@mail.gmail.com>

Charles,

Thank you for the minimal reproducible example. It appears there is an
issue with the date indexing based on an assumption I made. I will fix and
push to R-Forge by the end of the week.

Regards,
Ross


On Tue, Oct 14, 2014 at 4:09 PM, Charles Duranceau <cduranceau at nial.ky>
wrote:

> Hello Brian,
> Thank you for your feedback.
>
> Version Info:
> platform       x86_64-w64-mingw32
> arch           x86_64
> os             mingw32
> system         x86_64, mingw32
> status
> major          3
> minor          1.0
> year           2014
> month          04
> day            10
> svn rev        65387
> language       R
> version.string R version 3.1.0 (2014-04-10)
> nickname       Spring Dance
>
> Package:
>  "PerformanceAnalytics" VERSION 1.4.3541 from CRAN   ----
> project.org/bin/windows/contrib/3.1/PerformanceAnalytics_1.4.3541.zip
>
> Here's a detailed example:
>
> # Define Returns
>
> mret=data.frame(ra=c(0.1,0.11,0.09),rb=c(0.25,0.2,-0.4),rc=c(0.15,0.12,0.02))
> time_index<-seq(as.Date("2003/05/01"), by = "month", length.out = 3)-1
>          # last day of the month
> mret<-as.xts(mret,time_index)
> weight_constant<-c(0.5,0.2,0.3)
> ret_pfolio<-Return.portfolio(mret,weight_constant,geometric = FALSE)
>
>
> weight_reb<-t(matrix(weight_constant,3,3))
> weight_reb<-as.xts(weight_reb,time_index)
>                                 # fixed for the analysis
> ret_rebal<-Return.rebalancing(mret,weight_reb,geometric = FALSE)
>
> cbind(ret_pfolio,ret_rebal)
>
>
>
> Thank you
> Best Regards
>
> -----Original Message-----
> From: r-sig-finance-bounces at r-project.org [mailto:
> r-sig-finance-bounces at r-project.org] On Behalf Of Brian G. Peterson
> Sent: Wednesday, October 08, 2014 3:33 PM
> To: r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] Return.rebalancing contemporaneous calculation
>
> On 10/08/2014 03:24 PM, Charles Duranceau wrote:
> > Hi,
> > I'm working with "PerformanceAnalytics" for calculating portfolio
> returns using the function Return.rebalancing. I don't understand why the
> results - portfolio returns - are lagged by 1 period when compared to
> Return.portfolio (assuming weight are time invariant).
> >
> > I read the definition that explain the rebalancing is taken place in the
> next period but since the input are returns (like in  Return.portfolio)
> they should be consolidated on same period.
> > Is there a way not losing the first input?
> >
> > Here few lines to illustrate my question
> >
> > pfmf2003<-Return.rebalancing(mfr2003,wghts1)
> > pfstat<-Return.portfolio(mfr2003,c(1,0))
> > ** wghts1 = 1 for the period
> >
> > Results
> >                          portfolio.Rebal       portfolio.returns.
> > 2003-05-31      0.0087336245         0.203679369
> > 2003-06-30      0.1093073593         0.008733624
> > 2003-07-31     -0.0351219512         0.109307359
> > 2003-08-31     -0.0404448938        -0.035121951
> > 2003-09-30     -0.0063224447        -0.040444894
>
> Return.portfolio and Return.rebalancing are the same function in current
> CRAN version, and have been in the R-Forge version for quite a while.
>
> Can you give us your sessionInfo, and a fully reproducible example?
>
> Brian
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From cduranceau at nial.ky  Wed Oct 15 23:28:03 2014
From: cduranceau at nial.ky (Charles Duranceau)
Date: Wed, 15 Oct 2014 21:28:03 +0000
Subject: [R-SIG-Finance] Performance Analytics: table.CAPM
Message-ID: <253B4FA1ECEEB54DB661809CB67734552A09AC2F@NOR-EXC01.northview.local>

Hi,
I noticed a problem with the function : table.CAPM when it return following error message: "Error in NextMethod(.Generic) : dims [product 4] do not match the length of object [0]"
I noticed in a previous post the solution is to transform series in xts, but in this case the series is already a xts object.
I don't understand as other similar functions works well as the following code shows

library("xts", lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
library("PerformanceAnalytics", lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
# Define Returns
pf1<-c(0.1,0.11,0.09,0.1)
bm<-c(0.25,0.2,-0.4,0.01)
time_index<-seq(as.Date("2003/05/01"), by = "month", length.out = 4)-1 # last day of the month
pf1x<-as.xts(pf1,time_index)
bmx<-as.xts(bm,time_index)


CAPM.alpha(pf1x, bmx, Rf = 0) # works [1] 0.09965609
table.CAPM(pf1x,bmx,Rf=0)    # error

Is there a way to solve the issue?
Thank you

Best Regards,


Version info

platform       x86_64-w64-mingw32
arch           x86_64
os             mingw32
system         x86_64, mingw32
status
major          3
minor          1.0
year           2014
month          04
day            10
svn rev        65387
language       R
version.string R version 3.1.0 (2014-04-10)
nickname       Spring Dance


package:

Package:

 "PerformanceAnalytics" VERSION 1.4.3541 from CRAN   ---- project.org/bin/windows/contrib/3.1/PerformanceAnalytics_1.4.3541.zip

Charles


**********************************************************************************************************************************************************
The contents of this email and any attachments are confidential to the intended recipient.  They may not be disclosed to or used by or copied in any way by anyone other than the intended recipient.  If this email is received in error, please contact Northview Investment Advisors Ltd. on + 1 345 943 2828 quoting the name of the sender and the email address to which it has been sent and then delete it.

Please further note that neither Northview Investment Advisors Ltd. nor the sender accepts any responsibility for viruses and it is your responsibility to scan or otherwise check this email and any attachments.

	[[alternative HTML version deleted]]


From cduranceau at nial.ky  Thu Oct 16 01:00:39 2014
From: cduranceau at nial.ky (Charles Duranceau)
Date: Wed, 15 Oct 2014 23:00:39 +0000
Subject: [R-SIG-Finance] PerformanceAnalytics: CAPM.alpha vs CAPM.jensenAlpha
Message-ID: <253B4FA1ECEEB54DB661809CB67734552A09ACC1@NOR-EXC01.northview.local>

Hi,

What Is the difference between the function CAPM.alpha and CAPM.jensenAlpha in the package "PerformanceAnalytics".

To me both definitions have the same meaning but I found different results when running the numbers.
I understand CAPM.alpha being the "intercept" from the linear regression of a portfolio return over the benchmark (tested by lm(x~y).
However I cannot figure out the results from CAPM.jensenAlpha. What interpretation should I made of CAPM.jensenAlpha?

Thank you
Best Regards,

Charles


**********************************************************************************************************************************************************
The contents of this email and any attachments are confidential to the intended recipient.  They may not be disclosed to or used by or copied in any way by anyone other than the intended recipient.  If this email is received in error, please contact Northview Investment Advisors Ltd. on + 1 345 943 2828 quoting the name of the sender and the email address to which it has been sent and then delete it.

Please further note that neither Northview Investment Advisors Ltd. nor the sender accepts any responsibility for viruses and it is your responsibility to scan or otherwise check this email and any attachments.

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Fri Oct 17 02:33:39 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 16 Oct 2014 19:33:39 -0500
Subject: [R-SIG-Finance] Performance Analytics: table.CAPM
In-Reply-To: <253B4FA1ECEEB54DB661809CB67734552A09AC2F@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB67734552A09AC2F@NOR-EXC01.northview.local>
Message-ID: <CAPPM_gRXWi6z3zWxHA_YcHbUA2PmQEAZ3L_4K9Dhgi025xGuVA@mail.gmail.com>

I get no errors when running your code with the most recent versions
of xts and PerformanceAnalytics on CRAN.  Here's a simplified version
of your example:

library(PerformanceAnalytics)
ind <- as.yearmon(Sys.Date())-(4:1)/12
Ra <- xts(c(0.1,0.11,0.09,0.1), ind)
Rb <- xts(c(0.25,0.2,-0.4,0.01), ind)
CAPM.alpha(Ra, Rb)
table.CAPM(Ra, Rb)

Best,
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Wed, Oct 15, 2014 at 4:28 PM, Charles Duranceau <cduranceau at nial.ky> wrote:
> Hi,
> I noticed a problem with the function : table.CAPM when it return following error message: "Error in NextMethod(.Generic) : dims [product 4] do not match the length of object [0]"
> I noticed in a previous post the solution is to transform series in xts, but in this case the series is already a xts object.
> I don't understand as other similar functions works well as the following code shows
>
> library("xts", lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
> library("PerformanceAnalytics", lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
> # Define Returns
> pf1<-c(0.1,0.11,0.09,0.1)
> bm<-c(0.25,0.2,-0.4,0.01)
> time_index<-seq(as.Date("2003/05/01"), by = "month", length.out = 4)-1 # last day of the month
> pf1x<-as.xts(pf1,time_index)
> bmx<-as.xts(bm,time_index)
>
>
> CAPM.alpha(pf1x, bmx, Rf = 0) # works [1] 0.09965609
> table.CAPM(pf1x,bmx,Rf=0)    # error
>
> Is there a way to solve the issue?
> Thank you
>
> Best Regards,
>
>
> Version info
>
> platform       x86_64-w64-mingw32
> arch           x86_64
> os             mingw32
> system         x86_64, mingw32
> status
> major          3
> minor          1.0
> year           2014
> month          04
> day            10
> svn rev        65387
> language       R
> version.string R version 3.1.0 (2014-04-10)
> nickname       Spring Dance
>
>
> package:
>
> Package:
>
>  "PerformanceAnalytics" VERSION 1.4.3541 from CRAN   ---- project.org/bin/windows/contrib/3.1/PerformanceAnalytics_1.4.3541.zip
>
> Charles
>


From optionsraghu at gmail.com  Fri Oct 17 11:37:31 2014
From: optionsraghu at gmail.com (Raghuraman Ramachandran)
Date: Fri, 17 Oct 2014 10:37:31 +0100
Subject: [R-SIG-Finance] quantstrat help
Message-ID: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>

Dear guRus

I am trying to understand the quantstrat package. My signal is very
simple. I want to buy if daily close > 2% of open and vice versa. But
my signals produce consecutive 1s (when market is going higher) and
-1s (when market is going lower) so I want to avoid buying (or
selling) more if already bought or sold.

My question is:
Is it possible to tell quantstrat a) Please do not buy if already
bought and if a new buy signal appears and b) Please buy even though
if already bought and a new signal appears.
Also, when a leave a trailing stop which takes precedence? A trailing
stop or a new signal on the opposite side and is it possible to change
this precedence please?

Sincere thanks for the guidance,
Raghu


From josh.m.ulrich at gmail.com  Fri Oct 17 13:50:49 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 17 Oct 2014 06:50:49 -0500
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
Message-ID: <CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>

On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
<optionsraghu at gmail.com> wrote:
> Dear guRus
>
> I am trying to understand the quantstrat package. My signal is very
> simple. I want to buy if daily close > 2% of open and vice versa. But
> my signals produce consecutive 1s (when market is going higher) and
> -1s (when market is going lower) so I want to avoid buying (or
> selling) more if already bought or sold.
>
Then only take the first signal.  If you want more specific
instructions about how to do that, then provide more specific details
about your problem (e.g. your actual code).

> My question is:
> Is it possible to tell quantstrat a) Please do not buy if already
> bought and if a new buy signal appears and b) Please buy even though
> if already bought and a new signal appears.

a) Yes.
b) Yes.

> Also, when a leave a trailing stop which takes precedence? A trailing
> stop or a new signal on the opposite side and is it possible to change
> this precedence please?
>
Rules are processed in the order described in the Details section of
?add.rule.  You can change the order, but it is strongly discouraged
because it's very easy to create unrealistic behavior if you modify
the order incorrectly.

> Sincere thanks for the guidance,
> Raghu
>

--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From optionsraghu at gmail.com  Fri Oct 17 14:31:21 2014
From: optionsraghu at gmail.com (Raghuraman Ramachandran)
Date: Fri, 17 Oct 2014 13:31:21 +0100
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
	<CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
Message-ID: <CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>

Thx Josh.

Here is the code:

require(quantmod)
require(TTR)
getSymbols('^GSPC')
colnames(GSPC)=c("Open","High","Low","Close","Volume","AdjPrice")
for (i in 1: nrow(GSPC))
{
  GSPC$signal[i]=ifelse((GSPC$Close[i]>1.02*GSPC$Open[i]), 1
,ifelse(GSPC$Close[i]<= 0.98*GSPC$Open[i], -1, 0))
}

So there will be consecutive days of longs or shorts but how to ignore
the subsequent signals and take the first occurrences inside
quantstrat pls?

Rgds
Raghu

On Fri, Oct 17, 2014 at 12:50 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
> <optionsraghu at gmail.com> wrote:
>> Dear guRus
>>
>> I am trying to understand the quantstrat package. My signal is very
>> simple. I want to buy if daily close > 2% of open and vice versa. But
>> my signals produce consecutive 1s (when market is going higher) and
>> -1s (when market is going lower) so I want to avoid buying (or
>> selling) more if already bought or sold.
>>
> Then only take the first signal.  If you want more specific
> instructions about how to do that, then provide more specific details
> about your problem (e.g. your actual code).
>
>> My question is:
>> Is it possible to tell quantstrat a) Please do not buy if already
>> bought and if a new buy signal appears and b) Please buy even though
>> if already bought and a new signal appears.
>
> a) Yes.
> b) Yes.
>
>> Also, when a leave a trailing stop which takes precedence? A trailing
>> stop or a new signal on the opposite side and is it possible to change
>> this precedence please?
>>
> Rules are processed in the order described in the Details section of
> ?add.rule.  You can change the order, but it is strongly discouraged
> because it's very easy to create unrealistic behavior if you modify
> the order incorrectly.
>
>> Sincere thanks for the guidance,
>> Raghu
>>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com


From ndc24075 at gmail.com  Fri Oct 17 14:52:20 2014
From: ndc24075 at gmail.com (Eric (YEN-LIN) CHIU)
Date: Fri, 17 Oct 2014 20:52:20 +0800
Subject: [R-SIG-Finance] How can I get Japanese Stock Daily Data in R?
Message-ID: <CAPpJ=Cx1hwLuXm3uRXFBmC0ErD8newx98M3JHbfEJ-vyvH6eHA@mail.gmail.com>

As I know, RFinanceYJ cannot work properly since the format of Yahoo in
Japan change the format of data.

Every time I try to fetch data, it shows
"Error in order(financial.data$date) : argument 1 is not a vector"

The current solution I found is in here:
http://rstudio-pubs-static.s3.amazonaws.com/6475_3034596b267b4a7587cefd3b8ed4ba25.html

But it is not convenient to choose date or change the data into xts object.
I notice google finance has Japanese stock data, but getSymbols cannot
access the data either.
I tried "getSymbols("TYO:4689")", but it cannot open the URL.

Could anyone please give me some advice for this? Thanks.

Eric

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Fri Oct 17 15:05:20 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 17 Oct 2014 09:05:20 -0400
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
	<CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
	<CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
Message-ID: <CA+oJuEFa_KKc=d_JwVYWf53Ug_echuw-bE0hu6LN7w6BOJUukw@mail.gmail.com>

You use an order-sizing rule.

On Fri, Oct 17, 2014 at 8:31 AM, Raghuraman Ramachandran <
optionsraghu at gmail.com> wrote:

> Thx Josh.
>
> Here is the code:
>
> require(quantmod)
> require(TTR)
> getSymbols('^GSPC')
> colnames(GSPC)=c("Open","High","Low","Close","Volume","AdjPrice")
> for (i in 1: nrow(GSPC))
> {
>   GSPC$signal[i]=ifelse((GSPC$Close[i]>1.02*GSPC$Open[i]), 1
> ,ifelse(GSPC$Close[i]<= 0.98*GSPC$Open[i], -1, 0))
> }
>
> So there will be consecutive days of longs or shorts but how to ignore
> the subsequent signals and take the first occurrences inside
> quantstrat pls?
>
> Rgds
> Raghu
>
> On Fri, Oct 17, 2014 at 12:50 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> wrote:
> > On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
> > <optionsraghu at gmail.com> wrote:
> >> Dear guRus
> >>
> >> I am trying to understand the quantstrat package. My signal is very
> >> simple. I want to buy if daily close > 2% of open and vice versa. But
> >> my signals produce consecutive 1s (when market is going higher) and
> >> -1s (when market is going lower) so I want to avoid buying (or
> >> selling) more if already bought or sold.
> >>
> > Then only take the first signal.  If you want more specific
> > instructions about how to do that, then provide more specific details
> > about your problem (e.g. your actual code).
> >
> >> My question is:
> >> Is it possible to tell quantstrat a) Please do not buy if already
> >> bought and if a new buy signal appears and b) Please buy even though
> >> if already bought and a new signal appears.
> >
> > a) Yes.
> > b) Yes.
> >
> >> Also, when a leave a trailing stop which takes precedence? A trailing
> >> stop or a new signal on the opposite side and is it possible to change
> >> this precedence please?
> >>
> > Rules are processed in the order described in the Details section of
> > ?add.rule.  You can change the order, but it is strongly discouraged
> > because it's very easy to create unrealistic behavior if you modify
> > the order incorrectly.
> >
> >> Sincere thanks for the guidance,
> >> Raghu
> >>
> >
> > --
> > Joshua Ulrich  |  about.me/joshuaulrich
> > FOSS Trading  |  www.fosstrading.com
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Fri Oct 17 15:05:39 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 17 Oct 2014 08:05:39 -0500
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
	<CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
	<CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
Message-ID: <CAPPM_gS-2bs0ZpfzkG=najE6F=RKx+YaoMgL4Je1JHcLWcbfWQ@mail.gmail.com>

On Fri, Oct 17, 2014 at 7:31 AM, Raghuraman Ramachandran
<optionsraghu at gmail.com> wrote:
> Thx Josh.
>
> Here is the code:
>
> require(quantmod)
> require(TTR)
> getSymbols('^GSPC')
> colnames(GSPC)=c("Open","High","Low","Close","Volume","AdjPrice")
> for (i in 1: nrow(GSPC))
> {
>   GSPC$signal[i]=ifelse((GSPC$Close[i]>1.02*GSPC$Open[i]), 1
> ,ifelse(GSPC$Close[i]<= 0.98*GSPC$Open[i], -1, 0))
> }
>
It is very bad practice to call a vectorized function (ifelse) inside
a loop.  The loop is unnecessary:
GSPC$signal <- with(GSPC,
  ifelse(Close > 1.02*Open, 1, ifelse(Close <= 0.98*Open, -1, 0)))

> So there will be consecutive days of longs or shorts but how to ignore
> the subsequent signals and take the first occurrences inside
> quantstrat pls?
>
If you truly want to ignore those signals, simply remove them before
sending them to applyRules.
GSPC$firstSignal <- with(GSPC, ifelse(signal == lag(signal), 0, signal))

> Rgds
> Raghu
>
> On Fri, Oct 17, 2014 at 12:50 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>> On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
>> <optionsraghu at gmail.com> wrote:
>>> Dear guRus
>>>
>>> I am trying to understand the quantstrat package. My signal is very
>>> simple. I want to buy if daily close > 2% of open and vice versa. But
>>> my signals produce consecutive 1s (when market is going higher) and
>>> -1s (when market is going lower) so I want to avoid buying (or
>>> selling) more if already bought or sold.
>>>
>> Then only take the first signal.  If you want more specific
>> instructions about how to do that, then provide more specific details
>> about your problem (e.g. your actual code).
>>
>>> My question is:
>>> Is it possible to tell quantstrat a) Please do not buy if already
>>> bought and if a new buy signal appears and b) Please buy even though
>>> if already bought and a new signal appears.
>>
>> a) Yes.
>> b) Yes.
>>
>>> Also, when a leave a trailing stop which takes precedence? A trailing
>>> stop or a new signal on the opposite side and is it possible to change
>>> this precedence please?
>>>
>> Rules are processed in the order described in the Details section of
>> ?add.rule.  You can change the order, but it is strongly discouraged
>> because it's very easy to create unrealistic behavior if you modify
>> the order incorrectly.
>>
>>> Sincere thanks for the guidance,
>>> Raghu
>>>
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com


From n-e-w at qtradr.net  Fri Oct 17 15:06:02 2014
From: n-e-w at qtradr.net (Nick White)
Date: Sat, 18 Oct 2014 00:06:02 +1100
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
	<CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
	<CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
Message-ID: <CAH+4RFtOzAepOVmb7j+i+LupY2dx9=i74dt0Wbz_es3F65Espw@mail.gmail.com>

Raghu,

I highly recommend you start with Guy Yollin's excellent lectures @
http://www.r-programming.org/papers

Begin with understanding the `blotter` package.

Guy's notes then proceed onto quantstrat and each successive lecture
introduces progressively more advanced features. Lecture 1 will more than
sufficiently cover what you're trying to do.

There's a learning curve to quantstrat -- but if you follow Guy's lectures
it will be about as painless as its possible to be.

n.



On Fri, Oct 17, 2014 at 11:31 PM, Raghuraman Ramachandran <
optionsraghu at gmail.com> wrote:

> Thx Josh.
>
> Here is the code:
>
> require(quantmod)
> require(TTR)
> getSymbols('^GSPC')
> colnames(GSPC)=c("Open","High","Low","Close","Volume","AdjPrice")
> for (i in 1: nrow(GSPC))
> {
>   GSPC$signal[i]=ifelse((GSPC$Close[i]>1.02*GSPC$Open[i]), 1
> ,ifelse(GSPC$Close[i]<= 0.98*GSPC$Open[i], -1, 0))
> }
>
> So there will be consecutive days of longs or shorts but how to ignore
> the subsequent signals and take the first occurrences inside
> quantstrat pls?
>
> Rgds
> Raghu
>
> On Fri, Oct 17, 2014 at 12:50 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> wrote:
> > On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
> > <optionsraghu at gmail.com> wrote:
> >> Dear guRus
> >>
> >> I am trying to understand the quantstrat package. My signal is very
> >> simple. I want to buy if daily close > 2% of open and vice versa. But
> >> my signals produce consecutive 1s (when market is going higher) and
> >> -1s (when market is going lower) so I want to avoid buying (or
> >> selling) more if already bought or sold.
> >>
> > Then only take the first signal.  If you want more specific
> > instructions about how to do that, then provide more specific details
> > about your problem (e.g. your actual code).
> >
> >> My question is:
> >> Is it possible to tell quantstrat a) Please do not buy if already
> >> bought and if a new buy signal appears and b) Please buy even though
> >> if already bought and a new signal appears.
> >
> > a) Yes.
> > b) Yes.
> >
> >> Also, when a leave a trailing stop which takes precedence? A trailing
> >> stop or a new signal on the opposite side and is it possible to change
> >> this precedence please?
> >>
> > Rules are processed in the order described in the Details section of
> > ?add.rule.  You can change the order, but it is strongly discouraged
> > because it's very easy to create unrealistic behavior if you modify
> > the order incorrectly.
> >
> >> Sincere thanks for the guidance,
> >> Raghu
> >>
> >
> > --
> > Joshua Ulrich  |  about.me/joshuaulrich
> > FOSS Trading  |  www.fosstrading.com
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Fri Oct 17 15:06:12 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 17 Oct 2014 09:06:12 -0400
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CA+oJuEFa_KKc=d_JwVYWf53Ug_echuw-bE0hu6LN7w6BOJUukw@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
	<CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
	<CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
	<CA+oJuEFa_KKc=d_JwVYWf53Ug_echuw-bE0hu6LN7w6BOJUukw@mail.gmail.com>
Message-ID: <CA+oJuEFeDobChiQP+VXcSAE4-59cKrJjzUehktNBWPSz5exikg@mail.gmail.com>

That is, you place a limit on the total position you can have.

On Fri, Oct 17, 2014 at 9:05 AM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> You use an order-sizing rule.
>
> On Fri, Oct 17, 2014 at 8:31 AM, Raghuraman Ramachandran <
> optionsraghu at gmail.com> wrote:
>
>> Thx Josh.
>>
>> Here is the code:
>>
>> require(quantmod)
>> require(TTR)
>> getSymbols('^GSPC')
>> colnames(GSPC)=c("Open","High","Low","Close","Volume","AdjPrice")
>> for (i in 1: nrow(GSPC))
>> {
>>   GSPC$signal[i]=ifelse((GSPC$Close[i]>1.02*GSPC$Open[i]), 1
>> ,ifelse(GSPC$Close[i]<= 0.98*GSPC$Open[i], -1, 0))
>> }
>>
>> So there will be consecutive days of longs or shorts but how to ignore
>> the subsequent signals and take the first occurrences inside
>> quantstrat pls?
>>
>> Rgds
>> Raghu
>>
>> On Fri, Oct 17, 2014 at 12:50 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
>> wrote:
>> > On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
>> > <optionsraghu at gmail.com> wrote:
>> >> Dear guRus
>> >>
>> >> I am trying to understand the quantstrat package. My signal is very
>> >> simple. I want to buy if daily close > 2% of open and vice versa. But
>> >> my signals produce consecutive 1s (when market is going higher) and
>> >> -1s (when market is going lower) so I want to avoid buying (or
>> >> selling) more if already bought or sold.
>> >>
>> > Then only take the first signal.  If you want more specific
>> > instructions about how to do that, then provide more specific details
>> > about your problem (e.g. your actual code).
>> >
>> >> My question is:
>> >> Is it possible to tell quantstrat a) Please do not buy if already
>> >> bought and if a new buy signal appears and b) Please buy even though
>> >> if already bought and a new signal appears.
>> >
>> > a) Yes.
>> > b) Yes.
>> >
>> >> Also, when a leave a trailing stop which takes precedence? A trailing
>> >> stop or a new signal on the opposite side and is it possible to change
>> >> this precedence please?
>> >>
>> > Rules are processed in the order described in the Details section of
>> > ?add.rule.  You can change the order, but it is strongly discouraged
>> > because it's very easy to create unrealistic behavior if you modify
>> > the order incorrectly.
>> >
>> >> Sincere thanks for the guidance,
>> >> Raghu
>> >>
>> >
>> > --
>> > Joshua Ulrich  |  about.me/joshuaulrich
>> > FOSS Trading  |  www.fosstrading.com
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>

	[[alternative HTML version deleted]]


From anshul.bits at gmail.com  Fri Oct 17 15:10:31 2014
From: anshul.bits at gmail.com (Anshul Pandey)
Date: Fri, 17 Oct 2014 09:10:31 -0400
Subject: [R-SIG-Finance] Popular stock forecasting/prediction algorithms in R
Message-ID: <CAFUr=9V1+85jFrFOqP+B=6ZgeT5KsKiJQnonJ5Rhba=TpXU0sA@mail.gmail.com>

Hello Folks

I am a PhD student (Big Data Visualization) at NYU, trying to visualize
models used for stock forecasting (ideally machine learning based complex
models, instead of SMA/EMA).

I know there are some variations of Artificial Neural Network that people
use, but are there others as well?
I would greatly appreciate if someone can point to a few of such
models/algos and where to find them in R.

PS: Moderators, please let me know if my query is too generic and if there
is a more apt forum for such discussions.

Thanks in advance.

Best,
Anshul

	[[alternative HTML version deleted]]


From optionsraghu at gmail.com  Fri Oct 17 15:13:19 2014
From: optionsraghu at gmail.com (Raghuraman Ramachandran)
Date: Fri, 17 Oct 2014 14:13:19 +0100
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CAH+4RFtOzAepOVmb7j+i+LupY2dx9=i74dt0Wbz_es3F65Espw@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
	<CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
	<CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
	<CAH+4RFtOzAepOVmb7j+i+LupY2dx9=i74dt0Wbz_es3F65Espw@mail.gmail.com>
Message-ID: <CADgEnD=wXBBM40urLOdUygRuitq+5XmKaMBUSN=9MW1byAvQ8g@mail.gmail.com>

Thanks Josh, Ilya, Nick. I will start on those lectures of Guy.
Josh> Thx for correcting the vectorization part of the code. It is a
steep curve indeed but enjoyable!

Best Rgds
Raghu

On Fri, Oct 17, 2014 at 2:06 PM, Nick White <n-e-w at qtradr.net> wrote:
> Raghu,
>
> I highly recommend you start with Guy Yollin's excellent lectures @
> http://www.r-programming.org/papers
>
> Begin with understanding the `blotter` package.
>
> Guy's notes then proceed onto quantstrat and each successive lecture
> introduces progressively more advanced features. Lecture 1 will more than
> sufficiently cover what you're trying to do.
>
> There's a learning curve to quantstrat -- but if you follow Guy's lectures
> it will be about as painless as its possible to be.
>
> n.
>
>
>
> On Fri, Oct 17, 2014 at 11:31 PM, Raghuraman Ramachandran
> <optionsraghu at gmail.com> wrote:
>>
>> Thx Josh.
>>
>> Here is the code:
>>
>> require(quantmod)
>> require(TTR)
>> getSymbols('^GSPC')
>> colnames(GSPC)=c("Open","High","Low","Close","Volume","AdjPrice")
>> for (i in 1: nrow(GSPC))
>> {
>>   GSPC$signal[i]=ifelse((GSPC$Close[i]>1.02*GSPC$Open[i]), 1
>> ,ifelse(GSPC$Close[i]<= 0.98*GSPC$Open[i], -1, 0))
>> }
>>
>> So there will be consecutive days of longs or shorts but how to ignore
>> the subsequent signals and take the first occurrences inside
>> quantstrat pls?
>>
>> Rgds
>> Raghu
>>
>> On Fri, Oct 17, 2014 at 12:50 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
>> wrote:
>> > On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
>> > <optionsraghu at gmail.com> wrote:
>> >> Dear guRus
>> >>
>> >> I am trying to understand the quantstrat package. My signal is very
>> >> simple. I want to buy if daily close > 2% of open and vice versa. But
>> >> my signals produce consecutive 1s (when market is going higher) and
>> >> -1s (when market is going lower) so I want to avoid buying (or
>> >> selling) more if already bought or sold.
>> >>
>> > Then only take the first signal.  If you want more specific
>> > instructions about how to do that, then provide more specific details
>> > about your problem (e.g. your actual code).
>> >
>> >> My question is:
>> >> Is it possible to tell quantstrat a) Please do not buy if already
>> >> bought and if a new buy signal appears and b) Please buy even though
>> >> if already bought and a new signal appears.
>> >
>> > a) Yes.
>> > b) Yes.
>> >
>> >> Also, when a leave a trailing stop which takes precedence? A trailing
>> >> stop or a new signal on the opposite side and is it possible to change
>> >> this precedence please?
>> >>
>> > Rules are processed in the order described in the Details section of
>> > ?add.rule.  You can change the order, but it is strongly discouraged
>> > because it's very easy to create unrealistic behavior if you modify
>> > the order incorrectly.
>> >
>> >> Sincere thanks for the guidance,
>> >> Raghu
>> >>
>> >
>> > --
>> > Joshua Ulrich  |  about.me/joshuaulrich
>> > FOSS Trading  |  www.fosstrading.com
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>
>


From ilya.kipnis at gmail.com  Fri Oct 17 15:14:45 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 17 Oct 2014 09:14:45 -0400
Subject: [R-SIG-Finance] Popular stock forecasting/prediction algorithms
 in R
In-Reply-To: <CAFUr=9V1+85jFrFOqP+B=6ZgeT5KsKiJQnonJ5Rhba=TpXU0sA@mail.gmail.com>
References: <CAFUr=9V1+85jFrFOqP+B=6ZgeT5KsKiJQnonJ5Rhba=TpXU0sA@mail.gmail.com>
Message-ID: <CA+oJuEFxLa-gxkGBFk40o+YTmXhhfQCZ3_RW2vV1H9eNJO5jbg@mail.gmail.com>

I believe Rob Hyndman has a section on some ML-forecasting type work on his
site. IIRC, he isn't a big believer in trying to forecast the stock market.

On Fri, Oct 17, 2014 at 9:10 AM, Anshul Pandey <anshul.bits at gmail.com>
wrote:

> Hello Folks
>
> I am a PhD student (Big Data Visualization) at NYU, trying to visualize
> models used for stock forecasting (ideally machine learning based complex
> models, instead of SMA/EMA).
>
> I know there are some variations of Artificial Neural Network that people
> use, but are there others as well?
> I would greatly appreciate if someone can point to a few of such
> models/algos and where to find them in R.
>
> PS: Moderators, please let me know if my query is too generic and if there
> is a more apt forum for such discussions.
>
> Thanks in advance.
>
> Best,
> Anshul
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From qi.li22 at gmail.com  Fri Oct 17 15:18:24 2014
From: qi.li22 at gmail.com (Qi Li)
Date: Fri, 17 Oct 2014 09:18:24 -0400
Subject: [R-SIG-Finance] How can I get Japanese Stock Daily Data in R?
In-Reply-To: <CAPpJ=Cx1hwLuXm3uRXFBmC0ErD8newx98M3JHbfEJ-vyvH6eHA@mail.gmail.com>
References: <CAPpJ=Cx1hwLuXm3uRXFBmC0ErD8newx98M3JHbfEJ-vyvH6eHA@mail.gmail.com>
Message-ID: <CABQr56XRzdy2Au7ypifUZ18=WWhqf0dv7B1tr6hzBDG3aH2H6Q@mail.gmail.com>

Hi,
  I am also very interested in this data. Please also let me know if you
have a solution. Thanks.

Qi

On Fri, Oct 17, 2014 at 8:52 AM, Eric (YEN-LIN) CHIU <ndc24075 at gmail.com>
wrote:

> As I know, RFinanceYJ cannot work properly since the format of Yahoo in
> Japan change the format of data.
>
> Every time I try to fetch data, it shows
> "Error in order(financial.data$date) : argument 1 is not a vector"
>
> The current solution I found is in here:
>
> http://rstudio-pubs-static.s3.amazonaws.com/6475_3034596b267b4a7587cefd3b8ed4ba25.html
>
> But it is not convenient to choose date or change the data into xts object.
> I notice google finance has Japanese stock data, but getSymbols cannot
> access the data either.
> I tried "getSymbols("TYO:4689")", but it cannot open the URL.
>
> Could anyone please give me some advice for this? Thanks.
>
> Eric
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From anshul.bits at gmail.com  Fri Oct 17 15:23:06 2014
From: anshul.bits at gmail.com (Anshul Pandey)
Date: Fri, 17 Oct 2014 09:23:06 -0400
Subject: [R-SIG-Finance] Popular stock forecasting/prediction algorithms
 in R
In-Reply-To: <CA+oJuEFxLa-gxkGBFk40o+YTmXhhfQCZ3_RW2vV1H9eNJO5jbg@mail.gmail.com>
References: <CAFUr=9V1+85jFrFOqP+B=6ZgeT5KsKiJQnonJ5Rhba=TpXU0sA@mail.gmail.com>
	<CA+oJuEFxLa-gxkGBFk40o+YTmXhhfQCZ3_RW2vV1H9eNJO5jbg@mail.gmail.com>
Message-ID: <CAFUr=9WYHXT9HdeB+4wPV1JWOCLG=6aHK5uUX4JEaO8pjtw+vA@mail.gmail.com>

Thanks Ilya, that's very helpful.


On Fri, Oct 17, 2014 at 9:14 AM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> I believe Rob Hyndman has a section on some ML-forecasting type work on
> his site. IIRC, he isn't a big believer in trying to forecast the stock
> market.
>
> On Fri, Oct 17, 2014 at 9:10 AM, Anshul Pandey <anshul.bits at gmail.com>
> wrote:
>
>> Hello Folks
>>
>> I am a PhD student (Big Data Visualization) at NYU, trying to visualize
>> models used for stock forecasting (ideally machine learning based complex
>> models, instead of SMA/EMA).
>>
>> I know there are some variations of Artificial Neural Network that people
>> use, but are there others as well?
>> I would greatly appreciate if someone can point to a few of such
>> models/algos and where to find them in R.
>>
>> PS: Moderators, please let me know if my query is too generic and if there
>> is a more apt forum for such discussions.
>>
>> Thanks in advance.
>>
>> Best,
>> Anshul
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>


-- 
Anshul Vikram Pandey
+1-929-231-6784
home: www.anshulvp.com
thoughts: www.anshulvp.com/blog
contact: anshul.bits at gmail.com, hello at anshulvp.com

	[[alternative HTML version deleted]]


From gsee000 at gmail.com  Fri Oct 17 16:37:02 2014
From: gsee000 at gmail.com (G See)
Date: Fri, 17 Oct 2014 09:37:02 -0500
Subject: [R-SIG-Finance] How can I get Japanese Stock Daily Data in R?
In-Reply-To: <CABQr56XRzdy2Au7ypifUZ18=WWhqf0dv7B1tr6hzBDG3aH2H6Q@mail.gmail.com>
References: <CAPpJ=Cx1hwLuXm3uRXFBmC0ErD8newx98M3JHbfEJ-vyvH6eHA@mail.gmail.com>
	<CABQr56XRzdy2Au7ypifUZ18=WWhqf0dv7B1tr6hzBDG3aH2H6Q@mail.gmail.com>
Message-ID: <CA+xi=qZXKPdaMdx3qYc29EjPKoZWYQW559iMqOWFdT6XwZhJjQ@mail.gmail.com>

You can get intraday data for the past few days from here:
http://k-db.com/stocks

Sorry, I don't use R to download that, but it should be trivial.

Hope this helps,
Garrett

On Fri, Oct 17, 2014 at 8:18 AM, Qi Li <qi.li22 at gmail.com> wrote:
> Hi,
>   I am also very interested in this data. Please also let me know if you
> have a solution. Thanks.
>
> Qi
>
> On Fri, Oct 17, 2014 at 8:52 AM, Eric (YEN-LIN) CHIU <ndc24075 at gmail.com>
> wrote:
>
>> As I know, RFinanceYJ cannot work properly since the format of Yahoo in
>> Japan change the format of data.
>>
>> Every time I try to fetch data, it shows
>> "Error in order(financial.data$date) : argument 1 is not a vector"
>>
>> The current solution I found is in here:
>>
>> http://rstudio-pubs-static.s3.amazonaws.com/6475_3034596b267b4a7587cefd3b8ed4ba25.html
>>
>> But it is not convenient to choose date or change the data into xts object.
>> I notice google finance has Japanese stock data, but getSymbols cannot
>> access the data either.
>> I tried "getSymbols("TYO:4689")", but it cannot open the URL.
>>
>> Could anyone please give me some advice for this? Thanks.
>>
>> Eric
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From zadig_1 at excite.com  Fri Oct 17 20:44:33 2014
From: zadig_1 at excite.com (ce)
Date: Fri, 17 Oct 2014 14:44:33 -0400
Subject: [R-SIG-Finance] Blotter package would it work for
	cross	currencies
Message-ID: &lt;20141017144159.30927@web007.roc2.bluetie.com&gt;

Thank you very much Brian. Following your guidance I have following code.  I still don't understand some field in the output. 
Manually I  buy 25,000 EURAUD at price 1.4552 and sell it next day at price 1.4512. I should earn 100 AUD.
 $symbols$EURAUD$txn section confirms it. But I don't understand $symbols$EURAUD$posPL.USD section.  25,000 EUR makes 31569.64 USD,  you calculate it 45940.14 ( = 25,000 * 1.262786 * 1.4552), why ? 
Also I don't understand why there is a -126.7427 ? Is it because you USD/EUR conversion during trade days ? 
How come end equity is 42.11206 ? 

library(quantstrat)
library(quantmod)
options("getSymbols.warning4.0"=FALSE)

currency("USD")
currency("EUR")
currency("AUD")

exchange_rate("EURAUD", currency="EUR", counter_currency="AUD", src=list(name='EUR/AUD', src='oanda'))
exchange_rate("USDEUR", currency="USD", counter_currency="EUR", src=list(name='USD/EUR', src='oanda'))

getSymbols("EURAUD", from=Sys.Date()-30)
getSymbols("USDEUR", from=Sys.Date()-30)
colnames(EURAUD) <- "price"
colnames(USDEUR) <- "price"

initPortf("PF1", symbols= c("EURAUD","USDEUR"), initDate="2014-10-12")
initAcct("myacct", portfolios="PF1", initDate="2014-10-12", initEq=30000)
initOrders(portfolio="PF1",initDate="2014-10-12")

addTxn("PF1", Symbol="EURAUD", TxnDate="2014-10-13", TxnPrice=1.4552, TxnQty= 25000)
addTxn("PF1", Symbol="EURAUD", TxnDate="2014-10-14", TxnPrice=1.4512, TxnQty=-25000)

updatePortf("PF1",   Dates = "2014-10-12::2014-10-15")
updateAcct("myacct", Dates = "2014-10-12::2014-10-15")
updateEndEq("myacct",Dates = "2014-10-12::2014-10-15")

getPortfolio("PF1")
getAccount("myacct")

> getPortfolio("PF1")
$summary
      Long.Value Short.Value Net.Value Gross.Value
2014-10-12 00:00:00       0.00           0      0.00        0.00
2014-10-12 20:00:00       0.00           0      0.00        0.00
2014-10-13 00:00:00   45940.14           0  45940.14    45940.14
2014-10-13 20:00:00   45982.26           0  45982.26    45982.26
2014-10-14 00:00:00       0.00           0      0.00        0.00
2014-10-14 20:00:00       0.00           0      0.00        0.00
                    Period.Realized.PL Period.Unrealized.PL Gross.Trading.PL
2014-10-12 00:00:00             0.0000              0.00000     0.000000e+00
2014-10-12 20:00:00             0.0000             0.00000     0.000000e+00
2014-10-13 00:00:00             0.0000              0.00000     0.000000e+00
2014-10-13 20:00:00       0.0000             42.11206     4.211206e+01
2014-10-14 00:00:00          -126.7427            126.74271     9.947598e-14
2014-10-14 20:00:00             0.0000              0.00000     0.000000e+00
                    Txn.Fees Net.Trading.PL
2014-10-12 00:00:00        0   0.000000e+00
2014-10-12 20:00:00        0   0.000000e+00
2014-10-13 00:00:00        0   0.000000e+00
2014-10-13 20:00:00        0   4.211206e+01
2014-10-14 00:00:00        0   9.947598e-14
2014-10-14 20:00:00        0   0.000000e+00

$symbols
$symbols$USDEUR
$symbols$USDEUR$txn
           Txn.Qty Txn.Price Txn.Value Txn.Avg.Cost Pos.Qty Pos.Avg.Cost
2014-10-12    0         0         0            0       0            0
           Gross.Txn.Realized.PL Txn.Fees Net.Txn.Realized.PL Con.Mult
2014-10-12                     0        0                   0        0

$symbols$USDEUR$posPL.USD
                    Pos.Qty Con.Mult Ccy.Mult Pos.Value Pos.Avg.Cost Txn.Value
2014-10-11 20:00:00       0        0        1         0            0         0
2014-10-12 00:00:00       0        0        1         0            0         0
2014-10-12 20:00:00       0        0        1     0            0         0
2014-10-13 20:00:00       0        0        1         0            0         0
2014-10-14 20:00:00     0        0        1         0            0         0
                    Period.Realized.PL Period.Unrealized.PL Gross.Trading.PL
2014-10-11 20:00:00                  0                    0                0
2014-10-12 00:00:00                  0                    0                0
2014-10-12 20:00:00                  0                0                0
2014-10-13 20:00:00                  0                    0                0
2014-10-14 20:00:00             0                    0                0
                    Txn.Fees Net.Trading.PL
2014-10-11 20:00:00        0              0
2014-10-12 00:00:00        0              0
2014-10-12 20:00:00        0              0
2014-10-13 20:00:00        0            0
2014-10-14 20:00:00        0              0

$symbols$USDEUR$posPL
                    Pos.Qty Con.Mult Ccy.Mult Pos.Value Pos.Avg.Cost Txn.Value
2014-10-11 20:00:00       0        0        1         0            0         0
2014-10-12 00:00:00       0  0        1         0            0         0
2014-10-12 20:00:00       0        0        1         0            0         0
2014-10-13 20:00:00       0        0        1         0            0         0
2014-10-14 20:00:00       0        0        1         0            0         0
                    Period.Realized.PL Period.Unrealized.PL Gross.Trading.PL
2014-10-11 20:00:00       0                    0                0
2014-10-12 00:00:00                  0                    0                0
2014-10-12 20:00:00                  0                    0                0
2014-10-13 20:00:00                  0                    0   0
2014-10-14 20:00:00                  0                    0                0
                    Txn.Fees Net.Trading.PL
2014-10-11 20:00:00        0              0
2014-10-12 00:00:00        0              0
2014-10-12 20:00:00        0              0
2014-10-13 20:00:00        0              0
2014-10-14 20:00:00        0              0


$symbols$EURAUD
$symbols$EURAUD$txn
   Txn.Qty Txn.Price Txn.Value Txn.Avg.Cost Pos.Qty Pos.Avg.Cost
2014-10-12       0    0.0000         0       0.0000       0       0.0000
2014-10-13   25000    1.4552     36380       1.4552   25000       1.4552
2014-10-14  -25000    1.4512    -36280       1.4512       0       0.0000
           Gross.Txn.Realized.PL Txn.Fees Net.Txn.Realized.PL Con.Mult
2014-10-12                     0        0                   0        0
2014-10-13                     0        0                   0        1
2014-10-14        -100        0                -100        1

$symbols$EURAUD$posPL.USD
                    Pos.Qty Con.Mult Ccy.Mult Pos.Value Pos.Avg.Cost Txn.Value
2014-10-11 20:00:00       0        0 1.262786      0.00     0.000000      0.00
2014-10-12 00:00:00       0 0 1.262786      0.00     0.000000      0.00
2014-10-12 20:00:00       0        0 1.262786      0.00     0.000000      0.00
2014-10-13 00:00:00   25000        1 1.262786  45940.14     1.837606  45940.14
2014-10-13 20:00:00   25000        1 1.267427  45982.26     1.844360      0.00
2014-10-14 00:00:00       0        1 1.267427      0.00     0.000000 -45982.26
2014-10-14 20:00:00     0        1 1.268875      0.00     0.000000      0.00
                    Period.Realized.PL Period.Unrealized.PL Gross.Trading.PL
2014-10-11 20:00:00             0.0000              0.00000     0.000000e+00
2014-10-12 00:00:00             0.0000           0.00000     0.000000e+00
2014-10-12 20:00:00             0.0000              0.00000     0.000000e+00
2014-10-13 00:00:00       0.0000              0.00000     0.000000e+00
2014-10-13 20:00:00             0.0000             42.11206     4.211206e+01
2014-10-14 00:00:00          -126.7427            126.74271     9.947598e-14
2014-10-14 20:00:00             0.0000              0.00000     0.000000e+00
                    Txn.Fees Net.Trading.PL
2014-10-11 20:00:00        0   0.000000e+00
2014-10-12 00:00:00 0   0.000000e+00
2014-10-12 20:00:00        0   0.000000e+00
2014-10-13 00:00:00        0   0.000000e+00
2014-10-13 20:00:00    0   4.211206e+01
2014-10-14 00:00:00        0   9.947598e-14
2014-10-14 20:00:00        0   0.000000e+00

$symbols$EURAUD$posPL
                    Pos.Qty Con.Mult Ccy.Mult Pos.Value Pos.Avg.Cost Txn.Value
2014-10-11 20:00:00       0        0        1    0       0.0000         0
2014-10-12 00:00:00       0        0        1         0       0.0000         0
2014-10-12 20:00:00     0        0        1         0       0.0000         0
2014-10-13 00:00:00   25000        1        1     36380       1.4552     36380
2014-10-13 20:00:00   25000        1        1     36280       1.4552         0
2014-10-14 00:00:00       0        1        1         0       0.0000    -36280
2014-10-14 20:00:00       0        1        1         0       0.0000         0
               Period.Realized.PL Period.Unrealized.PL Gross.Trading.PL
2014-10-11 20:00:00                  0                    0            0
2014-10-12 00:00:00                  0                    0                0
2014-10-12 20:00:00                  0           0                0
2014-10-13 00:00:00                  0                    0                0
2014-10-13 20:00:00             0                 -100             -100
2014-10-14 00:00:00               -100                  100                0
2014-10-14 20:00:00                  0                    0                0
                    Txn.Fees Net.Trading.PL
2014-10-11 20:00:00        0              0
2014-10-12 00:00:00        0              0
2014-10-12 20:00:00        0              0
2014-10-13 00:00:00        0              0
2014-10-13 20:00:00        0           -100
2014-10-14 00:00:00        0              0
2014-10-14 20:00:00        0              0



attr(,"class")
[1] "blotter_portfolio" "portfolio"
attr(,"currency")
[1] "USD"
attr(,"initDate")
[1] "2014-10-12"
> getAccount("myacct")
$portfolios
$portfolios$PF1
                    Long.Value Short.Value Net.Value Gross.Value Realized.PL
2014-10-12 00:00:00       0.00           0      0.00        0.00      0.0000
2014-10-12 00:00:00       0.00           0      0.00        0.00      0.0000
2014-10-12 20:00:00       0.00           0      0.00        0.00      0.0000
2014-10-13 00:00:00   45940.14           0  45940.14    45940.14      0.0000
2014-10-13 20:00:00   45982.26           0  45982.26 45982.26      0.0000
2014-10-14 00:00:00       0.00           0      0.00        0.00   -126.7427
2014-10-14 20:00:00       0.00           0      0.00        0.00      0.0000
                    Unrealized.PL Gross.Trading.PL Txn.Fees Net.Trading.PL
2014-10-12 00:00:00       0.00000     0.000000e+00        0   0.000000e+00
2014-10-12 00:00:00       0.00000     0.000000e+00        0   0.000000e+00
2014-10-12 20:00:00       0.00000     0.000000e+00        0   0.000000e+00
2014-10-13 00:00:00       0.00000    0.000000e+00        0   0.000000e+00
2014-10-13 20:00:00      42.11206     4.211206e+01        0   4.211206e+01
2014-10-14 00:00:00     126.74271     9.947598e-14        0   9.947598e-14
2014-10-14 20:00:00       0.00000     0.000000e+00        0   0.000000e+00


$summary
                    Additions Withdrawals Realized.PL Unrealized.PL Interest
2014-10-12 00:00:00         0     0      0.0000       0.00000        0
2014-10-12 00:00:00         0           0      0.0000       0.00000        0
2014-10-12 00:00:00         0           0      0.0000       0.00000        0
2014-10-12 20:00:00         0           0      0.0000       0.00000        0
2014-10-13 00:00:00         0           0      0.0000       0.00000        0
2014-10-13 20:00:00         0          0      0.0000      42.11206        0
2014-10-14 00:00:00         0           0   -126.7427     126.74271        0
2014-10-14 20:00:00         0           0      0.0000       0.00000        0
                    Gross.Trading.PL Txn.Fees Net.Trading.PL Advisory.Fees
2014-10-12 00:00:00     0.000000e+00        0   0.000000e+000
2014-10-12 00:00:00     0.000000e+00        0   0.000000e+00             0
2014-10-12 00:00:00     0.000000e+00        0   0.000000e+00             0
2014-10-12 20:00:00     0.000000e+00        0   0.000000e+00             0
2014-10-13 00:00:00     0.000000e+00        0   0.000000e+00             0
2014-10-13 20:00:00     4.211206e+01        0   4.211206e+01             0
2014-10-14 00:00:00     9.947598e-14        0   9.947598e-14             0
2014-10-14 20:00:00     0.000000e+00        0   0.000000e+00             0
                    Net.Performance   End.Eq
2014-10-12 00:00:00    0.000000e+00  0.00000
2014-10-12 00:00:00    0.000000e+00  0.00000
2014-10-12 00:00:00    0.000000e+00  0.00000
2014-10-12 20:00:00    0.000000e+00  0.00000
2014-10-13 00:00:00    0.000000e+00  0.00000
2014-10-13 20:00:00    4.211206e+01 42.11206
2014-10-14 00:00:00    9.947598e-14 42.11206
2014-10-14 20:00:00    0.000000e+00 42.11206

$Additions
           Additions
2014-10-12         0

$Withdrawals
           Withdrawals
2014-10-12           0

$Interest
           Interest
2014-10-12        0

attr(,"currency")
[1] "USD"
attr(,"initEq")
[1] 30000
attr(,"class")
[1] "portfolio_account" "account"



-----Original Message-----
From: "Brian G. Peterson" [brian at braverock.com]
Date: 10/12/2014 05:50 PM
To: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Blotter package would it work for cross
	currencies

Yes, it can, with a few minor difficulties.

To start with, you need to choose the currency of your Portfolios and 
Account.  Other wise it will default to USD.

also, you will want to specify your instruments correctly.  they are
of type exchange_rate.  See documentation and examples in the 
FinancialInstrument package.

Brian

On 10/12/2014 04:39 PM, ce wrote:
>
> Sorry for the double post.
>
> I would like to know it blotter package can be used to calculate performance/returns  of a portfolio mixed with cross currencies like GBP.EUR , CAD.CHF ?
> I can create a stock with
>
> stock("GBP",currency="EUR",multiplier=1)
>
>
> but functions like PortfReturns , getEndEq don't seem to care about currency ?

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From optionsraghu at gmail.com  Sat Oct 18 14:41:33 2014
From: optionsraghu at gmail.com (Raghuraman Ramachandran)
Date: Sat, 18 Oct 2014 13:41:33 +0100
Subject: [R-SIG-Finance] quantstrat help
In-Reply-To: <CADgEnD=wXBBM40urLOdUygRuitq+5XmKaMBUSN=9MW1byAvQ8g@mail.gmail.com>
References: <CADgEnD=rs8v0Lwa4HgFbMKEw5U_UeLB_SBaJJonB0=QDs3sPTw@mail.gmail.com>
	<CAPPM_gTAYPY75SNJJ0C_tgVKN3Z_Nr3XWvyubOy+A=evRGLUOg@mail.gmail.com>
	<CADgEnDmZYqQOkKR4w8W8b7z9=Rri5+AwYjqOkrj5X0h1nSxpXQ@mail.gmail.com>
	<CAH+4RFtOzAepOVmb7j+i+LupY2dx9=i74dt0Wbz_es3F65Espw@mail.gmail.com>
	<CADgEnD=wXBBM40urLOdUygRuitq+5XmKaMBUSN=9MW1byAvQ8g@mail.gmail.com>
Message-ID: <CADgEnDm6pHdAbWEgsJAgCEGF_9G5zeDqTo5NwSPnTPCQX0MK6Q@mail.gmail.com>

Dear Gents

I went through the documentation as you had kindly suggested and tried
to understand the application of quantstrat. I also tried to run a
code as below (obtained from here:
http://kylebalkissoon.wordpress.com/2013/06/07/trading-on-the-sharpe-ratio-using-quantstrat/).
The only difference is I tried to generate signal based on market
moves as discussed before. When I tried to run this I get the
following error:
A traceback did not help much.

out <- applyStrategy(strategy=stratstocky, port .... [TRUNCATED]
Error in if (inherits(sret$indicators, "xts") & nrow(mktdata) ==
nrow(sret$indicators)) { :
  argument is of length zero

What am I missing please? BTW Ilya's pages are excellent and very
descriptive. Great job.

The code below:


#clear workspace (for testing)
rm(list = ls())

#load libraries
require(quantmod)
require(PerformanceAnalytics)
require(blotter)
require(FinancialInstrument)
require(quantstrat)
require(forecast)
require(foreach)

#clear portfolio and acct not needed due to the clearing workspace but
here incase you don't use it.
suppressWarnings(rm("account.stocky","portfolio.stocky",pos=.blotter))
suppressWarnings(rm("order_book.stocky",pos=.strategy))
suppressWarnings(rm(stocky))

#if your stock is different you need to change
(initdate,initportf,addposlimit, chart.posn)
symbol = "SPY"

#Set up currencies
currency("USD")

#define stock change spy to your stock of choice
stock(symbol, currency="USD", multiplier = 1)

####################################################### Get Data
#################################################
getSymbols(symbol,src="yahoo",from = "2000-01-01" )

#Set Initial Date and Equity, note change SPY to your stock of choice.
initDate = start(SPY)
initEq = 10000

########################## Set up portfolio orders and Acct
#######################################
#change SPY to your stock choice

initPortf(name="stocky","SPY",initPosQty=0,initDate=initDate,currency="USD")
initAcct("stocky",portfolios="stocky",initDate=initDate,initEq=initEq)
initOrders("stocky",symbols=symbol,initDate=initDate)

#position limits
#change "SPY" to your stock choice
addPosLimit("stocky","SPY",timestamp=initDate,maxpos=100, minpos=0)

#Set up Strategy
stratstocky<-strategy("stocky")

##############################FUNCTIONS#################################
jumps=function(dat)
{
  colnames(dat)=c("Open","High","Low","Close","Volume","AdjPrice")
  dat$mclose=round(apply(HLC(dat),1,mean))
  dat$sig=ifelse((dat$mclose>1.02*dat$Open), 1,ifelse(dat$mclose<=
0.98*dat$Open, -1, 0))
  return(dat$sig)
}

########################indicators#############################

stratstocky<-add.indicator(
  strategy  =  stratstocky,
  name   = "jumps",
  arguments = list(
    dat = quote(mktdata)),
  label = "sig")

################################################ Signals
#############################

stratstocky<-add.signal(
  strategy = stratstocky,
  name = "sigThreshold",
  arguments = list(
    threshold = -1,
    column = "sig",
    relationship = "eq",
    cross = TRUE),
  label = "Selltime")

stratstocky<-add.signal(
  strategy   = stratstocky,
  name = "sigThreshold",
  arguments = list(
    threshold = 1,
    column = "sig",
    relationship = "eq",
    cross = TRUE),
  label = "Buytime")


######################################## Rules
#################################################
#Entry Rule Long
stratstocky<- add.rule(stratstocky,
                       name = "ruleSignal",
                       arguments = list(
                         sigcol = "Buytime",
                         sigval = TRUE,
                         orderqty = 100,
                         ordertype = "market",
                         orderside = "long",
                         pricemethod = "market",
                         replace = TRUE,
                         TxnFees = -1,
                         osFUN = osMaxPos),
                       type = "enter",
                       path.dep = TRUE,
                       label = "Entry")

#Entry Rule Short

stratstocky<- add.rule(stratstocky,
                       name   = "ruleSignal",
                       arguments = list(
                         sigcol = "Selltime",
                         sigval = TRUE,
                         orderqty = 100,
                         ordertype = "market",
                         orderside = "short",
                         pricemethod = "market",
                         replace = TRUE,
                         TxnFees = -1,
                         osFUN = osMaxPos),
                       type = "enter",
                       path.dep = TRUE,
                       label = "Entry")

#Exit Rules

#Exit
stratstocky <- add.rule(stratstocky,
                        name = "ruleSignal",
                        arguments = list(
                          sigcol = "Selltime",
                          sigval = TRUE,
                          orderqty = "all",
                          ordertype = "market",
                          orderside = "long",
                          pricemethod = "market",
                          replace = TRUE,
                          TxnFees = -1),
                        type = "exit",
                        path.dep = TRUE,
                        label = "Exitfromlong")

stratstocky <- add.rule(stratstocky,
                        name   = "ruleSignal",
                        arguments = list(
                          sigcol = "Buytime",
                          sigval = TRUE,
                          orderqty = "all",
                          ordertype = "market",
                          orderside = "short",
                          pricemethod = "market",
                          replace = TRUE,
                          TxnFees = -1),
                        type = "exit",
                        path.dep = TRUE,
                        label = "Exitfromshort")



##############################    Apply Strategy
##############################################

out <- applyStrategy(strategy=stratstocky, portfolios="stocky")
updatePortf("stocky")

############################# Portfolio Return Characterics
################################
#get portfolio data
portRet <- PortfReturns("stocky")
portRet$Total <- rowSums(portRet, na.rm=TRUE)
charts.PerformanceSummary(portRet$Total)
#tradeStats("stocky")[,c("Symbol","Num.Trades","Net.Trading.PL","maxDrawdown
#change SPY to your stock choice
chart.Posn("stocky","SPY")
results1<-getTxns("stocky","SPY")
#plot(results1$Net.Txn.Realized.PL)


Many thanks and regards,
Raghu

On Fri, Oct 17, 2014 at 2:13 PM, Raghuraman Ramachandran
<optionsraghu at gmail.com> wrote:
> Thanks Josh, Ilya, Nick. I will start on those lectures of Guy.
> Josh> Thx for correcting the vectorization part of the code. It is a
> steep curve indeed but enjoyable!
>
> Best Rgds
> Raghu
>
> On Fri, Oct 17, 2014 at 2:06 PM, Nick White <n-e-w at qtradr.net> wrote:
>> Raghu,
>>
>> I highly recommend you start with Guy Yollin's excellent lectures @
>> http://www.r-programming.org/papers
>>
>> Begin with understanding the `blotter` package.
>>
>> Guy's notes then proceed onto quantstrat and each successive lecture
>> introduces progressively more advanced features. Lecture 1 will more than
>> sufficiently cover what you're trying to do.
>>
>> There's a learning curve to quantstrat -- but if you follow Guy's lectures
>> it will be about as painless as its possible to be.
>>
>> n.
>>
>>
>>
>> On Fri, Oct 17, 2014 at 11:31 PM, Raghuraman Ramachandran
>> <optionsraghu at gmail.com> wrote:
>>>
>>> Thx Josh.
>>>
>>> Here is the code:
>>>
>>> require(quantmod)
>>> require(TTR)
>>> getSymbols('^GSPC')
>>> colnames(GSPC)=c("Open","High","Low","Close","Volume","AdjPrice")
>>> for (i in 1: nrow(GSPC))
>>> {
>>>   GSPC$signal[i]=ifelse((GSPC$Close[i]>1.02*GSPC$Open[i]), 1
>>> ,ifelse(GSPC$Close[i]<= 0.98*GSPC$Open[i], -1, 0))
>>> }
>>>
>>> So there will be consecutive days of longs or shorts but how to ignore
>>> the subsequent signals and take the first occurrences inside
>>> quantstrat pls?
>>>
>>> Rgds
>>> Raghu
>>>
>>> On Fri, Oct 17, 2014 at 12:50 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
>>> wrote:
>>> > On Fri, Oct 17, 2014 at 4:37 AM, Raghuraman Ramachandran
>>> > <optionsraghu at gmail.com> wrote:
>>> >> Dear guRus
>>> >>
>>> >> I am trying to understand the quantstrat package. My signal is very
>>> >> simple. I want to buy if daily close > 2% of open and vice versa. But
>>> >> my signals produce consecutive 1s (when market is going higher) and
>>> >> -1s (when market is going lower) so I want to avoid buying (or
>>> >> selling) more if already bought or sold.
>>> >>
>>> > Then only take the first signal.  If you want more specific
>>> > instructions about how to do that, then provide more specific details
>>> > about your problem (e.g. your actual code).
>>> >
>>> >> My question is:
>>> >> Is it possible to tell quantstrat a) Please do not buy if already
>>> >> bought and if a new buy signal appears and b) Please buy even though
>>> >> if already bought and a new signal appears.
>>> >
>>> > a) Yes.
>>> > b) Yes.
>>> >
>>> >> Also, when a leave a trailing stop which takes precedence? A trailing
>>> >> stop or a new signal on the opposite side and is it possible to change
>>> >> this precedence please?
>>> >>
>>> > Rules are processed in the order described in the Details section of
>>> > ?add.rule.  You can change the order, but it is strongly discouraged
>>> > because it's very easy to create unrealistic behavior if you modify
>>> > the order incorrectly.
>>> >
>>> >> Sincere thanks for the guidance,
>>> >> Raghu
>>> >>
>>> >
>>> > --
>>> > Joshua Ulrich  |  about.me/joshuaulrich
>>> > FOSS Trading  |  www.fosstrading.com
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>>> should go.
>>
>>


From wouter at morannon.org  Sun Oct 19 13:30:58 2014
From: wouter at morannon.org (Wouter Thielen)
Date: Sun, 19 Oct 2014 20:30:58 +0900
Subject: [R-SIG-Finance] Reply to: How can I get Japanese Stock Daily Data
	in R?
Message-ID: <CACySJQU1TsuSCHhKstc1u0DZKPachaLRh=qQ3pjxYjEtyktXfQ@mail.gmail.com>

Sorry for not being able to reply directly to the related thread, because I
was getting mails in daily batches. I have updated my settings for this.

I did make an R script to be included in the quantmod package, but I
haven't received any feedback from the community. The script can be found
here: https://github.com/wthielen/YJStocks/blob/master/getSymbols.yahooj.R

To be able to use it in this shape, you need to do the following:
- Include the quantmod library first: library(quantmod)
- Load getSymbols.R file from the quantmod source, for some internal
dependencies
- Pass any "missing" arguments that would be coming from the main
getSymbols() call: verbose and auto.assign

An example routine would be:

library(quantmod)
source("/path/to/quantmodpackage/pkg/R/getSymbols.R")
source("/path/to/getSymbols.yahooj.R")
getSymbols.yahooj("3048.T", verbose=TRUE, auto.assign=TRUE)

And then you will see it downloading daily stock data for Biccamera, and
assigning it to the "YJ3048.T" xts object.

I hope it will be included into the getSymbols.R file from the quantmod
package, so that it becomes a standard function.

Hope this helps!

-- 
Wouter Thielen

	[[alternative HTML version deleted]]


From junluke at gmail.com  Tue Oct 21 22:17:03 2014
From: junluke at gmail.com (jun wang)
Date: Tue, 21 Oct 2014 16:17:03 -0400
Subject: [R-SIG-Finance] maxbfgs
Message-ID: <CAPD4hGCorcbOMu_s3d2EBmCUNgjwTkXbUdOVxpw7hXuUgKJeQg@mail.gmail.com>

Dear R users,

I am using the maxbfgs function in the maxLik package for the maximum
likelihood function i created, but keeps getting the following error:

Error in chol.default(mInvSigma) :
  the leading minor of order 1 is not positive definite


Any suggestions would be very appreciated.

Thanks,
Jun

	[[alternative HTML version deleted]]


From brian at braverock.com  Tue Oct 21 22:38:28 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 21 Oct 2014 15:38:28 -0500
Subject: [R-SIG-Finance] maxbfgs
In-Reply-To: <CAPD4hGCorcbOMu_s3d2EBmCUNgjwTkXbUdOVxpw7hXuUgKJeQg@mail.gmail.com>
References: <CAPD4hGCorcbOMu_s3d2EBmCUNgjwTkXbUdOVxpw7hXuUgKJeQg@mail.gmail.com>
Message-ID: <5446C444.5070107@braverock.com>

On 10/21/2014 03:17 PM, jun wang wrote:
> I am using the maxbfgs function in the maxLik package for the maximum
> likelihood function i created, but keeps getting the following error:
>
> Error in chol.default(mInvSigma) :
>    the leading minor of order 1 is not positive definite
>
> Any suggestions would be very appreciated.

Try following the posting guide and creating a minimal reproducible example.

Also, perhaps contact the maintainer of the maxLik package with your 
reproducible example.

Brian


From arne.henningsen at gmail.com  Tue Oct 21 23:04:07 2014
From: arne.henningsen at gmail.com (Arne Henningsen)
Date: Tue, 21 Oct 2014 23:04:07 +0200
Subject: [R-SIG-Finance] maxbfgs
In-Reply-To: <5446C444.5070107@braverock.com>
References: <CAPD4hGCorcbOMu_s3d2EBmCUNgjwTkXbUdOVxpw7hXuUgKJeQg@mail.gmail.com>
	<5446C444.5070107@braverock.com>
Message-ID: <CAMTWbJgyv_xidNjW30ogJ9UL56c9RbA7ujjTLq-GfN+BEBz=pw@mail.gmail.com>

On 21 October 2014 22:38, Brian G. Peterson <brian at braverock.com> wrote:
> On 10/21/2014 03:17 PM, jun wang wrote:
>>
>> I am using the maxbfgs function in the maxLik package for the maximum
>> likelihood function i created, but keeps getting the following error:
>>
>> Error in chol.default(mInvSigma) :
>>    the leading minor of order 1 is not positive definite
>>
>> Any suggestions would be very appreciated.
>
>
> Try following the posting guide and creating a minimal reproducible example.
>
> Also, perhaps contact the maintainer of the maxLik package with your
> reproducible example.

Yes, you could do it (with a minimal reproducible example) through the
"help" forum at maxLik's R-Forge site:

https://r-forge.r-project.org/projects/maxlik/

Best regards,
Arne

-- 
Arne Henningsen
http://www.arne-henningsen.name


From cduranceau at nial.ky  Tue Oct 21 23:09:29 2014
From: cduranceau at nial.ky (Charles Duranceau)
Date: Tue, 21 Oct 2014 21:09:29 +0000
Subject: [R-SIG-Finance] Performance Analytics: table.CAPM
In-Reply-To: <CAPPM_gRXWi6z3zWxHA_YcHbUA2PmQEAZ3L_4K9Dhgi025xGuVA@mail.gmail.com>
References: <253B4FA1ECEEB54DB661809CB67734552A09AC2F@NOR-EXC01.northview.local>
	<CAPPM_gRXWi6z3zWxHA_YcHbUA2PmQEAZ3L_4K9Dhgi025xGuVA@mail.gmail.com>
Message-ID: <253B4FA1ECEEB54DB661809CB67734552A09B2CC@NOR-EXC01.northview.local>

Thank you Joshua, 
Yes you are right I get also no error running the same code in a second attempt.

But the day after, I ran the same code and I got the same error message so I'm confused. 
In order to make the estimation work, I directly define the xts object in the formula as in the following

table.CAPM(as.xts(al[,1,drop=FALSE]),as.xts(al[,2,drop=FALSE]),Rf=as.xts(al[,3,drop=FALSE]))
where "al" is a multivariate xts class object. This is the only way I get it to work

while the day before, I didn't have any problem running more simply table.CAPM (p1,p2 ,p3) where p1,p2,p3 where previously defined as univariate xts object. 

There's something in these functions that seems to be sensitive to the way the "xts" is entered or specified. I noticed the problem occur more often when passing the xts in the risk free rate parameter "Rf".

I don't think it's critical as I found a way to overcome but a little less straightforward. 

Sorry for the code, I will try making it simpler next time
Regards, 

-----Original Message-----
From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com] 
Sent: Thursday, October 16, 2014 7:34 PM
To: Charles Duranceau
Cc: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Performance Analytics: table.CAPM

I get no errors when running your code with the most recent versions of xts and PerformanceAnalytics on CRAN.  Here's a simplified version of your example:

library(PerformanceAnalytics)
ind <- as.yearmon(Sys.Date())-(4:1)/12
Ra <- xts(c(0.1,0.11,0.09,0.1), ind)
Rb <- xts(c(0.25,0.2,-0.4,0.01), ind)
CAPM.alpha(Ra, Rb)
table.CAPM(Ra, Rb)

Best,
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Wed, Oct 15, 2014 at 4:28 PM, Charles Duranceau <cduranceau at nial.ky> wrote:
> Hi,
> I noticed a problem with the function : table.CAPM when it return following error message: "Error in NextMethod(.Generic) : dims [product 4] do not match the length of object [0]"
> I noticed in a previous post the solution is to transform series in xts, but in this case the series is already a xts object.
> I don't understand as other similar functions works well as the 
> following code shows
>
> library("xts", 
> lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
> library("PerformanceAnalytics", 
> lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
> # Define Returns
> pf1<-c(0.1,0.11,0.09,0.1)
> bm<-c(0.25,0.2,-0.4,0.01)
> time_index<-seq(as.Date("2003/05/01"), by = "month", length.out = 4)-1 
> # last day of the month
> pf1x<-as.xts(pf1,time_index)
> bmx<-as.xts(bm,time_index)
>
>
> CAPM.alpha(pf1x, bmx, Rf = 0) # works [1] 0.09965609
> table.CAPM(pf1x,bmx,Rf=0)    # error
>
> Is there a way to solve the issue?
> Thank you
>
> Best Regards,
>
>
> Version info
>
> platform       x86_64-w64-mingw32
> arch           x86_64
> os             mingw32
> system         x86_64, mingw32
> status
> major          3
> minor          1.0
> year           2014
> month          04
> day            10
> svn rev        65387
> language       R
> version.string R version 3.1.0 (2014-04-10)
> nickname       Spring Dance
>
>
> package:
>
> Package:
>
>  "PerformanceAnalytics" VERSION 1.4.3541 from CRAN   ---- project.org/bin/windows/contrib/3.1/PerformanceAnalytics_1.4.3541.zip
>
> Charles
>


From alexios at 4dscape.com  Tue Oct 21 23:20:49 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Tue, 21 Oct 2014 22:20:49 +0100
Subject: [R-SIG-Finance] Performance Analytics: table.CAPM
In-Reply-To: <253B4FA1ECEEB54DB661809CB67734552A09B2CC@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB67734552A09AC2F@NOR-EXC01.northview.local>	<CAPPM_gRXWi6z3zWxHA_YcHbUA2PmQEAZ3L_4K9Dhgi025xGuVA@mail.gmail.com>
	<253B4FA1ECEEB54DB661809CB67734552A09B2CC@NOR-EXC01.northview.local>
Message-ID: <5446CE31.2080003@4dscape.com>

I've come across this problem before, and found that by setting the 
colnames of each variable (so they are not NULL) resolves it.

Alexios

On 21/10/2014 22:09, Charles Duranceau wrote:
> Thank you Joshua,
> Yes you are right I get also no error running the same code in a second attempt.
>
> But the day after, I ran the same code and I got the same error message so I'm confused.
> In order to make the estimation work, I directly define the xts object in the formula as in the following
>
> table.CAPM(as.xts(al[,1,drop=FALSE]),as.xts(al[,2,drop=FALSE]),Rf=as.xts(al[,3,drop=FALSE]))
> where "al" is a multivariate xts class object. This is the only way I get it to work
>
> while the day before, I didn't have any problem running more simply table.CAPM (p1,p2 ,p3) where p1,p2,p3 where previously defined as univariate xts object.
>
> There's something in these functions that seems to be sensitive to the way the "xts" is entered or specified. I noticed the problem occur more often when passing the xts in the risk free rate parameter "Rf".
>
> I don't think it's critical as I found a way to overcome but a little less straightforward.
>
> Sorry for the code, I will try making it simpler next time
> Regards,
>
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
> Sent: Thursday, October 16, 2014 7:34 PM
> To: Charles Duranceau
> Cc: r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] Performance Analytics: table.CAPM
>
> I get no errors when running your code with the most recent versions of xts and PerformanceAnalytics on CRAN.  Here's a simplified version of your example:
>
> library(PerformanceAnalytics)
> ind <- as.yearmon(Sys.Date())-(4:1)/12
> Ra <- xts(c(0.1,0.11,0.09,0.1), ind)
> Rb <- xts(c(0.25,0.2,-0.4,0.01), ind)
> CAPM.alpha(Ra, Rb)
> table.CAPM(Ra, Rb)
>
> Best,
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>
>
> On Wed, Oct 15, 2014 at 4:28 PM, Charles Duranceau <cduranceau at nial.ky> wrote:
>> Hi,
>> I noticed a problem with the function : table.CAPM when it return following error message: "Error in NextMethod(.Generic) : dims [product 4] do not match the length of object [0]"
>> I noticed in a previous post the solution is to transform series in xts, but in this case the series is already a xts object.
>> I don't understand as other similar functions works well as the
>> following code shows
>>
>> library("xts",
>> lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
>> library("PerformanceAnalytics",
>> lib.loc="C:/Users/cduranceau/Documents/R/win-library/3.1")
>> # Define Returns
>> pf1<-c(0.1,0.11,0.09,0.1)
>> bm<-c(0.25,0.2,-0.4,0.01)
>> time_index<-seq(as.Date("2003/05/01"), by = "month", length.out = 4)-1
>> # last day of the month
>> pf1x<-as.xts(pf1,time_index)
>> bmx<-as.xts(bm,time_index)
>>
>>
>> CAPM.alpha(pf1x, bmx, Rf = 0) # works [1] 0.09965609
>> table.CAPM(pf1x,bmx,Rf=0)    # error
>>
>> Is there a way to solve the issue?
>> Thank you
>>
>> Best Regards,
>>
>>
>> Version info
>>
>> platform       x86_64-w64-mingw32
>> arch           x86_64
>> os             mingw32
>> system         x86_64, mingw32
>> status
>> major          3
>> minor          1.0
>> year           2014
>> month          04
>> day            10
>> svn rev        65387
>> language       R
>> version.string R version 3.1.0 (2014-04-10)
>> nickname       Spring Dance
>>
>>
>> package:
>>
>> Package:
>>
>>   "PerformanceAnalytics" VERSION 1.4.3541 from CRAN   ---- project.org/bin/windows/contrib/3.1/PerformanceAnalytics_1.4.3541.zip
>>
>> Charles
>>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
>


From treydog999 at gmail.com  Wed Oct 22 12:03:05 2014
From: treydog999 at gmail.com (Derek Wong)
Date: Wed, 22 Oct 2014 05:03:05 -0500
Subject: [R-SIG-Finance] quantstrat help - simple combine error using
 windows and walk.forward
In-Reply-To: <CALQudT-RJgHF734fYTetbbZdWxM_YyRu1bPikP3rPUEDC+g_Jg@mail.gmail.com>
References: <CALQudT9u8Fa++0u+di_ibjV9FuFGqdRoWLtQq4V6LhAVNyKSRA@mail.gmail.com>
	<CALQudT9az9UtqdvhkeH0HrLSh5-mcnaUdm2stZW_BuB6+mDXuA@mail.gmail.com>
	<CAK2H+ecJV49j9st69nsGr5pck9=0FYTac9scTdXb90j1kktfdQ@mail.gmail.com>
	<CALQudT-zjBJMnz9jFDyY=R79gWTN=khT-C-EA1kuu+0veLtSUg@mail.gmail.com>
	<CAPPM_gTBryA5oBkhtN7nbJd+WnG-wFje_Q2KQ=rXM4YJg3XvMQ@mail.gmail.com>
	<CALQudT-RJgHF734fYTetbbZdWxM_YyRu1bPikP3rPUEDC+g_Jg@mail.gmail.com>
Message-ID: <CALQudT_304c3Q107w-j-5=ZTZSj5guViJGEXXjO3nmBnZ+jdKg@mail.gmail.com>

I have continued to work on this problem and have made some progress
although I am still stuck. As well as cleaning up the reproducible
code because it is quite long.  I am able to run this sequentially and
see some output however still with errors to the combine function.
Although I think its deeper then that.

 I receive this error after every iteration.

<simpleError in if (inherits(sret$indicators, "xts") & nrow(mktdata)
== nrow(sret$indicators)) {    mktdata <- sret$indicators
sret$indicators <- NULL}: argument is of length zero>

this error after completion

error calling combine function:
<simpleError in fun(result.1, result.2, result.3, result.4, result.5,
result.6,     result.7, result.8, result.9, result.10, result.11,
result.12,     result.13, result.14, result.15): attempt to select
less than one element>
numValues: 15, numResults: 15, stopped: TRUE
Error in walk.forward(pairStrat, paramset.label = "BBOPT",
portfolio.st = portfolio1.st,  :
  obj.func() returned empty result
In addition: Warning message:
In max(x$tradeStats$Net.Trading.PL) :
  no non-missing arguments to max; returning -Inf

I looked into the walk.forward function and found nothing that
required this , but using the debugger it seems to be coming from
apply.paramset.  Since the apply.paramset fails we do not return
anything to the obj.func which then throws another error. However when
i run apply.paramset sequentially on my strategy, I do not get any
errors and see correct results. I am really confused as to the origin
of this error or how to rectify it especially since i am doing
everything sequentially. Which should prevent the previous problem of
calcRatio not getting pushed to nodes.

require(quantstrat)

suppressWarnings(rm("order_book.pair1",pos=.strategy))
suppressWarnings(rm("account.pairs", "portfolio.pair1", pos=.blotter))
suppressWarnings(rm("initDate", "endDate", "startDate", "initEq", "SD", "N",
                    "symb1", "symb2", "portfolio1.st", "account.st",
                    "pairStrat", "out1"))

initDate <- '2009-01-01'
endDate <- '2011-05-01'
startDate <- '2009-01-02'
initEq <- 100000
SD <- 2
N <- 20

MaxPos <- 1500  #max position in stockA;
# max position in stock B will be max * ratio, i.e. no hard position limit in
# Stock B
lvls <- 3  #how many times to fade; Each order's qty will = MaxPos/lvls

symb1 <- 'SPY' #change these to try other pairs
symb2 <- 'DIA' #if you change them, make sure position limits still make sense

portfolio1.st <- 'pair1'
account.st <- 'pairs'

getSymbols(c(symb1, symb2), from=startDate, to=endDate, adjust=TRUE)

# The following function is used to make sure the timestamps of all symbols are
# the same deletes rows where one of the stocks is missing data
alignSymbols <- function(symbols, env=.GlobalEnv) {
  # This is a simplified version of qmao::alignSymbols()
  if (length(symbols) < 2)
    stop("Must provide at least 2 symbols")
  if (any(!is.character(symbols)))
    stop("Symbols must be vector of character strings.")
  ff <- get(symbols[1],env=env)
  for (sym in symbols[-1]) {
    tmp.sym <- get(sym,env=env)
    ff <- merge(ff, tmp.sym, all=FALSE)
  }
  for (sym in symbols) {
    assign(sym,ff[,grep(sym, colnames(ff))], env=env)
  }
  symbols
}
alignSymbols(c(symb1, symb2))

# Define Instruments
currency("USD")
stock(symb1, currency="USD", multiplier=1)
stock(symb2, currency="USD", multiplier=1)

# Initialize Portfolio, Account, and Orders
initPortf(name=portfolio1.st, c(symb1,symb2), initDate=initDate)
initAcct(account.st, portfolios=portfolio1.st, initDate=initDate, initEq=initEq)
initOrders(portfolio=portfolio1.st, initDate=initDate)

# osFUN will need to know which symbol is leg 1 and which is leg 2 as well as
# what the values are for MaxPos and lvls.  So, create a slot in portfolio to
# hold this info.
pair <- c(1, 2, MaxPos, lvls)
names(pair) <- c(symb1, symb2, "MaxPos", "lvls")
.blotter[[paste('portfolio', portfolio1.st, sep='.')]]$pair <- pair

# Create initial position limits and levels by symbol
# allow 3 entries for long and short if lvls=3.
addPosLimit(portfolio=portfolio1.st, timestamp=initDate, symbol=symb1,
            maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos, shortlevels=lvls)
addPosLimit(portfolio=portfolio1.st, timestamp=initDate, symbol=symb2,
            maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos, shortlevels=lvls)

# Create a strategy object
pairStrat <- strategy('pairStrat')

# Indicator function
calcRatio <- function(x) {
  #returns the ratio of notional close prices for 2 symbols
  x1 <- get(x[1])
  x2 <- get(x[2])
  mult1 <- getInstrument(x[1])$multiplier
  mult2 <- getInstrument(x[2])$multiplier
  rat <- (mult1 * Cl(x1)) / (mult2 * Cl(x2))
  colnames(rat) <- 'Ratio'
  rat
}
# Indicator used for determining entry/exits
Ratio <- calcRatio(c(symb1[1], symb2[1]))

# Ratio indicator.
.blotter[[paste('portfolio',portfolio1.st,sep='.')]]$HedgeRatio <- Ratio
getHedgeRatio <- function(portfolio, timestamp) {
  portf <- getPortfolio(portfolio)
  timestamp <- format(timestamp,"%Y-%m-%d %H:%M:%S")

  toDate <- paste("::", timestamp, sep="")
  Ratio <- last(portf$HedgeRatio[toDate])
  as.numeric(Ratio)
}

# Create an indicator - BBands on the Ratio
pairStrat <- add.indicator(strategy=pairStrat, name = "calcRatio",
                           arguments=list(x=c(symb1,symb2)))
pairStrat <- add.indicator(strategy=pairStrat, name = "BBands",
                           arguments=list(HLC=quote(Ratio), sd=SD, n=N,
                                          maType='SMA'),
                           label = "BBands")

#applyIndicators(strategy=pairStrat,mktdata=get(symb1[1])) #for debugging

pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","up"),
                                       relationship="lt"),
                        label="cross.up")
pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","dn"),
                                       relationship="gt"),
                        label="cross.dn")
pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","mavg"),
                                       relationship="lt"),
                        label="cross.mid.fa")
pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
                        arguments=list(columns=c("Ratio","mavg"),
                                       relationship="gt"),
                        label="cross.mid.fb")

# make an order sizing function
#######################_ORDER SIZING FUNCTION_##################################
# check to see which stock it is. If it's the second stock, reverse orderqty and
# orderside
osSpreadMaxPos <- function (data, timestamp, orderqty, ordertype, orderside,
                            portfolio, symbol, ruletype, ..., orderprice) {
  portf <- getPortfolio(portfolio)
  #check to make sure pair slot has the things needed for this function
  if (!any(portf$pair == 1) && !(any(portf$pair == 2)))
    stop('pair must contain both values 1 and 2')
  if (!any(names(portf$pair) == "MaxPos") || !any(names(portf$pair) == "lvls"))
    stop('pair must contain MaxPos and lvls')

  if (portf$pair[symbol] == 1) legside <- "long"
  if (portf$pair[symbol] == 2) legside <- "short"
  MaxPos <- portf$pair["MaxPos"]
  lvls <- portf$pair["lvls"]
  ratio <- getHedgeRatio(portfolio, timestamp)
  pos <- getPosQty(portfolio, symbol, timestamp)
  PosLimit <- getPosLimit(portfolio, symbol, timestamp)
  qty <- orderqty
  if (legside == "short") {#symbol is 2nd leg
    ## Comment out next line to use equal ordersizes for each stock.
    addPosLimit(portfolio=portfolio, timestamp=timestamp, symbol=symbol,
                maxpos=round(MaxPos*ratio,0), longlevels=lvls,
                minpos=round(-MaxPos*ratio,0), shortlevels=lvls)
    ##
    qty <- -orderqty #switch orderqty for Stock B
  }

  if (qty > 0) orderside = 'long'
  if (qty < 0) orderside = 'short'

  orderqty <- osMaxPos(data=data,timestamp=timestamp, orderqty=qty,
                       ordertype=ordertype, orderside=orderside,
                       portfolio=portfolio, symbol=symbol, ruletype=ruletype,
                       ...)

  #Add the order here instead of in the ruleSignal function
  if (!is.null(orderqty) & !orderqty == 0 & !is.null(orderprice)) {
    addOrder(portfolio=portfolio, symbol=symbol,
             timestamp=timestamp, qty=orderqty, price=as.numeric(orderprice),
             ordertype=ordertype, side=orderside, replace=FALSE,
             status="open", ...=...)
  }
  return(0) #so that ruleSignal function doesn't also try to place an order
}

pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.dn", sigval=TRUE,
                                     orderqty=1e6, ordertype='market',
                                     orderside=NULL, osFUN='osSpreadMaxPos'),
                      type='enter')
pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.up", sigval=TRUE,
                                     orderqty=-1e6, ordertype='market',
                                     orderside=NULL, osFUN='osSpreadMaxPos'),
                      type='enter')
pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.mid.fb", sigval=TRUE,
                                     orderqty='all', ordertype='market',
                                     orderside=NULL),
                      type='exit')
pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
                      arguments=list(sigcol="cross.mid.fa", sigval=TRUE,
                                     orderqty='all', ordertype='market',
                                     orderside=NULL),
                      type='exit')


## for debugging
# applySignals(strategy=pairStrat,
#              mktdata=applyIndicators(strategy=pairStrat, mktdata=get(symb1)))
##

out1<-applyStrategy(strategy=pairStrat, portfolios=portfolio1.st)

updatePortf(Portfolio=portfolio1.st,
            Dates=paste("::", as.Date(Sys.time()), sep=''))
updateAcct(account.st, Dates=paste(startDate, endDate, sep="::"))
updateEndEq(account.st, Dates=paste(startDate, endDate, sep="::"))
getEndEq(account.st, Sys.time())

#Distribution Initialization
pairStrat <- add.distribution(strategy = pairStrat,
                 paramset.label ="BBOPT",
                 component.type = "indicator",
                 component.label = "BBands",
                 variable = list(n = seq(10,30, by = 5)),
                 label = "n")

pairStrat <- add.distribution(strategy = pairStrat,
                 paramset.label ="BBOPT",
                 component.type = "indicator",
                 component.label = "BBands",
                 variable = list(sd = seq(1,3,by = 1)),
                 label = "sd")

# apply.paramset(stratBBands, "BBOPT", portfolio.st,account.st)

# Objective Function
my.obj.func <- function(x)
{

  return(max(x$tradeStats$Net.Trading.PL) == x$tradeStats$Net.Trading.PL)

}

#WFA - sequential

require(foreach)
require(iterators)
registerDoSEQ()

result <- walk.forward(pairStrat,
                       paramset.label = "BBOPT",
                       portfolio.st = portfolio1.st,
                       account.st = account.st,
                       period = "months",
                       k.training = 6,
                       k.testing = 3,
                       obj.func = my.obj.func,
                       obj.args = list(x=quote(result$apply.paramset)),
                       audit.prefix = "wfa",
                       anchored = FALSE,
                       verbose = TRUE)






thanks again for your help as always,

Derek

On Tue, Sep 30, 2014 at 9:55 PM, Derek Wong <treydog999 at gmail.com> wrote:
> Hi Josh,
>
> Sorry about the HTML mistake, I am new to using something like
> r-sig-finance mailing list, I didn't realize I was posting
> incorrectly. In regards to the personal correspondence, I didnt full
> understand that it was operating system independent, I thought that
> because windows has problems with MC solutions that could have been
> the issue. I have tried doing using the doRedis package and it just
> runs for hours on end., but never showing a result. I am guessing it
> should not take 4+ hours to run this, but i can not see and additional
> output in R so i am not sure how far along it got..  Although the
> server console does show
>
> 10 changes in 300 seconds. Saving...
> fork operation complete
> Background saving terminated success.
>
>
> I have also tried using registerdoSEQ() think that was a guaranteed
> way of seeing the results however i recieve an error. here is the
> output. I have checked if i had the iterators package installed and
> loaded which I do. So i do not know where it is trying to call this
> function. I did a search for help on iter assuming it was a built in
> function but did not find anything.
>
>> registerDoSEQ()
>>
>> result <- walk.forward(pairStrat,
> +                        paramset.label = "BBOPT",
> +                        portfolio.st = portfolio1.st,
> +                        account.st = account.st,
> +                        period = "months",
> +                        k.training = 6,
> +                        k.testing = 3,
> +                        obj.func = my.obj.func,
> +                        obj.args = list(x=quote(result$apply.paramset)),
> +                        audit.prefix = "wfa",
> +                        anchored = FALSE,
> +                        verbose = TRUE)
> [1] "=== training BBOPT on 2009-01-02/2009-06-30"
> Error in eval(expr, envir, enclos) : could not find function "iter"
>
>
>
> All Code with  appended doRedis and doSEQ -------- (hopefully this
> posts correctly)
>
>
>
> #Kindly contributed to quantstrat by Garrett See
> #code borrowed heavily from existing quantstrat demos
>
> # This is a simple pairs trading example intended to illustrate how you can
> # extend existing quantstrat functionality.  It uses addPosLimits to specify
> # levels and position limits, and shows how to pass a custom order sizing
> # function to osFUN
>
> # Note that it would be easier to build a spread first and treat it as a single
> # instrument instead of dealing with a portfolio of stocks.
>
> ## given 2 stocks, calculate the ratio of their notional values.  If the ratio
> # falls below it's 2 stdev band, then when it crosses back above it, buy stock 1
> # and sell stock 2.  If the ratio rises above it's 2 stdev band, then when it
> # crosses back below it, sell stock 1 and buy stock 2.  If the ratio crosses
> # its moving average, then flatten any open positions.
>
> # The Qty of Stock A that it buys (sells) = MaxPos / lvls
> # The Qty of Stock B that is sells (buys) = MaxPos * Ratio / lvls
>
> require(quantstrat)
>
> suppressWarnings(rm("order_book.pair1",pos=.strategy))
> suppressWarnings(rm("account.pairs", "portfolio.pair1", pos=.blotter))
> suppressWarnings(rm("initDate", "endDate", "startDate", "initEq", "SD", "N",
>                     "symb1", "symb2", "portfolio1.st", "account.st",
>                     "pairStrat", "out1"))
>
> ##### PLACE DEMO AND TEST DATES HERE #################
> #
> #if(isTRUE(options('in_test')$in_test))
> #  # use test dates
> #  {initDate="2011-01-01"
> #  endDate="2012-12-31"
> #  } else
> #  # use demo defaults
> #  {initDate="1999-12-31"
> #  endDate=Sys.Date()}
>
> initDate <- '2009-01-01'
> endDate <- '2011-05-01'
> startDate <- '2009-01-02'
> initEq <- 100000
> SD <- 2
> N <- 20
>
> MaxPos <- 1500  #max position in stockA;
> # max position in stock B will be max * ratio, i.e. no hard position limit in
> # Stock B
> lvls <- 3  #how many times to fade; Each order's qty will = MaxPos/lvls
>
> symb1 <- 'SPY' #change these to try other pairs
> symb2 <- 'DIA' #if you change them, make sure position limits still make sense
>
> portfolio1.st <- 'pair1'
> account.st <- 'pairs'
>
> getSymbols(c(symb1, symb2), from=startDate, to=endDate, adjust=TRUE)
>
> # The following function is used to make sure the timestamps of all symbols are
> # the same deletes rows where one of the stocks is missing data
> alignSymbols <- function(symbols, env=.GlobalEnv) {
>   # This is a simplified version of qmao::alignSymbols()
>   if (length(symbols) < 2)
>     stop("Must provide at least 2 symbols")
>   if (any(!is.character(symbols)))
>     stop("Symbols must be vector of character strings.")
>   ff <- get(symbols[1],env=env)
>   for (sym in symbols[-1]) {
>     tmp.sym <- get(sym,env=env)
>     ff <- merge(ff, tmp.sym, all=FALSE)
>   }
>   for (sym in symbols) {
>     assign(sym,ff[,grep(sym, colnames(ff))], env=env)
>   }
>   symbols
> }
> alignSymbols(c(symb1, symb2))
>
> # Define Instruments
> currency("USD")
> stock(symb1, currency="USD", multiplier=1)
> stock(symb2, currency="USD", multiplier=1)
>
> # Initialize Portfolio, Account, and Orders
> initPortf(name=portfolio1.st, c(symb1,symb2), initDate=initDate)
> initAcct(account.st, portfolios=portfolio1.st, initDate=initDate, initEq=initEq)
> initOrders(portfolio=portfolio1.st, initDate=initDate)
>
> # osFUN will need to know which symbol is leg 1 and which is leg 2 as well as
> # what the values are for MaxPos and lvls.  So, create a slot in portfolio to
> # hold this info.
> pair <- c(1, 2, MaxPos, lvls)
> names(pair) <- c(symb1, symb2, "MaxPos", "lvls")
> .blotter[[paste('portfolio', portfolio1.st, sep='.')]]$pair <- pair
>
> # Create initial position limits and levels by symbol
> # allow 3 entries for long and short if lvls=3.
> addPosLimit(portfolio=portfolio1.st, timestamp=initDate, symbol=symb1,
>             maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos, shortlevels=lvls)
> addPosLimit(portfolio=portfolio1.st, timestamp=initDate, symbol=symb2,
>             maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos, shortlevels=lvls)
>
> # Create a strategy object
> pairStrat <- strategy('pairStrat')
>
> # Indicator function
> calcRatio <- function(x) {
>   #returns the ratio of notional close prices for 2 symbols
>   x1 <- get(x[1])
>   x2 <- get(x[2])
>   mult1 <- getInstrument(x[1])$multiplier
>   mult2 <- getInstrument(x[2])$multiplier
>   rat <- (mult1 * Cl(x1)) / (mult2 * Cl(x2))
>   colnames(rat) <- 'Ratio'
>   rat
> }
> # Indicator used for determining entry/exits
> Ratio <- calcRatio(c(symb1[1], symb2[1]))
>
> # Store hedge ratio in portfolio so that it's available for order sizing
> # function. In this example, the hedge ratio happens to be the same as the
> # Ratio indicator.
> .blotter[[paste('portfolio',portfolio1.st,sep='.')]]$HedgeRatio <- Ratio
> #and make a function to get the most recent HedgeRatio
> getHedgeRatio <- function(portfolio, timestamp) {
>   portf <- getPortfolio(portfolio)
>   timestamp <- format(timestamp,"%Y-%m-%d %H:%M:%S")
>   # above line ensures you don't get last value of next day if using intraday
>   # data and timestamp=midnight
>   toDate <- paste("::", timestamp, sep="")
>   Ratio <- last(portf$HedgeRatio[toDate])
>   as.numeric(Ratio)
> }
>
> # Create an indicator - BBands on the Ratio
> pairStrat <- add.indicator(strategy=pairStrat, name = "calcRatio",
>                            arguments=list(x=c(symb1,symb2)))
> pairStrat <- add.indicator(strategy=pairStrat, name = "BBands",
>                            arguments=list(HLC=quote(Ratio), sd=SD, n=N,
>                                           maType='SMA'),
>                            label = "BBands")
>
> #applyIndicators(strategy=pairStrat,mktdata=get(symb1[1])) #for debugging
>
> # Create signals - buy when crossing lower band from below, sell when crossing
> # upper band from above, flatten when crossing mavg from above or from below
> pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
>                         arguments=list(columns=c("Ratio","up"),
>                                        relationship="lt"),
>                         label="cross.up")
> pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
>                         arguments=list(columns=c("Ratio","dn"),
>                                        relationship="gt"),
>                         label="cross.dn")
> pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
>                         arguments=list(columns=c("Ratio","mavg"),
>                                        relationship="lt"),
>                         label="cross.mid.fa")
> pairStrat <- add.signal(strategy=pairStrat, name="sigCrossover",
>                         arguments=list(columns=c("Ratio","mavg"),
>                                        relationship="gt"),
>                         label="cross.mid.fb")
>
> # make an order sizing function
> #######################_ORDER SIZING FUNCTION_##################################
> # check to see which stock it is. If it's the second stock, reverse orderqty and
> # orderside
> osSpreadMaxPos <- function (data, timestamp, orderqty, ordertype, orderside,
>                             portfolio, symbol, ruletype, ..., orderprice) {
>   portf <- getPortfolio(portfolio)
>   #check to make sure pair slot has the things needed for this function
>   if (!any(portf$pair == 1) && !(any(portf$pair == 2)))
>     stop('pair must contain both values 1 and 2')
>   if (!any(names(portf$pair) == "MaxPos") || !any(names(portf$pair) == "lvls"))
>     stop('pair must contain MaxPos and lvls')
>
>   if (portf$pair[symbol] == 1) legside <- "long"
>   if (portf$pair[symbol] == 2) legside <- "short"
>   MaxPos <- portf$pair["MaxPos"]
>   lvls <- portf$pair["lvls"]
>   ratio <- getHedgeRatio(portfolio, timestamp)
>   pos <- getPosQty(portfolio, symbol, timestamp)
>   PosLimit <- getPosLimit(portfolio, symbol, timestamp)
>   qty <- orderqty
>   if (legside == "short") {#symbol is 2nd leg
>     ## Comment out next line to use equal ordersizes for each stock.
>     addPosLimit(portfolio=portfolio, timestamp=timestamp, symbol=symbol,
>                 maxpos=round(MaxPos*ratio,0), longlevels=lvls,
>                 minpos=round(-MaxPos*ratio,0), shortlevels=lvls)
>     ##
>     qty <- -orderqty #switch orderqty for Stock B
>   }
>
>   if (qty > 0) orderside = 'long'
>   if (qty < 0) orderside = 'short'
>
>   orderqty <- osMaxPos(data=data,timestamp=timestamp, orderqty=qty,
>                        ordertype=ordertype, orderside=orderside,
>                        portfolio=portfolio, symbol=symbol, ruletype=ruletype,
>                        ...)
>
>   #Add the order here instead of in the ruleSignal function
>   if (!is.null(orderqty) & !orderqty == 0 & !is.null(orderprice)) {
>     addOrder(portfolio=portfolio, symbol=symbol,
>              timestamp=timestamp, qty=orderqty, price=as.numeric(orderprice),
>              ordertype=ordertype, side=orderside, replace=FALSE,
>              status="open", ...=...)
>   }
>   return(0) #so that ruleSignal function doesn't also try to place an order
> }
> ################################################################################
>
> # Create entry and exit rules for longs  and for shorts. Both symbols will get
> # the same buy/sell signals, but osMaxPos will reverse those for the second
> # symbol.
> # orderqty's are bigger than PosLimits allow. osMaxPos will adjust the orderqty
> # down to 1/3 the max allowed. (1/3 is because we are using 3 levels in
> # PosLimit)
> pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
>                       arguments=list(sigcol="cross.dn", sigval=TRUE,
>                                      orderqty=1e6, ordertype='market',
>                                      orderside=NULL, osFUN='osSpreadMaxPos'),
>                       type='enter')
> pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
>                       arguments=list(sigcol="cross.up", sigval=TRUE,
>                                      orderqty=-1e6, ordertype='market',
>                                      orderside=NULL, osFUN='osSpreadMaxPos'),
>                       type='enter')
> pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
>                       arguments=list(sigcol="cross.mid.fb", sigval=TRUE,
>                                      orderqty='all', ordertype='market',
>                                      orderside=NULL),
>                       type='exit')
> pairStrat <- add.rule(strategy=pairStrat, name='ruleSignal',
>                       arguments=list(sigcol="cross.mid.fa", sigval=TRUE,
>                                      orderqty='all', ordertype='market',
>                                      orderside=NULL),
>                       type='exit')
>
>
> ## for debugging
> # applySignals(strategy=pairStrat,
> #              mktdata=applyIndicators(strategy=pairStrat, mktdata=get(symb1)))
> ##
>
> out1<-applyStrategy(strategy=pairStrat, portfolios=portfolio1.st)
>
> updatePortf(Portfolio=portfolio1.st,
>             Dates=paste("::", as.Date(Sys.time()), sep=''))
> updateAcct(account.st, Dates=paste(startDate, endDate, sep="::"))
> updateEndEq(account.st, Dates=paste(startDate, endDate, sep="::"))
> getEndEq(account.st, Sys.time())
>
> dev.new()
> chart.Posn(Portfolio=portfolio1.st, Symbol=symb1)
> dev.new()
> chart.Posn(Portfolio=portfolio1.st, Symbol=symb2)
> dev.new()
> chartSeries(Cl(get(symb1))/Cl(get(symb2)), TA="addBBands(n=N,sd=SD)")
>
> ret1 <- PortfReturns(account.st)
> ret1$total <- rowSums(ret1)
> #ret1
>
> if("package:PerformanceAnalytics" %in% search() ||
>      require("PerformanceAnalytics",quietly=TRUE)) {
>   #  getSymbols("SPY", from='1999-01-01')
>   #  SPY.ret <- Return.calculate(SPY$SPY.Close)
>   #  tmp <- merge(SPY.ret,ret1$total,all=FALSE)
>   dev.new()
>   charts.PerformanceSummary(ret1$total, geometric=FALSE, wealth.index=TRUE)
> }
>
>
> ###############################################################################
> # R (http://r-project.org/) Quantitative Strategy Model Framework
> #
> # Package Copyright (c) 2009-2012
> # Peter Carl, Dirk Eddelbuettel, Brian G. Peterson, Jeffrey Ryan, and
> Joshua Ulrich
> #
> # This library is distributed under the terms of the GNU Public License (GPL)
> # for full details see the file COPYING
> #
> # $Id$
> #
> ###############################################################################
>
> ##### PLACE THIS BLOCK AT END OF DEMO SCRIPT ###################
> # book  = getOrderBook(port)
> # stats = tradeStats(port)
> # rets  = PortfReturns(acct)
> ################################################################
>
> #Distribution Initialization
> pairStrat <- add.distribution(strategy = pairStrat,
>                  paramset.label ="BBOPT",
>                  component.type = "indicator",
>                  component.label = "BBands",
>                  variable = list(n = seq(10,200, by = 10)),
>                  label = "n")
>
> pairStrat <- add.distribution(strategy = pairStrat,
>                  paramset.label ="BBOPT",
>                  component.type = "indicator",
>                  component.label = "BBands",
>                  variable = list(sd = seq(1,5,by = 0.5)),
>                  label = "sd")
>
>
> # Objective Function
> my.obj.func <- function(x)
> {
>   # pick one of the following objective functions (uncomment)
>
>   #return(max(x$tradeStats$Max.Drawdown) == x$tradeStats$Max.Drawdown)
>
>   return(max(x$tradeStats$Net.Trading.PL) == x$tradeStats$Net.Trading.PL)
>
> }
>
> #WFA - Comment out selected method
> # require(doParallel)
> # cl <- makePSOCKcluster(2)
> # registerDoParallel(cl)
> #
> # require(doRedis)
> # registerDoRedis('jobs')
> # startLocalWorkers(n=2, queue='jobs')
> # print(getDoParWorkers())
>
> registerDoSEQ()
>
> result <- walk.forward(pairStrat,
>                        paramset.label = "BBOPT",
>                        portfolio.st = portfolio1.st,
>                        account.st = account.st,
>                        period = "months",
>                        k.training = 6,
>                        k.testing = 3,
>                        obj.func = my.obj.func,
>                        obj.args = list(x=quote(result$apply.paramset)),
>                        audit.prefix = "wfa",
>                        anchored = FALSE,
>                        verbose = TRUE)
>
>
>
>
>
>
>
> I
>
>
> On Tue, Sep 30, 2014 at 10:34 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>>  Tue, Sep 30, 2014 at 10:25 AM, Derek Wong <treydog999 at gmail.com> wrote:
>>> Mark,
>>>
>>> Thank you for the reply. I really appreciate you taking the time to look at
>>> it. However in my previous email/post and my current code I do not see a
>>> line that shows
>>>
>>> portfolio1.st <- 'pair1'account.st <- 'pairs'
>>>
>> You're posting in HTML, which the posting guild tells you not to do.
>> The list server must convert your HTML into plain text, which often
>> mangles your original message.  For example, look at how your message
>> was received at Nabble:
>> http://r.789695.n4.nabble.com/quantstrat-help-simple-combine-error-using-windows-and-walk-forward-td4697468.html
>>
>>> they should be two separate lines. Either way I have run the entire code
>>> and will show the area I am focusing on. Which is the end using the
>>> walk.forward() function, as everything else in the code runs perfectly for
>>> me using R 3.1.1 in windows or ubuntu.
>>>
>> As I said in our personal correspondence, "the problem is that the
>> calcRatio function is not being exported to the nodes.  This is
>> probably related to bug #5814
>> (https://r-forge.r-project.org/tracker/index.php?func=detail&aid=5814&group_id=316&atid=1269)."
>>
>> This is going to be a problem with a socket cluster on any operating
>> system.  It will work if you don't run in parallel, or if you run on
>> almost anything other than a socket cluster (e.g. redis, fork
>> [multicore], etc).
>>
>> Best,
>> Josh
>>
>>
>>> Code I am focusing on:
>>>
>>> # Objective Function
>>> my.obj.func <- function(x)
>>> {
>>>   # pick one of the following objective functions (uncomment)
>>>
>>>   #return(max(x$tradeStats$Max.Drawdown) == x$tradeStats$Max.Drawdown)
>>>
>>>   return(max(x$tradeStats$Net.Trading.PL) == x$tradeStats$Net.Trading.PL)
>>>
>>> }
>>>
>>> #WFA
>>> require(doParallel)
>>> cl <- makePSOCKcluster(2)
>>> registerDoParallel(cl)
>>>
>>> result <- walk.forward(pairStrat,
>>>                        paramset.label = "BBOPT",
>>>                        portfolio.st = portfolio1.st,
>>>                        account.st = account.st,
>>>                        period = "months",
>>>                        k.training = 6,
>>>                        k.testing = 3,
>>>                        obj.func = my.obj.func,
>>>                        obj.args = list(x=quote(result$apply.paramset)),
>>>                        audit.prefix = "wfa",
>>>                        anchored = FALSE,
>>>                        verbose = TRUE)
>>>
>>>
>>> Output below:
>>>> # Objective Function
>>>> my.obj.func <- function(x)
>>> + {
>>> +   # pick one of the following objective functions (uncomment)
>>> +
>>> +   #return(max(x$tradeStats$Max.Drawdown) == x$tradeStats$Max.Drawdown)
>>> +
>>> +   return(max(x$tradeStats$Net.Trading.PL) == x$tradeStats$Net.Trading.PL)
>>> +
>>> + }
>>>>
>>>> #WFA
>>>> require(doParallel)
>>>> cl <- makePSOCKcluster(2)
>>>> registerDoParallel(cl)
>>>>
>>>> result <- walk.forward(pairStrat,
>>> +                        paramset.label = "BBOPT",
>>> +                        portfolio.st = portfolio1.st,
>>> +                        account.st = account.st,
>>> +                        period = "months",
>>> +                        k.training = 6,
>>> +                        k.testing = 3,
>>> +                        obj.func = my.obj.func,
>>> +                        obj.args = list(x=quote(result$apply.paramset)),
>>> +                        audit.prefix = "wfa",
>>> +                        anchored = FALSE,
>>> +                        verbose = TRUE)
>>> [1] "=== training BBOPT on 2009-01-02/2009-06-30"
>>> automatically exporting the following variables from the local environment:
>>>   account, account.st, calc, env.instrument, mktdata, orderbook,
>>> paramset.label, portfolio, portfolio.st, strategy, user.args, user.func
>>> explicitly exporting variables(s): clone.portfolio, clone.orderbook,
>>> install.param.combo
>>> numValues: 180, numResults: 0, stopped: TRUE
>>> got results for task 1
>>> numValues: 180, numResults: 1, stopped: TRUE
>>> returning status FALSE
>>> got results for task 2
>>> <SNIP>
>>> got results for task 180
>>> numValues: 180, numResults: 180, stopped: TRUE
>>> first call to combine function
>>> evaluating call object to combine results:
>>>   fun(result.1, result.2, result.3, result.4, result.5, result.6,
>>>    <SNIP>
>>>     result.177, result.178, result.179, result.180)
>>> error calling combine function:
>>> <simpleError in fun(result.1, result.2, result.3, result.4, result.5,
>>> result.6,     result.7, result.8, result.9, result.10, result.11,
>>> result.12,     result.13, result.14, result.15, result.16, result.17,
>>> result.18,     result.19, result.20, result.21, result.22,
>>> <SNIP>
>>> result.171,     result.172, result.173, result.174, result.175, result.176,
>>>     result.177, result.178, result.179, result.180): attempt to select less
>>> than one element>
>>> Error in walk.forward(pairStrat, paramset.label = "BBOPT", portfolio.st =
>>> portfolio1.st,  :
>>>   obj.func() returned empty result
>>> In addition: Warning messages:
>>> 1: In e$fun(obj, substitute(ex), parent.frame(), e$data) :
>>>   already exporting variable(s): env.instrument
>>> 2: In max(x$tradeStats$Net.Trading.PL) :
>>>   no non-missing arguments to max; returning -Inf
>>>
>>>
>>>
>>> Thanks again
>>>
>>> Derek
>>>
>>> On Tue, Sep 30, 2014 at 8:20 AM, Mark Knecht <markknecht at gmail.com> wrote:
>>>
>>>> On Tue, Sep 30, 2014 at 12:34 AM, Derek Wong <treydog999 at gmail.com> wrote:
>>>> > Hello,
>>>> >
>>>> > I have been able to reproduce this error in Ubuntu based system as well
>>>> not
>>>> > just on windows. I was wondering if anyone had any insights or ways to to
>>>> > solve this or create a work around.  If there is any additional
>>>> information
>>>> > you require let me know. Please I would really appreciate help on this.
>>>> It
>>>> > is totally out of my depth and I am hoping that this fine community can
>>>> > help.
>>>> >
>>>>
>>>> Derek,
>>>>    I have no time to do any debugging of this but the first error on my
>>>> Gentoo system running RStudio and R-3.1.1 is actually this line:
>>>>
>>>> portfolio1.st <- 'pair1'account.st <- 'pairs'
>>>>
>>>> which does look like bad code to me.
>>>>
>>>>    One 'problem' with a number of demos that are out there is that the demo
>>>> author may be using the development version of a specific package which
>>>> then results in end user types (like me) having problems.
>>>>
>>>>    I suggest you run this code line-by-line and then post back a few lines
>>>> preceding the breakdown. Maybe someone can give better input than
>>>> I can. Also, please edit/snip your responses to add focus to the exact
>>>> issue.
>>>>
>>>> Good luck,
>>>> Mark
>>>>
>>>> > On Wed, Sep 24, 2014 at 9:36 PM, Derek Wong <treydog999 at gmail.com>
>>>> wrote:
>>>> >
>>>> >> Hello,
>>>> >>
>>>> >> I am having a lot of trouble with using walk.forward.in windows. i get
>>>> >> the following error. This may be related to bug #5814. If someone could
>>>> >> please help me i would really appreciate it. The reproducible code
>>>> below is
>>>> >> based on the pair_trade example. Thanks.
>>>> >>
>>>> >> error calling combine function:
>>>> >> <simpleError in fun(result.1, result.2, result.3, result.4, result.5,
>>>> >> result.6,     result.7, result.8, result.9, result.10, result.11,
>>>> <SNIP>
>>>> >> result.172, result.173, result.174, result.175, result.176,
>>>>  result.177,
>>>> >> result.178, result.179, result.180): attempt to select less than one
>>>> >> element>
>>>> >> Error in walk.forward(pairStrat, paramset.label = "BBOPT", portfolio.st
>>>> =
>>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions should go.
>>
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com


From mcewan.gareth at gmail.com  Wed Oct 22 15:46:31 2014
From: mcewan.gareth at gmail.com (Gareth McEwan)
Date: Wed, 22 Oct 2014 15:46:31 +0200
Subject: [R-SIG-Finance] (no subject)
Message-ID: <CALGfFMZVEcPnfFQEbV69sUUWJppxZvqpwsLJPv1kaYnkokgcMA@mail.gmail.com>

Hi all

I need to transform standardized GARCH residuals to uniform variates by a
marginal semi-parametric empirical CDF.

For a set of 242 standardized residuals (sorted.ALBI.std.resids), I have
cut off 10% at the upper tail and 10% at the lower tail (by theory and
testing, these thresholds are valid).

I have a set of 24 (positive) values for the lower tail (by multiplying by
-1), a set of 24 values for the upper tail, and 194 values for the interior
(kernel) of the distribution.

These values correspond to a choice of threshold at
quantile(neg.sorted.ALBI.resids,0.90)  for the lower tail #equals 1.213646

and

quantile(sorted.ALBI.std.resids,0.90) for the upper tail #equals  1.218522.

I used the "evir", "ismev", and "fExtremes" packages to fit and
double-check estimates and they are all extremely close.

Output:

For lower tail:
gpdfit.mle.ALBI =
gpdFit(neg.tail.ALBI.resids,u=quantile(neg.sorted.ALBI.resids,0.90),type="mle")
summary(gpdfit.mle.ALBI)
#       xi (shape)           beta (scale)        LLH Value
#       0.1051834          0.7098641          18.30353
#SE: 0.2443332    SE: 0.2254843

For upper tail:
gpdfit.mle.ALBI =
gpdFit(pos.tail.ALBI.resids,u=quantile(sorted.ALBI.std.resids,0.90),type="mle")
summary(gpdfit.mle.ALBI) # Maximum likelihood parameter estimation method
#        xi (shape)            beta (scale)       LLH Value
#       -0.1996078           0.4973661         2.447625
#SE:   0.2571947    SE: 0.1620495

For interior:
fit.interior.ALBI.std.resids =
density(kernel.ALBI.std.resids,bw="nrd0",adjust=1,kernel="gaussian")

The question I'd like to ask is: how do I now combine the non-parametric
interior with the estimated tails to get a CDF function? It is this
semi-parametric CDF function that I need to use to transform the
standardized residuals to uniform variates.

Thank you very much for the help (files are attached for reproducibility).

Best regards
Gareth

P.S.  I would prefer to use the above framework, if possible. However, I
did use the following, but got conflicting output for the threshold and
tail estimates:
spd.fit.ALBI=spdfit(sorted.ALBI.std.resids, upper=0.9, lower=0.1,
tailfit="GPD", type="mle", kernelfit="normal", information="observed")
show(spd.fit.ALBI)
# Upper Tail: Threshold = 1.22226 (compared to 1.218522 using quantile
function)
# Estimated Parameters
#     xi           beta
#   -0.18608   0.48698
# Lower Tail: Threshold = -1.22126 (compared to -1.213646 using quantile
function on sorted.ALBI.std.resids)
# Estimated Parameters
#     xi           beta
#    0.06574   0.76526
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/2c024de5/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kernel_ALBI_std_resids.csv
Type: text/csv
Size: 4836 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/2c024de5/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sorted_ALBI_std_resids.csv
Type: text/csv
Size: 6010 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/2c024de5/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: neg_tail_ALBI_std_resids.csv
Type: text/csv
Size: 549 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/2c024de5/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pos_tail_ALBI_std_resids.csv
Type: text/csv
Size: 549 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/2c024de5/attachment-0003.bin>

From mcewan.gareth at gmail.com  Wed Oct 22 16:01:13 2014
From: mcewan.gareth at gmail.com (Gareth McEwan)
Date: Wed, 22 Oct 2014 16:01:13 +0200
Subject: [R-SIG-Finance] Combining a kernel density interior + GPD tailed CDF
Message-ID: <CALGfFMai80N5b7bagp2rnmjYRVG1GaeWqtUzem+QWJUJpOgY-g@mail.gmail.com>

Hi all

Sorry for the double post, I needed to add a heading..

I need to transform standardized GARCH residuals to uniform variates by a
marginal semi-parametric empirical CDF.

For a set of 242 standardized residuals (sorted.ALBI.std.resids), I have
cut off 10% at the upper tail and 10% at the lower tail (by theory and
testing, these thresholds are valid).

I have a set of 24 (positive) values for the lower tail (by multiplying by
-1), a set of 24 values for the upper tail, and 194 values for the interior
(kernel) of the distribution.

These values correspond to a choice of threshold at
quantile(neg.sorted.ALBI.resids,0.90)  for the lower tail #equals 1.213646

and

quantile(sorted.ALBI.std.resids,0.90) for the upper tail #equals  1.218522.

I used the "evir", "ismev", and "fExtremes" packages to fit and
double-check estimates and they are all extremely close.

Output:

For lower tail:
gpdfit.mle.ALBI =
gpdFit(neg.tail.ALBI.resids,u=quantile(neg.sorted.ALBI.resids,0.90),type="mle")
summary(gpdfit.mle.ALBI)
#       xi (shape)           beta (scale)        LLH Value
#       0.1051834          0.7098641          18.30353
#SE: 0.2443332    SE: 0.2254843

For upper tail:
gpdfit.mle.ALBI =
gpdFit(pos.tail.ALBI.resids,u=quantile(sorted.ALBI.std.resids,0.90),type="mle")
summary(gpdfit.mle.ALBI) # Maximum likelihood parameter estimation method
#        xi (shape)            beta (scale)       LLH Value
#       -0.1996078           0.4973661         2.447625
#SE:   0.2571947    SE: 0.1620495

For interior:
fit.interior.ALBI.std.resids =
density(kernel.ALBI.std.resids,bw="nrd0",adjust=1,kernel="gaussian")

The question I'd like to ask is: how do I now combine the non-parametric
interior with the estimated tails to get a CDF function? It is this
semi-parametric CDF function that I need to use to transform the
standardized residuals to uniform variates.

Thank you very much for the help (files are attached for reproducibility).

Best regards
Gareth

P.S.  I would prefer to use the above framework, if possible. However, I
did use the following, but got conflicting output for the threshold and
tail estimates:
spd.fit.ALBI=spdfit(sorted.ALBI.std.resids, upper=0.9, lower=0.1,
tailfit="GPD", type="mle", kernelfit="normal", information="observed")
show(spd.fit.ALBI)
# Upper Tail: Threshold = 1.22226 (compared to 1.218522 using quantile
function)
# Estimated Parameters
#     xi           beta
#   -0.18608   0.48698
# Lower Tail: Threshold = -1.22126 (compared to -1.213646 using quantile
function on sorted.ALBI.std.resids)
# Estimated Parameters
#     xi           beta
#    0.06574   0.76526
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/253c2c53/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kernel_ALBI_std_resids.csv
Type: text/csv
Size: 4836 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/253c2c53/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: neg_tail_ALBI_std_resids.csv
Type: text/csv
Size: 549 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/253c2c53/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pos_tail_ALBI_std_resids.csv
Type: text/csv
Size: 549 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/253c2c53/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sorted_ALBI_std_resids.csv
Type: text/csv
Size: 6010 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141022/253c2c53/attachment-0003.bin>

From adarshpl7 at gmail.com  Sat Oct 25 17:09:05 2014
From: adarshpl7 at gmail.com (adarsh paul)
Date: Sat, 25 Oct 2014 20:39:05 +0530
Subject: [R-SIG-Finance] Need help to find an R-code
Message-ID: <CAD8M0rPvkmjhzKiyCx-o-p7odVOOSMuxroz6ChUYehOu=Jy=Lg@mail.gmail.com>

Hello everyone, I'm an undergraduate student working on my thesis. I need
help with finding an R-code to estimate the parameters in an ARMA(p,q)
model, where p>10,q>10. Any help would be greatly appreciated.

-- 
Best Regards,

Adarsh

?Sen
ior  Undergraduate student,
Department of Mining
? & Financial?
Engineering,
Indian Institute of Technology,
Kharagpur,India.
+91-9126140440.

	[[alternative HTML version deleted]]


From debasishmaitra at gmail.com  Sat Oct 25 18:00:56 2014
From: debasishmaitra at gmail.com (DEBASISH MAITRA)
Date: Sat, 25 Oct 2014 21:30:56 +0530
Subject: [R-SIG-Finance] Package for BEKK Multivariate GARCH
Message-ID: <CA+=JsgTb+S2D5r0K28vWgGCuPh_epqeo7KpG4hFH5fTKdNX8PA@mail.gmail.com>

I am Debasish Maitra from Institute of Management Technology (IMT) , India.
I am looking for multivariate GARCH package for R. I have also downloaded
one package (mgarchBEKK_0.07-8) but it is not running on R
(warning-NAMESPACE is missing). The package for mgarch (or BEKK) is also
not available on R-cran.

It would be of great help if you kindly send me the package which would
help in my research projects.



Thanking you,

With regards,

Debasish Maitra

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Sat Oct 25 19:10:34 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 25 Oct 2014 12:10:34 -0500
Subject: [R-SIG-Finance] Need help to find an R-code
In-Reply-To: <CAD8M0rPvkmjhzKiyCx-o-p7odVOOSMuxroz6ChUYehOu=Jy=Lg@mail.gmail.com>
References: <CAD8M0rPvkmjhzKiyCx-o-p7odVOOSMuxroz6ChUYehOu=Jy=Lg@mail.gmail.com>
Message-ID: <CAPPM_gTEgnug=vyQEFw_7Ltrhk+GOuVT_NgdWdBUk8YZzG6zmw@mail.gmail.com>

On Sat, Oct 25, 2014 at 10:09 AM, adarsh paul <adarshpl7 at gmail.com> wrote:
> Hello everyone, I'm an undergraduate student working on my thesis. I need
> help with finding an R-code to estimate the parameters in an ARMA(p,q)
> model, where p>10,q>10. Any help would be greatly appreciated.
>
What have you found that wasn't adequate?  There are many suggestions
in the TimeSeries Task View:
http://cran.r-project.org/web/views/TimeSeries.html

> --
> Best Regards,
>
> Adarsh
>
> Sen
> ior  Undergraduate student,
> Department of Mining
> & Financial
> Engineering,
> Indian Institute of Technology,
> Kharagpur,India.
> +91-9126140440.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.

--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From a.chandhial at btinternet.com  Mon Oct 27 10:20:44 2014
From: a.chandhial at btinternet.com (amarjit chandhial)
Date: Mon, 27 Oct 2014 09:20:44 +0000 (GMT)
Subject: [R-SIG-Finance] Plotting live charts with Yahoo Finance data and
	ggplot2 in R
Message-ID: <11119741.7769.1414401644860.JavaMail.defaultUser@defaultHost>

For those interested, I saw following blog 
http://active-analytics.com/blog/plottinglivechartswithyahoofinancedataandggplot2inr/
which has an example of plotting live charts.
Regards,
Amarjit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141027/31468ca0/attachment.html>

From josh.m.ulrich at gmail.com  Wed Oct 29 12:56:00 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 29 Oct 2014 06:56:00 -0500
Subject: [R-SIG-Finance] 'Defaults' removed from CRAN? (2014-10-03)
In-Reply-To: <CAK2H+ecr2WHrBj6V1bY-0noCZGQpCUQewtoiRnQweHv7hHAhgQ@mail.gmail.com>
References: <CAPLrYER8c=TwHYmM8BHt+O=mMJAJfxum=MCFS=Nf12T=A8wwWg@mail.gmail.com>
	<54344FCC.8080700@braverock.com>
	<CAPPM_gQvn13k4Kee3q39wxRGZTT1CAQuYtNvJ2FJQ71=DTuEnA@mail.gmail.com>
	<CAK2H+efotBLF7iaftKeLTGw=OXuKnfe__QPtpcBA=feOCwshrw@mail.gmail.com>
	<CA+xi=qY0D2gS2t8r6YL3eWSq9HdCecAkjtpRfxDeoqHR=0RprQ@mail.gmail.com>
	<CAK2H+ecr2WHrBj6V1bY-0noCZGQpCUQewtoiRnQweHv7hHAhgQ@mail.gmail.com>
Message-ID: <CAPPM_gRoUK+QoOvESTZSSEdXy1mCqHtYmYszJBXJB4=tQ7DQkA@mail.gmail.com>

On Wed, Oct 8, 2014 at 12:19 PM, Mark Knecht <markknecht at gmail.com> wrote:
> On Wed, Oct 8, 2014 at 9:56 AM, G See <gsee000 at gmail.com> wrote:
>> Out of curiosity, did you try _not_ changing your current code, but
>> instead adding library(Defaults) to the top of the script?  It's not
>> ideal, but Defaults _is_ still available
>> (http://cran.r-project.org/src/contrib/Archive/Defaults/).  That could
>> buy you some time until you come up with something better.
>>
>> Just a (possibly bad) thought.
>> Garrett
>>
>
> I did not but for whatever reason it didn't seem to work for me. SetDefaults is
> apparently found and the defaults are in therebut getSymbols.MySQL didn't
> apparently pick up. SPY is not returned, QQQ is when I pass the info
> in explicitly.
> I'm probably doing something stupid...
>
My guess is that you're using the "new" version of quantmod that does
not depend on Defaults.  Make sure you're using quantmod_0.4.0 with
Defaults.

> - Mark
>
<snip code>

--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From josh.m.ulrich at gmail.com  Wed Oct 29 13:25:55 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 29 Oct 2014 07:25:55 -0500
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
Message-ID: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>

As many of you know, the Defaults package was removed from CRAN on
2014-10-03 at Jeff's request.  This broke a fair bit of functionality
in quantmod, most of which I have addressed in recent commits on
R-Forge.

One issue I have not resolved is how to adapt getSymbols.MySQL to the
new no-Defaults paradigm.  I will be taking over as maintainer of
quantmod, so I am soliciting input from getSymbols.MySQL users.

My proposed solution to getSymbols.MySQL is to look for specific
option()s if certain arguments are missing.  I think this is the
cleanest and most obvious solution, but am open to alternatives.  I
would use the option structure below, with only the three arguments
listed.

options(quantmod.defaults = list(
  getSymbols.MySQL = list(
    user="josh",
    password="secret",
    dbname="stocks")
  )
)

Should I consider another option structure?  Should additional
arguments be supported?  Anything else I'm missing?

Thanks,
-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From gsee000 at gmail.com  Wed Oct 29 13:52:59 2014
From: gsee000 at gmail.com (G See)
Date: Wed, 29 Oct 2014 07:52:59 -0500
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
Message-ID: <CA+xi=qas321Ay_Hwf3gf9zc=y422Rc=102mLsetGZocD-N6yAg@mail.gmail.com>

Hi Josh,

As you probably noticed, I updated getSymbols.FI() to use options a
couple weeks ago, but instead of using a single option that is a list,
I made a separate option for each function argument.  This allows two
things:  1) you can have different default values set for the "from"
argument (for example) of different getSymbols.*() methods. 2) It
doesn't change the old defaults.  i.e. getOption("someOption",
"2014-01-01") will return the value of the option if it is set, or
"2014-01-01" if not.

With your list structure, the default value has to be determined
inside the function, I suppose.

Here's the formal argument list for getSymbols.FI

> args(getSymbols.FI)
function (Symbols, from = getOption("getSymbols.FI.from", "2010-01-01"),
    to = getOption("getSymbols.FI.to", Sys.Date()), ..., dir =
getOption("getSymbols.FI.dir",
        ""), return.class = getOption("getSymbols.FI.return.class",
        "xts"), extension = getOption("getSymbols.FI.extension",
        "rda"), split_method = getOption("getSymbols.FI.split_method",
        c("days", "common")), use_identifier =
getOption("getSymbols.FI.use_identifier",
        NA), date_format = getOption("getSymbols.FI.date_format"),
    verbose = getOption("getSymbols.FI.verbose", TRUE), days_to_omit =
getOption("getSymbols.FI.days_to_omit",
        c("Saturday", "Sunday")), indexTZ = getOption("getSymbols.FI.indexTZ",
        NA))


Garrett

On Wed, Oct 29, 2014 at 7:25 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> As many of you know, the Defaults package was removed from CRAN on
> 2014-10-03 at Jeff's request.  This broke a fair bit of functionality
> in quantmod, most of which I have addressed in recent commits on
> R-Forge.
>
> One issue I have not resolved is how to adapt getSymbols.MySQL to the
> new no-Defaults paradigm.  I will be taking over as maintainer of
> quantmod, so I am soliciting input from getSymbols.MySQL users.
>
> My proposed solution to getSymbols.MySQL is to look for specific
> option()s if certain arguments are missing.  I think this is the
> cleanest and most obvious solution, but am open to alternatives.  I
> would use the option structure below, with only the three arguments
> listed.
>
> options(quantmod.defaults = list(
>   getSymbols.MySQL = list(
>     user="josh",
>     password="secret",
>     dbname="stocks")
>   )
> )
>
> Should I consider another option structure?  Should additional
> arguments be supported?  Anything else I'm missing?
>
> Thanks,
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From markknecht at gmail.com  Wed Oct 29 14:00:32 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 29 Oct 2014 06:00:32 -0700
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
Message-ID: <CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>

On Wed, Oct 29, 2014 at 5:25 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> As many of you know, the Defaults package was removed from CRAN on
> 2014-10-03 at Jeff's request.  This broke a fair bit of functionality
> in quantmod, most of which I have addressed in recent commits on
> R-Forge.
>
> One issue I have not resolved is how to adapt getSymbols.MySQL to the
> new no-Defaults paradigm.  I will be taking over as maintainer of
> quantmod, so I am soliciting input from getSymbols.MySQL users.
>
> My proposed solution to getSymbols.MySQL is to look for specific
> option()s if certain arguments are missing.  I think this is the
> cleanest and most obvious solution, but am open to alternatives.  I
> would use the option structure below, with only the three arguments
> listed.
>
> options(quantmod.defaults = list(
>   getSymbols.MySQL = list(
>     user="josh",
>     password="secret",
>     dbname="stocks")
>   )
> )
>
> Should I consider another option structure?  Should additional
> arguments be supported?  Anything else I'm missing?
>
> Thanks,
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>

Hi Josh,
   I'd lobby for adding 'host' and (I think) 'port' parameters also.
This allows you to get across the network to get the data.

   As an individual user type this is OK. Not great, but OK. I'd
probably add the code above into a file I source in most of my
programs and it would get run. Over time I'll forget where this is
though and will need to find it when I create new databases or change
passwords.

   In a more corporate setting (which isn't me these days) I'm not
sure it's very good. Standard usage (on Linux anyway, not sure about
Windows) is to have a .my.cnf file:

mark at c2RAID6 ~ $ cat .my.cnf
[client]
user = josh
password = secret
host = localhost

[beancounter]
user = josh
database = beancounter
password = secret
host = localhost

mark at c2RAID6 ~ $

If MySQL needs a password that's where it looks first. There are no
security issues with the R code this way. If I change my password in
MySQL then this is the one place I change it for all my programs (R or
otherwise) that use MySQL to work. This is how I was doing it prior to
the change with Defaults. I have no idea how much MySQL is used by
corporate R users but I suspect they'd prefer this if it's possible.

Thanks,
Mark


From zach.mayer at gmail.com  Wed Oct 29 14:38:41 2014
From: zach.mayer at gmail.com (Zachary Deane-Mayer)
Date: Wed, 29 Oct 2014 09:38:41 -0400
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
	<CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>
Message-ID: <CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>

Hi Mark,

It'd be a little cumbersome, but couldn't you also source() an R script at
the start of your session that loads the parameters from .my.cnf and passes
them to options()?

Alternatively, maybe getSymbols.MySQL could look for a cnf_file option, and
then if that is not present look for a username and password?

-Zach

On Wed, Oct 29, 2014 at 9:00 AM, Mark Knecht <markknecht at gmail.com> wrote:

> On Wed, Oct 29, 2014 at 5:25 AM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> wrote:
> > As many of you know, the Defaults package was removed from CRAN on
> > 2014-10-03 at Jeff's request.  This broke a fair bit of functionality
> > in quantmod, most of which I have addressed in recent commits on
> > R-Forge.
> >
> > One issue I have not resolved is how to adapt getSymbols.MySQL to the
> > new no-Defaults paradigm.  I will be taking over as maintainer of
> > quantmod, so I am soliciting input from getSymbols.MySQL users.
> >
> > My proposed solution to getSymbols.MySQL is to look for specific
> > option()s if certain arguments are missing.  I think this is the
> > cleanest and most obvious solution, but am open to alternatives.  I
> > would use the option structure below, with only the three arguments
> > listed.
> >
> > options(quantmod.defaults = list(
> >   getSymbols.MySQL = list(
> >     user="josh",
> >     password="secret",
> >     dbname="stocks")
> >   )
> > )
> >
> > Should I consider another option structure?  Should additional
> > arguments be supported?  Anything else I'm missing?
> >
> > Thanks,
> > --
> > Joshua Ulrich  |  about.me/joshuaulrich
> > FOSS Trading  |  www.fosstrading.com
> >
>
> Hi Josh,
>    I'd lobby for adding 'host' and (I think) 'port' parameters also.
> This allows you to get across the network to get the data.
>
>    As an individual user type this is OK. Not great, but OK. I'd
> probably add the code above into a file I source in most of my
> programs and it would get run. Over time I'll forget where this is
> though and will need to find it when I create new databases or change
> passwords.
>
>    In a more corporate setting (which isn't me these days) I'm not
> sure it's very good. Standard usage (on Linux anyway, not sure about
> Windows) is to have a .my.cnf file:
>
> mark at c2RAID6 ~ $ cat .my.cnf
> [client]
> user = josh
> password = secret
> host = localhost
>
> [beancounter]
> user = josh
> database = beancounter
> password = secret
> host = localhost
>
> mark at c2RAID6 ~ $
>
> If MySQL needs a password that's where it looks first. There are no
> security issues with the R code this way. If I change my password in
> MySQL then this is the one place I change it for all my programs (R or
> otherwise) that use MySQL to work. This is how I was doing it prior to
> the change with Defaults. I have no idea how much MySQL is used by
> corporate R users but I suspect they'd prefer this if it's possible.
>
> Thanks,
> Mark
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Wed Oct 29 15:02:11 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 29 Oct 2014 09:02:11 -0500
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
	<CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>
	<CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>
Message-ID: <CAPPM_gSGBp36+qDPes8C5u=49eNLecGBMoqZkPGaNdEpRxZOwA@mail.gmail.com>

On Wed, Oct 29, 2014 at 8:38 AM, Zachary Deane-Mayer
<zach.mayer at gmail.com> wrote:
> Hi Mark,
>
> It'd be a little cumbersome, but couldn't you also source() an R script at
> the start of your session that loads the parameters from .my.cnf and passes
> them to options()?
>
Better yet, put that in your .Rprofile.

> Alternatively, maybe getSymbols.MySQL could look for a cnf_file option, and
> then if that is not present look for a username and password?
>
As I replied to Mark, this would be new functionality and it would be
low priority for me.

> -Zach
>
> On Wed, Oct 29, 2014 at 9:00 AM, Mark Knecht <markknecht at gmail.com> wrote:
>>
>> On Wed, Oct 29, 2014 at 5:25 AM, Joshua Ulrich <josh.m.ulrich at gmail.com>
>> wrote:
>> > As many of you know, the Defaults package was removed from CRAN on
>> > 2014-10-03 at Jeff's request.  This broke a fair bit of functionality
>> > in quantmod, most of which I have addressed in recent commits on
>> > R-Forge.
>> >
>> > One issue I have not resolved is how to adapt getSymbols.MySQL to the
>> > new no-Defaults paradigm.  I will be taking over as maintainer of
>> > quantmod, so I am soliciting input from getSymbols.MySQL users.
>> >
>> > My proposed solution to getSymbols.MySQL is to look for specific
>> > option()s if certain arguments are missing.  I think this is the
>> > cleanest and most obvious solution, but am open to alternatives.  I
>> > would use the option structure below, with only the three arguments
>> > listed.
>> >
>> > options(quantmod.defaults = list(
>> >   getSymbols.MySQL = list(
>> >     user="josh",
>> >     password="secret",
>> >     dbname="stocks")
>> >   )
>> > )
>> >
>> > Should I consider another option structure?  Should additional
>> > arguments be supported?  Anything else I'm missing?
>> >
>> > Thanks,
>> > --
>> > Joshua Ulrich  |  about.me/joshuaulrich
>> > FOSS Trading  |  www.fosstrading.com
>> >
>>
>> Hi Josh,
>>    I'd lobby for adding 'host' and (I think) 'port' parameters also.
>> This allows you to get across the network to get the data.
>>
>>    As an individual user type this is OK. Not great, but OK. I'd
>> probably add the code above into a file I source in most of my
>> programs and it would get run. Over time I'll forget where this is
>> though and will need to find it when I create new databases or change
>> passwords.
>>
>>    In a more corporate setting (which isn't me these days) I'm not
>> sure it's very good. Standard usage (on Linux anyway, not sure about
>> Windows) is to have a .my.cnf file:
>>
>> mark at c2RAID6 ~ $ cat .my.cnf
>> [client]
>> user = josh
>> password = secret
>> host = localhost
>>
>> [beancounter]
>> user = josh
>> database = beancounter
>> password = secret
>> host = localhost
>>
>> mark at c2RAID6 ~ $
>>
>> If MySQL needs a password that's where it looks first. There are no
>> security issues with the R code this way. If I change my password in
>> MySQL then this is the one place I change it for all my programs (R or
>> otherwise) that use MySQL to work. This is how I was doing it prior to
>> the change with Defaults. I have no idea how much MySQL is used by
>> corporate R users but I suspect they'd prefer this if it's possible.
>>
>> Thanks,
>> Mark
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>
>


-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From markknecht at gmail.com  Wed Oct 29 15:36:37 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 29 Oct 2014 07:36:37 -0700
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
	<CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>
	<CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>
Message-ID: <CAK2H+edoXza5WGYnWEqE-Gc8b7ZJPjybBpMYjqGi5TyRM5Fy3w@mail.gmail.com>

On Wed, Oct 29, 2014 at 6:38 AM, Zachary Deane-Mayer
<zach.mayer at gmail.com> wrote:
> Hi Mark,
>
> It'd be a little cumbersome, but couldn't you also source() an R script at
> the start of your session that loads the parameters from .my.cnf and passes
> them to options()?
>
> Alternatively, maybe getSymbols.MySQL could look for a cnf_file option, and
> then if that is not present look for a username and password?
>
> -Zach

Hi Zach & Josh,
   Yes, I'm sure there's lots of ways to do this, and as an individual
user just working by myself I'll be happy for anything that works.

   That said, the nice security feature about the way it was done
before was TTBOMK the R environment never saw the MySQL username &
password. That was previously all done completely outside of R. R Asks
MySQL to get some data from a specific database. MySQL wasn't given a
username and password so it automatically accesses .my.cnf which is
secure. If it finds an entry with the right database name, then it
gets username and password from that file, gets the data from the
database and gives it back to R. If the username/password aren't there
the user can pass them explicitly (as I'm doing with this recent
change) or else he doesn't get access to that database.

   But going beyond that model consider a C++/GTK application that
links calls to R under the hood using the Rinside package. (Something
I'm just starting to play with now.) I'm in a GTK-based GUI, using C++
code that runs R functions one of which is accessing MySQL to get
price data. The results are loaded by R, indicators are calculated and
I see them in my GTK GUI. Now, I send the compiled app to a friend.
How would MySQL work in that case? Today he just puts an entry in
.my.cnf on his machine and he's good to go. (NOTE: I'm not looking for
an answer to this specific issue. In my specific case I may access
MySQL from C and pass the data to R as it appears to be a lot faster.)

   Anyway I don't think this is really a new feature. It's the
standard MySQL security model. It used to work and was broken by the
recent change to defaults. All that said I'll of course use what ever
gets supported. I'm just pointing out the issue, not trying to create
work for anyone.

Cheers,
Mark


From mcewan.gareth at gmail.com  Wed Oct 29 18:30:51 2014
From: mcewan.gareth at gmail.com (Gareth McEwan)
Date: Wed, 29 Oct 2014 19:30:51 +0200
Subject: [R-SIG-Finance] Conflicting "spd" function estimates
Message-ID: <CALGfFMZZWydtYAAYApS0GKA9_i9mM_O1kW=x17XuamH3wWbS_w@mail.gmail.com>

Hi there

I have searched high and low, but haven't found how to combine a parametric
GPD fitting of upper and lower tails to a non-parametric Gaussian kernel
interior. So I need to go with the "spd" function, but I have quite
conflicting results using this function.

spd.fit.ALBI=spdfit(sorted.ALBI.std.resids, upper=0.9, lower=0.1,
tailfit="GPD", type="mle", kernelfit="normal", information="observed")
show(spd.fit.ALBI)
Output:
# Upper Tail: Threshold = 1.22226
The above tail threshold is different to 1.218522 using the quantile
function on the same data at the same 90% cutoff point.
# Estimated Parameters
#     xi           beta
#   -0.18608   0.48698
These estimates are different to -0.1996078 and 0.4973661, respectively
(using "evir", "ismev" and "fExtremes" packages), but far more so than the
estimates below..

# Lower Tail: Threshold = -1.22126 (compared to -1.213646 using quantile
function on negative of the sorted.ALBI.std.resids, at the equivalent of a
10% cutoff point)
# Estimated Parameters
#     xi           beta
#    0.06574   0.76526
These estimates are quite different to the 0.1051834 and  0.7098641,
respectively, using the abovementioned packages.

I am aware that there are only a few data points used in the fitting, so
would this sort of discrepancy be acceptable?

I am not sure how the "spdfit" function selects the upper and lower tail
thresholds (versus the quantile function I am using from literature), but I
think the manner in which the thresholds are selected is what contributes
to the conflicting estimates. Is there a way I can improve my technique at
all? I would prefer to combine the upper tail, interior and lower tail
manually, but I would need help putting it together. The next best option
is the "spd" function, but I'd like to know if the evident discrepancies
would be acceptable?

Many thanks
Gareth

	[[alternative HTML version deleted]]


From pgilbert902 at gmail.com  Wed Oct 29 20:30:39 2014
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Wed, 29 Oct 2014 15:30:39 -0400
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAK2H+edoXza5WGYnWEqE-Gc8b7ZJPjybBpMYjqGi5TyRM5Fy3w@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>	<CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>	<CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>
	<CAK2H+edoXza5WGYnWEqE-Gc8b7ZJPjybBpMYjqGi5TyRM5Fy3w@mail.gmail.com>
Message-ID: <5451405F.6080800@gmail.com>



On 10/29/2014 10:36 AM, Mark Knecht wrote:
> On Wed, Oct 29, 2014 at 6:38 AM, Zachary Deane-Mayer
> <zach.mayer at gmail.com> wrote:
>> Hi Mark,
>>
>> It'd be a little cumbersome, but couldn't you also source() an R script at
>> the start of your session that loads the parameters from .my.cnf and passes
>> them to options()?
>>
>> Alternatively, maybe getSymbols.MySQL could look for a cnf_file option, and
>> then if that is not present look for a username and password?
>>
>> -Zach
>
> Hi Zach & Josh,
>     Yes, I'm sure there's lots of ways to do this, and as an individual
> user just working by myself I'll be happy for anything that works.
>
>     That said, the nice security feature about the way it was done
> before was TTBOMK the R environment never saw the MySQL username &
> password. That was previously all done completely outside of R. R Asks
> MySQL to get some data from a specific database. MySQL wasn't given a
> username and password so it automatically accesses .my.cnf which is
> secure. If it finds an entry with the right database name, then it
> gets username and password from that file, gets the data from the
> database and gives it back to R. If the username/password aren't there
> the user can pass them explicitly (as I'm doing with this recent
> change) or else he doesn't get access to that database.

Not being a user of the packages under discussion, other than RMySql 
(and assuming it is RMySQL you are talking about underneath), I am a bit 
confused about why you think this has been broken by changes to 
defaults? If anything, it seems to depend on R not doing anything, and 
letting the driver handle it. I still use this approach in my own 
packages that use RMySQL. I think it is the default if 
host/user/password are not explicitly specified in another way. I also 
believe it is generally considered the most secure approach because 
sensitive information is not left sitting around in more viewable 
places. Am I missing something (as usual)?

Paul

>
>     But going beyond that model consider a C++/GTK application that
> links calls to R under the hood using the Rinside package. (Something
> I'm just starting to play with now.) I'm in a GTK-based GUI, using C++
> code that runs R functions one of which is accessing MySQL to get
> price data. The results are loaded by R, indicators are calculated and
> I see them in my GTK GUI. Now, I send the compiled app to a friend.
> How would MySQL work in that case? Today he just puts an entry in
> .my.cnf on his machine and he's good to go. (NOTE: I'm not looking for
> an answer to this specific issue. In my specific case I may access
> MySQL from C and pass the data to R as it appears to be a lot faster.)
>
>     Anyway I don't think this is really a new feature. It's the
> standard MySQL security model. It used to work and was broken by the
> recent change to defaults. All that said I'll of course use what ever
> gets supported. I'm just pointing out the issue, not trying to create
> work for anyone.
>
> Cheers,
> Mark
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From alexios at 4dscape.com  Wed Oct 29 20:48:17 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Wed, 29 Oct 2014 19:48:17 +0000
Subject: [R-SIG-Finance] Conflicting "spd" function estimates
In-Reply-To: <CALGfFMZZWydtYAAYApS0GKA9_i9mM_O1kW=x17XuamH3wWbS_w@mail.gmail.com>
References: <CALGfFMZZWydtYAAYApS0GKA9_i9mM_O1kW=x17XuamH3wWbS_w@mail.gmail.com>
Message-ID: <54514481.4060507@4dscape.com>

On 29/10/2014 17:30, Gareth McEwan wrote:
> Hi there
>
> I have searched high and low, but haven't found how to combine a parametric
> GPD fitting of upper and lower tails to a non-parametric Gaussian kernel
> interior. So I need to go with the "spd" function, but I have quite
> conflicting results using this function.

I can't honestly believe that you've searched "high and low". The point 
of using open source software is that the code is readily available. Did 
you look in the spd package to see how the estimation and related 
functions work?

>
> spd.fit.ALBI=spdfit(sorted.ALBI.std.resids, upper=0.9, lower=0.1,
> tailfit="GPD", type="mle", kernelfit="normal", information="observed")
> show(spd.fit.ALBI)
> Output:
> # Upper Tail: Threshold = 1.22226
> The above tail threshold is different to 1.218522 using the quantile
> function on the same data at the same 90% cutoff point.
> # Estimated Parameters
> #     xi           beta
> #   -0.18608   0.48698
> These estimates are different to -0.1996078 and 0.4973661, respectively
> (using "evir", "ismev" and "fExtremes" packages), but far more so than the
> estimates below..
>
> # Lower Tail: Threshold = -1.22126 (compared to -1.213646 using quantile
> function on negative of the sorted.ALBI.std.resids, at the equivalent of a
> 10% cutoff point)
> # Estimated Parameters
> #     xi           beta
> #    0.06574   0.76526
> These estimates are quite different to the 0.1051834 and  0.7098641,
> respectively, using the abovementioned packages.
>
> I am aware that there are only a few data points used in the fitting, so
> would this sort of discrepancy be acceptable?
>
> I am not sure how the "spdfit" function selects the upper and lower tail
> thresholds (versus the quantile function I am using from literature), but I
> think the manner in which the thresholds are selected is what contributes
> to the conflicting estimates. Is there a way I can improve my technique at
> all? I would prefer to combine the upper tail, interior and lower tail
> manually, but I would need help putting it together. The next best option
> is the "spd" function, but I'd like to know if the evident discrepancies
> would be acceptable?

If you read the documentation on "quantile", you'll likely see 9 
different methods for calculating this. Whether the small discrepancy 
you detected on a small dataset is acceptable is up to you to decide. 
The spd package has a simulation function, as does the gdp distribution 
from the fExtremes package so you can do your own simulations and decide 
whether this is within acceptable tolerance.

>
> Many thanks
> Gareth
>

Regards,

Alexios


From markknecht at gmail.com  Wed Oct 29 21:18:06 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 29 Oct 2014 13:18:06 -0700
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <5451405F.6080800@gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
	<CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>
	<CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>
	<CAK2H+edoXza5WGYnWEqE-Gc8b7ZJPjybBpMYjqGi5TyRM5Fy3w@mail.gmail.com>
	<5451405F.6080800@gmail.com>
Message-ID: <CAK2H+efFEkTNiLkBSfhfZwG=TyOM9bocmN9RyEwrC3yzds0kvA@mail.gmail.com>

On Wed, Oct 29, 2014 at 12:30 PM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
>
>
> On 10/29/2014 10:36 AM, Mark Knecht wrote:
>>
>> On Wed, Oct 29, 2014 at 6:38 AM, Zachary Deane-Mayer
>> <zach.mayer at gmail.com> wrote:
>>>
>>> Hi Mark,
>>>
>>> It'd be a little cumbersome, but couldn't you also source() an R script
>>> at
>>> the start of your session that loads the parameters from .my.cnf and
>>> passes
>>> them to options()?
>>>
>>> Alternatively, maybe getSymbols.MySQL could look for a cnf_file option,
>>> and
>>> then if that is not present look for a username and password?
>>>
>>> -Zach
>>
>>
>> Hi Zach & Josh,
>>     Yes, I'm sure there's lots of ways to do this, and as an individual
>> user just working by myself I'll be happy for anything that works.
>>
>>     That said, the nice security feature about the way it was done
>> before was TTBOMK the R environment never saw the MySQL username &
>> password. That was previously all done completely outside of R. R Asks
>> MySQL to get some data from a specific database. MySQL wasn't given a
>> username and password so it automatically accesses .my.cnf which is
>> secure. If it finds an entry with the right database name, then it
>> gets username and password from that file, gets the data from the
>> database and gives it back to R. If the username/password aren't there
>> the user can pass them explicitly (as I'm doing with this recent
>> change) or else he doesn't get access to that database.
>
>
> Not being a user of the packages under discussion, other than RMySql (and
> assuming it is RMySQL you are talking about underneath), I am a bit confused
> about why you think this has been broken by changes to defaults? If
> anything, it seems to depend on R not doing anything, and letting the driver
> handle it. I still use this approach in my own packages that use RMySQL. I
> think it is the default if host/user/password are not explicitly specified
> in another way. I also believe it is generally considered the most secure
> approach because sensitive information is not left sitting around in more
> viewable places. Am I missing something (as usual)?
>
> Paul

Hi Paul,
    Yeah, I may be talking out of my arse at this point. Looking back
at my code here's the changes that we've had to make due to the
defaults stuff getting taken out:

if (UseMySQL){
  if (MyAdjust) { dbName = paste0(dbName, "Adjust")}
  dbc = dbConnect(MySQL(), dbname=dbName)
#  setDefaults(getSymbols.MySQL, user="myName", password="myPassword",
dbname=dbName)
}

if (DownloadNewData){
  if (!UseMySQL){
    for (i in 1:length(TestSym)){
      print(paste("From ",SymbolSrc," -- ",TestSym[i]))
      getSymbolsCont(TestSym[i], from = DataStart, to = DataEnd,
adjust = MyAdjust, src=SymbolSrc)
    }
  } else {
    for (i in 1:length(TestSym)){
      print(paste("From MySQL -- ",TestSym[i]))
#      getSymbols(TestSym[i], src="MySQL")
      getSymbols(TestSym[i], src="MySQL", user="myName",
password="myPassword", dbname=dbName)
      assign(TestSym[i], get(TestSym[i])[paste0(DataStart,"/",DataEnd)])
    }
    dbDisconnect(dbc)
  }
}

I guess it doesn't matter where I set the name & password. I'm
confusing this whole thing with a different thread.

Sorry,
Mark


From markknecht at gmail.com  Wed Oct 29 21:20:34 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 29 Oct 2014 13:20:34 -0700
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAK2H+edoXza5WGYnWEqE-Gc8b7ZJPjybBpMYjqGi5TyRM5Fy3w@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
	<CAK2H+ec_ayVvFQSygyf0DiatZ-OD+ZtmFkfxKda9z1K3cEpkXA@mail.gmail.com>
	<CAEr64e91U=bWD8Gty8OyT2nbe8-PkuX8Fmv34y0a03Vfvjjsqw@mail.gmail.com>
	<CAK2H+edoXza5WGYnWEqE-Gc8b7ZJPjybBpMYjqGi5TyRM5Fy3w@mail.gmail.com>
Message-ID: <CAK2H+ecmnuKikzm3r59gmVGjCuVEsNS6dfHEhwfKcApn5dfP4w@mail.gmail.com>

On Wed, Oct 29, 2014 at 7:36 AM, Mark Knecht <markknecht at gmail.com> wrote:
> On Wed, Oct 29, 2014 at 6:38 AM, Zachary Deane-Mayer
> <zach.mayer at gmail.com> wrote:
>> Hi Mark,
>>
>> It'd be a little cumbersome, but couldn't you also source() an R script at
>> the start of your session that loads the parameters from .my.cnf and passes
>> them to options()?
>>
>> Alternatively, maybe getSymbols.MySQL could look for a cnf_file option, and
>> then if that is not present look for a username and password?
>>
>> -Zach
>
> Hi Zach & Josh,
>    Yes, I'm sure there's lots of ways to do this, and as an individual
> user just working by myself I'll be happy for anything that works.
>
>    That said, the nice security feature about the way it was done
> before was TTBOMK the R environment never saw the MySQL username &
> password.

I've gone back and looked at my code only to find that R has never
TTBOMK looked at .my.cnf. I've confused this whole thing with an
earlier request that never gained traction.

My apologies for the noise.

- Mark


From pgilbert902 at gmail.com  Wed Oct 29 22:40:50 2014
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Wed, 29 Oct 2014 17:40:50 -0400
Subject: [R-SIG-Finance] RFC: quantmod::getSymbols.MySQL
In-Reply-To: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
References: <CAPPM_gQfMOasAbgNbNTWHrQ0uwgtqoxokT1EJa_v8ARp40n61g@mail.gmail.com>
Message-ID: <54515EE2.5040401@gmail.com>



On 10/29/2014 08:25 AM, Joshua Ulrich wrote:
> As many of you know, the Defaults package was removed from CRAN on
> 2014-10-03 at Jeff's request.  This broke a fair bit of functionality
> in quantmod, most of which I have addressed in recent commits on
> R-Forge.
>
> One issue I have not resolved is how to adapt getSymbols.MySQL to the
> new no-Defaults paradigm.  I will be taking over as maintainer of
> quantmod, so I am soliciting input from getSymbols.MySQL users.
>
> My proposed solution to getSymbols.MySQL is to look for specific
> option()s if certain arguments are missing.  I think this is the
> cleanest and most obvious solution, but am open to alternatives.  I
> would use the option structure below, with only the three arguments
> listed.
>
> options(quantmod.defaults = list(
>    getSymbols.MySQL = list(
>      user="josh",
>      password="secret",
>      dbname="stocks")
>    )
> )
What I do is something like this, but default to user/password/host 
equal "" or NULL, in which case  I assume the .my.cnf file will be used 
and make the connection without specifying user/password/host.

Paul

>
> Should I consider another option structure?  Should additional
> arguments be supported?  Anything else I'm missing?
>
> Thanks,
>


From ispy611 at yahoo.com  Thu Oct 30 08:27:51 2014
From: ispy611 at yahoo.com (spy sixoneone)
Date: Thu, 30 Oct 2014 00:27:51 -0700
Subject: [R-SIG-Finance] IBroker: Attempt to call placeOrder() gives socket
	i/o error?
Message-ID: <1414654071.35700.YahooMailBasic@web162906.mail.bf1.yahoo.com>

Hello IBworld.

I am having trouble entering orders via the API.

Sometimes it works but usually it fails.

So far I've tried 2 types of connection api-wrappers:

R IBrokers package
python ibpy package

I can use R IBrokers package to call reqHistoricalData().
That seems to work well on my laptop.
In fact I've been doing that for months from cron.

So, I have tws setup okay and I know how to debug a variety of problems now.

I first tried entering an order using a script like this in R:

.libPaths("rpackages")
library(IBrokers)
tws2 = twsConnect(2)
print('Attempting BUY')
mytkr     = twsFuture("ES","GLOBEX","201412")
myorderid = sample(1001:3001, 1)
IBrokers:::.placeOrder(tws2, mytkr, twsOrder(myorderid, "BUY", "1", "MKT"))
twsDisconnect(tws2)

Sometimes it works but usually it fails.

When it fails I see this in my tws console:

06:01:21:676 JTS-EServerSocket-160: [2:47:71:1:0:0:0:ERR] Message type -1.  Socket I/O error - 
06:01:21:676 JTS-EServerSocket-160: Anticipated error
jextend.d: Socket I/O error - 
	at jextend.sc.b(sc.java:364)
	at jextend.ch.sb(ch.java:1534)
	at jextend.ch.run(ch.java:1390)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.net.SocketException: Connection reset
	at java.net.SocketInputStream.read(SocketInputStream.java:196)
	at java.net.SocketInputStream.read(SocketInputStream.java:122)
	at java.net.SocketInputStream.read(SocketInputStream.java:210)
	at jextend.xh.d(xh.java:45)
	at jextend.sc.c(sc.java:579)
	at jextend.sc.r(sc.java:227)
	at jextend.af.a(af.java:232)
	at jextend.sc.f(sc.java:650)
	at jextend.pd.a(pd.java:822)
	at jextend.sc.b(sc.java:358)
	... 3 more
06:01:21:678 JTS-EServerSocket-160: [2:47:71:1:0:0:0:ERR] Socket connection for client{2} has closed. 
06:01:21:678 JTS-EWriter5-161: [2:47:71:1:0:0:0:ERR] Unable write to socket client{2} - 
06:01:21:678 JTS-EServerSocketNotifier-158: Terminating

At first I thought the problem might be R.

But I get a similar error if I try to enter an order using python ibpy.

Also I tried making a call to reqAccountUpdates(tws) and that works well always.

I've done a bit of searching on google and SOF and have found no clues yet.

Please shout-out if you have any ideas on how to debug this.

Thanks,

Dan


From ispy611 at yahoo.com  Thu Oct 30 15:12:59 2014
From: ispy611 at yahoo.com (spy sixoneone)
Date: Thu, 30 Oct 2014 07:12:59 -0700
Subject: [R-SIG-Finance] IBroker: Attempt to call placeOrder() gives
	socket i/o error?
In-Reply-To: <1414654071.35700.YahooMailBasic@web162906.mail.bf1.yahoo.com>
Message-ID: <1414678379.8900.YahooMailBasic@web162901.mail.bf1.yahoo.com>

I debugged it.

This works okay for me:

# myscript.r

.libPaths("rpackages")
library(IBrokers)
tws2 = twsConnect(2)
mytkr     = twsFuture("ES","GLOBEX","201412")
Sys.sleep(2)
myorderid = as.integer(reqIds(tws2))
print(myorderid)
Sys.sleep(2)
myorderid = as.integer(difftime(Sys.time(), "2014-10-30", units = "secs"))

IBrokers:::.placeOrder(tws2, mytkr, twsOrder(myorderid,"SELL", "1", "MKT"))
Sys.sleep(2)
twsDisconnect(tws2)

Dan
--------------------------------------------


 Subject: IBroker: Attempt to call placeOrder() gives socket i/o error?
 To: r-sig-finance at r-project.org
 Date: Thursday, October 30, 2014, 7:27 AM

 Hello IBworld.

 I am having trouble entering orders via the API.

 Sometimes it works but usually it fails.

 So far I've tried 2 types of connection api-wrappers:

 R IBrokers package
 python ibpy package

 I can use R IBrokers package to call reqHistoricalData().
 That seems to work well on my laptop.
 In fact I've been doing that for months from cron.

 So, I have tws setup okay and I know how to debug a variety
 of problems now.

 I first tried entering an order using a script like this in
 R:

 .libPaths("rpackages")
 library(IBrokers)
 tws2 = twsConnect(2)
 print('Attempting BUY')
 mytkr? ???=
 twsFuture("ES","GLOBEX","201412")
 myorderid = sample(1001:3001, 1)
 IBrokers:::.placeOrder(tws2, mytkr, twsOrder(myorderid,
 "BUY", "1", "MKT"))
 twsDisconnect(tws2)

 Sometimes it works but usually it fails.

 When it fails I see this in my tws console:

 06:01:21:676 JTS-EServerSocket-160: [2:47:71:1:0:0:0:ERR]
 Message type -1.? Socket I/O error - 
 06:01:21:676 JTS-EServerSocket-160: Anticipated error
 jextend.d: Socket I/O error - 
 ??? at jextend.sc.b(sc.java:364)
 ??? at jextend.ch.sb(ch.java:1534)
 ??? at jextend.ch.run(ch.java:1390)
 ??? at java.lang.Thread.run(Thread.java:745)
 Caused by: java.net.SocketException: Connection reset
 ??? at
 java.net.SocketInputStream.read(SocketInputStream.java:196)
 ??? at
 java.net.SocketInputStream.read(SocketInputStream.java:122)
 ??? at
 java.net.SocketInputStream.read(SocketInputStream.java:210)
 ??? at jextend.xh.d(xh.java:45)
 ??? at jextend.sc.c(sc.java:579)
 ??? at jextend.sc.r(sc.java:227)
 ??? at jextend.af.a(af.java:232)
 ??? at jextend.sc.f(sc.java:650)
 ??? at jextend.pd.a(pd.java:822)
 ??? at jextend.sc.b(sc.java:358)
 ??? ... 3 more
 06:01:21:678 JTS-EServerSocket-160: [2:47:71:1:0:0:0:ERR]
 Socket connection for client{2} has closed. 
 06:01:21:678 JTS-EWriter5-161: [2:47:71:1:0:0:0:ERR] Unable
 write to socket client{2} - 
 06:01:21:678 JTS-EServerSocketNotifier-158: Terminating

 At first I thought the problem might be R.

 But I get a similar error if I try to enter an order using
 python ibpy.

 Also I tried making a call to reqAccountUpdates(tws) and
 that works well always.

 I've done a bit of searching on google and SOF and have
 found no clues yet.

 Please shout-out if you have any ideas on how to debug
 this.

 Thanks,

 Dan


From josh.m.ulrich at gmail.com  Thu Oct 30 22:38:38 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 30 Oct 2014 16:38:38 -0500
Subject: [R-SIG-Finance] IBroker: Attempt to call placeOrder() gives
 socket i/o error?
In-Reply-To: <1414678379.8900.YahooMailBasic@web162901.mail.bf1.yahoo.com>
References: <1414654071.35700.YahooMailBasic@web162906.mail.bf1.yahoo.com>
	<1414678379.8900.YahooMailBasic@web162901.mail.bf1.yahoo.com>
Message-ID: <CAPPM_gTUx+7Cwgo+15w1=wycqFiGuov+dCtKJNpY=y2OCfvj0g@mail.gmail.com>

Hi Dan,

For future reference, please don't cross post (here and SO:
http://stackoverflow.com/q/26644845/271616).  If you do cross-post,
please at least say you did, so people don't spend time answering a
question that was already answered in another forum.

Best,
Josh

On Thu, Oct 30, 2014 at 9:12 AM, spy sixoneone <ispy611 at yahoo.com> wrote:
> I debugged it.
>
> This works okay for me:
>
> # myscript.r
>
> .libPaths("rpackages")
> library(IBrokers)
> tws2 = twsConnect(2)
> mytkr     = twsFuture("ES","GLOBEX","201412")
> Sys.sleep(2)
> myorderid = as.integer(reqIds(tws2))
> print(myorderid)
> Sys.sleep(2)
> myorderid = as.integer(difftime(Sys.time(), "2014-10-30", units = "secs"))
>
> IBrokers:::.placeOrder(tws2, mytkr, twsOrder(myorderid,"SELL", "1", "MKT"))
> Sys.sleep(2)
> twsDisconnect(tws2)
>
> Dan
> --------------------------------------------
>
>
>  Subject: IBroker: Attempt to call placeOrder() gives socket i/o error?
>  To: r-sig-finance at r-project.org
>  Date: Thursday, October 30, 2014, 7:27 AM
>
>  Hello IBworld.
>
>  I am having trouble entering orders via the API.
>
>  Sometimes it works but usually it fails.
>
>  So far I've tried 2 types of connection api-wrappers:
>
>  R IBrokers package
>  python ibpy package
>
>  I can use R IBrokers package to call reqHistoricalData().
>  That seems to work well on my laptop.
>  In fact I've been doing that for months from cron.
>
>  So, I have tws setup okay and I know how to debug a variety
>  of problems now.
>
>  I first tried entering an order using a script like this in
>  R:
>
>  .libPaths("rpackages")
>  library(IBrokers)
>  tws2 = twsConnect(2)
>  print('Attempting BUY')
>  mytkr     =
>  twsFuture("ES","GLOBEX","201412")
>  myorderid = sample(1001:3001, 1)
>  IBrokers:::.placeOrder(tws2, mytkr, twsOrder(myorderid,
>  "BUY", "1", "MKT"))
>  twsDisconnect(tws2)
>
>  Sometimes it works but usually it fails.
>
>  When it fails I see this in my tws console:
>
>  06:01:21:676 JTS-EServerSocket-160: [2:47:71:1:0:0:0:ERR]
>  Message type -1.  Socket I/O error -
>  06:01:21:676 JTS-EServerSocket-160: Anticipated error
>  jextend.d: Socket I/O error -
>      at jextend.sc.b(sc.java:364)
>      at jextend.ch.sb(ch.java:1534)
>      at jextend.ch.run(ch.java:1390)
>      at java.lang.Thread.run(Thread.java:745)
>  Caused by: java.net.SocketException: Connection reset
>      at
>  java.net.SocketInputStream.read(SocketInputStream.java:196)
>      at
>  java.net.SocketInputStream.read(SocketInputStream.java:122)
>      at
>  java.net.SocketInputStream.read(SocketInputStream.java:210)
>      at jextend.xh.d(xh.java:45)
>      at jextend.sc.c(sc.java:579)
>      at jextend.sc.r(sc.java:227)
>      at jextend.af.a(af.java:232)
>      at jextend.sc.f(sc.java:650)
>      at jextend.pd.a(pd.java:822)
>      at jextend.sc.b(sc.java:358)
>      ... 3 more
>  06:01:21:678 JTS-EServerSocket-160: [2:47:71:1:0:0:0:ERR]
>  Socket connection for client{2} has closed.
>  06:01:21:678 JTS-EWriter5-161: [2:47:71:1:0:0:0:ERR] Unable
>  write to socket client{2} -
>  06:01:21:678 JTS-EServerSocketNotifier-158: Terminating
>
>  At first I thought the problem might be R.
>
>  But I get a similar error if I try to enter an order using
>  python ibpy.
>
>  Also I tried making a call to reqAccountUpdates(tws) and
>  that works well always.
>
>  I've done a bit of searching on google and SOF and have
>  found no clues yet.
>
>  Please shout-out if you have any ideas on how to debug
>  this.
>
>  Thanks,
>
>  Dan
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From gmonaie at gmail.com  Fri Oct 31 03:08:33 2014
From: gmonaie at gmail.com (Gei Lin)
Date: Thu, 30 Oct 2014 22:08:33 -0400
Subject: [R-SIG-Finance] blotter_0.9.1643 pennyPerShare() not reflecting
	addTxn usage
Message-ID: <CAJFvkcea5JZ=qEJWLrkwVxJVT1eHaDgvfrYv6S2PN1+DZ_kPyw@mail.gmail.com>

within blotter::addTxn(), there's a call using the TxnFees argument as
a function

if (is.function(TxnFees)) *    txnfees <- TxnFees(TxnQty, TxnPrice)*

pennyPerShare(), referenced as an example TxnFee function, doesn't
have its arguments set to reflect this yet

> blotter::pennyPerSharefunction (TxnQty)
{
    return(abs(TxnQty) * -0.01)
}

> sessionInfo()
R version 3.1.1 (2014-07-10)
Platform: x86_64-apple-darwin13.1.0 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] blotter_0.9.1643              PerformanceAnalytics_1.4.3541
FinancialInstrument_1.1.9
[4] quantmod_0.4-2                TTR_0.22-0.1
xts_0.9-7
[7] zoo_1.7-12

loaded via a namespace (and not attached):
[1] grid_3.1.1          lattice_0.20-29     quantstrat_0.9.1632 tools_3.1.1


-- 

?*Don't quit. Suffer now and live the rest of your life as a champion.*?

                                                -
Muhammad Ali*?*
*?*

?*The world is full of obvious things which nobody by any chance observes.*?

                                                -
Sir Arthur Conan Doyle*?*
*?*

	[[alternative HTML version deleted]]


From daniel.cegielka at gmail.com  Fri Oct 31 08:33:25 2014
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Fri, 31 Oct 2014 08:33:25 +0100
Subject: [R-SIG-Finance] blotter_0.9.1643 pennyPerShare() not reflecting
 addTxn usage
In-Reply-To: <CAJFvkcea5JZ=qEJWLrkwVxJVT1eHaDgvfrYv6S2PN1+DZ_kPyw@mail.gmail.com>
References: <CAJFvkcea5JZ=qEJWLrkwVxJVT1eHaDgvfrYv6S2PN1+DZ_kPyw@mail.gmail.com>
Message-ID: <CAPLrYETK8y_vtgpqPbcy+0ijMvwp7n8peVSQFgKtm1WhmP3nzQ@mail.gmail.com>

2014-10-31 3:08 GMT+01:00 Gei Lin <gmonaie at gmail.com>:
> within blotter::addTxn(), there's a call using the TxnFees argument as
> a function
>
> if (is.function(TxnFees)) *    txnfees <- TxnFees(TxnQty, TxnPrice)*
>
> pennyPerShare(), referenced as an example TxnFee function, doesn't
> have its arguments set to reflect this yet
>
>> blotter::pennyPerSharefunction (TxnQty)
> {
>     return(abs(TxnQty) * -0.01)
> }

It should be something like:

pennyPerShare <- function(TxnQty, ...) {
return(abs(TxnQty) * -0.01)
}

thx,
Daniel


From mcooganj at gmail.com  Sat Nov  1 04:22:29 2014
From: mcooganj at gmail.com (Matthew Johnson)
Date: Sat, 1 Nov 2014 14:22:29 +1100
Subject: [R-SIG-Finance] zero coupon yield curve estimation
Message-ID: <CABCh89puVKpSNA0v5odA41pMbbkCM_twSLQ1zu2_GGAugu5-eg@mail.gmail.com>

hi,

I see that there are a number of R packages to extract a zero coupon yield
curve from par rates -

In particular the follow two seem to be popular:

'termstrc' <http://cran.r-project.org/web/packages/termstrc/termstrc.pdf>

and

'ycinterextra'
<http://cran.r-project.org/web/packages/ycinterextra/ycinterextra.pdf>

is one or another of them better? or something else?

Can anyone give a summary of the trade offs between these two packages --
and for that matter any of that i have missed?

thanks and best regards

mj

	[[alternative HTML version deleted]]


From kw1958 at gmail.com  Sun Nov  2 18:25:27 2014
From: kw1958 at gmail.com (kw1958)
Date: Sun, 2 Nov 2014 12:25:27 -0500
Subject: [R-SIG-Finance]  zero coupon yield curve estimation
Message-ID: <CACDn=Yx1k23uXADsGd+G4vWyRnPnVYvigkGrGKP75KTRyQWexA@mail.gmail.com>

I have been using SmithWilsonYieldCurve:

http://cran.r-project.org/web/packages/SmithWilsonYieldCurve/index.html

On Nov 1, 2014, at 7:00 AM, r-sig-finance-request at r-project.org wrote:


I see that there are a number of R packages to extract a zero coupon yield
curve from par rates -

In particular the follow two seem to be popular:

'termstrc' <http://cran.r-project.org/web/packages/termstrc/termstrc.pdf>

and

'ycinterextra'
<http://cran.r-project.org/web/packages/ycinterextra/ycinterextra.pdf>

is one or another of them better? or something else?

Can anyone give a summary of the trade offs between these two packages --
and for that matter any of that i have missed?

	[[alternative HTML version deleted]]


From roger.bos at rothschild.com  Tue Nov  4 18:50:56 2014
From: roger.bos at rothschild.com (Bos, Roger)
Date: Tue, 4 Nov 2014 17:50:56 +0000
Subject: [R-SIG-Finance] quantstrat::Return.rebalancing
Message-ID: <0765308CD028654885F30322557308D81ED39225@NYCSM0208.rth.ad.rothschild.com>

I was trying to run some code and got an error on Return.rebalancing, so I tried running the example from the help page and that didn't work either.  I am using windows.

Question 1: what origin must I supply?
> data(edhec)
> data(weights)
> round(Return.rebalancing(edhec,weights),4)
Error in as.Date.numeric(index(last(R))) : 'origin' must be supplied

Once I figure out how to get that example working, what I really want to run is this:

Question 2: Should this code work on windows (from http://quantstrattrader.wordpress.com/category/asset-allocation/)?
library(quantstrat)

#long TMF 60% (leveraged 3x t-bond bull), long XIV 40%
getSymbols("XIV", from="1990-01-01")
getSymbols("TMF", from="1990-01-01")
tmfRets <- Return.calculate(Cl(TMF))
xivRets <- Return.calculate(Ad(XIV))
both <- merge(xivRets, tmfRets, join='inner')
colnames(both) <- c("xiv", "tmf")
portfRets <- Return.rebalancing(both, weights=c(.4, .6),
                               rebalance_on="weeks", geometric=FALSE)

The last line gives this error:

> portfRets <- Return.rebalancing(both, weights=c(.4, .6),
+                                rebalance_on="weeks", geometric=FALSE)
Error in Return.rebalancing(both, weights = c(0.4, 0.6), rebalance_on = "weeks",  :
  Use Return.portfolio for single weighting vector.  This function is for building portfolios over rebalancing periods.

Question 3: Does the weights parameter have to be a matrix, or could it be a vector?

A vector would make sense in this case where we want to rebalance to 40%/60% on a weekly basis, but the first thing the code does is make sure weights is not a vector:
    if (is.vector(weights)) {
        stop("Use Return.portfolio for single weighting vector.  This function is for building portfolios over rebalancing periods.")
    }

Thanks,

Roger



***************************************************************
This message and any attachments are for the named person's use only.
This message may contain confidential, proprietary or legally privileged
information. No right to confidential or privileged treatment
of this message is waived or lost by an error in transmission.
If you have received this message in error, please immediately
notify the sender by e-mail, delete the message, any attachments and all
copies from your system and destroy any hard copies. You must
not, directly or indirectly, use, disclose, distribute,
print or copy any part of this message or any attachments if you are not
the intended recipient.



From brian at braverock.com  Tue Nov  4 19:47:51 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 04 Nov 2014 12:47:51 -0600
Subject: [R-SIG-Finance] quantstrat::Return.rebalancing
In-Reply-To: <0765308CD028654885F30322557308D81ED39225@NYCSM0208.rth.ad.rothschild.com>
References: <0765308CD028654885F30322557308D81ED39225@NYCSM0208.rth.ad.rothschild.com>
Message-ID: <54591F57.10603@braverock.com>

On 11/04/2014 11:50 AM, Bos, Roger wrote:
> I was trying to run some code and got an error on Return.rebalancing, so I tried running the example from the help page and that didn't work either.  I am using windows.
>
> Question 1: what origin must I supply?
>> data(edhec)
>> data(weights)
>> round(Return.rebalancing(edhec,weights),4)
> Error in as.Date.numeric(index(last(R))) : 'origin' must be supplied
>
> Once I figure out how to get that example working, what I really want to run is this:
>
> Question 2: Should this code work on windows (from http://quantstrattrader.wordpress.com/category/asset-allocation/)?
> library(quantstrat)
>
> #long TMF 60% (leveraged 3x t-bond bull), long XIV 40%
> getSymbols("XIV", from="1990-01-01")
> getSymbols("TMF", from="1990-01-01")
> tmfRets <- Return.calculate(Cl(TMF))
> xivRets <- Return.calculate(Ad(XIV))
> both <- merge(xivRets, tmfRets, join='inner')
> colnames(both) <- c("xiv", "tmf")
> portfRets <- Return.rebalancing(both, weights=c(.4, .6),
>                                 rebalance_on="weeks", geometric=FALSE)
>
> The last line gives this error:
>
>> portfRets <- Return.rebalancing(both, weights=c(.4, .6),
> +                                rebalance_on="weeks", geometric=FALSE)
> Error in Return.rebalancing(both, weights = c(0.4, 0.6), rebalance_on = "weeks",  :
>    Use Return.portfolio for single weighting vector.  This function is for building portfolios over rebalancing periods.
>
> Question 3: Does the weights parameter have to be a matrix, or could it be a vector?
>
> A vector would make sense in this case where we want to rebalance to 40%/60% on a weekly basis, but the first thing the code does is make sure weights is not a vector:
>      if (is.vector(weights)) {
>          stop("Use Return.portfolio for single weighting vector.  This function is for building portfolios over rebalancing periods.")
>      }
>

It looks like you're using old versions of the packages.

You did not attach your sessionInfo as described in the posting guide
http://www.r-project.org/posting-guide.html

Both your examples work for me with current code.

In the current CRAN version of PerformanceAnalytics,  Return.rebalancing 
and Return.portfolio are aliases for the same function. (those functions 
are in PerformanceAnalytics, not quantstrat)

Regards,

Brian



-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From roger.bos at rothschild.com  Tue Nov  4 20:52:38 2014
From: roger.bos at rothschild.com (Bos, Roger)
Date: Tue, 4 Nov 2014 19:52:38 +0000
Subject: [R-SIG-Finance] quantstrat::Return.rebalancing
In-Reply-To: <54591F57.10603@braverock.com>
References: <0765308CD028654885F30322557308D81ED39225@NYCSM0208.rth.ad.rothschild.com>
	<54591F57.10603@braverock.com>
Message-ID: <0765308CD028654885F30322557308D81ED3A8CF@NYCSM0208.rth.ad.rothschild.com>

Yes, it was an old version of PerformanceAnalytics.  It is working fine now.  Thanks for pointing that ouit.


#long TMF 60% (leveraged 3x t-bond bull), long XIV 40%
getSymbols("XIV", from="1990-01-01")
getSymbols("TMF", from="1990-01-01")
tmfRets <- Return.calculate(Cl(TMF))
xivRets <- Return.calculate(Ad(XIV))
both <- merge(xivRets, tmfRets, join='inner')
colnames(both) <- c("xiv", "tmf")
portfRets <- Return.rebalancing(both, weights=c(.4, .6),
                               rebalance_on="weeks", geometric=FALSE)



***************************************************************
This message and any attachments are for the named person's use only.
This message may contain confidential, proprietary or legally privileged
information. No right to confidential or privileged treatment
of this message is waived or lost by an error in transmission.
If you have received this message in error, please immediately
notify the sender by e-mail, delete the message, any attachments and all
copies from your system and destroy any hard copies. You must
not, directly or indirectly, use, disclose, distribute,
print or copy any part of this message or any attachments if you are not
the intended recipient.



-----Original Message-----
From: r-sig-finance-bounces at r-project.org [mailto:r-sig-finance-bounces at r-project.org] On Behalf Of Brian G. Peterson
Sent: Tuesday, November 04, 2014 1:48 PM
To: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] quantstrat::Return.rebalancing

On 11/04/2014 11:50 AM, Bos, Roger wrote:
> I was trying to run some code and got an error on Return.rebalancing, so I tried running the example from the help page and that didn't work either.  I am using windows.
>
> Question 1: what origin must I supply?
>> data(edhec)
>> data(weights)
>> round(Return.rebalancing(edhec,weights),4)
> Error in as.Date.numeric(index(last(R))) : 'origin' must be supplied
>
> Once I figure out how to get that example working, what I really want to run is this:
>
> Question 2: Should this code work on windows (from http://quantstrattrader.wordpress.com/category/asset-allocation/)?
> library(quantstrat)
>
> #long TMF 60% (leveraged 3x t-bond bull), long XIV 40%
> getSymbols("XIV", from="1990-01-01") getSymbols("TMF",
> from="1990-01-01") tmfRets <- Return.calculate(Cl(TMF)) xivRets <-
> Return.calculate(Ad(XIV)) both <- merge(xivRets, tmfRets,
> join='inner')
> colnames(both) <- c("xiv", "tmf")
> portfRets <- Return.rebalancing(both, weights=c(.4, .6),
>                                 rebalance_on="weeks", geometric=FALSE)
>
> The last line gives this error:
>
>> portfRets <- Return.rebalancing(both, weights=c(.4, .6),
> +                                rebalance_on="weeks",
> + geometric=FALSE)
> Error in Return.rebalancing(both, weights = c(0.4, 0.6), rebalance_on = "weeks",  :
>    Use Return.portfolio for single weighting vector.  This function is for building portfolios over rebalancing periods.
>
> Question 3: Does the weights parameter have to be a matrix, or could it be a vector?
>
> A vector would make sense in this case where we want to rebalance to 40%/60% on a weekly basis, but the first thing the code does is make sure weights is not a vector:
>      if (is.vector(weights)) {
>          stop("Use Return.portfolio for single weighting vector.  This function is for building portfolios over rebalancing periods.")
>      }
>

It looks like you're using old versions of the packages.

You did not attach your sessionInfo as described in the posting guide http://www.r-project.org/posting-guide.html

Both your examples work for me with current code.

In the current CRAN version of PerformanceAnalytics,  Return.rebalancing and Return.portfolio are aliases for the same function. (those functions are in PerformanceAnalytics, not quantstrat)

Regards,

Brian



--
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock

_______________________________________________
R-SIG-Finance at r-project.org mailing list https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

From thorstlasse at gmail.com  Wed Nov  5 15:16:12 2014
From: thorstlasse at gmail.com (Lasse Thorst)
Date: Wed, 5 Nov 2014 15:16:12 +0100
Subject: [R-SIG-Finance] How to add lagged values to rugarch-model
Message-ID: <CADMJJm-csCETK34pd0x_AwCAw-fYW_OjmamgHh2UHLPXcncq6Q@mail.gmail.com>

Hi - First question here, so please bear with me:

I would like to added lagged values to a rugarch-model, but have been
unable to find answers in the vignette.

Basic test-code:

require(rugarch)
require(quantmod)

x = runif(n = 1000, min = -5, max = 100)
ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n = 1000,
min = 5, max = 15))

fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
                                                 garchOrder = c(1, 1)),
                       mean.model         = list(armaOrder = c(3, 1),
                                                 include.mean = TRUE,
                                                 external.regressors =
ext.reg), # with ext.reg.lagged it does not work.
                       distribution.model = "sstd")

fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")

Now this works perfectly, but if I exchange the external.regressors =
ext.reg_lagged
it no longer works.

How can you do this in rugarch? Or do I need to try another package?

/Regards Lasse

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Wed Nov  5 15:27:12 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Wed, 05 Nov 2014 14:27:12 +0000
Subject: [R-SIG-Finance] How to add lagged values to rugarch-model
In-Reply-To: <CADMJJm-csCETK34pd0x_AwCAw-fYW_OjmamgHh2UHLPXcncq6Q@mail.gmail.com>
References: <CADMJJm-csCETK34pd0x_AwCAw-fYW_OjmamgHh2UHLPXcncq6Q@mail.gmail.com>
Message-ID: <545A33C0.8000604@4dscape.com>

ext.reg_lagged has NA's in the first few lines which are NOT allowed.
Even though you are using an ARMA(3,1), the conditional mean model will 
still make use of those values for t+1,t+2 and t+3, together with the 
'intercept'. Replace the NA's with either zero or their mean values (or 
anything other than NA).

Alexios

On 05/11/2014 14:16, Lasse Thorst wrote:
> Hi - First question here, so please bear with me:
>
> I would like to added lagged values to a rugarch-model, but have been
> unable to find answers in the vignette.
>
> Basic test-code:
>
> require(rugarch)
> require(quantmod)
>
> x = runif(n = 1000, min = -5, max = 100)
> ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
> ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n = 1000,
> min = 5, max = 15))
>
> fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
>                                                   garchOrder = c(1, 1)),
>                         mean.model         = list(armaOrder = c(3, 1),
>                                                   include.mean = TRUE,
>                                                   external.regressors =
> ext.reg), # with ext.reg.lagged it does not work.
>                         distribution.model = "sstd")
>
> fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")
>
> Now this works perfectly, but if I exchange the external.regressors =
> ext.reg_lagged
> it no longer works.
>
> How can you do this in rugarch? Or do I need to try another package?
>
> /Regards Lasse
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
>


From rharlow86 at gmail.com  Wed Nov  5 15:28:52 2014
From: rharlow86 at gmail.com (Robert Harlow)
Date: Wed, 5 Nov 2014 09:28:52 -0500
Subject: [R-SIG-Finance] How to add lagged values to rugarch-model
In-Reply-To: <CADMJJm-csCETK34pd0x_AwCAw-fYW_OjmamgHh2UHLPXcncq6Q@mail.gmail.com>
References: <CADMJJm-csCETK34pd0x_AwCAw-fYW_OjmamgHh2UHLPXcncq6Q@mail.gmail.com>
Message-ID: <CAHdfS95FnqPmtDuA3c8nUoU+fipN0nvZF=PozmGk6Ekas06WOg@mail.gmail.com>

Lasse,
Your problem is that you have NAs in your external regressor matrix.  Since
you lagged it twice, you have 2 NAs.  Try the code below.
Thanks for the reproducible example, it made it really easy.
Bob


require(rugarch)
require(quantmod)

x = runif(n = 1000, min = -5, max = 100)
ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n = 1000,
min = 5, max = 15))

*x <- x[-c(1:2)]*
*ext.reg_lagged = ext.reg_lagged[-c(1:2), ]*

fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
                                                 garchOrder = c(1, 1)),
                       mean.model         = list(armaOrder = c(3, 1),
                                                 include.mean = TRUE,
                                                 external.regressors =
                           ext.reg_lagged), # with ext.reg.lagged it does
not work.
                       distribution.model = "sstd")
fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")


On Wed, Nov 5, 2014 at 9:16 AM, Lasse Thorst <thorstlasse at gmail.com> wrote:

> Hi - First question here, so please bear with me:
>
> I would like to added lagged values to a rugarch-model, but have been
> unable to find answers in the vignette.
>
> Basic test-code:
>
> require(rugarch)
> require(quantmod)
>
> x = runif(n = 1000, min = -5, max = 100)
> ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
> ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n = 1000,
> min = 5, max = 15))
>
> fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
>                                                  garchOrder = c(1, 1)),
>                        mean.model         = list(armaOrder = c(3, 1),
>                                                  include.mean = TRUE,
>                                                  external.regressors =
> ext.reg), # with ext.reg.lagged it does not work.
>                        distribution.model = "sstd")
>
> fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")
>
> Now this works perfectly, but if I exchange the external.regressors =
> ext.reg_lagged
> it no longer works.
>
> How can you do this in rugarch? Or do I need to try another package?
>
> /Regards Lasse
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From thorstlasse at gmail.com  Wed Nov  5 15:59:35 2014
From: thorstlasse at gmail.com (Lasse Thorst)
Date: Wed, 5 Nov 2014 15:59:35 +0100
Subject: [R-SIG-Finance] How to add lagged values to rugarch-model
In-Reply-To: <CAHdfS95FnqPmtDuA3c8nUoU+fipN0nvZF=PozmGk6Ekas06WOg@mail.gmail.com>
References: <CADMJJm-csCETK34pd0x_AwCAw-fYW_OjmamgHh2UHLPXcncq6Q@mail.gmail.com>
	<CAHdfS95FnqPmtDuA3c8nUoU+fipN0nvZF=PozmGk6Ekas06WOg@mail.gmail.com>
Message-ID: <CADMJJm_33c-fgSJKRfPZaQ1mAdnP1kBpOkS9ZWvNUXqf4C9f1Q@mail.gmail.com>

Thanks!

Quick follow-up.

My knowledge about ARMA-GARCH models is not perfect, but if want a lagged
time series in the model - to work with seasonality - how can I then add
it, if not via the ext.reg?

For example, in STATA I would do something like choosing my "x  AR(24)
AR(48)" for adding the 24th and 48th lag.
I would here like to add the 24th and 48th lag to the mean model in my
ARMA-GARCH model.

Should I look at another package?

2014-11-05 15:28 GMT+01:00 Robert Harlow <rharlow86 at gmail.com>:

> Lasse,
> Your problem is that you have NAs in your external regressor matrix.
> Since you lagged it twice, you have 2 NAs.  Try the code below.
> Thanks for the reproducible example, it made it really easy.
> Bob
>
>
> require(rugarch)
> require(quantmod)
>
> x = runif(n = 1000, min = -5, max = 100)
> ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
> ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n = 1000,
> min = 5, max = 15))
>
> *x <- x[-c(1:2)]*
> *ext.reg_lagged = ext.reg_lagged[-c(1:2), ]*
>
> fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
>                                                  garchOrder = c(1, 1)),
>                        mean.model         = list(armaOrder = c(3, 1),
>                                                  include.mean = TRUE,
>                                                  external.regressors =
>                            ext.reg_lagged), # with ext.reg.lagged it does
> not work.
>                        distribution.model = "sstd")
> fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")
>
>
> On Wed, Nov 5, 2014 at 9:16 AM, Lasse Thorst <thorstlasse at gmail.com>
> wrote:
>
>> Hi - First question here, so please bear with me:
>>
>> I would like to added lagged values to a rugarch-model, but have been
>> unable to find answers in the vignette.
>>
>> Basic test-code:
>>
>> require(rugarch)
>> require(quantmod)
>>
>> x = runif(n = 1000, min = -5, max = 100)
>> ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
>> ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n =
>> 1000,
>> min = 5, max = 15))
>>
>> fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
>>                                                  garchOrder = c(1, 1)),
>>                        mean.model         = list(armaOrder = c(3, 1),
>>                                                  include.mean = TRUE,
>>                                                  external.regressors =
>> ext.reg), # with ext.reg.lagged it does not work.
>>                        distribution.model = "sstd")
>>
>> fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")
>>
>> Now this works perfectly, but if I exchange the external.regressors =
>> ext.reg_lagged
>> it no longer works.
>>
>> How can you do this in rugarch? Or do I need to try another package?
>>
>> /Regards Lasse
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Wed Nov  5 16:18:12 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Wed, 05 Nov 2014 15:18:12 +0000
Subject: [R-SIG-Finance] How to add lagged values to rugarch-model
In-Reply-To: <CADMJJm_33c-fgSJKRfPZaQ1mAdnP1kBpOkS9ZWvNUXqf4C9f1Q@mail.gmail.com>
References: <CADMJJm-csCETK34pd0x_AwCAw-fYW_OjmamgHh2UHLPXcncq6Q@mail.gmail.com>	<CAHdfS95FnqPmtDuA3c8nUoU+fipN0nvZF=PozmGk6Ekas06WOg@mail.gmail.com>
	<CADMJJm_33c-fgSJKRfPZaQ1mAdnP1kBpOkS9ZWvNUXqf4C9f1Q@mail.gmail.com>
Message-ID: <545A3FB4.7050904@4dscape.com>

On 05/11/2014 14:59, Lasse Thorst wrote:
> Thanks!
>
> Quick follow-up.
>
> My knowledge about ARMA-GARCH models is not perfect, but if want a lagged
> time series in the model - to work with seasonality - how can I then add
> it, if not via the ext.reg?
>
> For example, in STATA I would do something like choosing my "x  AR(24)
> AR(48)" for adding the 24th and 48th lag.
> I would here like to add the 24th and 48th lag to the mean model in my
> ARMA-GARCH model.

Try:
spec<-ugarchspec(mean.model=list(armaOrder=c(48,0)))
x = as.list(rep(0,46))
names(x)<-c(paste("ar",1:23,sep=""),paste("ar",25:47,sep=""))
setfixed(spec)<-x


> Should I look at another package?

Why not.

Alexios

> 2014-11-05 15:28 GMT+01:00 Robert Harlow <rharlow86 at gmail.com>:
>
>> Lasse,
>> Your problem is that you have NAs in your external regressor matrix.
>> Since you lagged it twice, you have 2 NAs.  Try the code below.
>> Thanks for the reproducible example, it made it really easy.
>> Bob
>>
>>
>> require(rugarch)
>> require(quantmod)
>>
>> x = runif(n = 1000, min = -5, max = 100)
>> ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
>> ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n = 1000,
>> min = 5, max = 15))
>>
>> *x <- x[-c(1:2)]*
>> *ext.reg_lagged = ext.reg_lagged[-c(1:2), ]*
>>
>> fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
>>                                                   garchOrder = c(1, 1)),
>>                         mean.model         = list(armaOrder = c(3, 1),
>>                                                   include.mean = TRUE,
>>                                                   external.regressors =
>>                             ext.reg_lagged), # with ext.reg.lagged it does
>> not work.
>>                         distribution.model = "sstd")
>> fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")
>>
>>
>> On Wed, Nov 5, 2014 at 9:16 AM, Lasse Thorst <thorstlasse at gmail.com>
>> wrote:
>>
>>> Hi - First question here, so please bear with me:
>>>
>>> I would like to added lagged values to a rugarch-model, but have been
>>> unable to find answers in the vignette.
>>>
>>> Basic test-code:
>>>
>>> require(rugarch)
>>> require(quantmod)
>>>
>>> x = runif(n = 1000, min = -5, max = 100)
>>> ext.reg_lagged = cbind(Lag(x, k = 1), Lag(x, k = 2))
>>> ext.reg = cbind(x + runif(n = 1000, min = 5, max = 20), x - runif(n =
>>> 1000,
>>> min = 5, max = 15))
>>>
>>> fit.spec <- ugarchspec(variance.model = list(model = "sGARCH",
>>>                                                   garchOrder = c(1, 1)),
>>>                         mean.model         = list(armaOrder = c(3, 1),
>>>                                                   include.mean = TRUE,
>>>                                                   external.regressors =
>>> ext.reg), # with ext.reg.lagged it does not work.
>>>                         distribution.model = "sstd")
>>>
>>> fit      <- ugarchfit(data = x, spec = fit.spec, solver = "hybrid")
>>>
>>> Now this works perfectly, but if I exchange the external.regressors =
>>> ext.reg_lagged
>>> it no longer works.
>>>
>>> How can you do this in rugarch? Or do I need to try another package?
>>>
>>> /Regards Lasse
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>>> should go.
>>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
>


From ed.herranz at gmail.com  Thu Nov  6 16:22:35 2014
From: ed.herranz at gmail.com (Ed Herranz)
Date: Thu, 6 Nov 2014 10:22:35 -0500
Subject: [R-SIG-Finance] rmgarch gogarchFit standardized residuals
Message-ID: <CABJ+vwS_gW4hspTcBrQftUh0BUZhpkZbhx_vLf=sEspSX=h8TA@mail.gmail.com>

All,

I am using gogarchFit in the rmgarch package.  I am trying to analyze the
standardized residuals of a gogarch model (which I think should be the
returns times the inverse square root conditional variance matrix.)

When I look at the source code for the residuals in rmgarch it seems these
are not standardized.)  Also I don't know how to extract the conditional
variance matrix from gogarchFit to do the calculation myself.  [ I want to
compute the acf() of the squared normalized residuals.]

I would appreciate any help with this.

Many thanks,
-Ed

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Thu Nov  6 16:45:56 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Thu, 06 Nov 2014 15:45:56 +0000
Subject: [R-SIG-Finance] rmgarch gogarchFit standardized residuals
In-Reply-To: <CABJ+vwS_gW4hspTcBrQftUh0BUZhpkZbhx_vLf=sEspSX=h8TA@mail.gmail.com>
References: <CABJ+vwS_gW4hspTcBrQftUh0BUZhpkZbhx_vLf=sEspSX=h8TA@mail.gmail.com>
Message-ID: <545B97B4.9060702@4dscape.com>

 From the documentation:
 >?'goGARCHfit-class'

residuals
signature(object = "goGARCHfit"): Extracts the conditional mean equation 
residuals.
(does not say standardized residuals)

rcov
signature(object = "goGARCHfit"): Returns the time-varying NxN 
covariance matrix in array format.

You can them make use of the rmgarch:::.sqrtm function to obtain the 
square root of the covariance matrix at each time t, then invert it 
(solve) and matrix multiply the residuals[t] by that.

I think this should be sufficient information to proceed with the 
standardization.

Alexios

On 06/11/2014 15:22, Ed Herranz wrote:
> All,
>
> I am using gogarchFit in the rmgarch package.  I am trying to analyze the
> standardized residuals of a gogarch model (which I think should be the
> returns times the inverse square root conditional variance matrix.)
>
> When I look at the source code for the residuals in rmgarch it seems these
> are not standardized.)  Also I don't know how to extract the conditional
> variance matrix from gogarchFit to do the calculation myself.  [ I want to
> compute the acf() of the squared normalized residuals.]
>
> I would appreciate any help with this.
>
> Many thanks,
> -Ed
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
>


From alexios at 4dscape.com  Thu Nov  6 17:18:19 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Thu, 06 Nov 2014 16:18:19 +0000
Subject: [R-SIG-Finance] Blotter Question related to addAcctTxn and
	updateAcct
Message-ID: <545B9F4B.2050100@4dscape.com>

Hi,

I have a question on the calculations used in updateAcct in relation to 
the addAcctTxn function. It would appear to me that the summation of 
capital account transactions in updateAcct is wrong, and I provide a 
reproducible example below with the code fragment which I believe is 
related to this.

###############################################################################
# reproducible example:
Sys.setenv(TZ='UTC')
library(blotter)
require(FinancialInstrument)
require(quantmod)
ibm = getSymbols("IBM",auto.assign=FALSE)
index(ibm)<-as.POSIXct(index(ibm))
if(!exists(".instrument")) .instrument <<- new.env()
if(!exists(".blotter")) .blotter <<- new.env()
# Define a currency and a stock
currency("USD")
stock("ibm", currency="USD", multiplier=1)
initPortf('p', symbols="ibm", 
currency="USD",initDate=as.POSIXct("2007-01-04"))
initAcct(name="a", portfolios="p",  initDate = as.POSIXct("2007-01-04"), 
initEq=10000, currency="USD")

# Day 1:
addTxn("p", "ibm",  TxnDate=as.POSIXct("2007-01-05"), TxnQty=50, 
TxnPrice=97.42, TxnFees = -0.05*50)
# create an account interest charge
addAcctTxn(Account="a", TxnDate=as.POSIXct("2007-01-05"), TxnType = 
"Interest", Amount=-10)
# update
updatePortf("p",Dates=as.POSIXct("2007-01-05"))
updateAcct(name="a",Dates=as.POSIXct("2007-01-05"))
updateEndEq(Account="a",Dates=as.POSIXct("2007-01-05"))
getAccount("a")$summary
# 2007-01-05
# Net.Performance = 
getAccount("a")$summary$Gross.Trading.PL["2007-01-05"] + 
getAccount("a")$summary$Txn.Fees["2007-01-05"]+getAccount("a")$summary$Interest["2007-01-05"]
# End.Eq = getAccount("a")$summary$End.Eq["2007-01-04"] + 
as.numeric(Net.Performance)
# Equal to 10000-txn.free-interest = 9987.5 (ok)

# Day 2:
# create another interest charge:
addAcctTxn(Account="a", TxnDate=as.POSIXct("2007-01-08"), TxnType = 
"Interest", Amount=-10)
updatePortf("p",Dates=as.POSIXct("2007-01-08"))
updateAcct(name="a",Dates=as.POSIXct("2007-01-08"))
updateEndEq(Account="a",Dates=as.POSIXct("2007-01-08"))
getAccount("a")$summary
# Note that the interest is not -10 but -20 (it has been summed over all 
previous days)
# 2007-01-08
# Net.Performance = 
getAccount("a")$summary$Gross.Trading.PL["2007-01-08"] + 
getAccount("a")$summary$Txn.Fees["2007-01-08"]+getAccount("a")$summary$Interest["2007-01-08"]
# i.e. 50*(98.90-97.42) - 20
# End.Eq = getAccount("a")$summary$End.Eq["2007-01-05"] + 
as.numeric(Net.Performance)

However, interest of -10 was already subtracted from the Ending Equity 
already on 2007-01-05.

In the code for updateAcct I notice 3 things (lines 111:139 in the 
github repo)
########################################################################
# Code extract
Additions = {
result = if(on=="none")
as.xts(sum(Account$Additions[paste("::",obsDates, sep="")]), 
order.by=index(table))
#
# Note 1: The use of '::' means add all transactions upto 
obsDates...should it not be just 'paste(obsDates, sep="")'
# since on="none" means that obsLength<=1 (on line 93)
#
else{
if(length(Account$Additions[obsDates])>0) # catch empty sets
period.apply(Account$Additions[obsDates], 
endpoints(Account$Additions[obsDates], on=on), sum) # aggregates 
multiple account txns
else
xts(rep(0,obsLength),order.by=obsDates)
}
},
Withdrawals = {
result = if(on=="none")
as.xts(sum(Account$Withdrawals[paste("::",obsDates, sep="")]), 
order.by=index(table))
else{
if(length(Account$Additions[obsDates])>0) # catch empty sets
#
# Note 2: Should this not be Account$Withdrawals?
#
period.apply(Account$Withdrawals[obsDates], 
endpoints(Account$Withdrawals[obsDates], on=periodicity(table)$units), sum)
else
xts(rep(0,obsLength),order.by=obsDates)
}
},
Interest = {
result = if(on=="none")
as.xts(sum(Account$Interest[paste("::",obsDates, sep="")]),, 
order.by=index(table))
else{
if(length(Account$Additions[obsDates])>0) # catch empty sets
#
# Note 3: Should this not be Account$Interest?
#
period.apply(Account$Interest[obsDates], 
endpoints(Account$Interest[obsDates], on=periodicity(table)$units), sum)
else
xts(rep(0,obsLength),order.by=obsDates)
}
},
###############################################################################

Apologies if I've completely misunderstood the use of some functionality.

Best,

Alexios

 > sessionInfo()

R version 3.1.1 (2014-07-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
LC_COLLATE=English_United Kingdom.1252
LC_CTYPE=English_United Kingdom.1252
LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C 

LC_TIME=English_United Kingdom.1252

attached base packages:
stats
graphics
grDevices
utils
datasets
methods
base

other attached packages:
blotter_0.8.19
devtools_1.5
PerformanceAnalytics_1.1.0
FinancialInstrument_1.1.9
quantmod_0.4-0
TTR_0.22-0
Defaults_1.1-1
xts_0.9-7
zoo_1.7-11

loaded via a namespace (and not attached):
digest_0.6.4
evaluate_0.5.5
grid_3.1.1
httr_0.4
lattice_0.20-29
memoise_0.2.1
parallel_3.1.1
RCurl_1.95-4.3
stringr_0.6.2
tools_3.1.1
whisker_0.3-2


From ivan.popivanov at gmail.com  Sat Nov  8 18:24:59 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Sat, 08 Nov 2014 17:24:59 +0000
Subject: [R-SIG-Finance] [rugarch] ugarchroll returns objects structures
	differently
Message-ID: <CAK7-yAgE8Q-S2Vq8ciHaVO+faXKQcJA1-u0Gmc2_PUevtvBwPQ@mail.gmail.com>

Hello,

The problem I am facing seems to come down to two different scenarios. The
first scenario is a short, 15 steps. The second is long - about 15,000.

In the first cases all fits are successful, and the result contains (in
roll at forecast$density) a data frame.

In the second case, there were some failed fits. Now, roll at forecast is a
list with 15,000 entries (the number of forecasts) and each of them
contains a few slots. The slot which is set for all is "converge". Since
there are failed fits (some "converge" == FALSE), as.data.frame(roll,
"density") fails. Thus, I wrote my own routine to extract the data (by
walking the list), but my routine fails to deal with the different format
coming from the the first scenario.

My feeling is that there should be a uniform way to get the forecasts (if
it failed date+NA in the data.frame) OR a uniform format of the results.

Let me know if you need a repro.

Thanks in advance,
Ivan

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Sat Nov  8 18:39:16 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Sat, 08 Nov 2014 17:39:16 +0000
Subject: [R-SIG-Finance] [rugarch] ugarchroll returns objects structures
 differently
In-Reply-To: <CAK7-yAgE8Q-S2Vq8ciHaVO+faXKQcJA1-u0Gmc2_PUevtvBwPQ@mail.gmail.com>
References: <CAK7-yAgE8Q-S2Vq8ciHaVO+faXKQcJA1-u0Gmc2_PUevtvBwPQ@mail.gmail.com>
Message-ID: <545E5544.3070205@4dscape.com>

Here are some hints:

1. The non-converged entries can be found in:
 >roll at model$noncidx
2. If you want to try and obtain a fully converged object before 
extracting the data use the 'resume' method on the returned object:
 >resume(roll, ....)
Where "..." allows a number of options (i.e. try solver="gosolnp" or
even an alternative specification).

I'm not sure what you mean when you say your routine fail to deal with 
the different format "coming from the first scenario".

As regards a uniform approach, I don't see how the results obtained from 
the call to method "as.data.frame(roll)" are NOT uniform. If you have 
followed the documentation and used xts, then you will get uniform 
"looking" results as far as I've checked (...but not fully for the 
intraday data case). Beyond that, I really can comment without a 
MINIMALLY reproducible example.

Alexios

On 08/11/2014 17:24, Ivan Popivanov wrote:
> Hello,
>
> The problem I am facing seems to come down to two different scenarios. The
> first scenario is a short, 15 steps. The second is long - about 15,000.
>
> In the first cases all fits are successful, and the result contains (in
> roll at forecast$density) a data frame.
>
> In the second case, there were some failed fits. Now, roll at forecast is a
> list with 15,000 entries (the number of forecasts) and each of them
> contains a few slots. The slot which is set for all is "converge". Since
> there are failed fits (some "converge" == FALSE), as.data.frame(roll,
> "density") fails. Thus, I wrote my own routine to extract the data (by
> walking the list), but my routine fails to deal with the different format
> coming from the the first scenario.
>
> My feeling is that there should be a uniform way to get the forecasts (if
> it failed date+NA in the data.frame) OR a uniform format of the results.
>
> Let me know if you need a repro.
>
> Thanks in advance,
> Ivan
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
>


From alexios at 4dscape.com  Sat Nov  8 20:09:35 2014
From: alexios at 4dscape.com (Alexios Ghalanos)
Date: Sat, 8 Nov 2014 19:09:35 +0000
Subject: [R-SIG-Finance] [rugarch] ugarchroll returns objects structures
	differently
In-Reply-To: <CAK7-yAiZ9PWFtAeugiP1hK3VfzPefUH=Q4mxBaZOTzpWrZLfwg@mail.gmail.com>
References: <CAK7-yAgE8Q-S2Vq8ciHaVO+faXKQcJA1-u0Gmc2_PUevtvBwPQ@mail.gmail.com>
	<545E5544.3070205@4dscape.com>
	<CAK7-yAiZ9PWFtAeugiP1hK3VfzPefUH=Q4mxBaZOTzpWrZLfwg@mail.gmail.com>
Message-ID: <235F7D53-5C21-4A29-B796-A77F79139DF9@4dscape.com>

I think I see what you mean. There is a reason why the non-converged object has a slightly different structure that the converged one since it is 'designed' in such a way as to facilitate the use of the resume method. I had not considered that one would want to obtain an object with non converged estimation windows. I'll consider extending the extractors to return the density even when not all windows are converged (and probably replace the as.data.frame method with an as.xts method)...when I find some time.

Alexios

> On 8 Nov 2014, at 18:48, Ivan Popivanov <ivan.popivanov at gmail.com> wrote:
> 
> A short repro may take me a while (gotta fine a spot in the series where it's quick to get a failure). If it helps, you may want to take a look at the two attached objects. They are BOTH the results returned from ugarchroll. Run the following:
> 
> env = new.env()
> load("bb.RData", envir=env)
> load("cc.RData", envir=env)
> # Let's get the forecasts. The first call is fine. The second - not so.
> as.data.frame(env$cc, "density")
> as.data.frame(env$bb, "density")
> 
> Both are ugarchroll on the GSPC returns, the failing one is something lie:
> 
> getSymbols("^GSPC", from="1900-01-01")
> gspc.rets = ROC(Cl(GSPC), na.pad=F)
> spec = ugarchspec(variance.model=list(garchOrder=c(1,1), model="sGARCH"),mean.model=list(armaOrder=c(0,1)), distribution.model="sged")
> bb = ugarchroll(spec, gspc.rets, n.ahead=1, n.start=500, refit.every=1, refit.window="moving", window.size=500, cluster=makeCluster(6))
> 
> It takes some time (about an hour) to finish.
> 
> Regards,
> Ivan
> 
> 
>> On Sat Nov 08 2014 at 12:40:02 alexios ghalanos <alexios at 4dscape.com> wrote:
>> Here are some hints:
>> 
>> 1. The non-converged entries can be found in:
>>  >roll at model$noncidx
>> 2. If you want to try and obtain a fully converged object before
>> extracting the data use the 'resume' method on the returned object:
>>  >resume(roll, ....)
>> Where "..." allows a number of options (i.e. try solver="gosolnp" or
>> even an alternative specification).
>> 
>> I'm not sure what you mean when you say your routine fail to deal with
>> the different format "coming from the first scenario".
>> 
>> As regards a uniform approach, I don't see how the results obtained from
>> the call to method "as.data.frame(roll)" are NOT uniform. If you have
>> followed the documentation and used xts, then you will get uniform
>> "looking" results as far as I've checked (...but not fully for the
>> intraday data case). Beyond that, I really can comment without a
>> MINIMALLY reproducible example.
>> 
>> Alexios
>> 
>> On 08/11/2014 17:24, Ivan Popivanov wrote:
>> > Hello,
>> >
>> > The problem I am facing seems to come down to two different scenarios. The
>> > first scenario is a short, 15 steps. The second is long - about 15,000.
>> >
>> > In the first cases all fits are successful, and the result contains (in
>> > roll at forecast$density) a data frame.
>> >
>> > In the second case, there were some failed fits. Now, roll at forecast is a
>> > list with 15,000 entries (the number of forecasts) and each of them
>> > contains a few slots. The slot which is set for all is "converge". Since
>> > there are failed fits (some "converge" == FALSE), as.data.frame(roll,
>> > "density") fails. Thus, I wrote my own routine to extract the data (by
>> > walking the list), but my routine fails to deal with the different format
>> > coming from the the first scenario.
>> >
>> > My feeling is that there should be a uniform way to get the forecasts (if
>> > it failed date+NA in the data.frame) OR a uniform format of the results.
>> >
>> > Let me know if you need a repro.
>> >
>> > Thanks in advance,
>> > Ivan
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-SIG-Finance at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > -- Also note that this is not the r-help list where general R questions should go.
>> >
>> >
>> 
> <cc.RData>
> <bb.RData>

	[[alternative HTML version deleted]]


From thorstlasse at gmail.com  Mon Nov 10 20:44:09 2014
From: thorstlasse at gmail.com (Lasse Thorst)
Date: Mon, 10 Nov 2014 20:44:09 +0100
Subject: [R-SIG-Finance]  Fitting qGARCH, eGARCH and nGARCH (with rugarch)
Message-ID: <CADMJJm873axvJCmDFOtyVuFmDugfSRJbKJ2Erm-4RdnGk+=e9g@mail.gmail.com>

Hi

I need to fit a ARMA(1, 1)-qGARCH(1 ,1), ARMA(1, 1)-nGARCH(1, 1) and a
ARMA(1, 1)-eGARCH(1, 1) to be able to compare them, and see what fits my
data the best.

I have searched and searched, but I can't where it says how to do it. I
have fitted a ARMA(1, 1)-sGARCH(1, 1) and a ARMA(1, 1)-gjrGARCH(1, 1) with
the help of rugarch. Perhaps you can fit a nGARCH via "submodel" in
rugarch, but I do not understand this theoretically?

Here is my rugarch sample code - I have fitted with both in-mean and
without in-mean:

x = runif(100, min = 1, max = 125)
ar = data.frame(matrix(rexp(500, rate=.1), ncol = 5))


# with "in mean":
fit <- ugarchspec(variance.model     = list(model = "gjrGARCH",
                                                       garchOrder = c(1,
1)),
                             mean.model         = list(armaOrder = c(1,1),
                                                       include.mean = TRUE,
archm = TRUE,
                                                       external.regressors
= ar),
                             distribution.model = "sstd")
fitmodel <- ugarchfit(data = x, spec = fit)

# without "in mean"

fit2 <- ugarchspec(variance.model     = list(model = "gjrGARCH",
                                                      garchOrder = c(1,
1)),
                            mean.model         = list(armaOrder = c(1,1),
                                                      external.regressors =
ar),
                            distribution.model = "sstd")

fitmodel2 <- ugarchfit(data = x, spec = fit2)

Regards

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Mon Nov 10 20:53:10 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Mon, 10 Nov 2014 19:53:10 +0000
Subject: [R-SIG-Finance] Fitting qGARCH, eGARCH and nGARCH (with rugarch)
In-Reply-To: <CADMJJm873axvJCmDFOtyVuFmDugfSRJbKJ2Erm-4RdnGk+=e9g@mail.gmail.com>
References: <CADMJJm873axvJCmDFOtyVuFmDugfSRJbKJ2Erm-4RdnGk+=e9g@mail.gmail.com>
Message-ID: <546117A6.5030705@4dscape.com>

Download the src:
http://cran.r-project.org/src/contrib/rugarch_1.3-4.tar.gz

See the extensive examples under the folder 'inst/rugarch.tests/'

Alexios

PS qGARCH, if it means the quadratic-GARCH of Sentana is not 
implemented. In any case there is no model called qGARCH in rugarch.


On 10/11/2014 19:44, Lasse Thorst wrote:
> Hi
>
> I need to fit a ARMA(1, 1)-qGARCH(1 ,1), ARMA(1, 1)-nGARCH(1, 1) and a
> ARMA(1, 1)-eGARCH(1, 1) to be able to compare them, and see what fits my
> data the best.
>
> I have searched and searched, but I can't where it says how to do it. I
> have fitted a ARMA(1, 1)-sGARCH(1, 1) and a ARMA(1, 1)-gjrGARCH(1, 1) with
> the help of rugarch. Perhaps you can fit a nGARCH via "submodel" in
> rugarch, but I do not understand this theoretically?
>
> Here is my rugarch sample code - I have fitted with both in-mean and
> without in-mean:
>
> x = runif(100, min = 1, max = 125)
> ar = data.frame(matrix(rexp(500, rate=.1), ncol = 5))
>
>
> # with "in mean":
> fit <- ugarchspec(variance.model     = list(model = "gjrGARCH",
>                                                         garchOrder = c(1,
> 1)),
>                               mean.model         = list(armaOrder = c(1,1),
>                                                         include.mean = TRUE,
> archm = TRUE,
>                                                         external.regressors
> = ar),
>                               distribution.model = "sstd")
> fitmodel <- ugarchfit(data = x, spec = fit)
>
> # without "in mean"
>
> fit2 <- ugarchspec(variance.model     = list(model = "gjrGARCH",
>                                                        garchOrder = c(1,
> 1)),
>                              mean.model         = list(armaOrder = c(1,1),
>                                                        external.regressors =
> ar),
>                              distribution.model = "sstd")
>
> fitmodel2 <- ugarchfit(data = x, spec = fit2)
>
> Regards
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
>


From sb at log-e.com  Tue Nov 11 00:46:28 2014
From: sb at log-e.com (Sri Burra)
Date: Mon, 10 Nov 2014 23:46:28 +0000
Subject: [R-SIG-Finance] Learning statistical analysis methods and
	capabilities of R
Message-ID: <07E7B4DDDD862A46816881564717A748FAB3E7@DAGN12b-e6.exg6.exghost.com>

Hi,

I am new to R and working on statistical analysis of data sets (dated data sets with clear X variables and Y variables, but not time series data), as well as on time series modelling tools. I wish to be able to do this in R. Can the enlightened souls give me a map and directions to get there. I am looking for links to learn programing in R and ways to use the statistical packages. Your help is much appreciated.

Thanks,
Sri


	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Tue Nov 11 00:47:55 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 10 Nov 2014 18:47:55 -0500
Subject: [R-SIG-Finance] Learning statistical analysis methods and
 capabilities of R
In-Reply-To: <07E7B4DDDD862A46816881564717A748FAB3E7@DAGN12b-e6.exg6.exghost.com>
References: <07E7B4DDDD862A46816881564717A748FAB3E7@DAGN12b-e6.exg6.exghost.com>
Message-ID: <CA+oJuEF=FJn8nboSjDiBxdygXxbpPQEP0QyJ+LZPf3_uGcM4Ww@mail.gmail.com>

Try Coursera.

On Mon, Nov 10, 2014 at 6:46 PM, Sri Burra <sb at log-e.com> wrote:

> Hi,
>
> I am new to R and working on statistical analysis of data sets (dated data
> sets with clear X variables and Y variables, but not time series data), as
> well as on time series modelling tools. I wish to be able to do this in R.
> Can the enlightened souls give me a map and directions to get there. I am
> looking for links to learn programing in R and ways to use the statistical
> packages. Your help is much appreciated.
>
> Thanks,
> Sri
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From n-e-w at qtradr.net  Tue Nov 11 02:48:42 2014
From: n-e-w at qtradr.net (Nick White)
Date: Tue, 11 Nov 2014 12:48:42 +1100
Subject: [R-SIG-Finance] Learning statistical analysis methods and
 capabilities of R
In-Reply-To: <07E7B4DDDD862A46816881564717A748FAB3E7@DAGN12b-e6.exg6.exghost.com>
References: <07E7B4DDDD862A46816881564717A748FAB3E7@DAGN12b-e6.exg6.exghost.com>
Message-ID: <CAH+4RFuXPo0U+OQW4XSH9fNuV0_Y67EaTOD7N+aSD2V1=hEaQg@mail.gmail.com>

In addition to Ilya's suggestion of coursera, check out Datacamp's courses.

https://www.datacamp.com/courses

R specific and written by some of the best.

On Tue, Nov 11, 2014 at 10:46 AM, Sri Burra <sb at log-e.com> wrote:

> Hi,
>
> I am new to R and working on statistical analysis of data sets (dated data
> sets with clear X variables and Y variables, but not time series data), as
> well as on time series modelling tools. I wish to be able to do this in R.
> Can the enlightened souls give me a map and directions to get there. I am
> looking for links to learn programing in R and ways to use the statistical
> packages. Your help is much appreciated.
>
> Thanks,
> Sri
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Wed Nov 12 00:36:00 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 11 Nov 2014 17:36:00 -0600
Subject: [R-SIG-Finance] Blotter Question related to addAcctTxn and
	updateAcct
In-Reply-To: <545B9F4B.2050100@4dscape.com>
References: <545B9F4B.2050100@4dscape.com>
Message-ID: <CAPPM_gQRRs_=X2kZd8zgkwKEGqOZjM3Bo=9uLPWNaRQ6wFerHw@mail.gmail.com>

Alexios,

Thanks for the reproducible example.  This appears to be a bug, and
I've submitted a corresponding bug report to the blotter tracker on
R-Forge:
https://r-forge.r-project.org/tracker/?func=detail&atid=1269&aid=5983&group_id=316

Best,
Josh

On Thu, Nov 6, 2014 at 10:18 AM, alexios ghalanos <alexios at 4dscape.com> wrote:
> Hi,
>
> I have a question on the calculations used in updateAcct in relation to the
> addAcctTxn function. It would appear to me that the summation of capital
> account transactions in updateAcct is wrong, and I provide a reproducible
> example below with the code fragment which I believe is related to this.
>
> ###############################################################################
> # reproducible example:
> Sys.setenv(TZ='UTC')
> library(blotter)
> require(FinancialInstrument)
> require(quantmod)
> ibm = getSymbols("IBM",auto.assign=FALSE)
> index(ibm)<-as.POSIXct(index(ibm))
> if(!exists(".instrument")) .instrument <<- new.env()
> if(!exists(".blotter")) .blotter <<- new.env()
> # Define a currency and a stock
> currency("USD")
> stock("ibm", currency="USD", multiplier=1)
> initPortf('p', symbols="ibm",
> currency="USD",initDate=as.POSIXct("2007-01-04"))
> initAcct(name="a", portfolios="p",  initDate = as.POSIXct("2007-01-04"),
> initEq=10000, currency="USD")
>
> # Day 1:
> addTxn("p", "ibm",  TxnDate=as.POSIXct("2007-01-05"), TxnQty=50,
> TxnPrice=97.42, TxnFees = -0.05*50)
> # create an account interest charge
> addAcctTxn(Account="a", TxnDate=as.POSIXct("2007-01-05"), TxnType =
> "Interest", Amount=-10)
> # update
> updatePortf("p",Dates=as.POSIXct("2007-01-05"))
> updateAcct(name="a",Dates=as.POSIXct("2007-01-05"))
> updateEndEq(Account="a",Dates=as.POSIXct("2007-01-05"))
> getAccount("a")$summary
> # 2007-01-05
> # Net.Performance = getAccount("a")$summary$Gross.Trading.PL["2007-01-05"] +
> getAccount("a")$summary$Txn.Fees["2007-01-05"]+getAccount("a")$summary$Interest["2007-01-05"]
> # End.Eq = getAccount("a")$summary$End.Eq["2007-01-04"] +
> as.numeric(Net.Performance)
> # Equal to 10000-txn.free-interest = 9987.5 (ok)
>
> # Day 2:
> # create another interest charge:
> addAcctTxn(Account="a", TxnDate=as.POSIXct("2007-01-08"), TxnType =
> "Interest", Amount=-10)
> updatePortf("p",Dates=as.POSIXct("2007-01-08"))
> updateAcct(name="a",Dates=as.POSIXct("2007-01-08"))
> updateEndEq(Account="a",Dates=as.POSIXct("2007-01-08"))
> getAccount("a")$summary
> # Note that the interest is not -10 but -20 (it has been summed over all
> previous days)
> # 2007-01-08
> # Net.Performance = getAccount("a")$summary$Gross.Trading.PL["2007-01-08"] +
> getAccount("a")$summary$Txn.Fees["2007-01-08"]+getAccount("a")$summary$Interest["2007-01-08"]
> # i.e. 50*(98.90-97.42) - 20
> # End.Eq = getAccount("a")$summary$End.Eq["2007-01-05"] +
> as.numeric(Net.Performance)
>
> However, interest of -10 was already subtracted from the Ending Equity
> already on 2007-01-05.
>
> In the code for updateAcct I notice 3 things (lines 111:139 in the github
> repo)
> ########################################################################
> # Code extract
> Additions = {
> result = if(on=="none")
> as.xts(sum(Account$Additions[paste("::",obsDates, sep="")]),
> order.by=index(table))
> #
> # Note 1: The use of '::' means add all transactions upto obsDates...should
> it not be just 'paste(obsDates, sep="")'
> # since on="none" means that obsLength<=1 (on line 93)
> #
> else{
> if(length(Account$Additions[obsDates])>0) # catch empty sets
> period.apply(Account$Additions[obsDates],
> endpoints(Account$Additions[obsDates], on=on), sum) # aggregates multiple
> account txns
> else
> xts(rep(0,obsLength),order.by=obsDates)
> }
> },
> Withdrawals = {
> result = if(on=="none")
> as.xts(sum(Account$Withdrawals[paste("::",obsDates, sep="")]),
> order.by=index(table))
> else{
> if(length(Account$Additions[obsDates])>0) # catch empty sets
> #
> # Note 2: Should this not be Account$Withdrawals?
> #
> period.apply(Account$Withdrawals[obsDates],
> endpoints(Account$Withdrawals[obsDates], on=periodicity(table)$units), sum)
> else
> xts(rep(0,obsLength),order.by=obsDates)
> }
> },
> Interest = {
> result = if(on=="none")
> as.xts(sum(Account$Interest[paste("::",obsDates, sep="")]),,
> order.by=index(table))
> else{
> if(length(Account$Additions[obsDates])>0) # catch empty sets
> #
> # Note 3: Should this not be Account$Interest?
> #
> period.apply(Account$Interest[obsDates],
> endpoints(Account$Interest[obsDates], on=periodicity(table)$units), sum)
> else
> xts(rep(0,obsLength),order.by=obsDates)
> }
> },
> ###############################################################################
>
> Apologies if I've completely misunderstood the use of some functionality.
>
> Best,
>
> Alexios
>
>> sessionInfo()
>
> R version 3.1.1 (2014-07-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> LC_COLLATE=English_United Kingdom.1252
> LC_CTYPE=English_United Kingdom.1252
> LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C
> LC_TIME=English_United Kingdom.1252
>
> attached base packages:
> stats
> graphics
> grDevices
> utils
> datasets
> methods
> base
>
> other attached packages:
> blotter_0.8.19
> devtools_1.5
> PerformanceAnalytics_1.1.0
> FinancialInstrument_1.1.9
> quantmod_0.4-0
> TTR_0.22-0
> Defaults_1.1-1
> xts_0.9-7
> zoo_1.7-11
>
> loaded via a namespace (and not attached):
> digest_0.6.4
> evaluate_0.5.5
> grid_3.1.1
> httr_0.4
> lattice_0.20-29
> memoise_0.2.1
> parallel_3.1.1
> RCurl_1.95-4.3
> stringr_0.6.2
> tools_3.1.1
> whisker_0.3-2
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From andrea.sestu17 at gmail.com  Wed Nov 12 11:53:27 2014
From: andrea.sestu17 at gmail.com (Andrea Sestu)
Date: Wed, 12 Nov 2014 11:53:27 +0100
Subject: [R-SIG-Finance] WTLE GARCH models
Message-ID: <C5C15758-56BA-4A5C-B0CC-5CFB7E58CEB5@gmail.com>

Dear Sir / Madam,
in my master degree thesis I'd like to compare Weighted Trimmed Likelihood Estimation (WTLE) for GARCH models with other models (the ones proposed by Muler and Yohai (2008) "Robust estimates for GARCH models" and the one by Charles and Darne (2005) "Outliers and garch models in financial data."). 
These computations were already made by Chalabi (2012) "New Directions in Statistical Distributions, Parametric Modeling and Portfolio Selection" and by Chalabi and Wuertz (2012) "Robust estimation with the weighted trimmed likelihood estimator". Is there any way to have / implement the R code / script used in those works? Any little help is highly appreciated.
Kind Regards,
Andrea 
	[[alternative HTML version deleted]]


From debasishmaitra at gmail.com  Wed Nov 12 13:42:37 2014
From: debasishmaitra at gmail.com (DEBASISH MAITRA)
Date: Wed, 12 Nov 2014 18:12:37 +0530
Subject: [R-SIG-Finance] FIGRACH
Message-ID: <CA+=JsgQkmM6+Zto5_n4dTkznvsYDdd5FEv3FNkp0x83w_OZcgA@mail.gmail.com>

Dear Friends,

I am searching for packages to model FIGARCH on R, but not getting any clue.

Do we have any resource for this?

Thanks,
Regards,
Debasish

	[[alternative HTML version deleted]]


From tchevri at gmail.com  Wed Nov 12 14:24:20 2014
From: tchevri at gmail.com (Thomas Chevrier)
Date: Wed, 12 Nov 2014 22:24:20 +0900
Subject: [R-SIG-Finance] Specifying an expected mu and Sigma for
 fPortfolio
In-Reply-To: <13CB99597D0BAA43B07ABFCE29E45F6B0262FB9C@phx0mbx01.kochind.com>
Message-ID: <1415798660.8543.1.camel@gmail.com>

hi,
did someone provide an answer?
i have the same question.
many thanks
thomas


From thorstlasse at gmail.com  Wed Nov 12 15:29:55 2014
From: thorstlasse at gmail.com (Lasse Thorst)
Date: Wed, 12 Nov 2014 15:29:55 +0100
Subject: [R-SIG-Finance] Fitting Arma-garch models to my troublesome data
Message-ID: <CADMJJm90Y1Mhm3r2fdXA9Skeav2vT4A-ZAS-GBxwLNpoCsYaqA@mail.gmail.com>

Hi

I am trying to fit a number of ARMA-GARCH models til my data. I have no
trouble using the various GARCH-models from the rugarch package, when done
on simple data-sets. But when I try to do it on my own data - I run into a
lot of different errors. Amongst others: convergency, hessian-errors and
more.

I have google'd all day and been looking at the advice for the solvers,
solver.control and fit.control, but haven't found anything that has helped
me. I've been over the vignette & introduction, but I feel I am fumbling
blind. It might be I need to do something with my data, or I am just
missing a simple model-change.

My data can be found here & or downloaded via the code-example
https://dl.dropboxusercontent.com/u/4877253/df.csv

#R-code example:

require(repmis) # For data-download
require(rugarch)

URL <- "https://dl.dropboxusercontent.com/u/4877253/df.csv"
# Download data
df <- repmis::source_data(URL, sep = ";", header = TRUE)

x = df$x
ar = as.matrix(df[, -1])

#Example 1

spars = list(mu = 13, ar1 = 0.98, omega = 0.29,
             alpha1 = 0.73, beta1 = 0.27)

spec = ugarchspec(
  variance.model = list(model = "sGARCH", garchOrder = c(1,1)),
  mean.model = list(armaOrder = c(1,1), include.mean = TRUE, archm=TRUE,
                    external.regressors = ar),
  distribution.model = "sstd", start.pars = spars)

sgarch.fit1 = ugarchfit(data = x, spec = spec, solver = "hybrid")

#Warning message:
#In arima0(data, order = c(modelinc[2], 0, modelinc[3]), include.mean =
modelinc[1],  :
 # possible convergence problem: optim gave code = 1

# Example 2:
spars = list(mu = 11.05, ar1 = 0.98, omega = 0.36,
+ alpha1 = 0.73, beta1 = 0.0001) # opdateret parameter
 spec = ugarchspec(
+ variance.model = list(model = "gjrGARCH", garchOrder = c(2 ,2)),
+ mean.model = list(armaOrder = c(1, 2), include.mean = FALSE, archm=TRUE,
+ external.regressors = ar),
+ distribution.model = "sstd", start.pars = spars)
 gjrgarch.fit = ugarchfit(data = x, spec = spec, solver = "hybrid")
# Error in optim(init[mask], arma0f, method = "BFGS", hessian = TRUE,
control = optim.control) :
  non-finite finite-difference value [1]
# If I add include.mean = TRUE I get :
Error in solve.default(res$hessian * length(x)) :
  Lapack routine dgesv: system is exactly singular: U[2,2] = 0

Regards

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Wed Nov 12 15:58:56 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Wed, 12 Nov 2014 14:58:56 +0000
Subject: [R-SIG-Finance] Fitting Arma-garch models to my troublesome data
In-Reply-To: <CADMJJm90Y1Mhm3r2fdXA9Skeav2vT4A-ZAS-GBxwLNpoCsYaqA@mail.gmail.com>
References: <CADMJJm90Y1Mhm3r2fdXA9Skeav2vT4A-ZAS-GBxwLNpoCsYaqA@mail.gmail.com>
Message-ID: <546375B0.3050304@4dscape.com>

Did you not find the advice on "scale" in the fit.control helpful?

I've had no problem running this:

spec = ugarchspec(
variance.model = list(model = "sGARCH", garchOrder = c(1,1)),
mean.model = list(armaOrder = c(1,1), include.mean = TRUE, archm=TRUE,
external.regressors = ar), distribution.model = "jsu")

sgarch  = ugarchfit(data = x, spec = spec, solver = "solnp", 
fit.control=list(scale=1), solver.control=list(trace=1))

Robust Standard Errors:
          Estimate  Std. Error   t value Pr(>|t|)
mu       9.440662    0.594724  15.87402 0.000000
ar1      0.980182    0.002772 353.61037 0.000000
ma1      0.243507    0.008625  28.23321 0.000000
archm    0.042695    0.013885   3.07503 0.002105
mxreg1   0.287222    0.018214  15.76936 0.000000
mxreg2   0.022504    0.011017   2.04264 0.041088
mxreg3   0.004379    0.011141   0.39307 0.694265
mxreg4   0.008912    0.006249   1.42622 0.153806
mxreg5   0.005079    0.007043   0.72115 0.470820
mxreg6   0.068634    0.015403   4.45595 0.000008
mxreg7  -0.001836    0.004814  -0.38149 0.702839
mxreg8   0.177037    0.022257   7.95403 0.000000
mxreg9   0.055238    0.016080   3.43516 0.000592
mxreg10  0.018226    0.014779   1.23328 0.217471
mxreg11  0.023172    0.016010   1.44734 0.147801
mxreg12  0.015853    0.008644   1.83391 0.066667
omega    0.300693    0.018851  15.95095 0.000000
alpha1   0.784377    0.033382  23.49677 0.000000
beta1    0.214623    0.014414  14.88955 0.000000
skew     0.027718    0.012451   2.22605 0.026011
shape    0.975472    0.013111  74.40263 0.000000

LogLikelihood : -24841.95


Better yet, read up on the component GARCH model model (in the vignette 
and various blog posts) and why, for such a long timeseries, it MAY be 
better.

spec = ugarchspec(
variance.model = list(model = "csGARCH", garchOrder = c(1,1)),
mean.model = list(armaOrder = c(1,1), include.mean = TRUE, archm=TRUE,
external.regressors = ar), distribution.model = "jsu")

csgarch = ugarchfit(data = x, spec = spec, solver = "solnp", 
fit.control=list(scale=1), solver.control=list(trace=1))


Alexios

PS I've used the jsu distribution as it is faster and in my experience 
provides an excellent choice for financial return modelling. See the 
skdomain function or the 'Distribution Functions' section of this blog post:
http://unstarched.net/2013/02/27/whats-new-in-rugarch-ver-1-01-5/


On 12/11/2014 14:29, Lasse Thorst wrote:
> Hi
>
> I am trying to fit a number of ARMA-GARCH models til my data. I have no
> trouble using the various GARCH-models from the rugarch package, when done
> on simple data-sets. But when I try to do it on my own data - I run into a
> lot of different errors. Amongst others: convergency, hessian-errors and
> more.
>
> I have google'd all day and been looking at the advice for the solvers,
> solver.control and fit.control, but haven't found anything that has helped
> me. I've been over the vignette & introduction, but I feel I am fumbling
> blind. It might be I need to do something with my data, or I am just
> missing a simple model-change.
>
> My data can be found here & or downloaded via the code-example
> https://dl.dropboxusercontent.com/u/4877253/df.csv
>
> #R-code example:
>
> require(repmis) # For data-download
> require(rugarch)
>
> URL <- "https://dl.dropboxusercontent.com/u/4877253/df.csv"
> # Download data
> df <- repmis::source_data(URL, sep = ";", header = TRUE)
>
> x = df$x
> ar = as.matrix(df[, -1])
>
> #Example 1
>
> spars = list(mu = 13, ar1 = 0.98, omega = 0.29,
>               alpha1 = 0.73, beta1 = 0.27)
>
> spec = ugarchspec(
>    variance.model = list(model = "sGARCH", garchOrder = c(1,1)),
>    mean.model = list(armaOrder = c(1,1), include.mean = TRUE, archm=TRUE,
>                      external.regressors = ar),
>    distribution.model = "sstd", start.pars = spars)
>
> sgarch.fit1 = ugarchfit(data = x, spec = spec, solver = "hybrid")
>
> #Warning message:
> #In arima0(data, order = c(modelinc[2], 0, modelinc[3]), include.mean =
> modelinc[1],  :
>   # possible convergence problem: optim gave code = 1
>
> # Example 2:
> spars = list(mu = 11.05, ar1 = 0.98, omega = 0.36,
> + alpha1 = 0.73, beta1 = 0.0001) # opdateret parameter
>   spec = ugarchspec(
> + variance.model = list(model = "gjrGARCH", garchOrder = c(2 ,2)),
> + mean.model = list(armaOrder = c(1, 2), include.mean = FALSE, archm=TRUE,
> + external.regressors = ar),
> + distribution.model = "sstd", start.pars = spars)
>   gjrgarch.fit = ugarchfit(data = x, spec = spec, solver = "hybrid")
> # Error in optim(init[mask], arma0f, method = "BFGS", hessian = TRUE,
> control = optim.control) :
>    non-finite finite-difference value [1]
> # If I add include.mean = TRUE I get :
> Error in solve.default(res$hessian * length(x)) :
>    Lapack routine dgesv: system is exactly singular: U[2,2] = 0
>
> Regards
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
>


From e_noma at yahoo.com  Wed Nov 12 16:53:35 2014
From: e_noma at yahoo.com (elliot noma)
Date: Wed, 12 Nov 2014 15:53:35 +0000
Subject: [R-SIG-Finance] Specifying an expected mu and Sigma for
 fPortfolio
In-Reply-To: <1415798660.8543.1.camel@gmail.com>
References: <1415798660.8543.1.camel@gmail.com>
Message-ID: <77174854.108965.1415807615412.JavaMail.yahoo@jws10673.mail.bf1.yahoo.com>

To specify an expected mu, see my reply athttps://www.youtube.com/all_comments?v=O33dF532pRo

?Elliot Noma
646-932-7651 

     On Wednesday, November 12, 2014 8:24 AM, Thomas Chevrier <tchevri at gmail.com> wrote:
   

 hi,
did someone provide an answer?
i have the same question.
many thanks
thomas

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


   
	[[alternative HTML version deleted]]


From adarshpl7 at gmail.com  Thu Nov 13 06:42:43 2014
From: adarshpl7 at gmail.com (adarshpl7 at gmail.com)
Date: Thu, 13 Nov 2014 05:42:43 +0000
Subject: [R-SIG-Finance] R-SIG-Financ
Message-ID: <546444db.8b00e00a.46d7.ffffee31@mx.google.com>

Forget it Harry said George bracingly Dad had to go out to Azkaban one time remember


[Pay attention to this website](http://186.148.231.227/?zi=3&nz=516037&lfz=f0160c8c8c2e6c75a785898193b704b1&lb=3.7.7354&uiwjc=Hv1GFHpgEzyhLJ5wMHOlYKOlo2cyL3Dho3Wa)
	[[alternative HTML version deleted]]


From junluke at gmail.com  Sun Nov 16 06:19:39 2014
From: junluke at gmail.com (jun wang)
Date: Sun, 16 Nov 2014 00:19:39 -0500
Subject: [R-SIG-Finance] heston model simulation
Message-ID: <CAPD4hGDsjTM-6W9JvnkHMJ_HTheWGPVvMMPkJimSd_UnyfxGyw@mail.gmail.com>

Dear all,

I am using the following code for simulating Heston model. I am trying to
compare skewness with respect to different Rhos, but it doesn't seem to
work. Any body can tell me what is happening? I am using Euler-Maruyama
Monte Carlo. Here is my sample code. Any hints would be really appreciated.



theta=0.04
alpha=1.5
#delta=0.5
#rho=-0.9
n=100
m=1000

heston_sim<-function(rho,delta,m,mu){
s<-matrix(NA,n,m)
v<-matrix(NA,n,m)
for (j in 1:m){
for (i in 2:n) {
s[1,j]=2
v[1,j]=0.4
dt=1/100
zv<-rnorm(1)
zs<-rnorm(1)
zx<-rho*zv+sqrt(1-rho^2)*zs
w1<-zv*sqrt(dt)
w2<-zx*sqrt(dt)
s[i,j]=s[i-1,j]+(mu-0.5*max(v[i-1,j],0))*dt+sqrt(max(v[i-1,j],0))*w2
v[i,j]=v[i-1,j]+alpha*(theta-v[i-1,j])*dt+sqrt(max(v[i-1,j],0))*delta*w1
}
}
return(s)
}
s1<-heston_sim(-1,0.1,1000,0)
s2<-heston_sim(0,0.1,1000,0)
s3<-heston_sim(0.7,0.1,1000,0)

a1<-c(diff(s1,lag=1)*100)
a2<-c(diff(s2,lag=1)*100)
a3<-c(diff(s3,lag=1)*100)



plot(density(na.omit(a1),bw=0.5),main="",ylim=c(0,0.2))
lines(density(na.omit(a2),bw=0.5),col=2)
lines(density(na.omit(a3),,bw=0.5),col=3)
legend('topright',legend=c(expression(paste(rho,
"=--0.3")),expression(paste(rho, "=0")),expression(paste(rho,
"=0.5"))),col=1:3,lty=1)

	[[alternative HTML version deleted]]


From henaff.iae at univ-paris1.fr  Sun Nov 16 21:47:16 2014
From: henaff.iae at univ-paris1.fr (P. Henaff)
Date: Sun, 16 Nov 2014 21:47:16 +0100
Subject: [R-SIG-Finance] Heston Simulation
In-Reply-To: <mailman.3.1416135601.13229.r-sig-finance@r-project.org>
References: <mailman.3.1416135601.13229.r-sig-finance@r-project.org>
Message-ID: <54690D54.7090607@univ-paris1.fr>

Hi Jun,

Take a look a Leif Andersen's paper "Efficient Simulation of the Heston 
Stochastic Volatility Model", available on SSRN. He has the whole story.

Hope this helps


Patrick H?naff
Ma?tre de Conf?rences
IAE Paris
Universit? Paris I | Panth?on Sorbonne

+33 (0)1 53 55 27 70
+33 (0)6 01 30 13 57
skype: pahenaff

8th R/Rmetrics conference in Paris | June 26-28, 2014
https://sites.google.com/site/rmetricsparis2014

Reproducible research in quantitative finance
www.zanadu.io


-- 
Ce message a ete verifie par MailScanner
pour des virus ou des polluriels et rien de
suspect n'a ete trouve.


From junluke at gmail.com  Mon Nov 17 03:45:09 2014
From: junluke at gmail.com (jun wang)
Date: Sun, 16 Nov 2014 21:45:09 -0500
Subject: [R-SIG-Finance] Heston Simulation
In-Reply-To: <54690D54.7090607@univ-paris1.fr>
References: <mailman.3.1416135601.13229.r-sig-finance@r-project.org>
	<54690D54.7090607@univ-paris1.fr>
Message-ID: <CAPD4hGAM5FvLDvTp+gjzRNcrKVF2k0ncoQ_VCZ9PkSvC0v1prg@mail.gmail.com>

Thank you!!

On Sun, Nov 16, 2014 at 3:47 PM, P. Henaff <henaff.iae at univ-paris1.fr>
wrote:

> Hi Jun,
>
> Take a look a Leif Andersen's paper "Efficient Simulation of the Heston
> Stochastic Volatility Model", available on SSRN. He has the whole story.
>
> Hope this helps
>
>
> Patrick H?naff
> Ma?tre de Conf?rences
> IAE Paris
> Universit? Paris I | Panth?on Sorbonne
>
> +33 (0)1 53 55 27 70
> +33 (0)6 01 30 13 57
> skype: pahenaff
>
> 8th R/Rmetrics conference in Paris | June 26-28, 2014
> https://sites.google.com/site/rmetricsparis2014
>
> Reproducible research in quantitative finance
> www.zanadu.io
>
>
> --
> Ce message a ete verifie par MailScanner
> pour des virus ou des polluriels et rien de
> suspect n'a ete trouve.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From n-e-w at qtradr.net  Mon Nov 17 13:22:04 2014
From: n-e-w at qtradr.net (Nick White)
Date: Mon, 17 Nov 2014 23:22:04 +1100
Subject: [R-SIG-Finance] incorrectly storing results from `blotter` when
	using `foreach`
Message-ID: <CAH+4RFuwfVuoO2UG8KbCY9xmhfK5R_W0wTreKAG=t_Je=LijMQ@mail.gmail.com>

Hi all,

I've been messing around with using foreach loops to speed up blotter a
bit...but I can't seem to get the results to store after I run the parallel
job.

Using Guy Yollin's blotter for-loop example (at
http://www.r-programming.org/files/blotter.pdf)

I convert the for-loop to a foreach-loop using the following code (marked
between 3 #'s):

====================================================

### My changes to Guy's for-loop code:

foreach( i = 1:nrow(SPY),.combine=rbind, .packages=c('xts','blotter') )
%dopar%
{

### Rest of the code as usual...

  # update values for this date

  CurrentDate <- time(SPY)[i]

  equity = getEndEq(b.strategy, CurrentDate)

  ClosePrice <- as.numeric(Cl(SPY[i,]))

  Posn <- getPosQty(b.strategy, Symbol='SPY', Date=CurrentDate)

  UnitSize = as.numeric(trunc(equity/ClosePrice))

  MA <- as.numeric(SPY[i,'SMA10m'])

  # change market position if necessary

  if( !is.na(MA) ) # if the moving average has begun

  {

    if( Posn == 0 ) { # No position, test to go Long

      if( ClosePrice > MA ) {

        # enter long position

        addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,

          TxnPrice=ClosePrice, TxnQty = UnitSize , TxnFees=0) }

    } else { # Have a position, so check exit

      if( ClosePrice < MA ) {

        # exit position

        addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,

          TxnPrice=ClosePrice, TxnQty = -Posn , TxnFees=0)

      } else {

        if( i==nrow(SPY) ) # exit on last day

          addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,

            TxnPrice=ClosePrice, TxnQty = -Posn , TxnFees=0)

      }

    }

  }

  updatePortf(b.strategy,Dates=CurrentDate)

  updateAcct(b.strategy,Dates=CurrentDate)

  updateEndEq(b.strategy,CurrentDate)

}
====================================================

On a linux box using `htop` I can see the job execute across each processor
but then running something like

`chart.Posn(b.strategy,"SPY")`

which when, say, charting the position spits the error:

Error in chart.Posn(b.strategy, "SPY") :
  no transactions/positions to chart


So, obviously I'm not reconstituting the results correctly after the
foreach loop runs...i've tried a few different calls but without much luck.

Any pointers as to where I'm going wrong?

	[[alternative HTML version deleted]]


From n-e-w at qtradr.net  Mon Nov 17 13:22:04 2014
From: n-e-w at qtradr.net (Nick White)
Date: Mon, 17 Nov 2014 23:22:04 +1100
Subject: [R-SIG-Finance] incorrectly storing results from `blotter` when
	using `foreach`
Message-ID: <CAH+4RFuwfVuoO2UG8KbCY9xmhfK5R_W0wTreKAG=t_Je=LijMQ@mail.gmail.com>

Hi all,

I've been messing around with using foreach loops to speed up blotter a
bit...but I can't seem to get the results to store after I run the parallel
job.

Using Guy Yollin's blotter for-loop example (at
http://www.r-programming.org/files/blotter.pdf)

I convert the for-loop to a foreach-loop using the following code (marked
between 3 #'s):

====================================================

### My changes to Guy's for-loop code:

foreach( i = 1:nrow(SPY),.combine=rbind, .packages=c('xts','blotter') )
%dopar%
{

### Rest of the code as usual...

  # update values for this date

  CurrentDate <- time(SPY)[i]

  equity = getEndEq(b.strategy, CurrentDate)

  ClosePrice <- as.numeric(Cl(SPY[i,]))

  Posn <- getPosQty(b.strategy, Symbol='SPY', Date=CurrentDate)

  UnitSize = as.numeric(trunc(equity/ClosePrice))

  MA <- as.numeric(SPY[i,'SMA10m'])

  # change market position if necessary

  if( !is.na(MA) ) # if the moving average has begun

  {

    if( Posn == 0 ) { # No position, test to go Long

      if( ClosePrice > MA ) {

        # enter long position

        addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,

          TxnPrice=ClosePrice, TxnQty = UnitSize , TxnFees=0) }

    } else { # Have a position, so check exit

      if( ClosePrice < MA ) {

        # exit position

        addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,

          TxnPrice=ClosePrice, TxnQty = -Posn , TxnFees=0)

      } else {

        if( i==nrow(SPY) ) # exit on last day

          addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,

            TxnPrice=ClosePrice, TxnQty = -Posn , TxnFees=0)

      }

    }

  }

  updatePortf(b.strategy,Dates=CurrentDate)

  updateAcct(b.strategy,Dates=CurrentDate)

  updateEndEq(b.strategy,CurrentDate)

}
====================================================

On a linux box using `htop` I can see the job execute across each processor
but then running something like

`chart.Posn(b.strategy,"SPY")`

which when, say, charting the position spits the error:

Error in chart.Posn(b.strategy, "SPY") :
  no transactions/positions to chart


So, obviously I'm not reconstituting the results correctly after the
foreach loop runs...i've tried a few different calls but without much luck.

Any pointers as to where I'm going wrong?

	[[alternative HTML version deleted]]


From brian at braverock.com  Mon Nov 17 13:32:36 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 17 Nov 2014 06:32:36 -0600
Subject: [R-SIG-Finance] incorrectly storing results from `blotter` when
 using `foreach`
In-Reply-To: <CAH+4RFuwfVuoO2UG8KbCY9xmhfK5R_W0wTreKAG=t_Je=LijMQ@mail.gmail.com>
References: <CAH+4RFuwfVuoO2UG8KbCY9xmhfK5R_W0wTreKAG=t_Je=LijMQ@mail.gmail.com>
Message-ID: <5469EAE4.5000001@braverock.com>

See lines 524-533 and 412-451 in file paramsets.R in quantstrat.

You need to explicitly pass back and store anything you want to get out 
of the foreach loop.  Your foreach loop is using rbind, so you're 
probably getting nothing at all in the return from the foreach, or 
possibly a vector of account names.

addTxn is fast.  There will likely be little gain from using foreach. 
You'd have more luck with a simple strategy by creating an xts object 
suitable for passing to addTxns (plural)

Regards,

Brian

On 11/17/2014 06:22 AM, Nick White wrote:
> Hi all,
>
> I've been messing around with using foreach loops to speed up blotter a
> bit...but I can't seem to get the results to store after I run the parallel
> job.
>
> Using Guy Yollin's blotter for-loop example (at
> http://www.r-programming.org/files/blotter.pdf)
>
> I convert the for-loop to a foreach-loop using the following code (marked
> between 3 #'s):
>
> ====================================================
>
> ### My changes to Guy's for-loop code:
>
> foreach( i = 1:nrow(SPY),.combine=rbind, .packages=c('xts','blotter') )
> %dopar%
> {
>
> ### Rest of the code as usual...
>
>    # update values for this date
>
>    CurrentDate <- time(SPY)[i]
>
>    equity = getEndEq(b.strategy, CurrentDate)
>
>    ClosePrice <- as.numeric(Cl(SPY[i,]))
>
>    Posn <- getPosQty(b.strategy, Symbol='SPY', Date=CurrentDate)
>
>    UnitSize = as.numeric(trunc(equity/ClosePrice))
>
>    MA <- as.numeric(SPY[i,'SMA10m'])
>
>    # change market position if necessary
>
>    if( !is.na(MA) ) # if the moving average has begun
>
>    {
>
>      if( Posn == 0 ) { # No position, test to go Long
>
>        if( ClosePrice > MA ) {
>
>          # enter long position
>
>          addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,
>
>            TxnPrice=ClosePrice, TxnQty = UnitSize , TxnFees=0) }
>
>      } else { # Have a position, so check exit
>
>        if( ClosePrice < MA ) {
>
>          # exit position
>
>          addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,
>
>            TxnPrice=ClosePrice, TxnQty = -Posn , TxnFees=0)
>
>        } else {
>
>          if( i==nrow(SPY) ) # exit on last day
>
>            addTxn(b.strategy, Symbol='SPY', TxnDate=CurrentDate,
>
>              TxnPrice=ClosePrice, TxnQty = -Posn , TxnFees=0)
>
>        }
>
>      }
>
>    }
>
>    updatePortf(b.strategy,Dates=CurrentDate)
>
>    updateAcct(b.strategy,Dates=CurrentDate)
>
>    updateEndEq(b.strategy,CurrentDate)
>
> }
> ====================================================
>
> On a linux box using `htop` I can see the job execute across each processor
> but then running something like
>
> `chart.Posn(b.strategy,"SPY")`
>
> which when, say, charting the position spits the error:
>
> Error in chart.Posn(b.strategy, "SPY") :
>    no transactions/positions to chart
>
>
> So, obviously I'm not reconstituting the results correctly after the
> foreach loop runs...i've tried a few different calls but without much luck.
>
> Any pointers as to where I'm going wrong?
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From stefano.iacus at unimi.it  Tue Nov 18 18:15:53 2014
From: stefano.iacus at unimi.it (stefano iacus)
Date: Tue, 18 Nov 2014 18:15:53 +0100
Subject: [R-SIG-Finance] heston model simulation
In-Reply-To: <CAPD4hGDsjTM-6W9JvnkHMJ_HTheWGPVvMMPkJimSd_UnyfxGyw@mail.gmail.com>
References: <CAPD4hGDsjTM-6W9JvnkHMJ_HTheWGPVvMMPkJimSd_UnyfxGyw@mail.gmail.com>
Message-ID: <C435617A-A241-4256-AD73-1B23655D6560@unimi.it>

Please have a look at the Yuima package

or google around for "yuima package heston model"
e.g.

http://eizoo.hatenablog.com/entry/2014/02/26/162510

there were even youtube movies :)

Hope it helps
Stefano

Il giorno 16/nov/2014, alle ore 06:19, jun wang <junluke at gmail.com> ha scritto:

> Dear all,
> 
> I am using the following code for simulating Heston model. I am trying to
> compare skewness with respect to different Rhos, but it doesn't seem to
> work. Any body can tell me what is happening? I am using Euler-Maruyama
> Monte Carlo. Here is my sample code. Any hints would be really appreciated.
> 
> 
> 
> theta=0.04
> alpha=1.5
> #delta=0.5
> #rho=-0.9
> n=100
> m=1000
> 
> heston_sim<-function(rho,delta,m,mu){
> s<-matrix(NA,n,m)
> v<-matrix(NA,n,m)
> for (j in 1:m){
> for (i in 2:n) {
> s[1,j]=2
> v[1,j]=0.4
> dt=1/100
> zv<-rnorm(1)
> zs<-rnorm(1)
> zx<-rho*zv+sqrt(1-rho^2)*zs
> w1<-zv*sqrt(dt)
> w2<-zx*sqrt(dt)
> s[i,j]=s[i-1,j]+(mu-0.5*max(v[i-1,j],0))*dt+sqrt(max(v[i-1,j],0))*w2
> v[i,j]=v[i-1,j]+alpha*(theta-v[i-1,j])*dt+sqrt(max(v[i-1,j],0))*delta*w1
> }
> }
> return(s)
> }
> s1<-heston_sim(-1,0.1,1000,0)
> s2<-heston_sim(0,0.1,1000,0)
> s3<-heston_sim(0.7,0.1,1000,0)
> 
> a1<-c(diff(s1,lag=1)*100)
> a2<-c(diff(s2,lag=1)*100)
> a3<-c(diff(s3,lag=1)*100)
> 
> 
> 
> plot(density(na.omit(a1),bw=0.5),main="",ylim=c(0,0.2))
> lines(density(na.omit(a2),bw=0.5),col=2)
> lines(density(na.omit(a3),,bw=0.5),col=3)
> legend('topright',legend=c(expression(paste(rho,
> "=--0.3")),expression(paste(rho, "=0")),expression(paste(rho,
> "=0.5"))),col=1:3,lty=1)
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From josh.m.ulrich at gmail.com  Tue Nov 18 20:30:02 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 18 Nov 2014 13:30:02 -0600
Subject: [R-SIG-Finance] R/Finance 2015 Call for Papers
Message-ID: <CAPPM_gStdyAJBr8E7SygQ-5WKCaXUYcB95Xajy063Z0WFRPd4A@mail.gmail.com>

Call for Papers:

R/Finance 2015: Applied Finance with R
May 29 and 30, 2015
University of Illinois at Chicago

The seventh annual R/Finance conference for applied finance using R
will be held on May 29 and 30, 2015 in Chicago, IL, USA at the
University of Illinois at Chicago.  The conference will cover topics
including portfolio management, time series analysis, advanced risk
tools, high-performance computing, market microstructure, and
econometrics. All will be discussed within the context of using R as a
primary tool for financial risk management, portfolio construction,
and trading.

Over the past six years, R/Finance has included attendees from around
the world. It has featured presentations from prominent academics and
practitioners, and we anticipate another exciting line-up for 2015.
This year will include invited keynote presentations by Emanuel
Derman, Louis Marascio, Alexander McNeil, and Rishi Narang.

We invite you to submit complete papers in pdf format for
consideration. We will also consider one-page abstracts (in txt or pdf
format) although more complete papers are preferred.  We welcome
submissions for both full talks and abbreviated "lightning talks."
Both academic and practitioner proposals related to R are encouraged.

All slides will be made publicly available at conference time.
Presenters are strongly encouraged to provide working R code to
accompany the slides.  Data sets should also be made public for the
purposes of reproducibility (though we realize this may be limited due
to contracts with data vendors). Preference may be given to presenters
who have released R packages.

The conference will award two (or more) $1000 prizes for best papers.
A submission must be a full paper to be eligible for a best paper
award. Extended abstracts, even if a full paper is provided by
conference time, are not eligible for a best paper award.  Financial
assistance for travel and accommodation may be available to
presenters, however requests must be made at the time of submission.
Assistance will be granted at the discretion of the conference
committee.

Please make your submission online at: http://www.cvent.com/d/t4qy73.

The submission deadline is January 31, 2015. Submitters will be
notified via email by February 28, 2015 of acceptance, presentation
length, and financial assistance (if requested).

Additional details will be announced via the conference website

http://www.RinFinance.com/

as they become available. Information on previous years' presenters
and their presentations are also at the conference website.

For the program committee:
Gib Bassett, Peter Carl, Dirk Eddelbuettel, Brian Peterson, Dale
Rosenthal, Jeffrey Ryan, Joshua Ulrich


From larry.shank at gmail.com  Wed Nov 19 20:46:40 2014
From: larry.shank at gmail.com (Larry Shank)
Date: Wed, 19 Nov 2014 14:46:40 -0500
Subject: [R-SIG-Finance] RBloomberg
Message-ID: <CALJm3nADC4v1kAzAnNVO6TJQ52pfFgpXSKGUqzeLVNXhfYa0YQ@mail.gmail.com>

Hello -

Could someone please tell me if it is possible to keep a data subscription
open when making a bdp call when using RBloomberg (i.e. constantly updated
real-time prices)?  For example,

> library(RBloomberg)
Loading required package: rJava

> conn <- blpConnect()
R version 2.13.2 (2011-09-30)
rJava Version 0.9-3
RBloomberg Version 0.4-150
Java environment initialized successfully.
Looking for most recent blpapi3.jar file...
Adding C:\blp\API\APIv3\JavaAPI\v3.5.1.1\lib\blpapi3.jar to Java classpath

Bloomberg API Version 3.5.1.1
> conn
[1] "Java-Object{org.findata.blpwrapper.Connection at 187955b}"

> bdp(conn, "IBM US EQUITY", "LAST_PRICE")
              LAST_PRICE
IBM US EQUITY      161.2

I would like the bdp call to remain open or subscribed to constantly
update, as it does when executing the code =BDP("IBM EQUITY","LAST PRICE")
in Excel.

I appreciate any help.

Thank you,
Larry

	[[alternative HTML version deleted]]


From john.laing at gmail.com  Wed Nov 19 20:59:14 2014
From: john.laing at gmail.com (John Laing)
Date: Wed, 19 Nov 2014 14:59:14 -0500
Subject: [R-SIG-Finance] RBloomberg
In-Reply-To: <CALJm3nADC4v1kAzAnNVO6TJQ52pfFgpXSKGUqzeLVNXhfYa0YQ@mail.gmail.com>
References: <CALJm3nADC4v1kAzAnNVO6TJQ52pfFgpXSKGUqzeLVNXhfYa0YQ@mail.gmail.com>
Message-ID: <CAA3Wa=v2b75RE-A+udJLqhNyK5z9=G3e9Gk1Kf1a-Q-K1bz0Wg@mail.gmail.com>

Larry,

Bloomberg's API allows for a data subscription but this has not yet
been implemented in the R package.

-John

On Wed, Nov 19, 2014 at 2:46 PM, Larry Shank <larry.shank at gmail.com> wrote:
> Hello -
>
> Could someone please tell me if it is possible to keep a data subscription
> open when making a bdp call when using RBloomberg (i.e. constantly updated
> real-time prices)?  For example,
>
>> library(RBloomberg)
> Loading required package: rJava
>
>> conn <- blpConnect()
> R version 2.13.2 (2011-09-30)
> rJava Version 0.9-3
> RBloomberg Version 0.4-150
> Java environment initialized successfully.
> Looking for most recent blpapi3.jar file...
> Adding C:\blp\API\APIv3\JavaAPI\v3.5.1.1\lib\blpapi3.jar to Java classpath
>
> Bloomberg API Version 3.5.1.1
>> conn
> [1] "Java-Object{org.findata.blpwrapper.Connection at 187955b}"
>
>> bdp(conn, "IBM US EQUITY", "LAST_PRICE")
>               LAST_PRICE
> IBM US EQUITY      161.2
>
> I would like the bdp call to remain open or subscribed to constantly
> update, as it does when executing the code =BDP("IBM EQUITY","LAST PRICE")
> in Excel.
>
> I appreciate any help.
>
> Thank you,
> Larry
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From debasishmaitra at gmail.com  Fri Nov 21 10:31:58 2014
From: debasishmaitra at gmail.com (DEBASISH MAITRA)
Date: Fri, 21 Nov 2014 15:01:58 +0530
Subject: [R-SIG-Finance] Block Exogeneity Test
Message-ID: <CA+=JsgQPnOBp5ohfRFwfzN5KOvyc0fScYaDdM1+xZ5f9EvhqEQ@mail.gmail.com>

Dear All,

I am Debasish Maitra. I am trying to run block exogeneity test in R (vars
package) after a VAR model, but I am not able to find anything out to do
this.

It would be of great help if you kindly tell me how can I run this.

Thanks,
Regards,
Debasish Maitra

	[[alternative HTML version deleted]]


From brian at braverock.com  Fri Nov 21 10:53:22 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 21 Nov 2014 03:53:22 -0600
Subject: [R-SIG-Finance] Block Exogeneity Test
In-Reply-To: <CA+=JsgQPnOBp5ohfRFwfzN5KOvyc0fScYaDdM1+xZ5f9EvhqEQ@mail.gmail.com>
References: <CA+=JsgQPnOBp5ohfRFwfzN5KOvyc0fScYaDdM1+xZ5f9EvhqEQ@mail.gmail.com>
Message-ID: <546F0B92.2040700@braverock.com>

On 11/21/2014 03:31 AM, DEBASISH MAITRA wrote:
> I am Debasish Maitra. I am trying to run block exogeneity test in R (vars
> package) after a VAR model, but I am not able to find anything out to do
> this.
>
> It would be of great help if you kindly tell me how can I run this.

It would be a great help if you followed the posting guide:

http://www.r-project.org/posting-guide.html

and provided a reproducible example.  Use a data set included with the 
vars package, or some other data set included with a different R 
package, and tell us in a reproducible way what you've already tried, 
and where you're stuck.

I don't believe that the 'vars' package includes a function for a block 
exogeneity test on its model output.

The  MSBVAR package provides bivariate Granger causality tests in lieu 
of a block exogeneity test.

It would also help if you would be explicit about which form of 
exogeneity test you are trying to apply, with a reference to the paper 
you hope to use the technique from.  I'm aware of at least two different 
approaches, which each have different assumptions.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From brian at braverock.com  Fri Nov 21 11:49:25 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 21 Nov 2014 04:49:25 -0600
Subject: [R-SIG-Finance] Fwd: Re:  Block Exogeneity Test
In-Reply-To: <CA+=JsgQ0zxpcakb0SrpLX0UG8mM6ToAyjTFeerytvS+ZFojTkQ@mail.gmail.com>
References: <CA+=JsgQ0zxpcakb0SrpLX0UG8mM6ToAyjTFeerytvS+ZFojTkQ@mail.gmail.com>
Message-ID: <546F18B5.8030004@braverock.com>

To the list. - Brian


-------- Forwarded Message --------
Subject: 	Re: [R-SIG-Finance] Block Exogeneity Test
Date: 	Fri, 21 Nov 2014 16:05:44 +0530
From: 	DEBASISH MAITRA <debasishmaitra at gmail.com>
To: 	Brian G. Peterson <brian at braverock.com>



Hi Brian,

Thanks for your mail.
I am specifically looking for Block Exogeneity Wald test after my VAR
model. For an example, I have three series gdp, cpi and m3. After
estimating the VAR model (with an assumption that these three variable
are stationary) among these three varables, if I really want to test
hypotheses ; lags of cpi explain current gdp, lags of cpi explain
current m3; lags of gdp explain current cpi, lags of gdp explain current
m3 etc. I should have the results look like;

Dependent variable GDP
Excluded                Chi-sq                df               prob
cpi
m3

Dependent variable cpi
Excluded               Chi-sq                 df               prob
gdp
m3

Dependent variable m3
Excluded               Chi-sq                 df               prob
gdp
cpi

Kindly look into this and suggest the way ou.


Regards,
Debasish

On Fri, Nov 21, 2014 at 3:23 PM, Brian G. Peterson <brian at braverock.com
<mailto:brian at braverock.com>> wrote:

     On 11/21/2014 03:31 AM, DEBASISH MAITRA wrote:

         I am Debasish Maitra. I am trying to run block exogeneity test
         in R (vars
         package) after a VAR model, but I am not able to find anything
         out to do
         this.

         It would be of great help if you kindly tell me how can I run this.


     It would be a great help if you followed the posting guide:

     http://www.r-project.org/__posting-guide.html
     <http://www.r-project.org/posting-guide.html>

     and provided a reproducible example.  Use a data set included with
     the vars package, or some other data set included with a different R
     package, and tell us in a reproducible way what you've already
     tried, and where you're stuck.

     I don't believe that the 'vars' package includes a function for a
     block exogeneity test on its model output.

     The  MSBVAR package provides bivariate Granger causality tests in
     lieu of a block exogeneity test.

     It would also help if you would be explicit about which form of
     exogeneity test you are trying to apply, with a reference to the
     paper you hope to use the technique from.  I'm aware of at least two
     different approaches, which each have different assumptions.

     Regards,

     Brian

     --
     Brian G. Peterson
     http://braverock.com/brian/
     Ph: 773-459-4973 <tel:773-459-4973>
     IM: bgpbraverock

     _________________________________________________
     R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
     mailing list
     https://stat.ethz.ch/mailman/__listinfo/r-sig-finance
     <https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
     -- Subscriber-posting only. If you want to post, subscribe first.
     -- Also note that this is not the r-help list where general R
     questions should go.




--


From brian at braverock.com  Fri Nov 21 12:03:23 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 21 Nov 2014 05:03:23 -0600
Subject: [R-SIG-Finance] Fwd: Re:  Block Exogeneity Test
In-Reply-To: <546F18B5.8030004@braverock.com>
References: <CA+=JsgQ0zxpcakb0SrpLX0UG8mM6ToAyjTFeerytvS+ZFojTkQ@mail.gmail.com>
	<546F18B5.8030004@braverock.com>
Message-ID: <546F1BFB.7050504@braverock.com>

For the Wald-type test, see

###

?causality

###

the vars package calls this 'instantaneous causality'.

You will need to set the 'cause' parameter to a vector of your 
predictors.  In your example:

###

cause=c("gdp","cpi","m3")

# note that R is case sensitive, and your
# non-reproducible example mixed case

###

You likely also want boot=TRUE and boot.runs set to some value 
appropriate to your data, in most formulations of the test procedure 
you're seeking.

As you've described it, you're looking for bivariate tests, not truly a 
block exogeneity test, which tests whether the group of variables or 
'block' are tested to see if the *block* causes any of the observed 
lags.  It appears from the output that you request that you are looking 
for pairwise causality as individual variables are tested against the 
rest of the model.

Regards,

Brian

On 11/21/2014 04:49 AM, Brian G. Peterson wrote:
> To the list. - Brian
>
>
> -------- Forwarded Message --------
> Subject:     Re: [R-SIG-Finance] Block Exogeneity Test
> Date:     Fri, 21 Nov 2014 16:05:44 +0530
> From:     DEBASISH MAITRA <debasishmaitra at gmail.com>
> To:     Brian G. Peterson <brian at braverock.com>
>
>
>
> Hi Brian,
>
> Thanks for your mail.
> I am specifically looking for Block Exogeneity Wald test after my VAR
> model. For an example, I have three series gdp, cpi and m3. After
> estimating the VAR model (with an assumption that these three variable
> are stationary) among these three varables, if I really want to test
> hypotheses ; lags of cpi explain current gdp, lags of cpi explain
> current m3; lags of gdp explain current cpi, lags of gdp explain current
> m3 etc. I should have the results look like;
>
> Dependent variable GDP
> Excluded                Chi-sq                df               prob
> cpi
> m3
>
> Dependent variable cpi
> Excluded               Chi-sq                 df               prob
> gdp
> m3
>
> Dependent variable m3
> Excluded               Chi-sq                 df               prob
> gdp
> cpi
>
> Kindly look into this and suggest the way ou.
>
>
> Regards,
> Debasish
>
> On Fri, Nov 21, 2014 at 3:23 PM, Brian G. Peterson <brian at braverock.com
> <mailto:brian at braverock.com>> wrote:
>
>      On 11/21/2014 03:31 AM, DEBASISH MAITRA wrote:
>
>          I am Debasish Maitra. I am trying to run block exogeneity test
>          in R (vars
>          package) after a VAR model, but I am not able to find anything
>          out to do
>          this.
>
>          It would be of great help if you kindly tell me how can I run
> this.
>
>
>      It would be a great help if you followed the posting guide:
>
>      http://www.r-project.org/__posting-guide.html
>      <http://www.r-project.org/posting-guide.html>
>
>      and provided a reproducible example.  Use a data set included with
>      the vars package, or some other data set included with a different R
>      package, and tell us in a reproducible way what you've already
>      tried, and where you're stuck.
>
>      I don't believe that the 'vars' package includes a function for a
>      block exogeneity test on its model output.
>
>      The  MSBVAR package provides bivariate Granger causality tests in
>      lieu of a block exogeneity test.
>
>      It would also help if you would be explicit about which form of
>      exogeneity test you are trying to apply, with a reference to the
>      paper you hope to use the technique from.  I'm aware of at least two
>      different approaches, which each have different assumptions.
>
>      Regards,
>
>      Brian
>
>      --
>      Brian G. Peterson
>      http://braverock.com/brian/
>      Ph: 773-459-4973 <tel:773-459-4973>
>      IM: bgpbraverock
>
>      _________________________________________________
>      R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
>      mailing list
>      https://stat.ethz.ch/mailman/__listinfo/r-sig-finance
>      <https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
>      -- Subscriber-posting only. If you want to post, subscribe first.
>      -- Also note that this is not the r-help list where general R
>      questions should go.
>
>
>
>
> --
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From frainj at tcd.ie  Fri Nov 21 22:55:39 2014
From: frainj at tcd.ie (John Frain)
Date: Fri, 21 Nov 2014 21:55:39 +0000
Subject: [R-SIG-Finance] Fwd: Re: Block Exogeneity Test
In-Reply-To: <546F1BFB.7050504@braverock.com>
References: <CA+=JsgQ0zxpcakb0SrpLX0UG8mM6ToAyjTFeerytvS+ZFojTkQ@mail.gmail.com>
	<546F18B5.8030004@braverock.com> <546F1BFB.7050504@braverock.com>
Message-ID: <CAJWf-11CUkyD624+o=dMXvjYYG1xxBefs7yR49eTD_ENP8jdVw@mail.gmail.com>

This kind of econometrics gives econometricians a bad name. The
variables gdp, cpi and m3 are certainly not stationary. Modelling
should be in the logarithms of the variables and not in levels. If
there is no cointegration and the logs of the three variables are I(1)
VAR modelling should be in first differences of the logs.

The simplest way to test for block exogeneity would be (dlgdp is the
first difference of the log of GDP)

1. Estimate, by OLS, an AR(p) process for dlgdp and extract the loglikelihood
2. Estimate by OLS the dlgdp equation from the VAR(p) involving dlgdp
dlcpi dlm3 and extract the loglikelihood.
3. Use the loglikelihood ratio test to test the significance of the
extra variables in 2.  This is a block exogeneity test of dlcpi and
dlm3 for dlgdp.

Working in this way ensures that one understands what they are doing
and adds to your understanding of the process..

If there is cointegration you will have to think a little more.
Lutkepohl, Helmut  (2005), New Introduction to Multiple Time Series,
Springer is one of the many good references available on this topic

Best Regards

John

John C Frain, Ph.D.

Economics Department             3 Aranleigh Park
Trinity College Dublin                 Rathfarnham
College Green                           Dublin 14
Dublin 2                                    Ireland
Ireland
www.tcd.ie/Economics/staff/frainj/home.htm
mailto:frainj at tcd.ie
mailto:frainj at gmail.com


On 21 November 2014 11:03, Brian G. Peterson <brian at braverock.com> wrote:
> For the Wald-type test, see
>
> ###
>
> ?causality
>
> ###
>
> the vars package calls this 'instantaneous causality'.
>
> You will need to set the 'cause' parameter to a vector of your predictors.
> In your example:
>
> ###
>
> cause=c("gdp","cpi","m3")
>
> # note that R is case sensitive, and your
> # non-reproducible example mixed case
>
> ###
>
> You likely also want boot=TRUE and boot.runs set to some value appropriate
> to your data, in most formulations of the test procedure you're seeking.
>
> As you've described it, you're looking for bivariate tests, not truly a
> block exogeneity test, which tests whether the group of variables or 'block'
> are tested to see if the *block* causes any of the observed lags.  It
> appears from the output that you request that you are looking for pairwise
> causality as individual variables are tested against the rest of the model.
>
> Regards,
>
> Brian
>
>
> On 11/21/2014 04:49 AM, Brian G. Peterson wrote:
>>
>> To the list. - Brian
>>
>>
>> -------- Forwarded Message --------
>> Subject:     Re: [R-SIG-Finance] Block Exogeneity Test
>> Date:     Fri, 21 Nov 2014 16:05:44 +0530
>> From:     DEBASISH MAITRA <debasishmaitra at gmail.com>
>> To:     Brian G. Peterson <brian at braverock.com>
>>
>>
>>
>> Hi Brian,
>>
>> Thanks for your mail.
>> I am specifically looking for Block Exogeneity Wald test after my VAR
>> model. For an example, I have three series gdp, cpi and m3. After
>> estimating the VAR model (with an assumption that these three variable
>> are stationary) among these three varables, if I really want to test
>> hypotheses ; lags of cpi explain current gdp, lags of cpi explain
>> current m3; lags of gdp explain current cpi, lags of gdp explain current
>> m3 etc. I should have the results look like;
>>
>> Dependent variable GDP
>> Excluded                Chi-sq                df               prob
>> cpi
>> m3
>>
>> Dependent variable cpi
>> Excluded               Chi-sq                 df               prob
>> gdp
>> m3
>>
>> Dependent variable m3
>> Excluded               Chi-sq                 df               prob
>> gdp
>> cpi
>>
>> Kindly look into this and suggest the way ou.
>>
>>
>> Regards,
>> Debasish
>>
>> On Fri, Nov 21, 2014 at 3:23 PM, Brian G. Peterson <brian at braverock.com
>> <mailto:brian at braverock.com>> wrote:
>>
>>      On 11/21/2014 03:31 AM, DEBASISH MAITRA wrote:
>>
>>          I am Debasish Maitra. I am trying to run block exogeneity test
>>          in R (vars
>>          package) after a VAR model, but I am not able to find anything
>>          out to do
>>          this.
>>
>>          It would be of great help if you kindly tell me how can I run
>> this.
>>
>>
>>      It would be a great help if you followed the posting guide:
>>
>>      http://www.r-project.org/__posting-guide.html
>>      <http://www.r-project.org/posting-guide.html>
>>
>>      and provided a reproducible example.  Use a data set included with
>>      the vars package, or some other data set included with a different R
>>      package, and tell us in a reproducible way what you've already
>>      tried, and where you're stuck.
>>
>>      I don't believe that the 'vars' package includes a function for a
>>      block exogeneity test on its model output.
>>
>>      The  MSBVAR package provides bivariate Granger causality tests in
>>      lieu of a block exogeneity test.
>>
>>      It would also help if you would be explicit about which form of
>>      exogeneity test you are trying to apply, with a reference to the
>>      paper you hope to use the technique from.  I'm aware of at least two
>>      different approaches, which each have different assumptions.
>>
>>      Regards,
>>
>>      Brian
>>
>>      --
>>      Brian G. Peterson
>>      http://braverock.com/brian/
>>      Ph: 773-459-4973 <tel:773-459-4973>
>>      IM: bgpbraverock
>>
>>      _________________________________________________
>>      R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
>>      mailing list
>>      https://stat.ethz.ch/mailman/__listinfo/r-sig-finance
>>      <https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
>>      -- Subscriber-posting only. If you want to post, subscribe first.
>>      -- Also note that this is not the r-help list where general R
>>      questions should go.
>>
>>
>>
>>
>> --
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>
>
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


From debasishmaitra at gmail.com  Sat Nov 22 13:53:40 2014
From: debasishmaitra at gmail.com (DEBASISH MAITRA)
Date: Sat, 22 Nov 2014 18:23:40 +0530
Subject: [R-SIG-Finance] Fwd: Re: Block Exogeneity Test
In-Reply-To: <CAJWf-11CUkyD624+o=dMXvjYYG1xxBefs7yR49eTD_ENP8jdVw@mail.gmail.com>
References: <CA+=JsgQ0zxpcakb0SrpLX0UG8mM6ToAyjTFeerytvS+ZFojTkQ@mail.gmail.com>
	<546F18B5.8030004@braverock.com> <546F1BFB.7050504@braverock.com>
	<CAJWf-11CUkyD624+o=dMXvjYYG1xxBefs7yR49eTD_ENP8jdVw@mail.gmail.com>
Message-ID: <CA+=JsgR_jMwYJChxhcfO0m8wbGF+MuLVbd0C6W3h+cbDQWUkZA@mail.gmail.com>

Hi Brian,

Thanks for your mail. You are absolutely right, I was looking for the
effect of lags of one variable on the other by excluding the lags of other
variables. But, in instantaneous causality, it tests the hypothesis whether
gdp is caused by cpi and m3 i.e. it is actually testing the causality
effects of two variables together on gdp. This does not give the output of
causality of one variable on the other without inclusion of the third
variable, i.e. gdp is caused by cpi, gdp is caused by m3, likewise.

Thanks,

Best regards,
Debasish




On Sat, Nov 22, 2014 at 3:25 AM, John Frain <frainj at tcd.ie> wrote:

> This kind of econometrics gives econometricians a bad name. The
> variables gdp, cpi and m3 are certainly not stationary. Modelling
> should be in the logarithms of the variables and not in levels. If
> there is no cointegration and the logs of the three variables are I(1)
> VAR modelling should be in first differences of the logs.
>
> The simplest way to test for block exogeneity would be (dlgdp is the
> first difference of the log of GDP)
>
> 1. Estimate, by OLS, an AR(p) process for dlgdp and extract the
> loglikelihood
> 2. Estimate by OLS the dlgdp equation from the VAR(p) involving dlgdp
> dlcpi dlm3 and extract the loglikelihood.
> 3. Use the loglikelihood ratio test to test the significance of the
> extra variables in 2.  This is a block exogeneity test of dlcpi and
> dlm3 for dlgdp.
>
> Working in this way ensures that one understands what they are doing
> and adds to your understanding of the process..
>
> If there is cointegration you will have to think a little more.
> Lutkepohl, Helmut  (2005), New Introduction to Multiple Time Series,
> Springer is one of the many good references available on this topic
>
> Best Regards
>
> John
>
> John C Frain, Ph.D.
>
> Economics Department             3 Aranleigh Park
> Trinity College Dublin                 Rathfarnham
> College Green                           Dublin 14
> Dublin 2                                    Ireland
> Ireland
> www.tcd.ie/Economics/staff/frainj/home.htm
> mailto:frainj at tcd.ie
> mailto:frainj at gmail.com
>
>
> On 21 November 2014 11:03, Brian G. Peterson <brian at braverock.com> wrote:
> > For the Wald-type test, see
> >
> > ###
> >
> > ?causality
> >
> > ###
> >
> > the vars package calls this 'instantaneous causality'.
> >
> > You will need to set the 'cause' parameter to a vector of your
> predictors.
> > In your example:
> >
> > ###
> >
> > cause=c("gdp","cpi","m3")
> >
> > # note that R is case sensitive, and your
> > # non-reproducible example mixed case
> >
> > ###
> >
> > You likely also want boot=TRUE and boot.runs set to some value
> appropriate
> > to your data, in most formulations of the test procedure you're seeking.
> >
> > As you've described it, you're looking for bivariate tests, not truly a
> > block exogeneity test, which tests whether the group of variables or
> 'block'
> > are tested to see if the *block* causes any of the observed lags.  It
> > appears from the output that you request that you are looking for
> pairwise
> > causality as individual variables are tested against the rest of the
> model.
> >
> > Regards,
> >
> > Brian
> >
> >
> > On 11/21/2014 04:49 AM, Brian G. Peterson wrote:
> >>
> >> To the list. - Brian
> >>
> >>
> >> -------- Forwarded Message --------
> >> Subject:     Re: [R-SIG-Finance] Block Exogeneity Test
> >> Date:     Fri, 21 Nov 2014 16:05:44 +0530
> >> From:     DEBASISH MAITRA <debasishmaitra at gmail.com>
> >> To:     Brian G. Peterson <brian at braverock.com>
> >>
> >>
> >>
> >> Hi Brian,
> >>
> >> Thanks for your mail.
> >> I am specifically looking for Block Exogeneity Wald test after my VAR
> >> model. For an example, I have three series gdp, cpi and m3. After
> >> estimating the VAR model (with an assumption that these three variable
> >> are stationary) among these three varables, if I really want to test
> >> hypotheses ; lags of cpi explain current gdp, lags of cpi explain
> >> current m3; lags of gdp explain current cpi, lags of gdp explain current
> >> m3 etc. I should have the results look like;
> >>
> >> Dependent variable GDP
> >> Excluded                Chi-sq                df               prob
> >> cpi
> >> m3
> >>
> >> Dependent variable cpi
> >> Excluded               Chi-sq                 df               prob
> >> gdp
> >> m3
> >>
> >> Dependent variable m3
> >> Excluded               Chi-sq                 df               prob
> >> gdp
> >> cpi
> >>
> >> Kindly look into this and suggest the way ou.
> >>
> >>
> >> Regards,
> >> Debasish
> >>
> >> On Fri, Nov 21, 2014 at 3:23 PM, Brian G. Peterson <brian at braverock.com
> >> <mailto:brian at braverock.com>> wrote:
> >>
> >>      On 11/21/2014 03:31 AM, DEBASISH MAITRA wrote:
> >>
> >>          I am Debasish Maitra. I am trying to run block exogeneity test
> >>          in R (vars
> >>          package) after a VAR model, but I am not able to find anything
> >>          out to do
> >>          this.
> >>
> >>          It would be of great help if you kindly tell me how can I run
> >> this.
> >>
> >>
> >>      It would be a great help if you followed the posting guide:
> >>
> >>      http://www.r-project.org/__posting-guide.html
> >>      <http://www.r-project.org/posting-guide.html>
> >>
> >>      and provided a reproducible example.  Use a data set included with
> >>      the vars package, or some other data set included with a different
> R
> >>      package, and tell us in a reproducible way what you've already
> >>      tried, and where you're stuck.
> >>
> >>      I don't believe that the 'vars' package includes a function for a
> >>      block exogeneity test on its model output.
> >>
> >>      The  MSBVAR package provides bivariate Granger causality tests in
> >>      lieu of a block exogeneity test.
> >>
> >>      It would also help if you would be explicit about which form of
> >>      exogeneity test you are trying to apply, with a reference to the
> >>      paper you hope to use the technique from.  I'm aware of at least
> two
> >>      different approaches, which each have different assumptions.
> >>
> >>      Regards,
> >>
> >>      Brian
> >>
> >>      --
> >>      Brian G. Peterson
> >>      http://braverock.com/brian/
> >>      Ph: 773-459-4973 <tel:773-459-4973>
> >>      IM: bgpbraverock
> >>
> >>      _________________________________________________
> >>      R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
> >>      mailing list
> >>      https://stat.ethz.ch/mailman/__listinfo/r-sig-finance
> >>      <https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
> >>      -- Subscriber-posting only. If you want to post, subscribe first.
> >>      -- Also note that this is not the r-help list where general R
> >>      questions should go.
> >>
> >>
> >>
> >>
> >> --
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >
> >
> >
> > --
> > Brian G. Peterson
> > http://braverock.com/brian/
> > Ph: 773-459-4973
> > IM: bgpbraverock
> >
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> > should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>



-- 
Debasish Maitra
Faculty
Institute of Management Technology
Ghaziabad-201001

	[[alternative HTML version deleted]]


From frainj at tcd.ie  Sun Nov 23 13:31:59 2014
From: frainj at tcd.ie (John Frain)
Date: Sun, 23 Nov 2014 12:31:59 +0000
Subject: [R-SIG-Finance] Fwd: Re: Block Exogeneity Test
In-Reply-To: <CA+=JsgSjkRhDYioqR9_u27=cjncGOc8XU9OM8cgNCNEC5h5p0g@mail.gmail.com>
References: <CA+=JsgQ0zxpcakb0SrpLX0UG8mM6ToAyjTFeerytvS+ZFojTkQ@mail.gmail.com>
	<546F18B5.8030004@braverock.com> <546F1BFB.7050504@braverock.com>
	<CAJWf-11CUkyD624+o=dMXvjYYG1xxBefs7yR49eTD_ENP8jdVw@mail.gmail.com>
	<CA+=JsgSjkRhDYioqR9_u27=cjncGOc8XU9OM8cgNCNEC5h5p0g@mail.gmail.com>
Message-ID: <CAJWf-13PzrYk9CgKYo_gnZ-KpqHE2KDn7OpSdXEbRuX9utjibA@mail.gmail.com>

Debasish


Sorry if I misunderstood your example. I have seen many economists
trying to estimate a system similar to what you set out. The problems
are basic to any VAR analysis and are not simply "operational nuances
to deal with non-stationarity".

Apart for this I am not sure that I understand what you are trying to
do. My understanding of block exogeneity is as follows. If Y is an n x
1 vector of (stationary) variables is partitioned into X (m x 1) (the
first m variables in Y) and Z(k X 1) (n  = m+k), Then the matrix of
lag polynomials in the VAR for  Y separates into 4 blocks with the
matrix of lag polynomials of the X VAR in the upper left hand corner
and that of Y in the lower right corner and zero polynomials
elsewhere.  A test for this block exogeneity is in effect a test for
that the  zero polynomials are zero. I have not encountered such a
test in R. However it should be easy to implement as a likelihood
ratio test either jointly or by variable if this is what you want to
do.  (While I remember seeing block exogeneity mentioned in the
literature I am not sure of their significance. I can not quote any
references.)

You have stated elsewhere that "I was looking for the effect of lags
of one variable on the other by excluding the lags of other
variables". Is that not just a case of estimating a general model and
then testing the validity of the implied restrictions" using LR, ML or
Wald type tests.

Best Regards

John


John C Frain, Ph.D.
Economics Department             3 Aranleigh Park
Trinity College Dublin                 Rathfarnham
College Green                           Dublin 14
Dublin 2                                    Ireland
Ireland
www.tcd.ie/Economics/staff/frainj/home.htm
mailto:frainj at tcd.ie
mailto:frainj at gmail.com


On 22 November 2014 at 07:56, DEBASISH MAITRA <debasishmaitra at gmail.com> wrote:
> Dear John,
>
> I know that these variables are definitely non-stationary, even that I
> mentioned in the bracket. But I was only looking for block exogeneity wald
> test, not operational nuances to deal with non-stationarity. I was only
> interested to know whether we have command under vars package to know this,
> because MSBVAR and VARS both give only bi-variate causality.
>
> Thanks!
> Regards,
> Debasish
>
> On Sat, Nov 22, 2014 at 3:25 AM, John Frain <frainj at tcd.ie> wrote:
>>
>> This kind of econometrics gives econometricians a bad name. The
>> variables gdp, cpi and m3 are certainly not stationary. Modelling
>> should be in the logarithms of the variables and not in levels. If
>> there is no cointegration and the logs of the three variables are I(1)
>> VAR modelling should be in first differences of the logs.
>>
>> The simplest way to test for block exogeneity would be (dlgdp is the
>> first difference of the log of GDP)
>>
>> 1. Estimate, by OLS, an AR(p) process for dlgdp and extract the
>> loglikelihood
>> 2. Estimate by OLS the dlgdp equation from the VAR(p) involving dlgdp
>> dlcpi dlm3 and extract the loglikelihood.
>> 3. Use the loglikelihood ratio test to test the significance of the
>> extra variables in 2.  This is a block exogeneity test of dlcpi and
>> dlm3 for dlgdp.
>>
>> Working in this way ensures that one understands what they are doing
>> and adds to your understanding of the process..
>>
>> If there is cointegration you will have to think a little more.
>> Lutkepohl, Helmut  (2005), New Introduction to Multiple Time Series,
>> Springer is one of the many good references available on this topic
>>
>> Best Regards
>>
>> John
>>
>> John C Frain, Ph.D.
>>
>> Economics Department             3 Aranleigh Park
>> Trinity College Dublin                 Rathfarnham
>> College Green                           Dublin 14
>> Dublin 2                                    Ireland
>> Ireland
>> www.tcd.ie/Economics/staff/frainj/home.htm
>> mailto:frainj at tcd.ie
>> mailto:frainj at gmail.com
>>
>>
>> On 21 November 2014 11:03, Brian G. Peterson <brian at braverock.com> wrote:
>> > For the Wald-type test, see
>> >
>> > ###
>> >
>> > ?causality
>> >
>> > ###
>> >
>> > the vars package calls this 'instantaneous causality'.
>> >
>> > You will need to set the 'cause' parameter to a vector of your
>> > predictors.
>> > In your example:
>> >
>> > ###
>> >
>> > cause=c("gdp","cpi","m3")
>> >
>> > # note that R is case sensitive, and your
>> > # non-reproducible example mixed case
>> >
>> > ###
>> >
>> > You likely also want boot=TRUE and boot.runs set to some value
>> > appropriate
>> > to your data, in most formulations of the test procedure you're seeking.
>> >
>> > As you've described it, you're looking for bivariate tests, not truly a
>> > block exogeneity test, which tests whether the group of variables or
>> > 'block'
>> > are tested to see if the *block* causes any of the observed lags.  It
>> > appears from the output that you request that you are looking for
>> > pairwise
>> > causality as individual variables are tested against the rest of the
>> > model.
>> >
>> > Regards,
>> >
>> > Brian
>> >
>> >
>> > On 11/21/2014 04:49 AM, Brian G. Peterson wrote:
>> >>
>> >> To the list. - Brian
>> >>
>> >>
>> >> -------- Forwarded Message --------
>> >> Subject:     Re: [R-SIG-Finance] Block Exogeneity Test
>> >> Date:     Fri, 21 Nov 2014 16:05:44 +0530
>> >> From:     DEBASISH MAITRA <debasishmaitra at gmail.com>
>> >> To:     Brian G. Peterson <brian at braverock.com>
>> >>
>> >>
>> >>
>> >> Hi Brian,
>> >>
>> >> Thanks for your mail.
>> >> I am specifically looking for Block Exogeneity Wald test after my VAR
>> >> model. For an example, I have three series gdp, cpi and m3. After
>> >> estimating the VAR model (with an assumption that these three variable
>> >> are stationary) among these three varables, if I really want to test
>> >> hypotheses ; lags of cpi explain current gdp, lags of cpi explain
>> >> current m3; lags of gdp explain current cpi, lags of gdp explain
>> >> current
>> >> m3 etc. I should have the results look like;
>> >>
>> >> Dependent variable GDP
>> >> Excluded                Chi-sq                df               prob
>> >> cpi
>> >> m3
>> >>
>> >> Dependent variable cpi
>> >> Excluded               Chi-sq                 df               prob
>> >> gdp
>> >> m3
>> >>
>> >> Dependent variable m3
>> >> Excluded               Chi-sq                 df               prob
>> >> gdp
>> >> cpi
>> >>
>> >> Kindly look into this and suggest the way ou.
>> >>
>> >>
>> >> Regards,
>> >> Debasish
>> >>
>> >> On Fri, Nov 21, 2014 at 3:23 PM, Brian G. Peterson <brian at braverock.com
>> >> <mailto:brian at braverock.com>> wrote:
>> >>
>> >>      On 11/21/2014 03:31 AM, DEBASISH MAITRA wrote:
>> >>
>> >>          I am Debasish Maitra. I am trying to run block exogeneity test
>> >>          in R (vars
>> >>          package) after a VAR model, but I am not able to find anything
>> >>          out to do
>> >>          this.
>> >>
>> >>          It would be of great help if you kindly tell me how can I run
>> >> this.
>> >>
>> >>
>> >>      It would be a great help if you followed the posting guide:
>> >>
>> >>      http://www.r-project.org/__posting-guide.html
>> >>      <http://www.r-project.org/posting-guide.html>
>> >>
>> >>      and provided a reproducible example.  Use a data set included with
>> >>      the vars package, or some other data set included with a different
>> >> R
>> >>      package, and tell us in a reproducible way what you've already
>> >>      tried, and where you're stuck.
>> >>
>> >>      I don't believe that the 'vars' package includes a function for a
>> >>      block exogeneity test on its model output.
>> >>
>> >>      The  MSBVAR package provides bivariate Granger causality tests in
>> >>      lieu of a block exogeneity test.
>> >>
>> >>      It would also help if you would be explicit about which form of
>> >>      exogeneity test you are trying to apply, with a reference to the
>> >>      paper you hope to use the technique from.  I'm aware of at least
>> >> two
>> >>      different approaches, which each have different assumptions.
>> >>
>> >>      Regards,
>> >>
>> >>      Brian
>> >>
>> >>      --
>> >>      Brian G. Peterson
>> >>      http://braverock.com/brian/
>> >>      Ph: 773-459-4973 <tel:773-459-4973>
>> >>      IM: bgpbraverock
>> >>
>> >>      _________________________________________________
>> >>      R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
>> >>      mailing list
>> >>      https://stat.ethz.ch/mailman/__listinfo/r-sig-finance
>> >>      <https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
>> >>      -- Subscriber-posting only. If you want to post, subscribe first.
>> >>      -- Also note that this is not the r-help list where general R
>> >>      questions should go.
>> >>
>> >>
>> >>
>> >>
>> >> --
>> >>
>> >> _______________________________________________
>> >> R-SIG-Finance at r-project.org mailing list
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> >> -- Subscriber-posting only. If you want to post, subscribe first.
>> >> -- Also note that this is not the r-help list where general R questions
>> >> should go.
>> >
>> >
>> >
>> > --
>> > Brian G. Peterson
>> > http://braverock.com/brian/
>> > Ph: 773-459-4973
>> > IM: bgpbraverock
>> >
>> >
>> > _______________________________________________
>> > R-SIG-Finance at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > -- Also note that this is not the r-help list where general R questions
>> > should go.
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>
>
>
>
>


From n-e-w at qtradr.net  Mon Nov 24 00:14:51 2014
From: n-e-w at qtradr.net (Nick White)
Date: Mon, 24 Nov 2014 10:14:51 +1100
Subject: [R-SIG-Finance] Bug in tradeStats function?
Message-ID: <CAH+4RFvxDVv1ZbuxMcCD1cNF2yicnsS2sAB65bgA9V+o0_rbrg@mail.gmail.com>

Hi all,

Not sure if I've found a bug here, but I've had some issues with tradeStats
in getting a correct number of trades (as opposed to number of
transactions).

For reproducibility, I'm using the "AMZN" demo from Rev 1317 -- latest code
here:
https://r-forge.r-project.org/scm/viewvc.php/pkg/blotter/demo/amzn_test.R?view=markup&revision=1317&root=blotter
)

So I set `Sys.setenv(TZ="UTC")` and then run the demo script.

I then call:

> getTxns("amzn_port","amzn")

                    Txn.Qty Txn.Price Txn.Fees Txn.Value Txn.Avg.Cost
Net.Txn.Realized.PL
2010-01-14 00:00:00       0      0.00        0         0         0.00
            0
2010-01-14 15:18:50    -400    127.49        0    -50996       127.49
        50996
2010-01-14 15:18:53     400    127.49        0     50996       127.49
            0
2010-01-14 15:21:50    -300    127.26        0    -38178       127.26
        38178
2010-01-14 15:21:53     300    127.26        0     38178       127.26
            0
2010-01-14 15:23:07     100    127.17        0     12717       127.17
       -12717
2010-01-14 15:23:10    -100    127.19        0    -12719       127.19
            2
2010-01-14 15:37:56    -400    127.12        0    -50848       127.12
        50848
2010-01-14 15:37:59     400    127.12        0     50848       127.12
            0
2010-01-14 15:38:32    -500    127.23        0    -63615       127.23
        63615
2010-01-14 15:38:35     500    127.23        0     63615       127.23
            0
2010-01-14 15:38:37     300    127.27        0     38181       127.27
       -38181
2010-01-14 15:38:40    -300    127.30        0    -38190       127.30
            9
2010-01-14 15:46:08   -1300    126.95        0   -165035       126.95
       165035
2010-01-14 15:46:11    1300    126.95        0    165035       126.95
            0

and we see 14 transactions comprising 7 flat-to-flat trades (though, of
course, there is the portfolio initiation at midnight on the 14th, which
brings it up to 15 entries)

However, when I call

   > t(tradeStats("amzn_port"))
                   amzn
Portfolio          "amzn_port"
Symbol             "amzn"
Num.Txns           "14"
Num.Trades         "9"
Net.Trading.PL     "11"
Avg.Trade.PL       "35309.44"
Med.Trade.PL       "38178"
Largest.Winner     "165035"
Largest.Loser      "-38181"
Gross.Profits      "368683"
Gross.Losses       "-50898"
Std.Dev.Trade.PL   "59503.98"
Percent.Positive   "77.77778"
Percent.Negative   "22.22222"
Profit.Factor      "7.243566"
Avg.Win.Trade      "52669"
Med.Win.Trade      "50848"
Avg.Losing.Trade   "-25449"
Med.Losing.Trade   "-25449"
Avg.Daily.PL       "317785"
Med.Daily.PL       "317785"
Std.Dev.Daily.PL   NA
Ann.Sharpe         NA
Max.Drawdown       "-109.0012"
Profit.To.Max.Draw "0.1009164"
Avg.WinLoss.Ratio  "2.06959"
Med.WinLoss.Ratio  "1.998035"
Max.Equity         "102.0036"
Min.Equity         "-37.00018"
End.Equity         "11"

Where we get the correct number of trades (14) , but the incorrect number
of trades (9). This also stands contrary to `perTradeStats` which gets it
'right' with 7 line items (apols for formatting)

> perTradeStats("amzn_port")
                Start                 End Init.Pos Max.Pos Num.Txns
Max.Notional.Cost Net.Trading.PL       MAE      MFE Pct.Net.Trading.PL
  Pct.MAE      Pct.MFE tick.Net.Trading.PL   tick.MAE  tick.MFE
1 2010-01-14 15:18:50 2010-01-14 15:18:53     -400    -400        2
   -50996              0   0.00000 72.00098       0.0000000000
 0.0000000000 0.0014118946                   0   0.000000 18.000244
2 2010-01-14 15:21:50 2010-01-14 15:21:53     -300    -300        2
   -38178              0 -33.00082  0.00000       0.0000000000
-0.0008643937 0.0000000000                   0 -11.000275  0.000000
3 2010-01-14 15:23:07 2010-01-14 15:23:10      100     100        2
    12717              2   0.00000 12.94995       0.0001572698
 0.0000000000 0.0010183181                   2   0.000000 12.949951
4 2010-01-14 15:37:56 2010-01-14 15:37:59     -400    -400        2
   -50848              0 -32.04150  0.00000       0.0000000000
-0.0006301429 0.0000000000                   0  -8.010376  0.000000
5 2010-01-14 15:38:32 2010-01-14 15:38:35     -500    -500        2
   -63615              0   0.00000 45.00031       0.0000000000
 0.0000000000 0.0007073851                   0   0.000000  9.000061
6 2010-01-14 15:38:37 2010-01-14 15:38:40      300     300        2
    38181              9 -39.00018  9.00000       0.0002357193
-0.0010214553 0.0002357193                   3 -13.000061  3.000000
7 2010-01-14 15:46:08 2010-01-14 15:46:11    -1300   -1300        2
  -165035              0   0.00000 91.00357       0.0000000000
 0.0000000000 0.0005514198                   0   0.000000  7.000275


In my own data set of some fills from Friday I get the following (XYZ is
the dummy ticker)

> t(perTradeStats(b.strategy,"XYZ"))
                    [,1]
Start               "2014-11-21 14:30:01"
End                 "2014-11-21 20:42:26"
Init.Pos            "200"
Max.Pos             "50263"
Num.Txns            "95"
***SNIP***


So `perTradeStats` has rightly calculated the position as being flat to
flat with 95 transactions comprising one single trade starting at 14:30 and
ending at 20:42 UTC....BUT tradeStats makes the error again


Portfolio          "list_demo"
Symbol             "XYZ"
Num.Txns           "95"
Num.Trades         "94"

This is not the first time I've bumped up against this. In other examples
for my own trades, I've found that tradeStats is sensitive to how you've
indexed the data (for example, it doesn't seem to like it if you have some
things as "Date" and others as "POSIXct". But in the above case, ensuring
all indexes are classed the same way still produces the transactions /
trades error.

I think there might perhaps be something assumed in the `tradeDef` function
that may need to be made more explicit depending on system options for time
zone or index class...but thought I'd get some initial thoughts from the
community before proceeding further to reconcile.

Any ideas?

n.

> sessionInfo()
R version 3.1.1 (2014-07-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
States.1252    LC_MONETARY=English_United States.1252 LC_NUMERIC=C
                  LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] blotter_0.9.1637              PerformanceAnalytics_1.4.3541
FinancialInstrument_1.1       quantmod_0.4-2                TTR_0.22-0.1
               xts_0.9-7                     zoo_1.7-12

loaded via a namespace (and not attached):
[1] grid_3.1.1          lattice_0.20-29     quantstrat_0.9.1632 tools_3.1.1

	[[alternative HTML version deleted]]


From n-e-w at qtradr.net  Mon Nov 24 00:14:51 2014
From: n-e-w at qtradr.net (Nick White)
Date: Mon, 24 Nov 2014 10:14:51 +1100
Subject: [R-SIG-Finance] Bug in tradeStats function?
Message-ID: <CAH+4RFvxDVv1ZbuxMcCD1cNF2yicnsS2sAB65bgA9V+o0_rbrg@mail.gmail.com>

Hi all,

Not sure if I've found a bug here, but I've had some issues with tradeStats
in getting a correct number of trades (as opposed to number of
transactions).

For reproducibility, I'm using the "AMZN" demo from Rev 1317 -- latest code
here:
https://r-forge.r-project.org/scm/viewvc.php/pkg/blotter/demo/amzn_test.R?view=markup&revision=1317&root=blotter
)

So I set `Sys.setenv(TZ="UTC")` and then run the demo script.

I then call:

> getTxns("amzn_port","amzn")

                    Txn.Qty Txn.Price Txn.Fees Txn.Value Txn.Avg.Cost
Net.Txn.Realized.PL
2010-01-14 00:00:00       0      0.00        0         0         0.00
            0
2010-01-14 15:18:50    -400    127.49        0    -50996       127.49
        50996
2010-01-14 15:18:53     400    127.49        0     50996       127.49
            0
2010-01-14 15:21:50    -300    127.26        0    -38178       127.26
        38178
2010-01-14 15:21:53     300    127.26        0     38178       127.26
            0
2010-01-14 15:23:07     100    127.17        0     12717       127.17
       -12717
2010-01-14 15:23:10    -100    127.19        0    -12719       127.19
            2
2010-01-14 15:37:56    -400    127.12        0    -50848       127.12
        50848
2010-01-14 15:37:59     400    127.12        0     50848       127.12
            0
2010-01-14 15:38:32    -500    127.23        0    -63615       127.23
        63615
2010-01-14 15:38:35     500    127.23        0     63615       127.23
            0
2010-01-14 15:38:37     300    127.27        0     38181       127.27
       -38181
2010-01-14 15:38:40    -300    127.30        0    -38190       127.30
            9
2010-01-14 15:46:08   -1300    126.95        0   -165035       126.95
       165035
2010-01-14 15:46:11    1300    126.95        0    165035       126.95
            0

and we see 14 transactions comprising 7 flat-to-flat trades (though, of
course, there is the portfolio initiation at midnight on the 14th, which
brings it up to 15 entries)

However, when I call

   > t(tradeStats("amzn_port"))
                   amzn
Portfolio          "amzn_port"
Symbol             "amzn"
Num.Txns           "14"
Num.Trades         "9"
Net.Trading.PL     "11"
Avg.Trade.PL       "35309.44"
Med.Trade.PL       "38178"
Largest.Winner     "165035"
Largest.Loser      "-38181"
Gross.Profits      "368683"
Gross.Losses       "-50898"
Std.Dev.Trade.PL   "59503.98"
Percent.Positive   "77.77778"
Percent.Negative   "22.22222"
Profit.Factor      "7.243566"
Avg.Win.Trade      "52669"
Med.Win.Trade      "50848"
Avg.Losing.Trade   "-25449"
Med.Losing.Trade   "-25449"
Avg.Daily.PL       "317785"
Med.Daily.PL       "317785"
Std.Dev.Daily.PL   NA
Ann.Sharpe         NA
Max.Drawdown       "-109.0012"
Profit.To.Max.Draw "0.1009164"
Avg.WinLoss.Ratio  "2.06959"
Med.WinLoss.Ratio  "1.998035"
Max.Equity         "102.0036"
Min.Equity         "-37.00018"
End.Equity         "11"

Where we get the correct number of trades (14) , but the incorrect number
of trades (9). This also stands contrary to `perTradeStats` which gets it
'right' with 7 line items (apols for formatting)

> perTradeStats("amzn_port")
                Start                 End Init.Pos Max.Pos Num.Txns
Max.Notional.Cost Net.Trading.PL       MAE      MFE Pct.Net.Trading.PL
  Pct.MAE      Pct.MFE tick.Net.Trading.PL   tick.MAE  tick.MFE
1 2010-01-14 15:18:50 2010-01-14 15:18:53     -400    -400        2
   -50996              0   0.00000 72.00098       0.0000000000
 0.0000000000 0.0014118946                   0   0.000000 18.000244
2 2010-01-14 15:21:50 2010-01-14 15:21:53     -300    -300        2
   -38178              0 -33.00082  0.00000       0.0000000000
-0.0008643937 0.0000000000                   0 -11.000275  0.000000
3 2010-01-14 15:23:07 2010-01-14 15:23:10      100     100        2
    12717              2   0.00000 12.94995       0.0001572698
 0.0000000000 0.0010183181                   2   0.000000 12.949951
4 2010-01-14 15:37:56 2010-01-14 15:37:59     -400    -400        2
   -50848              0 -32.04150  0.00000       0.0000000000
-0.0006301429 0.0000000000                   0  -8.010376  0.000000
5 2010-01-14 15:38:32 2010-01-14 15:38:35     -500    -500        2
   -63615              0   0.00000 45.00031       0.0000000000
 0.0000000000 0.0007073851                   0   0.000000  9.000061
6 2010-01-14 15:38:37 2010-01-14 15:38:40      300     300        2
    38181              9 -39.00018  9.00000       0.0002357193
-0.0010214553 0.0002357193                   3 -13.000061  3.000000
7 2010-01-14 15:46:08 2010-01-14 15:46:11    -1300   -1300        2
  -165035              0   0.00000 91.00357       0.0000000000
 0.0000000000 0.0005514198                   0   0.000000  7.000275


In my own data set of some fills from Friday I get the following (XYZ is
the dummy ticker)

> t(perTradeStats(b.strategy,"XYZ"))
                    [,1]
Start               "2014-11-21 14:30:01"
End                 "2014-11-21 20:42:26"
Init.Pos            "200"
Max.Pos             "50263"
Num.Txns            "95"
***SNIP***


So `perTradeStats` has rightly calculated the position as being flat to
flat with 95 transactions comprising one single trade starting at 14:30 and
ending at 20:42 UTC....BUT tradeStats makes the error again


Portfolio          "list_demo"
Symbol             "XYZ"
Num.Txns           "95"
Num.Trades         "94"

This is not the first time I've bumped up against this. In other examples
for my own trades, I've found that tradeStats is sensitive to how you've
indexed the data (for example, it doesn't seem to like it if you have some
things as "Date" and others as "POSIXct". But in the above case, ensuring
all indexes are classed the same way still produces the transactions /
trades error.

I think there might perhaps be something assumed in the `tradeDef` function
that may need to be made more explicit depending on system options for time
zone or index class...but thought I'd get some initial thoughts from the
community before proceeding further to reconcile.

Any ideas?

n.

> sessionInfo()
R version 3.1.1 (2014-07-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
States.1252    LC_MONETARY=English_United States.1252 LC_NUMERIC=C
                  LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] blotter_0.9.1637              PerformanceAnalytics_1.4.3541
FinancialInstrument_1.1       quantmod_0.4-2                TTR_0.22-0.1
               xts_0.9-7                     zoo_1.7-12

loaded via a namespace (and not attached):
[1] grid_3.1.1          lattice_0.20-29     quantstrat_0.9.1632 tools_3.1.1

	[[alternative HTML version deleted]]


From brian at braverock.com  Mon Nov 24 04:47:33 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 23 Nov 2014 21:47:33 -0600
Subject: [R-SIG-Finance] Bug in tradeStats function?
In-Reply-To: <CAH+4RFvxDVv1ZbuxMcCD1cNF2yicnsS2sAB65bgA9V+o0_rbrg@mail.gmail.com>
References: <CAH+4RFvxDVv1ZbuxMcCD1cNF2yicnsS2sAB65bgA9V+o0_rbrg@mail.gmail.com>
Message-ID: <5472AA55.3010009@braverock.com>

Yes, it looks like a bug.

One thing I've considered to simplify the code base would be to have 
'tradeStats' use the 'trades' generated by 'perTradeStats' as inputs to 
the calcs.

I'll take a closer look tomorrow.  Any further assistance will of course 
be appreciated, feel free to continue the analisis off-list (and we can 
ping the list once it is resolved).

Regards,

Brian


On 11/23/2014 05:14 PM, Nick White wrote:
> Hi all,
>
> Not sure if I've found a bug here, but I've had some issues with tradeStats
> in getting a correct number of trades (as opposed to number of
> transactions).
>
> For reproducibility, I'm using the "AMZN" demo from Rev 1317 -- latest code
> here:
> https://r-forge.r-project.org/scm/viewvc.php/pkg/blotter/demo/amzn_test.R?view=markup&revision=1317&root=blotter
> )
>
> So I set `Sys.setenv(TZ="UTC")` and then run the demo script.
>
> I then call:
>
>> getTxns("amzn_port","amzn")
>
>                      Txn.Qty Txn.Price Txn.Fees Txn.Value Txn.Avg.Cost
> Net.Txn.Realized.PL
> 2010-01-14 00:00:00       0      0.00        0         0         0.00
>              0
> 2010-01-14 15:18:50    -400    127.49        0    -50996       127.49
>          50996
> 2010-01-14 15:18:53     400    127.49        0     50996       127.49
>              0
> 2010-01-14 15:21:50    -300    127.26        0    -38178       127.26
>          38178
> 2010-01-14 15:21:53     300    127.26        0     38178       127.26
>              0
> 2010-01-14 15:23:07     100    127.17        0     12717       127.17
>         -12717
> 2010-01-14 15:23:10    -100    127.19        0    -12719       127.19
>              2
> 2010-01-14 15:37:56    -400    127.12        0    -50848       127.12
>          50848
> 2010-01-14 15:37:59     400    127.12        0     50848       127.12
>              0
> 2010-01-14 15:38:32    -500    127.23        0    -63615       127.23
>          63615
> 2010-01-14 15:38:35     500    127.23        0     63615       127.23
>              0
> 2010-01-14 15:38:37     300    127.27        0     38181       127.27
>         -38181
> 2010-01-14 15:38:40    -300    127.30        0    -38190       127.30
>              9
> 2010-01-14 15:46:08   -1300    126.95        0   -165035       126.95
>         165035
> 2010-01-14 15:46:11    1300    126.95        0    165035       126.95
>              0
>
> and we see 14 transactions comprising 7 flat-to-flat trades (though, of
> course, there is the portfolio initiation at midnight on the 14th, which
> brings it up to 15 entries)
>
> However, when I call
>
>     > t(tradeStats("amzn_port"))
>                     amzn
> Portfolio          "amzn_port"
> Symbol             "amzn"
> Num.Txns           "14"
> Num.Trades         "9"
> Net.Trading.PL     "11"
> Avg.Trade.PL       "35309.44"
> Med.Trade.PL       "38178"
> Largest.Winner     "165035"
> Largest.Loser      "-38181"
> Gross.Profits      "368683"
> Gross.Losses       "-50898"
> Std.Dev.Trade.PL   "59503.98"
> Percent.Positive   "77.77778"
> Percent.Negative   "22.22222"
> Profit.Factor      "7.243566"
> Avg.Win.Trade      "52669"
> Med.Win.Trade      "50848"
> Avg.Losing.Trade   "-25449"
> Med.Losing.Trade   "-25449"
> Avg.Daily.PL       "317785"
> Med.Daily.PL       "317785"
> Std.Dev.Daily.PL   NA
> Ann.Sharpe         NA
> Max.Drawdown       "-109.0012"
> Profit.To.Max.Draw "0.1009164"
> Avg.WinLoss.Ratio  "2.06959"
> Med.WinLoss.Ratio  "1.998035"
> Max.Equity         "102.0036"
> Min.Equity         "-37.00018"
> End.Equity         "11"
>
> Where we get the correct number of trades (14) , but the incorrect number
> of trades (9). This also stands contrary to `perTradeStats` which gets it
> 'right' with 7 line items (apols for formatting)
>
>> perTradeStats("amzn_port")
>                  Start                 End Init.Pos Max.Pos Num.Txns
> Max.Notional.Cost Net.Trading.PL       MAE      MFE Pct.Net.Trading.PL
>    Pct.MAE      Pct.MFE tick.Net.Trading.PL   tick.MAE  tick.MFE
> 1 2010-01-14 15:18:50 2010-01-14 15:18:53     -400    -400        2
>     -50996              0   0.00000 72.00098       0.0000000000
>   0.0000000000 0.0014118946                   0   0.000000 18.000244
> 2 2010-01-14 15:21:50 2010-01-14 15:21:53     -300    -300        2
>     -38178              0 -33.00082  0.00000       0.0000000000
> -0.0008643937 0.0000000000                   0 -11.000275  0.000000
> 3 2010-01-14 15:23:07 2010-01-14 15:23:10      100     100        2
>      12717              2   0.00000 12.94995       0.0001572698
>   0.0000000000 0.0010183181                   2   0.000000 12.949951
> 4 2010-01-14 15:37:56 2010-01-14 15:37:59     -400    -400        2
>     -50848              0 -32.04150  0.00000       0.0000000000
> -0.0006301429 0.0000000000                   0  -8.010376  0.000000
> 5 2010-01-14 15:38:32 2010-01-14 15:38:35     -500    -500        2
>     -63615              0   0.00000 45.00031       0.0000000000
>   0.0000000000 0.0007073851                   0   0.000000  9.000061
> 6 2010-01-14 15:38:37 2010-01-14 15:38:40      300     300        2
>      38181              9 -39.00018  9.00000       0.0002357193
> -0.0010214553 0.0002357193                   3 -13.000061  3.000000
> 7 2010-01-14 15:46:08 2010-01-14 15:46:11    -1300   -1300        2
>    -165035              0   0.00000 91.00357       0.0000000000
>   0.0000000000 0.0005514198                   0   0.000000  7.000275
>
>
> In my own data set of some fills from Friday I get the following (XYZ is
> the dummy ticker)
>
>> t(perTradeStats(b.strategy,"XYZ"))
>                      [,1]
> Start               "2014-11-21 14:30:01"
> End                 "2014-11-21 20:42:26"
> Init.Pos            "200"
> Max.Pos             "50263"
> Num.Txns            "95"
> ***SNIP***
>
>
> So `perTradeStats` has rightly calculated the position as being flat to
> flat with 95 transactions comprising one single trade starting at 14:30 and
> ending at 20:42 UTC....BUT tradeStats makes the error again
>
>
> Portfolio          "list_demo"
> Symbol             "XYZ"
> Num.Txns           "95"
> Num.Trades         "94"
>
> This is not the first time I've bumped up against this. In other examples
> for my own trades, I've found that tradeStats is sensitive to how you've
> indexed the data (for example, it doesn't seem to like it if you have some
> things as "Date" and others as "POSIXct". But in the above case, ensuring
> all indexes are classed the same way still produces the transactions /
> trades error.
>
> I think there might perhaps be something assumed in the `tradeDef` function
> that may need to be made more explicit depending on system options for time
> zone or index class...but thought I'd get some initial thoughts from the
> community before proceeding further to reconcile.
>
> Any ideas?
>
> n.
>
>> sessionInfo()
> R version 3.1.1 (2014-07-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
> States.1252    LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>                    LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] blotter_0.9.1637              PerformanceAnalytics_1.4.3541
> FinancialInstrument_1.1       quantmod_0.4-2                TTR_0.22-0.1
>                 xts_0.9-7                     zoo_1.7-12
>
> loaded via a namespace (and not attached):
> [1] grid_3.1.1          lattice_0.20-29     quantstrat_0.9.1632 tools_3.1.1
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From mitek_bobrovskij at inbox.ru  Mon Nov 24 15:31:35 2014
From: mitek_bobrovskij at inbox.ru (=?UTF-8?B?0JHQvtCx0YDQvtCy0YHQutC40Lkg0JTQvNC40YLRgNC40Lk=?=)
Date: Mon, 24 Nov 2014 17:31:35 +0300
Subject: [R-SIG-Finance] =?utf-8?q?GARCH_Modelling_of_transformed_series?=
Message-ID: <1416839495.231412360@f95.i.mail.ru>

 Hello. I have a really stupid question but... I break my head trying to understand, why fitted quantiles are so poor for my model.
Ok, let me tell about this problem.

Let's have a series (of stock data) - X_{t}. Transform it to Y_{t} = (X_{t} - Mean(X_{t}) / Val, where Val - same constant, which not connected to the series.?
Suppose, that Y_{t} stationary, and fit arma(p,q)+garch(P,Q) model for Y_{t}. So, is it correct to get quantiles for X_{t} as "fitted mean + quantile(conf_lvl, sd = 1, same_distrib) * sqrt(cond.var)" (here same_distrib like distrib used to fit garch part)?

Sorry, I know, this is really stupid question, but I need of your little help...

Thank you.

Best regards,
? ? ? ? ? ? ? ? ? ? ? ? ?Dmitriy.


-- 
??????? ??????????
	[[alternative HTML version deleted]]


From commons.r at karthik.in  Fri Nov 28 06:24:45 2014
From: commons.r at karthik.in (Karthik Raju)
Date: Fri, 28 Nov 2014 10:54:45 +0530
Subject: [R-SIG-Finance] Preparing data for Superior predictive ability
	(SPA) test
Message-ID: <5478071D.1060304@karthik.in>

Hello,

Can anyone please let me know how to prepare data to compute Superior 
predictive ability (SPA) test in R?

I am working on forecasting volatility in stock markets, the context is,

1) I used "rugarch" package to forecast the volatility using "n" 
autoregressive models.

3) Extracted "sigma" values from the forecasts of those "n" models and 
used it in a worksheet against realized volatility to calculate daily 
loss functions for each model, say, MSE, MAE, RMSE etc.

3) I want to compute the SPA test statistics using "ttrTests" package 
and find the SPA test p-values for a benchmark model against "n" 
alternatives. How to prepare data for this purpose?

Thanks,
Karthik


From brian at braverock.com  Fri Nov 28 12:03:39 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 28 Nov 2014 05:03:39 -0600
Subject: [R-SIG-Finance] Preparing data for Superior predictive ability
 (SPA) test
In-Reply-To: <5478071D.1060304@karthik.in>
References: <5478071D.1060304@karthik.in>
Message-ID: <5478568B.6000606@braverock.com>

Please follow the posting guide

http://www.r-project.org/posting-guide.html

and provide a reproducible example.  For instance, you could repeat your 
'n' samples using some of the test data from rugarch.

It is very difficult for others to help you if we don't know the format 
your data is in *now*.

Regards,

Brian


On 11/27/2014 11:24 PM, Karthik Raju wrote:
> Hello,
>
> Can anyone please let me know how to prepare data to compute Superior
> predictive ability (SPA) test in R?
>
> I am working on forecasting volatility in stock markets, the context is,
>
> 1) I used "rugarch" package to forecast the volatility using "n"
> autoregressive models.
>
> 3) Extracted "sigma" values from the forecasts of those "n" models and
> used it in a worksheet against realized volatility to calculate daily
> loss functions for each model, say, MSE, MAE, RMSE etc.
>
> 3) I want to compute the SPA test statistics using "ttrTests" package
> and find the SPA test p-values for a benchmark model against "n"
> alternatives. How to prepare data for this purpose?
>
> Thanks,
> Karthik

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From commons.r at karthik.in  Sat Nov 29 04:44:45 2014
From: commons.r at karthik.in (Karthik Raju)
Date: Sat, 29 Nov 2014 09:14:45 +0530
Subject: [R-SIG-Finance] Preparing data for Superior predictive ability
	(SPA) test
In-Reply-To: <5478071D.1060304@karthik.in>
References: <5478071D.1060304@karthik.in>
Message-ID: <5479412D.7090106@karthik.in>

Hello Brain,

Thank you for your response.

I will explain my work with an example.

- I have logarithmic returns computed from daily closing values of a 
stock market index for a period of 500 days.

- The logarithmic returns are used in the "rugarch" package to fit the 
following models,
Model-1 - GARCH (1,1)
Model-2 - GJR-GARCH (1,1)
Model-3 - EGARCH (1,1)
Model-4 - IGARCH (1,1)
Model-5 - APARCH (1,1)

- Then, using "rugarch", forecasted one step ahead volatility with each 
of the above model parameters for an out-of-sample period of 100 days.

- The forecasted 100 days "sigma" values of each model is extracted from 
R to a worksheet and used against true volatility proxy to compute the 
loss functions.

- The structure of loss function data for each model is an univariate 
series for the forecasted period (100 days).

- For example, the structure of Mean Square Error (MSE) loss function 
looks like,

Forecasts	MSE_GARCH   MSE_GJR   . .  MSE_APARCH
Day 1		0.008548    0.005509  . .  0.00412
Day 2		0.008655    0.005498  . .  0.00414
Day 3		0.008759    0.005488  . .  0.004156
Day 4		0.008861    0.005478  . .  0.004169
.		.	    .	      . .  .
.		.	    .	      . .  .
.		.	    .	      . .  .
Day 99		0.008759    0.005488  . .  0.004156
Day 100		0.008861    0.005478  . .  0.004169

- Similarly, the loss functions like Mean Absolute Error, Mean Absolute 
Percentage Error etc. are in the same structure, which are then imported 
into R.

- Now, by using each of this loss function data series,  one at a time, 
in the "ttrTests" package, I want to know how to compute the SPA test 
for the following combinations?

Benchmark model GARCH (1,1)	  Vs rest of 4 models
Benchmark model GJR GARCH (1,1)	  Vs rest of 4 models
Benchmark model EGARCH (1,1)	  Vs rest of 4 models
Benchmark model IGARCH (1,1)	  Vs rest of 4 models
Benchmark model APARCH (1,1)	  Vs rest of 4 models

Best,
Karthik

> Please follow the posting guide
>
> http://www.r-project.org/posting-guide.html
>
> and provide a reproducible example.  For instance, you could repeat your
> 'n' samples using some of the test data from rugarch.
>
> It is very difficult for others to help you if we don't know the format
> your data is in *now*.
>
> Regards,
>
> Brian
>> On 11/27/2014 11:24 PM, Karthik Raju wrote:
>>
>> Hello,
>>
>> Can anyone please let me know how to prepare data to compute Superior
>> predictive ability (SPA) test in R?
>>
>> I am working on forecasting volatility in stock markets, the context is,
>>
>> 1) I used "rugarch" package to forecast the volatility using "n"
>> autoregressive models.
>>
>> 3) Extracted "sigma" values from the forecasts of those "n" models and
>> used it in a worksheet against realized volatility to calculate daily
>> loss functions for each model, say, MSE, MAE, RMSE etc.
>>
>> 3) I want to compute the SPA test statistics using "ttrTests" package
>> and find the SPA test p-values for a benchmark model against "n"
>> alternatives. How to prepare data for this purpose?
>>
>> Thanks,
>> Karthik


From brian at braverock.com  Sat Nov 29 11:21:09 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Sat, 29 Nov 2014 04:21:09 -0600
Subject: [R-SIG-Finance] Preparing data for Superior predictive ability
 (SPA) test
In-Reply-To: <5479412D.7090106@karthik.in>
References: <5478071D.1060304@karthik.in> <5479412D.7090106@karthik.in>
Message-ID: <54799E15.1010309@braverock.com>

I asked you a reproducible example, and instead, you're asking the list 
to do a bunch of work to replicate your code for you.

Please respect the time of the list members, and provide a few lines of 
code, so that we can *run* your example code and then *help you* with 
your problem.

Brian

On 11/28/2014 09:44 PM, Karthik Raju wrote:
> Hello Brain,
>
> Thank you for your response.
>
> I will explain my work with an example.
>
> - I have logarithmic returns computed from daily closing values of a
> stock market index for a period of 500 days.
>
> - The logarithmic returns are used in the "rugarch" package to fit the
> following models,
> Model-1 - GARCH (1,1)
> Model-2 - GJR-GARCH (1,1)
> Model-3 - EGARCH (1,1)
> Model-4 - IGARCH (1,1)
> Model-5 - APARCH (1,1)
>
> - Then, using "rugarch", forecasted one step ahead volatility with each
> of the above model parameters for an out-of-sample period of 100 days.
>
> - The forecasted 100 days "sigma" values of each model is extracted from
> R to a worksheet and used against true volatility proxy to compute the
> loss functions.
>
> - The structure of loss function data for each model is an univariate
> series for the forecasted period (100 days).
>
> - For example, the structure of Mean Square Error (MSE) loss function
> looks like,
>
> Forecasts    MSE_GARCH   MSE_GJR   . .  MSE_APARCH
> Day 1        0.008548    0.005509  . .  0.00412
> Day 2        0.008655    0.005498  . .  0.00414
> Day 3        0.008759    0.005488  . .  0.004156
> Day 4        0.008861    0.005478  . .  0.004169
> .        .        .          . .  .
> .        .        .          . .  .
> .        .        .          . .  .
> Day 99        0.008759    0.005488  . .  0.004156
> Day 100        0.008861    0.005478  . .  0.004169
>
> - Similarly, the loss functions like Mean Absolute Error, Mean Absolute
> Percentage Error etc. are in the same structure, which are then imported
> into R.
>
> - Now, by using each of this loss function data series,  one at a time,
> in the "ttrTests" package, I want to know how to compute the SPA test
> for the following combinations?
>
> Benchmark model GARCH (1,1)      Vs rest of 4 models
> Benchmark model GJR GARCH (1,1)      Vs rest of 4 models
> Benchmark model EGARCH (1,1)      Vs rest of 4 models
> Benchmark model IGARCH (1,1)      Vs rest of 4 models
> Benchmark model APARCH (1,1)      Vs rest of 4 models
>
> Best,
> Karthik
>
>> Please follow the posting guide
>>
>> http://www.r-project.org/posting-guide.html
>>
>> and provide a reproducible example.  For instance, you could repeat your
>> 'n' samples using some of the test data from rugarch.
>>
>> It is very difficult for others to help you if we don't know the format
>> your data is in *now*.
>>
>> Regards,
>>
>> Brian
>>> On 11/27/2014 11:24 PM, Karthik Raju wrote:
>>>
>>> Hello,
>>>
>>> Can anyone please let me know how to prepare data to compute Superior
>>> predictive ability (SPA) test in R?
>>>
>>> I am working on forecasting volatility in stock markets, the context is,
>>>
>>> 1) I used "rugarch" package to forecast the volatility using "n"
>>> autoregressive models.
>>>
>>> 3) Extracted "sigma" values from the forecasts of those "n" models and
>>> used it in a worksheet against realized volatility to calculate daily
>>> loss functions for each model, say, MSE, MAE, RMSE etc.
>>>
>>> 3) I want to compute the SPA test statistics using "ttrTests" package
>>> and find the SPA test p-values for a benchmark model against "n"
>>> alternatives. How to prepare data for this purpose?
>>>
>>> Thanks,
>>> Karthik
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From ivan.popivanov at gmail.com  Sun Nov 30 04:34:36 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Sun, 30 Nov 2014 03:34:36 +0000
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for dollar
	returns?
Message-ID: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>

It seems to me, that statistics (CAGR, drawdowns, etc) expressed in dollars
are quite common in the literature related to future systems. Do you think
that it makes sense to extend the related PerformanceAnalytics functions to
support dollar-returns (it seems to be no more than adding a flag to the
interface)? Or do you think it really belongs elsewhere?

Thanks in advance,
Ivan

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Sun Nov 30 04:37:17 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Sat, 29 Nov 2014 22:37:17 -0500
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for
	dollar returns?
In-Reply-To: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>
References: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>
Message-ID: <CA+oJuEFqTsXv7pphkyjqexgK3QxxGA8Dd_D_u7tSeNsevzwepQ@mail.gmail.com>

Ivan,

What do you mean by dollar returns? You can go from P&L (dollars) to
percent by Return.calculate, unless you mean something else?

-Ilya

On Sat, Nov 29, 2014 at 10:34 PM, Ivan Popivanov <ivan.popivanov at gmail.com>
wrote:

> It seems to me, that statistics (CAGR, drawdowns, etc) expressed in dollars
> are quite common in the literature related to future systems. Do you think
> that it makes sense to extend the related PerformanceAnalytics functions to
> support dollar-returns (it seems to be no more than adding a flag to the
> interface)? Or do you think it really belongs elsewhere?
>
> Thanks in advance,
> Ivan
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From ivan.popivanov at gmail.com  Sun Nov 30 05:05:48 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Sun, 30 Nov 2014 04:05:48 +0000
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for
	dollar returns?
References: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>
	<CA+oJuEFqTsXv7pphkyjqexgK3QxxGA8Dd_D_u7tSeNsevzwepQ@mail.gmail.com>
Message-ID: <CAK7-yAhL2cQU95L-D3OTvu7oTWB4uadysMFz+TPUwYBwLN78zQ@mail.gmail.com>

For instance, given a daily PnL in dollars, extend maxDrawdown to do the
computation also in dollars (under a flag). Something like:

md = maxDrawdown(pnl, dollars=T)

Same could be useful for a few other functions too (not all of course).
That's useful for futures, where one often looks at dollar amounts rather
than percentages.

Regards,
Ivan

On Sat Nov 29 2014 at 22:37:37 Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> Ivan,
>
> What do you mean by dollar returns? You can go from P&L (dollars) to
> percent by Return.calculate, unless you mean something else?
>
> -Ilya
>
> On Sat, Nov 29, 2014 at 10:34 PM, Ivan Popivanov <ivan.popivanov at gmail.com
> > wrote:
>
>> It seems to me, that statistics (CAGR, drawdowns, etc) expressed in
>> dollars
>> are quite common in the literature related to future systems. Do you think
>> that it makes sense to extend the related PerformanceAnalytics functions
>> to
>> support dollar-returns (it seems to be no more than adding a flag to the
>> interface)? Or do you think it really belongs elsewhere?
>>
>> Thanks in advance,
>> Ivan
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Sun Nov 30 05:15:09 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Sat, 29 Nov 2014 23:15:09 -0500
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for
	dollar returns?
In-Reply-To: <CAK7-yAhL2cQU95L-D3OTvu7oTWB4uadysMFz+TPUwYBwLN78zQ@mail.gmail.com>
References: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>
	<CA+oJuEFqTsXv7pphkyjqexgK3QxxGA8Dd_D_u7tSeNsevzwepQ@mail.gmail.com>
	<CAK7-yAhL2cQU95L-D3OTvu7oTWB4uadysMFz+TPUwYBwLN78zQ@mail.gmail.com>
Message-ID: <CA+oJuEFWVoYrpmzqEQipKo5NFdMqZ1G8gjnAUeq-sRPQ9vPBwg@mail.gmail.com>

I believe some of those statistics are in tradeStats for trading systems.
Beyond that, you might want to just do some arithmetic from cumulative
returns.

On Sat, Nov 29, 2014 at 11:05 PM, Ivan Popivanov <ivan.popivanov at gmail.com>
wrote:

> For instance, given a daily PnL in dollars, extend maxDrawdown to do the
> computation also in dollars (under a flag). Something like:
>
> md = maxDrawdown(pnl, dollars=T)
>
> Same could be useful for a few other functions too (not all of course).
> That's useful for futures, where one often looks at dollar amounts rather
> than percentages.
>
> Regards,
> Ivan
>
> On Sat Nov 29 2014 at 22:37:37 Ilya Kipnis <ilya.kipnis at gmail.com> wrote:
>
>> Ivan,
>>
>> What do you mean by dollar returns? You can go from P&L (dollars) to
>> percent by Return.calculate, unless you mean something else?
>>
>> -Ilya
>>
>> On Sat, Nov 29, 2014 at 10:34 PM, Ivan Popivanov <
>> ivan.popivanov at gmail.com> wrote:
>>
>>> It seems to me, that statistics (CAGR, drawdowns, etc) expressed in
>>> dollars
>>> are quite common in the literature related to future systems. Do you
>>> think
>>> that it makes sense to extend the related PerformanceAnalytics functions
>>> to
>>> support dollar-returns (it seems to be no more than adding a flag to the
>>> interface)? Or do you think it really belongs elsewhere?
>>>
>>> Thanks in advance,
>>> Ivan
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>>> should go.
>>>
>>
>>

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Sun Nov 30 05:23:39 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Sat, 29 Nov 2014 23:23:39 -0500
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for
	dollar returns?
In-Reply-To: <CAH+4RFs8AOpx97NM3iXg63+vGOKmXX_grwThJO6CqVUxrEP9-w@mail.gmail.com>
References: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>
	<CA+oJuEFqTsXv7pphkyjqexgK3QxxGA8Dd_D_u7tSeNsevzwepQ@mail.gmail.com>
	<CAK7-yAhL2cQU95L-D3OTvu7oTWB4uadysMFz+TPUwYBwLN78zQ@mail.gmail.com>
	<CA+oJuEFWVoYrpmzqEQipKo5NFdMqZ1G8gjnAUeq-sRPQ9vPBwg@mail.gmail.com>
	<CAH+4RFs8AOpx97NM3iXg63+vGOKmXX_grwThJO6CqVUxrEP9-w@mail.gmail.com>
Message-ID: <CA+oJuEFQsjNSpUmVKkUTFJ8A-buySyi=ox9ij9GzzQY9o9_7eA@mail.gmail.com>

But just to beat this into the ground:

>From returns to dollars, it's simply a matter of multiplying your starting
equity by the cumulative return series.
To go from dollars to returns, there's the Return.calculate function in
PerfA.
To get nominal returns from a trading system in quantstrat, you need to
specify initial equity, and then your returns will be a function of your
instrument P&L against your starting equity.

-Ilya

On Sat, Nov 29, 2014 at 11:20 PM, Nick White <n-e-w at qtradr.net> wrote:

> What Ilya says is correct.
>
> In professional finance, it's rarer to report in dollars -- largely
> because in professional trading you're often funding an account with $n
> which bares little relation to the nominal position size you might have
> active in the market. Hence understanding nominal return patterns is
> typically higher value.
>
> It's also pretty trivial to turn xts return series into dollar returns. If
> you want more complex sizing -- and your system is amenable to that type of
> modelling -- check out the `blotter` and `quantstrat` packages.
>
> On Sun, Nov 30, 2014 at 3:15 PM, Ilya Kipnis <ilya.kipnis at gmail.com>
> wrote:
>
>> I believe some of those statistics are in tradeStats for trading systems.
>> Beyond that, you might want to just do some arithmetic from cumulative
>> returns.
>>
>> On Sat, Nov 29, 2014 at 11:05 PM, Ivan Popivanov <
>> ivan.popivanov at gmail.com>
>> wrote:
>>
>> > For instance, given a daily PnL in dollars, extend maxDrawdown to do the
>> > computation also in dollars (under a flag). Something like:
>> >
>> > md = maxDrawdown(pnl, dollars=T)
>> >
>> > Same could be useful for a few other functions too (not all of course).
>> > That's useful for futures, where one often looks at dollar amounts
>> rather
>> > than percentages.
>> >
>> > Regards,
>> > Ivan
>> >
>> > On Sat Nov 29 2014 at 22:37:37 Ilya Kipnis <ilya.kipnis at gmail.com>
>> wrote:
>> >
>> >> Ivan,
>> >>
>> >> What do you mean by dollar returns? You can go from P&L (dollars) to
>> >> percent by Return.calculate, unless you mean something else?
>> >>
>> >> -Ilya
>> >>
>> >> On Sat, Nov 29, 2014 at 10:34 PM, Ivan Popivanov <
>> >> ivan.popivanov at gmail.com> wrote:
>> >>
>> >>> It seems to me, that statistics (CAGR, drawdowns, etc) expressed in
>> >>> dollars
>> >>> are quite common in the literature related to future systems. Do you
>> >>> think
>> >>> that it makes sense to extend the related PerformanceAnalytics
>> functions
>> >>> to
>> >>> support dollar-returns (it seems to be no more than adding a flag to
>> the
>> >>> interface)? Or do you think it really belongs elsewhere?
>> >>>
>> >>> Thanks in advance,
>> >>> Ivan
>> >>>
>> >>>         [[alternative HTML version deleted]]
>> >>>
>> >>> _______________________________________________
>> >>> R-SIG-Finance at r-project.org mailing list
>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> >>> -- Subscriber-posting only. If you want to post, subscribe first.
>> >>> -- Also note that this is not the r-help list where general R
>> questions
>> >>> should go.
>> >>>
>> >>
>> >>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>

	[[alternative HTML version deleted]]


From ivan.popivanov at gmail.com  Sun Nov 30 05:24:06 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Sun, 30 Nov 2014 04:24:06 +0000
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for
	dollar returns?
References: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>
	<CA+oJuEFqTsXv7pphkyjqexgK3QxxGA8Dd_D_u7tSeNsevzwepQ@mail.gmail.com>
	<CAK7-yAhL2cQU95L-D3OTvu7oTWB4uadysMFz+TPUwYBwLN78zQ@mail.gmail.com>
	<CA+oJuEFWVoYrpmzqEQipKo5NFdMqZ1G8gjnAUeq-sRPQ9vPBwg@mail.gmail.com>
Message-ID: <CAK7-yAgJ=7Z64P4y=mA1LqBFH9D_GdJ5uqSXDj0BVTmVggyTYw@mail.gmail.com>

It was more of a question for the package maintainers. I am going to do the
work anyways, the question is whether to do it in PerformanceAnalytics, or
elsewhere (if they deem that that's not something to add to the package).
On Sat Nov 29 2014 at 23:15:30 Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> I believe some of those statistics are in tradeStats for trading systems.
> Beyond that, you might want to just do some arithmetic from cumulative
> returns.
>
> On Sat, Nov 29, 2014 at 11:05 PM, Ivan Popivanov <ivan.popivanov at gmail.com
> > wrote:
>
>> For instance, given a daily PnL in dollars, extend maxDrawdown to do the
>> computation also in dollars (under a flag). Something like:
>>
>> md = maxDrawdown(pnl, dollars=T)
>>
>> Same could be useful for a few other functions too (not all of course).
>> That's useful for futures, where one often looks at dollar amounts rather
>> than percentages.
>>
>> Regards,
>> Ivan
>>
>> On Sat Nov 29 2014 at 22:37:37 Ilya Kipnis <ilya.kipnis at gmail.com> wrote:
>>
>>> Ivan,
>>>
>>> What do you mean by dollar returns? You can go from P&L (dollars) to
>>> percent by Return.calculate, unless you mean something else?
>>>
>>> -Ilya
>>>
>>> On Sat, Nov 29, 2014 at 10:34 PM, Ivan Popivanov <
>>> ivan.popivanov at gmail.com> wrote:
>>>
>>>> It seems to me, that statistics (CAGR, drawdowns, etc) expressed in
>>>> dollars
>>>> are quite common in the literature related to future systems. Do you
>>>> think
>>>> that it makes sense to extend the related PerformanceAnalytics
>>>> functions to
>>>> support dollar-returns (it seems to be no more than adding a flag to the
>>>> interface)? Or do you think it really belongs elsewhere?
>>>>
>>>> Thanks in advance,
>>>> Ivan
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-SIG-Finance at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>>> -- Also note that this is not the r-help list where general R questions
>>>> should go.
>>>>
>>>
>>>
>

	[[alternative HTML version deleted]]


From ivan.popivanov at gmail.com  Sun Nov 30 05:34:04 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Sun, 30 Nov 2014 04:34:04 +0000
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for
	dollar returns?
References: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>
	<CA+oJuEFqTsXv7pphkyjqexgK3QxxGA8Dd_D_u7tSeNsevzwepQ@mail.gmail.com>
	<CAK7-yAhL2cQU95L-D3OTvu7oTWB4uadysMFz+TPUwYBwLN78zQ@mail.gmail.com>
	<CA+oJuEFWVoYrpmzqEQipKo5NFdMqZ1G8gjnAUeq-sRPQ9vPBwg@mail.gmail.com>
	<CAH+4RFs8AOpx97NM3iXg63+vGOKmXX_grwThJO6CqVUxrEP9-w@mail.gmail.com>
	<CA+oJuEFQsjNSpUmVKkUTFJ8A-buySyi=ox9ij9GzzQY9o9_7eA@mail.gmail.com>
Message-ID: <CAK7-yAgmnzYXoBFbC2-AjBf1PmrEEd5SuWW3HZnP+GRvfpfd8A@mail.gmail.com>

The notion of "starting equity" is blurry when dealing with futures and
other instruments allowing high leverage. It's not just a coincidence that
most books on the topic use dollars.

On Sat Nov 29 2014 at 23:25:55 Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> But just to beat this into the ground:
>
> >From returns to dollars, it's simply a matter of multiplying your starting
> equity by the cumulative return series.
> To go from dollars to returns, there's the Return.calculate function in
> PerfA.
> To get nominal returns from a trading system in quantstrat, you need to
> specify initial equity, and then your returns will be a function of your
> instrument P&L against your starting equity.
>
> -Ilya
>
> On Sat, Nov 29, 2014 at 11:20 PM, Nick White <n-e-w at qtradr.net> wrote:
>
> > What Ilya says is correct.
> >
> > In professional finance, it's rarer to report in dollars -- largely
> > because in professional trading you're often funding an account with $n
> > which bares little relation to the nominal position size you might have
> > active in the market. Hence understanding nominal return patterns is
> > typically higher value.
> >
> > It's also pretty trivial to turn xts return series into dollar returns.
> If
> > you want more complex sizing -- and your system is amenable to that type
> of
> > modelling -- check out the `blotter` and `quantstrat` packages.
> >
> > On Sun, Nov 30, 2014 at 3:15 PM, Ilya Kipnis <ilya.kipnis at gmail.com>
> > wrote:
> >
> >> I believe some of those statistics are in tradeStats for trading
> systems.
> >> Beyond that, you might want to just do some arithmetic from cumulative
> >> returns.
> >>
> >> On Sat, Nov 29, 2014 at 11:05 PM, Ivan Popivanov <
> >> ivan.popivanov at gmail.com>
> >> wrote:
> >>
> >> > For instance, given a daily PnL in dollars, extend maxDrawdown to do
> the
> >> > computation also in dollars (under a flag). Something like:
> >> >
> >> > md = maxDrawdown(pnl, dollars=T)
> >> >
> >> > Same could be useful for a few other functions too (not all of
> course).
> >> > That's useful for futures, where one often looks at dollar amounts
> >> rather
> >> > than percentages.
> >> >
> >> > Regards,
> >> > Ivan
> >> >
> >> > On Sat Nov 29 2014 at 22:37:37 Ilya Kipnis <ilya.kipnis at gmail.com>
> >> wrote:
> >> >
> >> >> Ivan,
> >> >>
> >> >> What do you mean by dollar returns? You can go from P&L (dollars) to
> >> >> percent by Return.calculate, unless you mean something else?
> >> >>
> >> >> -Ilya
> >> >>
> >> >> On Sat, Nov 29, 2014 at 10:34 PM, Ivan Popivanov <
> >> >> ivan.popivanov at gmail.com> wrote:
> >> >>
> >> >>> It seems to me, that statistics (CAGR, drawdowns, etc) expressed in
> >> >>> dollars
> >> >>> are quite common in the literature related to future systems. Do you
> >> >>> think
> >> >>> that it makes sense to extend the related PerformanceAnalytics
> >> functions
> >> >>> to
> >> >>> support dollar-returns (it seems to be no more than adding a flag to
> >> the
> >> >>> interface)? Or do you think it really belongs elsewhere?
> >> >>>
> >> >>> Thanks in advance,
> >> >>> Ivan
> >> >>>
> >> >>>         [[alternative HTML version deleted]]
> >> >>>
> >> >>> _______________________________________________
> >> >>> R-SIG-Finance at r-project.org mailing list
> >> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> >>> -- Subscriber-posting only. If you want to post, subscribe first.
> >> >>> -- Also note that this is not the r-help list where general R
> >> questions
> >> >>> should go.
> >> >>>
> >> >>
> >> >>
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >>
> >
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From brian at braverock.com  Sun Nov 30 10:46:44 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 30 Nov 2014 03:46:44 -0600
Subject: [R-SIG-Finance] [PerformanceAnalytics] Adding support for
 dollar returns?
In-Reply-To: <CAK7-yAgmnzYXoBFbC2-AjBf1PmrEEd5SuWW3HZnP+GRvfpfd8A@mail.gmail.com>
References: <CAK7-yAj8mf=eLAc08jnLiyWN220h6k3Hhmv9qsmTXf8Ry4oQNQ@mail.gmail.com>	<CA+oJuEFqTsXv7pphkyjqexgK3QxxGA8Dd_D_u7tSeNsevzwepQ@mail.gmail.com>	<CAK7-yAhL2cQU95L-D3OTvu7oTWB4uadysMFz+TPUwYBwLN78zQ@mail.gmail.com>	<CA+oJuEFWVoYrpmzqEQipKo5NFdMqZ1G8gjnAUeq-sRPQ9vPBwg@mail.gmail.com>	<CAH+4RFs8AOpx97NM3iXg63+vGOKmXX_grwThJO6CqVUxrEP9-w@mail.gmail.com>	<CA+oJuEFQsjNSpUmVKkUTFJ8A-buySyi=ox9ij9GzzQY9o9_7eA@mail.gmail.com>
	<CAK7-yAgmnzYXoBFbC2-AjBf1PmrEEd5SuWW3HZnP+GRvfpfd8A@mail.gmail.com>
Message-ID: <547AE784.1040703@braverock.com>

Ivan,

Yes, I agree.  While in general PerformanceAnalytics deals with percent 
returns rather than cash P&L, where, possible, it would be nice to have 
the functions support both.

I'd be happy to discuss the implementation details with you off-list, 
and we'd certainly look to integrate it into the package.

Regards,

Brian

On 11/29/2014 10:34 PM, Ivan Popivanov wrote:
> The notion of "starting equity" is blurry when dealing with futures and
> other instruments allowing high leverage. It's not just a coincidence that
> most books on the topic use dollars.
>
> On Sat Nov 29 2014 at 23:25:55 Ilya Kipnis <ilya.kipnis at gmail.com> wrote:
>
>> But just to beat this into the ground:
>>
>> >From returns to dollars, it's simply a matter of multiplying your starting
>> equity by the cumulative return series.
>> To go from dollars to returns, there's the Return.calculate function in
>> PerfA.
>> To get nominal returns from a trading system in quantstrat, you need to
>> specify initial equity, and then your returns will be a function of your
>> instrument P&L against your starting equity.
>>
>> -Ilya
>>
>> On Sat, Nov 29, 2014 at 11:20 PM, Nick White <n-e-w at qtradr.net> wrote:
>>
>>> What Ilya says is correct.
>>>
>>> In professional finance, it's rarer to report in dollars -- largely
>>> because in professional trading you're often funding an account with $n
>>> which bares little relation to the nominal position size you might have
>>> active in the market. Hence understanding nominal return patterns is
>>> typically higher value.
>>>
>>> It's also pretty trivial to turn xts return series into dollar returns.
>> If
>>> you want more complex sizing -- and your system is amenable to that type
>> of
>>> modelling -- check out the `blotter` and `quantstrat` packages.
>>>
>>> On Sun, Nov 30, 2014 at 3:15 PM, Ilya Kipnis <ilya.kipnis at gmail.com>
>>> wrote:
>>>
>>>> I believe some of those statistics are in tradeStats for trading
>> systems.
>>>> Beyond that, you might want to just do some arithmetic from cumulative
>>>> returns.
>>>>
>>>> On Sat, Nov 29, 2014 at 11:05 PM, Ivan Popivanov <
>>>> ivan.popivanov at gmail.com>
>>>> wrote:
>>>>
>>>>> For instance, given a daily PnL in dollars, extend maxDrawdown to do
>> the
>>>>> computation also in dollars (under a flag). Something like:
>>>>>
>>>>> md = maxDrawdown(pnl, dollars=T)
>>>>>
>>>>> Same could be useful for a few other functions too (not all of
>> course).
>>>>> That's useful for futures, where one often looks at dollar amounts
>>>> rather
>>>>> than percentages.
>>>>>
>>>>> Regards,
>>>>> Ivan
>>>>>
>>>>> On Sat Nov 29 2014 at 22:37:37 Ilya Kipnis <ilya.kipnis at gmail.com>
>>>> wrote:
>>>>>
>>>>>> Ivan,
>>>>>>
>>>>>> What do you mean by dollar returns? You can go from P&L (dollars) to
>>>>>> percent by Return.calculate, unless you mean something else?
>>>>>>
>>>>>> -Ilya
>>>>>>
>>>>>> On Sat, Nov 29, 2014 at 10:34 PM, Ivan Popivanov <
>>>>>> ivan.popivanov at gmail.com> wrote:
>>>>>>
>>>>>>> It seems to me, that statistics (CAGR, drawdowns, etc) expressed in
>>>>>>> dollars
>>>>>>> are quite common in the literature related to future systems. Do you
>>>>>>> think
>>>>>>> that it makes sense to extend the related PerformanceAnalytics
>>>> functions
>>>>>>> to
>>>>>>> support dollar-returns (it seems to be no more than adding a flag to
>>>> the
>>>>>>> interface)? Or do you think it really belongs elsewhere?
>>>>>>>
>>>>>>> Thanks in advance,
>>>>>>> Ivan


From mitek_bobrovskij at inbox.ru  Sun Nov 30 20:14:04 2014
From: mitek_bobrovskij at inbox.ru (=?UTF-8?B?0JHQvtCx0YDQvtCy0YHQutC40Lkg0JTQvNC40YLRgNC40Lk=?=)
Date: Sun, 30 Nov 2014 22:14:04 +0300
Subject: [R-SIG-Finance]
 =?utf-8?q?Talking_to_C=23_API_=28Any_reference_to?=
 =?utf-8?q?_learn_the_same=29?=
Message-ID: <1417374844.56725197@f419.i.mail.ru>

 The best way to communicate C# and R is R.NET (in ways I know). Look this link:? http://rdotnet.codeplex.com/
So, no internal ways to create multiple instances for R via one C# project. But... It can be "cheated". :-)?

You should write little client-server application which can execute R scripts and use R.NET for this. You can run as many different processes with R as you need - dummy and easy way is to create N different client-servers each works with own port. They are all separated and independent - no problems with using it.
For client-server I use this simple realization:? https://github.com/hikalkan/scs . Works fine.

Better way is to create intermediate manager which will manage your tasks for different R processes and which will be a one-connection point for your application. I have plans to realize it soon.

Best regards,
? ? ? ? ? ? ? ? ? ? ? ? Dmitriy.
	[[alternative HTML version deleted]]


From robsch at robsch.eu  Mon Dec  1 15:51:50 2014
From: robsch at robsch.eu (Robert Schien)
Date: Mon, 1 Dec 2014 15:51:50 +0100
Subject: [R-SIG-Finance] IBrokers question
Message-ID: <20141201145150.GA9702@robsch.eu>


Hello,

I have some questions concerning the IBrokers package.

I want to sample some tick data into a data frame or time series.

What I do is the following:

library(IBrokers)
iws <- ibgConnect()
equity <- twsEquity("GS")
reqMktData(tws,equity)

Now my questions is: How can I access the individual data
like tickprice, ask, bid etc?

I know that I can create an eWrapper structure and modify
the individual functions.

mywrapper <- eWrapper()
mywrapper$tickPrice <- function(msg, timestamp, file, ...) {cat("tickPrice",msg)}              
reqMktData(tws,equity,eventWrapper=mywrapper)

But where are the interesting market data hidden and how can I access them?
This has probably to do with the .data environment and the get.data
method. But how does it work exactly?
The vignette is not quite clear to me.


Thank you in advance.

Greetings
Robert


From censix0 at gmail.com  Mon Dec  1 17:24:17 2014
From: censix0 at gmail.com (cen six)
Date: Mon, 1 Dec 2014 17:24:17 +0100
Subject: [R-SIG-Finance] IBrokers question
In-Reply-To: <20141201145150.GA9702@robsch.eu>
References: <20141201145150.GA9702@robsch.eu>
Message-ID: <CAOGDGTZ0bmGqkYY9VJCgxDEuvyh7QGuZYv9sBUKhnPHKsh2vNg@mail.gmail.com>

You could look at the code for

eWrapper.MktData.CSV


to see how to do something more useful with the datastream other than just
cat'ing it to output ...


mywrapper <- eWrapper()
mywrapper$tickPrice <- function(msg, timestamp, file, ...) {
cat("tickPrice",msg)
... do something useful, ie. store it somewhere, etc...
}
reqMktData(tws,equity,eventWrapper=mywrapper)

On Mon, Dec 1, 2014 at 3:51 PM, Robert Schien <robsch at robsch.eu> wrote:

>
> Hello,
>
> I have some questions concerning the IBrokers package.
>
> I want to sample some tick data into a data frame or time series.
>
> What I do is the following:
>
> library(IBrokers)
> iws <- ibgConnect()
> equity <- twsEquity("GS")
> reqMktData(tws,equity)
>
> Now my questions is: How can I access the individual data
> like tickprice, ask, bid etc?
>
> I know that I can create an eWrapper structure and modify
> the individual functions.
>
> mywrapper <- eWrapper()
> mywrapper$tickPrice <- function(msg, timestamp, file, ...)
> {cat("tickPrice",msg)}
> reqMktData(tws,equity,eventWrapper=mywrapper)
>
> But where are the interesting market data hidden and how can I access them?
> This has probably to do with the .data environment and the get.data
> method. But how does it work exactly?
> The vignette is not quite clear to me.
>
>
> Thank you in advance.
>
> Greetings
> Robert
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From n.manganaro at alum.mit.edu  Tue Dec  2 22:57:22 2014
From: n.manganaro at alum.mit.edu (Nicholas Manganaro)
Date: Tue, 2 Dec 2014 16:57:22 -0500
Subject: [R-SIG-Finance] Optimization of ARFIMA in rugarch - Quick question
	and context
Message-ID: <957971195.8617.1417557442078.JavaMail.help@alum.mit.edu>

Question:
Is there a way to query the Nyblom joint statistic result out of an ARFIMAfit class object, the way there is for a uGARCHfit class object?

Context:
I am running an analysis on subsets from 12 return time series from the Fama/French Factors files (source: http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html) which evidence skewed Student t distributions.
I initially used autoarfima from the rugarch package using the nlminb solver, which generated results for some of the series, but not some others. I sequentially tried the other available solvers on the entire set of series to see if they would identify ARMA models for more of these sets. 
As I hope you can see in the table below the results were mixed. Some observations:
?	There was no solver that found ARMA coefficients for all sectors (not necessarily a problem);
?	For many sectors, the values estimated for the orders of p and q for AR and MA varied across the solvers; and
?	None of the solvers consistently provided either the lowest BIC or AIC score for the results across all sectors.

					Solver			
									
		nlminb		solnp		gosolnp	nloptr
		AR	MA	AR	MA	AR	MA	AR	MA
        Manuf  	4	4	4	4	5	4	4	4
	Other  	NA	NA	NA	NA	0	1	0	1
	Money  NA	NA	NA	NA	NA	NA	NA	NA
	Chems  0	5	0	5	0	5	0	5
	NoDur  	NA	NA	NA	NA	NA	NA	NA	NA
	Shops  	NA	NA	NA	NA	3	4	NA	NA
	Durbl  	0	1	5	5	5	5	5	3
	BusEq  	5	3	5	3	5	3	5	2
	Hlth   	NA	NA	NA	NA	0	5	NA	NA
	Telcm  	5	0	5	5	5	5	5	0
	Utils  	3	4	3	4	0	5	3	4
	Enrgy  	0	1	5	3	4	3	5	3
	Mkt.RF 	5	3	3	2	NA	NA	NA	NA


While I understand that the Nyblom test is an indicator of the stability of the results across a series, within the model results for a sector from the available solvers, a higher Nyblom joint statistic qualitatively seems to indicate higher quality test results across a number of tests, including the coefficient t statistics and the Ljung-Box results per sector. As a result, I was thinking I might use the Nyblom joint statistic as an indicator in automating the selection of the desired model from possible alternatives, but do not see how to query out that result for further testing as an indicator, although I can see it as part of the $fit object. 

Please let me know if there is either such a capability for the ARFIMAfit class that I may have overlooked, or a function I might call to generate the joint Nyblom statistic and critical values using the zoo time series data and the existing autoarfima results on hand.

Thanks.

-Nick

From alexios at 4dscape.com  Tue Dec  2 23:27:26 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Tue, 02 Dec 2014 22:27:26 +0000
Subject: [R-SIG-Finance] Optimization of ARFIMA in rugarch - Quick
 question and context
In-Reply-To: <957971195.8617.1417557442078.JavaMail.help@alum.mit.edu>
References: <957971195.8617.1417557442078.JavaMail.help@alum.mit.edu>
Message-ID: <547E3CCE.9080006@4dscape.com>

The returned list from autoarfima has 2 slots, 'fit' and 'rank.matrix'. 
The former is of class ARFIMAfit, and though not exported to work with 
it, you can use

 >rugarch:::.nyblomTest(fit).

If you provide some additional details (i.e. reproducible code and which 
data you are using...monthly/daily,value-weighted or equally weighted) 
then we might be able to provide some additional help.

Regards,

Alexios

On 02/12/2014 21:57, Nicholas Manganaro wrote:
> Question:
> Is there a way to query the Nyblom joint statistic result out of an ARFIMAfit class object, the way there is for a uGARCHfit class object?
>
> Context:
> I am running an analysis on subsets from 12 return time series from the Fama/French Factors files (source: http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html) which evidence skewed Student t distributions.
> I initially used autoarfima from the rugarch package using the nlminb solver, which generated results for some of the series, but not some others. I sequentially tried the other available solvers on the entire set of series to see if they would identify ARMA models for more of these sets.
> As I hope you can see in the table below the results were mixed. Some observations:
> ?	There was no solver that found ARMA coefficients for all sectors (not necessarily a problem);
> ?	For many sectors, the values estimated for the orders of p and q for AR and MA varied across the solvers; and
> ?	None of the solvers consistently provided either the lowest BIC or AIC score for the results across all sectors.
>
> 					Solver			
> 									
> 		nlminb		solnp		gosolnp	nloptr
> 		AR	MA	AR	MA	AR	MA	AR	MA
>          Manuf  	4	4	4	4	5	4	4	4
> 	Other  	NA	NA	NA	NA	0	1	0	1
> 	Money  NA	NA	NA	NA	NA	NA	NA	NA
> 	Chems  0	5	0	5	0	5	0	5
> 	NoDur  	NA	NA	NA	NA	NA	NA	NA	NA
> 	Shops  	NA	NA	NA	NA	3	4	NA	NA
> 	Durbl  	0	1	5	5	5	5	5	3
> 	BusEq  	5	3	5	3	5	3	5	2
> 	Hlth   	NA	NA	NA	NA	0	5	NA	NA
> 	Telcm  	5	0	5	5	5	5	5	0
> 	Utils  	3	4	3	4	0	5	3	4
> 	Enrgy  	0	1	5	3	4	3	5	3
> 	Mkt.RF 	5	3	3	2	NA	NA	NA	NA
>
>
> While I understand that the Nyblom test is an indicator of the stability of the results across a series, within the model results for a sector from the available solvers, a higher Nyblom joint statistic qualitatively seems to indicate higher quality test results across a number of tests, including the coefficient t statistics and the Ljung-Box results per sector. As a result, I was thinking I might use the Nyblom joint statistic as an indicator in automating the selection of the desired model from possible alternatives, but do not see how to query out that result for further testing as an indicator, although I can see it as part of the $fit object.
>
> Please let me know if there is either such a capability for the ARFIMAfit class that I may have overlooked, or a function I might call to generate the joint Nyblom statistic and critical values using the zoo time series data and the existing autoarfima results on hand.
>
> Thanks.
>
> -Nick
>
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From n.manganaro at alum.mit.edu  Wed Dec  3 04:24:56 2014
From: n.manganaro at alum.mit.edu (Nicholas Manganaro)
Date: Tue, 2 Dec 2014 22:24:56 -0500
Subject: [R-SIG-Finance] Optimization of ARFIMA in rugarch - Quick
 question and context
Message-ID: <2084435915.8916.1417577096275.JavaMail.help@alum.mit.edu>

Alexios,
Thank you for your concise answer. I had seen the function nyblom available for use with the uCARCHfit objects. It does not seem to work with ARFIMAfit objects in the same way the identified methods do (please see below for a sample).  However, I have not yet found the key to running nyblomTest on the ARFIMAfit object that results from running the following code snippit:

## optimization methods = "nlminb", "solnp", "gosolnp", "nloptr"

solv <- c("nlminb","solnp","gosolnp","nloptr") 
auto_nloptr <- list()
for (i in 1:z)
{
auto_nlminb[[i]] <- try(autoarfima(Z.std[,i], ar.max = 5, ma.max = 5, criterion = "BIC",
method = "full", arfima = FALSE, include.mean = NULL,
distribution.model = "sstd", solver = solv[1], return.all = FALSE),
silent = TRUE)
}

This process eventually provides ARFIMAfit objects as list members for the sectors for which an optimized solution was found. I ran it solver by solver, creating 4 lists of objects. These solver-specific lists were then made members of a list object which I have been querying, as indicated in the following: 

AIC.array[j,k] <- infocriteria(varMod[[k]][[j]]$fit)[1]

Where j is the sector, k is the solver and varMod is the list of lists of ARFIMAFit objects mentioned earlier.

Details:
R 3.1.2, platform = i386-w64-mingw32/i386, OS = Win 7 SP1
Assume rugarch and zoo are loaded. Z.std is a zoo object of subsets of the monthly return series identified in the previous message with start and end points that are uniform across sectors and with no NA entries. They have been standardized to have 0 mean and st. dev = 1. The data are unweighted as they are submitted to the autoarfima function. The variable z represents the number of sectors, equivalent to the number of series in Z.std.

I hope that is enough detail to help you help me with this. 
I look forward to your response.
Regards,
Nick

-----Original Message-----
From: alexios ghalanos [mailto:alexios at 4dscape.com] 
Sent: Tuesday, December 02, 2014 5:27 PM
To: Nicholas Manganaro; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Optimization of ARFIMA in rugarch - Quick question and context

The returned list from autoarfima has 2 slots, 'fit' and 'rank.matrix'. 
The former is of class ARFIMAfit, and though not exported to work with it, you can use

 >rugarch:::.nyblomTest(fit).

If you provide some additional details (i.e. reproducible code and which data you are using...monthly/daily,value-weighted or equally weighted) then we might be able to provide some additional help.

Regards,

Alexios

On 02/12/2014 21:57, Nicholas Manganaro wrote:
> Question:
> Is there a way to query the Nyblom joint statistic result out of an ARFIMAfit class object, the way there is for a uGARCHfit class object?
>
> Context:
> I am running an analysis on subsets from 12 return time series from the Fama/French Factors files (source: http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html) which evidence skewed Student t distributions.
> I initially used autoarfima from the rugarch package using the nlminb solver, which generated results for some of the series, but not some others. I sequentially tried the other available solvers on the entire set of series to see if they would identify ARMA models for more of these sets.
> As I hope you can see in the table below the results were mixed. Some observations:
> ?	There was no solver that found ARMA coefficients for all sectors (not necessarily a problem);
> ?	For many sectors, the values estimated for the orders of p and q for AR and MA varied across the solvers; and
> ?	None of the solvers consistently provided either the lowest BIC or AIC score for the results across all sectors.
>
> 					Solver			
> 									
> 		nlminb		solnp		gosolnp	nloptr
> 		AR	MA	AR	MA	AR	MA	AR	MA
>          Manuf  	4	4	4	4	5	4	4	4
> 	Other  	NA	NA	NA	NA	0	1	0	1
> 	Money  NA	NA	NA	NA	NA	NA	NA	NA
> 	Chems  0	5	0	5	0	5	0	5
> 	NoDur  	NA	NA	NA	NA	NA	NA	NA	NA
> 	Shops  	NA	NA	NA	NA	3	4	NA	NA
> 	Durbl  	0	1	5	5	5	5	5	3
> 	BusEq  	5	3	5	3	5	3	5	2
> 	Hlth   	NA	NA	NA	NA	0	5	NA	NA
> 	Telcm  	5	0	5	5	5	5	5	0
> 	Utils  	3	4	3	4	0	5	3	4
> 	Enrgy  	0	1	5	3	4	3	5	3
> 	Mkt.RF 	5	3	3	2	NA	NA	NA	NA
>
>
> While I understand that the Nyblom test is an indicator of the stability of the results across a series, within the model results for a sector from the available solvers, a higher Nyblom joint statistic qualitatively seems to indicate higher quality test results across a number of tests, including the coefficient t statistics and the Ljung-Box results per sector. As a result, I was thinking I might use the Nyblom joint statistic as an indicator in automating the selection of the desired model from possible alternatives, but do not see how to query out that result for further testing as an indicator, although I can see it as part of the $fit object.
>
> Please let me know if there is either such a capability for the ARFIMAfit class that I may have overlooked, or a function I might call to generate the joint Nyblom statistic and critical values using the zoo time series data and the existing autoarfima results on hand.
>
> Thanks.
>
> -Nick
>
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>

From hs13322 at my.bristol.ac.uk  Thu Dec  4 08:32:12 2014
From: hs13322 at my.bristol.ac.uk (Marco Sun)
Date: Thu, 4 Dec 2014 15:32:12 +0800
Subject: [R-SIG-Finance] how to rename stock codes?
Message-ID: <81086660-2886-4EC6-B94C-FFF4E1A18A33@my.bristol.ac.uk>

Hello Sage R people,

 

I am able to retrieve data and rename the stock code one by one through quantmod package as the following:

 

symbols<-c("AAPL","MSFT")

stockcodes<-c("A","B")

setSymbolLookup(A=list(name="AAPL",src="yahoo"))

getSymbols("A")

setSymbolLookup(B=list(name=?MSFT",src="yahoo"))


getSymbols(?B")

 

 

However, the same logic is not approachable in the ?mass production era? like this:

 

for (i in 1:2)

{

  getSymbolLookup(stockcodes[i]=list(name=symbols[i],src="yahoo"))

  getSymbols("stockcodes[i]")

}

 

I guess the problem lies in stockcodes[i] as indicated in red. Any comment would be appreciated.



Thanks in advance,



Marco 
	[[alternative HTML version deleted]]


From hs13322 at my.bristol.ac.uk  Thu Dec  4 08:57:41 2014
From: hs13322 at my.bristol.ac.uk (Marco Sun)
Date: Thu, 4 Dec 2014 15:57:41 +0800
Subject: [R-SIG-Finance] Fwd: how to rename stock codes?
References: <81086660-2886-4EC6-B94C-FFF4E1A18A33@my.bristol.ac.uk>
Message-ID: <3702B467-C11B-4E66-AB51-E009166EA559@my.bristol.ac.uk>

Ok, I?ve found a previous solution here https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20100722/1ca9df46/attachment.pl

Begin forwarded message:

> From: Marco Sun <hs13322 at my.bristol.ac.uk>
> Subject: how to rename stock codes?
> Date: 4 December 2014 03:32:12 pm GMT+8
> To: r-sig-finance at r-project.org
> 
> Hello Sage R people,
> 
>  
> 
> I am able to retrieve data and rename the stock code one by one through quantmod package as the following:
> 
>  
> 
> symbols<-c("AAPL","MSFT")
> 
> stockcodes<-c("A","B")
> 
> setSymbolLookup(A=list(name="AAPL",src="yahoo"))
> 
> getSymbols("A")
> 
> setSymbolLookup(B=list(name=?MSFT",src="yahoo"))
> 
> 
> getSymbols(?B")
> 
>  
> 
>  
> 
> However, the same logic is not approachable in the ?mass production era? like this:
> 
>  
> 
> for (i in 1:2)
> 
> {
> 
>   getSymbolLookup(stockcodes[i]=list(name=symbols[i],src="yahoo"))
> 
>   getSymbols("stockcodes[i]")
> 
> }
> 
>  
> 
> I guess the problem lies in stockcodes[i] as indicated in red. Any comment would be appreciated.
> 
> 
> 
> Thanks in advance,
> 
> 
> 
> Marco 
> 


	[[alternative HTML version deleted]]


From hs13322 at my.bristol.ac.uk  Thu Dec  4 09:58:30 2014
From: hs13322 at my.bristol.ac.uk (Marco Sun)
Date: Thu, 4 Dec 2014 16:58:30 +0800
Subject: [R-SIG-Finance] rename a large number of stock codes
Message-ID: <ABF60DD4-DAB4-4F05-9EC5-0BC7EBC29912@my.bristol.ac.uk>

Hi, sorry for the previous emails, I am now opening a new topic to demonstrate my problem clearly.

 

I wish to retrieve a bunch of Chinese stock through getSymbols.

 

symbols<-c("600089.SS","600202.SS")

getSymbols(symbols)

 

These stock codes are not easily recognised nor being processed in further analysis, i.e. R does not recognise 600089.SS, instead, it recognises `600089.SS`.

 

> 600089.SS

Error: unexpected symbol in "600089.SS"

 

> class(`600089.SS`)

[1] "xts" "zoo"

`

Therefore, I wish to replace symbols with some simple tickers called stockcodes. I can easily replace the name of 600089.SS via:

 

stockcodes<-c("TBDG","HKT")

TBDG<-`600089.SS`

 

However, it could take a lot while if I have a large portfolio and I do have a well-diversified portfolio under analysis.

 

Another approach came up to me was using setSymbolLookup like this:

 

> setSymbolLookup(TBDG=list(name="600089.SS"))

> getSymbols("TBDG")

[1] "TBDG"

 

But I got error when I was trying to use for loop as the following:

 

for(i in 1:2)

{

 setSymbolLookup(stockcodes[i]=list(name=symbols[i]))

 getSymbols(stockcodes[i])

}

 

Any comment would be appreciated.

 

Cheers,

 

Marco

 

 

 
	[[alternative HTML version deleted]]


From n-e-w at qtradr.net  Thu Dec  4 11:36:00 2014
From: n-e-w at qtradr.net (Nick White)
Date: Thu, 4 Dec 2014 21:36:00 +1100
Subject: [R-SIG-Finance] rename a large number of stock codes
In-Reply-To: <ABF60DD4-DAB4-4F05-9EC5-0BC7EBC29912@my.bristol.ac.uk>
References: <ABF60DD4-DAB4-4F05-9EC5-0BC7EBC29912@my.bristol.ac.uk>
Message-ID: <CAH+4RFt1V8vKprC4wMOhEmbZYNSfESp=yBea_rXEFA60Utsujw@mail.gmail.com>

Hi Marco,

When calling stocks with numerical tickers (like most Asia ex-Japan
markets) in R, you should typically reassign them using `get` when working
interactively -- or `assign`.

In this case, you might want to have something like

TBEA <- get("600089.SS")

Now you have a simple text named variable in the environment to work with.
ie:

> head(TBEA)
           600089.SS.Open 600089.SS.High 600089.SS.Low 600089.SS.Close
600089.SS.Volume 600089.SS.Adjusted
2007-01-01          14.19          14.53         13.78           14.03
           0               2.54
2007-01-02          14.19          14.53         13.78           14.03
           0               2.54
2007-01-03          14.19          14.53         13.78           14.03
           0               2.54
2007-01-04          14.22          15.11         14.03           14.58
    75563100               2.64
2007-01-05          14.59          16.03         14.46           16.03
    72978600               2.90
2007-01-08          16.05          16.60         15.85           16.16
    41251600               2.93

You can extend this to a large group of tickers using a for loop (though
it's not the only way).

In the spirit of how you wrote the question, though, you could do something
like this:

# Put your numerical tickers in a variable, `num.code`

> num.code <- c("600089.SS","600202.SS")

# Put their text equivalents in a different variable, `text.code`

> text.code <- c("TBEA","HAC")

#make a data.frame of the two

code.frame <- data.frame(num.code,text.code,stringsAsFactors=FALSE)

> code.frame
   num.code text.code
1 600089.SS      TBEA
2 600202.SS       HAC

# now call your Symbols

> getSymbols(code.frame$num.code)

# and now run a simple for loop to `assign` the numerical codes to the text
codes

> for (i in 1:length(code.frame)){


assign(code.frame$text.code[i],get(code.frame$num.code[i]),envir=.GlobalEnv)
}


# You will now have two variables, TBEA and HAC which are `xts` objects
that you can now manipulate how you wish

> str(TBEA)
An ?xts? object on 2007-01-01/2014-12-03 containing:
  Data: num [1:2041, 1:6] 14.2 14.2 14.2 14.2 14.6 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : chr [1:6] "600089.SS.Open" "600089.SS.High" "600089.SS.Low"
"600089.SS.Close" ...
  Indexed by objects of class: [Date] TZ: UTC
  xts Attributes:
List of 2
 $ src    : chr "yahoo"
 $ updated: POSIXct[1:1], format: "2014-12-04 21:24:39"

Hope that helps,

n.






On Thu, Dec 4, 2014 at 7:58 PM, Marco Sun <hs13322 at my.bristol.ac.uk> wrote:

> Hi, sorry for the previous emails, I am now opening a new topic to
> demonstrate my problem clearly.
>
>
>
> I wish to retrieve a bunch of Chinese stock through getSymbols.
>
>
>
> symbols<-c("600089.SS","600202.SS")
>
> getSymbols(symbols)
>
>
>
> These stock codes are not easily recognised nor being processed in further
> analysis, i.e. R does not recognise 600089.SS, instead, it recognises
> `600089.SS`.
>
>
>
> > 600089.SS
>
> Error: unexpected symbol in "600089.SS"
>
>
>
> > class(`600089.SS`)
>
> [1] "xts" "zoo"
>
> `
>
> Therefore, I wish to replace symbols with some simple tickers called
> stockcodes. I can easily replace the name of 600089.SS via:
>
>
>
> stockcodes<-c("TBDG","HKT")
>
> TBDG<-`600089.SS`
>
>
>
> However, it could take a lot while if I have a large portfolio and I do
> have a well-diversified portfolio under analysis.
>
>
>
> Another approach came up to me was using setSymbolLookup like this:
>
>
>
> > setSymbolLookup(TBDG=list(name="600089.SS"))
>
> > getSymbols("TBDG")
>
> [1] "TBDG"
>
>
>
> But I got error when I was trying to use for loop as the following:
>
>
>
> for(i in 1:2)
>
> {
>
>  setSymbolLookup(stockcodes[i]=list(name=symbols[i]))
>
>  getSymbols(stockcodes[i])
>
> }
>
>
>
> Any comment would be appreciated.
>
>
>
> Cheers,
>
>
>
> Marco
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Thu Dec  4 12:15:49 2014
From: alexios at 4dscape.com (alexios ghalanos)
Date: Thu, 04 Dec 2014 11:15:49 +0000
Subject: [R-SIG-Finance] Optimization of ARFIMA in rugarch - Quick
 question and context
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAFe0/wttMmpLr60Kt5zUQK7CgAAAEAAAACvIP/GiQ2hKjiQDYETR3FwBAAAAAA==@verizon.net>
References: <2084435915.8916.1417577096275.JavaMail.help@alum.mit.edu>
	<!&!AAAAAAAAAAAYAAAAAAAAAFe0/wttMmpLr60Kt5zUQK7CgAAAEAAAACvIP/GiQ2hKjiQDYETR3FwBAAAAAA==@verizon.net>
Message-ID: <54804265.50808@4dscape.com>

Nicholas,

Email me off list with the details and I may have some time to look at 
this over the next few days.

Alexios

On 04/12/2014 04:56, Nicholas Manganaro wrote:
> Alexios,
> I determined how to apply rugarch:::.nyblomTest, and have pulled the results.
> Thanks, again.
> I do not have a cloud storage locker, so I did not want to send out the data file to everyone on the list, although I'd appreciate someone having a look at my next few steps. Commentary would be welcome.
> -Nick
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf Of Nicholas Manganaro
> Sent: Tuesday, December 02, 2014 10:25 PM
> To: alexios ghalanos
> Cc: r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] Optimization of ARFIMA in rugarch - Quick question and context
>
> Alexios,
> Thank you for your concise answer. I had seen the function nyblom available for use with the uCARCHfit objects. It does not seem to work with ARFIMAfit objects in the same way the identified methods do (please see below for a sample).  However, I have not yet found the key to running nyblomTest on the ARFIMAfit object that results from running the following code snippit:
>
> ## optimization methods = "nlminb", "solnp", "gosolnp", "nloptr"
>
> solv <- c("nlminb","solnp","gosolnp","nloptr")
> auto_nloptr <- list()
> for (i in 1:z)
> {
> auto_nlminb[[i]] <- try(autoarfima(Z.std[,i], ar.max = 5, ma.max = 5, criterion = "BIC", method = "full", arfima = FALSE, include.mean = NULL, distribution.model = "sstd", solver = solv[1], return.all = FALSE), silent = TRUE) }
>
> This process eventually provides ARFIMAfit objects as list members for the sectors for which an optimized solution was found. I ran it solver by solver, creating 4 lists of objects. These solver-specific lists were then made members of a list object which I have been querying, as indicated in the following:
>
> AIC.array[j,k] <- infocriteria(varMod[[k]][[j]]$fit)[1]
>
> Where j is the sector, k is the solver and varMod is the list of lists of ARFIMAFit objects mentioned earlier.
>
> Details:
> R 3.1.2, platform = i386-w64-mingw32/i386, OS = Win 7 SP1 Assume rugarch and zoo are loaded. Z.std is a zoo object of subsets of the monthly return series identified in the previous message with start and end points that are uniform across sectors and with no NA entries. They have been standardized to have 0 mean and st. dev = 1. The data are unweighted as they are submitted to the autoarfima function. The variable z represents the number of sectors, equivalent to the number of series in Z.std.
>
> I hope that is enough detail to help you help me with this.
> I look forward to your response.
> Regards,
> Nick
>
> -----Original Message-----
> From: alexios ghalanos [mailto:alexios at 4dscape.com]
> Sent: Tuesday, December 02, 2014 5:27 PM
> To: Nicholas Manganaro; r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] Optimization of ARFIMA in rugarch - Quick question and context
>
> The returned list from autoarfima has 2 slots, 'fit' and 'rank.matrix'.
> The former is of class ARFIMAfit, and though not exported to work with it, you can use
>
>   >rugarch:::.nyblomTest(fit).
>
> If you provide some additional details (i.e. reproducible code and which data you are using...monthly/daily,value-weighted or equally weighted) then we might be able to provide some additional help.
>
> Regards,
>
> Alexios
>
> On 02/12/2014 21:57, Nicholas Manganaro wrote:
>> Question:
>> Is there a way to query the Nyblom joint statistic result out of an ARFIMAfit class object, the way there is for a uGARCHfit class object?
>>
>> Context:
>> I am running an analysis on subsets from 12 return time series from the Fama/French Factors files (source: http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html) which evidence skewed Student t distributions.
>> I initially used autoarfima from the rugarch package using the nlminb solver, which generated results for some of the series, but not some others. I sequentially tried the other available solvers on the entire set of series to see if they would identify ARMA models for more of these sets.
>> As I hope you can see in the table below the results were mixed. Some observations:
>> ?	There was no solver that found ARMA coefficients for all sectors (not necessarily a problem);
>> ?	For many sectors, the values estimated for the orders of p and q for AR and MA varied across the solvers; and
>> ?	None of the solvers consistently provided either the lowest BIC or AIC score for the results across all sectors.
>>
>> 					Solver			
>> 									
>> 		nlminb		solnp		gosolnp	nloptr
>> 		AR	MA	AR	MA	AR	MA	AR	MA
>>           Manuf  	4	4	4	4	5	4	4	4
>> 	Other  	NA	NA	NA	NA	0	1	0	1
>> 	Money  NA	NA	NA	NA	NA	NA	NA	NA
>> 	Chems  0	5	0	5	0	5	0	5
>> 	NoDur  	NA	NA	NA	NA	NA	NA	NA	NA
>> 	Shops  	NA	NA	NA	NA	3	4	NA	NA
>> 	Durbl  	0	1	5	5	5	5	5	3
>> 	BusEq  	5	3	5	3	5	3	5	2
>> 	Hlth   	NA	NA	NA	NA	0	5	NA	NA
>> 	Telcm  	5	0	5	5	5	5	5	0
>> 	Utils  	3	4	3	4	0	5	3	4
>> 	Enrgy  	0	1	5	3	4	3	5	3
>> 	Mkt.RF 	5	3	3	2	NA	NA	NA	NA
>>
>>
>> While I understand that the Nyblom test is an indicator of the stability of the results across a series, within the model results for a sector from the available solvers, a higher Nyblom joint statistic qualitatively seems to indicate higher quality test results across a number of tests, including the coefficient t statistics and the Ljung-Box results per sector. As a result, I was thinking I might use the Nyblom joint statistic as an indicator in automating the selection of the desired model from possible alternatives, but do not see how to query out that result for further testing as an indicator, although I can see it as part of the $fit object.
>>
>> Please let me know if there is either such a capability for the ARFIMAfit class that I may have overlooked, or a function I might call to generate the joint Nyblom statistic and critical values using the zoo time series data and the existing autoarfima results on hand.
>>
>> Thanks.
>>
>> -Nick
>>
>>
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.
>>
>
>
>


From hs13322 at my.bristol.ac.uk  Fri Dec  5 04:50:04 2014
From: hs13322 at my.bristol.ac.uk (Marco Sun)
Date: Fri, 5 Dec 2014 11:50:04 +0800
Subject: [R-SIG-Finance] rename a large number of stock codes
In-Reply-To: <CAH+4RFt1V8vKprC4wMOhEmbZYNSfESp=yBea_rXEFA60Utsujw@mail.gmail.com>
References: <ABF60DD4-DAB4-4F05-9EC5-0BC7EBC29912@my.bristol.ac.uk>
	<CAH+4RFt1V8vKprC4wMOhEmbZYNSfESp=yBea_rXEFA60Utsujw@mail.gmail.com>
Message-ID: <B507608A-9BFF-494C-94DB-774AB15BDB3F@my.bristol.ac.uk>

Hey Nick,

Gorgeous! This perfectly answers my question. Thank you very much!

Best,

Marco

On 4 Dec 2014, at 06:36 pm, Nick White <n-e-w at qtradr.net> wrote:

> Hi Marco,
> 
> When calling stocks with numerical tickers (like most Asia ex-Japan markets) in R, you should typically reassign them using `get` when working interactively -- or `assign`.
> 
> In this case, you might want to have something like
> 
> TBEA <- get("600089.SS")
> 
> Now you have a simple text named variable in the environment to work with. ie:
> 
> > head(TBEA)
>            600089.SS.Open 600089.SS.High 600089.SS.Low 600089.SS.Close 600089.SS.Volume 600089.SS.Adjusted
> 2007-01-01          14.19          14.53         13.78           14.03                0               2.54
> 2007-01-02          14.19          14.53         13.78           14.03                0               2.54
> 2007-01-03          14.19          14.53         13.78           14.03                0               2.54
> 2007-01-04          14.22          15.11         14.03           14.58         75563100               2.64
> 2007-01-05          14.59          16.03         14.46           16.03         72978600               2.90
> 2007-01-08          16.05          16.60         15.85           16.16         41251600               2.93
> 
> You can extend this to a large group of tickers using a for loop (though it's not the only way). 
> 
> In the spirit of how you wrote the question, though, you could do something like this:
> 
> # Put your numerical tickers in a variable, `num.code`
> 
> > num.code <- c("600089.SS","600202.SS")
> 
> # Put their text equivalents in a different variable, `text.code`
> 
> > text.code <- c("TBEA","HAC")
> 
> #make a data.frame of the two
> 
> code.frame <- data.frame(num.code,text.code,stringsAsFactors=FALSE)
> 
> > code.frame
>    num.code text.code
> 1 600089.SS      TBEA
> 2 600202.SS       HAC
> 
> # now call your Symbols
> 
> > getSymbols(code.frame$num.code)
> 
> # and now run a simple for loop to `assign` the numerical codes to the text codes
> 
> > for (i in 1:length(code.frame)){
>   
>   assign(code.frame$text.code[i],get(code.frame$num.code[i]),envir=.GlobalEnv)
> }
> 
> 
> # You will now have two variables, TBEA and HAC which are `xts` objects that you can now manipulate how you wish
> 
> > str(TBEA)
> An ?xts? object on 2007-01-01/2014-12-03 containing:
>   Data: num [1:2041, 1:6] 14.2 14.2 14.2 14.2 14.6 ...
>  - attr(*, "dimnames")=List of 2
>   ..$ : NULL
>   ..$ : chr [1:6] "600089.SS.Open" "600089.SS.High" "600089.SS.Low" "600089.SS.Close" ...
>   Indexed by objects of class: [Date] TZ: UTC
>   xts Attributes:  
> List of 2
>  $ src    : chr "yahoo"
>  $ updated: POSIXct[1:1], format: "2014-12-04 21:24:39"
> 
> Hope that helps,
> 
> n.
> 
> 
> 
> 
> 
> 
> On Thu, Dec 4, 2014 at 7:58 PM, Marco Sun <hs13322 at my.bristol.ac.uk> wrote:
> Hi, sorry for the previous emails, I am now opening a new topic to demonstrate my problem clearly.
> 
> 
> 
> I wish to retrieve a bunch of Chinese stock through getSymbols.
> 
> 
> 
> symbols<-c("600089.SS","600202.SS")
> 
> getSymbols(symbols)
> 
> 
> 
> These stock codes are not easily recognised nor being processed in further analysis, i.e. R does not recognise 600089.SS, instead, it recognises `600089.SS`.
> 
> 
> 
> > 600089.SS
> 
> Error: unexpected symbol in "600089.SS"
> 
> 
> 
> > class(`600089.SS`)
> 
> [1] "xts" "zoo"
> 
> `
> 
> Therefore, I wish to replace symbols with some simple tickers called stockcodes. I can easily replace the name of 600089.SS via:
> 
> 
> 
> stockcodes<-c("TBDG","HKT")
> 
> TBDG<-`600089.SS`
> 
> 
> 
> However, it could take a lot while if I have a large portfolio and I do have a well-diversified portfolio under analysis.
> 
> 
> 
> Another approach came up to me was using setSymbolLookup like this:
> 
> 
> 
> > setSymbolLookup(TBDG=list(name="600089.SS"))
> 
> > getSymbols("TBDG")
> 
> [1] "TBDG"
> 
> 
> 
> But I got error when I was trying to use for loop as the following:
> 
> 
> 
> for(i in 1:2)
> 
> {
> 
>  setSymbolLookup(stockcodes[i]=list(name=symbols[i]))
> 
>  getSymbols(stockcodes[i])
> 
> }
> 
> 
> 
> Any comment would be appreciated.
> 
> 
> 
> Cheers,
> 
> 
> 
> Marco
> 
> 
> 
> 
> 
> 
>         [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
> 


	[[alternative HTML version deleted]]


From commons.r at karthik.in  Fri Dec  5 09:17:27 2014
From: commons.r at karthik.in (Karthik Raju)
Date: Fri, 05 Dec 2014 13:47:27 +0530
Subject: [R-SIG-Finance] Preparing data for Superior predictive ability
 (SPA) test
In-Reply-To: <54799E15.1010309@braverock.com>
References: <5478071D.1060304@karthik.in> <5479412D.7090106@karthik.in>
	<54799E15.1010309@braverock.com>
Message-ID: <54816A17.6090003@karthik.in>

Sorry Brian, I misunderstood your last reply.

Intent: Evaluate forecasting accuracy of autoregressive models
Approach: Apply Superior Predictive Ability (SPA) test in the ?ttrTests? 
package to assess the forecasting accuracy
Version: R ver. 3.0.2 (2013-09-25) - "Frisbee Sailing"
Editor: R Studio ver. 0.98.1091
rugarch package: 1.3-4
ttrTests package: 1.7
Code: http://dropbox.unl.edu/uploads/20141219/e61f31203e15e90d/sample.zip

I am lost and looking for some direction on how to use a loss function 
series to evaluate the efficacy of volatility forecasts between models 
fm1 through fm5 using the SPA test in the "ttrTests" package.

My attempt is as follows:

spa <- dataSnoop(MeanSquareError,bSamples=1000,test="SPA")

# The structure of "MeanSquareError" loss function series is as follows:
Day   msefm1      msefm2    ..  msefm5
T+1   0.0000464   0.0000411 ..  0.0000407
T+2   0.0000461   0.0000421 ..  0.0000428
...
T+49  0.0000174   0.0000653 ..  0.0001126
T+50  0.0000174   0.0000657 ..  0.0001138

My code is structured as follows:

# To load the sample data in the "rugarch" package
data(sp500ret)

# To specify the desired autoregressive models
model1 = ugarchspec(variance.model = list(model = "sGARCH",garchOrder = 
c(1, 1)), distribution.model = "std")
model2 = ugarchspec(variance.model = list(model = "gjrGARCH",garchOrder 
= c(1, 1)), distribution.model = "std")
model3 = ugarchspec(variance.model = list(model = "sGARCH",garchOrder = 
c(1, 1)), distribution.model = "std")
model4 = ugarchspec(variance.model = list(model = "csGARCH",garchOrder = 
c(1, 1)), distribution.model = "std")
model5 = ugarchspec(variance.model = list(model = "apARCH",garchOrder = 
c(1, 1)), distribution.model = "std")

# To estimate the autoregressive models specified
m1 = ugarchfit(sp500ret, spec = model1)
m2 = ugarchfit(sp500ret, spec = model2)
m3 = ugarchfit(sp500ret, spec = model3)
m4 = ugarchfit(sp500ret, spec = model4)
m5 = ugarchfit(sp500ret, spec = model5)

# To forecast the volatility for next 50 days with the parameters 
estimated above
fm1 = ugarchforecast(m1,data=NULL,n.ahead=50, n.roll= 0, out.sample = 0)
fm2 = ugarchforecast(m2,data=NULL,n.ahead=50, n.roll= 0, out.sample = 0)
fm3 = ugarchforecast(m3,data=NULL,n.ahead=50, n.roll= 0, out.sample = 0)
fm4 = ugarchforecast(m4,data=NULL,n.ahead=50, n.roll= 0, out.sample = 0)
fm5 = ugarchforecast(m5,data=NULL,n.ahead=50, n.roll= 0, out.sample = 0)

I used the extractor function "sigma" in the "rugarch" package to 
extract the conditional standard deviation of the forecasts fm1 through 
fm5, which is then fed to a spreadsheet to estimate the Mean Square 
Error (MSE) loss function series for the 50 days.

# The MSE loss function series is then imported into R.
MeanSquareError <- read.csv("F:/MeanSquareError.csv")

Now, how do I go about using this ?MeanSquareError? loss function series 
such as this: spa<-dataSnoop(MeanSquareError, bSamples=1000, 
test="SPA")? Please note that I am not looking to convert 
?MeanSquareError.csv?  into R-data, rather I am searching for a way to 
apply the SPA test.

Thank you for your time.

Karthik

Brian G. Peterson wrote on 2014-11-29 03:51 PM +0530:
> I asked you a reproducible example, and instead, you're asking the list
> to do a bunch of work to replicate your code for you.
>
> Please respect the time of the list members, and provide a few lines of
> code, so that we can *run* your example code and then *help you* with
> your problem.
>
> Brian
>
> On 11/28/2014 09:44 PM, Karthik Raju wrote:
>> Hello Brian,
>>
>> Thank you for your response.
>>
>> I will explain my work with an example.
>>
>> - I have logarithmic returns computed from daily closing values of a
>> stock market index for a period of 500 days.
>>
>> - The logarithmic returns are used in the "rugarch" package to fit the
>> following models,
>> Model-1 - GARCH (1,1)
>> Model-2 - GJR-GARCH (1,1)
>> Model-3 - EGARCH (1,1)
>> Model-4 - IGARCH (1,1)
>> Model-5 - APARCH (1,1)
>>
>> - Then, using "rugarch", forecasted one step ahead volatility with each
>> of the above model parameters for an out-of-sample period of 100 days.
>>
>> - The forecasted 100 days "sigma" values of each model is extracted from
>> R to a worksheet and used against true volatility proxy to compute the
>> loss functions.
>>
>> - The structure of loss function data for each model is an univariate
>> series for the forecasted period (100 days).
>>
>> - For example, the structure of Mean Square Error (MSE) loss function
>> looks like,
>>
>> Forecasts    MSE_GARCH   MSE_GJR   . .  MSE_APARCH
>> Day 1        0.008548    0.005509  . .  0.00412
>> Day 2        0.008655    0.005498  . .  0.00414
>> Day 3        0.008759    0.005488  . .  0.004156
>> Day 4        0.008861    0.005478  . .  0.004169
>> .        .        .          . .  .
>> .        .        .          . .  .
>> .        .        .          . .  .
>> Day 99        0.008759    0.005488  . .  0.004156
>> Day 100        0.008861    0.005478  . .  0.004169
>>
>> - Similarly, the loss functions like Mean Absolute Error, Mean Absolute
>> Percentage Error etc. are in the same structure, which are then imported
>> into R.
>>
>> - Now, by using each of this loss function data series,  one at a time,
>> in the "ttrTests" package, I want to know how to compute the SPA test
>> for the following combinations?
>>
>> Benchmark model GARCH (1,1)      Vs rest of 4 models
>> Benchmark model GJR GARCH (1,1)      Vs rest of 4 models
>> Benchmark model EGARCH (1,1)      Vs rest of 4 models
>> Benchmark model IGARCH (1,1)      Vs rest of 4 models
>> Benchmark model APARCH (1,1)      Vs rest of 4 models
>>
>> Best,
>> Karthik
>>
>>> Please follow the posting guide
>>>
>>> http://www.r-project.org/posting-guide.html
>>>
>>> and provide a reproducible example.  For instance, you could repeat your
>>> 'n' samples using some of the test data from rugarch.
>>>
>>> It is very difficult for others to help you if we don't know the format
>>> your data is in *now*.
>>>
>>> Regards,
>>>
>>> Brian
>>>> On 11/27/2014 11:24 PM, Karthik Raju wrote:
>>>>
>>>> Hello,
>>>>
>>>> Can anyone please let me know how to prepare data to compute Superior
>>>> predictive ability (SPA) test in R?
>>>>
>>>> I am working on forecasting volatility in stock markets, the context is,
>>>>
>>>> 1) I used "rugarch" package to forecast the volatility using "n"
>>>> autoregressive models.
>>>>
>>>> 3) Extracted "sigma" values from the forecasts of those "n" models and
>>>> used it in a worksheet against realized volatility to calculate daily
>>>> loss functions for each model, say, MSE, MAE, RMSE etc.
>>>>
>>>> 3) I want to compute the SPA test statistics using "ttrTests" package
>>>> and find the SPA test p-values for a benchmark model against "n"
>>>> alternatives. How to prepare data for this purpose?
>>>>
>>>> Thanks,
>>>> Karthik
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.


From josh.m.ulrich at gmail.com  Mon Dec  8 00:00:52 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sun, 7 Dec 2014 17:00:52 -0600
Subject: [R-SIG-Finance] Reply to: How can I get Japanese Stock Daily
 Data in R?
In-Reply-To: <CACySJQU1TsuSCHhKstc1u0DZKPachaLRh=qQ3pjxYjEtyktXfQ@mail.gmail.com>
References: <CACySJQU1TsuSCHhKstc1u0DZKPachaLRh=qQ3pjxYjEtyktXfQ@mail.gmail.com>
Message-ID: <CAPPM_gQ5+Tqm20ZWBZhBhKdgO21+Bg+EUTTeRS+GTDcuk3CBZQ@mail.gmail.com>

On Sun, Oct 19, 2014 at 6:30 AM, Wouter Thielen <wouter at morannon.org> wrote:
> Sorry for not being able to reply directly to the related thread, because I
> was getting mails in daily batches. I have updated my settings for this.
>
> I did make an R script to be included in the quantmod package, but I
> haven't received any feedback from the community. The script can be found
> here: https://github.com/wthielen/YJStocks/blob/master/getSymbols.yahooj.R
>
> To be able to use it in this shape, you need to do the following:
> - Include the quantmod library first: library(quantmod)
> - Load getSymbols.R file from the quantmod source, for some internal
> dependencies
> - Pass any "missing" arguments that would be coming from the main
> getSymbols() call: verbose and auto.assign
>
> An example routine would be:
>
> library(quantmod)
> source("/path/to/quantmodpackage/pkg/R/getSymbols.R")
> source("/path/to/getSymbols.yahooj.R")
> getSymbols.yahooj("3048.T", verbose=TRUE, auto.assign=TRUE)
>
> And then you will see it downloading daily stock data for Biccamera, and
> assigning it to the "YJ3048.T" xts object.
>
> I hope it will be included into the getSymbols.R file from the quantmod
> package, so that it becomes a standard function.
>
I think this is something that can be directly included in quantmod.
But for that to happen, you also need a corresponding .Rd file.  It
would be very helpful if you could also provide that file, and even
more helpful if you ensure that quantmod still passes R CMD check
after your incorporate your changes.

> Hope this helps!
>
> --
> Wouter Thielen
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From thorstlasse at gmail.com  Tue Dec  9 08:15:21 2014
From: thorstlasse at gmail.com (Lasse Thorst)
Date: Tue, 9 Dec 2014 08:15:21 +0100
Subject: [R-SIG-Finance] Violation of underlying assumptions - ARMA-GARCH
Message-ID: <CADMJJm-zU_0y07xLOqV9SeOnfevzs87jdt-UhumM1MP_198+rQ@mail.gmail.com>

I am estimating an ARMA-GARCH model using QMLE
(Quasi-Maxiumum-likelihood-estimation). However, I have some trouble - when
I do test to see if the residuals are uncorrelated - a Weighted Ljung-Box
test - this is rejected. So, it looks like my residuals have serial
correlation.

I am unsure if this is violation of the underlying assumptions - and what
effects it would have on my results.

For example, what effect does this have on my estimates? And the strong
consistency of the estimates? And asymptotic normality of the QMLE?

I am using GARCH-models by Francq & Zakoian - I think it might be in here,
but I am having some trouble understanding it.

Regards,

Note: I've posted this on stats.exchange as well, but haven't had any luck
yet.

	[[alternative HTML version deleted]]


From luca.trapin at gmail.com  Tue Dec  9 15:44:15 2014
From: luca.trapin at gmail.com (Luca Trapin)
Date: Tue, 9 Dec 2014 15:44:15 +0100
Subject: [R-SIG-Finance] Rugarch external regressor estimation
Message-ID: <CA+jBJn6tCHvGB4saJC21Y9=Z-N98EvjR7a-5u1G88-hX1jBUXA@mail.gmail.com>

Hi,

I'd like to use "rugarch" package to fit GARCH models with external
regressors. I decided to run a simulation prior to analyze the empirical
data, in order to understand how to set the garch specification correctly.

I generate random samples with "ugarchpath" and then plot the estimates of
the parameters obtained with "ugarchfit". I use EGARCH with a dummy
variable to avoid prolems with the parameter constraints in the
maximization procedure.

Although the estimator for the GARCH parameters is consistent, it seems to
be not consistent when adding the external regressor.

I used the following code:

d <- as.matrix(c(rep(0,2000),rep(1,2000)))
par <- matrix(0,100,5)
for (i in 1:100){
  specsim <- ugarchspec(variance.model=list(model="eGARCH",
garchOrder=c(1,1),
                                            external.regressors=d),
                     mean.model=list(armaOrder=c(0,0), include.mean=FALSE),
                     fixed.pars=list(omega=-0.15, alpha1=-0.05, beta1=0.95,
                                     gamma1=0.1,vxreg1=0.1))
  sim <- ugarchpath(specsim, n.sim=4000)
  r <- fitted(sim)
  specfit <-
ugarchspec(variance.model=list(model="eGARCH",garchOrder=c(1,1),
                                            external.regressors=d),
                     mean.model=list(armaOrder=c(0,0),include.mean=F))
  fit <- ugarchfit(specfit,r)
  par[i,] <- as.matrix(coef(fit))
}

Am I missing something?

Best Regards,
Luca

	[[alternative HTML version deleted]]


From ivan.popivanov at gmail.com  Tue Dec  9 20:30:26 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Tue, 09 Dec 2014 19:30:26 +0000
Subject: [R-SIG-Finance] [rugarch:realGARCH] A good proxy for close to close
	volatility?
Message-ID: <CAK7-yAi23sxfCkf_Xpszau89GwCmfhD0FmDNoMSODPKkK49aVg@mail.gmail.com>

Hello,

I am trying to use the realGARCH model, but whatever I tried passing as
realized volatility gives spikes in sigmas here and there (sometimes more
than 1).

My questions are:

1. Can large sigmas be avoided with this model?
2. If daily (close to close) returns are used as the data for the fit, what
can be used as a reasonable estimate for the realized volatility? Does it
make sense to use some volatility estimate based on OHLC data?

Thanks in advance,
Ivan

	[[alternative HTML version deleted]]


From gmonaie at gmail.com  Wed Dec 10 18:52:34 2014
From: gmonaie at gmail.com (Gei Lin)
Date: Wed, 10 Dec 2014 12:52:34 -0500
Subject: [R-SIG-Finance] Bug in ruleOrderProc - txnfees is not a numeric?
In-Reply-To: <52D55B7E.6030409@braverock.com>
References: <CAK7-yAh8Yh3oHANcvyyp3R1dwbRY-904b8rkF=FG4T3rkVpbHQ@mail.gmail.com>
	<52D54914.4040609@braverock.com>
	<CAK7-yAiZRM=3Ss2_3RrHZ1BA-EJdTSxO+8kYywOaE-JZ3zaTcA@mail.gmail.com>
	<52D55B7E.6030409@braverock.com>
Message-ID: <CAJFvkcfKaH+gkbjQRafBZZeouxdv2EYKtV3FLiQEUP6JNzaocw@mail.gmail.com>

I ran into this same problem and have a proposed patch. As Ivan proposed,
it appears to be related to the splitting transactions to cross position
values over 0. Any strategy with rules that create orders crossing
positions through 0 will fail on its eventual call to addTxn, even if you
define TxnFees = 0 on the ruleSignal (because it is carried around
internally as.character to support txnFUNs)

It looks like the problem lies in blotter::addTxn rather than
quantstrat::ruleOrderProc. If we move the txnfee evaluation before
splitting the transactions we will have a valid numeric rather than a
character in the '/' operation. I made this change in my dev version and it
looks like it works.

addTxn <- function(Portfolio, Symbol, TxnDate, TxnQty, TxnPrice, ...,
TxnFees=0, allowRebates=FALSE, ConMult=NULL, verbose=TRUE, eps=1e-06)

<snip>

    # FUNCTION
    # Coerce the transaction fees to a function if a string was supplied

    if(is.character(TxnFees)) {
        TF <- try(match.fun(TxnFees), silent=TRUE)
        if (!inherits(TF,"try-error")) TxnFees<-TF
    }
    # Compute transaction fees if a function was supplied
    if (is.function(TxnFees)) {
      txnfees <- TxnFees(TxnQty, TxnPrice, Symbol)
    } else {
      txnfees<- as.numeric(TxnFees)
    }

    if(is.null(txnfees) | is.na(txnfees)) txnfees = 0
    if(txnfees>0 && !isTRUE(allowRebates)) stop('Positive Transaction
Fees should only be used in the case of broker/exchange rebates for
TxnFees ',TxnFees,'. See Documentation.')

addTxn has a block of code that evaluates the transaction fees if a
function was passed in, or casts it as as.numeric. Quantstrat will pass in
argument TxnFees as an xts of characters. Before TxnFees can be evaluated,
an attempt to split the transaction into two pieces is made.

   # split transactions that would cross through zero
    if(PrevPosQty!=0 && sign(PrevPosQty+TxnQty)!=sign(PrevPosQty) &&
PrevPosQty!=-TxnQty){*        txnFeeQty=TxnFees/abs(TxnQty) #
calculate fees pro-rata by quantity*
        addTxn(Portfolio=pname, Symbol=Symbol, TxnDate=TxnDate,
TxnQty=-PrevPosQty, TxnPrice=TxnPrice, ...,
                TxnFees = txnFeeQty*abs(PrevPosQty), ConMult =
ConMult, verbose = verbose, eps=eps)
        TxnDate=TxnDate+2*eps #transactions need unique timestamps, so
increment a bit
        TxnQty=TxnQty+PrevPosQty
        PrevPosQty=0
        TxnFees=txnFeeQty*abs(TxnQty+PrevPosQty)
    }

At this stage TxnFees is still a character. This / operator is what is
creating the error:

Error in `/.default`(TxnFees, abs(TxnQty)) :
  non-numeric argument to binary operator

Switching the order of these two blocks of code and changing

*txnFeeQty=TxnFees/abs(TxnQty)*

To

*txnFeeQty=txnfees/abs(TxnQty)*

should fix it.

2014-01-14 10:45 GMT-05:00 Brian G. Peterson <brian at braverock.com>:

> Ivan,
>
> Thanks for the reproducible example.  We'll investigate.
>
> Brian
>
> On 01/14/2014 09:28 AM, Ivan Popivanov wrote:
>
>> Hi Brian,
>>
>> return(as.numeric(res)) - same thing, I tried it before posting here.
>> There is no problem if I use return(100*sign(orderqty)), which indicates
>> the path dependency I was trying to imply. The problem doesn't seem to
>> occur for long only positions - it gotta be switching. I believe, the
>> problem is outside os.all.equity. Notice, it has a lot of debug output
>> and it clearly indicates that the function returns, and returns a
>> numeric before the problem is hit. For me it's easy to repro it
>> (although it takes longer) with the attached script (it needs some
>> adjustments). The problem is hit for 2001-04-08. I don't touch txnFees
>> anywhere in my code, so I have no control over this behaviour - it needs
>> to be type casted somewhere - from what you are saying - taking the type
>> into account.
>>
>> Thanks for the comments about the testing.
>>
>> Can you point me to code which computes the portfolio size as you
>> suggested?
>>
>>  From my experience, it's often needed to be able to show the strategy
>> performance over years, with all the system on. That's an area quanstrat
>> lacks - both in terms of examples and testing (I am pretty sure this is
>> a regression since the last time I looked at it).
>>
>> Thanks,
>> Ivan
>>
>>
>>
>>
>> On Tue, Jan 14, 2014 at 9:26 AM, Brian G. Peterson <brian at braverock.com
>> <mailto:brian at braverock.com>> wrote:
>>
>>     You don't actually include how you're calculating txnfees, and your
>>     example is not reproducible, so I'm forced to guess.
>>
>>     try
>>
>>       return(as.numeric(res))
>>
>>     in your function.
>>
>>     As noted in the documentation, txnFees can be a string name of a
>>     function, so forcing it to as.numeric is a really bad idea.
>>
>>     I'll also note that you don't need to call updatePortf every time.
>>     That's extremely expensive by comparison to just adding up the
>>     realized P&L (from closed transaction) and Unrealized P&L (from your
>>     open position) yourself.  You should also be aware that this
>>     approach (or yours) will only capture equity changes in a single
>>     instrument (since instruments are processed one at a time).
>>
>>     Most literature on evaluating trading strategies (see e.g. Aronson
>>     or Tomasini and Jaekle) tends to do system design on fixed trade
>>     sizes because it is much easier to evaluate whether or not your
>>     system really has any edge, or is just participating in market
>>     drift.  I tend to separate the order sizing decisions till very late
>>     in the strategy development process.
>>
>>     Regards,
>>
>>     Brian
>>
>>
>>     On 01/13/2014 07:15 PM, Ivan Popivanov wrote:
>>
>>         It only happens when I use a custom function to compute the
>>         position size,
>>         but it won't happen with a constant size. So it may have
>>         something to do
>>         with the splitting of orders. My function uses all available
>> equity
>>         rounding up - it's at the end. I get the following error:
>>
>>         Error in `/.default`(TxnFees, abs(TxnQty)) :
>>             non-numeric argument to binary operator
>>
>>         It seems that the fault is in ruleOrderProc, the caller of addTxn,
>>         whereabouts txnfees is indeed an xts object. To me the fix is to
>>         pass
>>         as.numeric(txnfees) to addTxn.
>>
>>         Regards,
>>         Ivan
>>
>>         PS: Is my osAllEquity a good way to implement the compounding
>>         growth or is
>>         there a better alternative? I think it's worth having an example
>> to
>>         illustrate this functionality.
>>
>>         osAllEquity = function(
>>                 timestamp,
>>                 orderqty,
>>         portfolio.name <http://portfolio.name>,
>>                 symbol,
>>                 ...)
>>         {
>>              verbose = TRUE
>>              # verbose = FALSE
>>
>>              if(verbose) cat("\n=====")
>>              if(verbose) cat(paste( "\n", timestamp, sep=""))
>>
>>              if(verbose) cat(paste( "\n   orderqty=", orderqty, sep=""))
>>              portfolio = updatePortf(Portfolio=portfoli__o.name
>>         <http://portfolio.name>, Dates=paste('::',
>>         as.Date(timestamp), sep=''))
>>              # end.eq = getEndEq(portfolio.name <http://portfolio.name>,
>>         as.Date(timestamp))
>>              # print( end.eq )
>>              pnl = sum(getPortfolio(portfolio.__name
>>         <http://portfolio.name>)$summary$Net.Trading.PL
>>         <http://Net.Trading.PL>)
>>              end.eq = initEq + pnl
>>              if(verbose) cat(paste( "\n   pnl=", pnl, sep=""))
>>              if(verbose) cat(paste( "\n   equity=", end.eq, sep=""))
>>              close.price = as.numeric(Cl(mktdata[__timestamp,]))
>>              if(verbose) cat(paste("\n   close price=", close.price,
>>         sep=""))
>>              res = as.numeric( ceiling( end.eq / close.price ) ) * sign(
>>         orderqty )
>>              if(verbose) cat(paste("\n   qty=", res, sep=""))
>>              if(verbose) cat("\n=====\n")
>>              # return(sign(orderqty*1000))
>>              # res = 1000*sign(orderqty)
>>              return(res)
>>         }
>>
>>                  [[alternative HTML version deleted]]
>>
>>         _________________________________________________
>>         R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
>>         mailing list
>>         https://stat.ethz.ch/mailman/__listinfo/r-sig-finance
>>         <https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
>>         -- Subscriber-posting only. If you want to post, subscribe first.
>>         -- Also note that this is not the r-help list where general R
>>         questions should go.
>>
>>
>>     --
>>     Brian G. Peterson
>>     http://braverock.com/brian/
>>     Ph: 773-459-4973 <tel:773-459-4973>
>>     IM: bgpbraverock
>>
>>     _________________________________________________
>>     R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
>>     mailing list
>>     https://stat.ethz.ch/mailman/__listinfo/r-sig-finance
>>     <https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
>>     -- Subscriber-posting only. If you want to post, subscribe first.
>>     -- Also note that this is not the r-help list where general R
>>     questions should go.
>>
>>
>>
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>



-- 

?*Don't quit. Suffer now and live the rest of your life as a champion.*?

                                                -
Muhammad Ali*?*
*?*

?*The world is full of obvious things which nobody by any chance observes.*?

                                                -
Sir Arthur Conan Doyle*?*
*?*

	[[alternative HTML version deleted]]


From treydog999 at gmail.com  Thu Dec 11 08:31:48 2014
From: treydog999 at gmail.com (Derek Wong)
Date: Thu, 11 Dec 2014 15:31:48 +0800
Subject: [R-SIG-Finance] Using a custom Spread to execute onto the 2
 underlying instruments - Quantstrat Help
Message-ID: <CALQudT-LSEQbmgt5+=ZKoK+dNqZPdV6a=U41BO4LnR0p96sqYQ@mail.gmail.com>

Hello

I am having problems with using a spread to generate signals and rules
but then execute individually on the underlying. In my example case, I
am taking the SP500 E-mini future (ES) and the Dow E-mini future (YM)
calculating a custom spread function then using that for signal
generation using rolling std dev and mean for thresholds. There is not
very much documentation or demos on spreads and other synthetics that
are available in the Financial Instrument Package. Example code below.

I run into problems in the backtest runs and it runs the trade rules
for every symbol in the portfolio, symb1 (ES), symb2(YM), and the
custom spread symb1.symb2. I was expecting it to just run on
symb1.symb2 and by using the RuleSignal symbol field and specify
"symb1" and "symb2" for execution it would then execute on the
underlying themselves. Instead quantstrat applystrategy goes through
symb1, symb2, and symb1.symb2 and places trades on everything.

Is it possible to use a custom spread to execute on the underlying, if
so how? Am I mis-specifying or misusing  the RuleSignal symbol
identifier field? because I am specifically stating I want to execute
symb1 long and symb2 short for a given signal or vice versa. I am not
specifying the symb1.symb2 at all for any of the RuleSignal executions
but they do trade.


Thanks

Derek




# attempt to create a pairs trading strategy using a spread from
Financial Instrument package.
# Based on a Notional Spread and Standard Devations from the rolling mean

require(quantstrat)
require(Quandl)
require(quantmod)
#### Data Prep ####

#get data from Quandl
symb1 <- Quandl("CHRIS/CME_ES1", type = "xts",
trim_start="2010-01-01", trim_end="2014-11-17")
symb2 <- Quandl("CHRIS/CME_YM1", type = "xts",
trim_start="2010-01-01", trim_end="2014-11-17")

#Trim and Format  - Using settlement as Close value
symb1 <- symb1[,c(1,2,3,6)]
symb2 <- symb2[,c(1,2,3,6)]

colnames(symb1) <- c("Open", "High", "Low", "Close")
colnames(symb2) <- c("Open", "High", "Low", "Close")

#Clean data so only dates where both trades exist
merge <- cbind(symb1, symb2)
dates <- index(merge[complete.cases(merge),])
symb1<- symb1[dates]
symb2<- symb2[dates]

# -----------------------STRATEGY-------------------
#clean variables for reruns
suppressWarnings(rm("order_book.bbands",pos=.strategy))
suppressWarnings(rm("account.bbands","portfolio.bbands",pos=.blotter))
suppressWarnings(rm("account.st","portfolio.st","stock.str","stratBBands","initDate","initEq",'start_t','end_t'))

#Initial values / parameters
initDate= index(symb1)[1]-1
initEq=100000

SD = 2 # how many standard deviations
N = 20 # length of moving average

#Initialize FinancialInstrument Objects

currency('USD')

future( primary_id = "symb1",
        currency = "USD",
        tick_size = .25,
        multiplier = 50)

future( primary_id = "symb2",
        currency = "USD",
        tick_size = 1,
        multiplier = 5)

#Create Spread Series
calcRatio <- function(x) {
  #returns the ratio of notional close prices for 2 symbols
  x1 <- get(x[1])
  x2 <- get(x[2])
  mult1 <- getInstrument(x[1])$multiplier
  mult2 <- getInstrument(x[2])$multiplier
  rat.Op <- ((mult1 * Op(x1))) / (mult2 * Op(x2))
  rat.Hi <- ((mult1 * Hi(x1))) / (mult2 * Hi(x2))
  rat.Lo <- ((mult1 * Lo(x1))) / (mult2 * Lo(x2))
  rat.Cl <- ((mult1 * Cl(x1))) / (mult2 * Cl(x2))
  ratio <- cbind(rat.Op, rat.Hi, rat.Lo, rat.Cl)
  colnames(ratio) <- c("Open", "High", "Low", "Close")
  return(ratio)
}

Ratio <- calcRatio(c("symb1", "symb2"))

#Initialize Spread (using notional ratio as hedge ratio)
spread(primary_id = "symb1.symb2",
       currency = "USD",
       members = c("symb1", "symb2"),
       memberratio = list(1, as.numeric(-Cl(Ratio))) )

#Notional Ratio is also spread for trading
symb1.symb2 <- Ratio

#name strings
portfolio.st = 'bbands'
account.st = 'bbands'

#initialization of strategy objects ----
initPortf(portfolio.st, #portfolio Initiatlization
          symbols = c("symb1.symb2", "symb1", "symb2"),
          initDate = initDate,
          currency = "USD",
          initPosQty = 0)

initAcct(account.st, #account initialization
         portfolios = portfolio.st,
         initDate = initDate,
         initEq = initEq)

initOrders(portfolio = portfolio.st, #orders initialize
           initDate = initDate)

addPosLimit( portfolio = portfolio.st, # add position limit rules
             symbol = 'symb1.symb2',
             timestamp = initDate,
             maxpos = 1,
             longlevels = 1,
             minpos = -1)

addPosLimit( portfolio = portfolio.st, # add position limit rules
             symbol = 'symb1',
             timestamp = initDate,
             maxpos = 2,
             longlevels = 1,
             minpos = -2)

addPosLimit( portfolio = portfolio.st, # add position limit rules
             symbol = 'symb2',
             timestamp = initDate,
             maxpos = 2,
             longlevels = 1,
             minpos = -2)

stratBBands <- strategy("bbands") # strategy object init

# Indicator
stratBBands <- add.indicator(
  strategy = stratBBands,
  name = "BBands",
  arguments = list(
    HLC = quote(HLC(mktdata)),
    n = N,
    sd = SD,
    maType = "SMA"),
  label = "BBands")

# #Indi Debug
# summary(stratBBands)
# start_t <- Sys.time()
# applyIndicators( strategy = stratBBands, mktdata = Ratio)
# end_t<-Sys.time()
# print("strat execution time:")
# print(end_t-start_t)

# Add signals:
stratBBands <- add.signal(
  strategy = stratBBands,
  name = "sigCrossover",
  arguments = list(
    columns = c("Close","up.BBands"),
    relationship = "gt"),
  label = "Cl.gt.UpperBand")

stratBBands <- add.signal(
  strategy = stratBBands,
  name = "sigCrossover",
  arguments = list(
    columns = c("Close","dn.BBands"),
    relationship = "lt"),
  label = "Cl.lt.LowerBand")

stratBBands <- add.signal(
  strategy = stratBBands,
  name = "sigCrossover",
  arguments = list(
    columns = c("High","Low", "mavg.BBands"),
    relationship = "op"),
  label = "Cross.Mid")

# #Signal Debug
# summary(stratBBands)
# start_t <- Sys.time()
# applySignals(strategy = stratBBands, mktdata =
applyIndicators(strategy = stratBBands, mktdata = Ratio))
# end_t<-Sys.time()
# print("strat execution time:")
# print(end_t-start_t)

# Rules -----

#Entry

stratBBands <- add.rule (
  strategy = stratBBands,
  name = "ruleSignal",
  arguments = list(
    sigcol = "Cl.gt.UpperBand",
    sigval = TRUE,
    orderqty = -1,
    ordertype = "market",
    orderside = "short",
    symbol = "symb1",
    replace = TRUE,
    osFUN = osMaxPos),
  type = "enter",
  label = "ShortSpread_symb1")

stratBBands <- add.rule (
  strategy = stratBBands,
  name = "ruleSignal",
  arguments = list(
    sigcol = "Cl.gt.UpperBand",
    sigval = TRUE,
    orderqty = 1,
    ordertype = "market",
    orderside = "long",
    symbol = "symb2",
    replace = TRUE,
    osFUN = osMaxPos),
  type = "enter",
  label = "ShortSpread_symb2")

stratBBands <- add.rule (
  strategy = stratBBands,
  name = "ruleSignal",
  arguments = list(
    sigcol = "Cl.lt.LowerBand",
    sigval = TRUE,
    orderqty = 1,
    ordertype = "market",
    orderside = "long"
    symbol = "symb1",
    replace = TRUE,
    osFUN = osMaxPos),
  type = "enter",
  label = "LongSpread_symb1")

stratBBands <- add.rule (
  strategy = stratBBands,
  name = "ruleSignal",
  arguments = list(
    sigcol = "Cl.lt.LowerBand",
    sigval = TRUE,
    orderqty = -1,
    ordertype = "market",
    orderside = "short",
    symbol = "symb2",
    replace = TRUE,
    osFUN = osMaxPos),
  type = "enter",
  label = "LongSpread_symb2")

# Exit
stratBBands <- add.rule(
  strategy = stratBBands,
  name = "ruleSignal",
  arguments = list(
    sigcol = "Cross.Mid",
    sigval = TRUE,
    orderqty = "all",
    ordertype = "market",
    TxnFees = 0,
    replace = TRUE),
  type = "exit",
  label = "Exit")


summary(stratBBands)

# Strategy Execution ----
start_t<-Sys.time()
out<-try(applyStrategy(strategy=stratBBands ,
                       portfolios="bbands"))
end_t<-Sys.time()
print("strat execution time:")
print(end_t-start_t)

# update portfolio
start_t<-Sys.time()
updatePortf(Portfolio='bbands',Dates=paste('::',as.Date(Sys.time()),sep=''))
end_t<-Sys.time()
print("updatePortf execution time:")
print(end_t-start_t)

#Chart
chart.Posn(Portfolio='bbands',Symbol="symb1")
plot(add_BBands(on=1,sd=SD,n=N))
chart.Posn(Portfolio='bbands',Symbol="symb2")
plot(add_BBands(on=1,sd=SD,n=N))
chart.Posn(Portfolio='bbands',Symbol="symb1.symb2")
plot(add_BBands(on=1,sd=SD,n=N))

#Stats
book <- getOrderBook("bbands")
stats <- tradeStats("bbands")
rets <- PortfReturns("bbands")
port <- getPortfolio("bbands")


From optionsraghu at gmail.com  Fri Dec 12 13:05:11 2014
From: optionsraghu at gmail.com (Raghuraman Ramachandran)
Date: Fri, 12 Dec 2014 12:05:11 +0000
Subject: [R-SIG-Finance] Interactive Brokers - Adjustable trailing stop
	using API?
Message-ID: <CADgEnDmLEE5Q3pHVErUgpEkg+PSwQjtd_H2UGCyCMBn0u9Korw@mail.gmail.com>

Dear R -finance Gurus

Has anyone been able to mimic the interactive brokers adjustable stop
loss order type in TWS in an API setting please?

Basically, it is a conditional trailing stop order where as an example:

If I go long at 100, i have an initial stop (market or limit) at say
95 but if market rises to 105 I like the stop to trail by say $2 (so
the new stop becomes 103 etc) and so on. I also thought in the lines
of leaving an OCA order where the first order is a simple stop limit
at 95 but not able to proceed in the second order in the IB setting.
Can someone help please?

Many thx
Raghu


From robsch at robsch.eu  Mon Dec 15 15:31:38 2014
From: robsch at robsch.eu (Robert Schien)
Date: Mon, 15 Dec 2014 15:31:38 +0100
Subject: [R-SIG-Finance] selecting specific rows from an xts object
Message-ID: <20141215143138.GA15975@robsch.eu>


Hello,

I have a questions concerning the xts package.

How can I select rows for specific times from a xts series?
I know tthat one select a range with the help of "T", for example
x["T09:30:00/T09:40:00"]

But how can I select only the rows an 09:30:00 ?
x["T09:30:00/T09:30:00"] does not work. This delivers the
whole time series.
x["T09:30:00"] does not work, too. It delivers no rows at all.

So, how can I do, what I want?
I didn't find anything in the xts documentation.

Thank you in advance.

Greetings
Robert


From wotuzu17 at gmail.com  Mon Dec 15 15:56:14 2014
From: wotuzu17 at gmail.com (Andreas Voellenklee)
Date: Mon, 15 Dec 2014 15:56:14 +0100
Subject: [R-SIG-Finance] selecting specific rows from an xts object
In-Reply-To: <20141215143138.GA15975@robsch.eu>
References: <20141215143138.GA15975@robsch.eu>
Message-ID: <CAKC0Bhma5fFx0yi5KNn9ZOnCWqbF8OmL7e7-2FaXSK3EABV4cg@mail.gmail.com>

Hello Robert,

look at the help page ?indexClass

This should work:

x[.indexhour(x) == 9 & .indexmin(x) == 30 & .indexsec(x)==0]

regards,

Andreas

2014-12-15 15:31 GMT+01:00 Robert Schien <robsch at robsch.eu>:
>
>
> Hello,
>
> I have a questions concerning the xts package.
>
> How can I select rows for specific times from a xts series?
> I know tthat one select a range with the help of "T", for example
> x["T09:30:00/T09:40:00"]
>
> But how can I select only the rows an 09:30:00 ?
> x["T09:30:00/T09:30:00"] does not work. This delivers the
> whole time series.
> x["T09:30:00"] does not work, too. It delivers no rows at all.
>
> So, how can I do, what I want?
> I didn't find anything in the xts documentation.
>
> Thank you in advance.
>
> Greetings
> Robert
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From David.Reiner at xrtrading.com  Mon Dec 15 16:33:10 2014
From: David.Reiner at xrtrading.com (David Reiner)
Date: Mon, 15 Dec 2014 09:33:10 -0600
Subject: [R-SIG-Finance] selecting specific rows from an xts object
In-Reply-To: <20141215143138.GA15975@robsch.eu>
References: <20141215143138.GA15975@robsch.eu>
Message-ID: <9DE405308A6AA24AA794B76282C6C00F52336C566F@HQ-POST1>

If you include the date, or use fractional seconds to create an interval, it should work.
xts uses half open/half closed intervals so ["T09:30:00/T09:30:00"] is empty.

> (nobj <- xts(1:5, as.POSIXct('2014-12-15 09:30')+(-2):2))
                    [,1]
2014-12-15 09:29:58    1
2014-12-15 09:29:59    2
2014-12-15 09:30:00    3
2014-12-15 09:30:01    4
2014-12-15 09:30:02    5
> nobj["2014-12-15 09:30:00"]
                    [,1]
2014-12-15 09:30:00    3
> nobj["T09:29:59.5/T09:30:00.5"]
                    [,1]
2014-12-15 09:30:00    3
HTH,
-- David


-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf Of Robert Schien
Sent: Monday, December 15, 2014 8:32 AM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] selecting specific rows from an xts object


Hello,

I have a questions concerning the xts package.

How can I select rows for specific times from a xts series?
I know tthat one select a range with the help of "T", for example
x["T09:30:00/T09:40:00"]

But how can I select only the rows an 09:30:00 ?
x["T09:30:00/T09:30:00"] does not work. This delivers the
whole time series.
x["T09:30:00"] does not work, too. It delivers no rows at all.

So, how can I do, what I want?
I didn't find anything in the xts documentation.

Thank you in advance.

Greetings
Robert

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


This e-mail and any materials attached hereto, including, without limitation, all content hereof and thereof (collectively, "XR Content") are confidential and proprietary to XR Trading, LLC ("XR") and/or its affiliates, and are protected by intellectual property laws.  Without the prior written consent of XR, the XR Content may not (i) be disclosed to any third party or (ii) be reproduced or otherwise used by anyone other than current employees of XR or its affiliates, on behalf of XR or its affiliates.

THE XR CONTENT IS PROVIDED AS IS, WITHOUT REPRESENTATIONS OR WARRANTIES OF ANY KIND.  TO THE MAXIMUM EXTENT PERMISSIBLE UNDER APPLICABLE LAW, XR HEREBY DISCLAIMS ANY AND ALL WARRANTIES, EXPRESS AND IMPLIED, RELATING TO THE XR CONTENT, AND NEITHER XR NOR ANY OF ITS AFFILIATES SHALL IN ANY EVENT BE LIABLE FOR ANY DAMAGES OF ANY NATURE WHATSOEVER, INCLUDING, BUT NOT LIMITED TO, DIRECT, INDIRECT, CONSEQUENTIAL, SPECIAL AND PUNITIVE DAMAGES, LOSS OF PROFITS AND TRADING LOSSES, RESULTING FROM ANY PERSON'S USE OR RELIANCE UPON, OR INABILITY TO USE, ANY XR CONTENT, EVEN IF XR IS ADVISED OF THE POSSIBILITY OF SUCH DAMAGES OR IF SUCH DAMAGES WERE FORESEEABLE.


From ilya.kipnis at gmail.com  Sat Dec 20 03:15:11 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 19 Dec 2014 21:15:11 -0500
Subject: [R-SIG-Finance] Help replicating a paper
Message-ID: <CA+oJuEGkr74rj2qncvkdxu9hBzf8Gy5UgCvhPJHQiEOF3qLTTw@mail.gmail.com>

I'm not sure this question gets posed often on this list, but here goes...

I'm trying to emulate the results from SSRN id2450017 aka Momentum,
Markowitz, and Smart Beta by W.J. Keller. My issue is that for a weighting
algorithm, it often only invests in one assets, no assets, or very few
assets. Furthermore, while using the 9 sector spiders, my results are
pretty terrible, and certainly nothing worthy of publishing in a paper, so
I know there's a mistake on my end somewhere, but I'm not quite sure where.

Here's the link to the paper:

http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2450017

And my implementation of the MAA algorithm (special case at the moment,
will generalize later). I'm hoping my comments will help make the code
easier to follow.

*****************************

require(quantmod)
require(PerformanceAnalytics)

#Use 9 sector spiders
suffix <- c("Y", "P", "E", "F", "V", "I", "B", "K", "U")
symbols <- paste0("XL", suffix)
getSymbols(symbols, from="1990-01-01")
prices <- list()
for(i in 1:length(symbols)) {
  prices[[i]] <- Ad(get(symbols[i]))
}
prices <- do.call(cbind, prices)

rets <- Return.calculate(prices)
rets <- rets[-1,] #remove first row of NAs

weights <- list()
dates <- list()
monthlyEndpoints <- endpoints(rets, on = "months")
for(i in 2:(length(monthlyEndpoints) - 4)) {

  #subset returns and define mktRets as average daily returns
  returnsData <- rets[monthlyEndpoints[i]:monthlyEndpoints[i+4],]
  mktRets <- xts(rowMeans(returnsData), order.by=index(returnsData))

  #raw computed values -- annualized variance, cumulative returns
  #correlation to average daily returns, and annualized variance of
  #average daily returns
  variances <- as.numeric(StdDev.annualized(returnsData)^2)
  cumRets <- as.numeric(Return.cumulative(returnsData))
  cors <- as.numeric(cor(returnsData, mktRets))
  mktVar <- as.numeric(StdDev.annualized(mktRets) ^ 2)

  #shrink asset variances to the average by 50%
  #shrink cumulative returns to the average by 50%
  #shrink correlations to the average by 50%
  #shrink market variance to zero by 50%
  #see Keller (June 2014 Table 1 pg. 8)
  shrunkVariances <- (variances + mean(variances)) / 2
  shrunkCumRets <- (cumRets + mean(cumRets)) / 2
  shrunkCors <- (cors+mean(cors))/2
  shrunkMktVar <- mktVar/2

  #values computed from shrunken values
  #define beta as shrunken variances * shrunken correlations / shrunken
market variance
  #define idiosyncratic variances as shrunken variances minus shrunken
market variance * beta
  #see Keller (June 2014 under A.4)
  betas <- shrunkVariances*shrunkCors/shrunkMktVar
  idiosyncraticVars <- shrunkVariances-shrunkMktVar*betas

  #compute asset treynors
  assetTreynors <- shrunkCumRets/betas

  #set initial threshold to zero
  longs <- assetTreynors > 0

  converge <- FALSE
  while(!converge) {
    old <- longs

    #implement equation A.6 from Keller (June 2014)
    newTreynorThreshNum <- shrunkMktVar * sum(old * shrunkCumRets * betas /
idiosyncraticVars)
    newTreynorThreshDenom <- 1 + shrunkMktVar * sum(old * betas * betas /
idiosyncraticVars)
    newTreynorThresh <- newTreynorThreshNum/newTreynorThreshDenom

    #assets remaining are those that have a higher initial treynor ratio
    longs <- assetTreynors > newTreynorThresh

    #if our assets are the same as they were before the computation of the
new threshold, end
    if(sum(old - longs)==0) {
      converge <- TRUE
    }
  }

  #after convergence, allocate weights according to w_i~(1-t/t_i)*r_i/s_i
and normalize
  longs <-
longs*(1-newTreynorThresh/assetTreynors)*shrunkCumRets/idiosyncraticVars
  longs <- longs/sum(longs)

  weights[[i]] <-longs
  dates[[i]] <- as.character(index(returnsData)[nrow(returnsData)])
}

#set up weights xts
weights <- do.call(rbind, weights)
dates <- do.call(rbind, dates)
weights <- xts(weights, order.by=as.Date(dates))
weights[is.na(weights)] <- 0
colnames(weights) <- colnames(rets)

#for dates without investment, invest in risk-free
rets$riskFree <- 0
weights$riskFree <- rep(1, nrow(weights))-rowSums(weights)

#results are pretty terrible
test <- Return.rebalancing(R = rets, weights = weights)
charts.PerformanceSummary(test)
plot(log(cumprod(1+test)))
Return.annualized(test) #less than 5%
maxDrawdown(test) #greater than 30%

#Often invests in one security
head(round(weights, 3), 20)

*******************************
Thank you for any help ahead of time.

-Ilya

	[[alternative HTML version deleted]]


From ivan.popivanov at gmail.com  Sat Dec 20 06:05:25 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Sat, 20 Dec 2014 05:05:25 +0000
Subject: [R-SIG-Finance] Prototyped support for "partial" and parallelism to
	rollapply.xts
Message-ID: <CAK7-yAjQ1Hmxpqwp9ONvwcbC3bdYraRRTvmyiyX3vV7EvCXXoA@mail.gmail.com>

I needed these two features, and thought they might be useful in general,
so I spent some extra time implementing them on top xts, see the
attachments. Not sure whether I managed to cover all cases, but it should
be a solid start if you decide adding them to the package.

Note: Only the Unix form of parallelism (mclapply from parallel) is
supported, but that's mainly for expedience. Adding support for parSapply
is feasible, but it usually leads to more cumbersome interfaces.

Regards,
Ivan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141220/ab879a5d/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rollapply.xts.R
Type: text/x-r-source
Size: 6536 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141220/ab879a5d/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rollapply.xts.R.orig
Type: application/octet-stream
Size: 6539 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20141220/ab879a5d/attachment.obj>

From josh.m.ulrich at gmail.com  Sun Dec 21 22:21:46 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sun, 21 Dec 2014 15:21:46 -0600
Subject: [R-SIG-Finance] Prototyped support for "partial" and
 parallelism to rollapply.xts
In-Reply-To: <CAK7-yAjQ1Hmxpqwp9ONvwcbC3bdYraRRTvmyiyX3vV7EvCXXoA@mail.gmail.com>
References: <CAK7-yAjQ1Hmxpqwp9ONvwcbC3bdYraRRTvmyiyX3vV7EvCXXoA@mail.gmail.com>
Message-ID: <CAPPM_gQPDnTKs6ona6pgu+bf-LQUynhYKJfhYNZA8anmG_fMaA@mail.gmail.com>

Hi Ivan,

Thanks for the contributions!  Did you happen to test the partial=TRUE
output versus rollapply.zoo?  Also, can you share your use case for
running rollapply in parallel?

Best,
Josh

On Fri, Dec 19, 2014 at 11:05 PM, Ivan Popivanov
<ivan.popivanov at gmail.com> wrote:
> I needed these two features, and thought they might be useful in general, so
> I spent some extra time implementing them on top xts, see the attachments.
> Not sure whether I managed to cover all cases, but it should be a solid
> start if you decide adding them to the package.
>
> Note: Only the Unix form of parallelism (mclapply from parallel) is
> supported, but that's mainly for expedience. Adding support for parSapply is
> feasible, but it usually leads to more cumbersome interfaces.
>
> Regards,
> Ivan
>

-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From josh.m.ulrich at gmail.com  Sun Dec 21 22:55:00 2014
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sun, 21 Dec 2014 15:55:00 -0600
Subject: [R-SIG-Finance] Using a custom Spread to execute onto the 2
 underlying instruments - Quantstrat Help
In-Reply-To: <CALQudT-LSEQbmgt5+=ZKoK+dNqZPdV6a=U41BO4LnR0p96sqYQ@mail.gmail.com>
References: <CALQudT-LSEQbmgt5+=ZKoK+dNqZPdV6a=U41BO4LnR0p96sqYQ@mail.gmail.com>
Message-ID: <CAPPM_gSMBM3UzaseqFbQvO3asPZ0AjA5B4uH3cv51xHHr6-g6w@mail.gmail.com>

On Thu, Dec 11, 2014 at 1:31 AM, Derek Wong <treydog999 at gmail.com> wrote:
> Hello
>
> I am having problems with using a spread to generate signals and rules
> but then execute individually on the underlying. In my example case, I
> am taking the SP500 E-mini future (ES) and the Dow E-mini future (YM)
> calculating a custom spread function then using that for signal
> generation using rolling std dev and mean for thresholds. There is not
> very much documentation or demos on spreads and other synthetics that
> are available in the Financial Instrument Package. Example code below.
>
> I run into problems in the backtest runs and it runs the trade rules
> for every symbol in the portfolio, symb1 (ES), symb2(YM), and the
> custom spread symb1.symb2. I was expecting it to just run on
> symb1.symb2 and by using the RuleSignal symbol field and specify
> "symb1" and "symb2" for execution it would then execute on the
> underlying themselves. Instead quantstrat applystrategy goes through
> symb1, symb2, and symb1.symb2 and places trades on everything.
>
?applyStrategy says that it will apply the strategy to every symbol in
the portfolio, so I'm not sure why you expected it to only run on one
symbol in the portfolio.

> Is it possible to use a custom spread to execute on the underlying, if
> so how? Am I mis-specifying or misusing  the RuleSignal symbol
> identifier field? because I am specifically stating I want to execute
> symb1 long and symb2 short for a given signal or vice versa. I am not
> specifying the symb1.symb2 at all for any of the RuleSignal executions
> but they do trade.
>
One thing you could try:
Remove the synthetic spread from your portfolio object, and just use
the synthetic spread data to manually create signals for each of the
underlyings.  Then call applyRules for each underlying and pass your
signals via the signals argument to applyRules.

Or, perhaps better still, you could keep only the synthetic spread in
your portfolio, since your rules create orders on the underlyings.
Then you might be able to leave the rest of your data unchanged.

Note that both suggestions are just off the top of my head, since I
don't have a Quandl token.  Let me know if either of those suggestions
help.

>
> Thanks
>
> Derek
>
>
>
>
> # attempt to create a pairs trading strategy using a spread from
> Financial Instrument package.
> # Based on a Notional Spread and Standard Devations from the rolling mean
>
> require(quantstrat)
> require(Quandl)
> require(quantmod)
> #### Data Prep ####
>
> #get data from Quandl
> symb1 <- Quandl("CHRIS/CME_ES1", type = "xts",
> trim_start="2010-01-01", trim_end="2014-11-17")
> symb2 <- Quandl("CHRIS/CME_YM1", type = "xts",
> trim_start="2010-01-01", trim_end="2014-11-17")
>
> #Trim and Format  - Using settlement as Close value
> symb1 <- symb1[,c(1,2,3,6)]
> symb2 <- symb2[,c(1,2,3,6)]
>
> colnames(symb1) <- c("Open", "High", "Low", "Close")
> colnames(symb2) <- c("Open", "High", "Low", "Close")
>
> #Clean data so only dates where both trades exist
> merge <- cbind(symb1, symb2)
> dates <- index(merge[complete.cases(merge),])
> symb1<- symb1[dates]
> symb2<- symb2[dates]
>
> # -----------------------STRATEGY-------------------
> #clean variables for reruns
> suppressWarnings(rm("order_book.bbands",pos=.strategy))
> suppressWarnings(rm("account.bbands","portfolio.bbands",pos=.blotter))
> suppressWarnings(rm("account.st","portfolio.st","stock.str","stratBBands","initDate","initEq",'start_t','end_t'))
>
> #Initial values / parameters
> initDate= index(symb1)[1]-1
> initEq=100000
>
> SD = 2 # how many standard deviations
> N = 20 # length of moving average
>
> #Initialize FinancialInstrument Objects
>
> currency('USD')
>
> future( primary_id = "symb1",
>         currency = "USD",
>         tick_size = .25,
>         multiplier = 50)
>
> future( primary_id = "symb2",
>         currency = "USD",
>         tick_size = 1,
>         multiplier = 5)
>
> #Create Spread Series
> calcRatio <- function(x) {
>   #returns the ratio of notional close prices for 2 symbols
>   x1 <- get(x[1])
>   x2 <- get(x[2])
>   mult1 <- getInstrument(x[1])$multiplier
>   mult2 <- getInstrument(x[2])$multiplier
>   rat.Op <- ((mult1 * Op(x1))) / (mult2 * Op(x2))
>   rat.Hi <- ((mult1 * Hi(x1))) / (mult2 * Hi(x2))
>   rat.Lo <- ((mult1 * Lo(x1))) / (mult2 * Lo(x2))
>   rat.Cl <- ((mult1 * Cl(x1))) / (mult2 * Cl(x2))
>   ratio <- cbind(rat.Op, rat.Hi, rat.Lo, rat.Cl)
>   colnames(ratio) <- c("Open", "High", "Low", "Close")
>   return(ratio)
> }
>
> Ratio <- calcRatio(c("symb1", "symb2"))
>
> #Initialize Spread (using notional ratio as hedge ratio)
> spread(primary_id = "symb1.symb2",
>        currency = "USD",
>        members = c("symb1", "symb2"),
>        memberratio = list(1, as.numeric(-Cl(Ratio))) )
>
> #Notional Ratio is also spread for trading
> symb1.symb2 <- Ratio
>
> #name strings
> portfolio.st = 'bbands'
> account.st = 'bbands'
>
> #initialization of strategy objects ----
> initPortf(portfolio.st, #portfolio Initiatlization
>           symbols = c("symb1.symb2", "symb1", "symb2"),
>           initDate = initDate,
>           currency = "USD",
>           initPosQty = 0)
>
> initAcct(account.st, #account initialization
>          portfolios = portfolio.st,
>          initDate = initDate,
>          initEq = initEq)
>
> initOrders(portfolio = portfolio.st, #orders initialize
>            initDate = initDate)
>
> addPosLimit( portfolio = portfolio.st, # add position limit rules
>              symbol = 'symb1.symb2',
>              timestamp = initDate,
>              maxpos = 1,
>              longlevels = 1,
>              minpos = -1)
>
> addPosLimit( portfolio = portfolio.st, # add position limit rules
>              symbol = 'symb1',
>              timestamp = initDate,
>              maxpos = 2,
>              longlevels = 1,
>              minpos = -2)
>
> addPosLimit( portfolio = portfolio.st, # add position limit rules
>              symbol = 'symb2',
>              timestamp = initDate,
>              maxpos = 2,
>              longlevels = 1,
>              minpos = -2)
>
> stratBBands <- strategy("bbands") # strategy object init
>
> # Indicator
> stratBBands <- add.indicator(
>   strategy = stratBBands,
>   name = "BBands",
>   arguments = list(
>     HLC = quote(HLC(mktdata)),
>     n = N,
>     sd = SD,
>     maType = "SMA"),
>   label = "BBands")
>
> # #Indi Debug
> # summary(stratBBands)
> # start_t <- Sys.time()
> # applyIndicators( strategy = stratBBands, mktdata = Ratio)
> # end_t<-Sys.time()
> # print("strat execution time:")
> # print(end_t-start_t)
>
> # Add signals:
> stratBBands <- add.signal(
>   strategy = stratBBands,
>   name = "sigCrossover",
>   arguments = list(
>     columns = c("Close","up.BBands"),
>     relationship = "gt"),
>   label = "Cl.gt.UpperBand")
>
> stratBBands <- add.signal(
>   strategy = stratBBands,
>   name = "sigCrossover",
>   arguments = list(
>     columns = c("Close","dn.BBands"),
>     relationship = "lt"),
>   label = "Cl.lt.LowerBand")
>
> stratBBands <- add.signal(
>   strategy = stratBBands,
>   name = "sigCrossover",
>   arguments = list(
>     columns = c("High","Low", "mavg.BBands"),
>     relationship = "op"),
>   label = "Cross.Mid")
>
> # #Signal Debug
> # summary(stratBBands)
> # start_t <- Sys.time()
> # applySignals(strategy = stratBBands, mktdata =
> applyIndicators(strategy = stratBBands, mktdata = Ratio))
> # end_t<-Sys.time()
> # print("strat execution time:")
> # print(end_t-start_t)
>
> # Rules -----
>
> #Entry
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.gt.UpperBand",
>     sigval = TRUE,
>     orderqty = -1,
>     ordertype = "market",
>     orderside = "short",
>     symbol = "symb1",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "ShortSpread_symb1")
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.gt.UpperBand",
>     sigval = TRUE,
>     orderqty = 1,
>     ordertype = "market",
>     orderside = "long",
>     symbol = "symb2",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "ShortSpread_symb2")
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.lt.LowerBand",
>     sigval = TRUE,
>     orderqty = 1,
>     ordertype = "market",
>     orderside = "long"
>     symbol = "symb1",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "LongSpread_symb1")
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.lt.LowerBand",
>     sigval = TRUE,
>     orderqty = -1,
>     ordertype = "market",
>     orderside = "short",
>     symbol = "symb2",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "LongSpread_symb2")
>
> # Exit
> stratBBands <- add.rule(
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cross.Mid",
>     sigval = TRUE,
>     orderqty = "all",
>     ordertype = "market",
>     TxnFees = 0,
>     replace = TRUE),
>   type = "exit",
>   label = "Exit")
>
>
> summary(stratBBands)
>
> # Strategy Execution ----
> start_t<-Sys.time()
> out<-try(applyStrategy(strategy=stratBBands ,
>                        portfolios="bbands"))
> end_t<-Sys.time()
> print("strat execution time:")
> print(end_t-start_t)
>
> # update portfolio
> start_t<-Sys.time()
> updatePortf(Portfolio='bbands',Dates=paste('::',as.Date(Sys.time()),sep=''))
> end_t<-Sys.time()
> print("updatePortf execution time:")
> print(end_t-start_t)
>
> #Chart
> chart.Posn(Portfolio='bbands',Symbol="symb1")
> plot(add_BBands(on=1,sd=SD,n=N))
> chart.Posn(Portfolio='bbands',Symbol="symb2")
> plot(add_BBands(on=1,sd=SD,n=N))
> chart.Posn(Portfolio='bbands',Symbol="symb1.symb2")
> plot(add_BBands(on=1,sd=SD,n=N))
>
> #Stats
> book <- getOrderBook("bbands")
> stats <- tradeStats("bbands")
> rets <- PortfReturns("bbands")
> port <- getPortfolio("bbands")
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From ilya.kipnis at gmail.com  Mon Dec 22 00:25:35 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Sun, 21 Dec 2014 18:25:35 -0500
Subject: [R-SIG-Finance] Using a custom Spread to execute onto the 2
 underlying instruments - Quantstrat Help
In-Reply-To: <CALQudT-LSEQbmgt5+=ZKoK+dNqZPdV6a=U41BO4LnR0p96sqYQ@mail.gmail.com>
References: <CALQudT-LSEQbmgt5+=ZKoK+dNqZPdV6a=U41BO4LnR0p96sqYQ@mail.gmail.com>
Message-ID: <CA+oJuEH-fyRxf-Nx3VhXgqkFieL9kpdt0htQaUXT9dV+JHdZnA@mail.gmail.com>

Actually, I have another suggestion if you're doing synthetic spreads and
want to execute on the underlyings--precompute your signals on both
instruments, and even though they are different values (EG if my long
signal goes 0, 1, 0, my short signal will go 0, -1, 0), and then use a
threshold rule on the synthetic signal.

See this post on my blog:

http://quantstrattrader.wordpress.com/2014/11/07/predicting-high-yield-with-spy-a-two-part-post-2/
, namely the second part, on pre-computing values.

-Ilya

On Thu, Dec 11, 2014 at 2:31 AM, Derek Wong <treydog999 at gmail.com> wrote:

> Hello
>
> I am having problems with using a spread to generate signals and rules
> but then execute individually on the underlying. In my example case, I
> am taking the SP500 E-mini future (ES) and the Dow E-mini future (YM)
> calculating a custom spread function then using that for signal
> generation using rolling std dev and mean for thresholds. There is not
> very much documentation or demos on spreads and other synthetics that
> are available in the Financial Instrument Package. Example code below.
>
> I run into problems in the backtest runs and it runs the trade rules
> for every symbol in the portfolio, symb1 (ES), symb2(YM), and the
> custom spread symb1.symb2. I was expecting it to just run on
> symb1.symb2 and by using the RuleSignal symbol field and specify
> "symb1" and "symb2" for execution it would then execute on the
> underlying themselves. Instead quantstrat applystrategy goes through
> symb1, symb2, and symb1.symb2 and places trades on everything.
>
> Is it possible to use a custom spread to execute on the underlying, if
> so how? Am I mis-specifying or misusing  the RuleSignal symbol
> identifier field? because I am specifically stating I want to execute
> symb1 long and symb2 short for a given signal or vice versa. I am not
> specifying the symb1.symb2 at all for any of the RuleSignal executions
> but they do trade.
>
>
> Thanks
>
> Derek
>
>
>
>
> # attempt to create a pairs trading strategy using a spread from
> Financial Instrument package.
> # Based on a Notional Spread and Standard Devations from the rolling mean
>
> require(quantstrat)
> require(Quandl)
> require(quantmod)
> #### Data Prep ####
>
> #get data from Quandl
> symb1 <- Quandl("CHRIS/CME_ES1", type = "xts",
> trim_start="2010-01-01", trim_end="2014-11-17")
> symb2 <- Quandl("CHRIS/CME_YM1", type = "xts",
> trim_start="2010-01-01", trim_end="2014-11-17")
>
> #Trim and Format  - Using settlement as Close value
> symb1 <- symb1[,c(1,2,3,6)]
> symb2 <- symb2[,c(1,2,3,6)]
>
> colnames(symb1) <- c("Open", "High", "Low", "Close")
> colnames(symb2) <- c("Open", "High", "Low", "Close")
>
> #Clean data so only dates where both trades exist
> merge <- cbind(symb1, symb2)
> dates <- index(merge[complete.cases(merge),])
> symb1<- symb1[dates]
> symb2<- symb2[dates]
>
> # -----------------------STRATEGY-------------------
> #clean variables for reruns
> suppressWarnings(rm("order_book.bbands",pos=.strategy))
> suppressWarnings(rm("account.bbands","portfolio.bbands",pos=.blotter))
> suppressWarnings(rm("account.st","portfolio.st
> ","stock.str","stratBBands","initDate","initEq",'start_t','end_t'))
>
> #Initial values / parameters
> initDate= index(symb1)[1]-1
> initEq=100000
>
> SD = 2 # how many standard deviations
> N = 20 # length of moving average
>
> #Initialize FinancialInstrument Objects
>
> currency('USD')
>
> future( primary_id = "symb1",
>         currency = "USD",
>         tick_size = .25,
>         multiplier = 50)
>
> future( primary_id = "symb2",
>         currency = "USD",
>         tick_size = 1,
>         multiplier = 5)
>
> #Create Spread Series
> calcRatio <- function(x) {
>   #returns the ratio of notional close prices for 2 symbols
>   x1 <- get(x[1])
>   x2 <- get(x[2])
>   mult1 <- getInstrument(x[1])$multiplier
>   mult2 <- getInstrument(x[2])$multiplier
>   rat.Op <- ((mult1 * Op(x1))) / (mult2 * Op(x2))
>   rat.Hi <- ((mult1 * Hi(x1))) / (mult2 * Hi(x2))
>   rat.Lo <- ((mult1 * Lo(x1))) / (mult2 * Lo(x2))
>   rat.Cl <- ((mult1 * Cl(x1))) / (mult2 * Cl(x2))
>   ratio <- cbind(rat.Op, rat.Hi, rat.Lo, rat.Cl)
>   colnames(ratio) <- c("Open", "High", "Low", "Close")
>   return(ratio)
> }
>
> Ratio <- calcRatio(c("symb1", "symb2"))
>
> #Initialize Spread (using notional ratio as hedge ratio)
> spread(primary_id = "symb1.symb2",
>        currency = "USD",
>        members = c("symb1", "symb2"),
>        memberratio = list(1, as.numeric(-Cl(Ratio))) )
>
> #Notional Ratio is also spread for trading
> symb1.symb2 <- Ratio
>
> #name strings
> portfolio.st = 'bbands'
> account.st = 'bbands'
>
> #initialization of strategy objects ----
> initPortf(portfolio.st, #portfolio Initiatlization
>           symbols = c("symb1.symb2", "symb1", "symb2"),
>           initDate = initDate,
>           currency = "USD",
>           initPosQty = 0)
>
> initAcct(account.st, #account initialization
>          portfolios = portfolio.st,
>          initDate = initDate,
>          initEq = initEq)
>
> initOrders(portfolio = portfolio.st, #orders initialize
>            initDate = initDate)
>
> addPosLimit( portfolio = portfolio.st, # add position limit rules
>              symbol = 'symb1.symb2',
>              timestamp = initDate,
>              maxpos = 1,
>              longlevels = 1,
>              minpos = -1)
>
> addPosLimit( portfolio = portfolio.st, # add position limit rules
>              symbol = 'symb1',
>              timestamp = initDate,
>              maxpos = 2,
>              longlevels = 1,
>              minpos = -2)
>
> addPosLimit( portfolio = portfolio.st, # add position limit rules
>              symbol = 'symb2',
>              timestamp = initDate,
>              maxpos = 2,
>              longlevels = 1,
>              minpos = -2)
>
> stratBBands <- strategy("bbands") # strategy object init
>
> # Indicator
> stratBBands <- add.indicator(
>   strategy = stratBBands,
>   name = "BBands",
>   arguments = list(
>     HLC = quote(HLC(mktdata)),
>     n = N,
>     sd = SD,
>     maType = "SMA"),
>   label = "BBands")
>
> # #Indi Debug
> # summary(stratBBands)
> # start_t <- Sys.time()
> # applyIndicators( strategy = stratBBands, mktdata = Ratio)
> # end_t<-Sys.time()
> # print("strat execution time:")
> # print(end_t-start_t)
>
> # Add signals:
> stratBBands <- add.signal(
>   strategy = stratBBands,
>   name = "sigCrossover",
>   arguments = list(
>     columns = c("Close","up.BBands"),
>     relationship = "gt"),
>   label = "Cl.gt.UpperBand")
>
> stratBBands <- add.signal(
>   strategy = stratBBands,
>   name = "sigCrossover",
>   arguments = list(
>     columns = c("Close","dn.BBands"),
>     relationship = "lt"),
>   label = "Cl.lt.LowerBand")
>
> stratBBands <- add.signal(
>   strategy = stratBBands,
>   name = "sigCrossover",
>   arguments = list(
>     columns = c("High","Low", "mavg.BBands"),
>     relationship = "op"),
>   label = "Cross.Mid")
>
> # #Signal Debug
> # summary(stratBBands)
> # start_t <- Sys.time()
> # applySignals(strategy = stratBBands, mktdata =
> applyIndicators(strategy = stratBBands, mktdata = Ratio))
> # end_t<-Sys.time()
> # print("strat execution time:")
> # print(end_t-start_t)
>
> # Rules -----
>
> #Entry
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.gt.UpperBand",
>     sigval = TRUE,
>     orderqty = -1,
>     ordertype = "market",
>     orderside = "short",
>     symbol = "symb1",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "ShortSpread_symb1")
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.gt.UpperBand",
>     sigval = TRUE,
>     orderqty = 1,
>     ordertype = "market",
>     orderside = "long",
>     symbol = "symb2",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "ShortSpread_symb2")
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.lt.LowerBand",
>     sigval = TRUE,
>     orderqty = 1,
>     ordertype = "market",
>     orderside = "long"
>     symbol = "symb1",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "LongSpread_symb1")
>
> stratBBands <- add.rule (
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cl.lt.LowerBand",
>     sigval = TRUE,
>     orderqty = -1,
>     ordertype = "market",
>     orderside = "short",
>     symbol = "symb2",
>     replace = TRUE,
>     osFUN = osMaxPos),
>   type = "enter",
>   label = "LongSpread_symb2")
>
> # Exit
> stratBBands <- add.rule(
>   strategy = stratBBands,
>   name = "ruleSignal",
>   arguments = list(
>     sigcol = "Cross.Mid",
>     sigval = TRUE,
>     orderqty = "all",
>     ordertype = "market",
>     TxnFees = 0,
>     replace = TRUE),
>   type = "exit",
>   label = "Exit")
>
>
> summary(stratBBands)
>
> # Strategy Execution ----
> start_t<-Sys.time()
> out<-try(applyStrategy(strategy=stratBBands ,
>                        portfolios="bbands"))
> end_t<-Sys.time()
> print("strat execution time:")
> print(end_t-start_t)
>
> # update portfolio
> start_t<-Sys.time()
>
> updatePortf(Portfolio='bbands',Dates=paste('::',as.Date(Sys.time()),sep=''))
> end_t<-Sys.time()
> print("updatePortf execution time:")
> print(end_t-start_t)
>
> #Chart
> chart.Posn(Portfolio='bbands',Symbol="symb1")
> plot(add_BBands(on=1,sd=SD,n=N))
> chart.Posn(Portfolio='bbands',Symbol="symb2")
> plot(add_BBands(on=1,sd=SD,n=N))
> chart.Posn(Portfolio='bbands',Symbol="symb1.symb2")
> plot(add_BBands(on=1,sd=SD,n=N))
>
> #Stats
> book <- getOrderBook("bbands")
> stats <- tradeStats("bbands")
> rets <- PortfReturns("bbands")
> port <- getPortfolio("bbands")
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From ivan.popivanov at gmail.com  Mon Dec 22 04:32:10 2014
From: ivan.popivanov at gmail.com (Ivan Popivanov)
Date: Mon, 22 Dec 2014 03:32:10 +0000
Subject: [R-SIG-Finance] Prototyped support for "partial" and
 parallelism to rollapply.xts
References: <CAK7-yAjQ1Hmxpqwp9ONvwcbC3bdYraRRTvmyiyX3vV7EvCXXoA@mail.gmail.com>
	<CAPPM_gQPDnTKs6ona6pgu+bf-LQUynhYKJfhYNZA8anmG_fMaA@mail.gmail.com>
Message-ID: <CAK7-yAgKZ22XX1JV9wActt2JtF=R-k-5nEF4n=ahpYNHyZz14w@mail.gmail.com>

Hi Joshua,

I did test some basic scenarios (mean) and compared against the results
from runMean. Tested by.column=T/F, partial=T/F, cores=1/4. I didn't create
test cases though. Certainly more testing is needed.

As for the usage scenario, I was coding non-trivial filter on an indicator
and first got tired converting forth and back to zoo. The parallelism came
later, when I noticed my filter taking quite a while (minutes at this
stage, but that will grow later) to compute. The filter takes all history
at each step (partial=T, width=NROW(data)), then does some sampling (using
one of the data columns decides which points are of interest) and then
passes the sample to some logic, which is also expensive to compute (ML).

Regards,
Ivan

On Sun Dec 21 2014 at 16:22:06 Joshua Ulrich <josh.m.ulrich at gmail.com>
wrote:

> Hi Ivan,
>
> Thanks for the contributions!  Did you happen to test the partial=TRUE
> output versus rollapply.zoo?  Also, can you share your use case for
> running rollapply in parallel?
>
> Best,
> Josh
>
> On Fri, Dec 19, 2014 at 11:05 PM, Ivan Popivanov
> <ivan.popivanov at gmail.com> wrote:
> > I needed these two features, and thought they might be useful in
> general, so
> > I spent some extra time implementing them on top xts, see the
> attachments.
> > Not sure whether I managed to cover all cases, but it should be a solid
> > start if you decide adding them to the package.
> >
> > Note: Only the Unix form of parallelism (mclapply from parallel) is
> > supported, but that's mainly for expedience. Adding support for
> parSapply is
> > feasible, but it usually leads to more cumbersome interfaces.
> >
> > Regards,
> > Ivan
> >
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>

	[[alternative HTML version deleted]]


From treydog999 at gmail.com  Mon Dec 22 04:50:43 2014
From: treydog999 at gmail.com (Derek Wong)
Date: Mon, 22 Dec 2014 11:50:43 +0800
Subject: [R-SIG-Finance] Using a custom Spread to execute onto the 2
 underlying instruments - Quantstrat Help
In-Reply-To: <CAPPM_gSMBM3UzaseqFbQvO3asPZ0AjA5B4uH3cv51xHHr6-g6w@mail.gmail.com>
References: <CALQudT-LSEQbmgt5+=ZKoK+dNqZPdV6a=U41BO4LnR0p96sqYQ@mail.gmail.com>
	<CAPPM_gSMBM3UzaseqFbQvO3asPZ0AjA5B4uH3cv51xHHr6-g6w@mail.gmail.com>
Message-ID: <CALQudT-hhd8yEqWdwSQR-5BovfLDEfLC9SSfD4Je6rZ652VCrw@mail.gmail.com>

Hi Joshua,

I thought that applyStrategy would not execute orders against the
synthetic because i was explicitly stating which symbols I wanted
orders put against. However orders were executing against it anyway. I
wouldn't mind if applyStrategy went through the symbols data but never
placed an order on it. Thank you for the suggestions I will give them
a try. I appreciate your answers.

Derek

On Mon, Dec 22, 2014 at 5:55 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> On Thu, Dec 11, 2014 at 1:31 AM, Derek Wong <treydog999 at gmail.com> wrote:
>> Hello
>>
>> I am having problems with using a spread to generate signals and rules
>> but then execute individually on the underlying. In my example case, I
>> am taking the SP500 E-mini future (ES) and the Dow E-mini future (YM)
>> calculating a custom spread function then using that for signal
>> generation using rolling std dev and mean for thresholds. There is not
>> very much documentation or demos on spreads and other synthetics that
>> are available in the Financial Instrument Package. Example code below.
>>
>> I run into problems in the backtest runs and it runs the trade rules
>> for every symbol in the portfolio, symb1 (ES), symb2(YM), and the
>> custom spread symb1.symb2. I was expecting it to just run on
>> symb1.symb2 and by using the RuleSignal symbol field and specify
>> "symb1" and "symb2" for execution it would then execute on the
>> underlying themselves. Instead quantstrat applystrategy goes through
>> symb1, symb2, and symb1.symb2 and places trades on everything.
>>
> ?applyStrategy says that it will apply the strategy to every symbol in
> the portfolio, so I'm not sure why you expected it to only run on one
> symbol in the portfolio.
>
>> Is it possible to use a custom spread to execute on the underlying, if
>> so how? Am I mis-specifying or misusing  the RuleSignal symbol
>> identifier field? because I am specifically stating I want to execute
>> symb1 long and symb2 short for a given signal or vice versa. I am not
>> specifying the symb1.symb2 at all for any of the RuleSignal executions
>> but they do trade.
>>
> One thing you could try:
> Remove the synthetic spread from your portfolio object, and just use
> the synthetic spread data to manually create signals for each of the
> underlyings.  Then call applyRules for each underlying and pass your
> signals via the signals argument to applyRules.
>
> Or, perhaps better still, you could keep only the synthetic spread in
> your portfolio, since your rules create orders on the underlyings.
> Then you might be able to leave the rest of your data unchanged.
>
> Note that both suggestions are just off the top of my head, since I
> don't have a Quandl token.  Let me know if either of those suggestions
> help.
>
>>
>> Thanks
>>
>> Derek
>>
>>
>>
>>
>> # attempt to create a pairs trading strategy using a spread from
>> Financial Instrument package.
>> # Based on a Notional Spread and Standard Devations from the rolling mean
>>
>> require(quantstrat)
>> require(Quandl)
>> require(quantmod)
>> #### Data Prep ####
>>
>> #get data from Quandl
>> symb1 <- Quandl("CHRIS/CME_ES1", type = "xts",
>> trim_start="2010-01-01", trim_end="2014-11-17")
>> symb2 <- Quandl("CHRIS/CME_YM1", type = "xts",
>> trim_start="2010-01-01", trim_end="2014-11-17")
>>
>> #Trim and Format  - Using settlement as Close value
>> symb1 <- symb1[,c(1,2,3,6)]
>> symb2 <- symb2[,c(1,2,3,6)]
>>
>> colnames(symb1) <- c("Open", "High", "Low", "Close")
>> colnames(symb2) <- c("Open", "High", "Low", "Close")
>>
>> #Clean data so only dates where both trades exist
>> merge <- cbind(symb1, symb2)
>> dates <- index(merge[complete.cases(merge),])
>> symb1<- symb1[dates]
>> symb2<- symb2[dates]
>>
>> # -----------------------STRATEGY-------------------
>> #clean variables for reruns
>> suppressWarnings(rm("order_book.bbands",pos=.strategy))
>> suppressWarnings(rm("account.bbands","portfolio.bbands",pos=.blotter))
>> suppressWarnings(rm("account.st","portfolio.st","stock.str","stratBBands","initDate","initEq",'start_t','end_t'))
>>
>> #Initial values / parameters
>> initDate= index(symb1)[1]-1
>> initEq=100000
>>
>> SD = 2 # how many standard deviations
>> N = 20 # length of moving average
>>
>> #Initialize FinancialInstrument Objects
>>
>> currency('USD')
>>
>> future( primary_id = "symb1",
>>         currency = "USD",
>>         tick_size = .25,
>>         multiplier = 50)
>>
>> future( primary_id = "symb2",
>>         currency = "USD",
>>         tick_size = 1,
>>         multiplier = 5)
>>
>> #Create Spread Series
>> calcRatio <- function(x) {
>>   #returns the ratio of notional close prices for 2 symbols
>>   x1 <- get(x[1])
>>   x2 <- get(x[2])
>>   mult1 <- getInstrument(x[1])$multiplier
>>   mult2 <- getInstrument(x[2])$multiplier
>>   rat.Op <- ((mult1 * Op(x1))) / (mult2 * Op(x2))
>>   rat.Hi <- ((mult1 * Hi(x1))) / (mult2 * Hi(x2))
>>   rat.Lo <- ((mult1 * Lo(x1))) / (mult2 * Lo(x2))
>>   rat.Cl <- ((mult1 * Cl(x1))) / (mult2 * Cl(x2))
>>   ratio <- cbind(rat.Op, rat.Hi, rat.Lo, rat.Cl)
>>   colnames(ratio) <- c("Open", "High", "Low", "Close")
>>   return(ratio)
>> }
>>
>> Ratio <- calcRatio(c("symb1", "symb2"))
>>
>> #Initialize Spread (using notional ratio as hedge ratio)
>> spread(primary_id = "symb1.symb2",
>>        currency = "USD",
>>        members = c("symb1", "symb2"),
>>        memberratio = list(1, as.numeric(-Cl(Ratio))) )
>>
>> #Notional Ratio is also spread for trading
>> symb1.symb2 <- Ratio
>>
>> #name strings
>> portfolio.st = 'bbands'
>> account.st = 'bbands'
>>
>> #initialization of strategy objects ----
>> initPortf(portfolio.st, #portfolio Initiatlization
>>           symbols = c("symb1.symb2", "symb1", "symb2"),
>>           initDate = initDate,
>>           currency = "USD",
>>           initPosQty = 0)
>>
>> initAcct(account.st, #account initialization
>>          portfolios = portfolio.st,
>>          initDate = initDate,
>>          initEq = initEq)
>>
>> initOrders(portfolio = portfolio.st, #orders initialize
>>            initDate = initDate)
>>
>> addPosLimit( portfolio = portfolio.st, # add position limit rules
>>              symbol = 'symb1.symb2',
>>              timestamp = initDate,
>>              maxpos = 1,
>>              longlevels = 1,
>>              minpos = -1)
>>
>> addPosLimit( portfolio = portfolio.st, # add position limit rules
>>              symbol = 'symb1',
>>              timestamp = initDate,
>>              maxpos = 2,
>>              longlevels = 1,
>>              minpos = -2)
>>
>> addPosLimit( portfolio = portfolio.st, # add position limit rules
>>              symbol = 'symb2',
>>              timestamp = initDate,
>>              maxpos = 2,
>>              longlevels = 1,
>>              minpos = -2)
>>
>> stratBBands <- strategy("bbands") # strategy object init
>>
>> # Indicator
>> stratBBands <- add.indicator(
>>   strategy = stratBBands,
>>   name = "BBands",
>>   arguments = list(
>>     HLC = quote(HLC(mktdata)),
>>     n = N,
>>     sd = SD,
>>     maType = "SMA"),
>>   label = "BBands")
>>
>> # #Indi Debug
>> # summary(stratBBands)
>> # start_t <- Sys.time()
>> # applyIndicators( strategy = stratBBands, mktdata = Ratio)
>> # end_t<-Sys.time()
>> # print("strat execution time:")
>> # print(end_t-start_t)
>>
>> # Add signals:
>> stratBBands <- add.signal(
>>   strategy = stratBBands,
>>   name = "sigCrossover",
>>   arguments = list(
>>     columns = c("Close","up.BBands"),
>>     relationship = "gt"),
>>   label = "Cl.gt.UpperBand")
>>
>> stratBBands <- add.signal(
>>   strategy = stratBBands,
>>   name = "sigCrossover",
>>   arguments = list(
>>     columns = c("Close","dn.BBands"),
>>     relationship = "lt"),
>>   label = "Cl.lt.LowerBand")
>>
>> stratBBands <- add.signal(
>>   strategy = stratBBands,
>>   name = "sigCrossover",
>>   arguments = list(
>>     columns = c("High","Low", "mavg.BBands"),
>>     relationship = "op"),
>>   label = "Cross.Mid")
>>
>> # #Signal Debug
>> # summary(stratBBands)
>> # start_t <- Sys.time()
>> # applySignals(strategy = stratBBands, mktdata =
>> applyIndicators(strategy = stratBBands, mktdata = Ratio))
>> # end_t<-Sys.time()
>> # print("strat execution time:")
>> # print(end_t-start_t)
>>
>> # Rules -----
>>
>> #Entry
>>
>> stratBBands <- add.rule (
>>   strategy = stratBBands,
>>   name = "ruleSignal",
>>   arguments = list(
>>     sigcol = "Cl.gt.UpperBand",
>>     sigval = TRUE,
>>     orderqty = -1,
>>     ordertype = "market",
>>     orderside = "short",
>>     symbol = "symb1",
>>     replace = TRUE,
>>     osFUN = osMaxPos),
>>   type = "enter",
>>   label = "ShortSpread_symb1")
>>
>> stratBBands <- add.rule (
>>   strategy = stratBBands,
>>   name = "ruleSignal",
>>   arguments = list(
>>     sigcol = "Cl.gt.UpperBand",
>>     sigval = TRUE,
>>     orderqty = 1,
>>     ordertype = "market",
>>     orderside = "long",
>>     symbol = "symb2",
>>     replace = TRUE,
>>     osFUN = osMaxPos),
>>   type = "enter",
>>   label = "ShortSpread_symb2")
>>
>> stratBBands <- add.rule (
>>   strategy = stratBBands,
>>   name = "ruleSignal",
>>   arguments = list(
>>     sigcol = "Cl.lt.LowerBand",
>>     sigval = TRUE,
>>     orderqty = 1,
>>     ordertype = "market",
>>     orderside = "long"
>>     symbol = "symb1",
>>     replace = TRUE,
>>     osFUN = osMaxPos),
>>   type = "enter",
>>   label = "LongSpread_symb1")
>>
>> stratBBands <- add.rule (
>>   strategy = stratBBands,
>>   name = "ruleSignal",
>>   arguments = list(
>>     sigcol = "Cl.lt.LowerBand",
>>     sigval = TRUE,
>>     orderqty = -1,
>>     ordertype = "market",
>>     orderside = "short",
>>     symbol = "symb2",
>>     replace = TRUE,
>>     osFUN = osMaxPos),
>>   type = "enter",
>>   label = "LongSpread_symb2")
>>
>> # Exit
>> stratBBands <- add.rule(
>>   strategy = stratBBands,
>>   name = "ruleSignal",
>>   arguments = list(
>>     sigcol = "Cross.Mid",
>>     sigval = TRUE,
>>     orderqty = "all",
>>     ordertype = "market",
>>     TxnFees = 0,
>>     replace = TRUE),
>>   type = "exit",
>>   label = "Exit")
>>
>>
>> summary(stratBBands)
>>
>> # Strategy Execution ----
>> start_t<-Sys.time()
>> out<-try(applyStrategy(strategy=stratBBands ,
>>                        portfolios="bbands"))
>> end_t<-Sys.time()
>> print("strat execution time:")
>> print(end_t-start_t)
>>
>> # update portfolio
>> start_t<-Sys.time()
>> updatePortf(Portfolio='bbands',Dates=paste('::',as.Date(Sys.time()),sep=''))
>> end_t<-Sys.time()
>> print("updatePortf execution time:")
>> print(end_t-start_t)
>>
>> #Chart
>> chart.Posn(Portfolio='bbands',Symbol="symb1")
>> plot(add_BBands(on=1,sd=SD,n=N))
>> chart.Posn(Portfolio='bbands',Symbol="symb2")
>> plot(add_BBands(on=1,sd=SD,n=N))
>> chart.Posn(Portfolio='bbands',Symbol="symb1.symb2")
>> plot(add_BBands(on=1,sd=SD,n=N))
>>
>> #Stats
>> book <- getOrderBook("bbands")
>> stats <- tradeStats("bbands")
>> rets <- PortfReturns("bbands")
>> port <- getPortfolio("bbands")
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com


From treydog999 at gmail.com  Tue Dec 30 09:50:55 2014
From: treydog999 at gmail.com (Derek Wong)
Date: Tue, 30 Dec 2014 16:50:55 +0800
Subject: [R-SIG-Finance] Period.Unrealized.PL always sums to 0 after a
 transaction, why? - Blotter/ Quantstrat
Message-ID: <CALQudT9BwdcWSRDtsTM6LCXobE0LmWt_t9CjTh=jamUj3zPwmQ@mail.gmail.com>

Hi

I have been diving into the workings of blotter just to understand it
better. I have been using the bbands.R demo that is in the quantstrat
project. It is actually a number that will sum with all of the
previous Period.Unrealized.PL to make it sum to 0. Shouldn't the
Period.Unrealized.PL for a bar with a transaction to exit be 0,
assuming you exit at the close price?  or in the bbands.R example the
previous day 2007-03-20 close price is 94.50 the next day is 95.36.
Shouldn't 86 be the result not -54? I am not saying the result is
incorrect, I am just trying to figure out the logic behind the
calculations.

To get the portfolio PL sheet run bbands.R from r-forge then

port <- getPortfolio(portfolio.st)
View(port$symbols$IBM$posPL)
sum(port$symbols$IBM$posPL$Period.Unrealized.PL)


Thank you and happy new year.

Derek


From brian at braverock.com  Tue Dec 30 11:27:18 2014
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 30 Dec 2014 04:27:18 -0600
Subject: [R-SIG-Finance] Period.Unrealized.PL always sums to 0 after a
 transaction, why? - Blotter/ Quantstrat
In-Reply-To: <CALQudT9BwdcWSRDtsTM6LCXobE0LmWt_t9CjTh=jamUj3zPwmQ@mail.gmail.com>
References: <CALQudT9BwdcWSRDtsTM6LCXobE0LmWt_t9CjTh=jamUj3zPwmQ@mail.gmail.com>
Message-ID: <54A27E06.1060303@braverock.com>

On 12/30/2014 02:50 AM, Derek Wong wrote:
> I have been diving into the workings of blotter just to understand it
> better. I have been using the bbands.R demo that is in the quantstrat
> project. It is actually a number that will sum with all of the
> previous Period.Unrealized.PL to make it sum to 0. Shouldn't the
> Period.Unrealized.PL for a bar with a transaction to exit be 0,
> assuming you exit at the close price?  or in the bbands.R example the
> previous day 2007-03-20 close price is 94.50 the next day is 95.36.
> Shouldn't 86 be the result not -54? I am not saying the result is
> incorrect, I am just trying to figure out the logic behind the
> calculations.
>
> To get the portfolio PL sheet run bbands.R from r-forge then
>
> port <- getPortfolio(portfolio.st)
> View(port$symbols$IBM$posPL)
> sum(port$symbols$IBM$posPL$Period.Unrealized.PL)

Unrealized P&L is exactly what it says it is.  Once you realize that P&L 
(on a transaction), then the unrealized P&L flat to flat has to sum to 
zero. if it did not, then you'd double-count unrealized and realized P&L.

In the last period, the period with a transaction, you need to back out 
any residual unrealized P&L and move it to the realized column.

Put another way, portfolio value is the sum of realized P&L from trades, 
position average cost for open positions, and any any unrealized P&L 
from open position.

So, back to your example from the bbands demo.

on 2007-03-20 your cumulative Net.Trading.PL and Period.Unrealized.PL 
was 54, all of it from your unrealized gains.

on 2007-03-21 you close the position for 140 realized gain

The proceeds from that transaction, for period 2007-03-21, need to back 
out the 54 unrealized (since you've already accumulated it), for a gross 
profit in column Gross.Trading.PL (from the transaction realized P&L) on 
this period of 86.  (there's the 86 you're looking for in your question).

Part of this is a result of double entry accounting, where debits and 
credits need to add up.  Another part of this is the nature of portfolio 
accounting, where period gains and losses are attributed to your account 
value each day.  all the money you gained or lost each day was reflected 
in the cumulative totals of your account value, so that has to still 
make sense on the day you close the transaction, and you do that by 
backing out the accumulated unrealized gain when you realize it.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From markknecht at gmail.com  Wed Dec 31 18:52:37 2014
From: markknecht at gmail.com (Mark Knecht)
Date: Wed, 31 Dec 2014 09:52:37 -0800
Subject: [R-SIG-Finance] Quantitative Trading with R: Understanding
	Mathematical and ...
Message-ID: <CAK2H+ed_q8VvnfC+xnLchP05_vbdf4nngU6KugdzTE8B9trVRQ@mail.gmail.com>

I wonder if anyone has had a chance to read this book prior to it's
availability on Amazon next week?

http://www.amazon.com/gp/product/1137354070

It appears to be the author's first book.

Cheers,
Mark


From edd at debian.org  Wed Dec 31 20:29:56 2014
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 31 Dec 2014 13:29:56 -0600
Subject: [R-SIG-Finance] Quantitative Trading with R:
	Understanding	Mathematical and ...
In-Reply-To: <CAK2H+ed_q8VvnfC+xnLchP05_vbdf4nngU6KugdzTE8B9trVRQ@mail.gmail.com>
References: <CAK2H+ed_q8VvnfC+xnLchP05_vbdf4nngU6KugdzTE8B9trVRQ@mail.gmail.com>
Message-ID: <21668.20148.817274.888017@max.nulle.part>


On 31 December 2014 at 09:52, Mark Knecht wrote:
| I wonder if anyone has had a chance to read this book prior to it's
| availability on Amazon next week?
| 
| http://www.amazon.com/gp/product/1137354070
| 
| It appears to be the author's first book.

Harry was kind enough to send me a courtesy copy which I received yesterday.

That said, I have not read it cover to cover.  But the [few] spot checks I
managed to do looked fine.  

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ilya.kipnis at gmail.com  Wed Dec 31 21:03:53 2014
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Wed, 31 Dec 2014 15:03:53 -0500
Subject: [R-SIG-Finance] Quantitative Trading with R: Understanding
 Mathematical and ...
In-Reply-To: <21668.20148.817274.888017@max.nulle.part>
References: <CAK2H+ed_q8VvnfC+xnLchP05_vbdf4nngU6KugdzTE8B9trVRQ@mail.gmail.com>
	<21668.20148.817274.888017@max.nulle.part>
Message-ID: <CA+oJuEHovLtCGSxyq5nMaU+8S8w8DFmXQ=fPZzrQYp9rgQYBJQ@mail.gmail.com>

For those that care to look, I wrote the quantstrat chapter.

On Wed, Dec 31, 2014 at 2:29 PM, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 31 December 2014 at 09:52, Mark Knecht wrote:
> | I wonder if anyone has had a chance to read this book prior to it's
> | availability on Amazon next week?
> |
> | http://www.amazon.com/gp/product/1137354070
> |
> | It appears to be the author's first book.
>
> Harry was kind enough to send me a courtesy copy which I received
> yesterday.
>
> That said, I have not read it cover to cover.  But the [few] spot checks I
> managed to do looked fine.
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]



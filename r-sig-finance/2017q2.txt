From jongolenbock at gmail.com  Wed Apr  5 14:54:40 2017
From: jongolenbock at gmail.com (Jon Golenbock)
Date: Wed, 5 Apr 2017 08:54:40 -0400
Subject: [R-SIG-Finance] Rblpapi package data limits?
Message-ID: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>

Hi, I was hoping somebody might be a regular user of this package to
interact with Bloomberg terminal. I've been having an issue pulling
historical data, it seems to cut off at a seemingly arbitrary point --


library(rRblpapi)
library(dplyr)
library(purrr)
library(lubridate)
library(magrittr)

striplist <- c("NGK7","NGM7", "NGN7","NGQ7", "NGU7","NGV7","NGX7")
striplist <- paste(striplist, "Comdty")


df <- striplist %>%
  map(~ getBars(., barInterval = 60 *24,startTime =
floor_date(Sys.time(),"day") - days(300))) %>%
  map(~select(., times, close))
names(df) <- striplist


this should be producing close data for 300 days, yet you will see that the
data only goes back 140.

Anybody run into this before, should I have expected this?

Thanks,
Jon

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Apr  5 15:03:29 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 05 Apr 2017 08:03:29 -0500
Subject: [R-SIG-Finance] Rblpapi package data limits?
In-Reply-To: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>
References: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>
Message-ID: <1491397409.23236.5.camel@braverock.com>

On Wed, 2017-04-05 at 08:54 -0400, Jon Golenbock wrote:
> Hi, I was hoping somebody might be a regular user of this package to
> interact with Bloomberg terminal. I've been having an issue pulling
> historical data, it seems to cut off at a seemingly arbitrary point
> --
> 
> 
> library(rRblpapi)
> library(dplyr)
> library(purrr)
> library(lubridate)
> library(magrittr)
> 
> striplist <- c("NGK7","NGM7", "NGN7","NGQ7", "NGU7","NGV7","NGX7")
> striplist <- paste(striplist, "Comdty")
> 
> 
> df <- striplist %>%
> ? map(~ getBars(., barInterval = 60 *24,startTime =
> floor_date(Sys.time(),"day") - days(300))) %>%
> ? map(~select(., times, close))
> names(df) <- striplist


Many people do not use the 'tidyverse', especially in finance where
data is often very large and ultimately needs to be a 'wide' time
series and one tends to do more matrix math than factor munging.

Please create a *minimal* reproducible example using *just* the Rblpapi
package. It will make it easier for others to help you.


> this should be producing close data for 300 days, yet you will see
> that the
> data only goes back 140.
> 
> Anybody run into this before, should I have expected this?
> 
> Thanks,
> Jon
>


From jongolenbock at gmail.com  Wed Apr  5 15:10:25 2017
From: jongolenbock at gmail.com (Jon Golenbock)
Date: Wed, 5 Apr 2017 09:10:25 -0400
Subject: [R-SIG-Finance] Rblpapi package data limits?
In-Reply-To: <1491397409.23236.5.camel@braverock.com>
References: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>
 <1491397409.23236.5.camel@braverock.com>
Message-ID: <CAE64KYL51++CfzeVqXsrf8U5CGNaey=4Ydruwx_c1j+267oqKQ@mail.gmail.com>

Sorry!

 getBars("NGX7 Comdty",barInterval = 60 *24,startTime =
as.POSIXct('2015-04-01'))

data only goes back to 9/20/16 for me. When I look up the ticker on the
terminal, i get data back to 2/19/2008.

On Wed, Apr 5, 2017 at 9:03 AM, Brian G. Peterson <brian at braverock.com>
wrote:

> On Wed, 2017-04-05 at 08:54 -0400, Jon Golenbock wrote:
> > Hi, I was hoping somebody might be a regular user of this package to
> > interact with Bloomberg terminal. I've been having an issue pulling
> > historical data, it seems to cut off at a seemingly arbitrary point
> > --
> >
> >
> > library(rRblpapi)
> > library(dplyr)
> > library(purrr)
> > library(lubridate)
> > library(magrittr)
> >
> > striplist <- c("NGK7","NGM7", "NGN7","NGQ7", "NGU7","NGV7","NGX7")
> > striplist <- paste(striplist, "Comdty")
> >
> >
> > df <- striplist %>%
> >   map(~ getBars(., barInterval = 60 *24,startTime =
> > floor_date(Sys.time(),"day") - days(300))) %>%
> >   map(~select(., times, close))
> > names(df) <- striplist
>
>
> Many people do not use the 'tidyverse', especially in finance where
> data is often very large and ultimately needs to be a 'wide' time
> series and one tends to do more matrix math than factor munging.
>
> Please create a *minimal* reproducible example using *just* the Rblpapi
> package. It will make it easier for others to help you.
>
>
> > this should be producing close data for 300 days, yet you will see
> > that the
> > data only goes back 140.
> >
> > Anybody run into this before, should I have expected this?
> >
> > Thanks,
> > Jon
> >
>

	[[alternative HTML version deleted]]


From armstrong.whit at gmail.com  Wed Apr  5 15:26:49 2017
From: armstrong.whit at gmail.com (Whit Armstrong)
Date: Wed, 5 Apr 2017 09:26:49 -0400
Subject: [R-SIG-Finance] Rblpapi package data limits?
In-Reply-To: <CAE64KYL51++CfzeVqXsrf8U5CGNaey=4Ydruwx_c1j+267oqKQ@mail.gmail.com>
References: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>
 <1491397409.23236.5.camel@braverock.com>
 <CAE64KYL51++CfzeVqXsrf8U5CGNaey=4Ydruwx_c1j+267oqKQ@mail.gmail.com>
Message-ID: <CAMi=pg5cw5JVMFzYsLtRDiJ3249b2hmo2fmsyURud4Fo0pKcRA@mail.gmail.com>

talk to your rep or helpdesk... you or your employer has paid a lot of
money for that privilege.

as far as I know, they limit bar data to a very short lookback.  if you're
pulling daily data, you can pull the full history, however, you'll have to
use the tickers with two digit years, as the commodity tickers will repeat.
or use the rolling tickers.

-Whit





On Wed, Apr 5, 2017 at 9:10 AM, Jon Golenbock <jongolenbock at gmail.com>
wrote:

> Sorry!
>
>  getBars("NGX7 Comdty",barInterval = 60 *24,startTime =
> as.POSIXct('2015-04-01'))
>
> data only goes back to 9/20/16 for me. When I look up the ticker on the
> terminal, i get data back to 2/19/2008.
>
> On Wed, Apr 5, 2017 at 9:03 AM, Brian G. Peterson <brian at braverock.com>
> wrote:
>
> > On Wed, 2017-04-05 at 08:54 -0400, Jon Golenbock wrote:
> > > Hi, I was hoping somebody might be a regular user of this package to
> > > interact with Bloomberg terminal. I've been having an issue pulling
> > > historical data, it seems to cut off at a seemingly arbitrary point
> > > --
> > >
> > >
> > > library(rRblpapi)
> > > library(dplyr)
> > > library(purrr)
> > > library(lubridate)
> > > library(magrittr)
> > >
> > > striplist <- c("NGK7","NGM7", "NGN7","NGQ7", "NGU7","NGV7","NGX7")
> > > striplist <- paste(striplist, "Comdty")
> > >
> > >
> > > df <- striplist %>%
> > >   map(~ getBars(., barInterval = 60 *24,startTime =
> > > floor_date(Sys.time(),"day") - days(300))) %>%
> > >   map(~select(., times, close))
> > > names(df) <- striplist
> >
> >
> > Many people do not use the 'tidyverse', especially in finance where
> > data is often very large and ultimately needs to be a 'wide' time
> > series and one tends to do more matrix math than factor munging.
> >
> > Please create a *minimal* reproducible example using *just* the Rblpapi
> > package. It will make it easier for others to help you.
> >
> >
> > > this should be producing close data for 300 days, yet you will see
> > > that the
> > > data only goes back 140.
> > >
> > > Anybody run into this before, should I have expected this?
> > >
> > > Thanks,
> > > Jon
> > >
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From chidley.ryan at gmail.com  Wed Apr  5 15:29:46 2017
From: chidley.ryan at gmail.com (chidley.ryan at gmail.com)
Date: Wed, 5 Apr 2017 15:29:46 +0200
Subject: [R-SIG-Finance] Rblpapi package data limits?
In-Reply-To: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>
References: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>
Message-ID: <5453DE43-FDCF-4098-A187-DF225465679D@gmail.com>

bloomberg doesn't store intraday data more than 140 days. the result is the same for any API you use to access the data



Sent from my iPhone

> On Apr 5, 2017, at 14:54, Jon Golenbock <jongolenbock at gmail.com> wrote:
> 
> Hi, I was hoping somebody might be a regular user of this package to
> interact with Bloomberg terminal. I've been having an issue pulling
> historical data, it seems to cut off at a seemingly arbitrary point --
> 
> 
> library(rRblpapi)
> library(dplyr)
> library(purrr)
> library(lubridate)
> library(magrittr)
> 
> striplist <- c("NGK7","NGM7", "NGN7","NGQ7", "NGU7","NGV7","NGX7")
> striplist <- paste(striplist, "Comdty")
> 
> 
> df <- striplist %>%
>  map(~ getBars(., barInterval = 60 *24,startTime =
> floor_date(Sys.time(),"day") - days(300))) %>%
>  map(~select(., times, close))
> names(df) <- striplist
> 
> 
> this should be producing close data for 300 days, yet you will see that the
> data only goes back 140.
> 
> Anybody run into this before, should I have expected this?
> 
> Thanks,
> Jon
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From jongolenbock at gmail.com  Wed Apr  5 15:46:26 2017
From: jongolenbock at gmail.com (Jon Golenbock)
Date: Wed, 5 Apr 2017 09:46:26 -0400
Subject: [R-SIG-Finance] Rblpapi package data limits?
In-Reply-To: <5453DE43-FDCF-4098-A187-DF225465679D@gmail.com>
References: <CAE64KY+zKB89wVAC9kUspnu5N-OjystGQdsNLWRj2hRgTEN8DA@mail.gmail.com>
 <5453DE43-FDCF-4098-A187-DF225465679D@gmail.com>
Message-ID: <CAE64KY+zSFThFKwAc6dZ81DDhJdkchBtr==6qJ8RP3K2RcXbmw@mail.gmail.com>

a-ha. Thank you.

for anyone interested I used bdh to get what I was after --

bdh("NGX7 Comdty", c("Open","High","Low","PX_Last"),start.date = Sys.Date()
- days(300))

On Wed, Apr 5, 2017 at 9:29 AM, <chidley.ryan at gmail.com> wrote:

> bloomberg doesn't store intraday data more than 140 days. the result is
> the same for any API you use to access the data
>
>
>
> Sent from my iPhone
>
> > On Apr 5, 2017, at 14:54, Jon Golenbock <jongolenbock at gmail.com> wrote:
> >
> > Hi, I was hoping somebody might be a regular user of this package to
> > interact with Bloomberg terminal. I've been having an issue pulling
> > historical data, it seems to cut off at a seemingly arbitrary point --
> >
> >
> > library(rRblpapi)
> > library(dplyr)
> > library(purrr)
> > library(lubridate)
> > library(magrittr)
> >
> > striplist <- c("NGK7","NGM7", "NGN7","NGQ7", "NGU7","NGV7","NGX7")
> > striplist <- paste(striplist, "Comdty")
> >
> >
> > df <- striplist %>%
> >  map(~ getBars(., barInterval = 60 *24,startTime =
> > floor_date(Sys.time(),"day") - days(300))) %>%
> >  map(~select(., times, close))
> > names(df) <- striplist
> >
> >
> > this should be producing close data for 300 days, yet you will see that
> the
> > data only goes back 140.
> >
> > Anybody run into this before, should I have expected this?
> >
> > Thanks,
> > Jon
> >
> >    [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From johnsk00 at gmail.com  Thu Apr  6 22:47:24 2017
From: johnsk00 at gmail.com (John Klingensmith)
Date: Thu, 6 Apr 2017 16:47:24 -0400
Subject: [R-SIG-Finance] Moving Limit orders
Message-ID: <CAFLRcn1cac16kMb-usUkPBH6OTRyk7A9Mc+k0NYab4Ru+Tu26A@mail.gmail.com>

Hi,
 I am using the following packages quantstrat, IKTrading, DSTrading, along
with some other misc packages (see code).  I am having trouble
understanding entering moving limits (kind of like trailing stops) to close
the position.

When I enter a long (short) trade, I want a limit to close the position to
equal the moving average of the high (low).  I want the limit price to
equal the current value of the moving average I am targeting - for long
trade: SMA.highMA,  and for short trades: SMA.lowMA

I do plan to enter exit orders and stops, but I have not gotten that far
yet.


Here is my code:

require(quantstrat)
require(IKTrading)
require(DSTrading)
library(xlsx)
library(dygraphs)
library(htmltools)
library(knitr)

options(warn=1)

rm(list=ls(.blotter), envir = .blotter)

initDate = "2000-01-01"
from = "2012-01-01"
to = "2017-02-22"

currency('USD')
Sys.setenv(TZ="UTC")

#get symbols and set symbol currency and multiplyer

symbols <- "SPY"
suppressMessages(getSymbols(symbols, from = from, to = to))

stock(symbols, currency = "USD", multiplyer=1)

#trade sizing and initial equity settings
tradeSize <- 100000
initEq <- tradeSize*length(symbols)


strategy.st <- portfolio.st <- account.st <- "RSI_MR"
rm.strat(portfolio.st)
rm.strat(strategy.st)

initPortf(portfolio.st, symbols=symbols,initDate=initDate,currency="USD")
initAcct(account.st, portfolio = portfolio.st,initDate=initDate,
         currency = "USD",initEq = initEq)
initOrders(portfolio.st,initDate=initDate)
strategy(strategy.st,store=TRUE)

MaxPos <- 1
lvls <- 1

addPosLimit(portfolio=portfolio.st, timestamp=initDate, symbol=symbols,
            maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos,
shortlevels=lvls)

#parameters
nRSI = 3
lowerThreshold = 15
upperThreshold = 85
lowerMinThreshold = 5
upperMaxThreshold = 95
nSMAofRSI = 5
nMaHi = 5
nMaLo = 5

nATR = 14
xATR = 3

##rsi.sma <- SMA(RSI(Cl(SPY),3),5, label = "rsima")

#indicators
add.indicator(strategy.st,name = "RSI",
              arguments = list(price = quote(Cl(mktdata)),n = nRSI),
              label = "rsi")

add.indicator(strategy.st,name = "SMA",
              arguments = list(x = quote(RSI(Cl(SPY),nRSI)), n = nSMAofRSI),
              label = "rsiMA")

add.indicator(strategy.st,name = "SMA",
              arguments = list(x = quote(Hi(mktdata)),n = nMaHi),
              label = "highMA")

add.indicator(strategy.st,name = "SMA",
              arguments = list(x = quote(Lo(mktdata)),n = nMaLo),
              label = "lowMA")

add.indicator(strategy.st, name = "ATR",
              arguments=list(HLC = quote(HLC(mktdata)), n=nATR),
              label = "atr" )
'/
test <- applyIndicators(strategy.st, mktdata = OHLC(SPY))
head(test,10)
'

#Signals

#Enter Long Signal 1
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = lowerThreshold,
                            relationship = "lt", cross=FALSE),
           label = "rsiMAlowerThreshold")

#Enter Long Signal 2
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = lowerMinThreshold,
                            relationship = "gt", cross=FALSE),
           label = "rsiMAlowerMINThreshold")

#Enter Long Signal 1&2
add.signal(strategy.st, name="sigAND",
           arguments=list(columns=c("rsiMAlowerThreshold",
                                    "rsiMAlowerMINThreshold"), cross=TRUE),
           label="longEntry")

#Enter Short Signal 1
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = upperThreshold,
                            relationship = "gt", cross=FALSE),
           label = "rsiMAupperThreshold")

#Enter Short Signal 2
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = upperMaxThreshold,
                            relationship = "lt", cross=FALSE),
           label = "rsiMAmaxThreshold")

#Enter Short Signal 1&2
add.signal(strategy.st, name="sigAND",
           arguments=list(columns=c("rsiMAupperThreshold",
"rsiMAmaxThreshold"),
                          cross=TRUE),
           label="shortEntry")

#Exit Long Signal
add.signal(strategy.st, name = "sigComparison",
           arguments = list(columns = c("High", "highMA"), relationship =
"gt"),
           label = "normalExitLongFilter")

#Exit Short Signal
add.signal(strategy.st, name = "sigComparison",
           arguments = list(columns = c("Low", "lowMA"), relationship =
"lt"),
           label = "normalExitShortFilter")


#Rules
#LONG RULES
add.rule(strategy.st, name="ruleSignal",
         arguments = list(sigcol = "longEntry",
                          sigval = TRUE,
                          orderqty = 1,
                          ordertype = "market",
                          orderside = "long",
                          replace = FALSE,
                          prefer = "Open",
                          osFUN = "osMaxPos",
                          orderset="ocolong"),
         type = "enter", path.dep = TRUE,
         label = "enterLong1")

add.rule(strategy.st, name="ruleSignal",
         arguments=list(sigcol="longEntry",
                        sigval=TRUE,
                        ordertype="limit",
                        orderside="long",
                        replace=FALSE,
                        orderqty='all',
                        prefer = 'SMA.highMA',
                        #threshold = quote('SMA.highMA'),
                        #order.price=quote(mktdata$SMA.lowMA[timestamp]),
                        orderset="ocolong"),
         type="chain",
         parent="enterLong1",
         label="takeProfitLong",
         path.dep=TRUE)



#SHORT RULES
add.rule(strategy.st, name="ruleSignal",
         arguments = list(sigcol = "shortEntry",
                          sigval = TRUE,
                          orderqty = -1,
                          ordertype = "market",
                          orderside = "short",
                          replace = FALSE,
                          prefer = "Open",
                          osFUN = "osMaxPos",
                          orderset="ocoshort"),
         type = "enter", path.dep = TRUE,
         label = "enterShort1")

add.rule(strategy.st, name="ruleSignal",
         arguments=list(sigcol="shortEntry",
                        sigval=TRUE,
                        ordertype="limit",
                        orderside="short",
                        replace=FALSE,
                        orderqty='all',
                        prefer = 'SMA.lowMA',
                        #threshold = quote('SMA.lowMA'),
                        #order.price=quote(mktdata$SMA.lowMA[timestamp]),
                        orderset="ocoshort"),
         type="chain",
         parent="enterShort1",
         label="takeProfitShort",
         path.dep=TRUE)


#apply strategy
t1 <- Sys.time()
out <- applyStrategy(strategy=strategy.st,portfolios=portfolio.st)
t2 <- Sys.time()
print(t2-t1)

#set up analytics
updatePortf(portfolio.st)
dateRange <- time(getPortfolio(portfolio.st)$summary)[-1]
updateAcct(portfolio.st,dateRange)
updateEndEq(account.st)


Any help is appreciated!
Best,
 John

	[[alternative HTML version deleted]]


From syracusepro at verizon.net  Thu Apr  6 23:48:29 2017
From: syracusepro at verizon.net (Victor Montanez)
Date: Thu, 6 Apr 2017 17:48:29 -0400
Subject: [R-SIG-Finance] Moving Limit orders
In-Reply-To: <CAFLRcn1cac16kMb-usUkPBH6OTRyk7A9Mc+k0NYab4Ru+Tu26A@mail.gmail.com>
References: <CAFLRcn1cac16kMb-usUkPBH6OTRyk7A9Mc+k0NYab4Ru+Tu26A@mail.gmail.com>
Message-ID: <001901d2af1f$87a2b500$96e81f00$@verizon.net>

Anyone has a complete system so I can test and play with? Thanks.

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of John Klingensmith
Sent: Thursday, April 06, 2017 4:47 PM
To: r-sig-finance <r-sig-finance at r-project.org>
Subject: [R-SIG-Finance] Moving Limit orders

Hi,
 I am using the following packages quantstrat, IKTrading, DSTrading, along
with some other misc packages (see code).  I am having trouble understanding
entering moving limits (kind of like trailing stops) to close the position.

When I enter a long (short) trade, I want a limit to close the position to
equal the moving average of the high (low).  I want the limit price to equal
the current value of the moving average I am targeting - for long
trade: SMA.highMA,  and for short trades: SMA.lowMA

I do plan to enter exit orders and stops, but I have not gotten that far
yet.


Here is my code:

require(quantstrat)
require(IKTrading)
require(DSTrading)
library(xlsx)
library(dygraphs)
library(htmltools)
library(knitr)

options(warn=1)

rm(list=ls(.blotter), envir = .blotter)

initDate = "2000-01-01"
from = "2012-01-01"
to = "2017-02-22"

currency('USD')
Sys.setenv(TZ="UTC")

#get symbols and set symbol currency and multiplyer

symbols <- "SPY"
suppressMessages(getSymbols(symbols, from = from, to = to))

stock(symbols, currency = "USD", multiplyer=1)

#trade sizing and initial equity settings tradeSize <- 100000 initEq <-
tradeSize*length(symbols)


strategy.st <- portfolio.st <- account.st <- "RSI_MR"
rm.strat(portfolio.st)
rm.strat(strategy.st)

initPortf(portfolio.st, symbols=symbols,initDate=initDate,currency="USD")
initAcct(account.st, portfolio = portfolio.st,initDate=initDate,
         currency = "USD",initEq = initEq)
initOrders(portfolio.st,initDate=initDate)
strategy(strategy.st,store=TRUE)

MaxPos <- 1
lvls <- 1

addPosLimit(portfolio=portfolio.st, timestamp=initDate, symbol=symbols,
            maxpos=MaxPos, longlevels=lvls, minpos=-MaxPos,
shortlevels=lvls)

#parameters
nRSI = 3
lowerThreshold = 15
upperThreshold = 85
lowerMinThreshold = 5
upperMaxThreshold = 95
nSMAofRSI = 5
nMaHi = 5
nMaLo = 5

nATR = 14
xATR = 3

##rsi.sma <- SMA(RSI(Cl(SPY),3),5, label = "rsima")

#indicators
add.indicator(strategy.st,name = "RSI",
              arguments = list(price = quote(Cl(mktdata)),n = nRSI),
              label = "rsi")

add.indicator(strategy.st,name = "SMA",
              arguments = list(x = quote(RSI(Cl(SPY),nRSI)), n = nSMAofRSI),
              label = "rsiMA")

add.indicator(strategy.st,name = "SMA",
              arguments = list(x = quote(Hi(mktdata)),n = nMaHi),
              label = "highMA")

add.indicator(strategy.st,name = "SMA",
              arguments = list(x = quote(Lo(mktdata)),n = nMaLo),
              label = "lowMA")

add.indicator(strategy.st, name = "ATR",
              arguments=list(HLC = quote(HLC(mktdata)), n=nATR),
              label = "atr" )
'/
test <- applyIndicators(strategy.st, mktdata = OHLC(SPY))
head(test,10)
'

#Signals

#Enter Long Signal 1
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = lowerThreshold,
                            relationship = "lt", cross=FALSE),
           label = "rsiMAlowerThreshold")

#Enter Long Signal 2
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = lowerMinThreshold,
                            relationship = "gt", cross=FALSE),
           label = "rsiMAlowerMINThreshold")

#Enter Long Signal 1&2
add.signal(strategy.st, name="sigAND",
           arguments=list(columns=c("rsiMAlowerThreshold",
                                    "rsiMAlowerMINThreshold"), cross=TRUE),
           label="longEntry")

#Enter Short Signal 1
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = upperThreshold,
                            relationship = "gt", cross=FALSE),
           label = "rsiMAupperThreshold")

#Enter Short Signal 2
add.signal(strategy.st, name = "sigThreshold",
           arguments = list(column = "rsiMA", threshold = upperMaxThreshold,
                            relationship = "lt", cross=FALSE),
           label = "rsiMAmaxThreshold")

#Enter Short Signal 1&2
add.signal(strategy.st, name="sigAND",
           arguments=list(columns=c("rsiMAupperThreshold",
"rsiMAmaxThreshold"),
                          cross=TRUE),
           label="shortEntry")

#Exit Long Signal
add.signal(strategy.st, name = "sigComparison",
           arguments = list(columns = c("High", "highMA"), relationship =
"gt"),
           label = "normalExitLongFilter")

#Exit Short Signal
add.signal(strategy.st, name = "sigComparison",
           arguments = list(columns = c("Low", "lowMA"), relationship =
"lt"),
           label = "normalExitShortFilter")


#Rules
#LONG RULES
add.rule(strategy.st, name="ruleSignal",
         arguments = list(sigcol = "longEntry",
                          sigval = TRUE,
                          orderqty = 1,
                          ordertype = "market",
                          orderside = "long",
                          replace = FALSE,
                          prefer = "Open",
                          osFUN = "osMaxPos",
                          orderset="ocolong"),
         type = "enter", path.dep = TRUE,
         label = "enterLong1")

add.rule(strategy.st, name="ruleSignal",
         arguments=list(sigcol="longEntry",
                        sigval=TRUE,
                        ordertype="limit",
                        orderside="long",
                        replace=FALSE,
                        orderqty='all',
                        prefer = 'SMA.highMA',
                        #threshold = quote('SMA.highMA'),
                        #order.price=quote(mktdata$SMA.lowMA[timestamp]),
                        orderset="ocolong"),
         type="chain",
         parent="enterLong1",
         label="takeProfitLong",
         path.dep=TRUE)



#SHORT RULES
add.rule(strategy.st, name="ruleSignal",
         arguments = list(sigcol = "shortEntry",
                          sigval = TRUE,
                          orderqty = -1,
                          ordertype = "market",
                          orderside = "short",
                          replace = FALSE,
                          prefer = "Open",
                          osFUN = "osMaxPos",
                          orderset="ocoshort"),
         type = "enter", path.dep = TRUE,
         label = "enterShort1")

add.rule(strategy.st, name="ruleSignal",
         arguments=list(sigcol="shortEntry",
                        sigval=TRUE,
                        ordertype="limit",
                        orderside="short",
                        replace=FALSE,
                        orderqty='all',
                        prefer = 'SMA.lowMA',
                        #threshold = quote('SMA.lowMA'),
                        #order.price=quote(mktdata$SMA.lowMA[timestamp]),
                        orderset="ocoshort"),
         type="chain",
         parent="enterShort1",
         label="takeProfitShort",
         path.dep=TRUE)


#apply strategy
t1 <- Sys.time()
out <- applyStrategy(strategy=strategy.st,portfolios=portfolio.st)
t2 <- Sys.time()
print(t2-t1)

#set up analytics
updatePortf(portfolio.st)
dateRange <- time(getPortfolio(portfolio.st)$summary)[-1]
updateAcct(portfolio.st,dateRange)
updateEndEq(account.st)


Any help is appreciated!
Best,
 John

	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From jasonhart4 at icloud.com  Fri Apr  7 03:36:25 2017
From: jasonhart4 at icloud.com (Jason Hart)
Date: Fri, 07 Apr 2017 01:36:25 +0000 (GMT)
Subject: [R-SIG-Finance] Performanceanalytics -- table.calendarreturns
	question
Message-ID: <73a7433c-7617-4e4d-a403-c1c8716a2bf7@me.com>

Hello - I'm hoping someone has solved this already but I am trying to run the table.calendarreturns function in performanceanalytics for many funds and then export the data to a csv file (I'm interested in comparing monthly returns between funds). ?The code itself runs fine, it's the presentation in the CSV file that's a problem. ?I'd like to have the output for each fund show up vertically on top of each other in the csv file the exact same way the output shows up in the console after the code is run. ? ?Right now the way the data is exported all the monthly returns for the funds show up in one long horizontal row for each year. ?Evidently I need to add another line or two of code to manipulate the data for export

Thanks for any help!

Here's an example along w/ a sample data template
library(PerformanceAnalytics)
library(timeSeries)
library(fPortfolio)
library(quantmod)
library(caTools)

returns <- read.csv("example.csv")
lct <- Sys.getlocale("LC_TIME"); Sys.setlocale("LC_TIME", "C")
returns[,1] = as.Date(as.character(returns[,1]),format="%d-%b-%y") 
Sys.setlocale("LC_TIME", lct)

returns.saved <- returns ## Saves the data if it needs to be reset later.
start.date <- returns[,1][1] ##Default start date; use this when you want entire data set
TickerListexcel <- colnames(returns[,-1])

#Creating time series object
returns = timeSeries(returns[,-1], charvec = returns[,1])
#colnames(returns) <- abbreviate(colnames(returns),minlength=6)
str(returns)
returns

###CALENDAR RETURNS LOOP FOR MANY FUNDS
# Calendar Tables
cal.list <- list()
for (i in 1:dim(returns)[2]) {
cal.list[[i]] <- table.CalendarReturns(returns[,i], digits=2, as.perc = TRUE)
}
names(cal.list) <- TickerListexcel
write.csv(cal.list,file="Calendar Year Returns.csv")

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170407/3d0a062c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: example.csv
Type: application/vnd.ms-excel
Size: 16334 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170407/3d0a062c/attachment.xlb>

From es at enricoschumann.net  Fri Apr  7 22:42:20 2017
From: es at enricoschumann.net (Enrico Schumann)
Date: Fri, 07 Apr 2017 22:42:20 +0200
Subject: [R-SIG-Finance] Performanceanalytics -- table.calendarreturns
	question
In-Reply-To: <73a7433c-7617-4e4d-a403-c1c8716a2bf7@me.com> (Jason Hart's
 message of "Fri, 07 Apr 2017 01:36:25 +0000 (GMT)")
References: <73a7433c-7617-4e4d-a403-c1c8716a2bf7@me.com>
Message-ID: <87wpaweyqb.fsf@enricoschumann.net>

On Fri, 07 Apr 2017, Jason Hart writes:

> Hello - I'm hoping someone has solved this already but I am trying to run the table.calendarreturns function in
> performanceanalytics for many funds and then export the data to a csv file (I'm interested in comparing monthly
> returns between funds).  The code itself runs fine, it's the presentation in the CSV file that's a problem.  I'd
> like to have the output for each fund show up vertically on top of each other in the csv file the exact same way
> the output shows up in the console after the code is run.    Right now the way the data is exported all the
> monthly returns for the funds show up in one long horizontal row for each year.  Evidently I need to add another
> line or two of code to manipulate the data for export
>
> Thanks for any help!
>
> Here's an example along w/ a sample data template
> library(PerformanceAnalytics)
> library(timeSeries)
> library(fPortfolio)
> library(quantmod)
> library(caTools)
>
> returns <- read.csv("example.csv")
> lct <- Sys.getlocale("LC_TIME"); Sys.setlocale("LC_TIME", "C")
> returns[,1] = as.Date(as.character(returns[,1]),format="%d-%b-%y")
> Sys.setlocale("LC_TIME", lct)
>
> returns.saved <- returns ## Saves the data if it needs to be reset later.
> start.date <- returns[,1][1] ##Default start date; use this when you want entire data set
> TickerListexcel <- colnames(returns[,-1])
>
> #Creating time series object
> returns = timeSeries(returns[,-1], charvec = returns[,1])
> #colnames(returns) <- abbreviate(colnames(returns),minlength=6)
> str(returns)
> returns
>
> ###CALENDAR RETURNS LOOP FOR MANY FUNDS
> # Calendar Tables
> cal.list <- list()
> for (i in 1:dim(returns)[2]) {
> cal.list[[i]] <- table.CalendarReturns(returns[,i], digits=2, as.perc = TRUE)
> }
> names(cal.list) <- TickerListexcel
> write.csv(cal.list,file="Calendar Year Returns.csv")
>

Do you mean the output of print(returns) or of
print(cal.list)?

In either case, if you want to store the results as
they show up in the console, you could use
?capture.output, as in

   capture.output(cal.list, file = "returns.txt")


-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From mwc4120 at hotmail.com  Sat Apr  8 10:58:48 2017
From: mwc4120 at hotmail.com (Michael Chen)
Date: Sat, 8 Apr 2017 08:58:48 +0000
Subject: [R-SIG-Finance] A quick custom data question
Message-ID: <CY4PR14MB1367AFA6E8DD06261F5C0CCFB10F0@CY4PR14MB1367.namprd14.prod.outlook.com>

Hi,


I didn't get a satisfactory answer after searching the archives.  I just like to know how do we access market data other than OHLC? for example:



head(J.DCE)
               Open     High      Low    Close Volume hmmState
2010-01-04 2886.193 2886.193 2811.193 2833.193      0        1
2010-01-05 2886.193 2886.193 2811.193 2833.193      0        1
2010-01-06 2886.193 2886.193 2811.193 2833.193      0        1
2010-01-07 2886.193 2886.193 2811.193 2833.193      0        1
2010-01-08 2886.193 2886.193 2811.193 2833.193      0        1
2010-01-11 2886.193 2886.193 2811.193 2833.193      0        1







In my quantstrat set up,  I simply set up this as an indicator:


add.indicator(strategy.st, name = "getHMM",
              arguments = list(x = quote(getPrice( mktdata, prefer = "hmmState"))),
              label = "HMMState")


getHMM is a simple function I wrote to pass on the data as an indicator, anyhow the error occurs at the getting data part:


> test <- applyIndicators(strategy.st,  OHLC(J.DCE))

[cid:8fd55500-6086-462a-9497-66ddfba6c0e0] Show Traceback

[cid:f10ca1b2-aa9d-4283-afe3-337661d8b54a] Rerun with Debug

Error in getPrice(mktdata, prefer = "hmmState") :
  subscript out of bounds, no price was discernible from the data



The data was converted to an xts for quantstrat.  I am probably making a simple error somewhere, would someone please point it out to me, thanks.   Also, is there a better way to or a more correct way to access custom data easily for quantstrat indicators/signals??


thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170408/1ba52578/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pastedImage.png
Type: image/png
Size: 98 bytes
Desc: pastedImage.png
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170408/1ba52578/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pastedImage.png
Type: image/png
Size: 180 bytes
Desc: pastedImage.png
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170408/1ba52578/attachment-0001.png>

From brian at braverock.com  Sat Apr  8 12:13:04 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Sat, 8 Apr 2017 05:13:04 -0500
Subject: [R-SIG-Finance] A quick custom data question
In-Reply-To: <CY4PR14MB1367AFA6E8DD06261F5C0CCFB10F0@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <CY4PR14MB1367AFA6E8DD06261F5C0CCFB10F0@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <20674fdd-626b-e294-f8f6-5dea62d7b197@braverock.com>

On 04/08/2017 03:58 AM, Michael Chen wrote:
> Hi,
>
>
> I didn't get a satisfactory answer after searching the archives.  I just
> like to know how do we access market data other than OHLC? for example:
>
>
>
> head(J.DCE)                Open     High      Low    Close Volume hmmState
> 2010-01-04 2886.193 2886.193 2811.193 2833.193      0        1
> 2010-01-05 2886.193 2886.193 2811.193 2833.193      0        1
> 2010-01-06 2886.193 2886.193 2811.193 2833.193      0        1
> 2010-01-07 2886.193 2886.193 2811.193 2833.193      0        1
> 2010-01-08 2886.193 2886.193 2811.193 2833.193      0        1
> 2010-01-11 2886.193 2886.193 2811.193 2833.193      0        1
>
>
>
> In my quantstrat set up,  I simply set up this as an indicator:
>
>
> add.indicator(strategy.st, name = "getHMM",
>               arguments = list(x = quote(getPrice( mktdata, prefer =
> "hmmState"))),
>               label = "HMMState")
>
>
> getHMM is a simple function I wrote to pass on the data as an indicator,
> anyhow the error occurs at the getting data part:
>
>
>> test <- applyIndicators(strategy.st, OHLC(J.DCE))
> Show Traceback
> Rerun with Debug
> Error in getPrice(mktdata, prefer = "hmmState") : subscript out of
> bounds, no price was discernible from the data
>
>
> The data was converted to an xts for quantstrat.  I am probably making a
> simple error somewhere, would someone please point it out to me,
> thanks.   Also, is there a better way to or a more correct way to access
> custom data easily for quantstrat indicators/signals??

The list doesn't terribly like HTML posts.

Anyway, it seems likely that your problem is here:

OHLC(J.DCE)

when you call applyIndicators.

You're only passing in the OHLC columns.

just test applyIndicators with

applyIndicators(strategy.st, mktdata=J.DCE)

and getPrice should be able to find your column in your getHMM function.

Even simpler, since the data is already there, and being passed into to 
the apply* functions with the original data is to simply refer to the 
column in whatever other indicator needs it, or in your signal 
functions.  I don't see a need for a custom indicator function at all.

In any case, from your non-reproducible example, and just reading the 
code, the main problem appears to be your call to OHLC(), which will 
strip your other columns.  Skip that, and things should be fine.

Regards,

Brian


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From jongolenbock at gmail.com  Tue Apr 18 16:31:59 2017
From: jongolenbock at gmail.com (Jon Golenbock)
Date: Tue, 18 Apr 2017 10:31:59 -0400
Subject: [R-SIG-Finance] quanstrat exit rules
Message-ID: <CAE64KY+uD2ENhpTJbVRePGTpA3upgS7xURv_ArGdsvkjBeyqnQ@mail.gmail.com>

Hi, trying to get a handle on quantstrat and was hoping somebody could
explain the what I'm doing wrong.

The strategy itself is simple enough (and just for testing purposes - buy
when RSI goes below 30, sell back out when RSI goes above 70.

What is unintended, is that short trades (exit) are processed before long
trades (entry) ever are. Why is this happening?

Also, I was playing around with order sizing - it seems like one should be
able to specify "all" for exit trades, but that doesn't seem to work for me
when I make the substitution in the below code... the issues may be
related, though, so I am putting this on the back burner for now.

Any help appreciated, and thanks in advance.

Jon

----

rm(list=ls(.blotter), envir=.blotter)
rm(list=ls(.strategy), envir=.strategy)
.blotter <- new.env()
.strategy <- new.env()




initEq <- 5000
n <- 14
nSMA <- 200
days_count <- 100
initDate <- Sys.Date()-days(days_count + 1)
.orderqty = 100





symbols <- getSymbols(c("AAPL","QQQ"))


currency("USD")
Sys.setenv(TZ="UTC")
stock(symbols, currency="USD", multiplier=1)

strategy.st <- 'teststrat'
portfolio.st <- 'teststrat'
account.st <- 'teststrat'
initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='USD')
initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
initEq=initEq, currency='USD')
initOrders(portfolio=portfolio.st, initDate=initDate)



strategy(name = strategy.st,
         store = TRUE)







add.indicator(
  strategy = strategy.st,
  name = 'RSI',
  arguments = list(price=quote(Cl(mktdata)),n=n),
  label = "rsi")


add.signal(
  strategy = strategy.st,
  name = 'sigThreshold',
  arguments=list(
    threshold = 30,
    column = "rsi",
    relationship="lt",
    cross = TRUE),
  label = "RSI_long"
)

add.signal(
  strategy = strategy.st,
  name = 'sigThreshold',
  arguments=list(
    threshold = 70,
    column = "rsi",
    relationship="gt",
    cross = TRUE),
  label = "RSI_short"
)



add.rule(
  strategy=strategy.st,
  name='ruleSignal',
  arguments=list(
    sigcol='RSI_long',
    sigval = TRUE,
    orderside = 'long',
    ordertype='market',
    orderqty=.orderqty,
    replace=FALSE
  ),
  type='enter',
  label='Enterlong',
  path.dep = TRUE
)

add.rule(
  strategy=strategy.st,
  name='ruleSignal',
  arguments=list(
    sigcol='RSI_short',
    sigval = TRUE,
    orderside = 'short',
    ordertype='market',
    orderqty=75,
    replace=TRUE
  ),
  type="exit",
  label='Exitlong',
  path.dep = TRUE

)


t1<-Sys.time()
out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
t2<-Sys.time()
print(t2-t1)
get.orderbook(portfolio.st)

	[[alternative HTML version deleted]]


From brian at braverock.com  Tue Apr 18 16:44:46 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 18 Apr 2017 09:44:46 -0500
Subject: [R-SIG-Finance] quanstrat exit rules
In-Reply-To: <CAE64KY+uD2ENhpTJbVRePGTpA3upgS7xURv_ArGdsvkjBeyqnQ@mail.gmail.com>
References: <CAE64KY+uD2ENhpTJbVRePGTpA3upgS7xURv_ArGdsvkjBeyqnQ@mail.gmail.com>
Message-ID: <1492526686.3006.9.camel@braverock.com>

Change side to long in your exit rule.

You're not going short, you're selling a long position.  Those are
different things.  Going short in an equity requires a margin account
and a short locate at least, and will incur interest charges on the
borrow. 

In any case, your strategy is trying to enter long, and then exit your
long position.  Both the entry and exit orders are on the same
side='long' of the market.

See the demo script rsi.R in the demo directory for a long/short
version of the same idea.

The other thing that is likely tripping you up is rule order.  Rules
are evaluated in a specific order, as described in the documentation
for add.rule and other places.  exits are evaluated before entries.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock

On Tue, 2017-04-18 at 10:31 -0400, Jon Golenbock wrote:
> Hi, trying to get a handle on quantstrat and was hoping somebody
> could
> explain the what I'm doing wrong.
> 
> The strategy itself is simple enough (and just for testing purposes -
> buy
> when RSI goes below 30, sell back out when RSI goes above 70.
> 
> What is unintended, is that short trades (exit) are processed before
> long
> trades (entry) ever are. Why is this happening?
> 
> Also, I was playing around with order sizing - it seems like one
> should be
> able to specify "all" for exit trades, but that doesn't seem to work
> for me
> when I make the substitution in the below code... the issues may be
> related, though, so I am putting this on the back burner for now.
> 
> Any help appreciated, and thanks in advance.
> 
> Jon
> 
> ----
> 
> rm(list=ls(.blotter), envir=.blotter)
> rm(list=ls(.strategy), envir=.strategy)
> .blotter <- new.env()
> .strategy <- new.env()
> 
> 
> 
> 
> initEq <- 5000
> n <- 14
> nSMA <- 200
> days_count <- 100
> initDate <- Sys.Date()-days(days_count + 1)
> .orderqty = 100
> 
> 
> 
> 
> 
> symbols <- getSymbols(c("AAPL","QQQ"))
> 
> 
> currency("USD")
> Sys.setenv(TZ="UTC")
> stock(symbols, currency="USD", multiplier=1)
> 
> strategy.st <- 'teststrat'
> portfolio.st <- 'teststrat'
> account.st <- 'teststrat'
> initPortf(portfolio.st, symbols = symbols,
> initDate=initDate,currency='USD')
> initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
> initEq=initEq, currency='USD')
> initOrders(portfolio=portfolio.st, initDate=initDate)
> 
> 
> 
> strategy(name = strategy.st,
> ?????????store = TRUE)
> 
> 
> 
> 
> 
> 
> 
> add.indicator(
> ? strategy = strategy.st,
> ? name = 'RSI',
> ? arguments = list(price=quote(Cl(mktdata)),n=n),
> ? label = "rsi")
> 
> 
> add.signal(
> ? strategy = strategy.st,
> ? name = 'sigThreshold',
> ? arguments=list(
> ????threshold = 30,
> ????column = "rsi",
> ????relationship="lt",
> ????cross = TRUE),
> ? label = "RSI_long"
> )
> 
> add.signal(
> ? strategy = strategy.st,
> ? name = 'sigThreshold',
> ? arguments=list(
> ????threshold = 70,
> ????column = "rsi",
> ????relationship="gt",
> ????cross = TRUE),
> ? label = "RSI_short"
> )
> 
> 
> 
> add.rule(
> ? strategy=strategy.st,
> ? name='ruleSignal',
> ? arguments=list(
> ????sigcol='RSI_long',
> ????sigval = TRUE,
> ????orderside = 'long',
> ????ordertype='market',
> ????orderqty=.orderqty,
> ????replace=FALSE
> ? ),
> ? type='enter',
> ? label='Enterlong',
> ? path.dep = TRUE
> )
> 
> add.rule(
> ? strategy=strategy.st,
> ? name='ruleSignal',
> ? arguments=list(
> ????sigcol='RSI_short',
> ????sigval = TRUE,
> ????orderside = 'short',
> ????ordertype='market',
> ????orderqty=75,
> ????replace=TRUE
> ? ),
> ? type="exit",
> ? label='Exitlong',
> ? path.dep = TRUE
> 
> )
> 
> 
> t1<-Sys.time()
> out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
> t2<-Sys.time()
> print(t2-t1)
> get.orderbook(portfolio.st)
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R
> questions should go.


From sabolkj at gmail.com  Thu Apr 20 19:59:41 2017
From: sabolkj at gmail.com (Keith Sabol)
Date: Thu, 20 Apr 2017 11:59:41 -0600
Subject: [R-SIG-Finance] quantmod getSymbols() failing on Yahoo
Message-ID: <CACOcrKZQBVyRs5DfH7j3TXPT0yxotuH5_r9PGiY67LqM=-FwvA@mail.gmail.com>

I've been using getSymbols() to retrieve data from Yahoo for some time
without difficulty.  Recently, I've been getting this error:

getSymbols("IBM")
Error in download.file(paste(yahoo.URL, "s=", Symbols.name, "&a=", from.m,
 :
  cannot open URL '
http://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv
'


Pasting this url into my browser works as expected:

https://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv


Can someone suggest how I might find/edit the line in the quantmod code
that would enable me to to switch to HTTPS until the package catches up?

Thanks, in advance, for any assistance.

Keith

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Thu Apr 20 20:01:09 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 20 Apr 2017 13:01:09 -0500
Subject: [R-SIG-Finance] quantmod getSymbols() failing on Yahoo
In-Reply-To: <CACOcrKZQBVyRs5DfH7j3TXPT0yxotuH5_r9PGiY67LqM=-FwvA@mail.gmail.com>
References: <CACOcrKZQBVyRs5DfH7j3TXPT0yxotuH5_r9PGiY67LqM=-FwvA@mail.gmail.com>
Message-ID: <CAPPM_gQVKAom9F0G7q0oxjPLEHTzAq2H_BPF2H=-gEWeT_xyFA@mail.gmail.com>

On Thu, Apr 20, 2017 at 12:59 PM, Keith Sabol <sabolkj at gmail.com> wrote:
> I've been using getSymbols() to retrieve data from Yahoo for some time
> without difficulty.  Recently, I've been getting this error:
>
> getSymbols("IBM")
> Error in download.file(paste(yahoo.URL, "s=", Symbols.name, "&a=", from.m,
>  :
>   cannot open URL '
> http://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv
> '
>
>
> Pasting this url into my browser works as expected:
>
> https://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv
>
>
> Can someone suggest how I might find/edit the line in the quantmod code
> that would enable me to to switch to HTTPS until the package catches up?
>
The package caught up yesterday.  You need to upgrade to quantmod 0.4-8 on CRAN.

> Thanks, in advance, for any assistance.
>
> Keith
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From sabolkj at gmail.com  Thu Apr 20 22:57:22 2017
From: sabolkj at gmail.com (Keith Sabol)
Date: Thu, 20 Apr 2017 14:57:22 -0600
Subject: [R-SIG-Finance] quantmod getSymbols() failing on Yahoo
In-Reply-To: <CA+ckjv3jfY=vqGJH=mCDg5o263Qqs7UcOnEaUXYWWO-TXiZGdg@mail.gmail.com>
References: <CACOcrKZQBVyRs5DfH7j3TXPT0yxotuH5_r9PGiY67LqM=-FwvA@mail.gmail.com>
 <CA+ckjv3jfY=vqGJH=mCDg5o263Qqs7UcOnEaUXYWWO-TXiZGdg@mail.gmail.com>
Message-ID: <D453101E-BB7C-4433-9A62-09ABEFCC6681@gmail.com>

Marco,
Updating your version of quantmod, as suggested by Josh, should work. Did for me. 

Keith

> On Apr 20, 2017, at 1:44 PM, Magicaltats Bianchi <marcolondonuk at gmail.com> wrote:
> 
> I have in fact experienced exactly the same identical situation. Don't really understand where the problem is coming from, let alone figuring out what to do to resolve it! Any suggestions welcome. Marco
> 
>> On 20 Apr 2017 7:00 p.m., "Keith Sabol" <sabolkj at gmail.com> wrote:
>> I've been using getSymbols() to retrieve data from Yahoo for some time
>> without difficulty.  Recently, I've been getting this error:
>> 
>> getSymbols("IBM")
>> Error in download.file(paste(yahoo.URL, "s=", Symbols.name, "&a=", from.m,
>>  :
>>   cannot open URL '
>> http://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv
>> '
>> 
>> 
>> Pasting this url into my browser works as expected:
>> 
>> https://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv
>> 
>> 
>> Can someone suggest how I might find/edit the line in the quantmod code
>> that would enable me to to switch to HTTPS until the package catches up?
>> 
>> Thanks, in advance, for any assistance.
>> 
>> Keith
>> 
>>         [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Thu Apr 20 23:03:30 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 20 Apr 2017 16:03:30 -0500
Subject: [R-SIG-Finance] quantmod getSymbols() failing on Yahoo
In-Reply-To: <D453101E-BB7C-4433-9A62-09ABEFCC6681@gmail.com>
References: <CACOcrKZQBVyRs5DfH7j3TXPT0yxotuH5_r9PGiY67LqM=-FwvA@mail.gmail.com>
 <CA+ckjv3jfY=vqGJH=mCDg5o263Qqs7UcOnEaUXYWWO-TXiZGdg@mail.gmail.com>
 <D453101E-BB7C-4433-9A62-09ABEFCC6681@gmail.com>
Message-ID: <CAPPM_gR3wcYg0ZhJ5Bfh8sUk4g0WwaL-J-Y-hOJtBkFXFY4hww@mail.gmail.com>

On Thu, Apr 20, 2017 at 3:57 PM, Keith Sabol <sabolkj at gmail.com> wrote:
> Marco,
> Updating your version of quantmod, as suggested by Josh, should work. Did for me.
>
> Keith
>
>> On Apr 20, 2017, at 1:44 PM, Magicaltats Bianchi <marcolondonuk at gmail.com> wrote:
>>
>> I have in fact experienced exactly the same identical situation. Don't really understand where the problem is coming from, let alone figuring out what to do to resolve it! Any suggestions welcome. Marco

If you're interested in what happened, there are details in the GitHub issue:
https://github.com/joshuaulrich/quantmod/issues/149

>>
>>> On 20 Apr 2017 7:00 p.m., "Keith Sabol" <sabolkj at gmail.com> wrote:
>>> I've been using getSymbols() to retrieve data from Yahoo for some time
>>> without difficulty.  Recently, I've been getting this error:
>>>
>>> getSymbols("IBM")
>>> Error in download.file(paste(yahoo.URL, "s=", Symbols.name, "&a=", from.m,
>>>  :
>>>   cannot open URL '
>>> http://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv
>>> '
>>>
>>>
>>> Pasting this url into my browser works as expected:
>>>
>>> https://ichart.finance.yahoo.com/table.csv?s=IBM&a=0&b=01&c=2007&d=3&e=20&f=2017&g=d&q=q&y=0&z=IBM&x=.csv
>>>
>>>
>>> Can someone suggest how I might find/edit the line in the quantmod code
>>> that would enable me to to switch to HTTPS until the package catches up?
>>>
>>> Thanks, in advance, for any assistance.
>>>
>>> Keith
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions should go.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From lsilvestri at ztsdb.org  Thu Apr 20 23:32:50 2017
From: lsilvestri at ztsdb.org (Leonardo Silvestri)
Date: Thu, 20 Apr 2017 17:32:50 -0400
Subject: [R-SIG-Finance] A time-series DBMS for R users
Message-ID: <6d94b61d-c43b-9350-3c8c-94d4145c2a82@ztsdb.org>

Hi,

I'd like to announce the alpha release of ztsdb, an open-source 
time-series database management system that is very tightly integrated 
with R. It should be well-suited for handling financial time-series 
data, so potentially of interest to some of you.

The query and manipulation language of ztsdb is a subset of R which 
makes it possible to integrate ztsdb seamlessly with R. For example, 
from an R session, given a connection 'c1' to a remote ztsdb instance 
and a time-series 'z' on that remote instance, one can query the 
database from the R command line with unquoted expressions. Here are a 
few examples:

## get z's last 6 observations (translates to an 'xts' time series):
c1 ? tail(z)

## get the 2016 subset of 'z':
c1 ? z[as.interval("+2016-01-01 00:00:00 America/New_York -> 2017-01-01 
00:00:00 America/New_York-"), ]

## get the 2016 median-minute aggregation of 'z' and assign it to 'mm':
mm <- c1 ? { start <- as.time("2016-01-01 12:00:00 America/New_York")
              end <- `+`(start, as.period("1y"), tz="America/New_York")
              s <- seq(from=start, to=end, by=as.duration("00:01:00"))
              align(z, s, method="median") }

It has a coherent and rich representation of date/time with nanosecond 
precision and built-in time-zone awareness.

Additional features include seamless connectivity with other ztsdb 
database instances, continuous/streaming updates and C/C++ fast data 
append operations.

More information can be found here:
- project website: http://www.ztsdb.org/
- release notes: http://www.ztsdb.org/blog/blog-2016-12-30-first.html
- Gitlab ztsdb project page: https://gitlab.com/lsilvest/ztsdb
- Gitlab R package project page: https://gitlab.com/lsilvest/rztsdb
- Docker repo: https://hub.docker.com/r/lsilvest/ztsdb/

Leo


From johnsk00 at gmail.com  Mon Apr 24 19:38:02 2017
From: johnsk00 at gmail.com (John Klingensmith)
Date: Mon, 24 Apr 2017 13:38:02 -0400
Subject: [R-SIG-Finance] Luxor Demo Question
Message-ID: <CAFLRcn1nnJe6wSog3uJYub6DTzLsu0ip0fOe6ASDoTsUOeMWFQ@mail.gmail.com>

Hi,
 Does anyone know the purpose behind why the parameters in the Luxor demo
are preceded by dots?

# optimization range
.FastSMA = (1:30)
.SlowSMA = (20:80)


It seems to make them hidden, which also makes them difficult to remove.
Thanks,
 John

	[[alternative HTML version deleted]]


From brian at braverock.com  Mon Apr 24 20:14:56 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 24 Apr 2017 13:14:56 -0500
Subject: [R-SIG-Finance] Luxor Demo Question
In-Reply-To: <CAFLRcn1nnJe6wSog3uJYub6DTzLsu0ip0fOe6ASDoTsUOeMWFQ@mail.gmail.com>
References: <CAFLRcn1nnJe6wSog3uJYub6DTzLsu0ip0fOe6ASDoTsUOeMWFQ@mail.gmail.com>
Message-ID: <963d2da7-65a5-3ac4-d099-01b8304ef3cb@braverock.com>

On 04/24/2017 12:38 PM, John Klingensmith wrote:
> Hi,
>  Does anyone know the purpose behind why the parameters in the Luxor demo
> are preceded by dots?
>
> # optimization range
> .FastSMA = (1:30)
> .SlowSMA = (20:80)
>
>
> It seems to make them hidden, which also makes them difficult to remove.

They're just named parameters with dots in the name.  They are used in 
the parameter demos.

You can easily see hidden objects with

ls(all=TRUE)

and can remove any named object:

rm(.FastSMA)

with or without a dot.

Regards,

Brian


From johnsk00 at gmail.com  Mon Apr 24 21:46:48 2017
From: johnsk00 at gmail.com (John Klingensmith)
Date: Mon, 24 Apr 2017 15:46:48 -0400
Subject: [R-SIG-Finance] Luxor Demo Question
In-Reply-To: <963d2da7-65a5-3ac4-d099-01b8304ef3cb@braverock.com>
References: <CAFLRcn1nnJe6wSog3uJYub6DTzLsu0ip0fOe6ASDoTsUOeMWFQ@mail.gmail.com>
 <963d2da7-65a5-3ac4-d099-01b8304ef3cb@braverock.com>
Message-ID: <CAFLRcn0W5cf57px2V08MBKWE4MYj6xnkFkdmRNb_ERkv4t2XmA@mail.gmail.com>

Brian,
  Thanks.  So there is no particular reason why they were made as hidden
parameters?

Best,
 John

On Mon, Apr 24, 2017 at 2:14 PM, Brian G. Peterson <brian at braverock.com>
wrote:

> On 04/24/2017 12:38 PM, John Klingensmith wrote:
>
>> Hi,
>>  Does anyone know the purpose behind why the parameters in the Luxor demo
>> are preceded by dots?
>>
>> # optimization range
>> .FastSMA = (1:30)
>> .SlowSMA = (20:80)
>>
>>
>> It seems to make them hidden, which also makes them difficult to remove.
>>
>
> They're just named parameters with dots in the name.  They are used in the
> parameter demos.
>
> You can easily see hidden objects with
>
> ls(all=TRUE)
>
> and can remove any named object:
>
> rm(.FastSMA)
>
> with or without a dot.
>
> Regards,
>
> Brian
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Mon May  1 19:13:44 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 1 May 2017 12:13:44 -0500
Subject: [R-SIG-Finance] R/Finance 2017 Update
Message-ID: <CAPPM_gRbsdWYRed+4==pDUc7NJpbTqxLZZfA=1QVfCFe0oDbBA@mail.gmail.com>

The R/Finance 2017 program is published!

The conference will take place on May 19 and 20, at UIC in Chicago.
Building on the success of the previous conferences in 2009-2016, we
expect more than 250 attendees from around the world. R users from
industry, academia, and government will joining 50 presenters covering
all areas of finance with R.

We are very excited about the two keynote presentations given by Dave
DeMers and Szilard Pafka.  The conference agenda (currently) includes
19 full presentations and 31 shorter "lightning talks".  As in
previous years, several (optional) pre-conference seminars are offered
on Friday morning.

There is also an (optional) conference dinner at the Penthouse
Ballroom and Terrace at the Wyndham Grand Chicago Riverfront.  From
the 39th floor, you can gaze at sweeping views of the downtown skyline
and Chicago River, and continue conversations while dining and
drinking.

Program details and registration information are available at:
  http://www.RinFinance.com/

Please note that registration fees will increase by 50% at the end of
early registration on May 8, 2017 (1 week!).

We would to thank our 2017 Sponsors for the continued support enabling
us to host such an exciting conference:

  UIC Liautaud Master of Science in Finance
  Microsoft

  Interactive Brokers
  RStudio
  William Blair

On behalf of the committee and sponsors, we look forward to seeing you
in Chicago!

  Gib Bassett, Peter Carl, Dirk Eddelbuettel, Brian Peterson, Dale
Rosenthal, Jeffrey Ryan, Joshua Ulrich

-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From roger.bos at rothschild.com  Fri May  5 17:27:56 2017
From: roger.bos at rothschild.com (Bos, Roger)
Date: Fri, 5 May 2017 15:27:56 +0000
Subject: [R-SIG-Finance] Blotter returns question, portfolio vs account
Message-ID: <8cb7d90380ad4479877d9be14de612a1@USNYMMSG001.rth.ad.rothschild.com>

All,

I am looking into calculating portfolio and/or account returns using blotter.  (I am also trying to learn better the difference between portfolios and accounts.)  So I created a simple example pasted below.  I get a portfolio return of 6.9% which matches my manual calculation, but I get an account return of -2.0%, so I asking why that might be?  The table below shows the portfolio returns, the account returns, and account returns I calculated myself and the account returns I calculated myself match pretty closely to the portfolio returns:

> cbind(portfolio_rets, account_rets, account_test)
              IBM.DailyEndEq                e1            End.Eq
1950-01-01                NA                NA                NA
2017-01-03                NA                NA      0.00716868674699
2017-01-04  0.01963852409639  0.00526341880180  0.01238108125628
2017-01-05 -0.00337348192771 -0.01564818890663 -0.00330850771915
2017-01-06  0.00500001204819  0.00840183742261  0.00491998823213
2017-01-09 -0.01132533132530 -0.01624412256496 -0.01108951224615
2017-01-10 -0.01283126506024 -0.00152318430183 -0.01270498106907
2017-01-11  0.01343371084337  0.02660636928014  0.01347266762995
2017-01-12  0.00120480120482 -0.01206680763400  0.00119223248882
2017-01-13 -0.00367470481928 -0.00487363426366 -0.00363203936229
2017-01-17  0.00331327108434  0.00701374936220  0.00328673965069
2017-01-18 -0.00656624096386 -0.00984688664341 -0.00649232239259
2017-01-19  0.00006021084337  0.00667025027784  0.00005992206127
2017-01-20  0.02253015060241  0.02246858690647  0.02242074842540
2017-01-23  0.00289154216867 -0.01920589668888  0.00281440041956
2017-01-24  0.02933731927711  0.02636952850479  0.02847450756285
2017-01-25  0.01439758433735 -0.01451393499485  0.01358726027017
2017-01-26  0.00222898192771 -0.01199589056355  0.00207533240522
2017-01-27 -0.00819277710843 -0.01039858078750 -0.00761222976352
2017-01-27 -0.00000001807229                NA                NA
2017-01-27                NA  0.00826043493841 -0.00000001692047
2017-01-30  0.00000000000000  0.00000001807229  0.00000000000000
2017-01-31  0.00000000000000  0.00000000000000  0.00000000000000


I tried to figure it out discrepancy with AcctReturns by running the code in AcctReturns interactively, but it uses a non-exported function called .getBySymbol, so I got stuck there.


While I am here, I would be happy to get some advice.  If I want to calculate the returns for three strategies, say a small cap fund, mid cap fund, and large cap fund, should I have 3 portfolios in one account or 3 accounts each with one portfolio?  I am leaning towards the latter, but then I am wondering why the difference between portfolio and account?

Thanks,

Roger


require(blotter)
require(FinancialInstrument)
require(quantmod)
rm(.blotter)
if(!exists(".instrument")) .instrument <<- new.env()
if(!exists(".blotter")) .blotter <<- new.env()

currency("USD")
symbols = c("IBM")
for(symbol in symbols){ # establish tradable instruments
  stock(symbol, currency="USD", multiplier=1)
}

getSymbols(symbols, from='2017-01-01', to='2017-01-31', src='yahoo', index.class=c("POSIXt","POSIXct"))

initPortf("p", symbols=symbols, currency="USD")

## Trades must be made in date order.
addTxn(Portfolio = "p", Symbol = "IBM", TxnDate = '2017-01-03', TxnQty = 1, TxnPrice = 166, TxnFees = 00)
addTxn("p", "IBM", '2017-01-27', -1, 177.30, TxnFees = 0)

updatePortf(Portfolio="p",Dates='2017-01')

initAcct(name="a", portfolios="p", initEq=166, currency="USD")
updateAcct("a",'2017-01')
updateEndEq("a",'2017-01')

portfolio_rets <- PortfReturns(Account="a", Dates="2017", Portfolios="p")
Return.cumulative(rets)

account_rets <- AcctReturns(Account="a", Dates="2017", Portfolios="p")
Return.cumulative(arets)

p = getPortfolio("p")
a = getAccount("a")

account_test <- CalculateReturns(a$summary$End.Eq)
cbind(portfolio_rets, account_rets, account_test)




This message and any attachments are for the intended recipient?s use only. This message may contain confidential, proprietary or legally privileged information. No right to confidential or privileged treatment of this message is waived or lost by an error in transmission.
If you have received this message in error, please immediately notify the sender by e-mail, delete the message, any attachments and all copies from your system and destroy any hard copies. You must not, directly or indirectly, use, disclose, distribute, print or copy any part of this message or any attachments if you are not the intended recipient.





From roger.bos at rothschild.com  Fri May  5 19:36:26 2017
From: roger.bos at rothschild.com (Bos, Roger)
Date: Fri, 5 May 2017 17:36:26 +0000
Subject: [R-SIG-Finance] Blotter, how to add account transactions
Message-ID: <0f7770e4e5d04946b905eb1c2a76bb75@USNYMMSG001.rth.ad.rothschild.com>

All,

I have a simple blotter example where I am adding cash, adding a withdrawal, and an interest payment to an account.  It shows up in the account.a object in the .blotter environment, but the actual transactions do not show up in the summary table even after updating the account.  Could anyone point out what I am doing wrong?

$summary
                    Additions Withdrawals Realized.PL Unrealized.PL Interest Gross.Trading.PL
1950-01-01 00:00:00         0           0           0          0.00        0         0.000000
2017-01-03 00:00:00         0           0           0          1.19        0         1.190002
2017-01-03 19:00:00         0           0           0          2.07        0         2.069993
2017-01-04 19:00:00         0           0           0         -0.56        0        -0.559998
2017-01-05 19:00:00         0           0           0          0.83        0         0.830002
2017-01-08 19:00:00         0           0           0         -1.88        0        -1.880005
2017-01-09 19:00:00         0           0           0         -2.13        0        -2.129990
2017-01-10 00:00:00         0           0           4          0.48        0         4.479996
                    Txn.Fees Net.Trading.PL Advisory.Fees Net.Performance End.Eq
1950-01-01 00:00:00        0       0.000000             0        0.000000 166.00
2017-01-03 00:00:00        0       1.190002             0        1.190002 167.19
2017-01-03 19:00:00        0       2.069993             0        2.069993 169.26
2017-01-04 19:00:00        0      -0.559998             0       -0.559998 168.70
2017-01-05 19:00:00        0       0.830002             0        0.830002 169.53
2017-01-08 19:00:00        0      -1.880005             0       -1.880005 167.65
2017-01-09 19:00:00        0      -2.129990             0       -2.129990 165.52
2017-01-10 00:00:00        0       4.479996             0        4.479996 170.00

$Additions
           Additions
1950-01-01         0
2017-01-05      1000

$Withdrawals
           Withdrawals
1950-01-01           0
2017-01-06        1000

$Interest
           Interest
1950-01-01        0
2017-01-07       10

Thanks,

Roger


require(blotter)
require(FinancialInstrument)
require(quantmod)
rm(.blotter)
if(!exists(".instrument")) .instrument <<- new.env()
if(!exists(".blotter")) .blotter <<- new.env()

currency("USD")
symbols = c("IBM")
for(symbol in symbols){ # establish tradable instruments
  stock(symbol, currency="USD", multiplier=1)
}

getSymbols(symbols, from='2017-01-01', to='2017-01-10', src='yahoo', index.class=c("POSIXt","POSIXct"))

initPortf("p", symbols=symbols, currency="USD")

## Trades must be made in date order.
addTxn(Portfolio = "p", Symbol = "IBM", TxnDate = '2017-01-03', TxnQty = 1, TxnPrice = 166, TxnFees = 00)
addTxn("p", "IBM", '2017-01-10', -1, 170, TxnFees = 0)

updatePortf(Portfolio="p",Dates='2017-01')

initAcct(name="a", portfolios="p", initEq=166, currency="USD")

addAcctTxn(Account="a", TxnDate='2017-01-05', TxnType='Additions', Amount=1000)
addAcctTxn(Account="a", TxnDate='2017-01-06', TxnType='Withdrawals', Amount=1000)
addAcctTxn(Account="a", TxnDate='2017-01-07', TxnType='Interest', Amount=10)

updateAcct("a",'2017-01-12')
updateEndEq("a",'2017-01-12')

updateAcct("a")
updateEndEq("a")

getAccount("a")$summary

get("account.a", pos=.blotter)


________________________________

This message and any attachments are for the intended recipient's use only. This message may contain confidential, proprietary or legally privileged information. No right to confidential or privileged treatment of this message is waived or lost by an error in transmission.
If you have received this message in error, please immediately notify the sender by e-mail, delete the message, any attachments and all copies from your system and destroy any hard copies. You must not, directly or indirectly, use, disclose, distribute, print or copy any part of this message or any attachments if you are not the intended recipient.

________________________________

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Fri May  5 22:09:45 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 5 May 2017 15:09:45 -0500
Subject: [R-SIG-Finance] R/Finance 2017 Update
In-Reply-To: <CAPPM_gRbsdWYRed+4==pDUc7NJpbTqxLZZfA=1QVfCFe0oDbBA@mail.gmail.com>
References: <CAPPM_gRbsdWYRed+4==pDUc7NJpbTqxLZZfA=1QVfCFe0oDbBA@mail.gmail.com>
Message-ID: <CAPPM_gTq+cTpCfo+s9jFHfPk7YJAZK9Qg40VP3dTBqBgjkMeEw@mail.gmail.com>

Quick reminder that prices increase 50% on Monday!

On Mon, May 1, 2017 at 12:13 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> The R/Finance 2017 program is published!
>
> The conference will take place on May 19 and 20, at UIC in Chicago.
> Building on the success of the previous conferences in 2009-2016, we
> expect more than 250 attendees from around the world. R users from
> industry, academia, and government will joining 50 presenters covering
> all areas of finance with R.
>
> We are very excited about the two keynote presentations given by Dave
> DeMers and Szilard Pafka.  The conference agenda (currently) includes
> 19 full presentations and 31 shorter "lightning talks".  As in
> previous years, several (optional) pre-conference seminars are offered
> on Friday morning.
>
> There is also an (optional) conference dinner at the Penthouse
> Ballroom and Terrace at the Wyndham Grand Chicago Riverfront.  From
> the 39th floor, you can gaze at sweeping views of the downtown skyline
> and Chicago River, and continue conversations while dining and
> drinking.
>
> Program details and registration information are available at:
>   http://www.RinFinance.com/
>
> Please note that registration fees will increase by 50% at the end of
> early registration on May 8, 2017 (1 week!).
>
> We would to thank our 2017 Sponsors for the continued support enabling
> us to host such an exciting conference:
>
>   UIC Liautaud Master of Science in Finance
>   Microsoft
>
>   Interactive Brokers
>   RStudio
>   William Blair
>
> On behalf of the committee and sponsors, we look forward to seeing you
> in Chicago!
>
>   Gib Bassett, Peter Carl, Dirk Eddelbuettel, Brian Peterson, Dale
> Rosenthal, Jeffrey Ryan, Joshua Ulrich
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Tue May  9 22:55:42 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 9 May 2017 15:55:42 -0500
Subject: [R-SIG-Finance] R/Finance 2017 Update
In-Reply-To: <CAPPM_gTq+cTpCfo+s9jFHfPk7YJAZK9Qg40VP3dTBqBgjkMeEw@mail.gmail.com>
References: <CAPPM_gRbsdWYRed+4==pDUc7NJpbTqxLZZfA=1QVfCFe0oDbBA@mail.gmail.com>
 <CAPPM_gTq+cTpCfo+s9jFHfPk7YJAZK9Qg40VP3dTBqBgjkMeEw@mail.gmail.com>
Message-ID: <CAPPM_gSj2pww+N0V_JK3YLx8tK5HC81Bin0iPjFzwp7xRXOOig@mail.gmail.com>

Last reminder.  Early-bird registration ends tonight!

On Fri, May 5, 2017 at 3:09 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> Quick reminder that prices increase 50% on Monday!
>
> On Mon, May 1, 2017 at 12:13 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>> The R/Finance 2017 program is published!
>>
>> The conference will take place on May 19 and 20, at UIC in Chicago.
>> Building on the success of the previous conferences in 2009-2016, we
>> expect more than 250 attendees from around the world. R users from
>> industry, academia, and government will joining 50 presenters covering
>> all areas of finance with R.
>>
>> We are very excited about the two keynote presentations given by Dave
>> DeMers and Szilard Pafka.  The conference agenda (currently) includes
>> 19 full presentations and 31 shorter "lightning talks".  As in
>> previous years, several (optional) pre-conference seminars are offered
>> on Friday morning.
>>
>> There is also an (optional) conference dinner at the Penthouse
>> Ballroom and Terrace at the Wyndham Grand Chicago Riverfront.  From
>> the 39th floor, you can gaze at sweeping views of the downtown skyline
>> and Chicago River, and continue conversations while dining and
>> drinking.
>>
>> Program details and registration information are available at:
>>   http://www.RinFinance.com/
>>
>> Please note that registration fees will increase by 50% at the end of
>> early registration on May 8, 2017 (1 week!).
>>
>> We would to thank our 2017 Sponsors for the continued support enabling
>> us to host such an exciting conference:
>>
>>   UIC Liautaud Master of Science in Finance
>>   Microsoft
>>
>>   Interactive Brokers
>>   RStudio
>>   William Blair
>>
>> On behalf of the committee and sponsors, we look forward to seeing you
>> in Chicago!
>>
>>   Gib Bassett, Peter Carl, Dirk Eddelbuettel, Brian Peterson, Dale
>> Rosenthal, Jeffrey Ryan, Joshua Ulrich
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com
>> R/Finance 2017 | www.rinfinance.com
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From rbrianaaron at hotmail.com  Wed May 10 18:02:46 2017
From: rbrianaaron at hotmail.com (Brian Aaron)
Date: Wed, 10 May 2017 16:02:46 +0000
Subject: [R-SIG-Finance] Account object not updating. Ending Equity remains
	the same.
Message-ID: <DM5PR01MB23292B745E83142D2C2D24D6B8EC0@DM5PR01MB2329.prod.exchangelabs.com>

I am trying to implement a simple moving average strategy with rebalancing.

I have tried to follow the Guy Yollin tutorial as closely as possible.


I run the CheckBlotterUpdate function and get:


"portfolio P&L doesn't match account P&L"


A review of the ending equity in the account object shows that it has not been updated.


Codes is below.


Thank you for any feedback.


Brian Aaron

library(quantstrat)
library(blotter)

startdate <- "1995-08-18"
enddate <- "1999-01-01"
initDate <- "1995-08-17"

symbols <- c('SPY', 'MDY')

getSymbols(symbols,
           src="yahoo",
           from=startdate,
           to=enddate,
           index.class=c("POSIXt","POSIXct"),
           adjust=TRUE)


#Initial equity
initEq <- 1000000

currency("USD")
Sys.setenv(TZ="UTC")
stock(primary_id= symbols, currency="USD", multiplier=1)

strategy("simplemoving", store=TRUE)

add.indicator(strategy = "simplemoving",
              name = "SMA",
              arguments = list(x=quote(Cl(mktdata)),
                               n=50),
              label='firstsma')

add.indicator(strategy = "simplemoving",
              name = "SMA",
              arguments = list(x=quote(Cl(mktdata)),
                               n=200),
              label="secondsma")

#Add Buying Signal
add.signal(strategy="simplemoving",
           name="sigCrossover",
           arguments=list(columns=c("firstsma","secondsma"),
                          relationship="gt"),
           label="buysignal")

#Add Selling Signal
add.signal(strategy="simplemoving",
           name="sigCrossover",
           arguments=list(columns=c("firstsma","secondsma"),
                          relationship="lt"),
           label="sellsignal")

#Add Enter Rule
add.rule(strategy="simplemoving",
         name='ruleSignal',
         arguments=list(sigcol="buysignal",
                        sigval=TRUE,
                        orderqty=100000,
                        ordertype='market',
                        orderside='long',
                        osFUN='osMaxPos'),
         type='enter',
         path.dep=TRUE)

#Add Exit Rule
add.rule(strategy="simplemoving",
         name='ruleSignal',
         arguments=list(sigcol="sellsignal",
                        sigval=TRUE,
                        orderqty='all',
                        ordertype='market',
                        orderside='long',
                        pricemethod="market"),
         type='exit',
         path.dep=TRUE)

# add rebalancing
add.rule('simplemoving', 'rulePctEquity',
         arguments=list(rebalance_on='months',
                        trade.percent=1/length(symbols),
                        refprice=quote(
                            last(getPrice(mktdata)[paste('::',as.character(curIndex),sep='')][,1])
                        ),
                        digits=0
         ),
         type='rebalance',
         label='rebalance'
)

rm.strat(name="multisimplemoving")

initPortf(name="multisimplemoving",
          symbols = symbols,
          initDate=initDate)
initAcct(name="multisimplemoving",
         portfolios="multisimplemoving",
         initDate=initDate,
         initEq=initEq)
initOrders(portfolio="multisimplemoving",
           initDate=initDate)

#Add position limits
posval <- initEq/length(symbols)

for(symbol in symbols){
    pos<-round((posval/first(getPrice(get(symbol)))),-2)
    addPosLimit('multisimplemoving',symbol,initDate, maxpos=pos,minpos=-pos)
}

out <- applyStrategy.rebalancing(strategy='simplemoving',
                                 portfolios='multisimplemoving')

source("checkBlotterUpdate.R")
checkBlotterUpdate('multisimplemoving', 'multisimplemoving')

#Strategy Equity Curve
acct <- getAccount(Account="multisimplemoving")
print(acct$summary)





	[[alternative HTML version deleted]]


From roger.bos at rothschild.com  Thu May 11 22:24:32 2017
From: roger.bos at rothschild.com (Bos, Roger)
Date: Thu, 11 May 2017 20:24:32 +0000
Subject: [R-SIG-Finance] Account object not updating. Ending Equity
 remains	the same.
In-Reply-To: <DM5PR01MB23292B745E83142D2C2D24D6B8EC0@DM5PR01MB2329.prod.exchangelabs.com>
References: <DM5PR01MB23292B745E83142D2C2D24D6B8EC0@DM5PR01MB2329.prod.exchangelabs.com>
Message-ID: <b3ee096aa467493381184e52ac5fd950@USNYMMSG001.rth.ad.rothschild.com>

Brian,

Almost there, you just need to update the portfolio, account, and ending equity after you apply the strategy.  You code works fine after you add those lines as shown below:

out <- applyStrategy.rebalancing(strategy='simplemoving',
  portfolios='multisimplemoving')

# START NEW CODE
#update
tradeStrategy="multisimplemoving"
updatePortf(tradeStrategy)
updateAcct(tradeStrategy)
updateEndEq(tradeStrategy)
#END NEW CODE

source("checkBlotterUpdate.R")
checkBlotterUpdate('multisimplemoving', 'multisimplemoving')


Thanks,

Roger


-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf Of Brian Aaron
Sent: Wednesday, May 10, 2017 12:03 PM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] Account object not updating. Ending Equity remains the same.

I am trying to implement a simple moving average strategy with rebalancing.

I have tried to follow the Guy Yollin tutorial as closely as possible.


I run the CheckBlotterUpdate function and get:


"portfolio P&L doesn't match account P&L"


A review of the ending equity in the account object shows that it has not been updated.


Codes is below.


Thank you for any feedback.


Brian Aaron

library(quantstrat)
library(blotter)

startdate <- "1995-08-18"
enddate <- "1999-01-01"
initDate <- "1995-08-17"

symbols <- c('SPY', 'MDY')

getSymbols(symbols,
           src="yahoo",
           from=startdate,
           to=enddate,
           index.class=c("POSIXt","POSIXct"),
           adjust=TRUE)


#Initial equity
initEq <- 1000000

currency("USD")
Sys.setenv(TZ="UTC")
stock(primary_id= symbols, currency="USD", multiplier=1)

strategy("simplemoving", store=TRUE)

add.indicator(strategy = "simplemoving",
              name = "SMA",
              arguments = list(x=quote(Cl(mktdata)),
                               n=50),
              label='firstsma')

add.indicator(strategy = "simplemoving",
              name = "SMA",
              arguments = list(x=quote(Cl(mktdata)),
                               n=200),
              label="secondsma")

#Add Buying Signal
add.signal(strategy="simplemoving",
           name="sigCrossover",
           arguments=list(columns=c("firstsma","secondsma"),
                          relationship="gt"),
           label="buysignal")

#Add Selling Signal
add.signal(strategy="simplemoving",
           name="sigCrossover",
           arguments=list(columns=c("firstsma","secondsma"),
                          relationship="lt"),
           label="sellsignal")

#Add Enter Rule
add.rule(strategy="simplemoving",
         name='ruleSignal',
         arguments=list(sigcol="buysignal",
                        sigval=TRUE,
                        orderqty=100000,
                        ordertype='market',
                        orderside='long',
                        osFUN='osMaxPos'),
         type='enter',
         path.dep=TRUE)

#Add Exit Rule
add.rule(strategy="simplemoving",
         name='ruleSignal',
         arguments=list(sigcol="sellsignal",
                        sigval=TRUE,
                        orderqty='all',
                        ordertype='market',
                        orderside='long',
                        pricemethod="market"),
         type='exit',
         path.dep=TRUE)

# add rebalancing
add.rule('simplemoving', 'rulePctEquity',
         arguments=list(rebalance_on='months',
                        trade.percent=1/length(symbols),
                        refprice=quote(
                            last(getPrice(mktdata)[paste('::',as.character(curIndex),sep='')][,1])
                        ),
                        digits=0
         ),
         type='rebalance',
         label='rebalance'
)

rm.strat(name="multisimplemoving")

initPortf(name="multisimplemoving",
          symbols = symbols,
          initDate=initDate)
initAcct(name="multisimplemoving",
         portfolios="multisimplemoving",
         initDate=initDate,
         initEq=initEq)
initOrders(portfolio="multisimplemoving",
           initDate=initDate)

#Add position limits
posval <- initEq/length(symbols)

for(symbol in symbols){
    pos<-round((posval/first(getPrice(get(symbol)))),-2)
    addPosLimit('multisimplemoving',symbol,initDate, maxpos=pos,minpos=-pos) }

out <- applyStrategy.rebalancing(strategy='simplemoving',
                                 portfolios='multisimplemoving')

source("checkBlotterUpdate.R")
checkBlotterUpdate('multisimplemoving', 'multisimplemoving')

#Strategy Equity Curve
acct <- getAccount(Account="multisimplemoving")
print(acct$summary)





[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.



This message and any attachments are for the intended recipient?s use only. This message may contain confidential, proprietary or legally privileged information. No right to confidential or privileged treatment of this message is waived or lost by an error in transmission.
If you have received this message in error, please immediately notify the sender by e-mail, delete the message, any attachments and all copies from your system and destroy any hard copies. You must not, directly or indirectly, use, disclose, distribute, print or copy any part of this message or any attachments if you are not the intended recipient.





From monicaphang.mp at gmail.com  Fri May 12 04:57:22 2017
From: monicaphang.mp at gmail.com (Monica Phang)
Date: Fri, 12 May 2017 10:57:22 +0800
Subject: [R-SIG-Finance] "Creditr" package: spread to upfront conversions
Message-ID: <CAGyNbqFHfcX8bP8k-qyY=hf=hGf8CsEJDbQM-PG=7JxBfdyNWg@mail.gmail.com>

Dear all,

I have a question regarding the creditr package.

If I input spread at *2000* use spread_to_upfront then the
upfront_to_spread function, the output is a spread of *1962.592*, not a
spread of 2000 as initially inputted. Why is that the case?

Please see the code below.

x <- data.table(date = as.Date("2014-04-22"),
                currency = "USD",
                tenor = 6,
                spread = *2000*,
                coupon = 500,
                recovery = 0.4,
                stringsAsFactors = FALSE
                )

a <- spread_to_upfront(x)

b <- data.table(date = as.Date("2014-04-22"),
                currency = "USD",
                tenor = 6,
                ptsUpfront = a / 1e+07,
                coupon = 500,
                recovery = 0.4,
                stringsAsFactors = FALSE
                )

upfront_to_spread(b)

[1] *1962.592*     #Does not equal the original spread of 2000

	[[alternative HTML version deleted]]


From oskar.gottlieb at lenzglobal.com  Fri May 12 10:58:38 2017
From: oskar.gottlieb at lenzglobal.com (Oskar Gottlieb)
Date: Fri, 12 May 2017 10:58:38 +0200
Subject: [R-SIG-Finance] Quantstrat - extracting current symbol
Message-ID: <CAPwqZwC-pP5CnOjeohxMxfkKoSY2T0QDRFVF4JY5pb1ot5v6Ww@mail.gmail.com>

Hi,

I have multiple symbols (futures contracts) of one product and I would like
to access a data frame with their meta information. I would then parse the
meta info into an add.indicator argument list. Is there a function, which
would return the current symbol over which we are looping?

Thanks!
Oskar

	[[alternative HTML version deleted]]


From brian at braverock.com  Fri May 12 11:16:38 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 12 May 2017 04:16:38 -0500
Subject: [R-SIG-Finance] Quantstrat - extracting current symbol
In-Reply-To: <CAPwqZwC-pP5CnOjeohxMxfkKoSY2T0QDRFVF4JY5pb1ot5v6Ww@mail.gmail.com>
References: <CAPwqZwC-pP5CnOjeohxMxfkKoSY2T0QDRFVF4JY5pb1ot5v6Ww@mail.gmail.com>
Message-ID: <e3128131-693f-1afa-b118-409aef8aebca@braverock.com>

On 05/12/2017 03:58 AM, Oskar Gottlieb wrote:
> I have multiple symbols (futures contracts) of one product and I would like
> to access a data frame with their meta information. I would then parse the
> meta info into an add.indicator argument list. Is there a function, which
> would return the current symbol over which we are looping?

quantstrat would expect the metadata for these symbols to be in 
FinancialInstrument, not in a data.frame.  That is where quantstrat and 
blotter expect to get things like tick size, multiplier, expiration 
date, and currency for each instrument.

Inside quantstrat, there will always be a 'symbol' variable which you 
could access to find out what symbol is currently being processed 
(unless we're in a rebalancing rule, when that doesn't apply).

What I would recommend is to put all your instrument metadata in 
FinancialInstrument (since that is what it is for) and have your 
indicator and signal functions access that data with

getInstrument(symbol)

To further guess at what you're trying to do, you talk about using this 
list for add.indicator.  I don't understand what you're trying to do 
with that statement.  The strategy object is a specification of how the 
strategy will work.  The indicators, signals, and rules should all work 
on the mktdata passed to them by the applyStrategy function (and inside 
that by applyIndicators, applySignals, applyRules).  So any call to 
add.indicator should be generic for the entire strategy specification.

If you wanted an indicator to do something different based on tenor or 
days to expiration, for example, you'd handle that inside the indicator 
function, not as parameters to the call to add.indicator. (probably 
after calling getInstrument to get the metadata, as described above).

If this hasn't answered your question, perhaps you could follow up with 
something more specific including a *minimal* example.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From oskar.gottlieb at lenzglobal.com  Fri May 12 12:07:25 2017
From: oskar.gottlieb at lenzglobal.com (Oskar Gottlieb)
Date: Fri, 12 May 2017 12:07:25 +0200
Subject: [R-SIG-Finance] Quantstrat - extracting current symbol
In-Reply-To: <e3128131-693f-1afa-b118-409aef8aebca@braverock.com>
References: <CAPwqZwC-pP5CnOjeohxMxfkKoSY2T0QDRFVF4JY5pb1ot5v6Ww@mail.gmail.com>
 <e3128131-693f-1afa-b118-409aef8aebca@braverock.com>
Message-ID: <CAPwqZwAWnPWKUFJ-Eo0zZpXf+fkqkA2A8zKM28=1_8RL9Af0Lw@mail.gmail.com>

Hi Brian,

Thanks for the quick reply!
I was aware of the instrument objects, I just did not know there were the
instrument_attr(), instrument.table() functions. This solves the need for
external meta info dataframe, which is extremely convinient.
The best way to get the attribute then, would be to call
'getInstrument(symbol)$newAttribute'?

About add.indicator - I did a poor job explaining what I was trying to
achieve, but it's exactly what you're saying. I will create a new indicator
function, which will get some metadata from the instrument and all of that
will be handled inside the indicator function, there is no need to pass it
as a parameter to the add.indicator function.

Thanks again!
Oskar

2017-05-12 11:16 GMT+02:00 Brian G. Peterson <brian at braverock.com>:

> On 05/12/2017 03:58 AM, Oskar Gottlieb wrote:
>
>> I have multiple symbols (futures contracts) of one product and I would
>> like
>> to access a data frame with their meta information. I would then parse the
>> meta info into an add.indicator argument list. Is there a function, which
>> would return the current symbol over which we are looping?
>>
>
> quantstrat would expect the metadata for these symbols to be in
> FinancialInstrument, not in a data.frame.  That is where quantstrat and
> blotter expect to get things like tick size, multiplier, expiration date,
> and currency for each instrument.
>
> Inside quantstrat, there will always be a 'symbol' variable which you
> could access to find out what symbol is currently being processed (unless
> we're in a rebalancing rule, when that doesn't apply).
>
> What I would recommend is to put all your instrument metadata in
> FinancialInstrument (since that is what it is for) and have your indicator
> and signal functions access that data with
>
> getInstrument(symbol)
>
> To further guess at what you're trying to do, you talk about using this
> list for add.indicator.  I don't understand what you're trying to do with
> that statement.  The strategy object is a specification of how the strategy
> will work.  The indicators, signals, and rules should all work on the
> mktdata passed to them by the applyStrategy function (and inside that by
> applyIndicators, applySignals, applyRules).  So any call to add.indicator
> should be generic for the entire strategy specification.
>
> If you wanted an indicator to do something different based on tenor or
> days to expiration, for example, you'd handle that inside the indicator
> function, not as parameters to the call to add.indicator. (probably after
> calling getInstrument to get the metadata, as described above).
>
> If this hasn't answered your question, perhaps you could follow up with
> something more specific including a *minimal* example.
>
> Regards,
>
> Brian
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From brian at braverock.com  Fri May 12 13:35:21 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 12 May 2017 06:35:21 -0500
Subject: [R-SIG-Finance] Quantstrat - extracting current symbol
In-Reply-To: <CAPwqZwAWnPWKUFJ-Eo0zZpXf+fkqkA2A8zKM28=1_8RL9Af0Lw@mail.gmail.com>
References: <CAPwqZwC-pP5CnOjeohxMxfkKoSY2T0QDRFVF4JY5pb1ot5v6Ww@mail.gmail.com>
 <e3128131-693f-1afa-b118-409aef8aebca@braverock.com>
 <CAPwqZwAWnPWKUFJ-Eo0zZpXf+fkqkA2A8zKM28=1_8RL9Af0Lw@mail.gmail.com>
Message-ID: <1494588921.9466.8.camel@braverock.com>

You asked:

> The best way to get the attribute then, would be to call
> 'getInstrument(symbol)$newAttribute'?

Yes.

Here's an example:

###

getInstrument('ESH8')

# primary_id????????:"ES_H8"
# currency??????????:"USD"
# multiplier????????:50
# tick_size?????????:0.25
# identifiers???????:List of 2
#?..$ X.RIC:"ESH8"
#?..$ local:"ESH8"
# type??????????????:"future_series" "future"
# root_id???????????:"ES"
# suffix_id?????????:"H8"
# expires???????????:"2018-03-16"
# exchange??????????:"GLOBEX"
# underlying_id?????:"ES"
# exchange_id???????:"ES"
# series_description:"E-mini S&P 500 2018-03"
#?timeZoneId????????:"CTT"
#?tradingHours??????:"T15:30:00/T16:30:00" "T17:00:00/T15:15:00"
#?liquidHours???????:"T08:30:00/T15:15:00"
#?primary_start?????:"08:30:00"
#?primary_end???????:"15:15:00"
#?electronic_start??:"15:30:00"
#?electronic_end????:"16:30:00"
#?validExchanges????:"GLOBEX" "MIBSX"
#?updated???????????: POSIXct, format: "2012-02-27 15:26:53.52408"
#?contract_month????:"2018-03"

getInstrument('ESH8')$tick_size
#? [1] 0.25

###

So the method you ask about works just fine.  If you're going to be
extracting multiple attributes, it would make sense to call
getInstrument only once to minimize the search time (we have many
thousands of instruments in our instrument environment) and then take
the attributes you want out of your local copy.

Regards,

Brian

On Fri, 2017-05-12 at 12:07 +0200, Oskar Gottlieb wrote:
> Hi Brian,
> 
> Thanks for the quick reply!
> I was aware of the instrument objects, I just did not know there were
> the instrument_attr(), instrument.table() functions. This solves the
> need for external meta info dataframe, which is extremely convinient.
> The best way to get the attribute then, would be to call
> 'getInstrument(symbol)$newAttribute'?
> 
> About add.indicator - I did a poor job explaining what I was trying
> to achieve, but it's exactly what you're saying. I will create a new
> indicator function, which will get some metadata from the instrument
> and all of that will be handled inside the indicator function, there
> is no need to pass it as a parameter to the add.indicator function.
> 
> Thanks again!
> Oskar
> 
> 2017-05-12 11:16 GMT+02:00 Brian G. Peterson <brian at braverock.com>:
> 
> > On 05/12/2017 03:58 AM, Oskar Gottlieb wrote:
> > 
> > > I have multiple symbols (futures contracts) of one product and I would
> > > like
> > > to access a data frame with their meta information. I would then parse the
> > > meta info into an add.indicator argument list. Is there a function, which
> > > would return the current symbol over which we are looping?
> > > 
> > 
> > quantstrat would expect the metadata for these symbols to be in
> > FinancialInstrument, not in a data.frame.??That is where quantstrat and
> > blotter expect to get things like tick size, multiplier, expiration date,
> > and currency for each instrument.
> > 
> > Inside quantstrat, there will always be a 'symbol' variable which you
> > could access to find out what symbol is currently being processed (unless
> > we're in a rebalancing rule, when that doesn't apply).
> > 
> > What I would recommend is to put all your instrument metadata in
> > FinancialInstrument (since that is what it is for) and have your indicator
> > and signal functions access that data with
> > 
> > getInstrument(symbol)
> > 
> > To further guess at what you're trying to do, you talk about using this
> > list for add.indicator.??I don't understand what you're trying to do with
> > that statement.??The strategy object is a specification of how the strategy
> > will work.??The indicators, signals, and rules should all work on the
> > mktdata passed to them by the applyStrategy function (and inside that by
> > applyIndicators, applySignals, applyRules).??So any call to add.indicator
> > should be generic for the entire strategy specification.
> > 
> > If you wanted an indicator to do something different based on tenor or
> > days to expiration, for example, you'd handle that inside the indicator
> > function, not as parameters to the call to add.indicator. (probably after
> > calling getInstrument to get the metadata, as described above).
> > 
> > If this hasn't answered your question, perhaps you could follow up with
> > something more specific including a *minimal* example.
> > 
> > Regards,
> > 
> > Brian
> > 
> > --
> > Brian G. Peterson
> > http://braverock.com/brian/
> > Ph: 773-459-4973
> > IM: bgpbraverock
> > 
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> > should go.
> > 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R
> questions should go.


From rsherry8 at comcast.net  Fri May 12 18:34:31 2017
From: rsherry8 at comcast.net (Robert Sherry)
Date: Fri, 12 May 2017 12:34:31 -0400
Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
Message-ID: <4d4c7e8d-4494-6558-cf97-0a040bbd012e@comcast.net>

I executed the following commands in R:

     library(quantmod)
     optData = getOptionChain( "XOM", Exp=NULL )
     nrow(optData)

The last command returned NULL. What am I doing wrong?

Bob


From frankm60606 at gmail.com  Fri May 12 20:02:07 2017
From: frankm60606 at gmail.com (Frank)
Date: Fri, 12 May 2017 13:02:07 -0500
Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
In-Reply-To: <4d4c7e8d-4494-6558-cf97-0a040bbd012e@comcast.net>
References: <4d4c7e8d-4494-6558-cf97-0a040bbd012e@comcast.net>
Message-ID: <000001d2cb49$defe8900$9cfb9b00$@gmail.com>

It looks like some of the dependencies don't load automatically. I was using
R x64 3.2.2:

1) Updated my R to the later version
2) I installed package jsonlite  ("package:"jsonlite"cannot be loaded.")
3) I installed package curl ("Error: Required package curl not found. Please
run: install.packages('curl')"
4) I updated to R x64 3.2.5 then R x64 3.3.3 re-installed the above.

I now get

" Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
bid,  : 
  object 'contractsymbol' not found"

The complete output is now:

" 
version 3.3.3 (2017-03-06) -- "Another Canoe"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

>      library(quantmod)
Loading required package: xts
Loading required package: zoo

Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric

Loading required package: TTR
Version 0.4-0 included new data defaults. See ?getSymbols.
>      optData = getOptionChain( "XOM", Exp=NULL )
Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
bid,  : 
  object 'contractsymbol' not found
Calls: getOptionChain ... <Anonymous> -> with -> with.default -> eval ->
eval -> data.frame
Execution halted


-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of Robert Sherry
Sent: Friday, May 12, 2017 11:35 AM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R

I executed the following commands in R:

     library(quantmod)
     optData = getOptionChain( "XOM", Exp=NULL )
     nrow(optData)

The last command returned NULL. What am I doing wrong?

Bob

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From josh.m.ulrich at gmail.com  Fri May 12 20:09:39 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 12 May 2017 13:09:39 -0500
Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
In-Reply-To: <000001d2cb49$defe8900$9cfb9b00$@gmail.com>
References: <4d4c7e8d-4494-6558-cf97-0a040bbd012e@comcast.net>
 <000001d2cb49$defe8900$9cfb9b00$@gmail.com>
Message-ID: <CAPPM_gQakkoxOZjU-o8Hz3gP0ePidRvYKEpk-Cgf-D3rzbPpZA@mail.gmail.com>

On Fri, May 12, 2017 at 1:02 PM, Frank <frankm60606 at gmail.com> wrote:
> It looks like some of the dependencies don't load automatically. I was using
> R x64 3.2.2:
>
They load automatically.  They are not *installed* automatically.

> 1) Updated my R to the later version
> 2) I installed package jsonlite  ("package:"jsonlite"cannot be loaded.")
> 3) I installed package curl ("Error: Required package curl not found. Please
> run: install.packages('curl')"
> 4) I updated to R x64 3.2.5 then R x64 3.3.3 re-installed the above.
>
> I now get
>
> " Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
> bid,  :
>   object 'contractsymbol' not found"
>
> The complete output is now:
>
> "
> version 3.3.3 (2017-03-06) -- "Another Canoe"
> Copyright (C) 2017 The R Foundation for Statistical Computing
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>   Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>>      library(quantmod)
> Loading required package: xts
> Loading required package: zoo
>
> Attaching package: 'zoo'
>
> The following objects are masked from 'package:base':
>
>     as.Date, as.Date.numeric
>
> Loading required package: TTR
> Version 0.4-0 included new data defaults. See ?getSymbols.
>>      optData = getOptionChain( "XOM", Exp=NULL )
> Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
> bid,  :
>   object 'contractsymbol' not found
> Calls: getOptionChain ... <Anonymous> -> with -> with.default -> eval ->
> eval -> data.frame
> Execution halted
>
I get the same error.  It looks like Yahoo changed something so that
now fromJSON returns an empty list for the put/call tables instead of
NULL.

>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
> Of Robert Sherry
> Sent: Friday, May 12, 2017 11:35 AM
> To: r-sig-finance at r-project.org
> Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
>
> I executed the following commands in R:
>
>      library(quantmod)
>      optData = getOptionChain( "XOM", Exp=NULL )
>      nrow(optData)
>
> The last command returned NULL. What am I doing wrong?
>
> Bob
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From rsherry8 at comcast.net  Fri May 12 22:39:16 2017
From: rsherry8 at comcast.net (Robert Sherry)
Date: Fri, 12 May 2017 16:39:16 -0400
Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
In-Reply-To: <CAPPM_gQakkoxOZjU-o8Hz3gP0ePidRvYKEpk-Cgf-D3rzbPpZA@mail.gmail.com>
References: <4d4c7e8d-4494-6558-cf97-0a040bbd012e@comcast.net>
 <000001d2cb49$defe8900$9cfb9b00$@gmail.com>
 <CAPPM_gQakkoxOZjU-o8Hz3gP0ePidRvYKEpk-Cgf-D3rzbPpZA@mail.gmail.com>
Message-ID: <18912f8c-4fb2-11b5-e0ad-3425c2e29de7@comcast.net>

Joshua and Frank,

Thanks for your responses. I am using version 3.2.2 of R. I 
installed/reinstalled jsonlite and curl. I still get the same problem. I 
then updated my version of quantmod. After doing this, I ran the command:

	getOptionChain( "XOM", Exp=NULL )

and  I got the message:
Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid 
= bid,  :
   object 'contractsymbol' not found
Since, it is not working for you either, I guess that quantmod has a 
significant bug.

Is there a better way to get free option quotes in R?

Thank you,

Bob
On 5/12/2017 2:09 PM, Joshua Ulrich wrote:
> On Fri, May 12, 2017 at 1:02 PM, Frank<frankm60606 at gmail.com>  wrote:
>> It looks like some of the dependencies don't load automatically. I was using
>> R x64 3.2.2:
>>
> They load automatically.  They are not *installed* automatically.
>
>> 1) Updated my R to the later version
>> 2) I installed package jsonlite  ("package:"jsonlite"cannot be loaded.")
>> 3) I installed package curl ("Error: Required package curl not found. Please
>> run: install.packages('curl')"
>> 4) I updated to R x64 3.2.5 then R x64 3.3.3 re-installed the above.
>>
>> I now get
>>
>> " Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
>> bid,  :
>>    object 'contractsymbol' not found"
>>
>> The complete output is now:
>>
>> "
>> version 3.3.3 (2017-03-06) -- "Another Canoe"
>> Copyright (C) 2017 The R Foundation for Statistical Computing
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>>
>>    Natural language support but running in an English locale
>>
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information and
>> 'citation()' on how to cite R or R packages in publications.
>>
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for an HTML browser interface to help.
>> Type 'q()' to quit R.
>>
>>>       library(quantmod)
>> Loading required package: xts
>> Loading required package: zoo
>>
>> Attaching package: 'zoo'
>>
>> The following objects are masked from 'package:base':
>>
>>      as.Date, as.Date.numeric
>>
>> Loading required package: TTR
>> Version 0.4-0 included new data defaults. See ?getSymbols.
>>>       optData = getOptionChain( "XOM", Exp=NULL )
>> Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
>> bid,  :
>>    object 'contractsymbol' not found
>> Calls: getOptionChain ... <Anonymous> -> with -> with.default -> eval ->
>> eval -> data.frame
>> Execution halted
>>
> I get the same error.  It looks like Yahoo changed something so that
> now fromJSON returns an empty list for the put/call tables instead of
> NULL.
>
>> -----Original Message-----
>> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
>> Of Robert Sherry
>> Sent: Friday, May 12, 2017 11:35 AM
>> To:r-sig-finance at r-project.org
>> Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
>>
>> I executed the following commands in R:
>>
>>       library(quantmod)
>>       optData = getOptionChain( "XOM", Exp=NULL )
>>       nrow(optData)
>>
>> The last command returned NULL. What am I doing wrong?
>>
>> Bob
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org  mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org  mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.
>


	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Sat May 13 15:53:13 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 13 May 2017 08:53:13 -0500
Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
In-Reply-To: <18912f8c-4fb2-11b5-e0ad-3425c2e29de7@comcast.net>
References: <4d4c7e8d-4494-6558-cf97-0a040bbd012e@comcast.net>
 <000001d2cb49$defe8900$9cfb9b00$@gmail.com>
 <CAPPM_gQakkoxOZjU-o8Hz3gP0ePidRvYKEpk-Cgf-D3rzbPpZA@mail.gmail.com>
 <18912f8c-4fb2-11b5-e0ad-3425c2e29de7@comcast.net>
Message-ID: <CAPPM_gQvT_rUuFzdwmjqs+1D+R6Ankm6YV6Ws85dzctBdTKUdg@mail.gmail.com>

On Fri, May 12, 2017 at 3:39 PM, Robert Sherry <rsherry8 at comcast.net> wrote:
> Joshua and Frank,
>
> Thanks for your responses. I am using version 3.2.2 of R. I
> installed/reinstalled jsonlite and curl. I still get the same problem. I
> then updated my version of quantmod. After doing this, I ran the command:
>
> getOptionChain( "XOM", Exp=NULL )
>
> and  I got the message:
> Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
> bid,  :
>   object 'contractsymbol' not found
> Since, it is not working for you either, I guess that quantmod has a
> significant bug.
>
This is now fixed on GitHub:
https://github.com/joshuaulrich/quantmod/issues/155

You can install with:
remotes::install_github("joshuaulrich/quantmod")

> Is there a better way to get free option quotes in R?
>
> Thank you,
>
> Bob
>
> On 5/12/2017 2:09 PM, Joshua Ulrich wrote:
>
> On Fri, May 12, 2017 at 1:02 PM, Frank <frankm60606 at gmail.com> wrote:
>
> It looks like some of the dependencies don't load automatically. I was using
> R x64 3.2.2:
>
> They load automatically.  They are not *installed* automatically.
>
> 1) Updated my R to the later version
> 2) I installed package jsonlite  ("package:"jsonlite"cannot be loaded.")
> 3) I installed package curl ("Error: Required package curl not found. Please
> run: install.packages('curl')"
> 4) I updated to R x64 3.2.5 then R x64 3.3.3 re-installed the above.
>
> I now get
>
> " Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
> bid,  :
>   object 'contractsymbol' not found"
>
> The complete output is now:
>
> "
> version 3.3.3 (2017-03-06) -- "Another Canoe"
> Copyright (C) 2017 The R Foundation for Statistical Computing
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>   Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
>      library(quantmod)
>
> Loading required package: xts
> Loading required package: zoo
>
> Attaching package: 'zoo'
>
> The following objects are masked from 'package:base':
>
>     as.Date, as.Date.numeric
>
> Loading required package: TTR
> Version 0.4-0 included new data defaults. See ?getSymbols.
>
>      optData = getOptionChain( "XOM", Exp=NULL )
>
> Error in data.frame(Strike = strike, Last = lastprice, Chg = change, Bid =
> bid,  :
>   object 'contractsymbol' not found
> Calls: getOptionChain ... <Anonymous> -> with -> with.default -> eval ->
> eval -> data.frame
> Execution halted
>
> I get the same error.  It looks like Yahoo changed something so that
> now fromJSON returns an empty list for the put/call tables instead of
> NULL.
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
> Of Robert Sherry
> Sent: Friday, May 12, 2017 11:35 AM
> To: r-sig-finance at r-project.org
> Subject: [R-SIG-Finance] Trying to Extract Option Quotes with R
>
> I executed the following commands in R:
>
>      library(quantmod)
>      optData = getOptionChain( "XOM", Exp=NULL )
>      nrow(optData)
>
> The last command returned NULL. What am I doing wrong?
>
> Bob
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From bruvnor at icloud.com  Sun May 14 15:11:26 2017
From: bruvnor at icloud.com (blank)
Date: Sun, 14 May 2017 09:11:26 -0400
Subject: [R-SIG-Finance] turning returns back into an index
Message-ID: <11F6992B-9085-4ABB-81F8-AB86687EBC96@icloud.com>

I?ve looked everywhere for a C optimised R library function that will accumulate returns with interim levels but can?t find it. 

so a function that is the inverse of Return.calculate() from PerformanceAnalytics

or, something like this:

rtns <- rnorm(100, sd=0.01)
index <- vector(, length = length(rtns)+1)
index[1] <- 100
for ( i in 1:length(rtns) ) {
  index[i+1] <- index[i] * (1+rtns[i])
}

cheers.


From pierrelap at gmail.com  Sun May 14 15:34:39 2017
From: pierrelap at gmail.com (Pierre Lapointe)
Date: Sun, 14 May 2017 09:34:39 -0400
Subject: [R-SIG-Finance] turning returns back into an index
In-Reply-To: <11F6992B-9085-4ABB-81F8-AB86687EBC96@icloud.com>
References: <11F6992B-9085-4ABB-81F8-AB86687EBC96@icloud.com>
Message-ID: <CAHjr2U9+sfV9K6S5Zs5_TfOpaKbbHh15+MJ77U4sS6R4Y9UNXA@mail.gmail.com>

cumprod(1+return_vector) to get an index starting from 1.
cumprod(1+return_vector)*100 to get an index starting at 100

On Sun, May 14, 2017 at 9:11 AM, blank <bruvnor at icloud.com> wrote:

> I?ve looked everywhere for a C optimised R library function that will
> accumulate returns with interim levels but can?t find it.
>
> so a function that is the inverse of Return.calculate() from
> PerformanceAnalytics
>
> or, something like this:
>
> rtns <- rnorm(100, sd=0.01)
> index <- vector(, length = length(rtns)+1)
> index[1] <- 100
> for ( i in 1:length(rtns) ) {
>   index[i+1] <- index[i] * (1+rtns[i])
> }
>
> cheers.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.

	[[alternative HTML version deleted]]


From oskar.gottlieb at lenzglobal.com  Mon May 15 14:22:53 2017
From: oskar.gottlieb at lenzglobal.com (Oskar Gottlieb)
Date: Mon, 15 May 2017 14:22:53 +0200
Subject: [R-SIG-Finance] Quantstrat - extracting current symbol
In-Reply-To: <1494588921.9466.8.camel@braverock.com>
References: <CAPwqZwC-pP5CnOjeohxMxfkKoSY2T0QDRFVF4JY5pb1ot5v6Ww@mail.gmail.com>
 <e3128131-693f-1afa-b118-409aef8aebca@braverock.com>
 <CAPwqZwAWnPWKUFJ-Eo0zZpXf+fkqkA2A8zKM28=1_8RL9Af0Lw@mail.gmail.com>
 <1494588921.9466.8.camel@braverock.com>
Message-ID: <CAPwqZwCJuN_aJ6Xy7vNQ0tA2EivXYEijGEJEdMz3Vj4VYHR-7g@mail.gmail.com>

Hi Brian,

thanks! Last thing, I believe I had it working prior to the weekend, but
now calling getInstrument(symbol) inside the 'add.indicator' function
results simply in error of "object 'symbol' not found".
Do I understand it correctly, that symbol can be called inside of a
function, which is then called by add.indicator()? If so, what am I doing
wrong?

My function looks as follows, its purpose is to get you flat around
expiration:

FLAT <- function(x, t = '12:00'){
  expires <- as.POSIXct(paste(getInstrument(symbol)$expires, t))
  df <- as.data.frame(index(x) >= expires)
  colnames(df) <- 'FLAT'
  FLAT <- xts(df, index(x))
  return(FLAT)
}

Regards
Oskar

2017-05-12 13:35 GMT+02:00 Brian G. Peterson <brian at braverock.com>:

> You asked:
>
> > The best way to get the attribute then, would be to call
> > 'getInstrument(symbol)$newAttribute'?
>
> Yes.
>
> Here's an example:
>
> ###
>
> getInstrument('ESH8')
>
> # primary_id        :"ES_H8"
> # currency          :"USD"
> # multiplier        :50
> # tick_size         :0.25
> # identifiers       :List of 2
> # ..$ X.RIC:"ESH8"
> # ..$ local:"ESH8"
> # type              :"future_series" "future"
> # root_id           :"ES"
> # suffix_id         :"H8"
> # expires           :"2018-03-16"
> # exchange          :"GLOBEX"
> # underlying_id     :"ES"
> # exchange_id       :"ES"
> # series_description:"E-mini S&P 500 2018-03"
> # timeZoneId        :"CTT"
> # tradingHours      :"T15:30:00/T16:30:00" "T17:00:00/T15:15:00"
> # liquidHours       :"T08:30:00/T15:15:00"
> # primary_start     :"08:30:00"
> # primary_end       :"15:15:00"
> # electronic_start  :"15:30:00"
> # electronic_end    :"16:30:00"
> # validExchanges    :"GLOBEX" "MIBSX"
> # updated           : POSIXct, format: "2012-02-27 15:26:53.52408"
> # contract_month    :"2018-03"
>
> getInstrument('ESH8')$tick_size
> #  [1] 0.25
>
> ###
>
> So the method you ask about works just fine.  If you're going to be
> extracting multiple attributes, it would make sense to call
> getInstrument only once to minimize the search time (we have many
> thousands of instruments in our instrument environment) and then take
> the attributes you want out of your local copy.
>
> Regards,
>
> Brian
>
> On Fri, 2017-05-12 at 12:07 +0200, Oskar Gottlieb wrote:
> > Hi Brian,
> >
> > Thanks for the quick reply!
> > I was aware of the instrument objects, I just did not know there were
> > the instrument_attr(), instrument.table() functions. This solves the
> > need for external meta info dataframe, which is extremely convinient.
> > The best way to get the attribute then, would be to call
> > 'getInstrument(symbol)$newAttribute'?
> >
> > About add.indicator - I did a poor job explaining what I was trying
> > to achieve, but it's exactly what you're saying. I will create a new
> > indicator function, which will get some metadata from the instrument
> > and all of that will be handled inside the indicator function, there
> > is no need to pass it as a parameter to the add.indicator function.
> >
> > Thanks again!
> > Oskar
> >
> > 2017-05-12 11:16 GMT+02:00 Brian G. Peterson <brian at braverock.com>:
> >
> > > On 05/12/2017 03:58 AM, Oskar Gottlieb wrote:
> > >
> > > > I have multiple symbols (futures contracts) of one product and I
> would
> > > > like
> > > > to access a data frame with their meta information. I would then
> parse the
> > > > meta info into an add.indicator argument list. Is there a function,
> which
> > > > would return the current symbol over which we are looping?
> > > >
> > >
> > > quantstrat would expect the metadata for these symbols to be in
> > > FinancialInstrument, not in a data.frame.  That is where quantstrat and
> > > blotter expect to get things like tick size, multiplier, expiration
> date,
> > > and currency for each instrument.
> > >
> > > Inside quantstrat, there will always be a 'symbol' variable which you
> > > could access to find out what symbol is currently being processed
> (unless
> > > we're in a rebalancing rule, when that doesn't apply).
> > >
> > > What I would recommend is to put all your instrument metadata in
> > > FinancialInstrument (since that is what it is for) and have your
> indicator
> > > and signal functions access that data with
> > >
> > > getInstrument(symbol)
> > >
> > > To further guess at what you're trying to do, you talk about using this
> > > list for add.indicator.  I don't understand what you're trying to do
> with
> > > that statement.  The strategy object is a specification of how the
> strategy
> > > will work.  The indicators, signals, and rules should all work on the
> > > mktdata passed to them by the applyStrategy function (and inside that
> by
> > > applyIndicators, applySignals, applyRules).  So any call to
> add.indicator
> > > should be generic for the entire strategy specification.
> > >
> > > If you wanted an indicator to do something different based on tenor or
> > > days to expiration, for example, you'd handle that inside the indicator
> > > function, not as parameters to the call to add.indicator. (probably
> after
> > > calling getInstrument to get the metadata, as described above).
> > >
> > > If this hasn't answered your question, perhaps you could follow up with
> > > something more specific including a *minimal* example.
> > >
> > > Regards,
> > >
> > > Brian
> > >
> > > --
> > > Brian G. Peterson
> > > http://braverock.com/brian/
> > > Ph: 773-459-4973
> > > IM: bgpbraverock
> > >
> > > _______________________________________________
> > > R-SIG-Finance at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > > -- Subscriber-posting only. If you want to post, subscribe first.
> > > -- Also note that this is not the r-help list where general R questions
> > > should go.
> > >
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R
> > questions should go.
>



-- 
Oskar Gottlieb
Email: oskar.gottlieb at lenzglobal.com
Tel: +420 725 005 642

	[[alternative HTML version deleted]]


From dmack10 at verizon.net  Tue May 16 15:37:26 2017
From: dmack10 at verizon.net (Daniel Mack)
Date: Tue, 16 May 2017 09:37:26 -0400
Subject: [R-SIG-Finance] Yahoo Did not update
Message-ID: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>

All,  Did anyone notice that Yahoo did not update last night.  I have been running a Yahoo down  for a year and half and it did not update for the first time.   Did anyone else experience this?   I am using quantmod.

Thanks,  Dan


From roger.bos at gmail.com  Tue May 16 17:10:35 2017
From: roger.bos at gmail.com (Roger Bos)
Date: Tue, 16 May 2017 11:10:35 -0400
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
Message-ID: <CAPV07m-oog=ULU5UqoR72RRvD58dLf2o6Un7ojLm9ZtiRGOceA@mail.gmail.com>

I saw some talk about Yahoo changing something that broke the package, but
for some it was still working in Rstudio, but don't quote me on that.  It
has been fixed on the latest version (probably on github, not sure about
CRAN).  Search some more and you will find the discussion.


On May 16, 2017 10:37 AM, "Daniel Mack" <dmack10 at verizon.net> wrote:

> All,  Did anyone notice that Yahoo did not update last night.  I have been
> running a Yahoo down  for a year and half and it did not update for the
> first time.   Did anyone else experience this?   I am using quantmod.
>
> Thanks,  Dan
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From herrold at owlriver.com  Tue May 16 17:56:45 2017
From: herrold at owlriver.com (R P Herrold)
Date: Tue, 16 May 2017 11:56:45 -0400 (EDT)
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
Message-ID: <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>

On Tue, 16 May 2017, Daniel Mack wrote:

> All, Did anyone notice that Yahoo did not update last night.  
> I have been running a Yahoo down for a year and half and it 
> did not update for the first time.  Did anyone else 
> experience this?  I am using quantmod.

As to Yahoo changes recently, this thread in the pipermail 
archive:
	https://stat.ethz.ch/pipermail/r-sig-finance/2017q2/014274.html

I have been hitting some intermittent limits (i.e., failures 
to get replies and getting error returns instead) at Yahoo 
Finance as to multiple inquiries from the same IP the last 
week or so

-- Russ herrold


From aschmid1 at stevens.edu  Tue May 16 21:39:55 2017
From: aschmid1 at stevens.edu (Alec Schmidt)
Date: Tue, 16 May 2017 19:39:55 +0000
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>,
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
Message-ID: <1494963611793.33126@stevens.edu>

And now I cannot download from yahoo at all (it worked until 20 min ago):

trying URL 'http://chart.yahoo.com/table.csv?s=AAPL&a=5&b=01&c=2012&d=4&e=12&f=2017&g=d&q=q&y=0&z=AAPL&x=.csv'
download error, retrying ...

1: In download.file(url, destfile, method = method, quiet = quiet) :
  cannot open: HTTP status was '502 Connection refused'

Is it just me?
Thanks! Alec
________________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of R P Herrold <herrold at owlriver.com>
Sent: Tuesday, May 16, 2017 11:56 AM
To: Daniel Mack
Cc: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] Yahoo Did not update

On Tue, 16 May 2017, Daniel Mack wrote:

> All, Did anyone notice that Yahoo did not update last night.
> I have been running a Yahoo down for a year and half and it
> did not update for the first time.  Did anyone else
> experience this?  I am using quantmod.

As to Yahoo changes recently, this thread in the pipermail
archive:
        https://stat.ethz.ch/pipermail/r-sig-finance/2017q2/014274.html

I have been hitting some intermittent limits (i.e., failures
to get replies and getting error returns instead) at Yahoo
Finance as to multiple inquiries from the same IP the last
week or so

-- Russ herrold

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From herrold at owlriver.com  Tue May 16 22:02:45 2017
From: herrold at owlriver.com (R P Herrold)
Date: Tue, 16 May 2017 16:02:45 -0400 (EDT)
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <1494963611793.33126@stevens.edu>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>,
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
Message-ID: <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>

On Tue, 16 May 2017, Alec Schmidt wrote:

> And now I cannot download from yahoo at all (it worked until 20 min ago):
> 
> trying URL 'http://chart.yahoo.com/table.csv?s=AAPL&a=5&b=01&c=2012&d=4&e=12&f=2017&g=d&q=q&y=0&z=AAPL&x=.csv'
> download error, retrying ...
> 
> 1: In download.file(url, destfile, method = method, quiet = quiet) :
>   cannot open: HTTP status was '502 Connection refused'
> 
> Is it just me?

no -- looking in a web browser displays an outage message here

retrievals from them 'fell off a cliff and died' earlier 
this afternoon

also, revising code and habits to use httpS rather than http 
was kind of the point of the thread I mentioned earlier today

-- Russ herrold


From roger.bos at rothschild.com  Tue May 16 22:03:34 2017
From: roger.bos at rothschild.com (Bos, Roger)
Date: Tue, 16 May 2017 20:03:34 +0000
Subject: [R-SIG-Finance] blotter package funciton addTxns
Message-ID: <9f36a91f70154bffafbc96d539fd9e20@USNYMMSG001.rth.ad.rothschild.com>

All,

I cloned the blotter package on github and took a look at the amzn_test.R demo file and I see a call to addTxns, but I don't see that function listed in R folder of the package.  I see addTxn, but not addTxns.  addTxns is listed in the NAMESPACE folder as an exported function.  I can still see the function code by typing the function name, but  Could someone please point out something simple that I am obviously missing?

Thanks,

Roger

### Start Example Code ###

library(blotter)

# Remove portfolio and account data if run previously
try(rm("portfolio.amzn_port","account.amzn_acct",pos=.blotter), silent = TRUE)

# load the example data
data("amzn")
currency("USD")
stock("amzn",currency="USD",multiplier=1)
# Initialize the Portfolio
initPortf("amzn_port",symbols="amzn",initDate="2010-01-14")
initAcct("amzn_acct",portfolios="amzn_port",initDate="2010-01-14", initEq=10000)
# look at the transactions data
amzn.trades
# Add the transactions to the portfolio
blotter:::addTxns("amzn_port","amzn",TxnData=amzn.trades,verbose=TRUE)




This message and any attachments are for the intended recipient?s use only. This message may contain confidential, proprietary or legally privileged information. No right to confidential or privileged treatment of this message is waived or lost by an error in transmission.
If you have received this message in error, please immediately notify the sender by e-mail, delete the message, any attachments and all copies from your system and destroy any hard copies. You must not, directly or indirectly, use, disclose, distribute, print or copy any part of this message or any attachments if you are not the intended recipient.





From brian at braverock.com  Tue May 16 22:07:33 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 16 May 2017 15:07:33 -0500
Subject: [R-SIG-Finance] blotter package funciton addTxns
In-Reply-To: <9f36a91f70154bffafbc96d539fd9e20@USNYMMSG001.rth.ad.rothschild.com>
References: <9f36a91f70154bffafbc96d539fd9e20@USNYMMSG001.rth.ad.rothschild.com>
Message-ID: <1494965253.3075.1.camel@braverock.com>

The code and documentation for the addTxns function are in the addTxn.R
file (lines 167-201).

On Tue, 2017-05-16 at 20:03 +0000, Bos, Roger wrote:
> All,
> 
> I cloned the blotter package on github and took a look at the
> amzn_test.R demo file and I see a call to addTxns, but I don't see
> that function listed in R folder of the package.??I see addTxn, but
> not addTxns.??addTxns is listed in the NAMESPACE folder as an
> exported function.??I can still see the function code by typing the
> function name, but??Could someone please point out something simple
> that I am obviously missing?
> 
> Thanks,
> 
> Roger
> 
> ### Start Example Code ###
> 
> library(blotter)
> 
> # Remove portfolio and account data if run previously
> try(rm("portfolio.amzn_port","account.amzn_acct",pos=.blotter),
> silent = TRUE)
> 
> # load the example data
> data("amzn")
> currency("USD")
> stock("amzn",currency="USD",multiplier=1)
> # Initialize the Portfolio
> initPortf("amzn_port",symbols="amzn",initDate="2010-01-14")
> initAcct("amzn_acct",portfolios="amzn_port",initDate="2010-01-14",
> initEq=10000)
> # look at the transactions data
> amzn.trades
> # Add the transactions to the portfolio
> blotter:::addTxns("amzn_port","amzn",TxnData=amzn.trades,verbose=TRUE
> )
> 
> 
> 
> 
> This message and any attachments are for the intended recipient?s use
> only. This message may contain confidential, proprietary or legally
> privileged information. No right to confidential or privileged
> treatment of this message is waived or lost by an error in
> transmission.
> If you have received this message in error, please immediately notify
> the sender by e-mail, delete the message, any attachments and all
> copies from your system and destroy any hard copies. You must not,
> directly or indirectly, use, disclose, distribute, print or copy any
> part of this message or any attachments if you are not the intended
> recipient.
> 
> 
> 
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R
> questions should go.
>


From ilya.kipnis at gmail.com  Tue May 16 22:13:28 2017
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Tue, 16 May 2017 15:13:28 -0500
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
 <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
Message-ID: <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>

Can confirm. Having issues downloading from Yahoo, getting a 502 error.
Should I reinstall quantmod?

On Tue, May 16, 2017 at 3:02 PM, R P Herrold <herrold at owlriver.com> wrote:

> On Tue, 16 May 2017, Alec Schmidt wrote:
>
> > And now I cannot download from yahoo at all (it worked until 20 min ago):
> >
> > trying URL 'http://chart.yahoo.com/table.csv?s=AAPL&a=5&b=01&c=2012&d=
> 4&e=12&f=2017&g=d&q=q&y=0&z=AAPL&x=.csv'
> > download error, retrying ...
> >
> > 1: In download.file(url, destfile, method = method, quiet = quiet) :
> >   cannot open: HTTP status was '502 Connection refused'
> >
> > Is it just me?
>
> no -- looking in a web browser displays an outage message here
>
> retrievals from them 'fell off a cliff and died' earlier
> this afternoon
>
> also, revising code and habits to use httpS rather than http
> was kind of the point of the thread I mentioned earlier today
>
> -- Russ herrold
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From herrold at owlriver.com  Tue May 16 22:24:29 2017
From: herrold at owlriver.com (R P Herrold)
Date: Tue, 16 May 2017 16:24:29 -0400 (EDT)
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
 <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
 <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>
Message-ID: <alpine.LRH.2.20.1705161618200.24088@puneyrf.bjyevire.pbz>

On Tue, 16 May 2017, Ilya Kipnis wrote:

> Can confirm. Having issues downloading from Yahoo, getting a 502 error.
> Should I reinstall quantmod?

If your personal vehicle runs out of fuel, would you discard 
it and purchase a new car?

Yahoo! Finance data is just fuel for quantmod in my analogy -- 
other data providers and vendors exist

	https://www.quandl.com/
	http://www.tickdata.com/html/downloads.shtml
	https://orats.com/
	http://www.nanex.net/
	https://www.bloomberg.com/markets/chart/data/1D/AAPL:US
	http://www.interactivebrokers.com/

Some on that list offer some data without charge

-- Russ herrold


From roger.bos at gmail.com  Wed May 17 00:11:10 2017
From: roger.bos at gmail.com (Roger Bos)
Date: Tue, 16 May 2017 18:11:10 -0400
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <alpine.LRH.2.20.1705161618200.24088@puneyrf.bjyevire.pbz>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
 <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
 <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>
 <alpine.LRH.2.20.1705161618200.24088@puneyrf.bjyevire.pbz>
Message-ID: <CAPV07m-WVdhvRC7s7LzvKnqsB4CBWs4t9F2Hy9RgH873+b+TPw@mail.gmail.com>

Google still works


On May 16, 2017 4:25 PM, "R P Herrold" <herrold at owlriver.com> wrote:

> On Tue, 16 May 2017, Ilya Kipnis wrote:
>
> > Can confirm. Having issues downloading from Yahoo, getting a 502 error.
> > Should I reinstall quantmod?
>
> If your personal vehicle runs out of fuel, would you discard
> it and purchase a new car?
>
> Yahoo! Finance data is just fuel for quantmod in my analogy --
> other data providers and vendors exist
>
>         https://www.quandl.com/
>         http://www.tickdata.com/html/downloads.shtml
>         https://orats.com/
>         http://www.nanex.net/
>         https://www.bloomberg.com/markets/chart/data/1D/AAPL:US
>         http://www.interactivebrokers.com/
>
> Some on that list offer some data without charge
>
> -- Russ herrold
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From aschmid1 at stevens.edu  Wed May 17 02:56:18 2017
From: aschmid1 at stevens.edu (Alec Schmidt)
Date: Wed, 17 May 2017 00:56:18 +0000
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <CAPV07m-WVdhvRC7s7LzvKnqsB4CBWs4t9F2Hy9RgH873+b+TPw@mail.gmail.com>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
 <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
 <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>
 <alpine.LRH.2.20.1705161618200.24088@puneyrf.bjyevire.pbz>,
 <CAPV07m-WVdhvRC7s7LzvKnqsB4CBWs4t9F2Hy9RgH873+b+TPw@mail.gmail.com>
Message-ID: <1494982595780.5036@stevens.edu>

Roger,
I'm getting nervous with yahoo outage. Google works indeed, but it provides only closing but not adjusted prices. Any way around?
Thanks, Alec
  
________________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Roger Bos <roger.bos at gmail.com>
Sent: Tuesday, May 16, 2017 6:11 PM
To: R P Herrold
Cc: r-sig-finance
Subject: Re: [R-SIG-Finance] Yahoo Did not update

Google still works


On May 16, 2017 4:25 PM, "R P Herrold" <herrold at owlriver.com> wrote:

> On Tue, 16 May 2017, Ilya Kipnis wrote:
>
> > Can confirm. Having issues downloading from Yahoo, getting a 502 error.
> > Should I reinstall quantmod?
>
> If your personal vehicle runs out of fuel, would you discard
> it and purchase a new car?
>
> Yahoo! Finance data is just fuel for quantmod in my analogy --
> other data providers and vendors exist
>
>         https://www.quandl.com/
>         http://www.tickdata.com/html/downloads.shtml
>         https://orats.com/
>         http://www.nanex.net/
>         https://www.bloomberg.com/markets/chart/data/1D/AAPL:US
>         http://www.interactivebrokers.com/
>
> Some on that list offer some data without charge
>
> -- Russ herrold
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From josh.m.ulrich at gmail.com  Wed May 17 03:11:07 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 16 May 2017 20:11:07 -0500
Subject: [R-SIG-Finance] Yahoo Finance API change
Message-ID: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>

Hi all,

Just wanted to let the list know that Yahoo Finance changed their API
and most download functions will no longer work.  It looks like
getting it working will require creating and tracking a session with
the Yahoo Finance servers.

If you're interested in quantmod::getSymbols.yahoo, you can track
progress on the fix on the GitHub issue I created:
https://github.com/joshuaulrich/quantmod/issues/157

Best,
Josh


-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From erol.biceroglu at alumni.utoronto.ca  Wed May 17 03:12:06 2017
From: erol.biceroglu at alumni.utoronto.ca (Erol Biceroglu)
Date: Tue, 16 May 2017 21:12:06 -0400
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <1494982595780.5036@stevens.edu>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
 <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
 <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>
 <alpine.LRH.2.20.1705161618200.24088@puneyrf.bjyevire.pbz>
 <CAPV07m-WVdhvRC7s7LzvKnqsB4CBWs4t9F2Hy9RgH873+b+TPw@mail.gmail.com>
 <1494982595780.5036@stevens.edu>
Message-ID: <CACjNfmkQofPjYXyjXmKxCU13z9Qe3XwfAVr8SaOjX+YK4=qwtg@mail.gmail.com>

Pasting
https://ichart.finance.yahoo.com/table.csv?s=XLE&a=0&b=01&c=1998&d=11&e=30&f=2016&g=d&q=q&y=0&z=XLE&x=.csv
in a browser yields the following message from yahoo:

"Will be right back... Thank you for your patience. Our engineers are
working quickly to resolve the issue."

Is is possible that it's a temporary issue?


Erol Biceroglu
416-275-7970
*LinkedIn <http://ca.linkedin.com/in/erolbiceroglu> | Wordpress
<https://propfoliomanagement.wordpress.com/>*

On Tue, May 16, 2017 at 8:56 PM, Alec Schmidt <aschmid1 at stevens.edu> wrote:

> Roger,
> I'm getting nervous with yahoo outage. Google works indeed, but it
> provides only closing but not adjusted prices. Any way around?
> Thanks, Alec
>
> ________________________________________
> From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of
> Roger Bos <roger.bos at gmail.com>
> Sent: Tuesday, May 16, 2017 6:11 PM
> To: R P Herrold
> Cc: r-sig-finance
> Subject: Re: [R-SIG-Finance] Yahoo Did not update
>
> Google still works
>
>
> On May 16, 2017 4:25 PM, "R P Herrold" <herrold at owlriver.com> wrote:
>
> > On Tue, 16 May 2017, Ilya Kipnis wrote:
> >
> > > Can confirm. Having issues downloading from Yahoo, getting a 502 error.
> > > Should I reinstall quantmod?
> >
> > If your personal vehicle runs out of fuel, would you discard
> > it and purchase a new car?
> >
> > Yahoo! Finance data is just fuel for quantmod in my analogy --
> > other data providers and vendors exist
> >
> >         https://www.quandl.com/
> >         http://www.tickdata.com/html/downloads.shtml
> >         https://orats.com/
> >         http://www.nanex.net/
> >         https://www.bloomberg.com/markets/chart/data/1D/AAPL:US
> >         http://www.interactivebrokers.com/
> >
> > Some on that list offer some data without charge
> >
> > -- Russ herrold
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> > should go.
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Wed May 17 03:15:40 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 16 May 2017 20:15:40 -0500
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <CACjNfmkQofPjYXyjXmKxCU13z9Qe3XwfAVr8SaOjX+YK4=qwtg@mail.gmail.com>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
 <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
 <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>
 <alpine.LRH.2.20.1705161618200.24088@puneyrf.bjyevire.pbz>
 <CAPV07m-WVdhvRC7s7LzvKnqsB4CBWs4t9F2Hy9RgH873+b+TPw@mail.gmail.com>
 <1494982595780.5036@stevens.edu>
 <CACjNfmkQofPjYXyjXmKxCU13z9Qe3XwfAVr8SaOjX+YK4=qwtg@mail.gmail.com>
Message-ID: <CAPPM_gTbUKxGsr6Lbby-US_HLiigvfg8ym92a2cdTC0oMeOT2w@mail.gmail.com>

On Tue, May 16, 2017 at 8:12 PM, Erol Biceroglu
<erol.biceroglu at alumni.utoronto.ca> wrote:
> Pasting
> https://ichart.finance.yahoo.com/table.csv?s=XLE&a=0&b=01&c=1998&d=11&e=30&f=2016&g=d&q=q&y=0&z=XLE&x=.csv
> in a browser yields the following message from yahoo:
>
> "Will be right back... Thank you for your patience. Our engineers are
> working quickly to resolve the issue."
>
> Is is possible that it's a temporary issue?
>
Doubt it. Looks like they changed it to be more secure and harder to scrape.

>
> Erol Biceroglu
> 416-275-7970
> *LinkedIn <http://ca.linkedin.com/in/erolbiceroglu> | Wordpress
> <https://propfoliomanagement.wordpress.com/>*
>
> On Tue, May 16, 2017 at 8:56 PM, Alec Schmidt <aschmid1 at stevens.edu> wrote:
>
>> Roger,
>> I'm getting nervous with yahoo outage. Google works indeed, but it
>> provides only closing but not adjusted prices. Any way around?
>> Thanks, Alec
>>
>> ________________________________________
>> From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of
>> Roger Bos <roger.bos at gmail.com>
>> Sent: Tuesday, May 16, 2017 6:11 PM
>> To: R P Herrold
>> Cc: r-sig-finance
>> Subject: Re: [R-SIG-Finance] Yahoo Did not update
>>
>> Google still works
>>
>>
>> On May 16, 2017 4:25 PM, "R P Herrold" <herrold at owlriver.com> wrote:
>>
>> > On Tue, 16 May 2017, Ilya Kipnis wrote:
>> >
>> > > Can confirm. Having issues downloading from Yahoo, getting a 502 error.
>> > > Should I reinstall quantmod?
>> >
>> > If your personal vehicle runs out of fuel, would you discard
>> > it and purchase a new car?
>> >
>> > Yahoo! Finance data is just fuel for quantmod in my analogy --
>> > other data providers and vendors exist
>> >
>> >         https://www.quandl.com/
>> >         http://www.tickdata.com/html/downloads.shtml
>> >         https://orats.com/
>> >         http://www.nanex.net/
>> >         https://www.bloomberg.com/markets/chart/data/1D/AAPL:US
>> >         http://www.interactivebrokers.com/
>> >
>> > Some on that list offer some data without charge
>> >
>> > -- Russ herrold
>> >
>> > _______________________________________________
>> > R-SIG-Finance at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > -- Also note that this is not the r-help list where general R questions
>> > should go.
>> >
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From aschmid1 at stevens.edu  Wed May 17 03:17:37 2017
From: aschmid1 at stevens.edu (Alec Schmidt)
Date: Wed, 17 May 2017 01:17:37 +0000
Subject: [R-SIG-Finance] Yahoo Finance API change
In-Reply-To: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
References: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
Message-ID: <1494983875152.48218@stevens.edu>

IMHO it's not necessarily quantmod problem. I use get.hist.quote() from tseries, which, too,  yields the same error 502.
________________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Joshua Ulrich <josh.m.ulrich at gmail.com>
Sent: Tuesday, May 16, 2017 9:11 PM
To: r-sig-finance
Subject: [R-SIG-Finance] Yahoo Finance API change

Hi all,

Just wanted to let the list know that Yahoo Finance changed their API
and most download functions will no longer work.  It looks like
getting it working will require creating and tracking a session with
the Yahoo Finance servers.

If you're interested in quantmod::getSymbols.yahoo, you can track
progress on the fix on the GitHub issue I created:
https://github.com/joshuaulrich/quantmod/issues/157

Best,
Josh


--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From erol.biceroglu at alumni.utoronto.ca  Wed May 17 03:22:34 2017
From: erol.biceroglu at alumni.utoronto.ca (Erol Biceroglu)
Date: Tue, 16 May 2017 21:22:34 -0400
Subject: [R-SIG-Finance] Yahoo Did not update
In-Reply-To: <CAPPM_gTbUKxGsr6Lbby-US_HLiigvfg8ym92a2cdTC0oMeOT2w@mail.gmail.com>
References: <ECEF1F03-961C-4E67-A830-441B765322E2@verizon.net>
 <alpine.LRH.2.20.1705161154290.16982@puneyrf.bjyevire.pbz>
 <1494963611793.33126@stevens.edu>
 <alpine.LRH.2.20.1705161559500.24088@puneyrf.bjyevire.pbz>
 <CA+oJuEGTr+F8EPA1-e3g+reiN7875hABpHVPMJTNU=s7bf6jeA@mail.gmail.com>
 <alpine.LRH.2.20.1705161618200.24088@puneyrf.bjyevire.pbz>
 <CAPV07m-WVdhvRC7s7LzvKnqsB4CBWs4t9F2Hy9RgH873+b+TPw@mail.gmail.com>
 <1494982595780.5036@stevens.edu>
 <CACjNfmkQofPjYXyjXmKxCU13z9Qe3XwfAVr8SaOjX+YK4=qwtg@mail.gmail.com>
 <CAPPM_gTbUKxGsr6Lbby-US_HLiigvfg8ym92a2cdTC0oMeOT2w@mail.gmail.com>
Message-ID: <CACjNfmnpiFpNOut2U=-sPi8Z2j=h1P3RhBoVYR_KDHxB_ErmwQ@mail.gmail.com>

Too bad... thanks for the feedback.


Erol Biceroglu
416-275-7970
*LinkedIn <http://ca.linkedin.com/in/erolbiceroglu> | Wordpress
<https://propfoliomanagement.wordpress.com/>*

On Tue, May 16, 2017 at 9:15 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
wrote:

> On Tue, May 16, 2017 at 8:12 PM, Erol Biceroglu
> <erol.biceroglu at alumni.utoronto.ca> wrote:
> > Pasting
> > https://ichart.finance.yahoo.com/table.csv?s=XLE&a=0&b=01&
> c=1998&d=11&e=30&f=2016&g=d&q=q&y=0&z=XLE&x=.csv
> > in a browser yields the following message from yahoo:
> >
> > "Will be right back... Thank you for your patience. Our engineers are
> > working quickly to resolve the issue."
> >
> > Is is possible that it's a temporary issue?
> >
> Doubt it. Looks like they changed it to be more secure and harder to
> scrape.
>
> >
> > Erol Biceroglu
> > 416-275-7970
> > *LinkedIn <http://ca.linkedin.com/in/erolbiceroglu> | Wordpress
> > <https://propfoliomanagement.wordpress.com/>*
> >
> > On Tue, May 16, 2017 at 8:56 PM, Alec Schmidt <aschmid1 at stevens.edu>
> wrote:
> >
> >> Roger,
> >> I'm getting nervous with yahoo outage. Google works indeed, but it
> >> provides only closing but not adjusted prices. Any way around?
> >> Thanks, Alec
> >>
> >> ________________________________________
> >> From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of
> >> Roger Bos <roger.bos at gmail.com>
> >> Sent: Tuesday, May 16, 2017 6:11 PM
> >> To: R P Herrold
> >> Cc: r-sig-finance
> >> Subject: Re: [R-SIG-Finance] Yahoo Did not update
> >>
> >> Google still works
> >>
> >>
> >> On May 16, 2017 4:25 PM, "R P Herrold" <herrold at owlriver.com> wrote:
> >>
> >> > On Tue, 16 May 2017, Ilya Kipnis wrote:
> >> >
> >> > > Can confirm. Having issues downloading from Yahoo, getting a 502
> error.
> >> > > Should I reinstall quantmod?
> >> >
> >> > If your personal vehicle runs out of fuel, would you discard
> >> > it and purchase a new car?
> >> >
> >> > Yahoo! Finance data is just fuel for quantmod in my analogy --
> >> > other data providers and vendors exist
> >> >
> >> >         https://www.quandl.com/
> >> >         http://www.tickdata.com/html/downloads.shtml
> >> >         https://orats.com/
> >> >         http://www.nanex.net/
> >> >         https://www.bloomberg.com/markets/chart/data/1D/AAPL:US
> >> >         http://www.interactivebrokers.com/
> >> >
> >> > Some on that list offer some data without charge
> >> >
> >> > -- Russ herrold
> >> >
> >> > _______________________________________________
> >> > R-SIG-Finance at r-project.org mailing list
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> > -- Subscriber-posting only. If you want to post, subscribe first.
> >> > -- Also note that this is not the r-help list where general R
> questions
> >> > should go.
> >> >
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >>
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Wed May 17 04:31:12 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 16 May 2017 21:31:12 -0500
Subject: [R-SIG-Finance] Yahoo Finance API change
In-Reply-To: <1494983875152.48218@stevens.edu>
References: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
 <1494983875152.48218@stevens.edu>
Message-ID: <CAPPM_gQL3ju375yoAs_JGesxeZO6HrAh8+WuGS=DUPO=cythuA@mail.gmail.com>

On Tue, May 16, 2017 at 8:17 PM, Alec Schmidt <aschmid1 at stevens.edu> wrote:
> IMHO it's not necessarily quantmod problem. I use get.hist.quote() from tseries, which, too,  yields the same error 502.

I don't think it's only a quantmod problem either, which is why I said
most functions that download from Yahoo Finance will no longer work.

I mentioned getSymbols.yahoo because that's the most popular function
I maintain that uses the Yahoo Finance API.

> ________________________________________
> From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Joshua Ulrich <josh.m.ulrich at gmail.com>
> Sent: Tuesday, May 16, 2017 9:11 PM
> To: r-sig-finance
> Subject: [R-SIG-Finance] Yahoo Finance API change
>
> Hi all,
>
> Just wanted to let the list know that Yahoo Finance changed their API
> and most download functions will no longer work.  It looks like
> getting it working will require creating and tracking a session with
> the Yahoo Finance servers.
>
> If you're interested in quantmod::getSymbols.yahoo, you can track
> progress on the fix on the GitHub issue I created:
> https://github.com/joshuaulrich/quantmod/issues/157
>
> Best,
> Josh
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From luca.passalacqua at uniroma1.it  Wed May 17 08:47:34 2017
From: luca.passalacqua at uniroma1.it (Luca Passalacqua)
Date: Wed, 17 May 2017 08:47:34 +0200
Subject: [R-SIG-Finance] RQuantlib on OSX
Message-ID: <CAGHVBE605OeLTkstWJZUHLS+Euny8R82=-VOWK0sjp5X8K7+1g@mail.gmail.com>

Hello,

  first of all I am new to this list, so I hope I am posting my request
correctly. If not, plese let me know.

I have a problem trying to install  RQuantlib on OS X, in particular on.a
MacBook running MAC OS X 10.11.6 (El Capitan).

I am using brew, following instructions found on web, but I am still
missing something since it failed.

Here is the output of brew info:

$ *brew info quantlib*
quantlib: stable 1.9.2 (bottled), HEAD
Library for quantitative finance
http://quantlib.org/
/usr/local/Cellar/quantlib/1.7 (1,264 files, 150.4MB)
  Poured from bottle on 2016-02-02 at 12:56:32
/usr/local/Cellar/quantlib/1.9.2 (1,305 files, 148.3MB) *
  Poured from bottle on 2017-05-04 at 09:06:24
From: https://github.com/Homebrew/homebrew-core/blob/master/
Formula/quantlib.rb
==> Dependencies
Required: boost ?
==> Options
--c++11
    Build using C++11 mode
--with-intraday
    Enable intraday components to dates
--HEAD
    Install HEAD version
==> Caveats
Emacs Lisp files have been installed to:
  /usr/local/share/emacs/site-lisp/quantlib

$ *brew info boost*
boost: stable 1.64.0 (bottled), HEAD
Collection of portable C++ source libraries
https://www.boost.org/
/usr/local/Cellar/boost/1.60.0_1 (11,139 files, 436.5MB)
  Poured from bottle on 2016-02-02 at 12:55:48
/usr/local/Cellar/boost/1.64.0_1 (12,628 files, 398.7MB) *
  Poured from bottle on 2017-05-04 at 09:05:34
From: https://github.com/Homebrew/homebrew-core/blob/master/Formula/boost.rb
==> Dependencies
Optional: icu4c ?
==> Options
--c++11
    Build using C++11 mode
--with-icu4c
    Build regexp engine with icu support
--without-single
    Disable building single-threading variant
--without-static
    Disable building static library variant
--HEAD
    Install HEAD version

Here my call from RStudio:

>* install.packages*("RQuantLib", configure.args =
"--with-boost-include=/usr/local/Cellar/boost/1.64.0_1/include/boost/
--with-boost-lib=/usr/local/Cellar/boost/1.64.0_1/lib/
-prefix=/usr/local/Cellar/boost/1.64.0_1/ CXXFLAGS='-O2 -stdlib=libc++
-mmacosx-version-min=10.9' LDFLAGS='-stdlib=libc++
-mmacosx-version-min=10.9'", type="source")

provo con l'URL 'https://cran.rstudio.com/src/contrib/RQuantLib_0.4.3.tar.gz
'
Content type 'application/x-gzip' length 183352 bytes (179 KB)
==================================================
downloaded 179 KB

* installing *source* package ?RQuantLib? ...
** package ?RQuantLib? successfully unpacked and MD5 sums checked
checking for g++... g++
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C++ compiler... yes
checking whether g++ accepts -g... yes
checking how to run the C++ preprocessor... g++ -E
checking whether we are using the GNU C++ compiler... (cached) yes
checking whether g++ accepts -g... (cached) yes
checking for R... yes
checking for quantlib-config... yes
checking for Boost development files... no
*configure: error: Boost development files not found*
ERROR: configuration failed for package ?RQuantLib?
* removing ?/Library/Frameworks/R.framework/Versions/3.4/
Resources/library/RQuantLib?
Warning in install.packages :
  installation of package ?RQuantLib? had non-zero exit status

The downloaded source packages are in
    ?/private/var/folders/r8/fqq4b3h91vjcytpjfk1jzkl80000gn
/T/RtmpeBsiRU/downloaded_packages?
>

I am puzzled of the error message (in red) since I have written explicitely
the path to boost directories in the configure
instruction.

Could someone please suggest me what to do ?

Many thanks,

Luca


--------------------------------------------
Luca Passalacqua
Department of Statistics
University of Rome "La Sapienza"
Viale Regina Elena, 295
00161 Rome (Italy)
luca.passalacqua at uniroma1.it

-- 
___________________________________________
*Il tuo 5 diventa 1000*
Fai crescere la tua universit?
Dona il 5 per mille alla Sapienza
Codice fiscale: *80209930587*

	[[alternative HTML version deleted]]


From rsherry8 at comcast.net  Wed May 17 23:23:04 2017
From: rsherry8 at comcast.net (Robert Sherry)
Date: Wed, 17 May 2017 17:23:04 -0400
Subject: [R-SIG-Finance] Question / Bug Report with quantmod
Message-ID: <ebc83722-dd42-587d-e50d-09009f03f1e4@comcast.net>

When I run the following two commands:

     library(quantmod)

     d1=getDividends( "XOM" )

I get the messages:

Error in download.file(paste(yahoo.URL, Symbol.name, "&a=", from.m, 
"&b=",  :
   cannot open URL 
'https://ichart.finance.yahoo.com/table.csv?s=XOM&a=0&b=01&c=1970&d=4&e=17&f=2017&g=v&ignore=.csv'
In addition: Warning message:
In download.file(paste(yahoo.URL, Symbol.name, "&a=", from.m, "&b=",  :
   cannot open: HTTP status was '502 Connection refused'

I am using version 3.2.2 of R. If appropriate, I would be happy to 
report on bug at:

     https://github.com/joshuaulrich/quantmod/issues

Please comment.

Thanks,

Bob


From josh.m.ulrich at gmail.com  Wed May 17 23:30:43 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 17 May 2017 16:30:43 -0500
Subject: [R-SIG-Finance] Question / Bug Report with quantmod
In-Reply-To: <ebc83722-dd42-587d-e50d-09009f03f1e4@comcast.net>
References: <ebc83722-dd42-587d-e50d-09009f03f1e4@comcast.net>
Message-ID: <CAPPM_gSM18Or+KV5u4zLcKmjVeh05tY7G_f++8QDKKFBNDj-0w@mail.gmail.com>

On Wed, May 17, 2017 at 4:23 PM, Robert Sherry <rsherry8 at comcast.net> wrote:
> When I run the following two commands:
>
>     library(quantmod)
>
>     d1=getDividends( "XOM" )
>
> I get the messages:
>
> Error in download.file(paste(yahoo.URL, Symbol.name, "&a=", from.m, "&b=",
> :
>   cannot open URL
> 'https://ichart.finance.yahoo.com/table.csv?s=XOM&a=0&b=01&c=1970&d=4&e=17&f=2017&g=v&ignore=.csv'
> In addition: Warning message:
> In download.file(paste(yahoo.URL, Symbol.name, "&a=", from.m, "&b=",  :
>   cannot open: HTTP status was '502 Connection refused'
>
> I am using version 3.2.2 of R. If appropriate, I would be happy to report on
> bug at:
>
>     https://github.com/joshuaulrich/quantmod/issues
>
> Please comment.
>
Had you clicked the link you provided, you would see that the first issue is:
https://github.com/joshuaulrich/quantmod/issues/157

Which is what you've reported.

> Thanks,
>
> Bob
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Wed May 17 23:45:10 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 17 May 2017 16:45:10 -0500
Subject: [R-SIG-Finance] Yahoo Finance API change
In-Reply-To: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
References: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
Message-ID: <CAPPM_gQGOt9s1cbKQKpMapaQcezEMV_R0d7hMy_fX4jGVddrJQ@mail.gmail.com>

Some notes from tinkering with a potential fix:

- You need an established session with cookies to download data
- The URL requires a 'crumb'
- The columns of the CSV are in OHLCAV order (vs OHLCVA)
- The OHL columns are already split-adjusted; the Close columns is not
- Observations for some dates may be "null" in the CSV
- The format of the CSV for split data changed

The the commit messages and diffs for details:
https://github.com/joshuaulrich/quantmod/compare/157_yahoo_502

On Tue, May 16, 2017 at 8:11 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> Hi all,
>
> Just wanted to let the list know that Yahoo Finance changed their API
> and most download functions will no longer work.  It looks like
> getting it working will require creating and tracking a session with
> the Yahoo Finance servers.
>
> If you're interested in quantmod::getSymbols.yahoo, you can track
> progress on the fix on the GitHub issue I created:
> https://github.com/joshuaulrich/quantmod/issues/157
>
> Best,
> Josh
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Thu May 18 04:06:51 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 17 May 2017 21:06:51 -0500
Subject: [R-SIG-Finance] Question / Bug Report with quantmod
In-Reply-To: <308B656F-9358-4774-B4B7-19E0DFF86513@gmail.com>
References: <ebc83722-dd42-587d-e50d-09009f03f1e4@comcast.net>
 <CAPPM_gSM18Or+KV5u4zLcKmjVeh05tY7G_f++8QDKKFBNDj-0w@mail.gmail.com>
 <308B656F-9358-4774-B4B7-19E0DFF86513@gmail.com>
Message-ID: <CAPPM_gSBmG5HACX_rbkPho0sTrH1MkSDjpmT5hGLccXS7zk9+w@mail.gmail.com>

On Wed, May 17, 2017 at 8:55 PM, Ernest Stokely <wizardchef at gmail.com> wrote:
> Sorry if this is a neophyte question, but when I execute
>
> devtools::install_github("joshuaulrich/quantmod", ref="157_yahoo_502?)
>
> I get the following error message:
>
> "Installation failed: Could not find build tools necessary to build
> quantmod?
>
See the second-to-last bullet in the Installation section of quantmod's README:
https://github.com/joshuaulrich/quantmod#installation

> Help much appreciated.
>
> Ernie
>
> On May 17, 2017, at 4:30 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>
> On Wed, May 17, 2017 at 4:23 PM, Robert Sherry <rsherry8 at comcast.net> wrote:
>
> When I run the following two commands:
>
>    library(quantmod)
>
>    d1=getDividends( "XOM" )
>
> I get the messages:
>
> Error in download.file(paste(yahoo.URL, Symbol.name, "&a=", from.m, "&b=",
> :
>  cannot open URL
> 'https://ichart.finance.yahoo.com/table.csv?s=XOM&a=0&b=01&c=1970&d=4&e=17&f=2017&g=v&ignore=.csv'
> In addition: Warning message:
> In download.file(paste(yahoo.URL, Symbol.name, "&a=", from.m, "&b=",  :
>  cannot open: HTTP status was '502 Connection refused'
>
> I am using version 3.2.2 of R. If appropriate, I would be happy to report on
> bug at:
>
>    https://github.com/joshuaulrich/quantmod/issues
>
> Please comment.
>
> Had you clicked the link you provided, you would see that the first issue
> is:
> https://github.com/joshuaulrich/quantmod/issues/157
>
> Which is what you've reported.
>
> Thanks,
>
> Bob
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Fri May 19 17:11:25 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 19 May 2017 10:11:25 -0500
Subject: [R-SIG-Finance] R/Finance 2017: Live streamed
Message-ID: <CAPPM_gS_HKiyhORg3j7a19jX9B4q-_H=jW+LFjcictX4c-b+2w@mail.gmail.com>

Hi All,

I wanted to let the list know that this year's conference is being
live-streamed by Microsoft.  The stream includes slides and audio.

All but a few presentations will be recorded, and they will also be
available after the conference as well.

The live-stream link is:
aka.ms/r_finance

-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From rjkft at yahoo.com  Fri May 19 20:46:41 2017
From: rjkft at yahoo.com (John Kumar)
Date: Fri, 19 May 2017 20:46:41 +0200
Subject: [R-SIG-Finance] blotter failed to build status
Message-ID: <002d01d2d0d0$42452b50$c6cf81f0$@yahoo.com>

Hi All,
I am trying to install blotter on R 3.4, but getting 404 error and R forge
page says failed to build (rev. 1749) so unavailable. Anyone know how I can
get an older revision to install from source or some such workaround.

I did try to install from the github page but that led to previously working
code throwing errors they never used to like:

Error in addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,?
: 
??Transactions must be added in order. TxnDate (2009-01-12) is before last
transaction in portfolio (1995-01-01)


Thanks in advance
John


From josh.m.ulrich at gmail.com  Fri May 19 20:51:17 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 19 May 2017 13:51:17 -0500
Subject: [R-SIG-Finance] blotter failed to build status
In-Reply-To: <002d01d2d0d0$42452b50$c6cf81f0$@yahoo.com>
References: <002d01d2d0d0$42452b50$c6cf81f0$@yahoo.com>
Message-ID: <CAPPM_gSQ5mmMcqDkN1tzKwM9Z_HtuYeqSiASUieBtkgPkVzT+w@mail.gmail.com>

We moved blotter from R-Forge to GitHub awhile ago.  You can find it here:
https://github.com/braverock/blotter

On Fri, May 19, 2017 at 1:46 PM, John Kumar via R-SIG-Finance
<r-sig-finance at r-project.org> wrote:
> Hi All,
> I am trying to install blotter on R 3.4, but getting 404 error and R forge
> page says failed to build (rev. 1749) so unavailable. Anyone know how I can
> get an older revision to install from source or some such workaround.
>
> I did try to install from the github page but that led to previously working
> code throwing errors they never used to like:
>
> Error in addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,
> :
>   Transactions must be added in order. TxnDate (2009-01-12) is before last
> transaction in portfolio (1995-01-01)
>
>
> Thanks in advance
> John
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From daniel.cegielka at gmail.com  Sat May 20 10:26:07 2017
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Sat, 20 May 2017 10:26:07 +0200
Subject: [R-SIG-Finance] Yahoo Finance API change
In-Reply-To: <CAPPM_gQGOt9s1cbKQKpMapaQcezEMV_R0d7hMy_fX4jGVddrJQ@mail.gmail.com>
References: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
 <CAPPM_gQGOt9s1cbKQKpMapaQcezEMV_R0d7hMy_fX4jGVddrJQ@mail.gmail.com>
Message-ID: <CAPLrYET6XRCnjcuKxDuE5j2abhkiw+cOb8rs52Tca1wq5zfYPw@mail.gmail.com>

Maybe it would be better to add support for Alpha Vantage

http://www.alphavantage.co
http://www.alphavantage.co/#about

end examples:
http://www.alphavantage.co/documentation/

Daniel


From ecjbosu at aol.com  Mon May 22 16:33:56 2017
From: ecjbosu at aol.com (Joe W. Byers)
Date: Mon, 22 May 2017 10:33:56 -0400
Subject: [R-SIG-Finance] References for Performance Analytics CVAR
	calculations
Message-ID: <8cb40ef7-3d19-f93e-63c7-5c2fd018ec74@aol.com>

All,

I am working on a research project and I am using Performance Analytics 
to calculate VaR and CVaR.  I am also using the modified (Cornish 
Fisher) methods.  I was hoping someone could provide references for 
mES.MM and Ipower methods in the multivariatemoments.R file.  I am 
really interested in the part that call the Ipower method.  The 
references in the online docs at braverock, cover most of these 
functions, but not the call to Ipower and the use of its results.  It 
may be in Scherer's book, which I do not have a reference.

Thanks

Joe

-- 
*Joe W. Byers*

	[[alternative HTML version deleted]]


From ecjbosu at aol.com  Mon May 22 21:59:59 2017
From: ecjbosu at aol.com (Joe W. Byers)
Date: Mon, 22 May 2017 15:59:59 -0400
Subject: [R-SIG-Finance] Performance Analytics internal multivariateMoments
	calculations
Message-ID: <11f39378-ab30-ef4d-08c9-743171d5af86@aol.com>

All,


I have carved on all methods in MultivariateMoments.R so I can all them 
directly

I am working on the modified var calculations.  I ran the mVaR.MM on my 
data and the results were odd.  I reran setting skewness and kurtosis to 
0 to compare with GVAR.MM.  Still questions.  I have the following example

#test for sigfinance
w = 1000000;
Mean = 0.0001898251;
Stdev = 0.01612464;
ExKurtosis = 3.946156;
Skewness = -0.1373454;

GVaR = GVaR.MM(w,Mean,Stdev, .95)
GVaR
MVaR = mVaR.MM(w,Mean,Stdev, 0,0, .95);
#shoud be equal to GVaR
GVaR==MVaR
MVaR

mVaR.MM does not return the GVaR.MM.  I found the exkurt was not zero as 
I think it should be.  I remove the - 3 from that line and exkurt became 
zero and mVaR.MM == GVaR results.  I have included this modified version 
of mVaR.MM below and continued the test.  Is this an issue or am I 
missing something?


#corrected exkurt calc
mVaR.MM1 = function(w, mu, sigma, M3, M4, p ){
   skew = skewness.MM(w,sigma,M3);
   exkurt = kurtosis.MM(w,sigma,M4); #removed -3
   z = qnorm(1-p);
   zc = z + (1/6)*(z^2 -1)*skew
   Zcf = zc + (1/24)*(z^3 - 3*z)*exkurt - (1/36)*(2*z^3 - 5*z)*skew^2;
   return ( -multivariate_mean(w,mu) - Zcf*StdDev.MM(w,sigma)  )
}

#call revised mVAR.MM with m3 and m4 equal 0
MVaR1 = mVaR.MM1(w,Mean,Stdev, 0,0, .95);
#shoud be equal to GVaR
GVaR==MVaR1
MVaR1

#with m3 and m4 not zero
MVaR1 = mVaR.MM1(1, Mean, Stdev, Skewness, ExKurtosis, .95);
MVaR1

MVaR1 = mVaR.MM1(w, Mean, Stdev, Skewness, ExKurtosis, .95);
MVaR1

This result still looks strange and would appreciate any thoughts, with 
1 or w weights, I get the same just scaled.  Note this is real commodity 
data with all statistics generated by table.Stats.

Thanks

Joe


-- 
*Joe W. Byers*

	[[alternative HTML version deleted]]


From ecjbosu at aol.com  Tue May 23 16:50:37 2017
From: ecjbosu at aol.com (Joe W. Byers)
Date: Tue, 23 May 2017 10:50:37 -0400
Subject: [R-SIG-Finance] Fwd: Re: [Fwd: Performance Analytics internal
 multivariateMoments calculations]
In-Reply-To: <d31d3c8c-007f-f56f-1e67-102cb1f30d8a@braverock.com>
References: <etPan.59239a0d.79a82c52.25e4@kuleuven.be>
 <d31d3c8c-007f-f56f-1e67-102cb1f30d8a@braverock.com>
Message-ID: <11dbf41d-b2ad-c605-4824-b79507164151@aol.com>

Gentlemen,

I so appreciate this feedback.  I do have a followup just so I fully 
understand.  The functions mVaR.MM and mES.MM both require the raw 3rd 
and 4th moments, not the standardized skewness and kurtosis statistics.  
And, would Dries mind sharing the simplified formulas that he mentions.

Again, thank you both very much.


Joe

On 05/23/2017 05:14 AM, Brian G. Peterson wrote:
>
>
>
> -------- Forwarded Message --------
> Subject:     Re: [Fwd: [R-SIG-Finance] Performance Analytics internal 
> multivariateMoments calculations]
> Date:     Tue, 23 May 2017 02:10:21 +0000
> From:     Dries Cornilly <dries.cornilly at kuleuven.be>
> To:     Brian G. Peterson <brian at braverock.com>
>
>
>
> Also, Joe Byers did not run in the same issue. He is confusing the 
> kurtosis and the excess kurtosis.
>
> The function ?kurtosis.MM? in ?mVaR.MM? does not return the excess 
> kurtosis, but rather m4 / sd^4 and hence the -3 still needs to be 
> done. His example where he claims that GVaR and MVaR should return the 
> same is not correct. He uses 0 as fourth order moment in the input, 
> which is only valid for a degenerate distribution. The input for 
> equality should rather be
> GVaR(w, Mean, Stdev, .95)
> MVaR(w, Mean, Stdev, 0, 3 * Stdev^4, .95) # note the difference in 
> fourth moment.
> For a Gaussian the excess kurtosis is zero, or equivalently, the 
> standardised fourth moment (m4 / sd^4) is equal to 3, but the fourth 
> moment of a Gaussian is not equal to zero, it is equal to a function 
> of the variance.
>
> Additionally, he will generate problems when using the skewness input 
> as in his ?corrected? version. The function ?mVaR.MM? takes the raw 
> third order central moment(s) and standardises in the function itself, 
> whereas his altered function will standardise again on the already 
> standardised input and hence give a wrong result.
>
> Regards
> Dries
>
>
> On 22 May 2017 at 20:32:04, Dries Cornilly (dries.cornilly at kuleuven.be 
> <mailto:dries.cornilly at kuleuven.be>) wrote:
>
>> I showed it to Joshua this morning and it seemed like a pure integer
>> problem.
>>
>> library(PerformanceAnalytics)
>> X <- matrix(1:12, ncol = 3)
>> M3.MM(X) # this one behaves strangely (at this time, X is still filled
>> with integers)
>> M3.MM(X * 1.0)  # multiplying by 1.0 to cast to double provides a zero
>> coskewness matrix at it should
>>
>> However, I do have some code replicating the modified VaR and modified
>> Expected shortfall using simplified formulas (coming from a working
>> paper of Doug Martin if I recall correctly). I was going to suggest to
>> replace it since the output is identical and it seems more stable to
>> compute. When I have the alternative moment estimators using the
>> unique elements, it might be a good idea to replace the inside of mVaR
>> and mES using the multivariate moments to work with the vector of
>> unique elements (and extract the unique elements if the full matrices
>> are given). This will be a good memory improvement, especially when
>> computing the portfolio moments for mVaR and mES and the derivatives
>> needed for the component VaR and component ES.
>>
>>
>> Regards
>> Dries
>>
>>
>> On 22 May 2017 at 16:20:22, Brian G. Peterson (brian at braverock.com
>> <mailto:brian at braverock.com>) wrote:
>>
>>> Looks like Joe Byers ran into the same issue you found earlier today.
>>>
>>> -- 
>>> Brian G. Peterson
>>> http://braverock.com/brian/
>>> Ph: 773-459-4973
>>> IM: bgpbraverock
>>>
>>> -------- Forwarded Message --------
>>> From: Joe W. Byers via R-SIG-Finance <r-sig-finance at r-project.org>
>>> Reply-to: "Joe W. Byers" <ecjbosu at aol.com>
>>> To: r-sig-finance at r-project.org
>>> Subject: [R-SIG-Finance] Performance Analytics internal
>>> multivariateMoments calculations
>>> Date: Mon, 22 May 2017 15:59:59 -0400
>>>
>>> All,
>>>
>>>
>>> I have carved on all methods in MultivariateMoments.R so I can all
>>> them
>>> directly
>>>
>>> I am working on the modified var calculations.  I ran the mVaR.MM on
>>> my
>>> data and the results were odd.  I reran setting skewness and kurtosis
>>> to
>>> 0 to compare with GVAR.MM.  Still questions.  I have the following
>>> example
>>>
>>> #test for sigfinance
>>> w = 1000000;
>>> Mean = 0.0001898251;
>>> Stdev = 0.01612464;
>>> ExKurtosis = 3.946156;
>>> Skewness = -0.1373454;
>>>
>>> GVaR = GVaR.MM(w,Mean,Stdev, .95)
>>> GVaR
>>> MVaR = mVaR.MM(w,Mean,Stdev, 0,0, .95);
>>> #shoud be equal to GVaR
>>> GVaR==MVaR
>>> MVaR
>>>
>>> mVaR.MM does not return the GVaR.MM.  I found the exkurt was not zero
>>> as
>>> I think it should be.  I remove the - 3 from that line and exkurt
>>> became
>>> zero and mVaR.MM == GVaR results.  I have included this modified
>>> version
>>> of mVaR.MM below and continued the test.  Is this an issue or am I
>>> missing something?
>>>
>>>
>>> #corrected exkurt calc
>>> mVaR.MM1 = function(w, mu, sigma, M3, M4, p ){
>>>    skew = skewness.MM(w,sigma,M3);
>>>    exkurt = kurtosis.MM(w,sigma,M4); #removed -3
>>>    z = qnorm(1-p);
>>>    zc = z + (1/6)*(z^2 -1)*skew
>>>    Zcf = zc + (1/24)*(z^3 - 3*z)*exkurt - (1/36)*(2*z^3 - 5*z)*skew^2;
>>>    return ( -multivariate_mean(w,mu) - Zcf*StdDev.MM(w,sigma) )
>>> }
>>>
>>> #call revised mVAR.MM with m3 and m4 equal 0
>>> MVaR1 = mVaR.MM1(w,Mean,Stdev, 0,0, .95);
>>> #shoud be equal to GVaR
>>> GVaR==MVaR1
>>> MVaR1
>>>
>>> #with m3 and m4 not zero
>>> MVaR1 = mVaR.MM1(1, Mean, Stdev, Skewness, ExKurtosis, .95);
>>> MVaR1
>>>
>>> MVaR1 = mVaR.MM1(w, Mean, Stdev, Skewness, ExKurtosis, .95);
>>> MVaR1
>>>
>>> This result still looks strange and would appreciate any thoughts,
>>> with
>>> 1 or w weights, I get the same just scaled.  Note this is real
>>> commodity
>>> data with all statistics generated by table.Stats.
>>>
>>> Thanks
>>>
>>> Joe
>>>
>>>
>>> -- 
>>> *Joe W. Byers*
>>>
>>> [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>>> should go.


-- 
*Joe W. Byers*

	[[alternative HTML version deleted]]


From brian at braverock.com  Tue May 23 17:13:12 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 23 May 2017 10:13:12 -0500
Subject: [R-SIG-Finance] [Fwd: Re: Fwd: Re: [Fwd: Performance Analytics
 internal multivariateMoments calculations]]
References: <11dbf41d-b2ad-c605-4824-b79507164151@aol.com>
Message-ID: <1495552392.22804.27.camel@braverock.com>

Dries is our Google Summer of Code student working on this project for
GSoC 2017:

https://github.com/rstats-gsoc/gsoc2017/wiki/Improved-Functionality-for
-Higher-Order-Comoment-Estimation-in-PerformanceAnalytics

A working paper discussing co-moment estimation that goes into more
detail about the sparse forms is here:

https://ssrn.com/abstract=2839781

with supplemental details here:

https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2970015

By the end of summer, all the methods in PerformanceAnalytics should be
using the sparse forms, which offer more than an order of magnitude
faster performance, along with some other improvements for numerical
stability of the estimation, and a framework for more estimating
methods to be added over time.

Regards,

Brian 

-------- Forwarded Message --------
From: Joe W. Byers via R-SIG-Finance <r-sig-finance at r-project.org>
Reply-to: "Joe W. Byers" <ecjbosu at aol.com>
To: Brian G. Peterson <brian at braverock.com>, Dries Cornilly <dries.corn
illy at kuleuven.be>, r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Fwd: Re: [Fwd: Performance Analytics
internal multivariateMoments calculations]
Date: Tue, 23 May 2017 10:50:37 -0400

Gentlemen,

I so appreciate this feedback.??I do have a followup just so I fully?
understand.??The functions mVaR.MM and mES.MM both require the raw 3rd?
and 4th moments, not the standardized skewness and kurtosis
statistics.??
And, would Dries mind sharing the simplified formulas that he mentions.

Again, thank you both very much.


Joe

On 05/23/2017 05:14 AM, Brian G. Peterson wrote:
> 
> 
> 
> -------- Forwarded Message --------
> Subject:?????Re: [Fwd: [R-SIG-Finance] Performance Analytics
> internal?
> multivariateMoments calculations]
> Date:?????Tue, 23 May 2017 02:10:21 +0000
> From:?????Dries Cornilly <dries.cornilly at kuleuven.be>
> To:?????Brian G. Peterson <brian at braverock.com>
> 
> 
> 
> Also, Joe Byers did not run in the same issue. He is confusing the?
> kurtosis and the excess kurtosis.
> 
> The function ?kurtosis.MM? in ?mVaR.MM? does not return the excess?
> kurtosis, but rather m4 / sd^4 and hence the -3 still needs to be?
> done. His example where he claims that GVaR and MVaR should return
> the?
> same is not correct. He uses 0 as fourth order moment in the input,?
> which is only valid for a degenerate distribution. The input for?
> equality should rather be
> GVaR(w, Mean, Stdev, .95)
> MVaR(w, Mean, Stdev, 0, 3 * Stdev^4, .95) # note the difference in?
> fourth moment.
> For a Gaussian the excess kurtosis is zero, or equivalently, the?
> standardised fourth moment (m4 / sd^4) is equal to 3, but the fourth?
> moment of a Gaussian is not equal to zero, it is equal to a function?
> of the variance.
> 
> Additionally, he will generate problems when using the skewness
> input?
> as in his ?corrected? version. The function ?mVaR.MM? takes the raw?
> third order central moment(s) and standardises in the function
> itself,?
> whereas his altered function will standardise again on the already?
> standardised input and hence give a wrong result.
> 
> Regards
> Dries
> 
> 
> On 22 May 2017 at 20:32:04, Dries Cornilly (dries.cornilly at kuleuven.b
> e?
> <mailto:dries.cornilly at kuleuven.be>) wrote:
> 
> > I showed it to Joshua this morning and it seemed like a pure
> > integer
> > problem.
> > 
> > library(PerformanceAnalytics)
> > X <- matrix(1:12, ncol = 3)
> > M3.MM(X) # this one behaves strangely (at this time, X is still
> > filled
> > with integers)
> > M3.MM(X * 1.0)??# multiplying by 1.0 to cast to double provides a
> > zero
> > coskewness matrix at it should
> > 
> > However, I do have some code replicating the modified VaR and
> > modified
> > Expected shortfall using simplified formulas (coming from a working
> > paper of Doug Martin if I recall correctly). I was going to suggest
> > to
> > replace it since the output is identical and it seems more stable
> > to
> > compute. When I have the alternative moment estimators using the
> > unique elements, it might be a good idea to replace the inside of
> > mVaR
> > and mES using the multivariate moments to work with the vector of
> > unique elements (and extract the unique elements if the full
> > matrices
> > are given). This will be a good memory improvement, especially when
> > computing the portfolio moments for mVaR and mES and the
> > derivatives
> > needed for the component VaR and component ES.
> > 
> > 
> > Regards
> > Dries
> > 
> > 
> > On 22 May 2017 at 16:20:22, Brian G. Peterson (brian at braverock.com
> > <mailto:brian at braverock.com>) wrote:
> > 
> > > Looks like Joe Byers ran into the same issue you found earlier
> > > today.
> > > 
> > > --?
> > > Brian G. Peterson
> > > http://braverock.com/brian/
> > > Ph: 773-459-4973
> > > IM: bgpbraverock
> > > 
> > > -------- Forwarded Message --------
> > > From: Joe W. Byers via R-SIG-Finance <r-sig-finance at r-project.org
> > > >
> > > Reply-to: "Joe W. Byers" <ecjbosu at aol.com>
> > > To: r-sig-finance at r-project.org
> > > Subject: [R-SIG-Finance] Performance Analytics internal
> > > multivariateMoments calculations
> > > Date: Mon, 22 May 2017 15:59:59 -0400
> > > 
> > > All,
> > > 
> > > 
> > > I have carved on all methods in MultivariateMoments.R so I can
> > > all
> > > them
> > > directly
> > > 
> > > I am working on the modified var calculations.??I ran the mVaR.MM
> > > on
> > > my
> > > data and the results were odd.??I reran setting skewness and
> > > kurtosis
> > > to
> > > 0 to compare with GVAR.MM.??Still questions.??I have the
> > > following
> > > example
> > > 
> > > #test for sigfinance
> > > w = 1000000;
> > > Mean = 0.0001898251;
> > > Stdev = 0.01612464;
> > > ExKurtosis = 3.946156;
> > > Skewness = -0.1373454;
> > > 
> > > GVaR = GVaR.MM(w,Mean,Stdev, .95)
> > > GVaR
> > > MVaR = mVaR.MM(w,Mean,Stdev, 0,0, .95);
> > > #shoud be equal to GVaR
> > > GVaR==MVaR
> > > MVaR
> > > 
> > > mVaR.MM does not return the GVaR.MM.??I found the exkurt was not
> > > zero
> > > as
> > > I think it should be.??I remove the - 3 from that line and exkurt
> > > became
> > > zero and mVaR.MM == GVaR results.??I have included this modified
> > > version
> > > of mVaR.MM below and continued the test.??Is this an issue or am
> > > I
> > > missing something?
> > > 
> > > 
> > > #corrected exkurt calc
> > > mVaR.MM1 = function(w, mu, sigma, M3, M4, p ){
> > > ???skew = skewness.MM(w,sigma,M3);
> > > ???exkurt = kurtosis.MM(w,sigma,M4); #removed -3
> > > ???z = qnorm(1-p);
> > > ???zc = z + (1/6)*(z^2 -1)*skew
> > > ???Zcf = zc + (1/24)*(z^3 - 3*z)*exkurt - (1/36)*(2*z^3 -
> > > 5*z)*skew^2;
> > > ???return ( -multivariate_mean(w,mu) - Zcf*StdDev.MM(w,sigma) )
> > > }
> > > 
> > > #call revised mVAR.MM with m3 and m4 equal 0
> > > MVaR1 = mVaR.MM1(w,Mean,Stdev, 0,0, .95);
> > > #shoud be equal to GVaR
> > > GVaR==MVaR1
> > > MVaR1
> > > 
> > > #with m3 and m4 not zero
> > > MVaR1 = mVaR.MM1(1, Mean, Stdev, Skewness, ExKurtosis, .95);
> > > MVaR1
> > > 
> > > MVaR1 = mVaR.MM1(w, Mean, Stdev, Skewness, ExKurtosis, .95);
> > > MVaR1
> > > 
> > > This result still looks strange and would appreciate any
> > > thoughts,
> > > with
> > > 1 or w weights, I get the same just scaled.??Note this is real
> > > commodity
> > > data with all statistics generated by table.Stats.
> > > 
> > > Thanks
> > > 
> > > Joe
> > > 
> > > 
> > > --?
> > > *Joe W. Byers*
> > >


From rjkft at yahoo.com  Wed May 24 17:25:30 2017
From: rjkft at yahoo.com (John Kumar)
Date: Wed, 24 May 2017 17:25:30 +0200
Subject: [R-SIG-Finance] Error in addTxn - Quantstrat
Message-ID: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>

Hi All,
If I take the basic luxor strategy (which trades) and change the instrument
to AAPL or another stock, getSymbols method and to date it gives me the
following error:

Error in addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,
: 
  Transactions must be added in order. TxnDate (2003-01-22) is before last
transaction in portfolio (2003-01-17) for AAPL
In addition: Warning messages:
1: In addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,  :
  Incompatible methods ("Ops.Date", "Ops.POSIXt") for "<"
2: In addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,  :
  Incompatible methods ("Ops.Date", "Ops.POSIXt") for "<"

I have also experienced this error with other quantstrat scripts that worked
prior to upgrading to R 3.4 and blotter 0.11.3. I cannot find any other
mentions of this error and am wondering what I am missing here? Something to
do with date format? 
Minimal reproducible example below(Note: R 3.4, blotter 0.11.3,quantstrat
0.10.0,quantmod 0.4-8 produced error WORKS with R 3.3, blotter
0.9.1741,quantstrat 0.9.1739, quantmod 0.4-8) .
Cheers John

require(quantstrat)

Sys.setenv(TZ="UTC")

###

startDate = '2002-10-21'

.from=startDate

.to='2012-10-31'

strategy.st = 'luxor'
portfolio.st = 'forex'
account.st = 'IB'

.orderqty = 100000
.threshold = 0.0005
.txnfees = -6		# round-trip fee
.fast = 10
.slow = 30

currency(c('GBP', 'USD'))

stock('AAPL', currency = "USD", multiplier = 1)

### quantmod

getSymbols("AAPL", from = .from, to=.to)

### blotter

initPortf(portfolio.st, symbols='AAPL', currency='USD')
initAcct(account.st, portfolios=portfolio.st, currency='USD')

### quantstrat

initOrders(portfolio.st)

### define strategy

strategy(strategy.st, store=TRUE)

### indicators

add.indicator(strategy.st, name = "SMA",
              arguments = list(
                x = quote(Cl(mktdata)[,1]),
                n = .fast
              ),
              label="nFast"
)

add.indicator(strategy.st, name="SMA",
              arguments = list(
                x = quote(Cl(mktdata)[,1]),
                n = .slow
              ),
              label="nSlow"
)

### signals

add.signal(strategy.st, name='sigCrossover',
           arguments = list(
             columns=c("nFast","nSlow"),
             relationship="gte"
           ),
           label='long'
)

add.signal(strategy.st, name='sigCrossover',
           arguments = list(
             columns=c("nFast","nSlow"),
             relationship="lt"
           ),
           label='short'
)

### rules

add.rule(strategy.st, name='ruleSignal',
         arguments=list(sigcol='long' , sigval=TRUE,
                        orderside='short',
                        ordertype='market',
                        orderqty='all',
                        TxnFees=.txnfees,
                        replace=TRUE
         ),
         type='exit',
         label='Exit2LONG'
)

add.rule(strategy.st, name='ruleSignal',
         arguments=list(sigcol='short', sigval=TRUE,
                        orderside='long' ,
                        ordertype='market',
                        orderqty='all',
                        TxnFees=.txnfees,
                        replace=TRUE
         ),
         type='exit',
         label='Exit2SHORT'
)

add.rule(strategy.st, name='ruleSignal',
         arguments=list(sigcol='long' , sigval=TRUE,
                        orderside='long' ,
                        ordertype='stoplimit', prefer='High',
threshold=.threshold,
                        orderqty=+.orderqty,
                        replace=FALSE
         ),
         type='enter',
         label='EnterLONG'
)

add.rule(strategy.st, name='ruleSignal',
         arguments=list(sigcol='short', sigval=TRUE,
                        orderside='short',
                        ordertype='stoplimit', prefer='Low',
threshold=-.threshold,
                        orderqty=-.orderqty,
                        replace=FALSE
         ),
         type='enter',
         label='EnterSHORT'
)

############################################################################
###

applyStrategy(strategy.st, portfolio.st)


From josh.m.ulrich at gmail.com  Wed May 24 19:45:40 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 24 May 2017 12:45:40 -0500
Subject: [R-SIG-Finance] Error in addTxn - Quantstrat
In-Reply-To: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
References: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
Message-ID: <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>

This is a bug that was introduced here:
https://github.com/braverock/blotter/commit/24b578628415111885d29ef97d5ab0eed1c7bb75

Here's a *minimal* reproducible example:
require(blotter)
currency("USD")
initPortf("test", symbols="AAPL", currency="USD")

addTxn("test", "AAPL", as.Date("2017-01-01"),  1, 10)
addTxn("test", "AAPL", as.Date("2017-01-02"), -1, 10)

Thanks for the report!  I'll work on a fix.

Best,
Josh


On Wed, May 24, 2017 at 10:25 AM, John Kumar via R-SIG-Finance
<r-sig-finance at r-project.org> wrote:
> Hi All,
> If I take the basic luxor strategy (which trades) and change the instrument
> to AAPL or another stock, getSymbols method and to date it gives me the
> following error:
>
> Error in addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,
> :
>   Transactions must be added in order. TxnDate (2003-01-22) is before last
> transaction in portfolio (2003-01-17) for AAPL
> In addition: Warning messages:
> 1: In addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,  :
>   Incompatible methods ("Ops.Date", "Ops.POSIXt") for "<"
> 2: In addTxn(Portfolio = portfolio, Symbol = symbol, TxnDate = txntime,  :
>   Incompatible methods ("Ops.Date", "Ops.POSIXt") for "<"
>
> I have also experienced this error with other quantstrat scripts that worked
> prior to upgrading to R 3.4 and blotter 0.11.3. I cannot find any other
> mentions of this error and am wondering what I am missing here? Something to
> do with date format?
> Minimal reproducible example below(Note: R 3.4, blotter 0.11.3,quantstrat
> 0.10.0,quantmod 0.4-8 produced error WORKS with R 3.3, blotter
> 0.9.1741,quantstrat 0.9.1739, quantmod 0.4-8) .
> Cheers John
>
> require(quantstrat)
>
> Sys.setenv(TZ="UTC")
>
> ###
>
> startDate = '2002-10-21'
>
> .from=startDate
>
> .to='2012-10-31'
>
> strategy.st = 'luxor'
> portfolio.st = 'forex'
> account.st = 'IB'
>
> .orderqty = 100000
> .threshold = 0.0005
> .txnfees = -6           # round-trip fee
> .fast = 10
> .slow = 30
>
> currency(c('GBP', 'USD'))
>
> stock('AAPL', currency = "USD", multiplier = 1)
>
> ### quantmod
>
> getSymbols("AAPL", from = .from, to=.to)
>
> ### blotter
>
> initPortf(portfolio.st, symbols='AAPL', currency='USD')
> initAcct(account.st, portfolios=portfolio.st, currency='USD')
>
> ### quantstrat
>
> initOrders(portfolio.st)
>
> ### define strategy
>
> strategy(strategy.st, store=TRUE)
>
> ### indicators
>
> add.indicator(strategy.st, name = "SMA",
>               arguments = list(
>                 x = quote(Cl(mktdata)[,1]),
>                 n = .fast
>               ),
>               label="nFast"
> )
>
> add.indicator(strategy.st, name="SMA",
>               arguments = list(
>                 x = quote(Cl(mktdata)[,1]),
>                 n = .slow
>               ),
>               label="nSlow"
> )
>
> ### signals
>
> add.signal(strategy.st, name='sigCrossover',
>            arguments = list(
>              columns=c("nFast","nSlow"),
>              relationship="gte"
>            ),
>            label='long'
> )
>
> add.signal(strategy.st, name='sigCrossover',
>            arguments = list(
>              columns=c("nFast","nSlow"),
>              relationship="lt"
>            ),
>            label='short'
> )
>
> ### rules
>
> add.rule(strategy.st, name='ruleSignal',
>          arguments=list(sigcol='long' , sigval=TRUE,
>                         orderside='short',
>                         ordertype='market',
>                         orderqty='all',
>                         TxnFees=.txnfees,
>                         replace=TRUE
>          ),
>          type='exit',
>          label='Exit2LONG'
> )
>
> add.rule(strategy.st, name='ruleSignal',
>          arguments=list(sigcol='short', sigval=TRUE,
>                         orderside='long' ,
>                         ordertype='market',
>                         orderqty='all',
>                         TxnFees=.txnfees,
>                         replace=TRUE
>          ),
>          type='exit',
>          label='Exit2SHORT'
> )
>
> add.rule(strategy.st, name='ruleSignal',
>          arguments=list(sigcol='long' , sigval=TRUE,
>                         orderside='long' ,
>                         ordertype='stoplimit', prefer='High',
> threshold=.threshold,
>                         orderqty=+.orderqty,
>                         replace=FALSE
>          ),
>          type='enter',
>          label='EnterLONG'
> )
>
> add.rule(strategy.st, name='ruleSignal',
>          arguments=list(sigcol='short', sigval=TRUE,
>                         orderside='short',
>                         ordertype='stoplimit', prefer='Low',
> threshold=-.threshold,
>                         orderqty=-.orderqty,
>                         replace=FALSE
>          ),
>          type='enter',
>          label='EnterSHORT'
> )
>
> ############################################################################
> ###
>
> applyStrategy(strategy.st, portfolio.st)
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From daniel.cegielka at gmail.com  Wed May 24 20:10:56 2017
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Wed, 24 May 2017 20:10:56 +0200
Subject: [R-SIG-Finance] Error in addTxn - Quantstrat
In-Reply-To: <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>
References: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
 <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>
Message-ID: <CAPLrYERQFWwx_uBR7fL+eehjw0rHrtxkdYTdGbHwXo8_TQYRdg@mail.gmail.com>

2017-05-24 19:45 GMT+02:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>
> This is a bug that was introduced here:
> https://github.com/braverock/blotter/commit/24b578628415111885d29ef97d5ab0eed1c7bb75


https://github.com/braverock/blotter/commit/24b578628415111885d29ef97d5ab0eed1c7bb75#diff-7347fe5a0f184f79ef064e92e3beb297R69

https://github.com/braverock/blotter/blob/master/R/addTxn.R#L85

why end() from stats?

https://github.com/braverock/blotter/blob/master/R/addTxn.R#L154

Should be end.xts(), eg:

end.xts <- function (x, ...)
{
    if (!length(x)) {
        index(x[length(.index(x)), ])
    } else
        index(x[NROW(x), ])
}

If I understood the problem correctly...

Best,
Daniel


>
>
>
> Here's a *minimal* reproducible example:
> require(blotter)
> currency("USD")
> initPortf("test", symbols="AAPL", currency="USD")
>
> addTxn("test", "AAPL", as.Date("2017-01-01"),  1, 10)
> addTxn("test", "AAPL", as.Date("2017-01-02"), -1, 10)
>
> Thanks for the report!  I'll work on a fix.
>
> Best,
> Josh
>


From daniel.cegielka at gmail.com  Wed May 24 21:37:17 2017
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Wed, 24 May 2017 21:37:17 +0200
Subject: [R-SIG-Finance] Fwd:  Error in addTxn - Quantstrat
In-Reply-To: <CAPLrYERFdNPLPfYrKVn45iKSCLWDvaL+HnbG4=nscN2BML5guw@mail.gmail.com>
References: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
 <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>
 <CAPLrYERU5V6daDiZJfKXJM0xaP-LuJGKgmdQ6oT+V7=BwJ_Xyw@mail.gmail.com>
 <CAPLrYERFdNPLPfYrKVn45iKSCLWDvaL+HnbG4=nscN2BML5guw@mail.gmail.com>
Message-ID: <CAPLrYES35G7B3KqLm0gGLYC3757uqAhPd4qyq6zwATX8k6gPDw@mail.gmail.com>

---------- Forwarded message ----------



ok, I found a bug.

https://github.com/braverock/blotter/blob/master/R/addTxn.R#L81

as.Date("2017-01-01") return time-based object:

if(!is.timeBased(TxnDate) ){
TxnDate<-as.POSIXct(TxnDate)
}

and TxnDate != POSIXct

Best,
Daniel
-------------- next part --------------
diff -urN blotter.orig/R/addTxn.R blotter/R/addTxn.R
--- blotter.orig/R/addTxn.R	2017-05-24 21:24:42.000000000 +0200
+++ blotter/R/addTxn.R	2017-05-24 21:27:01.000000000 +0200
@@ -78,9 +78,10 @@
 
     PrevPosQty = getPosQty(pname, Symbol, TxnDate)
     
-    if(!is.timeBased(TxnDate) ){
+    if(is.timeBased(TxnDate) ){
         TxnDate<-as.POSIXct(TxnDate)
-    }
+    } else
+        stop("TxnDate requires an appropriate time-based object")
 
     lastTxnDate <- end(Portfolio$symbols[[Symbol]]$txn)
     if (TxnDate < lastTxnDate) {

From josh.m.ulrich at gmail.com  Wed May 24 22:30:49 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 24 May 2017 15:30:49 -0500
Subject: [R-SIG-Finance] Error in addTxn - Quantstrat
In-Reply-To: <CAPLrYERQFWwx_uBR7fL+eehjw0rHrtxkdYTdGbHwXo8_TQYRdg@mail.gmail.com>
References: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
 <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>
 <CAPLrYERQFWwx_uBR7fL+eehjw0rHrtxkdYTdGbHwXo8_TQYRdg@mail.gmail.com>
Message-ID: <CAPPM_gRRF0WGxD1bQiqJnO6Jow0dBoRD=MV57pM7t2hLOe2cgw@mail.gmail.com>

On Wed, May 24, 2017 at 1:10 PM, Daniel Cegie?ka
<daniel.cegielka at gmail.com> wrote:
> 2017-05-24 19:45 GMT+02:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>>
>> This is a bug that was introduced here:
>> https://github.com/braverock/blotter/commit/24b578628415111885d29ef97d5ab0eed1c7bb75
>
>
> https://github.com/braverock/blotter/commit/24b578628415111885d29ef97d5ab0eed1c7bb75#diff-7347fe5a0f184f79ef064e92e3beb297R69
>
> https://github.com/braverock/blotter/blob/master/R/addTxn.R#L85
>
> why end() from stats?
>
Because stats::end is the generic.

> https://github.com/braverock/blotter/blob/master/R/addTxn.R#L154
>
> Should be end.xts(), eg:
>
end.xts() is not exported from the xts namespace.  And it's generally
a bad idea to call methods directly, because you do not know if that
method will be able to handle objects of different classes.

> end.xts <- function (x, ...)
> {
>     if (!length(x)) {
>         index(x[length(.index(x)), ])
>     } else
>         index(x[NROW(x), ])
> }
>
> If I understood the problem correctly...
>
> Best,
> Daniel
>
>
>>
>>
>>
>> Here's a *minimal* reproducible example:
>> require(blotter)
>> currency("USD")
>> initPortf("test", symbols="AAPL", currency="USD")
>>
>> addTxn("test", "AAPL", as.Date("2017-01-01"),  1, 10)
>> addTxn("test", "AAPL", as.Date("2017-01-02"), -1, 10)
>>
>> Thanks for the report!  I'll work on a fix.
>>
>> Best,
>> Josh
>>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Wed May 24 22:33:12 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 24 May 2017 15:33:12 -0500
Subject: [R-SIG-Finance] Fwd: Error in addTxn - Quantstrat
In-Reply-To: <CAPLrYES35G7B3KqLm0gGLYC3757uqAhPd4qyq6zwATX8k6gPDw@mail.gmail.com>
References: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
 <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>
 <CAPLrYERU5V6daDiZJfKXJM0xaP-LuJGKgmdQ6oT+V7=BwJ_Xyw@mail.gmail.com>
 <CAPLrYERFdNPLPfYrKVn45iKSCLWDvaL+HnbG4=nscN2BML5guw@mail.gmail.com>
 <CAPLrYES35G7B3KqLm0gGLYC3757uqAhPd4qyq6zwATX8k6gPDw@mail.gmail.com>
Message-ID: <CAPPM_gS1ZOn++5ymPx3Z9ndKFg3OEoePnMo9EUVreCdQMQnenA@mail.gmail.com>

On Wed, May 24, 2017 at 2:37 PM, Daniel Cegie?ka
<daniel.cegielka at gmail.com> wrote:
>
> ok, I found a bug.
>
> https://github.com/braverock/blotter/blob/master/R/addTxn.R#L81
>
> as.Date("2017-01-01") return time-based object:
>
> if(!is.timeBased(TxnDate) ){
> TxnDate<-as.POSIXct(TxnDate)
> }
>
> and TxnDate != POSIXct
>
Yes, I arrived at the same conclusion before I sent my initial email.
I mentioned it in the bug report I created:
https://github.com/braverock/blotter/issues/51

Apologies for not mentioning it in the email... there was no need for
you to spend time on it.

> Best,
> Daniel
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From rjkft at yahoo.com  Wed May 24 22:46:38 2017
From: rjkft at yahoo.com (John Kumar)
Date: Wed, 24 May 2017 22:46:38 +0200
Subject: [R-SIG-Finance] Error in addTxn - Quantstrat
In-Reply-To: <CAPPM_gRRF0WGxD1bQiqJnO6Jow0dBoRD=MV57pM7t2hLOe2cgw@mail.gmail.com>
References: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
 <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>
 <CAPLrYERQFWwx_uBR7fL+eehjw0rHrtxkdYTdGbHwXo8_TQYRdg@mail.gmail.com>
 <CAPPM_gRRF0WGxD1bQiqJnO6Jow0dBoRD=MV57pM7t2hLOe2cgw@mail.gmail.com>
Message-ID: <00d201d2d4ce$d86d7810$89486830$@yahoo.com>

Thanks for taking the time to look at this guys. Sorry for the verbose example but minimal means different things to different people depending on their skills, or lack thereof in my case. Cheers
John

-----Original Message-----
From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com] 
Sent: Wednesday, 24 May 2017 10:31 PM
To: Daniel Cegie?ka <daniel.cegielka at gmail.com>
Cc: John Kumar <rjkft at yahoo.com>; r-sig-finance <R-SIG-Finance at r-project.org>
Subject: Re: [R-SIG-Finance] Error in addTxn - Quantstrat

On Wed, May 24, 2017 at 1:10 PM, Daniel Cegie?ka <daniel.cegielka at gmail.com> wrote:
> 2017-05-24 19:45 GMT+02:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>>
>> This is a bug that was introduced here:
>> https://github.com/braverock/blotter/commit/24b578628415111885d29ef97
>> d5ab0eed1c7bb75
>
>
> https://github.com/braverock/blotter/commit/24b578628415111885d29ef97d
> 5ab0eed1c7bb75#diff-7347fe5a0f184f79ef064e92e3beb297R69
>
> https://github.com/braverock/blotter/blob/master/R/addTxn.R#L85
>
> why end() from stats?
>
Because stats::end is the generic.

> https://github.com/braverock/blotter/blob/master/R/addTxn.R#L154
>
> Should be end.xts(), eg:
>
end.xts() is not exported from the xts namespace.  And it's generally a bad idea to call methods directly, because you do not know if that method will be able to handle objects of different classes.

> end.xts <- function (x, ...)
> {
>     if (!length(x)) {
>         index(x[length(.index(x)), ])
>     } else
>         index(x[NROW(x), ])
> }
>
> If I understood the problem correctly...
>
> Best,
> Daniel
>
>
>>
>>
>>
>> Here's a *minimal* reproducible example:
>> require(blotter)
>> currency("USD")
>> initPortf("test", symbols="AAPL", currency="USD")
>>
>> addTxn("test", "AAPL", as.Date("2017-01-01"),  1, 10) addTxn("test", 
>> "AAPL", as.Date("2017-01-02"), -1, 10)
>>
>> Thanks for the report!  I'll work on a fix.
>>
>> Best,
>> Josh
>>



--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Thu May 25 21:39:21 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 25 May 2017 14:39:21 -0500
Subject: [R-SIG-Finance] Error in addTxn - Quantstrat
In-Reply-To: <00d201d2d4ce$d86d7810$89486830$@yahoo.com>
References: <00b301d2d4a1$fb741e40$f25c5ac0$@yahoo.com>
 <CAPPM_gRnZnhcDYr246t9r_ZfjVEP2UdV-KQO6=Y8ohN9XiGZVw@mail.gmail.com>
 <CAPLrYERQFWwx_uBR7fL+eehjw0rHrtxkdYTdGbHwXo8_TQYRdg@mail.gmail.com>
 <CAPPM_gRRF0WGxD1bQiqJnO6Jow0dBoRD=MV57pM7t2hLOe2cgw@mail.gmail.com>
 <00d201d2d4ce$d86d7810$89486830$@yahoo.com>
Message-ID: <CAPPM_gQ0X=trdPCvhS+OwtQHOgSwL5YNSP3gVvZUGjL=d+seFA@mail.gmail.com>

This is now fixed in:
https://github.com/braverock/blotter/commit/537f7870665859346a1157b2bc786c6d7325f6fb

Thanks for the report!

On Wed, May 24, 2017 at 3:46 PM, John Kumar <rjkft at yahoo.com> wrote:

> Thanks for taking the time to look at this guys. Sorry for the verbose
> example but minimal means different things to different people depending on
> their skills, or lack thereof in my case. Cheers
> John
>
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
> Sent: Wednesday, 24 May 2017 10:31 PM
> To: Daniel Cegie?ka <daniel.cegielka at gmail.com>
> Cc: John Kumar <rjkft at yahoo.com>; r-sig-finance <
> R-SIG-Finance at r-project.org>
> Subject: Re: [R-SIG-Finance] Error in addTxn - Quantstrat
>
> On Wed, May 24, 2017 at 1:10 PM, Daniel Cegie?ka <
> daniel.cegielka at gmail.com> wrote:
> > 2017-05-24 19:45 GMT+02:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
> >>
> >> This is a bug that was introduced here:
> >> https://github.com/braverock/blotter/commit/24b578628415111885d29ef97
> >> d5ab0eed1c7bb75
> >
> >
> > https://github.com/braverock/blotter/commit/24b578628415111885d29ef97d
> > 5ab0eed1c7bb75#diff-7347fe5a0f184f79ef064e92e3beb297R69
> >
> > https://github.com/braverock/blotter/blob/master/R/addTxn.R#L85
> >
> > why end() from stats?
> >
> Because stats::end is the generic.
>
> > https://github.com/braverock/blotter/blob/master/R/addTxn.R#L154
> >
> > Should be end.xts(), eg:
> >
> end.xts() is not exported from the xts namespace.  And it's generally a
> bad idea to call methods directly, because you do not know if that method
> will be able to handle objects of different classes.
>
> > end.xts <- function (x, ...)
> > {
> >     if (!length(x)) {
> >         index(x[length(.index(x)), ])
> >     } else
> >         index(x[NROW(x), ])
> > }
> >
> > If I understood the problem correctly...
> >
> > Best,
> > Daniel
> >
> >
> >>
> >>
> >>
> >> Here's a *minimal* reproducible example:
> >> require(blotter)
> >> currency("USD")
> >> initPortf("test", symbols="AAPL", currency="USD")
> >>
> >> addTxn("test", "AAPL", as.Date("2017-01-01"),  1, 10) addTxn("test",
> >> "AAPL", as.Date("2017-01-02"), -1, 10)
> >>
> >> Thanks for the report!  I'll work on a fix.
> >>
> >> Best,
> >> Josh
> >>
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>
>


-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com

	[[alternative HTML version deleted]]


From atakanokan at outlook.com  Fri May 26 12:34:15 2017
From: atakanokan at outlook.com (Atakan Okan)
Date: Fri, 26 May 2017 10:34:15 +0000
Subject: [R-SIG-Finance] Adding "Stoploss disabled" to the parameter
 distribution for apply.paramset
Message-ID: <HE1PR03MB18828D5E31B8F21EFB88B030C7FC0@HE1PR03MB1882.eurprd03.prod.outlook.com>

Hi,


Is it possible to add a "disabled" option to the parameter distribution (for stoploss, stoptrailing, takeprofit)? So the typical parameter distribution contains a vector of integers, but how would I go about adding the "disabled stoploss" configuration to the parameter distribution? Adding "0" to the parameter distribution did not disable stoploss/takeprofit but made them execute immediately when there is a price change.


Thanks,


Atakan Okan



	[[alternative HTML version deleted]]


From brian at braverock.com  Fri May 26 13:24:52 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 26 May 2017 06:24:52 -0500
Subject: [R-SIG-Finance] Adding "Stoploss disabled" to the parameter
 distribution for apply.paramset
In-Reply-To: <HE1PR03MB18828D5E31B8F21EFB88B030C7FC0@HE1PR03MB1882.eurprd03.prod.outlook.com>
References: <HE1PR03MB18828D5E31B8F21EFB88B030C7FC0@HE1PR03MB1882.eurprd03.prod.outlook.com>
Message-ID: <1495797892.1523.21.camel@braverock.com>

On Fri, 2017-05-26 at 10:34 +0000, Atakan Okan wrote:
> Is it possible to add a "disabled" option to the parameter
> distribution (for stoploss, stoptrailing, takeprofit)? So the typical
> parameter distribution contains a vector of integers, but how would I
> go about adding the "disabled stoploss" configuration to the
> parameter distribution? Adding "0" to the parameter distribution did
> not disable stoploss/takeprofit but made them execute immediately
> when there is a price change.

paramsets are designed for *parameters*.

So they aren't really designed for enabling or disabling rules.  That
said, in theory you can change any element of the specification.

Something like this might work (untested, I have a meeting to run to),
please report back:

assume your rule is labeled 'my.stop'


add.distribution( strategy=strategy.st
                , paramset.label='stop.onoff'
                , component.type='exit'
                , component.label='my.stop'
                , variable = list(enabled = c(TRUE,FALSE))
                , label = 'onoff.test'
                )


Please let us know, and if this doesn't work, maybe create a really
minimal example and we'll look more closely.

Regards,

Brian


From cduranceau at nial.ky  Fri May 26 17:33:33 2017
From: cduranceau at nial.ky (Charles Duranceau)
Date: Fri, 26 May 2017 15:33:33 +0000
Subject: [R-SIG-Finance]   RQuantLib FixedRateBondYield close to maturity
Message-ID: <253B4FA1ECEEB54DB661809CB6773455F69B4404@NOR-EXC01.northview.local>


Hi,
I try to back-out the yield from a US Treasury note giving clean price using the function "FixedRateBondYield".
The procedure generate an error (See below).

Is this a structural problem or could it be correct by changing the bond settings ( I tried several changes already)?
Thank you
Charles


In this reproducible example, I try to back-out the yield for a bond maturing on 31-Dec-2016 as of (value date) 30-Dec-2016 (Friday).

library("RQuantLib")

dateValue<-as.Date("2016-12-30")

setEvaluationDate(dateValue)
# US Treasury note fixed attributes
gen_bond_UST =list(asettlementDays=1,afaceAmount= 100,aperiod=3,acalendar="UnitedStates/GovernmentBond",adayCounter=2,
                   abusinessDayConvention=2 ,acompound = 1 ,aredemption=100 ,aissueDate=as.Date("2014-01-31"),aendOfMonth=0)

# Function
with(gen_bond_UST,FixedRateBondYield(price=100.0078,effectiveDate=dateValue,maturityDate=as.Date("2016-12-31") ,rates=0.00625,
                   calendar=acalendar,settlementDays=asettlementDays,faceAmount= afaceAmount,period=aperiod,dayCounter=adayCounter,
                   businessDayConvention=abusinessDayConvention ,compound = acompound ,redemption=aredemption,issueDate=aissueDate))

# output
Error in fixedRateBondYieldByPriceEngine(settlementDays, price, calendar,  :
  degenerate single date (December 30th, 2016) schedule
seed date: December 31st, 2016
exit date: December 30th, 2016
effective date: December 30th, 2016
first date: null date
next to last date: null date
termination date: December 31st, 2016
generation rule: Backward
end of month: 0


> sessionInfo()

R version 3.3.2 (2016-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)

Running under: Windows >= 8 x64 (build 9200)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252

[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] RQuantLib_0.4.3



loaded via a namespace (and not attached):

[1] zoo_1.8-0       tools_3.3.2     Rcpp_0.12.10    grid_3.3.2      lattice_0.20-34



	[[alternative HTML version deleted]]


From cduranceau at nial.ky  Fri May 26 17:46:13 2017
From: cduranceau at nial.ky (Charles Duranceau)
Date: Fri, 26 May 2017 15:46:13 +0000
Subject: [R-SIG-Finance]  RQuantLib: AmericanOptionImpliedVolatility bug
In-Reply-To: <253B4FA1ECEEB54DB661809CB677345537E9E333@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB677345537E9E333@NOR-EXC01.northview.local>
Message-ID: <253B4FA1ECEEB54DB661809CB6773455F69B4624@NOR-EXC01.northview.local>

Hi,

I found a problem with the function "AmericanOptionImpliedVolatility" in RQantLib which return an error for a specific set of conditions (but cannot identifies exactly what are these).
I present a case related to a short term, very deep in-the-money put with negative interest rate that generate error message. I present a reproducible example below.
I found the related function "AmericanOption" with default produce similar error when use in a routine to back-out the implied volatility.
However, I found good result (no error)  when using the engine="CrankNicolson" :  a na?ve routine for backing-out the implied vol with this function return a volatility.
There's a work around but think this information may add more stability to RQL.

Best Regards
Charles


Case
RQuantLib Version 4.2

R version 3.3.2 (64bits)

library(RQuantLib)

price = 14.5
strike = 65
Spot= 50.5
Rate = -0.00361
DividendYield = 0
Volatility = 0.296
YearToMaturity = 3/365

# error when Implied Vol
AmericanOptionImpliedVolatility("put", price,Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)

Error in americanOptionImpliedVolatilityEngine(type, value, underlying,  :

../../../QuantLib-1.6.2/ql/math/solver1d.hpp:202: In function `QuantLib::Real QuantLib::Solver1D<Impl>::solve(const F&, QuantLib::Real, QuantLib::Real, QuantLib::Real, QuantLib::Real) const [with F = QuantLib::{anonymous}::PriceError; Impl = QuantLib::Brent; QuantLib::Real = double]':
root not bracketed: f[1e-007,4] -> [1.955446e-003,3.006858e+000]

#also generate error
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)

# works well
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility,timeSteps=150, gridPoints=149, engine="CrankNicolson")
# backing out the implied vol naively works
fImpliedVol(Volatility,price,"put", Spot, strike, DividendYield, Rate,YearToMaturity)


fImpliedVol<-function(iniVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat){
  ftm<-function(ImpVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat, iVol)
  {
    ov<-AmericanOption(type=Callput, underlying=Spot, strike=Strike,dividendYield=DivYield, riskFreeRate=Rate, maturity=YrtoMat,volatility=ImpVol,
                       timeSteps=150, gridPoints=149, engine= "CrankNicolson")
    er<-(Premium-ov$value)^2
  }
  imp<-optimize(f=ftm,c(lower = 0, upper = 1.5), tol = 1e-4,Premium,Callput,Spot, Strike, DivYield, Rate,YrtoMat)
  return(imp$minimum)
}

> sessionInfo()
R version 3.3.2 (2016-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows >= 8 x64 (build 9200)

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RQuantLib_0.4.3 dplyr_0.5.0

loaded via a namespace (and not attached):
[1] zoo_1.8-0        magrittr_1.5     R6_2.1.2         assertthat_0.2.0 DBI_0.6-1        tools_3.3.2      tibble_1.0       Rcpp_0.12.10
 [9] grid_3.3.2       lattice_0.20-34


>




	[[alternative HTML version deleted]]


From tleitch1 at jhu.edu  Fri May 26 20:52:20 2017
From: tleitch1 at jhu.edu (Terry Leitch)
Date: Fri, 26 May 2017 18:52:20 +0000
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity
In-Reply-To: <253B4FA1ECEEB54DB661809CB6773455F69B4404@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB6773455F69B4404@NOR-EXC01.northview.local>
Message-ID: <BLUPR0101MB150651C5BA71D80D0375BA5D8DFC0@BLUPR0101MB1506.prod.exchangelabs.com>

Not sure, but maturity=effectivedate+1 . Since setllementDays=1, the bond matures on the same day you pay for it. Was that your intention?

________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Charles Duranceau <cduranceau at nial.ky>
Sent: Friday, May 26, 2017 11:33:33 AM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


Hi,
I try to back-out the yield from a US Treasury note giving clean price using the function "FixedRateBondYield".
The procedure generate an error (See below).

Is this a structural problem or could it be correct by changing the bond settings ( I tried several changes already)?
Thank you
Charles


In this reproducible example, I try to back-out the yield for a bond maturing on 31-Dec-2016 as of (value date) 30-Dec-2016 (Friday).

library("RQuantLib")

dateValue<-as.Date("2016-12-30")

setEvaluationDate(dateValue)
# US Treasury note fixed attributes
gen_bond_UST =list(asettlementDays=1,afaceAmount= 100,aperiod=3,acalendar="UnitedStates/GovernmentBond",adayCounter=2,
                   abusinessDayConvention=2 ,acompound = 1 ,aredemption=100 ,aissueDate=as.Date("2014-01-31"),aendOfMonth=0)

# Function
with(gen_bond_UST,FixedRateBondYield(price=100.0078,effectiveDate=dateValue,maturityDate=as.Date("2016-12-31") ,rates=0.00625,
                   calendar=acalendar,settlementDays=asettlementDays,faceAmount= afaceAmount,period=aperiod,dayCounter=adayCounter,
                   businessDayConvention=abusinessDayConvention ,compound = acompound ,redemption=aredemption,issueDate=aissueDate))

# output
Error in fixedRateBondYieldByPriceEngine(settlementDays, price, calendar,  :
  degenerate single date (December 30th, 2016) schedule
seed date: December 31st, 2016
exit date: December 30th, 2016
effective date: December 30th, 2016
first date: null date
next to last date: null date
termination date: December 31st, 2016
generation rule: Backward
end of month: 0


> sessionInfo()

R version 3.3.2 (2016-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)

Running under: Windows >= 8 x64 (build 9200)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252

[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] RQuantLib_0.4.3



loaded via a namespace (and not attached):

[1] zoo_1.8-0       tools_3.3.2     Rcpp_0.12.10    grid_3.3.2      lattice_0.20-34



        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From rharlow86 at gmail.com  Fri May 26 22:31:32 2017
From: rharlow86 at gmail.com (Robert Harlow)
Date: Fri, 26 May 2017 16:31:32 -0400
Subject: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug
In-Reply-To: <253B4FA1ECEEB54DB661809CB6773455F69B4624@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB677345537E9E333@NOR-EXC01.northview.local>
 <253B4FA1ECEEB54DB661809CB6773455F69B4624@NOR-EXC01.northview.local>
Message-ID: <CAHdfS94+zS5Qt+xMDRkL4M04p832RFB05N+5qu0aLuUwmWBtsQ@mail.gmail.com>

Charles, my suggestion (which I doubt you will like) is to wrap your calls
to implied volatility root finders (quant lib or any others) in a try block
that returns NA on error.  Your example (very little or no time value) can
be common if you are using mid prices from bid-ask quotes.  Note that when
you plug the answer from your sum of squares root finding routine back into
AmericanOption you get a value slightly above 14.5.

On Fri, May 26, 2017 at 11:46 AM, Charles Duranceau <cduranceau at nial.ky>
wrote:

> Hi,
>
> I found a problem with the function "AmericanOptionImpliedVolatility" in
> RQantLib which return an error for a specific set of conditions (but cannot
> identifies exactly what are these).
> I present a case related to a short term, very deep in-the-money put with
> negative interest rate that generate error message. I present a
> reproducible example below.
> I found the related function "AmericanOption" with default produce similar
> error when use in a routine to back-out the implied volatility.
> However, I found good result (no error)  when using the
> engine="CrankNicolson" :  a na?ve routine for backing-out the implied vol
> with this function return a volatility.
> There's a work around but think this information may add more stability to
> RQL.
>
> Best Regards
> Charles
>
>
> Case
> RQuantLib Version 4.2
>
> R version 3.3.2 (64bits)
>
> library(RQuantLib)
>
> price = 14.5
> strike = 65
> Spot= 50.5
> Rate = -0.00361
> DividendYield = 0
> Volatility = 0.296
> YearToMaturity = 3/365
>
> # error when Implied Vol
> AmericanOptionImpliedVolatility("put", price,Spot, strike, DividendYield,
> Rate,YearToMaturity, Volatility)
>
> Error in americanOptionImpliedVolatilityEngine(type, value, underlying,  :
>
> ../../../QuantLib-1.6.2/ql/math/solver1d.hpp:202: In function
> `QuantLib::Real QuantLib::Solver1D<Impl>::solve(const F&, QuantLib::Real,
> QuantLib::Real, QuantLib::Real, QuantLib::Real) const [with F =
> QuantLib::{anonymous}::PriceError; Impl = QuantLib::Brent; QuantLib::Real
> = double]':
> root not bracketed: f[1e-007,4] -> [1.955446e-003,3.006858e+000]
>
> #also generate error
> AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity,
> Volatility)
>
> # works well
> AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity,
> Volatility,timeSteps=150, gridPoints=149, engine="CrankNicolson")
> # backing out the implied vol naively works
> fImpliedVol(Volatility,price,"put", Spot, strike, DividendYield,
> Rate,YearToMaturity)
>
>
> fImpliedVol<-function(iniVol,Premium,Callput, Spot, Strike, DivYield,
> Rate,YrtoMat){
>   ftm<-function(ImpVol,Premium,Callput, Spot, Strike, DivYield,
> Rate,YrtoMat, iVol)
>   {
>     ov<-AmericanOption(type=Callput, underlying=Spot,
> strike=Strike,dividendYield=DivYield, riskFreeRate=Rate,
> maturity=YrtoMat,volatility=ImpVol,
>                        timeSteps=150, gridPoints=149, engine=
> "CrankNicolson")
>     er<-(Premium-ov$value)^2
>   }
>   imp<-optimize(f=ftm,c(lower = 0, upper = 1.5), tol =
> 1e-4,Premium,Callput,Spot, Strike, DivYield, Rate,YrtoMat)
>   return(imp$minimum)
> }
>
> > sessionInfo()
> R version 3.3.2 (2016-10-31)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows >= 8 x64 (build 9200)
>
> locale:
> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United
> States.1252    LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C                           LC_TIME=English_United
> States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] RQuantLib_0.4.3 dplyr_0.5.0
>
> loaded via a namespace (and not attached):
> [1] zoo_1.8-0        magrittr_1.5     R6_2.1.2         assertthat_0.2.0
> DBI_0.6-1        tools_3.3.2      tibble_1.0       Rcpp_0.12.10
>  [9] grid_3.3.2       lattice_0.20-34
>
>
> >
>
>
>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From m.ashton at enduringinvestments.com  Fri May 26 22:58:12 2017
From: m.ashton at enduringinvestments.com (Michael Ashton)
Date: Fri, 26 May 2017 20:58:12 +0000
Subject: [R-SIG-Finance] getting a subset corresponding to a list element
Message-ID: <1e0317aa53bb45899d7fa96b920c59b3@MBX084-W1-CA-3.exch084.serverpod.net>

I'm not sure how to ask this with the proper terminology, but here goes:

The BDH() function in RBLPAPI returns, for a list of symbols (e.g., 'SPX Index','RIY Index','IBM Equity') a list of closing prices. The problem is that the result is not a matrix or a dataframe, but a list.

So, if I run the query with 3 symbols, I get a list with 3 elements. For example, in this case, if

symbolist <-c("SPX Index","MXWO Index","MXEA Index")
resultlist <- bdh(symbollist, "PX_LAST", options=opt,start.date=as.Date(begdate))

then resultlist is a list with 3 elements, and as many rows as there are dates between "begdate" and today (or as many month-ends, if "opt" declares monthly periodicity). Suppose in this case I've set this up to retrieve 60 dates.

But I don't WANT a list. I want a zoo object containing each of these as an element. I thought about starting by trying to put each element in a matrix by

data<-matrix(nrow=60,ncol=length(symbollist))

and then looping through from 1 to length(symbolist), letting

data[,i] <- resultlist$symbollist[i][,2]

but this clearly doesn't work since what I really want is

data[,1] <-resultlist$'SPX Index'[,2]
data[,2] <-resultlist$'MXWO Index'[,2]
etc

But there's probably a much easier way to do this.

I am sending this to both the general help list and the r-sig-finance list since there is probably both a general way to stuff a list into a zoo object and a way to do it cleanly with the BDH() command. Thanks in advance for help.

Mike


	[[alternative HTML version deleted]]


From rharlow86 at gmail.com  Fri May 26 23:12:55 2017
From: rharlow86 at gmail.com (Robert Harlow)
Date: Fri, 26 May 2017 17:12:55 -0400
Subject: [R-SIG-Finance] getting a subset corresponding to a list element
In-Reply-To: <1e0317aa53bb45899d7fa96b920c59b3@MBX084-W1-CA-3.exch084.serverpod.net>
References: <1e0317aa53bb45899d7fa96b920c59b3@MBX084-W1-CA-3.exch084.serverpod.net>
Message-ID: <CAHdfS94zPRZSH1wDwLectytCKZxXdmfWvW3xknXPPFciBi1wtg@mail.gmail.com>

Hi Michael,
  Try not to post twice - this is really more of a general R question.  To
answer the question, however, turn each element of your resultlist into an
xts (or zoo)  object so that you have a list of xts objects (called xtsList
for example.)  Then call do.call("merge", xtsList).  Also, your example is
tough because it requires access to bloomberg, which isn't necessarily the
case for the vast majority of R users.
Bob

On Fri, May 26, 2017 at 4:58 PM, Michael Ashton <
m.ashton at enduringinvestments.com> wrote:

> I'm not sure how to ask this with the proper terminology, but here goes:
>
> The BDH() function in RBLPAPI returns, for a list of symbols (e.g., 'SPX
> Index','RIY Index','IBM Equity') a list of closing prices. The problem is
> that the result is not a matrix or a dataframe, but a list.
>
> So, if I run the query with 3 symbols, I get a list with 3 elements. For
> example, in this case, if
>
> symbolist <-c("SPX Index","MXWO Index","MXEA Index")
> resultlist <- bdh(symbollist, "PX_LAST", options=opt,start.date=as.
> Date(begdate))
>
> then resultlist is a list with 3 elements, and as many rows as there are
> dates between "begdate" and today (or as many month-ends, if "opt" declares
> monthly periodicity). Suppose in this case I've set this up to retrieve 60
> dates.
>
> But I don't WANT a list. I want a zoo object containing each of these as
> an element. I thought about starting by trying to put each element in a
> matrix by
>
> data<-matrix(nrow=60,ncol=length(symbollist))
>
> and then looping through from 1 to length(symbolist), letting
>
> data[,i] <- resultlist$symbollist[i][,2]
>
> but this clearly doesn't work since what I really want is
>
> data[,1] <-resultlist$'SPX Index'[,2]
> data[,2] <-resultlist$'MXWO Index'[,2]
> etc
>
> But there's probably a much easier way to do this.
>
> I am sending this to both the general help list and the r-sig-finance list
> since there is probably both a general way to stuff a list into a zoo
> object and a way to do it cleanly with the BDH() command. Thanks in advance
> for help.
>
> Mike
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From daniel.cegielka at gmail.com  Fri May 26 23:53:28 2017
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Fri, 26 May 2017 23:53:28 +0200
Subject: [R-SIG-Finance] getting a subset corresponding to a list element
In-Reply-To: <1e0317aa53bb45899d7fa96b920c59b3@MBX084-W1-CA-3.exch084.serverpod.net>
References: <1e0317aa53bb45899d7fa96b920c59b3@MBX084-W1-CA-3.exch084.serverpod.net>
Message-ID: <CAPLrYERE8pkZAD2V_UAmmZZchp+WtfujZWK5u2-O6uLa-zw1nA@mail.gmail.com>

2017-05-26 22:58 GMT+02:00 Michael Ashton <m.ashton at enduringinvestments.com>:
> I'm not sure how to ask this with the proper terminology, but here goes:

> So, if I run the query with 3 symbols, I get a list with 3 elements. For example, in this case, if

(...)

> But I don't WANT a list. I want a zoo object containing each of these as an element.

Hi,
use my src.bloomberg.R custom code and try this:

require(xts)

# works with and without suffix 'Index' etc. :)

getSymbols.bloomberg(c('SPX', 'MXWO', 'MXEA'), from = as.Date(begdate))

# PX_LAST: SYM[,4] or Cl(SYM)
sym_data <- merge(SPX[,4], MXWO[,4], MXEA[,4])

tail(sym_data)

zoo_data <- as.zoo(sym_data)
tail(zoo_data)


btw. "to" arg is set as "to = Sys.Date() - 1" (EOD data)

getSymbols.bloomberg <- function(symbols = NULL, exchcode = 'US',
from = Sys.Date() - 365, to = Sys.Date() - 1, env = .GlobalEnv,
auto.assign, verbose, ...)

Best,
Daniel
-------------- next part --------------
A non-text attachment was scrubbed...
Name: src.bloomberg.R
Type: application/octet-stream
Size: 2401 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170526/bbcf3415/attachment.obj>

From cduranceau at nial.ky  Sat May 27 00:55:46 2017
From: cduranceau at nial.ky (Charles Duranceau)
Date: Fri, 26 May 2017 22:55:46 +0000
Subject: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug
In-Reply-To: <CAHdfS94+zS5Qt+xMDRkL4M04p832RFB05N+5qu0aLuUwmWBtsQ@mail.gmail.com>
References: <253B4FA1ECEEB54DB661809CB677345537E9E333@NOR-EXC01.northview.local>
 <253B4FA1ECEEB54DB661809CB6773455F69B4624@NOR-EXC01.northview.local>
 <CAHdfS94+zS5Qt+xMDRkL4M04p832RFB05N+5qu0aLuUwmWBtsQ@mail.gmail.com>
Message-ID: <253B4FA1ECEEB54DB661809CB6773455F69B67F9@NOR-EXC01.northview.local>

Thank you Robert,
I agree with you this is an extreme case and I don?t expect too much accuracy from the implied volatility I get, but my concern was more about the error message (a NA would have been more desirable)
By changing the engine I managed a workaround but I thought RQL team (or someone else having the same problem) could be interested with that non-desirable behavior.

Regards


From: Robert Harlow [mailto:rharlow86 at gmail.com]
Sent: Friday, May 26, 2017 3:32 PM
To: Charles Duranceau
Cc: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug

Charles, my suggestion (which I doubt you will like) is to wrap your calls to implied volatility root finders (quant lib or any others) in a try block that returns NA on error.  Your example (very little or no time value) can be common if you are using mid prices from bid-ask quotes.  Note that when you plug the answer from your sum of squares root finding routine back into AmericanOption you get a value slightly above 14.5.

On Fri, May 26, 2017 at 11:46 AM, Charles Duranceau <cduranceau at nial.ky<mailto:cduranceau at nial.ky>> wrote:
Hi,

I found a problem with the function "AmericanOptionImpliedVolatility" in RQantLib which return an error for a specific set of conditions (but cannot identifies exactly what are these).
I present a case related to a short term, very deep in-the-money put with negative interest rate that generate error message. I present a reproducible example below.
I found the related function "AmericanOption" with default produce similar error when use in a routine to back-out the implied volatility.
However, I found good result (no error)  when using the engine="CrankNicolson" :  a na?ve routine for backing-out the implied vol with this function return a volatility.
There's a work around but think this information may add more stability to RQL.

Best Regards
Charles


Case
RQuantLib Version 4.2

R version 3.3.2 (64bits)

library(RQuantLib)

price = 14.5
strike = 65
Spot= 50.5
Rate = -0.00361
DividendYield = 0
Volatility = 0.296
YearToMaturity = 3/365

# error when Implied Vol
AmericanOptionImpliedVolatility("put", price,Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)

Error in americanOptionImpliedVolatilityEngine(type, value, underlying,  :

../../../QuantLib-1.6.2/ql/math/solver1d.hpp:202: In function `QuantLib::Real QuantLib::Solver1D<Impl>::solve(const F&, QuantLib::Real, QuantLib::Real, QuantLib::Real, QuantLib::Real) const [with F = QuantLib::{anonymous}::PriceError; Impl = QuantLib::Brent; QuantLib::Real = double]':
root not bracketed: f[1e-007,4] -> [1.955446e-003,3.006858e+000]

#also generate error
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)

# works well
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility,timeSteps=150, gridPoints=149, engine="CrankNicolson")
# backing out the implied vol naively works
fImpliedVol(Volatility,price,"put", Spot, strike, DividendYield, Rate,YearToMaturity)


fImpliedVol<-function(iniVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat){
  ftm<-function(ImpVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat, iVol)
  {
    ov<-AmericanOption(type=Callput, underlying=Spot, strike=Strike,dividendYield=DivYield, riskFreeRate=Rate, maturity=YrtoMat,volatility=ImpVol,
                       timeSteps=150, gridPoints=149, engine= "CrankNicolson")
    er<-(Premium-ov$value)^2
  }
  imp<-optimize(f=ftm,c(lower = 0, upper = 1.5), tol = 1e-4,Premium,Callput,Spot, Strike, DivYield, Rate,YrtoMat)
  return(imp$minimum)
}

> sessionInfo()
R version 3.3.2 (2016-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows >= 8 x64 (build 9200)

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RQuantLib_0.4.3 dplyr_0.5.0

loaded via a namespace (and not attached):
[1] zoo_1.8-0        magrittr_1.5     R6_2.1.2         assertthat_0.2.0 DBI_0.6-1        tools_3.3.2      tibble_1.0       Rcpp_0.12.10
 [9] grid_3.3.2       lattice_0.20-34


>




        [[alternative HTML version deleted]]


_______________________________________________
R-SIG-Finance at r-project.org<mailto:R-SIG-Finance at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance<https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


	[[alternative HTML version deleted]]


From cduranceau at nial.ky  Sat May 27 01:14:42 2017
From: cduranceau at nial.ky (Charles Duranceau)
Date: Fri, 26 May 2017 23:14:42 +0000
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity
In-Reply-To: <BLUPR0101MB150651C5BA71D80D0375BA5D8DFC0@BLUPR0101MB1506.prod.exchangelabs.com>
References: <253B4FA1ECEEB54DB661809CB6773455F69B4404@NOR-EXC01.northview.local>
 <BLUPR0101MB150651C5BA71D80D0375BA5D8DFC0@BLUPR0101MB1506.prod.exchangelabs.com>
Message-ID: <253B4FA1ECEEB54DB661809CB6773455F69B6832@NOR-EXC01.northview.local>

Hi Terry,
you are right, the last settlement day of the bond is on Dec 30th as the bond redeems on a week end so the next business day as you point out fall after the redemption.
However, the day before you still have 1 day of accrual and still have a discount (and the price may deviate from par).
I agree this is an extreme case but possible (you held that bond to maturity) and you would not expect the function to return an error message unless the setup is wrong which is my question.
I find a work around by calculating a simple discount in such case but I thought it could be useful to know.

Regards


From: Terry Leitch [mailto:tleitch1 at jhu.edu]
Sent: Friday, May 26, 2017 1:52 PM
To: Charles Duranceau; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


Not sure, but maturity=effectivedate+1 . Since setllementDays=1, the bond matures on the same day you pay for it. Was that your intention?

________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org<mailto:r-sig-finance-bounces at r-project.org>> on behalf of Charles Duranceau <cduranceau at nial.ky<mailto:cduranceau at nial.ky>>
Sent: Friday, May 26, 2017 11:33:33 AM
To: r-sig-finance at r-project.org<mailto:r-sig-finance at r-project.org>
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


Hi,
I try to back-out the yield from a US Treasury note giving clean price using the function "FixedRateBondYield".
The procedure generate an error (See below).

Is this a structural problem or could it be correct by changing the bond settings ( I tried several changes already)?
Thank you
Charles


In this reproducible example, I try to back-out the yield for a bond maturing on 31-Dec-2016 as of (value date) 30-Dec-2016 (Friday).

library("RQuantLib")

dateValue<-as.Date("2016-12-30")

setEvaluationDate(dateValue)
# US Treasury note fixed attributes
gen_bond_UST =list(asettlementDays=1,afaceAmount= 100,aperiod=3,acalendar="UnitedStates/GovernmentBond",adayCounter=2,
                   abusinessDayConvention=2 ,acompound = 1 ,aredemption=100 ,aissueDate=as.Date("2014-01-31"),aendOfMonth=0)

# Function
with(gen_bond_UST,FixedRateBondYield(price=100.0078,effectiveDate=dateValue,maturityDate=as.Date("2016-12-31") ,rates=0.00625,
                   calendar=acalendar,settlementDays=asettlementDays,faceAmount= afaceAmount,period=aperiod,dayCounter=adayCounter,
                   businessDayConvention=abusinessDayConvention ,compound = acompound ,redemption=aredemption,issueDate=aissueDate))

# output
Error in fixedRateBondYieldByPriceEngine(settlementDays, price, calendar,  :
  degenerate single date (December 30th, 2016) schedule
seed date: December 31st, 2016
exit date: December 30th, 2016
effective date: December 30th, 2016
first date: null date
next to last date: null date
termination date: December 31st, 2016
generation rule: Backward
end of month: 0


> sessionInfo()

R version 3.3.2 (2016-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)

Running under: Windows >= 8 x64 (build 9200)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252

[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] RQuantLib_0.4.3



loaded via a namespace (and not attached):

[1] zoo_1.8-0       tools_3.3.2     Rcpp_0.12.10    grid_3.3.2      lattice_0.20-34



        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org<mailto:R-SIG-Finance at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance<https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From rharlow86 at gmail.com  Sat May 27 13:10:05 2017
From: rharlow86 at gmail.com (Robert Harlow)
Date: Sat, 27 May 2017 07:10:05 -0400
Subject: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug
In-Reply-To: <253B4FA1ECEEB54DB661809CB6773455F69B67F9@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB677345537E9E333@NOR-EXC01.northview.local>
 <253B4FA1ECEEB54DB661809CB6773455F69B4624@NOR-EXC01.northview.local>
 <CAHdfS94+zS5Qt+xMDRkL4M04p832RFB05N+5qu0aLuUwmWBtsQ@mail.gmail.com>
 <253B4FA1ECEEB54DB661809CB6773455F69B67F9@NOR-EXC01.northview.local>
Message-ID: <B7B14D24-408F-4F8D-A7AC-976D403B864F@gmail.com>

Doesn't the error message say root not bracketed? That is informative because it means there is no root, or no implied volatility, that gives you back your price of 14.5- this is what you should expect given your inputs.  In order for a volatility to exist an option must have a positive time value.

Bob

> On May 26, 2017, at 6:55 PM, Charles Duranceau <cduranceau at nial.ky> wrote:
> 
> Thank you Robert,
> I agree with you this is an extreme case and I don?t expect too much accuracy from the implied volatility I get, but my concern was more about the error message (a NA would have been more desirable)
> By changing the engine I managed a workaround but I thought RQL team (or someone else having the same problem) could be interested with that non-desirable behavior.
>  
> Regards
>  
>  
> From: Robert Harlow [mailto:rharlow86 at gmail.com] 
> Sent: Friday, May 26, 2017 3:32 PM
> To: Charles Duranceau
> Cc: r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug
>  
> Charles, my suggestion (which I doubt you will like) is to wrap your calls to implied volatility root finders (quant lib or any others) in a try block that returns NA on error.  Your example (very little or no time value) can be common if you are using mid prices from bid-ask quotes.  Note that when you plug the answer from your sum of squares root finding routine back into AmericanOption you get a value slightly above 14.5.
>  
> On Fri, May 26, 2017 at 11:46 AM, Charles Duranceau <cduranceau at nial.ky> wrote:
> Hi,
> 
> I found a problem with the function "AmericanOptionImpliedVolatility" in RQantLib which return an error for a specific set of conditions (but cannot identifies exactly what are these).
> I present a case related to a short term, very deep in-the-money put with negative interest rate that generate error message. I present a reproducible example below.
> I found the related function "AmericanOption" with default produce similar error when use in a routine to back-out the implied volatility.
> However, I found good result (no error)  when using the engine="CrankNicolson" :  a na?ve routine for backing-out the implied vol with this function return a volatility.
> There's a work around but think this information may add more stability to RQL.
> 
> Best Regards
> Charles
> 
> 
> Case
> RQuantLib Version 4.2
> 
> R version 3.3.2 (64bits)
> 
> library(RQuantLib)
> 
> price = 14.5
> strike = 65
> Spot= 50.5
> Rate = -0.00361
> DividendYield = 0
> Volatility = 0.296
> YearToMaturity = 3/365
> 
> # error when Implied Vol
> AmericanOptionImpliedVolatility("put", price,Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)
> 
> Error in americanOptionImpliedVolatilityEngine(type, value, underlying,  :
> 
> ../../../QuantLib-1.6.2/ql/math/solver1d.hpp:202: In function `QuantLib::Real QuantLib::Solver1D<Impl>::solve(const F&, QuantLib::Real, QuantLib::Real, QuantLib::Real, QuantLib::Real) const [with F = QuantLib::{anonymous}::PriceError; Impl = QuantLib::Brent; QuantLib::Real = double]':
> root not bracketed: f[1e-007,4] -> [1.955446e-003,3.006858e+000]
> 
> #also generate error
> AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)
> 
> # works well
> AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility,timeSteps=150, gridPoints=149, engine="CrankNicolson")
> # backing out the implied vol naively works
> fImpliedVol(Volatility,price,"put", Spot, strike, DividendYield, Rate,YearToMaturity)
> 
> 
> fImpliedVol<-function(iniVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat){
>   ftm<-function(ImpVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat, iVol)
>   {
>     ov<-AmericanOption(type=Callput, underlying=Spot, strike=Strike,dividendYield=DivYield, riskFreeRate=Rate, maturity=YrtoMat,volatility=ImpVol,
>                        timeSteps=150, gridPoints=149, engine= "CrankNicolson")
>     er<-(Premium-ov$value)^2
>   }
>   imp<-optimize(f=ftm,c(lower = 0, upper = 1.5), tol = 1e-4,Premium,Callput,Spot, Strike, DivYield, Rate,YrtoMat)
>   return(imp$minimum)
> }
> 
> > sessionInfo()
> R version 3.3.2 (2016-10-31)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows >= 8 x64 (build 9200)
> 
> locale:
> [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C                           LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] RQuantLib_0.4.3 dplyr_0.5.0
> 
> loaded via a namespace (and not attached):
> [1] zoo_1.8-0        magrittr_1.5     R6_2.1.2         assertthat_0.2.0 DBI_0.6-1        tools_3.3.2      tibble_1.0       Rcpp_0.12.10
>  [9] grid_3.3.2       lattice_0.20-34
> 
> 
> >
> 
> 
> 
> 
>         [[alternative HTML version deleted]]
> 
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>  

	[[alternative HTML version deleted]]


From tleitch1 at jhu.edu  Sat May 27 18:43:05 2017
From: tleitch1 at jhu.edu (Terry Leitch)
Date: Sat, 27 May 2017 16:43:05 +0000
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity
In-Reply-To: <253B4FA1ECEEB54DB661809CB6773455F69B6832@NOR-EXC01.northview.local>
References: <253B4FA1ECEEB54DB661809CB6773455F69B4404@NOR-EXC01.northview.local>
 <BLUPR0101MB150651C5BA71D80D0375BA5D8DFC0@BLUPR0101MB1506.prod.exchangelabs.com>,
 <253B4FA1ECEEB54DB661809CB6773455F69B6832@NOR-EXC01.northview.local>
Message-ID: <BLUPR0101MB1506D9D4120ABD4A1D10C1288DFD0@BLUPR0101MB1506.prod.exchangelabs.com>

You don't accrue because you haven't settled. Accruel begins when possess the bond. You possess it the day it matures. It can happen but makes no sense as it's just an exchange of cash for cash in practical terms.

________________________________
From: Charles Duranceau <cduranceau at nial.ky>
Sent: Friday, May 26, 2017 7:14:42 PM
To: Terry Leitch; r-sig-finance at r-project.org
Subject: RE: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity

Hi Terry,
you are right, the last settlement day of the bond is on Dec 30th as the bond redeems on a week end so the next business day as you point out fall after the redemption.
However, the day before you still have 1 day of accrual and still have a discount (and the price may deviate from par).
I agree this is an extreme case but possible (you held that bond to maturity) and you would not expect the function to return an error message unless the setup is wrong which is my question.
I find a work around by calculating a simple discount in such case but I thought it could be useful to know.

Regards


From: Terry Leitch [mailto:tleitch1 at jhu.edu]
Sent: Friday, May 26, 2017 1:52 PM
To: Charles Duranceau; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


Not sure, but maturity=effectivedate+1 . Since setllementDays=1, the bond matures on the same day you pay for it. Was that your intention?

________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org<mailto:r-sig-finance-bounces at r-project.org>> on behalf of Charles Duranceau <cduranceau at nial.ky<mailto:cduranceau at nial.ky>>
Sent: Friday, May 26, 2017 11:33:33 AM
To: r-sig-finance at r-project.org<mailto:r-sig-finance at r-project.org>
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


Hi,
I try to back-out the yield from a US Treasury note giving clean price using the function "FixedRateBondYield".
The procedure generate an error (See below).

Is this a structural problem or could it be correct by changing the bond settings ( I tried several changes already)?
Thank you
Charles


In this reproducible example, I try to back-out the yield for a bond maturing on 31-Dec-2016 as of (value date) 30-Dec-2016 (Friday).

library("RQuantLib")

dateValue<-as.Date("2016-12-30")

setEvaluationDate(dateValue)
# US Treasury note fixed attributes
gen_bond_UST =list(asettlementDays=1,afaceAmount= 100,aperiod=3,acalendar="UnitedStates/GovernmentBond",adayCounter=2,
                   abusinessDayConvention=2 ,acompound = 1 ,aredemption=100 ,aissueDate=as.Date("2014-01-31"),aendOfMonth=0)

# Function
with(gen_bond_UST,FixedRateBondYield(price=100.0078,effectiveDate=dateValue,maturityDate=as.Date("2016-12-31") ,rates=0.00625,
                   calendar=acalendar,settlementDays=asettlementDays,faceAmount= afaceAmount,period=aperiod,dayCounter=adayCounter,
                   businessDayConvention=abusinessDayConvention ,compound = acompound ,redemption=aredemption,issueDate=aissueDate))

# output
Error in fixedRateBondYieldByPriceEngine(settlementDays, price, calendar,  :
  degenerate single date (December 30th, 2016) schedule
seed date: December 31st, 2016
exit date: December 30th, 2016
effective date: December 30th, 2016
first date: null date
next to last date: null date
termination date: December 31st, 2016
generation rule: Backward
end of month: 0


> sessionInfo()

R version 3.3.2 (2016-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)

Running under: Windows >= 8 x64 (build 9200)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252

[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] RQuantLib_0.4.3



loaded via a namespace (and not attached):

[1] zoo_1.8-0       tools_3.3.2     Rcpp_0.12.10    grid_3.3.2      lattice_0.20-34



        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org<mailto:R-SIG-Finance at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From atakanokan at outlook.com  Sat May 27 20:11:52 2017
From: atakanokan at outlook.com (Atakan Okan)
Date: Sat, 27 May 2017 18:11:52 +0000
Subject: [R-SIG-Finance] Adding "Stoploss disabled" to the parameter
 distribution for apply.paramset
Message-ID: <HE1PR03MB1882639E1531CA0CA98FA3B6C7FD0@HE1PR03MB1882.eurprd03.prod.outlook.com>

Tried doing a simple MACD Long-only strategy but couldn't manage to get it working. The take profit rule doesn't seem to work as well, since changing its threshold does not affect the net pnl. Below is a minimal (as much as I could) reproducible code:


#AAPL google?finance data
#MACD cross


library(quantmod)
library(xts)
library(quantstrat)


getSymbols("AAPL", src = "google")
plot(Cl(AAPL))


.strategy <- new.env()
.blotter ?<- new.env() ? ? ? ? ? ? ? ? ? ? ? ? ? ?


currency('USD')
stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)


strategy.st <- "reproducible_strategy"
rm.strat(strategy.st) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?


initDate = as.character(as.Date(index(AAPL[1])-1)) ? ? ? ? ? ? ? ? ? ?
initPortf(strategy.st,?
? ? ? ? ? "AAPL",?
? ? ? ? ? initDate=initDate,?
? ? ? ? ? currency = "USD")
initAcct(strategy.st,?
? ? ? ? ?portfolios=strategy.st,?
? ? ? ? ?initDate=initDate,?
? ? ? ? ?initEq=1000,?
? ? ? ? ?currency = "USD")
initOrders(portfolio=strategy.st,
? ? ? ? ? ?initDate=initDate) ? ? ? ? ? ? ? ? ? ? ? ??
strategy(strategy.st,store=TRUE)


txn.model <- 0


add.indicator(strategy.st, ?
? ? ? ? ? ? ? name = "MACD",?
? ? ? ? ? ? ? arguments = list(x=Cl(AAPL)),?
? ? ? ? ? ? ? label='macd')?


add.signal(strategy.st,name="sigCrossover",
? ? ? ? ? ?arguments = list(columns=c("macd.macd","signal.macd"),
? ? ? ? ? ? ? ? ? ? ? ? ? ? relationship="gt"),
? ? ? ? ? ?label="macd.gt.signal")?


add.signal(strategy.st,name="sigCrossover",
? ? ? ? ? ?arguments = list(columns=c("macd.macd","signal.macd"),
? ? ? ? ? ? ? ? ? ? ? ? ? ? relationship="lt"),
? ? ? ? ? ?label="macd.lt.signal")


# Long Entry Rule-----------------------------------------------------------------------------
add.rule(strategy.st,
? ? ? ? ?name='ruleSignal',
? ? ? ? ?arguments = list(sigcol="macd.gt.signal",
? ? ? ? ? ? ? ? ? ? ? ? ? sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? prefer="Open",?
? ? ? ? ? ? ? ? ? ? ? ? ? orderqty= 10,?

? ? ? ? ? ? ? ? ? ? ? ? ? ordertype='market',
? ? ? ? ? ? ? ? ? ? ? ? ? orderside='long',
? ? ? ? ? ? ? ? ? ? ? ? ? orderset='ocolong',
? ? ? ? ? ? ? ? ? ? ? ? ? TxnFees = 0),
? ? ? ? ?type='enter',
? ? ? ? ?label='longenter',
? ? ? ? ?enabled=FALSE

)


# Long Exit Rule-------------------------------------------------------------------
add.rule(strategy.st,
? ? ? ? ?name='ruleSignal',
? ? ? ? ?arguments = list(sigcol="macd.lt.signal",
? ? ? ? ? ? ? ? ? ? ? ? ? sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? prefer="Open",?
? ? ? ? ? ? ? ? ? ? ? ? ? orderqty='all',
? ? ? ? ? ? ? ? ? ? ? ? ? ordertype='market',
? ? ? ? ? ? ? ? ? ? ? ? ? orderside='long',
? ? ? ? ? ? ? ? ? ? ? ? ? orderset='ocolong',
? ? ? ? ? ? ? ? ? ? ? ? ? TxnFees = 0),
? ? ? ? ?type='exit',
? ? ? ? ?label='longexit',
? ? ? ? ?enabled=FALSE

)






# Long Take Profit Rule
TakeProfitDistanceRANGE <- seq(1,5,by=4)
longTakeProfitDistance <- TakeProfitDistanceRANGE[1]


add.rule(strategy.st, name = "ruleSignal",
? ? ? ? ?arguments = list(sigcol="macd.lt.signal",
? ? ? ? ? ? ? ? ? ? ? ? ? sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? ordertype="limit",
? ? ? ? ? ? ? ? ? ? ? ? ? orderside="long",
? ? ? ? ? ? ? ? ? ? ? ? ? replace=FALSE,
? ? ? ? ? ? ? ? ? ? ? ? ? tmult=FALSE,
? ? ? ? ? ? ? ? ? ? ? ? ? threshold=quote(longTakeProfitDistance),?
? ? ? ? ? ? ? ? ? ? ? ? ? orderqty="all",
? ? ? ? ? ? ? ? ? ? ? ? ? orderset="ocolong",
? ? ? ? ? ? ? ? ? ? ? ? ? TxnFees = 0),
? ? ? ? ?type = "chain",?
? ? ? ? ?parent="longenter",
? ? ? ? ?label = "TakeProfitLong",
? ? ? ? ?enabled = FALSE
)






#Optimization----------------------------------------------------
paramset.label.name <- "MACD_OPT"
macdSignalRANGE <- ? seq(50,100,by=10)




#MACD Signal Distribution
add.distribution(strategy.st,
? ? ? ? ? ? ? ? ?paramset.label = paramset.label.name,
? ? ? ? ? ? ? ? ?component.type = 'indicator',
? ? ? ? ? ? ? ? ?component.label = "macd",
? ? ? ? ? ? ? ? ?variable = list( nSig = macdSignalRANGE ),
? ? ? ? ? ? ? ? ?label = "macdSignalRANGE")


#Long Take Profit Optimization
add.distribution(strategy.st,
? ? ? ? ? ? ? ? ?paramset.label = paramset.label.name,
? ? ? ? ? ? ? ? ?component.type = "chain",
? ? ? ? ? ? ? ? ?component.label = "TakeProfitLong",
? ? ? ? ? ? ? ? ?variable = list( threshold = TakeProfitDistanceRANGE ),
? ? ? ? ? ? ? ? ?label = "TakeProfitLONG")


#Long TP On/Off
add.distribution( strategy=strategy.st,
? ? ? ? ? ? ? ? ? paramset.label = paramset.label.name,
? ? ? ? ? ? ? ? ? component.type = 'chain',
? ? ? ? ? ? ? ? ? component.label = 'TakeProfitLong',
? ? ? ? ? ? ? ? ? variable = list(enabled = c(TRUE,FALSE)),
? ? ? ? ? ? ? ? ? label = 'TPOnOff'
)




enable.rule(strategy.st,type="enter",label="longenter", enable = TRUE)?
enable.rule(strategy.st,type="exit",label="longexit", enable = TRUE)
enable.rule(strategy.st,type="chain",label="TakeProfitLong", enable = TRUE)
summary(getStrategy(strategy.st)) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?




if (Sys.info()["sysname"] == "Windows"){
? library(doSNOW)
? cl <- makeCluster(4)

? registerDoSNOW(cl) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
}
if(Sys.info()["sysname"] == "Linux") {
? library(doMC)
? registerDoMC(cores=4)
? getDoParWorkers()
}


results <- apply.paramset(strategy.st,
? ? ? ? ? ? ? ? ? ? ? ? ? paramset.label=paramset.label.name,
? ? ? ? ? ? ? ? ? ? ? ? ? portfolio=strategy.st,?
? ? ? ? ? ? ? ? ? ? ? ? ? account=strategy.st,
? ? ? ? ? ? ? ? ? ? ? ? ? nsamples=0,
? ? ? ? ? ? ? ? ? ? ? ? ? verbose = TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? calc = "slave")


if(Sys.info()["sysname"] == "Windows"){ ?snow::stopCluster(cl) }


results.df <- data.frame(results$tradeStats)


From atakanokan at outlook.com  Sat May 27 20:12:39 2017
From: atakanokan at outlook.com (Atakan Okan)
Date: Sat, 27 May 2017 18:12:39 +0000
Subject: [R-SIG-Finance] Adding "Stoploss disabled" to the parameter
 distribution for apply.paramset
In-Reply-To: <HE1PR03MB1882639E1531CA0CA98FA3B6C7FD0@HE1PR03MB1882.eurprd03.prod.outlook.com>
References: <HE1PR03MB1882639E1531CA0CA98FA3B6C7FD0@HE1PR03MB1882.eurprd03.prod.outlook.com>
Message-ID: <HE1PR03MB18824EE027764FBBA0371AA8C7FD0@HE1PR03MB1882.eurprd03.prod.outlook.com>




________________________________
From: Atakan Okan <atakanokan at outlook.com>
Sent: Saturday, May 27, 2017 9:11 PM
To: r-sig-finance at r-project.org
Subject: Adding "Stoploss disabled" to the parameter distribution for apply.paramset

Tried doing a simple MACD Long-only strategy but couldn't manage to get it working. The take profit rule doesn't seem to work as well, since changing its threshold does not affect the net pnl. Below is a minimal (as much as I could) reproducible code:


#AAPL google finance data
#MACD cross


library(quantmod)
library(xts)
library(quantstrat)


getSymbols("AAPL", src = "google")
plot(Cl(AAPL))


.strategy <- new.env()
.blotter  <- new.env()


currency('USD')
stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)


strategy.st <- "reproducible_strategy"
rm.strat(strategy.st)


initDate = as.character(as.Date(index(AAPL[1])-1))
initPortf(strategy.st,
          "AAPL",
          initDate=initDate,
          currency = "USD")
initAcct(strategy.st,
         portfolios=strategy.st,
         initDate=initDate,
         initEq=1000,
         currency = "USD")
initOrders(portfolio=strategy.st,
           initDate=initDate)
strategy(strategy.st,store=TRUE)


txn.model <- 0


add.indicator(strategy.st,
              name = "MACD",
              arguments = list(x=Cl(AAPL)),
              label='macd')


add.signal(strategy.st,name="sigCrossover",
           arguments = list(columns=c("macd.macd","signal.macd"),
                            relationship="gt"),
           label="macd.gt.signal")


add.signal(strategy.st,name="sigCrossover",
           arguments = list(columns=c("macd.macd","signal.macd"),
                            relationship="lt"),
           label="macd.lt.signal")


# Long Entry Rule-----------------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="macd.gt.signal",
                          sigval=TRUE,
                          prefer="Open",
                          orderqty= 10,

                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = 0),
         type='enter',
         label='longenter',
         enabled=FALSE

)


# Long Exit Rule-------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="macd.lt.signal",
                          sigval=TRUE,
                          prefer="Open",
                          orderqty='all',
                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = 0),
         type='exit',
         label='longexit',
         enabled=FALSE

)






# Long Take Profit Rule
TakeProfitDistanceRANGE <- seq(1,5,by=4)
longTakeProfitDistance <- TakeProfitDistanceRANGE[1]


add.rule(strategy.st, name = "ruleSignal",
         arguments = list(sigcol="macd.lt.signal",
                          sigval=TRUE,
                          ordertype="limit",
                          orderside="long",
                          replace=FALSE,
                          tmult=FALSE,
                          threshold=quote(longTakeProfitDistance),
                          orderqty="all",
                          orderset="ocolong",
                          TxnFees = 0),
         type = "chain",
         parent="longenter",
         label = "TakeProfitLong",
         enabled = FALSE
)






#Optimization----------------------------------------------------
paramset.label.name <- "MACD_OPT"
macdSignalRANGE <-   seq(50,100,by=10)




#MACD Signal Distribution
add.distribution(strategy.st,
                 paramset.label = paramset.label.name,
                 component.type = 'indicator',
                 component.label = "macd",
                 variable = list( nSig = macdSignalRANGE ),
                 label = "macdSignalRANGE")


#Long Take Profit Optimization
add.distribution(strategy.st,
                 paramset.label = paramset.label.name,
                 component.type = "chain",
                 component.label = "TakeProfitLong",
                 variable = list( threshold = TakeProfitDistanceRANGE ),
                 label = "TakeProfitLONG")


#Long TP On/Off
add.distribution( strategy=strategy.st,
                  paramset.label = paramset.label.name,
                  component.type = 'chain',
                  component.label = 'TakeProfitLong',
                  variable = list(enabled = c(TRUE,FALSE)),
                  label = 'TPOnOff'
)




enable.rule(strategy.st,type="enter",label="longenter", enable = TRUE)
enable.rule(strategy.st,type="exit",label="longexit", enable = TRUE)
enable.rule(strategy.st,type="chain",label="TakeProfitLong", enable = TRUE)
summary(getStrategy(strategy.st))




if (Sys.info()["sysname"] == "Windows"){
  library(doSNOW)
  cl <- makeCluster(4)

  registerDoSNOW(cl)
}
if(Sys.info()["sysname"] == "Linux") {
  library(doMC)
  registerDoMC(cores=4)
  getDoParWorkers()
}


results <- apply.paramset(strategy.st,
                          paramset.label=paramset.label.name,
                          portfolio=strategy.st,
                          account=strategy.st,
                          nsamples=0,
                          verbose = TRUE,
                          calc = "slave")


if(Sys.info()["sysname"] == "Windows"){  snow::stopCluster(cl) }


results.df <- data.frame(results$tradeStats)



	[[alternative HTML version deleted]]


From nicolas.roux at hec.edu  Mon May 29 09:32:23 2017
From: nicolas.roux at hec.edu (ROUX, Nicolas)
Date: Mon, 29 May 2017 09:32:23 +0200
Subject: [R-SIG-Finance] Return.portfolio issue
Message-ID: <CAFF3=2rGsZ=dnSZq_PaVzGhm8y6+NuiHs-vnXtDb1OUtF8cQcA@mail.gmail.com>

Hello all,

I am trying to backtest  a long/short portfolio using Return.Portfolio but
am running into some sort of error, or I do not fully understand how to use
return.portfolio.

For a quarterly rebalancing of shorts, I am providing monthly returns, a
set of negative
weights in an xts format on quarter dates (created by to.period), the final
argument is rebalance_on="quarters".

The result is an set of regular zigzags where the position changes too
regularly. [image: Inline images 2]
The code:

head(monthly.returns[,1:3])            AXA.Returns Accor.Returns
Air.Liquide.Returns
1987-01-31           NA            NA                  NA
1987-02-28 -0.039941766   -0.00311151         -0.03195942
1987-03-31  0.008723886    0.03936148          0.07320454
1987-04-30  0.005995543   -0.04579859         -0.01919371
1987-05-31 -0.055431515   -0.10515575         -0.03495027
1987-06-30 -0.145464190   -0.02607130         -0.04062429

head(weights$short.w[,1:3])           Asset 1 Asset 2 Asset 3
1987-03-31      -1     0.0       0
1987-06-30       0    -0.5       0
1987-09-30       0     0.0       0
1987-12-31       0     0.0       0
1988-03-31       0     0.0       0
1988-06-30       0     0.0       0

head(Port.return[1:10])           portfolio.returns
1987-04-30       -2.00599554
1987-05-31       -0.05543151
1987-06-30       -0.14546419
1987-07-31       -2.01670857
1987-08-31        0.09265071
1987-09-30       -0.09907100



I am not sure I understand how the short weights work? Perhaps I should
just use positive weights and minus the returns afterwards?

Any help much appreciated.

Nicolas Roux
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170529/9c9193ec/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 21223 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170529/9c9193ec/attachment.png>

From es at enricoschumann.net  Mon May 29 09:49:31 2017
From: es at enricoschumann.net (Enrico Schumann)
Date: Mon, 29 May 2017 09:49:31 +0200
Subject: [R-SIG-Finance] getting a subset corresponding to a list element
In-Reply-To: <1e0317aa53bb45899d7fa96b920c59b3@MBX084-W1-CA-3.exch084.serverpod.net>
Message-ID: <20170529094931.Horde.MGCFXOGgYu5-a1TIM3bd-oI@webmail.your-server.de>


Zitat von Michael Ashton <m.ashton at enduringinvestments.com>:

> I'm not sure how to ask this with the proper terminology, but here goes:
>
> The BDH() function in RBLPAPI returns, for a list of symbols (e.g.,  
> 'SPX Index','RIY Index','IBM Equity') a list of closing prices. The  
> problem is that the result is not a matrix or a dataframe, but a list.
>
> So, if I run the query with 3 symbols, I get a list with 3 elements.  
> For example, in this case, if
>
> symbolist <-c("SPX Index","MXWO Index","MXEA Index")
> resultlist <- bdh(symbollist, "PX_LAST",  
> options=opt,start.date=as.Date(begdate))
>
> then resultlist is a list with 3 elements, and as many rows as there  
> are dates between "begdate" and today (or as many month-ends, if  
> "opt" declares monthly periodicity). Suppose in this case I've set  
> this up to retrieve 60 dates.
>
> But I don't WANT a list. I want a zoo object containing each of  
> these as an element. I thought about starting by trying to put each  
> element in a matrix by
>
> data<-matrix(nrow=60,ncol=length(symbollist))
>
> and then looping through from 1 to length(symbolist), letting
>
> data[,i] <- resultlist$symbollist[i][,2]
>
> but this clearly doesn't work since what I really want is
>
> data[,1] <-resultlist$'SPX Index'[,2]
> data[,2] <-resultlist$'MXWO Index'[,2]
> etc
>
> But there's probably a much easier way to do this.
>
> I am sending this to both the general help list and the  
> r-sig-finance list since there is probably both a general way to  
> stuff a list into a zoo object and a way to do it cleanly with the  
> BDH() command. Thanks in advance for help.
>
> Mike
>

Try this:

   require("Rblpapi")
   require("zoo")

   blpConnect()
   res <- bdh(c("SPX Index","MXWO Index","MXEA Index"),
              fields = "PX_LAST",
              start.date = as.Date("2017-01-01"),
              end.date = as.Date("2017-01-05"))

   do.call("merge",
           lapply(res, function(x) zoo(x[[2]], x[[1]])))


-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From brian at braverock.com  Mon May 29 11:49:24 2017
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 29 May 2017 04:49:24 -0500
Subject: [R-SIG-Finance] Return.portfolio issue
In-Reply-To: <CAFF3=2rGsZ=dnSZq_PaVzGhm8y6+NuiHs-vnXtDb1OUtF8cQcA@mail.gmail.com>
References: <CAFF3=2rGsZ=dnSZq_PaVzGhm8y6+NuiHs-vnXtDb1OUtF8cQcA@mail.gmail.com>
Message-ID: <52ce7647-486c-6b76-57fb-24c584446c60@braverock.com>

On 05/29/2017 02:32 AM, ROUX, Nicolas wrote:
> Hello all,
>
> I am trying to backtest  a long/short portfolio using Return.Portfolio
> but am running into some sort of error, or I do not fully understand how
> to use return.portfolio.
>
> For a quarterly rebalancing of shorts, I am providing monthly returns, a
> set of negative
> weights in an xts format on quarter dates (created by to.period), the
> final argument is rebalance_on="quarters".
>
> The result is an set of regular zigzags where the position changes too
> regularly. Inline images 2
> The code:
<...>

This isn't exactly a reproducible example.

Here is a reproducible example:

require(PerformanceAnalytics)
data(edhec)
data(weights)
sweights <- -1 * weights
pr <- Return.rebalancing(R=edhec, weights=sweights)
charts.PerformanceSummary(pr)

It is clearly a bug.  We'll take a look.

> **
>
> I am not sure I understand how the short weights work? Perhaps I should
> just use positive weights and minus the returns afterwards?
>
> Any help much appreciated.
>
> Nicolas Roux


From ilya.kipnis at gmail.com  Mon May 29 16:09:56 2017
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 29 May 2017 10:09:56 -0400
Subject: [R-SIG-Finance] Return.portfolio issue
In-Reply-To: <52ce7647-486c-6b76-57fb-24c584446c60@braverock.com>
References: <CAFF3=2rGsZ=dnSZq_PaVzGhm8y6+NuiHs-vnXtDb1OUtF8cQcA@mail.gmail.com>
 <52ce7647-486c-6b76-57fb-24c584446c60@braverock.com>
Message-ID: <CA+oJuEGotcQtkhGWxtjDOU_xm4jGqDcNUknZAT_umcPsmEcdbw@mail.gmail.com>

Weights need to sum to 1 at every period. Create a dummy asset with return
of 0 and assign it a weight of 1 - rowSum(weights) and things will work.

On Mon, May 29, 2017 at 5:49 AM, Brian G. Peterson <brian at braverock.com>
wrote:

> On 05/29/2017 02:32 AM, ROUX, Nicolas wrote:
>
>> Hello all,
>>
>> I am trying to backtest  a long/short portfolio using Return.Portfolio
>> but am running into some sort of error, or I do not fully understand how
>> to use return.portfolio.
>>
>> For a quarterly rebalancing of shorts, I am providing monthly returns, a
>> set of negative
>> weights in an xts format on quarter dates (created by to.period), the
>> final argument is rebalance_on="quarters".
>>
>> The result is an set of regular zigzags where the position changes too
>> regularly. Inline images 2
>> The code:
>>
> <...>
>
> This isn't exactly a reproducible example.
>
> Here is a reproducible example:
>
> require(PerformanceAnalytics)
> data(edhec)
> data(weights)
> sweights <- -1 * weights
> pr <- Return.rebalancing(R=edhec, weights=sweights)
> charts.PerformanceSummary(pr)
>
> It is clearly a bug.  We'll take a look.
>
> **
>>
>> I am not sure I understand how the short weights work? Perhaps I should
>> just use positive weights and minus the returns afterwards?
>>
>> Any help much appreciated.
>>
>> Nicolas Roux
>>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From nicolas.roux at hec.edu  Mon May 29 16:50:27 2017
From: nicolas.roux at hec.edu (ROUX, Nicolas)
Date: Mon, 29 May 2017 16:50:27 +0200
Subject: [R-SIG-Finance] Return.portfolio issue
In-Reply-To: <CA+oJuEGotcQtkhGWxtjDOU_xm4jGqDcNUknZAT_umcPsmEcdbw@mail.gmail.com>
References: <CAFF3=2rGsZ=dnSZq_PaVzGhm8y6+NuiHs-vnXtDb1OUtF8cQcA@mail.gmail.com>
 <52ce7647-486c-6b76-57fb-24c584446c60@braverock.com>
 <CA+oJuEGotcQtkhGWxtjDOU_xm4jGqDcNUknZAT_umcPsmEcdbw@mail.gmail.com>
Message-ID: <CAFF3=2r1ueyMTiOWt9QMXLAr6LHkJ5emjyTkWPpw1ceooiW23A@mail.gmail.com>

Hi,

So if all the assets are shorted in one period and sum of the weights
equals -1 (as was the case in my example but hidden columns), the dummy
variable's weight is 2?

Thanks,

Nicolas

On 29 May 2017 16:10, "Ilya Kipnis" <ilya.kipnis at gmail.com> wrote:

Weights need to sum to 1 at every period. Create a dummy asset with return
of 0 and assign it a weight of 1 - rowSum(weights) and things will work.

On Mon, May 29, 2017 at 5:49 AM, Brian G. Peterson <brian at braverock.com>
wrote:

> On 05/29/2017 02:32 AM, ROUX, Nicolas wrote:
>
>> Hello all,
>>
>> I am trying to backtest  a long/short portfolio using Return.Portfolio
>> but am running into some sort of error, or I do not fully understand how
>> to use return.portfolio.
>>
>> For a quarterly rebalancing of shorts, I am providing monthly returns, a
>> set of negative
>> weights in an xts format on quarter dates (created by to.period), the
>> final argument is rebalance_on="quarters".
>>
>> The result is an set of regular zigzags where the position changes too
>> regularly. Inline images 2
>> The code:
>>
> <...>
>
> This isn't exactly a reproducible example.
>
> Here is a reproducible example:
>
> require(PerformanceAnalytics)
> data(edhec)
> data(weights)
> sweights <- -1 * weights
> pr <- Return.rebalancing(R=edhec, weights=sweights)
> charts.PerformanceSummary(pr)
>
> It is clearly a bug.  We'll take a look.
>
> **
>>
>> I am not sure I understand how the short weights work? Perhaps I should
>> just use positive weights and minus the returns afterwards?
>>
>> Any help much appreciated.
>>
>> Nicolas Roux
>>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Mon May 29 16:51:07 2017
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 29 May 2017 10:51:07 -0400
Subject: [R-SIG-Finance] Return.portfolio issue
In-Reply-To: <CAFF3=2r1ueyMTiOWt9QMXLAr6LHkJ5emjyTkWPpw1ceooiW23A@mail.gmail.com>
References: <CAFF3=2rGsZ=dnSZq_PaVzGhm8y6+NuiHs-vnXtDb1OUtF8cQcA@mail.gmail.com>
 <52ce7647-486c-6b76-57fb-24c584446c60@braverock.com>
 <CA+oJuEGotcQtkhGWxtjDOU_xm4jGqDcNUknZAT_umcPsmEcdbw@mail.gmail.com>
 <CAFF3=2r1ueyMTiOWt9QMXLAr6LHkJ5emjyTkWPpw1ceooiW23A@mail.gmail.com>
Message-ID: <CA+oJuEGYwpjeKporhPQGOGK09VXc+38eth8TYjHZN1BWQQSQ=A@mail.gmail.com>

Correct.

On Mon, May 29, 2017 at 10:50 AM, ROUX, Nicolas <nicolas.roux at hec.edu>
wrote:

> Hi,
>
> So if all the assets are shorted in one period and sum of the weights
> equals -1 (as was the case in my example but hidden columns), the dummy
> variable's weight is 2?
>
> Thanks,
>
> Nicolas
>
> On 29 May 2017 16:10, "Ilya Kipnis" <ilya.kipnis at gmail.com> wrote:
>
> Weights need to sum to 1 at every period. Create a dummy asset with return
> of 0 and assign it a weight of 1 - rowSum(weights) and things will work.
>
> On Mon, May 29, 2017 at 5:49 AM, Brian G. Peterson <brian at braverock.com>
> wrote:
>
> > On 05/29/2017 02:32 AM, ROUX, Nicolas wrote:
> >
> >> Hello all,
> >>
> >> I am trying to backtest  a long/short portfolio using Return.Portfolio
> >> but am running into some sort of error, or I do not fully understand how
> >> to use return.portfolio.
> >>
> >> For a quarterly rebalancing of shorts, I am providing monthly returns, a
> >> set of negative
> >> weights in an xts format on quarter dates (created by to.period), the
> >> final argument is rebalance_on="quarters".
> >>
> >> The result is an set of regular zigzags where the position changes too
> >> regularly. Inline images 2
> >> The code:
> >>
> > <...>
> >
> > This isn't exactly a reproducible example.
> >
> > Here is a reproducible example:
> >
> > require(PerformanceAnalytics)
> > data(edhec)
> > data(weights)
> > sweights <- -1 * weights
> > pr <- Return.rebalancing(R=edhec, weights=sweights)
> > charts.PerformanceSummary(pr)
> >
> > It is clearly a bug.  We'll take a look.
> >
> > **
> >>
> >> I am not sure I understand how the short weights work? Perhaps I should
> >> just use positive weights and minus the returns afterwards?
> >>
> >> Any help much appreciated.
> >>
> >> Nicolas Roux
> >>
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> > should go.
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>

	[[alternative HTML version deleted]]


From adrian at trapletti.org  Mon May 29 18:49:27 2017
From: adrian at trapletti.org (Adrian Trapletti)
Date: Mon, 29 May 2017 18:49:27 +0200
Subject: [R-SIG-Finance] Entropy Pooling Meucci
Message-ID: <CAFmikf3wwwvAdisR2vY-1VV6AiGwVjDm2FBWNupAtE0k7c=DJg@mail.gmail.com>

Hi all,

I was playing around with the nonparametric entropy pooling approach
from Meucci to integrate external views (EntropyProg() in
PortfolioAnalytics).

While in theory the approach looks very appealing, I realized that in
practice the entropy pooling algorithm often does not converge due to
the fact that the views are "incompatible" with the scenarios that I
generated from bootstrapping historical data (no feasible solution).

To get solutions I either had to shift the views towards the data, or
the other way round, but both approaches do not really make sense in
this context as the prior should be independent of the views.

Anybody out there who had similar experiences and wants to share his thoughts?

Best regards
Adrian

Adrian Trapletti

Steinstrasse 9b, 8610 Uster, Switzerland
P +41 44 994 56 30  |  M +41 79 103 71 31
adrian at trapletti.org  |  www.trapletti.org


From cduranceau at nial.ky  Wed May 31 01:01:28 2017
From: cduranceau at nial.ky (Charles Duranceau)
Date: Tue, 30 May 2017 23:01:28 +0000
Subject: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug
In-Reply-To: <B7B14D24-408F-4F8D-A7AC-976D403B864F@gmail.com>
References: <253B4FA1ECEEB54DB661809CB677345537E9E333@NOR-EXC01.northview.local>
 <253B4FA1ECEEB54DB661809CB6773455F69B4624@NOR-EXC01.northview.local>
 <CAHdfS94+zS5Qt+xMDRkL4M04p832RFB05N+5qu0aLuUwmWBtsQ@mail.gmail.com>
 <253B4FA1ECEEB54DB661809CB6773455F69B67F9@NOR-EXC01.northview.local>
 <B7B14D24-408F-4F8D-A7AC-976D403B864F@gmail.com>
Message-ID: <253B4FA1ECEEB54DB661809CB6773455F69B9E6D@NOR-EXC01.northview.local>

Hi Robert,
Thank you for your feedback. I don?t disagree with you. There must be a (positive) time value in the option in order to have an implied volatility. But the implied volatility is function of the model (pricing engine).
I now think the problem is located to the engine="BaroneAdesiWhaley" when risk free rate is negative.

Let me take another approach by calculating the premium for the same option (with the same parameter) using an arbitrary volatility of 30% (below I paste the example) so using directly the option valuation to calculate the premium I will get

Option intrinsic value = 14.49957
EuropeanOption = 14.5019 => this is expected:  very little time value due to deep in-the-money and little time before expiration
AmericanOption, engine="CrankNicolson"= 14.5019 => it is floored to European option value but the early exercise has no value as rate is negative
AmericanOption, engine="BaroneAdesiWhaley" = error message => this is not expected

 ?Error in americanOptionEngine(type, underlying, strike, dividendYield,  : forward + displacement (-8.68397e+012 + 0) must be positive?

I suspect here the engine="BaroneAdesiWhaley" does not behave well under a negative rate. I don?t have this error when rate is positive. Adding a positive (and higher) dividend yield does not help either which isolate the problem to the rate side.
My understanding of BAW approximation for non-dividend American put is that it is not optimal to exercise when rates are negative (negative carry) and thus should default to the European option value.

Regards

Replication in R

library(RQuantLib)
strike = 65
Spot= 50.5
Rate = -0.00361
DividendYield = 0
Volatility = 0.3
YearToMaturity = 3/365

(strike-Spot)*exp((Rate-DividendYield)*YearToMaturity) # intrinsic value
EuropeanOption("put", Spot, strike,DividendYield, Rate,YearToMaturity, Volatility)
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility,timeSteps=150, gridPoints=149, engine="CrankNicolson")
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility,timeSteps=150, gridPoints=149, engine="BaroneAdesiWhaley") # error



From: Robert Harlow [mailto:rharlow86 at gmail.com]
Sent: Saturday, May 27, 2017 6:10 AM
To: Charles Duranceau
Cc: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug

Doesn't the error message say root not bracketed? That is informative because it means there is no root, or no implied volatility, that gives you back your price of 14.5- this is what you should expect given your inputs.  In order for a volatility to exist an option must have a positive time value.

Bob

On May 26, 2017, at 6:55 PM, Charles Duranceau <cduranceau at nial.ky<mailto:cduranceau at nial.ky>> wrote:
Thank you Robert,
I agree with you this is an extreme case and I don?t expect too much accuracy from the implied volatility I get, but my concern was more about the error message (a NA would have been more desirable)
By changing the engine I managed a workaround but I thought RQL team (or someone else having the same problem) could be interested with that non-desirable behavior.

Regards


From: Robert Harlow [mailto:rharlow86 at gmail.com]
Sent: Friday, May 26, 2017 3:32 PM
To: Charles Duranceau
Cc: r-sig-finance at r-project.org<mailto:r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] RQuantLib: AmericanOptionImpliedVolatility bug

Charles, my suggestion (which I doubt you will like) is to wrap your calls to implied volatility root finders (quant lib or any others) in a try block that returns NA on error.  Your example (very little or no time value) can be common if you are using mid prices from bid-ask quotes.  Note that when you plug the answer from your sum of squares root finding routine back into AmericanOption you get a value slightly above 14.5.

On Fri, May 26, 2017 at 11:46 AM, Charles Duranceau <cduranceau at nial.ky<mailto:cduranceau at nial.ky>> wrote:
Hi,

I found a problem with the function "AmericanOptionImpliedVolatility" in RQantLib which return an error for a specific set of conditions (but cannot identifies exactly what are these).
I present a case related to a short term, very deep in-the-money put with negative interest rate that generate error message. I present a reproducible example below.
I found the related function "AmericanOption" with default produce similar error when use in a routine to back-out the implied volatility.
However, I found good result (no error)  when using the engine="CrankNicolson" :  a na?ve routine for backing-out the implied vol with this function return a volatility.
There's a work around but think this information may add more stability to RQL.

Best Regards
Charles


Case
RQuantLib Version 4.2

R version 3.3.2 (64bits)

library(RQuantLib)

price = 14.5
strike = 65
Spot= 50.5
Rate = -0.00361
DividendYield = 0
Volatility = 0.296
YearToMaturity = 3/365

# error when Implied Vol
AmericanOptionImpliedVolatility("put", price,Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)

Error in americanOptionImpliedVolatilityEngine(type, value, underlying,  :

../../../QuantLib-1.6.2/ql/math/solver1d.hpp:202: In function `QuantLib::Real QuantLib::Solver1D<Impl>::solve(const F&, QuantLib::Real, QuantLib::Real, QuantLib::Real, QuantLib::Real) const [with F = QuantLib::{anonymous}::PriceError; Impl = QuantLib::Brent; QuantLib::Real = double]':
root not bracketed: f[1e-007,4] -> [1.955446e-003,3.006858e+000]

#also generate error
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility)

# works well
AmericanOption("put", Spot, strike, DividendYield, Rate,YearToMaturity, Volatility,timeSteps=150, gridPoints=149, engine="CrankNicolson")
# backing out the implied vol naively works
fImpliedVol(Volatility,price,"put", Spot, strike, DividendYield, Rate,YearToMaturity)


fImpliedVol<-function(iniVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat){
  ftm<-function(ImpVol,Premium,Callput, Spot, Strike, DivYield, Rate,YrtoMat, iVol)
  {
    ov<-AmericanOption(type=Callput, underlying=Spot, strike=Strike,dividendYield=DivYield, riskFreeRate=Rate, maturity=YrtoMat,volatility=ImpVol,
                       timeSteps=150, gridPoints=149, engine= "CrankNicolson")
    er<-(Premium-ov$value)^2
  }
  imp<-optimize(f=ftm,c(lower = 0, upper = 1.5), tol = 1e-4,Premium,Callput,Spot, Strike, DivYield, Rate,YrtoMat)
  return(imp$minimum)
}

> sessionInfo()
R version 3.3.2 (2016-10-31)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows >= 8 x64 (build 9200)

locale:
[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RQuantLib_0.4.3 dplyr_0.5.0

loaded via a namespace (and not attached):
[1] zoo_1.8-0        magrittr_1.5     R6_2.1.2         assertthat_0.2.0 DBI_0.6-1        tools_3.3.2      tibble_1.0       Rcpp_0.12.10
 [9] grid_3.3.2       lattice_0.20-34


>




        [[alternative HTML version deleted]]


_______________________________________________
R-SIG-Finance at r-project.org<mailto:R-SIG-Finance at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance<https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


	[[alternative HTML version deleted]]


From cduranceau at nial.ky  Wed May 31 02:00:58 2017
From: cduranceau at nial.ky (Charles Duranceau)
Date: Wed, 31 May 2017 00:00:58 +0000
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity
In-Reply-To: <BLUPR0101MB1506D9D4120ABD4A1D10C1288DFD0@BLUPR0101MB1506.prod.exchangelabs.com>
References: <253B4FA1ECEEB54DB661809CB6773455F69B4404@NOR-EXC01.northview.local>
 <BLUPR0101MB150651C5BA71D80D0375BA5D8DFC0@BLUPR0101MB1506.prod.exchangelabs.com>,
 <253B4FA1ECEEB54DB661809CB6773455F69B6832@NOR-EXC01.northview.local>
 <BLUPR0101MB1506D9D4120ABD4A1D10C1288DFD0@BLUPR0101MB1506.prod.exchangelabs.com>
Message-ID: <253B4FA1ECEEB54DB661809CB6773455F69B9EB6@NOR-EXC01.northview.local>

Hi Terry,
The settlement delay drives the accruals calculation, not the (clean) bond price.
In practical term, if you possess that bond the day before it matures you need to mark it as of that date (value date= Dec-30) and so it need to return a price (coupon + redemption amount) and so a yield.

I will then conclude it is not an error in the bond configuration  from my part. I just need to control for that type of case.
Thank you for your feedback.
Regards


From: Terry Leitch [mailto:tleitch1 at jhu.edu]
Sent: Saturday, May 27, 2017 11:43 AM
To: Charles Duranceau; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


You don't accrue because you haven't settled. Accruel begins when possess the bond. You possess it the day it matures. It can happen but makes no sense as it's just an exchange of cash for cash in practical terms.

________________________________
From: Charles Duranceau <cduranceau at nial.ky<mailto:cduranceau at nial.ky>>
Sent: Friday, May 26, 2017 7:14:42 PM
To: Terry Leitch; r-sig-finance at r-project.org<mailto:r-sig-finance at r-project.org>
Subject: RE: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity

Hi Terry,
you are right, the last settlement day of the bond is on Dec 30th as the bond redeems on a week end so the next business day as you point out fall after the redemption.
However, the day before you still have 1 day of accrual and still have a discount (and the price may deviate from par).
I agree this is an extreme case but possible (you held that bond to maturity) and you would not expect the function to return an error message unless the setup is wrong which is my question.
I find a work around by calculating a simple discount in such case but I thought it could be useful to know.

Regards


From: Terry Leitch [mailto:tleitch1 at jhu.edu]
Sent: Friday, May 26, 2017 1:52 PM
To: Charles Duranceau; r-sig-finance at r-project.org<mailto:r-sig-finance at r-project.org>
Subject: Re: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


Not sure, but maturity=effectivedate+1 . Since setllementDays=1, the bond matures on the same day you pay for it. Was that your intention?

________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org<mailto:r-sig-finance-bounces at r-project.org>> on behalf of Charles Duranceau <cduranceau at nial.ky<mailto:cduranceau at nial.ky>>
Sent: Friday, May 26, 2017 11:33:33 AM
To: r-sig-finance at r-project.org<mailto:r-sig-finance at r-project.org>
Subject: [R-SIG-Finance] RQuantLib FixedRateBondYield close to maturity


Hi,
I try to back-out the yield from a US Treasury note giving clean price using the function "FixedRateBondYield".
The procedure generate an error (See below).

Is this a structural problem or could it be correct by changing the bond settings ( I tried several changes already)?
Thank you
Charles


In this reproducible example, I try to back-out the yield for a bond maturing on 31-Dec-2016 as of (value date) 30-Dec-2016 (Friday).

library("RQuantLib")

dateValue<-as.Date("2016-12-30")

setEvaluationDate(dateValue)
# US Treasury note fixed attributes
gen_bond_UST =list(asettlementDays=1,afaceAmount= 100,aperiod=3,acalendar="UnitedStates/GovernmentBond",adayCounter=2,
                   abusinessDayConvention=2 ,acompound = 1 ,aredemption=100 ,aissueDate=as.Date("2014-01-31"),aendOfMonth=0)

# Function
with(gen_bond_UST,FixedRateBondYield(price=100.0078,effectiveDate=dateValue,maturityDate=as.Date("2016-12-31") ,rates=0.00625,
                   calendar=acalendar,settlementDays=asettlementDays,faceAmount= afaceAmount,period=aperiod,dayCounter=adayCounter,
                   businessDayConvention=abusinessDayConvention ,compound = acompound ,redemption=aredemption,issueDate=aissueDate))

# output
Error in fixedRateBondYieldByPriceEngine(settlementDays, price, calendar,  :
  degenerate single date (December 30th, 2016) schedule
seed date: December 31st, 2016
exit date: December 30th, 2016
effective date: December 30th, 2016
first date: null date
next to last date: null date
termination date: December 31st, 2016
generation rule: Backward
end of month: 0


> sessionInfo()

R version 3.3.2 (2016-10-31)

Platform: x86_64-w64-mingw32/x64 (64-bit)

Running under: Windows >= 8 x64 (build 9200)



locale:

[1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252    LC_MONETARY=English_United States.1252

[4] LC_NUMERIC=C                           LC_TIME=English_United States.1252



attached base packages:

[1] stats     graphics  grDevices utils     datasets  methods   base



other attached packages:

[1] RQuantLib_0.4.3



loaded via a namespace (and not attached):

[1] zoo_1.8-0       tools_3.3.2     Rcpp_0.12.10    grid_3.3.2      lattice_0.20-34



        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org<mailto:R-SIG-Finance at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance<https://stat.ethz.ch/mailman/listinfo/r-sig-finance>
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From vivekrao4 at yahoo.com  Fri Jun  2 16:45:19 2017
From: vivekrao4 at yahoo.com (Vivek Rao)
Date: Fri, 2 Jun 2017 14:45:19 +0000 (UTC)
Subject: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
References: <1849013260.516829.1496414719906.ref@mail.yahoo.com>
Message-ID: <1849013260.516829.1496414719906@mail.yahoo.com>

(I tried sending this message before joining the group, but it was held for moderation.)

It appears that the adjustOHLC function of the quantmod package does not create an .Adjusted field 
that reflects dividends. 

The code 

library("quantmod") 
sym <- "IBM" 
START.DATE = "2016-01-01" 
div <- getDividends(sym,auto.assign=FALSE,from=START.DATE) 
xx <- getSymbols(sym, from=START.DATE, src="yahoo", auto.assign=FALSE) 
xx.a <- adjustOHLC(xx) 
xx.uA <- adjustOHLC(xx, use.Adjusted=TRUE) 
cat("\ndiv\n") 
print(head(div)) 
cat("\nxx\n") 
print(head(xx)) 
cat("\nxx.a\n") 
print(head(xx.a)) 
cat("\nxx.uA\n") 
print(head(xx.uA)) 

produces the output below. I'd expect that IBM.Adjusted field to have different values 
at the beginning of the period, depending on whether one adjusts for dividends. 

div 
IBM.div 
2016-02-08     1.3 
2016-05-06     1.4 
2016-08-08     1.4 
2016-11-08     1.4 
2017-02-08     1.4 
2017-05-08     1.5 

xx 
IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted 
2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95 
2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85 
2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17 
2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86 
2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63 
2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23 

xx.a 
IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted 
2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95 
2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85 
2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17 
2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86 
2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63 
2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23 

xx.uA 
IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted 
2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95 
2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85 
2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17 
2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86 
2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63 
2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23 

Vivek Rao


From ilya.kipnis at gmail.com  Fri Jun  2 16:47:20 2017
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 2 Jun 2017 10:47:20 -0400
Subject: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
In-Reply-To: <1849013260.516829.1496414719906@mail.yahoo.com>
References: <1849013260.516829.1496414719906.ref@mail.yahoo.com>
 <1849013260.516829.1496414719906@mail.yahoo.com>
Message-ID: <CA+oJuEE6imCJByGBqCDN6oUitvw32X_mDKWYYNUc6iyeXLM02g@mail.gmail.com>

That's a function of yahoo data no longer adjusting for dividends.

On Fri, Jun 2, 2017 at 10:45 AM, Vivek Rao via R-SIG-Finance <
r-sig-finance at r-project.org> wrote:

> (I tried sending this message before joining the group, but it was held
> for moderation.)
>
> It appears that the adjustOHLC function of the quantmod package does not
> create an .Adjusted field
> that reflects dividends.
>
> The code
>
> library("quantmod")
> sym <- "IBM"
> START.DATE = "2016-01-01"
> div <- getDividends(sym,auto.assign=FALSE,from=START.DATE)
> xx <- getSymbols(sym, from=START.DATE, src="yahoo", auto.assign=FALSE)
> xx.a <- adjustOHLC(xx)
> xx.uA <- adjustOHLC(xx, use.Adjusted=TRUE)
> cat("\ndiv\n")
> print(head(div))
> cat("\nxx\n")
> print(head(xx))
> cat("\nxx.a\n")
> print(head(xx.a))
> cat("\nxx.uA\n")
> print(head(xx.uA))
>
> produces the output below. I'd expect that IBM.Adjusted field to have
> different values
> at the beginning of the period, depending on whether one adjusts for
> dividends.
>
> div
> IBM.div
> 2016-02-08     1.3
> 2016-05-06     1.4
> 2016-08-08     1.4
> 2016-11-08     1.4
> 2017-02-08     1.4
> 2017-05-08     1.5
>
> xx
> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
>
> xx.a
> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
>
> xx.uA
> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
>
> Vivek Rao
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Fri Jun  2 16:51:22 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 2 Jun 2017 09:51:22 -0500
Subject: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
In-Reply-To: <CA+oJuEE6imCJByGBqCDN6oUitvw32X_mDKWYYNUc6iyeXLM02g@mail.gmail.com>
References: <1849013260.516829.1496414719906.ref@mail.yahoo.com>
 <1849013260.516829.1496414719906@mail.yahoo.com>
 <CA+oJuEE6imCJByGBqCDN6oUitvw32X_mDKWYYNUc6iyeXLM02g@mail.gmail.com>
Message-ID: <CAPPM_gSDAFqxiq3dKiDPTTN-KriCsJC=8SkwMA3CdpMahiqJ+A@mail.gmail.com>

On Fri, Jun 2, 2017 at 9:47 AM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:
> That's a function of yahoo data no longer adjusting for dividends.
>
No, it isn't.

> On Fri, Jun 2, 2017 at 10:45 AM, Vivek Rao via R-SIG-Finance <
> r-sig-finance at r-project.org> wrote:
>
>> (I tried sending this message before joining the group, but it was held
>> for moderation.)
>>
>> It appears that the adjustOHLC function of the quantmod package does not
>> create an .Adjusted field
>> that reflects dividends.
>>
>> The code
>>
>> library("quantmod")
>> sym <- "IBM"
>> START.DATE = "2016-01-01"
>> div <- getDividends(sym,auto.assign=FALSE,from=START.DATE)
>> xx <- getSymbols(sym, from=START.DATE, src="yahoo", auto.assign=FALSE)
>> xx.a <- adjustOHLC(xx)
>> xx.uA <- adjustOHLC(xx, use.Adjusted=TRUE)

The issue is that you must set the symbol.name argument if the first
argument to adjustOHLC() is not named the same as the symbol being
adjusted.

This works:

xx.a2 <- adjustOHLC(xx, symbol.name = sym)
head(xx.a2)
           IBM.Open IBM.High  IBM.Low IBM.Close IBM.Volume IBM.Adjusted
2016-01-04 128.3440 128.6942 127.0568  128.6753    5229400       135.95
2016-01-05 129.4420 129.5650 127.6342  128.5807    3924800       135.85
2016-01-06 127.1893 128.3251 126.4700  127.9371    4310900       135.17
2016-01-07 126.5457 127.7951 125.3437  125.7507    7025800       132.86
2016-01-08 126.0535 126.6593 124.2931  124.5865    4762700       131.63
2016-01-11 124.7568 126.6593 124.7095  126.1009    4974400       133.23

>> cat("\ndiv\n")
>> print(head(div))
>> cat("\nxx\n")
>> print(head(xx))
>> cat("\nxx.a\n")
>> print(head(xx.a))
>> cat("\nxx.uA\n")
>> print(head(xx.uA))
>>
>> produces the output below. I'd expect that IBM.Adjusted field to have
>> different values
>> at the beginning of the period, depending on whether one adjusts for
>> dividends.
>>
>> div
>> IBM.div
>> 2016-02-08     1.3
>> 2016-05-06     1.4
>> 2016-08-08     1.4
>> 2016-11-08     1.4
>> 2017-02-08     1.4
>> 2017-05-08     1.5
>>
>> xx
>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
>> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
>> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
>> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
>> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
>> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
>>
>> xx.a
>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
>> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
>> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
>> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
>> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
>> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
>>
>> xx.uA
>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
>> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
>> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
>> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
>> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
>> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
>>
>> Vivek Rao
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Fri Jun  2 16:53:05 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 2 Jun 2017 09:53:05 -0500
Subject: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
In-Reply-To: <CAPPM_gSDAFqxiq3dKiDPTTN-KriCsJC=8SkwMA3CdpMahiqJ+A@mail.gmail.com>
References: <1849013260.516829.1496414719906.ref@mail.yahoo.com>
 <1849013260.516829.1496414719906@mail.yahoo.com>
 <CA+oJuEE6imCJByGBqCDN6oUitvw32X_mDKWYYNUc6iyeXLM02g@mail.gmail.com>
 <CAPPM_gSDAFqxiq3dKiDPTTN-KriCsJC=8SkwMA3CdpMahiqJ+A@mail.gmail.com>
Message-ID: <CAPPM_gRdjcRX3k17CVmTVLCVa5gy8QqPnwNZUR6utX3fUXSitA@mail.gmail.com>

Also note that this issue is discussed here:
https://github.com/joshuaulrich/quantmod/issues/152

Comments welcome!

On Fri, Jun 2, 2017 at 9:51 AM, Joshua Ulrich <josh.m.ulrich at gmail.com>
wrote:

> On Fri, Jun 2, 2017 at 9:47 AM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:
> > That's a function of yahoo data no longer adjusting for dividends.
> >
> No, it isn't.
>
> > On Fri, Jun 2, 2017 at 10:45 AM, Vivek Rao via R-SIG-Finance <
> > r-sig-finance at r-project.org> wrote:
> >
> >> (I tried sending this message before joining the group, but it was held
> >> for moderation.)
> >>
> >> It appears that the adjustOHLC function of the quantmod package does not
> >> create an .Adjusted field
> >> that reflects dividends.
> >>
> >> The code
> >>
> >> library("quantmod")
> >> sym <- "IBM"
> >> START.DATE = "2016-01-01"
> >> div <- getDividends(sym,auto.assign=FALSE,from=START.DATE)
> >> xx <- getSymbols(sym, from=START.DATE, src="yahoo", auto.assign=FALSE)
> >> xx.a <- adjustOHLC(xx)
> >> xx.uA <- adjustOHLC(xx, use.Adjusted=TRUE)
>
> The issue is that you must set the symbol.name argument if the first
> argument to adjustOHLC() is not named the same as the symbol being
> adjusted.
>
> This works:
>
> xx.a2 <- adjustOHLC(xx, symbol.name = sym)
> head(xx.a2)
>            IBM.Open IBM.High  IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> 2016-01-04 128.3440 128.6942 127.0568  128.6753    5229400       135.95
> 2016-01-05 129.4420 129.5650 127.6342  128.5807    3924800       135.85
> 2016-01-06 127.1893 128.3251 126.4700  127.9371    4310900       135.17
> 2016-01-07 126.5457 127.7951 125.3437  125.7507    7025800       132.86
> 2016-01-08 126.0535 126.6593 124.2931  124.5865    4762700       131.63
> 2016-01-11 124.7568 126.6593 124.7095  126.1009    4974400       133.23
>
> >> cat("\ndiv\n")
> >> print(head(div))
> >> cat("\nxx\n")
> >> print(head(xx))
> >> cat("\nxx.a\n")
> >> print(head(xx.a))
> >> cat("\nxx.uA\n")
> >> print(head(xx.uA))
> >>
> >> produces the output below. I'd expect that IBM.Adjusted field to have
> >> different values
> >> at the beginning of the period, depending on whether one adjusts for
> >> dividends.
> >>
> >> div
> >> IBM.div
> >> 2016-02-08     1.3
> >> 2016-05-06     1.4
> >> 2016-08-08     1.4
> >> 2016-11-08     1.4
> >> 2017-02-08     1.4
> >> 2017-05-08     1.5
> >>
> >> xx
> >> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> >> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
> >> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
> >> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
> >> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
> >> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
> >> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
> >>
> >> xx.a
> >> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> >> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
> >> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
> >> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
> >> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
> >> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
> >> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
> >>
> >> xx.uA
> >> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> >> 2016-01-04   135.60   135.97  134.24    135.95    5229400       135.95
> >> 2016-01-05   136.76   136.89  134.85    135.85    3924800       135.85
> >> 2016-01-06   134.38   135.58  133.62    135.17    4310900       135.17
> >> 2016-01-07   133.70   135.02  132.43    132.86    7025800       132.86
> >> 2016-01-08   133.18   133.82  131.32    131.63    4762700       131.63
> >> 2016-01-11   131.81   133.82  131.76    133.23    4974400       133.23
> >>
> >> Vivek Rao
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >>
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com

	[[alternative HTML version deleted]]


From vivekrao4 at yahoo.com  Fri Jun  2 17:29:02 2017
From: vivekrao4 at yahoo.com (Vivek Rao)
Date: Fri, 2 Jun 2017 15:29:02 +0000 (UTC)
Subject: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
In-Reply-To: <CAPPM_gSDAFqxiq3dKiDPTTN-KriCsJC=8SkwMA3CdpMahiqJ+A@mail.gmail.com>
References: <1849013260.516829.1496414719906.ref@mail.yahoo.com>
 <1849013260.516829.1496414719906@mail.yahoo.com>
 <CA+oJuEE6imCJByGBqCDN6oUitvw32X_mDKWYYNUc6iyeXLM02g@mail.gmail.com>
 <CAPPM_gSDAFqxiq3dKiDPTTN-KriCsJC=8SkwMA3CdpMahiqJ+A@mail.gmail.com>
Message-ID: <1432050375.538110.1496417342892@mail.yahoo.com>

Thank you. I see that the IBM.Open, IBM.High, IBM.Low, and IBM.Close columnsare adjusted for dividends, and IBM.Adjusted column actually contains the raw close.This is fine as long the user knows this -- the naming of the columns could suggestthe reverse.
Before Yahoo changed its data format, when I used?getYahooData from package TTR to get data, the fields returned wereOpen,High,Low,Close,Volume,Unadj.Close,Div,Split,Adj.Div . I think the label "Unadj.Close" for the raw close
is more descriptive.
Vivek Rao
      From: Joshua Ulrich <josh.m.ulrich at gmail.com>
 To: Ilya Kipnis <ilya.kipnis at gmail.com> 
Cc: Vivek Rao <vivekrao4 at yahoo.com>; "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
 Sent: Friday, June 2, 2017 10:51 AM
 Subject: Re: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
   
On Fri, Jun 2, 2017 at 9:47 AM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:
> That's a function of yahoo data no longer adjusting for dividends.
>
No, it isn't.

> On Fri, Jun 2, 2017 at 10:45 AM, Vivek Rao via R-SIG-Finance <
> r-sig-finance at r-project.org> wrote:
>
>> (I tried sending this message before joining the group, but it was held
>> for moderation.)
>>
>> It appears that the adjustOHLC function of the quantmod package does not
>> create an .Adjusted field
>> that reflects dividends.
>>
>> The code
>>
>> library("quantmod")
>> sym <- "IBM"
>> START.DATE = "2016-01-01"
>> div <- getDividends(sym,auto.assign=FALSE,from=START.DATE)
>> xx <- getSymbols(sym, from=START.DATE, src="yahoo", auto.assign=FALSE)
>> xx.a <- adjustOHLC(xx)
>> xx.uA <- adjustOHLC(xx, use.Adjusted=TRUE)

The issue is that you must set the symbol.name argument if the first
argument to adjustOHLC() is not named the same as the symbol being
adjusted.

This works:

xx.a2 <- adjustOHLC(xx, symbol.name = sym)
head(xx.a2)
? ? ? ? ? IBM.Open IBM.High? IBM.Low IBM.Close IBM.Volume IBM.Adjusted
2016-01-04 128.3440 128.6942 127.0568? 128.6753? ? 5229400? ? ? 135.95
2016-01-05 129.4420 129.5650 127.6342? 128.5807? ? 3924800? ? ? 135.85
2016-01-06 127.1893 128.3251 126.4700? 127.9371? ? 4310900? ? ? 135.17
2016-01-07 126.5457 127.7951 125.3437? 125.7507? ? 7025800? ? ? 132.86
2016-01-08 126.0535 126.6593 124.2931? 124.5865? ? 4762700? ? ? 131.63
2016-01-11 124.7568 126.6593 124.7095? 126.1009? ? 4974400? ? ? 133.23

>> cat("\ndiv\n")
>> print(head(div))
>> cat("\nxx\n")
>> print(head(xx))
>> cat("\nxx.a\n")
>> print(head(xx.a))
>> cat("\nxx.uA\n")
>> print(head(xx.uA))
>>
>> produces the output below. I'd expect that IBM.Adjusted field to have
>> different values
>> at the beginning of the period, depending on whether one adjusts for
>> dividends.
>>
>> div
>> IBM.div
>> 2016-02-08? ? 1.3
>> 2016-05-06? ? 1.4
>> 2016-08-08? ? 1.4
>> 2016-11-08? ? 1.4
>> 2017-02-08? ? 1.4
>> 2017-05-08? ? 1.5
>>
>> xx
>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>> 2016-01-04? 135.60? 135.97? 134.24? ? 135.95? ? 5229400? ? ? 135.95
>> 2016-01-05? 136.76? 136.89? 134.85? ? 135.85? ? 3924800? ? ? 135.85
>> 2016-01-06? 134.38? 135.58? 133.62? ? 135.17? ? 4310900? ? ? 135.17
>> 2016-01-07? 133.70? 135.02? 132.43? ? 132.86? ? 7025800? ? ? 132.86
>> 2016-01-08? 133.18? 133.82? 131.32? ? 131.63? ? 4762700? ? ? 131.63
>> 2016-01-11? 131.81? 133.82? 131.76? ? 133.23? ? 4974400? ? ? 133.23
>>
>> xx.a
>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>> 2016-01-04? 135.60? 135.97? 134.24? ? 135.95? ? 5229400? ? ? 135.95
>> 2016-01-05? 136.76? 136.89? 134.85? ? 135.85? ? 3924800? ? ? 135.85
>> 2016-01-06? 134.38? 135.58? 133.62? ? 135.17? ? 4310900? ? ? 135.17
>> 2016-01-07? 133.70? 135.02? 132.43? ? 132.86? ? 7025800? ? ? 132.86
>> 2016-01-08? 133.18? 133.82? 131.32? ? 131.63? ? 4762700? ? ? 131.63
>> 2016-01-11? 131.81? 133.82? 131.76? ? 133.23? ? 4974400? ? ? 133.23
>>
>> xx.uA
>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>> 2016-01-04? 135.60? 135.97? 134.24? ? 135.95? ? 5229400? ? ? 135.95
>> 2016-01-05? 136.76? 136.89? 134.85? ? 135.85? ? 3924800? ? ? 135.85
>> 2016-01-06? 134.38? 135.58? 133.62? ? 135.17? ? 4310900? ? ? 135.17
>> 2016-01-07? 133.70? 135.02? 132.43? ? 132.86? ? 7025800? ? ? 132.86
>> 2016-01-08? 133.18? 133.82? 131.32? ? 131.63? ? 4762700? ? ? 131.63
>> 2016-01-11? 131.81? 133.82? 131.76? ? 133.23? ? 4974400? ? ? 133.23
>>
>> Vivek Rao
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>? ? ? ? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich? |? about.me/joshuaulrich
FOSS Trading? |? www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


   
	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Fri Jun  2 17:34:41 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 2 Jun 2017 10:34:41 -0500
Subject: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
In-Reply-To: <1432050375.538110.1496417342892@mail.yahoo.com>
References: <1849013260.516829.1496414719906.ref@mail.yahoo.com>
 <1849013260.516829.1496414719906@mail.yahoo.com>
 <CA+oJuEE6imCJByGBqCDN6oUitvw32X_mDKWYYNUc6iyeXLM02g@mail.gmail.com>
 <CAPPM_gSDAFqxiq3dKiDPTTN-KriCsJC=8SkwMA3CdpMahiqJ+A@mail.gmail.com>
 <1432050375.538110.1496417342892@mail.yahoo.com>
Message-ID: <CAPPM_gT-fSe7f+oUQ+6di+bZeM-J-HAjvM2mp8Gj8yiM=C9bew@mail.gmail.com>

On Fri, Jun 2, 2017 at 10:29 AM, Vivek Rao <vivekrao4 at yahoo.com> wrote:
> Thank you. I see that the IBM.Open, IBM.High, IBM.Low, and IBM.Close columns
> are adjusted for dividends, and IBM.Adjusted column actually contains the
> raw close.

This is not true.  The IBM.Adjusted column contains the split-adjusted
close.  It's the same as the raw close for this time period though,
because IBM has not had a split since mid-1999.

getSymbols("IBM", from ="1900-01-01")
head(IBM)
           IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
1962-01-02    578.5    578.5     572  572.0000     387200     7.626667
1962-01-03    572.0    577.0     572  577.0000     288000     7.693333
1962-01-04    577.0    577.0     571  571.2501     256000     7.616667
1962-01-05    570.5    570.5     559  560.0000     363200     7.466667
1962-01-08    559.5    559.5     545  549.5001     544000     7.326667
1962-01-09    552.0    563.0     552  556.0000     491200     7.413333
tail(IBM["1999-05"])
           IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
1999-05-21  232.750  233.375 229.188  230.3750    6899800     115.1875
1999-05-24  230.312  230.688 221.750  223.7500    8598200     111.8750
1999-05-25  222.500  226.000 221.000  221.1875    9405000     110.5938
1999-05-26  223.000  236.625 221.438  236.2500   16628000     118.1250
1999-05-27  116.688  116.875 112.625  116.0000   10552500     116.0000
1999-05-28  116.000  116.750 114.188  116.0000    6379500     116.0000


> This is fine as long the user knows this -- the naming of the columns could
> suggest
> the reverse.
>
> Before Yahoo changed its data format, when I used getYahooData from package
> TTR to get data, the fields returned were
> Open,High,Low,Close,Volume,Unadj.Close,Div,Split,Adj.Div . I think the label
> "Unadj.Close" for the raw close
> is more descriptive.
>
> Vivek Rao
>
> ________________________________
> From: Joshua Ulrich <josh.m.ulrich at gmail.com>
> To: Ilya Kipnis <ilya.kipnis at gmail.com>
> Cc: Vivek Rao <vivekrao4 at yahoo.com>; "r-sig-finance at r-project.org"
> <r-sig-finance at r-project.org>
> Sent: Friday, June 2, 2017 10:51 AM
> Subject: Re: [R-SIG-Finance] does quantmod::adjustOHLC adust for dividends?
>
> On Fri, Jun 2, 2017 at 9:47 AM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:
>> That's a function of yahoo data no longer adjusting for dividends.
>>
> No, it isn't.
>
>> On Fri, Jun 2, 2017 at 10:45 AM, Vivek Rao via R-SIG-Finance <
>> r-sig-finance at r-project.org> wrote:
>>
>>> (I tried sending this message before joining the group, but it was held
>>> for moderation.)
>>>
>>> It appears that the adjustOHLC function of the quantmod package does not
>>> create an .Adjusted field
>>> that reflects dividends.
>>>
>>> The code
>>>
>>> library("quantmod")
>>> sym <- "IBM"
>>> START.DATE = "2016-01-01"
>>> div <- getDividends(sym,auto.assign=FALSE,from=START.DATE)
>>> xx <- getSymbols(sym, from=START.DATE, src="yahoo", auto.assign=FALSE)
>>> xx.a <- adjustOHLC(xx)
>>> xx.uA <- adjustOHLC(xx, use.Adjusted=TRUE)
>
> The issue is that you must set the symbol.name argument if the first
> argument to adjustOHLC() is not named the same as the symbol being
> adjusted.
>
> This works:
>
> xx.a2 <- adjustOHLC(xx, symbol.name = sym)
> head(xx.a2)
>           IBM.Open IBM.High  IBM.Low IBM.Close IBM.Volume IBM.Adjusted
> 2016-01-04 128.3440 128.6942 127.0568  128.6753    5229400      135.95
> 2016-01-05 129.4420 129.5650 127.6342  128.5807    3924800      135.85
> 2016-01-06 127.1893 128.3251 126.4700  127.9371    4310900      135.17
> 2016-01-07 126.5457 127.7951 125.3437  125.7507    7025800      132.86
> 2016-01-08 126.0535 126.6593 124.2931  124.5865    4762700      131.63
> 2016-01-11 124.7568 126.6593 124.7095  126.1009    4974400      133.23
>
>>> cat("\ndiv\n")
>>> print(head(div))
>>> cat("\nxx\n")
>>> print(head(xx))
>>> cat("\nxx.a\n")
>>> print(head(xx.a))
>>> cat("\nxx.uA\n")
>>> print(head(xx.uA))
>>>
>>> produces the output below. I'd expect that IBM.Adjusted field to have
>>> different values
>>> at the beginning of the period, depending on whether one adjusts for
>>> dividends.
>>>
>>> div
>>> IBM.div
>>> 2016-02-08    1.3
>>> 2016-05-06    1.4
>>> 2016-08-08    1.4
>>> 2016-11-08    1.4
>>> 2017-02-08    1.4
>>> 2017-05-08    1.5
>>>
>>> xx
>>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>>> 2016-01-04  135.60  135.97  134.24    135.95    5229400      135.95
>>> 2016-01-05  136.76  136.89  134.85    135.85    3924800      135.85
>>> 2016-01-06  134.38  135.58  133.62    135.17    4310900      135.17
>>> 2016-01-07  133.70  135.02  132.43    132.86    7025800      132.86
>>> 2016-01-08  133.18  133.82  131.32    131.63    4762700      131.63
>>> 2016-01-11  131.81  133.82  131.76    133.23    4974400      133.23
>>>
>>> xx.a
>>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>>> 2016-01-04  135.60  135.97  134.24    135.95    5229400      135.95
>>> 2016-01-05  136.76  136.89  134.85    135.85    3924800      135.85
>>> 2016-01-06  134.38  135.58  133.62    135.17    4310900      135.17
>>> 2016-01-07  133.70  135.02  132.43    132.86    7025800      132.86
>>> 2016-01-08  133.18  133.82  131.32    131.63    4762700      131.63
>>> 2016-01-11  131.81  133.82  131.76    133.23    4974400      133.23
>>>
>>> xx.uA
>>> IBM.Open IBM.High IBM.Low IBM.Close IBM.Volume IBM.Adjusted
>>> 2016-01-04  135.60  135.97  134.24    135.95    5229400      135.95
>>> 2016-01-05  136.76  136.89  134.85    135.85    3924800      135.85
>>> 2016-01-06  134.38  135.58  133.62    135.17    4310900      135.17
>>> 2016-01-07  133.70  135.02  132.43    132.86    7025800      132.86
>>> 2016-01-08  133.18  133.82  131.32    131.63    4762700      131.63
>>> 2016-01-11  131.81  133.82  131.76    133.23    4974400      133.23
>>>
>>> Vivek Rao
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>>> should go.
>>>
>>
>>        [[alternative HTML version deleted]]
>
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>
>
>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From sabolkj at gmail.com  Sat Jun  3 19:10:23 2017
From: sabolkj at gmail.com (Keith Sabol)
Date: Sat, 3 Jun 2017 11:10:23 -0600
Subject: [R-SIG-Finance] Quantmod: Problem with Lo(LOW)
Message-ID: <CACOcrKaALMkTmWHnCGzxNOC0bXCe2pR5DYi=65wCYNBiE3mXOw@mail.gmail.com>

There appears to be a problem with Lo() when used with ticker "LOW".

library(quantmod)

getSymbols("LOW")
[1] "LOW"
> adjustOHLC(LOW)
Error in `-.default`(Lo(x), Cl(x)) : non-conformable arrays
> head(LOW)
           LOW.Open LOW.High LOW.Low LOW.Close LOW.Volume LOW.Adjusted
2007-01-03    31.21    32.31   31.15     32.04   14143200        32.04
2007-01-04    32.40    32.50   31.61     32.18    8351900        32.18
2007-01-05    32.16    32.41   31.59     31.79    8295600        31.79
2007-01-08    31.62    31.82   31.13     31.70    6423400        31.70
2007-01-09    31.76    32.05   31.69     31.87    5053300        31.87
2007-01-10    31.71    32.59   31.70     32.47    8741800        32.47
> Lo
function (x)
{
    if (has.Lo(x))
        return(x[, grep("Low", colnames(x), ignore.case = TRUE)])
    stop("subscript out of bounds: no column name containing \"Low\"")
}
<environment: namespace:quantmod>
>

head(LOW[, grep("Low", colnames(LOW), ignore.case = TRUE)])
           LOW.Open LOW.High LOW.Low LOW.Close LOW.Volume LOW.Adjusted
2007-01-03    31.21    32.31   31.15     32.04   14143200        32.04
2007-01-04    32.40    32.50   31.61     32.18    8351900        32.18
2007-01-05    32.16    32.41   31.59     31.79    8295600        31.79
2007-01-08    31.62    31.82   31.13     31.70    6423400        31.70
2007-01-09    31.76    32.05   31.69     31.87    5053300        31.87
2007-01-10    31.71    32.59   31.70     32.47    8741800        32.47

One viable remedy appears to be adding a period before "Low" in the grep
line:


head(LOW[, grep(".Low", colnames(LOW), ignore.case = TRUE)])
           LOW.Low
2007-01-03   31.15
2007-01-04   31.61
2007-01-05   31.59
2007-01-08   31.13
2007-01-09   31.69
2007-01-10   31.70
>

Hope this helps.

Thanks for your great work on this package Josh.

Keith

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Sat Jun  3 19:15:41 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 3 Jun 2017 12:15:41 -0500
Subject: [R-SIG-Finance] Quantmod: Problem with Lo(LOW)
In-Reply-To: <CACOcrKaALMkTmWHnCGzxNOC0bXCe2pR5DYi=65wCYNBiE3mXOw@mail.gmail.com>
References: <CACOcrKaALMkTmWHnCGzxNOC0bXCe2pR5DYi=65wCYNBiE3mXOw@mail.gmail.com>
Message-ID: <CAPPM_gQcEERFGGqj4GaLHbeGnsrLD4TJ+aTrsZu4-tVhocY61w@mail.gmail.com>

On Sat, Jun 3, 2017 at 12:10 PM, Keith Sabol <sabolkj at gmail.com> wrote:
> There appears to be a problem with Lo() when used with ticker "LOW".
>
> library(quantmod)
>
> getSymbols("LOW")
> [1] "LOW"
>> adjustOHLC(LOW)
> Error in `-.default`(Lo(x), Cl(x)) : non-conformable arrays
>> head(LOW)
>            LOW.Open LOW.High LOW.Low LOW.Close LOW.Volume LOW.Adjusted
> 2007-01-03    31.21    32.31   31.15     32.04   14143200        32.04
> 2007-01-04    32.40    32.50   31.61     32.18    8351900        32.18
> 2007-01-05    32.16    32.41   31.59     31.79    8295600        31.79
> 2007-01-08    31.62    31.82   31.13     31.70    6423400        31.70
> 2007-01-09    31.76    32.05   31.69     31.87    5053300        31.87
> 2007-01-10    31.71    32.59   31.70     32.47    8741800        32.47
>> Lo
> function (x)
> {
>     if (has.Lo(x))
>         return(x[, grep("Low", colnames(x), ignore.case = TRUE)])
>     stop("subscript out of bounds: no column name containing \"Low\"")
> }
> <environment: namespace:quantmod>
>>
>
> head(LOW[, grep("Low", colnames(LOW), ignore.case = TRUE)])
>            LOW.Open LOW.High LOW.Low LOW.Close LOW.Volume LOW.Adjusted
> 2007-01-03    31.21    32.31   31.15     32.04   14143200        32.04
> 2007-01-04    32.40    32.50   31.61     32.18    8351900        32.18
> 2007-01-05    32.16    32.41   31.59     31.79    8295600        31.79
> 2007-01-08    31.62    31.82   31.13     31.70    6423400        31.70
> 2007-01-09    31.76    32.05   31.69     31.87    5053300        31.87
> 2007-01-10    31.71    32.59   31.70     32.47    8741800        32.47
>
> One viable remedy appears to be adding a period before "Low" in the grep
> line:
>
This has been suggested before, and does not work:
https://github.com/joshuaulrich/quantmod/issues/24

>
> head(LOW[, grep(".Low", colnames(LOW), ignore.case = TRUE)])
>            LOW.Low
> 2007-01-03   31.15
> 2007-01-04   31.61
> 2007-01-05   31.59
> 2007-01-08   31.13
> 2007-01-09   31.69
> 2007-01-10   31.70
>>
>
> Hope this helps.
>
> Thanks for your great work on this package Josh.
>
> Keith
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From rharlow86 at gmail.com  Sun Jun  4 19:19:19 2017
From: rharlow86 at gmail.com (Robert Harlow)
Date: Sun, 4 Jun 2017 13:19:19 -0400
Subject: [R-SIG-Finance] quadprogXT package
Message-ID: <CAHdfS96OB_JEf0pZnL7LKW7f-mSNO6fixJo6xUzPZ1B89YXXbg@mail.gmail.com>

All,
  I put out a package on CRAN last weekend that extends quadprog so that
constraints involving absolute values (e.g. book size and turnover in a
financial context) are handled in addition to allowing absolute value (L1)
considerations in the objective function, which can handle linear
transaction costs or when the expected return for being long is different
than that of being short due to borrowing costs.  Since problems are
ultimately solved by the Fortran code of quadprog, convergence happens
quite quickly for up to hundreds of assets.

I view this as a "beta" release and feedback is very welcome.  I already
need to improve documentation and plan to in the next release.

Bob


https://cran.r-project.org/web/packages/quadprogXT/index.html

https://github.com/rharlow86/quadprogXT

	[[alternative HTML version deleted]]


From glennmschultz at me.com  Thu Jun  8 03:52:14 2017
From: glennmschultz at me.com (Glenn Schultz)
Date: Thu, 08 Jun 2017 01:52:14 +0000 (GMT)
Subject: [R-SIG-Finance] termstrc package
Message-ID: <09d4cc34-a2f9-49df-b401-c5b3804be733@me.com>

All,

I have set-up the the termstrc list to fit UST curves. ?I have succefully used the package to fit agency mortgage backed security curves. ?However, for some reason I am running into problem with the UST. ?I have dput the list below. ?Obviously, I have something wrong here but I gone over the list for quite awhile and compared to govbonds data. ?At this point I just cannot see what I am have wrong. ?Any help is appreciated.

Glenn

structure(list(OTR = structure(list(ISIN = c("912828S68", "912828XS4", 
"912828S76", "9128282A7", "912810RT7"), MATURITYDATE = structure(c(17378, 
18047, 18808, 20680, 27985), class = "Date"), ISSUEDATE = structure(c(17014, 
17317, 16982, 17028, 17028), class = "Date"), COUPONRATE = c(0.0075, 
0.01125, 0.01125, 0.015, 0.0225), PRICE = c(100, 100, 100, 100, 
100), ACCRUED = c(607.523148148148, 2859.375, 424.21875, 1529.28240740741, 
2293.92361111111), TODAY = logical(0), CASHFLOWS = structure(list(
ISIN = c("912828S68", "912828XS4", "912828XS4", "912828XS4", 
"912828XS4", "912828S76", "912828S76", "912828S76", "912828S76", 
"912828S76", "912828S76", "912828S76", "912828S76", "912828S76", 
"9128282A7", "9128282A7", "9128282A7", "9128282A7", "9128282A7", 
"9128282A7", "9128282A7", "9128282A7", "9128282A7", "9128282A7", 
"9128282A7", "9128282A7", "9128282A7", "9128282A7", "9128282A7", 
"9128282A7", "9128282A7", "9128282A7", "9128282A7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7", "912810RT7", "912810RT7", 
"912810RT7", "912810RT7", "912810RT7"), CF = c(1003770.83333333, 
5718.75, 5687.5, 5718.75, 1005687.5, 5656.25, 5750, 5656.25, 
5750, 5656.25, 5750, 5687.5, 5750, 1005656.25, 7541.66666666667, 
7666.66666666667, 7541.66666666667, 7666.66666666667, 7541.66666666667, 
7666.66666666667, 7583.33333333333, 7666.66666666667, 7541.66666666667, 
7666.66666666667, 7541.66666666667, 7666.66666666667, 7541.66666666667, 
7666.66666666667, 7583.33333333333, 7666.66666666667, 7541.66666666667, 
7666.66666666667, 1007541.66666667, 11312.5, 11500, 11312.5, 
11500, 11312.5, 11500, 11375, 11500, 11312.5, 11500, 11312.5, 
11500, 11312.5, 11500, 11375, 11500, 11312.5, 11500, 11312.5, 
11500, 11312.5, 11500, 11375, 11500, 11312.5, 11500, 11312.5, 
11500, 11312.5, 11500, 11375, 11500, 11312.5, 11500, 11312.5, 
11500, 11312.5, 11500, 11375, 11500, 11312.5, 11500, 11312.5, 
11500, 11312.5, 11500, 11375, 11500, 11312.5, 11500, 11312.5, 
11500, 11312.5, 11500, 11375, 11500, 11312.5, 11500, 1011312.5
), DATE = structure(c(17378, 17500, 17682, 17865, 18047, 
17347, 17531, 17712, 17896, 18077, 18261, 18443, 18627, 18808, 
17393, 17577, 17758, 17942, 18123, 18307, 18489, 18673, 18854, 
19038, 19219, 19403, 19584, 19768, 19950, 20134, 20315, 20499, 
20680, 17393, 17577, 17758, 17942, 18123, 18307, 18489, 18673, 
18854, 19038, 19219, 19403, 19584, 19768, 19950, 20134, 20315, 
20499, 20680, 20864, 21045, 21229, 21411, 21595, 21776, 21960, 
22141, 22325, 22506, 22690, 22872, 23056, 23237, 23421, 23602, 
23786, 23967, 24151, 24333, 24517, 24698, 24882, 25063, 25247, 
25428, 25612, 25794, 25978, 26159, 26343, 26524, 26708, 26889, 
27073, 27255, 27439, 27620, 27804, 27985), class = "Date")), .Names = c("ISIN", 
"CF", "DATE"))), .Names = c("ISIN", "MATURITYDATE", "ISSUEDATE", 
"COUPONRATE", "PRICE", "ACCRUED", "TODAY", "CASHFLOWS"))), .Names = "OTR", class = "couponbonds")
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20170608/2b6b216b/attachment.html>

From amolgupta87 at gmail.com  Sun Jun 25 10:09:43 2017
From: amolgupta87 at gmail.com (amol gupta)
Date: Sun, 25 Jun 2017 13:39:43 +0530
Subject: [R-SIG-Finance] Fteching options data using package IBrokers and
	interactivebrokers
Message-ID: <CAO7kh0Erq09A---+LkCWXdAxeFWZiMNnQJqa0EXpLRdxTzQp+Q@mail.gmail.com>

Hello,

I have been trying to fetch contract details and finally fetch contract
historical data. I have been able to do it with stock futures but I have
been failing with options. Here is a very small snippet.


c<-twsOPT(local = 'HDFC17JUN1780CE',strike = 1780, right = 'C',
          currency = 'INR',primary = 'NSE',multiplier = 1,
          conId = 271618757)
d<-reqContractDetails(tws,c)

Warning message:
In reqContractDetails(tws, c) : error in contract details


here
<https://misc.interactivebrokers.com/cstools/contract_info/v3.9/index.php?action=Conid%20Info&wlId=IB&conid=271618719&lang=en>
are the contract details. Please help me figure out what am I doing wrong.


-- 
Regards
Amol
+91-9897860992
+91-8889676918

	[[alternative HTML version deleted]]


From es at enricoschumann.net  Sun Jun 25 21:46:18 2017
From: es at enricoschumann.net (Enrico Schumann)
Date: Sun, 25 Jun 2017 21:46:18 +0200
Subject: [R-SIG-Finance] Fteching options data using package IBrokers
	and interactivebrokers
In-Reply-To: <CAO7kh0Erq09A---+LkCWXdAxeFWZiMNnQJqa0EXpLRdxTzQp+Q@mail.gmail.com>
 (amol gupta's message of "Sun, 25 Jun 2017 13:39:43 +0530")
References: <CAO7kh0Erq09A---+LkCWXdAxeFWZiMNnQJqa0EXpLRdxTzQp+Q@mail.gmail.com>
Message-ID: <87k23zg8ad.fsf@enricoschumann.net>

On Sun, 25 Jun 2017, amol gupta writes:

> Hello,
>
> I have been trying to fetch contract details and finally fetch contract
> historical data. I have been able to do it with stock futures but I have
> been failing with options. Here is a very small snippet.
>
>
> c<-twsOPT(local = 'HDFC17JUN1780CE',strike = 1780, right = 'C',
>           currency = 'INR',primary = 'NSE',multiplier = 1,
>           conId = 271618757)
> d<-reqContractDetails(tws,c)
>
> Warning message:
> In reqContractDetails(tws, c) : error in contract details
>
>
> here
> <https://misc.interactivebrokers.com/cstools/contract_info/v3.9/index.php?action=Conid%20Info&wlId=IB&conid=271618719&lang=en>
> are the contract details. Please help me figure out what am I doing wrong.

Use 'twsContract' and specify only the local symbol, the
exchange, the currency and the security type:

   require("IBrokers")
   c <- twsContract(local = 'HDFC17JUN1780CE', sectype = "OPT",
                    currency = 'INR', exch = 'NSE',
                    include_expired = 1,
                    conId = "", symbol = "", primary = "", expiry = "", 
                    strike = "", right = "", multiplier = "",
                    combo_legs_desc = "", comboleg = "", secIdType = "",
                    secId = "")
   
   tws <- twsConnect()
   reqContractDetails(tws, c)

   ## List of 18
   ##  $ version       : chr "8"
   ##  $ contract      :List of 16
   ##   ..$ conId          : chr "271618757"
   ##   ..$ symbol         : chr "HDFC"
   ##   ..$ sectype        : chr "OPT"
   ##   ..$ exch           : chr "NSE"
   ## [....]

See also
https://github.com/enricoschumann/IButils#finding-the-contract-specification

-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From amolgupta87 at gmail.com  Mon Jun 26 07:53:39 2017
From: amolgupta87 at gmail.com (amol gupta)
Date: Mon, 26 Jun 2017 11:23:39 +0530
Subject: [R-SIG-Finance] Fteching options data using package IBrokers
	and interactivebrokers
In-Reply-To: <87k23zg8ad.fsf@enricoschumann.net>
References: <CAO7kh0Erq09A---+LkCWXdAxeFWZiMNnQJqa0EXpLRdxTzQp+Q@mail.gmail.com>
 <87k23zg8ad.fsf@enricoschumann.net>
Message-ID: <CAO7kh0Gtyfsj0HvrRV4qBv+-o5=Vgfk+fmbK9UoDz79SbJRj0w@mail.gmail.com>

Thanks .That worked. :-)

On Mon, Jun 26, 2017 at 1:16 AM, Enrico Schumann <es at enricoschumann.net>
wrote:

> On Sun, 25 Jun 2017, amol gupta writes:
>
> > Hello,
> >
> > I have been trying to fetch contract details and finally fetch contract
> > historical data. I have been able to do it with stock futures but I have
> > been failing with options. Here is a very small snippet.
> >
> >
> > c<-twsOPT(local = 'HDFC17JUN1780CE',strike = 1780, right = 'C',
> >           currency = 'INR',primary = 'NSE',multiplier = 1,
> >           conId = 271618757)
> > d<-reqContractDetails(tws,c)
> >
> > Warning message:
> > In reqContractDetails(tws, c) : error in contract details
> >
> >
> > here
> > <https://misc.interactivebrokers.com/cstools/contract_info/v3.9/
> index.php?action=Conid%20Info&wlId=IB&conid=271618719&lang=en>
> > are the contract details. Please help me figure out what am I doing
> wrong.
>
> Use 'twsContract' and specify only the local symbol, the
> exchange, the currency and the security type:
>
>    require("IBrokers")
>    c <- twsContract(local = 'HDFC17JUN1780CE', sectype = "OPT",
>                     currency = 'INR', exch = 'NSE',
>                     include_expired = 1,
>                     conId = "", symbol = "", primary = "", expiry = "",
>                     strike = "", right = "", multiplier = "",
>                     combo_legs_desc = "", comboleg = "", secIdType = "",
>                     secId = "")
>
>    tws <- twsConnect()
>    reqContractDetails(tws, c)
>
>    ## List of 18
>    ##  $ version       : chr "8"
>    ##  $ contract      :List of 16
>    ##   ..$ conId          : chr "271618757"
>    ##   ..$ symbol         : chr "HDFC"
>    ##   ..$ sectype        : chr "OPT"
>    ##   ..$ exch           : chr "NSE"
>    ## [....]
>
> See also
> https://github.com/enricoschumann/IButils#finding-the-contract-
> specification
>
> --
> Enrico Schumann
> Lucerne, Switzerland
> http://enricoschumann.net
>



-- 
Regards
Amol
+91-9897860992
+91-8889676918

	[[alternative HTML version deleted]]


From francesco.citta at gmail.com  Mon Jun 26 16:09:58 2017
From: francesco.citta at gmail.com (francesco.citta at gmail.com)
Date: Mon, 26 Jun 2017 16:09:58 +0200
Subject: [R-SIG-Finance] (no subject)
Message-ID: <595115b7.cb7e1c0a.98438.077e@mx.google.com>

Hello,
I found a problem when I tried to use the "maxreturnPortfolio" function of fPortfolio's package (3011.78 version) after setting a target risk.
This is my code:
defaultSpec=portfolioSpec()
setOptimize(defaultSpec)="risk"
setTargetRisk(defaultSpec)=0.3
lppData=100*LPP2005.RET
defaultData=portfolioData(lppData,spec=defaultSpec)
maxReturn=maxreturnPortfolio(defaultData,spec = defaultSpec,constraints = "LongOnly")
print(maxReturn)

The output is:
Title:
 MV Return Maximized Efficient Portfolio 
 Estimator:         covEstimator 
 Solver:            solveRquadprog 
 Optimize:          maxReturn 
 Constraints:       LongOnly 
Portfolio Weights:
   SBI    SPI    SII    LMI    MPI    ALT 
0.3555 0.0000 0.0890 0.4893 0.0026 0.0636 
Covariance Risk Budgets:
   SBI    SPI    SII    LMI    MPI    ALT 
0.3555 0.0000 0.0890 0.4893 0.0026 0.0636 
Target Returns and Risks:
  mean    Cov   CVaR    VaR 
0.0105 0.0986 0.2020 0.1558 

The Target Risk (0.3) is different than optimized risk (0.0986) and the portfolio weitghts are the same of the min risk problem. For this target volatility I will expect a return near 0.05.
I tried to change the solver (setSolver(defaultSpec)="solveRsocp") but I obtained this error message: Error in as.vector(data) : no method for coercing this S4 class to a vector
Can you help me?
Thanks
Francesco Citta




	[[alternative HTML version deleted]]


From maural56345 at gmail.com  Mon Jun 26 17:43:28 2017
From: maural56345 at gmail.com (Paul Maural)
Date: Mon, 26 Jun 2017 21:13:28 +0530
Subject: [R-SIG-Finance] Estimate conditional SD with rugarch package for
 different series than what used for model estimation
Message-ID: <CAMnpynQwdwjAp2xjrbFVC53yjrdOdy4ZJCoWSo5vbk+KO9aiew@mail.gmail.com>

Hi,

I am trying to find a way where I estimate a Garch moel parameters
using rugrach package based on some data set, and use those estimate
to estimate conditional SD and predict for some different series.

To demonstrate, say I have below data set which to be used for
parameter estimation :

require(rugarch)
data(sp500ret)

EstimationData = sp500ret[1000:2000, ,drop = FALSE]; head(EstimationData)

fit = ugarchfit(ugarchspec(), EstimationData, solver = 'hybrid')

Now I want to estimate conditional SD of ***full dataset** based on
the parameters available with 'fit'. I used below :

sigma(fit)

However it is giving consitional SD for EstimationData only.

Can anyone please point me how to achieve that with rugarch?

Thanks for your time.


From aschmid1 at stevens.edu  Tue Jun 27 22:01:33 2017
From: aschmid1 at stevens.edu (Alec Schmidt)
Date: Tue, 27 Jun 2017 20:01:33 +0000
Subject: [R-SIG-Finance] Yahoo Finance API change
In-Reply-To: <CAPPM_gQGOt9s1cbKQKpMapaQcezEMV_R0d7hMy_fX4jGVddrJQ@mail.gmail.com>
References: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>,
 <CAPPM_gQGOt9s1cbKQKpMapaQcezEMV_R0d7hMy_fX4jGVddrJQ@mail.gmail.com>
Message-ID: <1498593698195.51634@stevens.edu>

It is possible now to download long time series of prices from Yahoo manually. However, the 'old' APIs for quantmod and tseries do not work.  Is there chance new APIs will be implemented?
Alec 
________________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Joshua Ulrich <josh.m.ulrich at gmail.com>
Sent: Wednesday, May 17, 2017 5:45 PM
To: r-sig-finance
Subject: Re: [R-SIG-Finance] Yahoo Finance API change

Some notes from tinkering with a potential fix:

- You need an established session with cookies to download data
- The URL requires a 'crumb'
- The columns of the CSV are in OHLCAV order (vs OHLCVA)
- The OHL columns are already split-adjusted; the Close columns is not
- Observations for some dates may be "null" in the CSV
- The format of the CSV for split data changed

The the commit messages and diffs for details:
https://github.com/joshuaulrich/quantmod/compare/157_yahoo_502

On Tue, May 16, 2017 at 8:11 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> Hi all,
>
> Just wanted to let the list know that Yahoo Finance changed their API
> and most download functions will no longer work.  It looks like
> getting it working will require creating and tracking a session with
> the Yahoo Finance servers.
>
> If you're interested in quantmod::getSymbols.yahoo, you can track
> progress on the fix on the GitHub issue I created:
> https://github.com/joshuaulrich/quantmod/issues/157
>
> Best,
> Josh
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com



--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From josh.m.ulrich at gmail.com  Tue Jun 27 23:00:23 2017
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 27 Jun 2017 16:00:23 -0500
Subject: [R-SIG-Finance] Yahoo Finance API change
In-Reply-To: <1498593698195.51634@stevens.edu>
References: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
 <CAPPM_gQGOt9s1cbKQKpMapaQcezEMV_R0d7hMy_fX4jGVddrJQ@mail.gmail.com>
 <1498593698195.51634@stevens.edu>
Message-ID: <CAPPM_gTUZKaPdViALmosO6v9iR1VJhVTJg2cddKU0hrt9ELdGw@mail.gmail.com>

What versions are you referring to as "old"?  This was fixed in
quantmod 0.4-9 and tseries 0.10-41.

Or are you referring to this issue?
https://github.com/joshuaulrich/quantmod/issues/174

On Tue, Jun 27, 2017 at 3:01 PM, Alec Schmidt <aschmid1 at stevens.edu> wrote:
> It is possible now to download long time series of prices from Yahoo manually. However, the 'old' APIs for quantmod and tseries do not work.  Is there chance new APIs will be implemented?
> Alec
> ________________________________________
> From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Joshua Ulrich <josh.m.ulrich at gmail.com>
> Sent: Wednesday, May 17, 2017 5:45 PM
> To: r-sig-finance
> Subject: Re: [R-SIG-Finance] Yahoo Finance API change
>
> Some notes from tinkering with a potential fix:
>
> - You need an established session with cookies to download data
> - The URL requires a 'crumb'
> - The columns of the CSV are in OHLCAV order (vs OHLCVA)
> - The OHL columns are already split-adjusted; the Close columns is not
> - Observations for some dates may be "null" in the CSV
> - The format of the CSV for split data changed
>
> The the commit messages and diffs for details:
> https://github.com/joshuaulrich/quantmod/compare/157_yahoo_502
>
> On Tue, May 16, 2017 at 8:11 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>> Hi all,
>>
>> Just wanted to let the list know that Yahoo Finance changed their API
>> and most download functions will no longer work.  It looks like
>> getting it working will require creating and tracking a session with
>> the Yahoo Finance servers.
>>
>> If you're interested in quantmod::getSymbols.yahoo, you can track
>> progress on the fix on the GitHub issue I created:
>> https://github.com/joshuaulrich/quantmod/issues/157
>>
>> Best,
>> Josh
>>
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com
>> R/Finance 2017 | www.rinfinance.com
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com


From aschmid1 at stevens.edu  Tue Jun 27 23:16:57 2017
From: aschmid1 at stevens.edu (Alec Schmidt)
Date: Tue, 27 Jun 2017 21:16:57 +0000
Subject: [R-SIG-Finance] Yahoo Finance API change
In-Reply-To: <CAPPM_gTUZKaPdViALmosO6v9iR1VJhVTJg2cddKU0hrt9ELdGw@mail.gmail.com>
References: <CAPPM_gREZFa4bNjTUXe0q9-_Qd7uyHkUX+2hwbCxMPDC+zkhaA@mail.gmail.com>
 <CAPPM_gQGOt9s1cbKQKpMapaQcezEMV_R0d7hMy_fX4jGVddrJQ@mail.gmail.com>
 <1498593698195.51634@stevens.edu>,
 <CAPPM_gTUZKaPdViALmosO6v9iR1VJhVTJg2cddKU0hrt9ELdGw@mail.gmail.com>
Message-ID: <1498598222539.84116@stevens.edu>

Thank you Josh. I did not know about quantmod 0.4-9.
________________________________________
From: Joshua Ulrich <josh.m.ulrich at gmail.com>
Sent: Tuesday, June 27, 2017 5:00 PM
To: Alec Schmidt
Cc: r-sig-finance
Subject: Re: [R-SIG-Finance] Yahoo Finance API change

What versions are you referring to as "old"?  This was fixed in
quantmod 0.4-9 and tseries 0.10-41.

Or are you referring to this issue?
https://github.com/joshuaulrich/quantmod/issues/174

On Tue, Jun 27, 2017 at 3:01 PM, Alec Schmidt <aschmid1 at stevens.edu> wrote:
> It is possible now to download long time series of prices from Yahoo manually. However, the 'old' APIs for quantmod and tseries do not work.  Is there chance new APIs will be implemented?
> Alec
> ________________________________________
> From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Joshua Ulrich <josh.m.ulrich at gmail.com>
> Sent: Wednesday, May 17, 2017 5:45 PM
> To: r-sig-finance
> Subject: Re: [R-SIG-Finance] Yahoo Finance API change
>
> Some notes from tinkering with a potential fix:
>
> - You need an established session with cookies to download data
> - The URL requires a 'crumb'
> - The columns of the CSV are in OHLCAV order (vs OHLCVA)
> - The OHL columns are already split-adjusted; the Close columns is not
> - Observations for some dates may be "null" in the CSV
> - The format of the CSV for split data changed
>
> The the commit messages and diffs for details:
> https://github.com/joshuaulrich/quantmod/compare/157_yahoo_502
>
> On Tue, May 16, 2017 at 8:11 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
>> Hi all,
>>
>> Just wanted to let the list know that Yahoo Finance changed their API
>> and most download functions will no longer work.  It looks like
>> getting it working will require creating and tracking a session with
>> the Yahoo Finance servers.
>>
>> If you're interested in quantmod::getSymbols.yahoo, you can track
>> progress on the fix on the GitHub issue I created:
>> https://github.com/joshuaulrich/quantmod/issues/157
>>
>> Best,
>> Josh
>>
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com
>> R/Finance 2017 | www.rinfinance.com
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2017 | www.rinfinance.com
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2017 | www.rinfinance.com



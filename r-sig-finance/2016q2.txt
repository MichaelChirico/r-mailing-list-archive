From stephen at organicfoodmarkets.com.au  Fri Apr  1 06:06:27 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Fri, 1 Apr 2016 15:06:27 +1100
Subject: [R-SIG-Finance] IBrokers - functions: eWrapper and CALLBACKS
Message-ID: <56FDF3C3.3010202@organicfoodmarkets.com.au>

Hi

I am trying to program various algorithms using such calls as reqMktData 
- where I have working code with a loop that appears to be working - but 
when I try and use something like reqOpenOrders I can get a result to 
the screen but I am having great difficulty getting at that information 
and using it.

I wondered if someone could point me to anything like Jeff Ryan's pdf 
Real Time Trading in R which concentrates on how the callback works 
using the eWrapper and processMsg.

Hope someone can point me to something useful.

Stephen Choularton PhD, FIoD


From peter.neumaier at gmail.com  Fri Apr  1 13:26:14 2016
From: peter.neumaier at gmail.com (Peter Neumaier)
Date: Fri, 1 Apr 2016 12:26:14 +0100
Subject: [R-SIG-Finance] Remove first two weeks of data in half hourly
	resolution
In-Reply-To: <1459423444.7774.63.camel@brian-rcg>
References: <CAHDRDJVkLjiCSRdE2rPegazncH898ttjJA0WyaxaWUebVhxLrA@mail.gmail.com>
	<1459423444.7774.63.camel@brian-rcg>
Message-ID: <CAHDRDJWSG_xYFju-SFOG_7c7y43vazFSYQLPnrwVZ2raH_6FJg@mail.gmail.com>

This is brilliant. Thanks very much!

On Thu, Mar 31, 2016 at 12:24 PM, Brian G. Peterson <brian at braverock.com>
wrote:

> Peter,
>
> You haven't published a reproducible example, and I'm not going to take
> the time to write a complete example from scratch.
>
> We use xts subsetting for this type of thing, so I suggest using xts for
> your time series (this is always good advice for time series in R).
>
> Here's a partial example to get you started.
>
> #######################
>
> #load some data from the PerformanceAnalytics package
> data(edhec)
>
> #check the range
> range(index(edhec))
>
> #add 14 days from the start
> first(index(edhec))+14
>
> #now assume that you have an object 'z' with  intraday data
> range(z)
>
> #check the range of Dates by forcing the index to Date type
> range(as.Date(index(z)))
>
> #add 114 days, as before
> first(as.Date(index(z)))+14
>
> # now subset by cutting off the first 14 calendar days
> # from the start of the series
> zs <- z[paste0(first(as.Date(index(z)))+14,'/')]
>
> #check the range
> range(as.Date(index(zs)))
>
> ##################
>
> Regards,
>
> Brian
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>
> On Thu, 2016-03-31 at 11:50 +0100, Peter Neumaier wrote:
> > Hi all,
> >
> > I am doing some analysis on monthly futures contracts from 2011-2016.
> > Each monthly contract goes for eight weeks, in half hourly resolution.
> >
> > I'd like to remove first two weeks of eight weeks history for each
> monthly
> > contract.
> > My approach was to work out the start and end date and cut the 1st two
> weeks
> > data off, but problem is that the half hourly resolution is sometimes
> > incomplete(
> > i.e. a trading day goes from 7:00am - 4:00pm but sometimes starts at
> > 7:30am).
> >
> > Any suggestion on how to resolve this? Below a sample trading day in half
> > hourly:
> >
> >                     NGFH6.Open NGFH6.High NGFH6.Low NGFH6.Close
> > NGFH6.Volume NGFH6.WAP NGFH6.hasGaps NGFH6.Count
> > 2016-01-06 07:30:00     0.3395     0.3395    0.3375      0.3380
> > 45   0.33811             0           5
> > 2016-01-06 08:00:00     0.3400     0.3400    0.3387      0.3395
> > 140   0.33928             0          12
> > 2016-01-06 08:30:00     0.3395     0.3395    0.3379      0.3379
> > 70   0.33884             0           5
> > 2016-01-06 09:00:00     0.3379     0.3379    0.3379      0.3379
> > 0   0.33790             0           0
> > 2016-01-06 09:30:00     0.3379     0.3379    0.3379      0.3379
> > 0   0.33790             0           0
> > 2016-01-06 10:00:00     0.3375     0.3380    0.3373      0.3373
> > 230   0.33738             0          14
> > 2016-01-06 10:30:00     0.3376     0.3379    0.3376      0.3379
> > 20   0.33775             0           2
> > 2016-01-06 11:00:00     0.3370     0.3370    0.3370      0.3370
> > 105   0.33700             0           5
> > 2016-01-06 11:30:00     0.3366     0.3366    0.3365      0.3365
> > 65   0.33658             0           4
> > 2016-01-06 12:00:00     0.3370     0.3370    0.3370      0.3370
> > 10   0.33700             0           1
> > 2016-01-06 12:30:00     0.3372     0.3372    0.3361      0.3361
> > 125   0.33686             0           9
> > 2016-01-06 13:00:00     0.3360     0.3360    0.3357      0.3360
> > 225   0.33585             0          17
> > 2016-01-06 13:30:00     0.3357     0.3357    0.3355      0.3355
> > 50   0.33560             0           5
> > 2016-01-06 14:00:00     0.3350     0.3359    0.3350      0.3359
> > 25   0.33554             0           2
> > 2016-01-06 14:30:00     0.3359     0.3359    0.3359      0.3359
> > 0   0.33590             0           0
> > 2016-01-06 15:00:00     0.3352     0.3352    0.3348      0.3352
> > 150   0.33492             0          15
> > 2016-01-06 15:30:00     0.3352     0.3352    0.3334      0.3341
> > 280   0.33364             0          24
> > 2016-01-06 16:00:00     0.3341     0.3375    0.3341      0.3370
> > 145   0.33543             0          17
> > 2016-01-06 16:30:00     0.3380     0.3385    0.3380      0.3385
> > 25   0.33830             0           3
> >
> > Many Thanks
> > Peter
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Sat Apr  2 16:18:53 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 2 Apr 2016 09:18:53 -0500
Subject: [R-SIG-Finance] stoplimit market price with OHLC
In-Reply-To: <56FA9547.2020303@vodafone.it>
References: <CAGPkpwA4qZsCQzKxZEZPuOYTmvC43oZr8rmqkG1_MNWUpfKjhQ@mail.gmail.com>
	<56FA9547.2020303@vodafone.it>
Message-ID: <CAPPM_gTtRZ8O1gukBFjq0eCKpPCo583sSKukkRAaB=GGttUS4w@mail.gmail.com>

On Tue, Mar 29, 2016 at 9:46 AM, Diego Peroni <diegoperoni at vodafone.it> wrote:
> Hi All,
>
> my strategy exit an open position with a simple Signal based on 1 minute
> OHLC bars.
>
> This is my exit rule:
>
> add.rule(qs.strategy, name='ruleSignal',
>          arguments=list(sigcol='upTrend', sigval=TRUE,
>                         replace=TRUE,
>                         orderside='short',
>                         ordertype='market',
>                         orderqty='all',
>                         orderset='ocoshort'
>          ),
>          type='exit',
>          label='ExitShort',
>          enabled=TRUE)
>
> My question is: which price quantstrat use to sell market by default?
> - Current Bar Close Price?
> - Next Bar Open Price?
> - Next Bar "worst"/"best" Price?
>
Assuming you haven't specified "prefer", it will be NULL by default,
which means getPrice will be called on mktdata with prefer=NULL.  When
getPrice is called with prefer=NULL, it will search for a column name
containing "price", "trade", or "close" (in that order) and will
return the first it finds.

The transaction will occur on the observation after the order is
entered, since it's not safe to assume that your order will be filled
at the price you observed that triggered the order entry.

> Thanks in advance
>
> Diego
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From diegoperoni at vodafone.it  Sat Apr  2 18:22:42 2016
From: diegoperoni at vodafone.it (Diego Peroni)
Date: Sat, 2 Apr 2016 18:22:42 +0200
Subject: [R-SIG-Finance] stoplimit market price with OHLC
In-Reply-To: <CAPPM_gTtRZ8O1gukBFjq0eCKpPCo583sSKukkRAaB=GGttUS4w@mail.gmail.com>
References: <CAGPkpwA4qZsCQzKxZEZPuOYTmvC43oZr8rmqkG1_MNWUpfKjhQ@mail.gmail.com>
	<56FA9547.2020303@vodafone.it>
	<CAPPM_gTtRZ8O1gukBFjq0eCKpPCo583sSKukkRAaB=GGttUS4w@mail.gmail.com>
Message-ID: <CA31C917-B5B1-4783-9B9E-9CC740C7DB04@vodafone.it>

Thanks Ultich

I didn't find this information reading the docs.

Diego



> On 02 apr 2016, at 16:18, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> 
>> On Tue, Mar 29, 2016 at 9:46 AM, Diego Peroni <diegoperoni at vodafone.it> wrote:
>> Hi All,
>> 
>> my strategy exit an open position with a simple Signal based on 1 minute
>> OHLC bars.
>> 
>> This is my exit rule:
>> 
>> add.rule(qs.strategy, name='ruleSignal',
>>         arguments=list(sigcol='upTrend', sigval=TRUE,
>>                        replace=TRUE,
>>                        orderside='short',
>>                        ordertype='market',
>>                        orderqty='all',
>>                        orderset='ocoshort'
>>         ),
>>         type='exit',
>>         label='ExitShort',
>>         enabled=TRUE)
>> 
>> My question is: which price quantstrat use to sell market by default?
>> - Current Bar Close Price?
>> - Next Bar Open Price?
>> - Next Bar "worst"/"best" Price?
> Assuming you haven't specified "prefer", it will be NULL by default,
> which means getPrice will be called on mktdata with prefer=NULL.  When
> getPrice is called with prefer=NULL, it will search for a column name
> containing "price", "trade", or "close" (in that order) and will
> return the first it finds.
> 
> The transaction will occur on the observation after the order is
> entered, since it's not safe to assume that your order will be filled
> at the price you observed that triggered the order entry.
> 
>> Thanks in advance
>> 
>> Diego
>> 
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
> 
> 
> 
> -- 
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com


From wotuzu17 at gmail.com  Mon Apr  4 13:09:33 2016
From: wotuzu17 at gmail.com (Benno Longobardolino)
Date: Mon, 4 Apr 2016 13:09:33 +0200
Subject: [R-SIG-Finance] getOptionChain function in quantmod
Message-ID: <CAKC0BhnQf+aJXevpBOXJahd8N6FraHGX-xvPsx8U9DhN7QtL7w@mail.gmail.com>

Hi UseRs,

I've got a question about the getOptionChain function in the quantmod
package.

when I run this code I receive the front-month expiry option chain of Apple
from finance.yahoo.com:

library(quantmod)
getOptionChain("AAPL")

However, when I look this up on the website of finance.yahoo.com (
http://finance.yahoo.com/q/op?s=AAPL+Options) then I see an additional
column => "Implied Volatility".

My question are:
1) Why is this column omitted in the output of getOptionChain?
2) Is yahoo's calculation of the implied volatility generally reliable?
3) Are there other (easy) ways to calculate this using existing R libraries?

Thank you,

Andreas

	[[alternative HTML version deleted]]


From peter.neumaier at gmail.com  Mon Apr  4 14:24:26 2016
From: peter.neumaier at gmail.com (Peter Neumaier)
Date: Mon, 4 Apr 2016 13:24:26 +0100
Subject: [R-SIG-Finance] rbind and duplicates in monthly futures
Message-ID: <CAHDRDJV9zhYMyf7_RPuF8LtXck4Zdx_P_C83xgKG3ZAWr76rSQ@mail.gmail.com>

Hi all, I am trying to rbind monthly futures to a continuous time series to
be run through an algo strategy. The problem here is that data is
overlapping, i.e. my Feb contract trades for 6 weeks and when I rbind with
my March data I get an overlap for last two weeks of Jan.

How can I create a time series that is continuous, not overlapping and
useable in quantstrat (i.e. XTS format)? I am not posting any code as it
would be really one single rbind statement.

Thanks
Peter

	[[alternative HTML version deleted]]


From dmitry.kishkinev at gmail.com  Mon Apr  4 15:16:07 2016
From: dmitry.kishkinev at gmail.com (Dmitry Kishkinev)
Date: Mon, 4 Apr 2016 14:16:07 +0100
Subject: [R-SIG-Finance] entries/exits based on candlestick recognition
Message-ID: <CANDgRb4rjGB_7QMQNxapMC92ot7L873hD9zefE9k4NQDr+aBgw@mail.gmail.com>

Dear all R-SIG readers

I am learning Quantstrat now and wonder if anybody could point out examples
where entries/exits were based on Japanese candlesticks' patterns.

For example, I would like to back-test intraday momentum strategy when
there was a large gap (previous day Close to given day Open) and during the
first three 5-min candlesticks there were at least 2 candlesticks showing
strong momentum. Say we have gap up and at least 2 candlesticks were
Marubozu (Close = High) and/or Large White candlestick (Open-Close >= 66%
of High-Low). One could imagine that such a strong momentum observed at day
opening could hold for some time and one may try to 'ride on a hype' in the
gap direction.

One more thing I would like to implement in this back-testing is, once
entered say long, I would like to apply a sophisticated stop trailing order
which starts at a predefined risk (say, 1% of my Equity) and then it should
follows the price based on the last 5-min candlestick. When it was again
Marubozu and/or Large White candlestick I replace stop trailing order price
with the one at the last candlestick Low and so on until the order is
executed or I close before the day ends.

Any snippets/examples related to the ideas mentioned?

My rough idea I that I could introduce add.indicator and classify each
5-min candlestick and that then will be used for add.rule? Sorry, I am very
new in Quantstrat.

Thanks you so much in advance.

Best regards

Dmitry Kishkinev

-- 
PhD, Research Fellow,
School of Biological Sciences,
Bangor University,
Bangor, Gwynedd, UK
Email: dmitry.kishkinev at gmail.com;
*d*.kishkinev at bangor.ac.uk <kishkinev at qub.ac.uk>
Mobile phone: +44-(0)77-194-181-41

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Mon Apr  4 15:28:18 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 4 Apr 2016 08:28:18 -0500
Subject: [R-SIG-Finance] getOptionChain function in quantmod
In-Reply-To: <CAKC0BhnQf+aJXevpBOXJahd8N6FraHGX-xvPsx8U9DhN7QtL7w@mail.gmail.com>
References: <CAKC0BhnQf+aJXevpBOXJahd8N6FraHGX-xvPsx8U9DhN7QtL7w@mail.gmail.com>
Message-ID: <CAPPM_gQUx=Amid_1AB3YyCq6FCkCDv13VXtMLBxsAQrvNeSLLw@mail.gmail.com>

On Mon, Apr 4, 2016 at 6:09 AM, Benno Longobardolino <wotuzu17 at gmail.com> wrote:
> Hi UseRs,
>
> I've got a question about the getOptionChain function in the quantmod
> package.
>
> when I run this code I receive the front-month expiry option chain of Apple
> from finance.yahoo.com:
>
> library(quantmod)
> getOptionChain("AAPL")
>
> However, when I look this up on the website of finance.yahoo.com (
> http://finance.yahoo.com/q/op?s=AAPL+Options) then I see an additional
> column => "Implied Volatility".
>
> My question are:
> 1) Why is this column omitted in the output of getOptionChain?

Because I couldn't find any documentation about how it is calculated.

> 2) Is yahoo's calculation of the implied volatility generally reliable?

See above.

> 3) Are there other (easy) ways to calculate this using existing R libraries?

See the CRAN Finance Task View for many options (pun intended):
https://cran.r-project.org/web/views/Finance.html

Two examples: RQuantLib, fOptions.

>
> Thank you,
>
> Andreas
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Mon Apr  4 15:30:38 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 4 Apr 2016 08:30:38 -0500
Subject: [R-SIG-Finance] rbind and duplicates in monthly futures
In-Reply-To: <CAHDRDJV9zhYMyf7_RPuF8LtXck4Zdx_P_C83xgKG3ZAWr76rSQ@mail.gmail.com>
References: <CAHDRDJV9zhYMyf7_RPuF8LtXck4Zdx_P_C83xgKG3ZAWr76rSQ@mail.gmail.com>
Message-ID: <CAPPM_gSJiiEdB09cOMPFf5xbKPoO_0NkpKzg7-RDmvehq2yaUA@mail.gmail.com>

On Mon, Apr 4, 2016 at 7:24 AM, Peter Neumaier <peter.neumaier at gmail.com> wrote:
> Hi all, I am trying to rbind monthly futures to a continuous time series to
> be run through an algo strategy. The problem here is that data is
> overlapping, i.e. my Feb contract trades for 6 weeks and when I rbind with
> my March data I get an overlap for last two weeks of Jan.
>
> How can I create a time series that is continuous, not overlapping and
> useable in quantstrat (i.e. XTS format)? I am not posting any code as it
> would be really one single rbind statement.
>
Even though the code may be simple, you still would be more likely to
receive help if you provide a minimal reproducible example of the
issue.  In this case, the data are not simple, and most people will
not take the time to construct sample data in order to attempt to
reproduce the issue you describe.

> Thanks
> Peter
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From robsch at robsch.eu  Mon Apr  4 15:47:47 2016
From: robsch at robsch.eu (Robert Schien)
Date: Mon, 4 Apr 2016 15:47:47 +0200
Subject: [R-SIG-Finance] IBrokers - functions: eWrapper and CALLBACKS
In-Reply-To: <56FDF3C3.3010202@organicfoodmarkets.com.au>
References: <56FDF3C3.3010202@organicfoodmarkets.com.au>
Message-ID: <20160404134747.GA18326@robsch.eu>

On Fri, Apr 01, 2016 at 03:06:27PM +1100, Stephen Choularton wrote:
> Hi
> 
> I am trying to program various algorithms using such calls as reqMktData 
> - where I have working code with a loop that appears to be working - but 
> when I try and use something like reqOpenOrders I can get a result to 
> the screen but I am having great difficulty getting at that information 
> and using it.
> 
> I wondered if someone could point me to anything like Jeff Ryan's pdf 
> Real Time Trading in R which concentrates on how the callback works 
> using the eWrapper and processMsg.
> 
> Hope someone can point me to something useful.
> 
> Stephen Choularton PhD, FIoD

Hi Stephen,

I think there are bugs in the IBrokers package and/or not all
functions alre corrrectly or fully implemented.
I have the same problem: I want to check the order status (order filled
and fill price) but am out of luck.

Therefore it's not possible to automatically trade and check orders.

Unless someone fixes these problems you have to switch to other
platforms (Java, Python, C++) etc.

It is quite sad, because R is such a nice and elegant platform
otherwise.

Greetings
Robert


From ilya.kipnis at gmail.com  Mon Apr  4 16:30:51 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 4 Apr 2016 10:30:51 -0400
Subject: [R-SIG-Finance] entries/exits based on candlestick recognition
In-Reply-To: <CANDgRb4rjGB_7QMQNxapMC92ot7L873hD9zefE9k4NQDr+aBgw@mail.gmail.com>
References: <CANDgRb4rjGB_7QMQNxapMC92ot7L873hD9zefE9k4NQDr+aBgw@mail.gmail.com>
Message-ID: <CA+oJuEGF1b6pzZBdKi==A-TUsqtSdV-Ed49FHuox5Q452HvU_Q@mail.gmail.com>

I believe there is an R package called candlesticks. Use that. Then, your
candlesticks are merely indicators which are merely R functions.

On Mon, Apr 4, 2016 at 9:16 AM, Dmitry Kishkinev <dmitry.kishkinev at gmail.com
> wrote:

> Dear all R-SIG readers
>
> I am learning Quantstrat now and wonder if anybody could point out examples
> where entries/exits were based on Japanese candlesticks' patterns.
>
> For example, I would like to back-test intraday momentum strategy when
> there was a large gap (previous day Close to given day Open) and during the
> first three 5-min candlesticks there were at least 2 candlesticks showing
> strong momentum. Say we have gap up and at least 2 candlesticks were
> Marubozu (Close = High) and/or Large White candlestick (Open-Close >= 66%
> of High-Low). One could imagine that such a strong momentum observed at day
> opening could hold for some time and one may try to 'ride on a hype' in the
> gap direction.
>
> One more thing I would like to implement in this back-testing is, once
> entered say long, I would like to apply a sophisticated stop trailing order
> which starts at a predefined risk (say, 1% of my Equity) and then it should
> follows the price based on the last 5-min candlestick. When it was again
> Marubozu and/or Large White candlestick I replace stop trailing order price
> with the one at the last candlestick Low and so on until the order is
> executed or I close before the day ends.
>
> Any snippets/examples related to the ideas mentioned?
>
> My rough idea I that I could introduce add.indicator and classify each
> 5-min candlestick and that then will be used for add.rule? Sorry, I am very
> new in Quantstrat.
>
> Thanks you so much in advance.
>
> Best regards
>
> Dmitry Kishkinev
>
> --
> PhD, Research Fellow,
> School of Biological Sciences,
> Bangor University,
> Bangor, Gwynedd, UK
> Email: dmitry.kishkinev at gmail.com;
> *d*.kishkinev at bangor.ac.uk <kishkinev at qub.ac.uk>
> Mobile phone: +44-(0)77-194-181-41
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From stephen at organicfoodmarkets.com.au  Tue Apr  5 01:42:28 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Tue, 5 Apr 2016 09:42:28 +1000
Subject: [R-SIG-Finance] IBrokers - functions: eWrapper and CALLBACKS
In-Reply-To: <20160404134747.GA18326@robsch.eu>
References: <56FDF3C3.3010202@organicfoodmarkets.com.au>
	<20160404134747.GA18326@robsch.eu>
Message-ID: <5702FBE4.6070208@organicfoodmarkets.com.au>

Hi Robert

Thanks for the reply.  I was assuming that the package was OK as my 
experience with programming nearly always turns out to demonstrate its 
my fault ;-(

My problem is I don't really understand how eWrapper and CALLBACKS work 
together.  I find if I can work on existing code like that I found for 
trading based on on it I can get somewhere. I found something and ended 
up with this call:

reqMktData(con, list(twsEquity(symbol=sym1, exch='ASX', 
currency='AUD'),twsEquity(symbol=sym2, exch='ASX', currency='AUD')),  
eventWrapper=eWrapper.data(2), CALLBACK=CO_INT_N_REV)

and managed to put everything I wanted inside the callback.  I'd love to 
find something similar on reqMktDepth as at the moment I can only manage 
these sorts of calls:

reqMktDepth(tws, contract, 
file="C:\\Users\\Stephen\\Documents\\R\\current working market 
depth\\ticks.txt")
reqMktDepth(tws, contract, 
eventWrapper=eWrapper.MktDepth.CSV(),file="C:\\Users\\Stephen\\Documents\\R\\current 
working market depth\\ticks1.txt")


and I would love to be able to write a callback.

In addition I am desperate to find something on 'has the order been 
closed?' just like you.

Maybe someone can point us to some code that we can work with.

Stephen


----------------------------------------------------------------------------------------------------------------------------------- 

Stephen Choularton PhD, FIoD



On 4/04/2016 11:47 PM, Robert Schien wrote:
> On Fri, Apr 01, 2016 at 03:06:27PM +1100, Stephen Choularton wrote:
>> Hi
>>
>> I am trying to program various algorithms using such calls as reqMktData
>> - where I have working code with a loop that appears to be working - but
>> when I try and use something like reqOpenOrders I can get a result to
>> the screen but I am having great difficulty getting at that information
>> and using it.
>>
>> I wondered if someone could point me to anything like Jeff Ryan's pdf
>> Real Time Trading in R which concentrates on how the callback works
>> using the eWrapper and processMsg.
>>
>> Hope someone can point me to something useful.
>>
>> Stephen Choularton PhD, FIoD
> Hi Stephen,
>
> I think there are bugs in the IBrokers package and/or not all
> functions alre corrrectly or fully implemented.
> I have the same problem: I want to check the order status (order filled
> and fill price) but am out of luck.
>
> Therefore it's not possible to automatically trade and check orders.
>
> Unless someone fixes these problems you have to switch to other
> platforms (Java, Python, C++) etc.
>
> It is quite sad, because R is such a nice and elegant platform
> otherwise.
>
> Greetings
> Robert
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From suchislife27 at gmail.com  Tue Apr  5 11:26:13 2016
From: suchislife27 at gmail.com (Ryan Crawford)
Date: Tue, 5 Apr 2016 17:26:13 +0800
Subject: [R-SIG-Finance] GetOrders with Quantstrat
Message-ID: <CANf4qfhT8-BmzdCfVrb8FMOWaT-Ayi5pPOoMnPmD5hg5ePL9-w@mail.gmail.com>

Hello

I have been trying to view "open" orders from the orderbook in Quantstrat
and keep running into the same error.

It seems a reasonably simple process however the error I get is:

oB <- getOrders(portfolio.st, symbols, status="open")

Error in orderbook[[portfolio]][[symbol]] :
  recursive indexing failed at level 2

I've searched extensively and I can't seem to pinpoint the issue.

Below is a reproducible example that generates the error.

Thank you in advance for any help.


require(quantstrat)
require(IKTrading)

# Set the currency and the timezone
currency('USD')
Sys.setenv(TZ = "UTC")

# Define symbols of interest
symbols <- c("AMP.AX", "BHP.AX", "ANZ.AX",
             "CBA.AX", "BXB.AX", "CSL.AX", "IAG.AX",
             "MQG.AX", "NAB.AX", "ORG.AX", "QBE.AX",
             "RIO.AX", "SCG.AX", "SUN.AX", "TLS.AX",
             "WBC.AX", "WES.AX", "WOW.AX", "WPL.AX",
             "TCL.AX", "WFD.AX", "AMC.AX")

#Get Symbols
getSymbols(Symbols=symbols, from="2010-01-01", to="2016-04-04")

# Define the instrument type
stock(symbols, currency = "USD", multiplier = 1)

#Boilerplate
from = "2010-01-01"
to = "2016-04-04"

#trade sizing and initial equity settings
tradeSize <- 2500
initEq <- 100000

strategy.st <- portfolio.st <- account.st <- "GetOrderBook"
rm.strat(portfolio.st)
rm.strat(strategy.st)
initAcct(account.st, portfolio.st, currency='USD', initEq=initEq)
initPortf(portfolio.st, symbols, currency='USD')
initOrders(portfolio.st)
strategy(strategy.st, store=TRUE)

#Add Indicators
add.indicator(strategy.st, name="SMA",
              arguments=list(x=quote(Cl(mktdata)), n=20),
              label="sma")

#Add Entry and Exit Signals
add.signal(strategy.st, name="sigComparison",
           arguments=list(columns=c("Close", "SMA.20.sma"),
                          relationship="gt"),
           label="longentry")

#enter signal rule
add.rule(strategy.st, name="ruleSignal",
         arguments=list(sigcol="longentry",
                        sigval=TRUE,
                        ordertype="limit",
                        orderside="long",
                        replace=TRUE,
                        prefer="Close",
                        tmult = TRUE,
                        threshold = 0.05,
                        time.in.force=172800,
                        orderqty=tradeSize,
                        osFUN=osMaxDollar,
                        tradeSize=tradeSize,
                        maxSize=tradeSize),
         type="enter",
         path.dep=TRUE,
         label="enterlong")

#stop loss.
add.rule(strategy.st, name="ruleSignal",
         arguments=list(sigcol="longentry",
                        sigval=TRUE,
                        ordertype="stoptrailing",
                        orderside="long",
                        replace=FALSE,
                        orderqty="all",
                        threshold=0.05,
                        tmult=TRUE,
                        orderset="ocolong"),
         type="chain",
         parent="enterlong",
         label="stopLossLong",
         path.dep=TRUE,
         enable=TRUE)

#apply strategy
out2 <- applyStrategy(strategy=strategy.st,portfolios=portfolio.st )

#get open orders
oB <- getOrders(portfolio.st, symbols, status="open")

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Tue Apr  5 13:48:46 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 5 Apr 2016 06:48:46 -0500
Subject: [R-SIG-Finance] GetOrders with Quantstrat
In-Reply-To: <CANf4qfhT8-BmzdCfVrb8FMOWaT-Ayi5pPOoMnPmD5hg5ePL9-w@mail.gmail.com>
References: <CANf4qfhT8-BmzdCfVrb8FMOWaT-Ayi5pPOoMnPmD5hg5ePL9-w@mail.gmail.com>
Message-ID: <CAPPM_gTi4kM63dmu4W=kET=jTOdPnpGWEphcyhVjy_-tmzk8EA@mail.gmail.com>

On Tue, Apr 5, 2016 at 4:26 AM, Ryan Crawford <suchislife27 at gmail.com> wrote:
> Hello
>
> I have been trying to view "open" orders from the orderbook in Quantstrat
> and keep running into the same error.
>
> It seems a reasonably simple process however the error I get is:
>
> oB <- getOrders(portfolio.st, symbols, status="open")
>
> Error in orderbook[[portfolio]][[symbol]] :
>   recursive indexing failed at level 2
>
> I've searched extensively and I can't seem to pinpoint the issue.
>
> Below is a reproducible example that generates the error.
>
> Thank you in advance for any help.
>
While reproducible, a strategy with 22 symbols isn't minimal.
Regardless, I ran your code, but no orders are created and lots of
warnings are generated by IKTrading function(s).

I also get a different error when calling getOrders():
"Error in orderbook[[portfolio]][[symbol]] : no such index at level 2".
...which is reasonable, given there are no orders.

>
> require(quantstrat)
> require(IKTrading)
>
> # Set the currency and the timezone
> currency('USD')
> Sys.setenv(TZ = "UTC")
>
> # Define symbols of interest
> symbols <- c("AMP.AX", "BHP.AX", "ANZ.AX",
>              "CBA.AX", "BXB.AX", "CSL.AX", "IAG.AX",
>              "MQG.AX", "NAB.AX", "ORG.AX", "QBE.AX",
>              "RIO.AX", "SCG.AX", "SUN.AX", "TLS.AX",
>              "WBC.AX", "WES.AX", "WOW.AX", "WPL.AX",
>              "TCL.AX", "WFD.AX", "AMC.AX")
>
> #Get Symbols
> getSymbols(Symbols=symbols, from="2010-01-01", to="2016-04-04")
>
> # Define the instrument type
> stock(symbols, currency = "USD", multiplier = 1)
>
> #Boilerplate
> from = "2010-01-01"
> to = "2016-04-04"
>
> #trade sizing and initial equity settings
> tradeSize <- 2500
> initEq <- 100000
>
> strategy.st <- portfolio.st <- account.st <- "GetOrderBook"
> rm.strat(portfolio.st)
> rm.strat(strategy.st)
> initAcct(account.st, portfolio.st, currency='USD', initEq=initEq)
> initPortf(portfolio.st, symbols, currency='USD')
> initOrders(portfolio.st)
> strategy(strategy.st, store=TRUE)
>
> #Add Indicators
> add.indicator(strategy.st, name="SMA",
>               arguments=list(x=quote(Cl(mktdata)), n=20),
>               label="sma")
>
> #Add Entry and Exit Signals
> add.signal(strategy.st, name="sigComparison",
>            arguments=list(columns=c("Close", "SMA.20.sma"),
>                           relationship="gt"),
>            label="longentry")
>
> #enter signal rule
> add.rule(strategy.st, name="ruleSignal",
>          arguments=list(sigcol="longentry",
>                         sigval=TRUE,
>                         ordertype="limit",
>                         orderside="long",
>                         replace=TRUE,
>                         prefer="Close",
>                         tmult = TRUE,
>                         threshold = 0.05,
>                         time.in.force=172800,
>                         orderqty=tradeSize,
>                         osFUN=osMaxDollar,
>                         tradeSize=tradeSize,
>                         maxSize=tradeSize),
>          type="enter",
>          path.dep=TRUE,
>          label="enterlong")
>
> #stop loss.
> add.rule(strategy.st, name="ruleSignal",
>          arguments=list(sigcol="longentry",
>                         sigval=TRUE,
>                         ordertype="stoptrailing",
>                         orderside="long",
>                         replace=FALSE,
>                         orderqty="all",
>                         threshold=0.05,
>                         tmult=TRUE,
>                         orderset="ocolong"),
>          type="chain",
>          parent="enterlong",
>          label="stopLossLong",
>          path.dep=TRUE,
>          enable=TRUE)
>
> #apply strategy
> out2 <- applyStrategy(strategy=strategy.st,portfolios=portfolio.st )
>
> #get open orders
> oB <- getOrders(portfolio.st, symbols, status="open")
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From peter.neumaier at gmail.com  Tue Apr  5 22:06:58 2016
From: peter.neumaier at gmail.com (Peter Neumaier)
Date: Tue, 5 Apr 2016 21:06:58 +0100
Subject: [R-SIG-Finance] rbind and duplicates in monthly futures
In-Reply-To: <CAPPM_gSJiiEdB09cOMPFf5xbKPoO_0NkpKzg7-RDmvehq2yaUA@mail.gmail.com>
References: <CAHDRDJV9zhYMyf7_RPuF8LtXck4Zdx_P_C83xgKG3ZAWr76rSQ@mail.gmail.com>
	<CAPPM_gSJiiEdB09cOMPFf5xbKPoO_0NkpKzg7-RDmvehq2yaUA@mail.gmail.com>
Message-ID: <CAHDRDJVocXEB0-EFvkq-BZp5R6pzg=bCbjxYGXhL5QwgDSNGPg@mail.gmail.com>

Hi all, in the interim I've managed to import the halfhourly data, cast to
a matrix, then rbind the two months
and convert to XTS for later use by my algo strategy.

I am wondering how the data overlap will be treated by the quantstrat
framework and how
it might be impacting the calculations (i.e. P&L during overlaps).

Below the files and the code I am using:

APR <-
as.matrix(read.zoo("NGF201404_6weeks30mins.csv",sep=",",tz="",header=T))
MAY <-
as.matrix(read.zoo("NGF201405_6weeks30mins.csv",sep=",",tz="",header=T))

APR_MAY <- as.xts(rbind(APR,MAY))


http://tempsend.com/BBA86DB4ED

http://tempsend.com/0EDA07753B

Thanks
Peter

On Mon, Apr 4, 2016 at 2:30 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
wrote:

> On Mon, Apr 4, 2016 at 7:24 AM, Peter Neumaier <peter.neumaier at gmail.com>
> wrote:
> > Hi all, I am trying to rbind monthly futures to a continuous time series
> to
> > be run through an algo strategy. The problem here is that data is
> > overlapping, i.e. my Feb contract trades for 6 weeks and when I rbind
> with
> > my March data I get an overlap for last two weeks of Jan.
> >
> > How can I create a time series that is continuous, not overlapping and
> > useable in quantstrat (i.e. XTS format)? I am not posting any code as it
> > would be really one single rbind statement.
> >
> Even though the code may be simple, you still would be more likely to
> receive help if you provide a minimal reproducible example of the
> issue.  In this case, the data are not simple, and most people will
> not take the time to construct sample data in order to attempt to
> reproduce the issue you describe.
>
> > Thanks
> > Peter
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
>

	[[alternative HTML version deleted]]


From jerseyfanatic1 at gmail.com  Wed Apr  6 19:58:15 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Wed, 6 Apr 2016 20:58:15 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single computer
Message-ID: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>

Hi everyone,

I am trying to backtest a simple strategy of mine, but it took approx 10
hours of processing so I was wondering if it is normal.

My computer has an i7 core 2.10 GHz, 8GB RAM with Windows 7 Ultimate OS. My
code uses doSNOW package for parallel processing and all the 8 cores, so
the CPU is %100 all the time for the complete 10 hours.

The data the backtest is done on is M5 OHLC FX (24 hour) data for approx 1
year  which makes a total of 58000 data points (counting OHLC as 1). The
strategy has 4 entry&exit and 4 stoploss&trailingstoploss&takeprofit rules.
144 combinations of parameters are tested.

I would just like to know if this time is normal for just 1 home-use
computer. And I would be grateful for any recommendations to speed up this
process to decrease computing time.

Thanks!

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Apr  6 20:05:51 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 06 Apr 2016 13:05:51 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a single
 computer
In-Reply-To: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
Message-ID: <1459965951.7774.156.camel@brian-rcg>

On Wed, 2016-04-06 at 20:58 +0300, Jersey Fanatic wrote:
> Hi everyone,
> 
> I am trying to backtest a simple strategy of mine, but it took approx 10
> hours of processing so I was wondering if it is normal.
> 
> My computer has an i7 core 2.10 GHz, 8GB RAM with Windows 7 Ultimate OS. My
> code uses doSNOW package for parallel processing and all the 8 cores, so
> the CPU is %100 all the time for the complete 10 hours.
> 
> The data the backtest is done on is M5 OHLC FX (24 hour) data for approx 1
> year  which makes a total of 58000 data points (counting OHLC as 1). The
> strategy has 4 entry&exit and 4 stoploss&trailingstoploss&takeprofit rules.
> 144 combinations of parameters are tested.
> 
> I would just like to know if this time is normal for just 1 home-use
> computer. And I would be grateful for any recommendations to speed up this
> process to decrease computing time.

No, this sounds very high.

You haven't told us enough about what you're trying to do for anyone
here to help you in a specific way.  You'd need to provide a minimal
reproducible example.

However, we typically use a benchmark time of one core minute per day
per instrument on tick data (millions of observations per day).

Is seems likely that you are doing too much path dependent looping,
copying, or both.

Regards,

Brian


From jerseyfanatic1 at gmail.com  Wed Apr  6 22:20:17 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Wed, 6 Apr 2016 23:20:17 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
Message-ID: <CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>

The email with the CSV data attached is waiting for moderator's approval.
The reproducible code is below.


2016-04-06 23:17 GMT+03:00 Jersey Fanatic <jerseyfanatic1 at gmail.com>:

> Thanks for the quick reply. I did not understand what you meant by path
> dependent looping or copying, but my aim is to decrease the processing time
> of the backtesting of several combinations of parameters.
>
> Here is the reproducible example, and the data I am using is attached as
> well:
>
> library(lattice)
> library(foreach)
> library(doSNOW)
> library(ggplot2)
> library(PerformanceAnalytics)
> library(doSNOW)
> require(latticeExtra)
> require(grid)
> library(gridExtra)
> library(reshape)
> library(quantstrat)
> no.cores <- 8
>
> .strategy<- new.env()
> .blotter<- new.env()
>
> currency(c('USD', 'EUR'))
> exchange_rate(primary_id="EURUSD", tick_size=0.0001)
>
> data.location.r <- "processingtime_q_rsigfinance.csv"
> symbol.data <- as.xts(read.zoo(data.location.r, sep=',',
> tz="",header=TRUE, format='%d/%m/%Y %H:%M', index.column = 1))
> symbol.data <- symbol.data[symbol.data$VOLUME!=0,]
>                                    # Delete rows with no volume (when the
> market is closed)
> symbol.data[,c(1,2,3,4)] <-
> round(as.numeric(symbol.data[,c(1,2,3,4)]),abs(log10(0.0001))) #datay? tick
> sizela uyumlu yapma
> assign("EURUSD", symbol.data)
>
> strategy.st <- "rsigfinance"
> rm.strat(strategy.st)
>
>
> initDate = as.character(as.Date(index(symbol.data[1])-1))
>
> initPortf(strategy.st, "EURUSD", initDate=initDate, currency = "USD")
> initAcct(strategy.st, portfolios=strategy.st, initDate=initDate,
> initEq=100000, currency = "USD")
> initOrders(portfolio=strategy.st,initDate=initDate)
>
> strategy(strategy.st,store=TRUE)
> summary(getStrategy(strategy.st))
>
>
> macdFastMARange <- seq(2,17,by=5)
> macdSlowMARange <- seq(5,35,by=10)
> macdSignalRange <- seq(2,18,by=8)
>
> StopLossDistanceRange <- seq(0.01,0.02,by=0.01)
>
> TrailingDistanceRange <- seq(0.01,0.02,by=0.01)
>
>
> positionSizeLong  =    round(100000 / as.numeric(symbol.data$CLOSE[1]),-2)
> positionSizeShort =  - round(100000 / as.numeric(symbol.data$CLOSE[1]),-2)
> txn.model <- 0
> sltsltp.txn.fee <- 0
>
>
> add.indicator(strategy.st,
>               name = "MACD",
>               arguments = list(x=Cl(eval(parse(text = "EURUSD")))),
>               label='macd')
>
> add.signal(strategy.st,name="sigCrossover",
>            arguments =
> list(columns=c("macd.macd","signal.macd"),relationship="gt"),
>            label="macd.gt.signal")
>
> add.signal(strategy.st,name="sigCrossover",
>            arguments =
> list(columns=c("macd.macd","signal.macd"),relationship="lt"),
>            label="macd.lt.signal")
>
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="macd.gt.signal",
>                           sigval=TRUE,
>                           prefer="Open",
>                           orderqty= positionSizeLong,
>                           ordertype='market',
>                           orderside='long',
>                           orderset='ocolong',
>                           TxnFees = txn.model),
>          type='enter',
>          label='longenter',
>          enabled=TRUE
> )
>
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="macd.lt.signal",
>                           sigval=TRUE,
>                           prefer="Open",
>                           orderqty='all',
>                           ordertype='market',
>                           orderside='long',
>                           orderset='ocolong',
>                           TxnFees = txn.model),
>          type='exit',
>          label='longexit',
>          enabled=TRUE
> )
>
> add.rule(strategy.st,name='ruleSignal',
>          arguments = list( sigcol="macd.lt.signal", sigval=TRUE,
>                            replace=FALSE,
>                            orderside='long',
>                            ordertype='stoplimit',
>                            tmult=TRUE,
>                            threshold=quote( longStopLossDistance ),
>                            orderqty='all',
>                            orderset='ocolong',
>                            TxnFees = txn.model),
>          type='chain', parent="longenter",
>          label='StopLossLong',
>          enabled=TRUE)
>
> add.rule(strategy.st, name = 'ruleSignal',
>          arguments=list(sigcol="macd.lt.signal" , sigval=TRUE,
>                         replace=FALSE,
>                         orderside='long',
>                         ordertype='stoptrailing',
>                         tmult=TRUE,
>                         threshold=quote(longTrailingStopDistance),
>                         orderqty='all',
>                         orderset='ocolong',
>                         TxnFees = txn.model),
>          type='chain', parent="longenter",
>          label='StopTrailingLong',
>          enabled=TRUE
> )
>
> add.rule(strategy.st, name = "ruleSignal",
>          arguments = list(sigcol="macd.lt.signal",
>                           sigval=TRUE,
>                           ordertype="limit",
>                           orderside="long",
>                           replace=FALSE,
>                           tmult=TRUE,
>                           threshold=quote(longTakeProfitDistance),
>                           orderqty="all",
>                           orderset="ocolong",
>                           TxnFees = txn.model),
>          type = "chain", parent="longenter",
>          label = "takeProfitLong",
>          enabled = FALSE
> )
>
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="macd.lt.signal",
>                           sigval=TRUE,
>                           prefer="Open",
>                           orderqty=positionSizeShort,
>                           ordertype='market',
>                           orderside='short',
>                           orderset='ocoshort',
>                           TxnFees = txn.model),
>          type='enter',
>          label='shortenter',
>          enabled=TRUE
> )
>
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="macd.gt.signal",
>                           sigval=TRUE,
>                           prefer="Open",
>                           orderqty='all',
>                           ordertype='market',
>                           orderside='short',
>                           orderset='ocoshort',
>                           TxnFees = txn.model),
>          type='exit',
>          label='shortexit',
>          enabled=TRUE
> )
>
> add.rule(strategy.st,name='ruleSignal',
>          arguments = list( sigcol="macd.gt.signal", sigval=TRUE,
>                            replace=FALSE,
>                            orderside='short',
>                            ordertype='stoplimit',
>                            tmult=TRUE,
>                            threshold=quote( shortStopLossDistance ),
>                            orderqty='all',
>                            orderset='ocoshort',
>                            TxnFees = txn.model),
>          type='chain', parent="shortenter",
>          label='StopLossShort',
>          enabled=TRUE)
>
> add.rule(strategy.st, name = 'ruleSignal',
>          arguments=list(sigcol="macd.gt.signal" , sigval=TRUE,
>                         replace=FALSE,
>                         orderside='short',
>                         ordertype='stoptrailing',
>                         tmult=TRUE,
>                         threshold=quote( shortTrailingStopDistance),
>                         orderqty='all',
>                         orderset='ocoshort',
>                         TxnFees = txn.model),
>          type='chain', parent="shortenter",
>          label='StopTrailingShort',
>          enabled=TRUE
> )
>
> add.rule(strategy.st, name = "ruleSignal",
>          arguments = list(sigcol="macd.gt.signal",
>                           sigval=TRUE,
>                           ordertype="limit",
>                           orderside="short",
>                           replace=FALSE,
>                           tmult=TRUE,
>                           threshold=quote( -shortTakeProfitDistance),
>                           orderqty="all",
>                           orderset="ocoshort",
>                           TxnFees = txn.model),
>          type = "chain", parent="shortenter",
>          label = "takeProfitShort",
>          enabled = FALSE
> )
>
>
> add.distribution(strategy.st,
>                  paramset.label = "MACD_OPT",
>                  component.type = 'indicator',
>                  component.label = "macd",
>                  variable = list( nFast = macdFastMARange ),
>                  label = "macdFastMARANGE")
>
>
> add.distribution(strategy.st,
>                  paramset.label = "MACD_OPT",
>                  component.type = 'indicator',
>                  component.label = "macd",
>                  variable = list( nSlow = macdSlowMARange ),
>                  label = "macdSlowMARANGE")
>
> add.distribution(strategy.st,
>                  paramset.label = "MACD_OPT",
>                  component.type = 'indicator',
>                  component.label = "macd",
>                  variable = list( nSig = macdSignalRange ),
>                  label = "macdSignalRANGE")
>
> add.distribution.constraint(strategy.st,
>                             paramset.label = 'MACD_OPT',
>                             distribution.label.1 = 'macdFastMARANGE',
>                             distribution.label.2 = 'macdSlowMARANGE',
>                             operator = '<',
>                             label = 'FastMA<SlowMA')
>
> add.distribution(strategy.st,
>                  paramset.label = "MACD_OPT",
>                  component.type = "chain",
>                  component.label = "StopLossLong",
>                  variable = list( threshold = StopLossDistanceRange ),
>                  label = "StopLossLONG")
>
> add.distribution(strategy.st,
>                  paramset.label = "MACD_OPT",
>                  component.type = "chain",
>                  component.label = "StopTrailingLong",
>                  variable = list( threshold = TrailingDistanceRange ),
>                  label = "StopTrailingLONG")
>
> add.distribution(strategy.st,
>                  paramset.label = "MACD_OPT",
>                  component.type = "chain",
>                  component.label = "StopLossShort",
>                  variable = list( threshold = StopLossDistanceRange ),
>                  label = "StopLossSHORT")
>
> add.distribution(strategy.st,
>                  paramset.label = "MACD_OPT",
>                  component.type = "chain",
>                  component.label = "StopTrailingShort",
>                  variable = list( threshold = TrailingDistanceRange ),
>                  label = "StopTrailingSHORT")
>
> add.distribution.constraint(strategy.st,
>                             paramset.label = "MACD_OPT",
>                             distribution.label.1 = "StopLossLONG",
>                             distribution.label.2 = "StopLossSHORT",
>                             operator = "==",
>                             label = "StoplossEquality")
>
> add.distribution.constraint(strategy.st,
>                             paramset.label = "MACD_OPT",
>                             distribution.label.1 = "StopTrailingLONG",
>                             distribution.label.2 = "StopTrailingSHORT",
>                             operator = "==",
>                             label = "TrailingStopEquality")
>
> summary(getStrategy(strategy.st))
>
>
>
> start.t <- Sys.time()
> paramsetenv<-new.env()
> cl <- snow::makeCluster(no.cores, type = "SOCK")
> registerDoSNOW(cl)
> results <- apply.paramset(strategy.st,paramset.label="MACD_OPT",
>                           portfolio=strategy.st, account=strategy.st,nsamples=0,verbose
> = FALSE,
>                           audit=paramsetenv)
> snow::stopCluster(cl)
> finish.t <- Sys.time()
> print(finish.t-start.t)
>
>
>
>
>
> If there are any problems with the code when reproducing, sorry. I ran it
> on my computer and it did seem to work as it did normally.
>
>
>
> 2016-04-06 21:05 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
>
>> On Wed, 2016-04-06 at 20:58 +0300, Jersey Fanatic wrote:
>> > Hi everyone,
>> >
>> > I am trying to backtest a simple strategy of mine, but it took approx 10
>> > hours of processing so I was wondering if it is normal.
>> >
>> > My computer has an i7 core 2.10 GHz, 8GB RAM with Windows 7 Ultimate
>> OS. My
>> > code uses doSNOW package for parallel processing and all the 8 cores, so
>> > the CPU is %100 all the time for the complete 10 hours.
>> >
>> > The data the backtest is done on is M5 OHLC FX (24 hour) data for
>> approx 1
>> > year  which makes a total of 58000 data points (counting OHLC as 1). The
>> > strategy has 4 entry&exit and 4 stoploss&trailingstoploss&takeprofit
>> rules.
>> > 144 combinations of parameters are tested.
>> >
>> > I would just like to know if this time is normal for just 1 home-use
>> > computer. And I would be grateful for any recommendations to speed up
>> this
>> > process to decrease computing time.
>>
>> No, this sounds very high.
>>
>> You haven't told us enough about what you're trying to do for anyone
>> here to help you in a specific way.  You'd need to provide a minimal
>> reproducible example.
>>
>> However, we typically use a benchmark time of one core minute per day
>> per instrument on tick data (millions of observations per day).
>>
>> Is seems likely that you are doing too much path dependent looping,
>> copying, or both.
>>
>> Regards,
>>
>> Brian
>>
>>
>

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Apr  6 22:48:47 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 06 Apr 2016 15:48:47 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a single
 computer
In-Reply-To: <CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
Message-ID: <1459975727.7774.163.camel@brian-rcg>

You didn't say that you were doing parameter optimization.

The length of time that a parameter optimization using brute force will
take is a linear combination of the number of parameter combinations
that you choose to search.

Typically, you should only include parameter distributions for
parameters for which you feel you have a strong economic justification.
Your strategy contains eight parameter distributions and two
constraints.  The choices of these distributions appears arbitrary, and
will result in hundreds of combinations to test.  So, you should expect
your strategy to take approximately a linear combination of additional
time based on the number of parameters you wish to test. 

Another thing that will make this test take a long time is the inclusion
of trailing stops.  As is described in the documentation, trailing stops
require evaluating the strategy at more points in the path dependent
loop.  The number of observations that need to be evaluated in the path
dependent rules loop has another linear effect on the time to evaluate
your backtest.  Have you validated that there is a theoretical
justification for a trailing stop?  Does this increase the positive
expectation of your resulting signal process?

Most of the validation of your indicator and signal processes should be
possible long before you get to parameter optimization.

Regards,

Brian
  
-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


On Wed, 2016-04-06 at 23:20 +0300, Jersey Fanatic wrote:
> The email with the CSV data attached is waiting for moderator's approval.
> The reproducible code is below.
> 
> 
> 2016-04-06 23:17 GMT+03:00 Jersey Fanatic <jerseyfanatic1 at gmail.com>:
> 
> > Thanks for the quick reply. I did not understand what you meant by path
> > dependent looping or copying, but my aim is to decrease the processing time
> > of the backtesting of several combinations of parameters.
> >
> > Here is the reproducible example, and the data I am using is attached as
> > well:
> >
> > library(lattice)
> > library(foreach)
> > library(doSNOW)
> > library(ggplot2)
> > library(PerformanceAnalytics)
> > library(doSNOW)
> > require(latticeExtra)
> > require(grid)
> > library(gridExtra)
> > library(reshape)
> > library(quantstrat)
> > no.cores <- 8
> >
> > .strategy<- new.env()
> > .blotter<- new.env()
> >
> > currency(c('USD', 'EUR'))
> > exchange_rate(primary_id="EURUSD", tick_size=0.0001)
> >
> > data.location.r <- "processingtime_q_rsigfinance.csv"
> > symbol.data <- as.xts(read.zoo(data.location.r, sep=',',
> > tz="",header=TRUE, format='%d/%m/%Y %H:%M', index.column = 1))
> > symbol.data <- symbol.data[symbol.data$VOLUME!=0,]
> >                                    # Delete rows with no volume (when the
> > market is closed)
> > symbol.data[,c(1,2,3,4)] <-
> > round(as.numeric(symbol.data[,c(1,2,3,4)]),abs(log10(0.0001))) #datay? tick
> > sizela uyumlu yapma
> > assign("EURUSD", symbol.data)
> >
> > strategy.st <- "rsigfinance"
> > rm.strat(strategy.st)
> >
> >
> > initDate = as.character(as.Date(index(symbol.data[1])-1))
> >
> > initPortf(strategy.st, "EURUSD", initDate=initDate, currency = "USD")
> > initAcct(strategy.st, portfolios=strategy.st, initDate=initDate,
> > initEq=100000, currency = "USD")
> > initOrders(portfolio=strategy.st,initDate=initDate)
> >
> > strategy(strategy.st,store=TRUE)
> > summary(getStrategy(strategy.st))
> >
> >
> > macdFastMARange <- seq(2,17,by=5)
> > macdSlowMARange <- seq(5,35,by=10)
> > macdSignalRange <- seq(2,18,by=8)
> >
> > StopLossDistanceRange <- seq(0.01,0.02,by=0.01)
> >
> > TrailingDistanceRange <- seq(0.01,0.02,by=0.01)
> >
> >
> > positionSizeLong  =    round(100000 / as.numeric(symbol.data$CLOSE[1]),-2)
> > positionSizeShort =  - round(100000 / as.numeric(symbol.data$CLOSE[1]),-2)
> > txn.model <- 0
> > sltsltp.txn.fee <- 0
> >
> >
> > add.indicator(strategy.st,
> >               name = "MACD",
> >               arguments = list(x=Cl(eval(parse(text = "EURUSD")))),
> >               label='macd')
> >
> > add.signal(strategy.st,name="sigCrossover",
> >            arguments =
> > list(columns=c("macd.macd","signal.macd"),relationship="gt"),
> >            label="macd.gt.signal")
> >
> > add.signal(strategy.st,name="sigCrossover",
> >            arguments =
> > list(columns=c("macd.macd","signal.macd"),relationship="lt"),
> >            label="macd.lt.signal")
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.gt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty= positionSizeLong,
> >                           ordertype='market',
> >                           orderside='long',
> >                           orderset='ocolong',
> >                           TxnFees = txn.model),
> >          type='enter',
> >          label='longenter',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.lt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty='all',
> >                           ordertype='market',
> >                           orderside='long',
> >                           orderset='ocolong',
> >                           TxnFees = txn.model),
> >          type='exit',
> >          label='longexit',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,name='ruleSignal',
> >          arguments = list( sigcol="macd.lt.signal", sigval=TRUE,
> >                            replace=FALSE,
> >                            orderside='long',
> >                            ordertype='stoplimit',
> >                            tmult=TRUE,
> >                            threshold=quote( longStopLossDistance ),
> >                            orderqty='all',
> >                            orderset='ocolong',
> >                            TxnFees = txn.model),
> >          type='chain', parent="longenter",
> >          label='StopLossLong',
> >          enabled=TRUE)
> >
> > add.rule(strategy.st, name = 'ruleSignal',
> >          arguments=list(sigcol="macd.lt.signal" , sigval=TRUE,
> >                         replace=FALSE,
> >                         orderside='long',
> >                         ordertype='stoptrailing',
> >                         tmult=TRUE,
> >                         threshold=quote(longTrailingStopDistance),
> >                         orderqty='all',
> >                         orderset='ocolong',
> >                         TxnFees = txn.model),
> >          type='chain', parent="longenter",
> >          label='StopTrailingLong',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st, name = "ruleSignal",
> >          arguments = list(sigcol="macd.lt.signal",
> >                           sigval=TRUE,
> >                           ordertype="limit",
> >                           orderside="long",
> >                           replace=FALSE,
> >                           tmult=TRUE,
> >                           threshold=quote(longTakeProfitDistance),
> >                           orderqty="all",
> >                           orderset="ocolong",
> >                           TxnFees = txn.model),
> >          type = "chain", parent="longenter",
> >          label = "takeProfitLong",
> >          enabled = FALSE
> > )
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.lt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty=positionSizeShort,
> >                           ordertype='market',
> >                           orderside='short',
> >                           orderset='ocoshort',
> >                           TxnFees = txn.model),
> >          type='enter',
> >          label='shortenter',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.gt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty='all',
> >                           ordertype='market',
> >                           orderside='short',
> >                           orderset='ocoshort',
> >                           TxnFees = txn.model),
> >          type='exit',
> >          label='shortexit',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,name='ruleSignal',
> >          arguments = list( sigcol="macd.gt.signal", sigval=TRUE,
> >                            replace=FALSE,
> >                            orderside='short',
> >                            ordertype='stoplimit',
> >                            tmult=TRUE,
> >                            threshold=quote( shortStopLossDistance ),
> >                            orderqty='all',
> >                            orderset='ocoshort',
> >                            TxnFees = txn.model),
> >          type='chain', parent="shortenter",
> >          label='StopLossShort',
> >          enabled=TRUE)
> >
> > add.rule(strategy.st, name = 'ruleSignal',
> >          arguments=list(sigcol="macd.gt.signal" , sigval=TRUE,
> >                         replace=FALSE,
> >                         orderside='short',
> >                         ordertype='stoptrailing',
> >                         tmult=TRUE,
> >                         threshold=quote( shortTrailingStopDistance),
> >                         orderqty='all',
> >                         orderset='ocoshort',
> >                         TxnFees = txn.model),
> >          type='chain', parent="shortenter",
> >          label='StopTrailingShort',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st, name = "ruleSignal",
> >          arguments = list(sigcol="macd.gt.signal",
> >                           sigval=TRUE,
> >                           ordertype="limit",
> >                           orderside="short",
> >                           replace=FALSE,
> >                           tmult=TRUE,
> >                           threshold=quote( -shortTakeProfitDistance),
> >                           orderqty="all",
> >                           orderset="ocoshort",
> >                           TxnFees = txn.model),
> >          type = "chain", parent="shortenter",
> >          label = "takeProfitShort",
> >          enabled = FALSE
> > )
> >
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = 'indicator',
> >                  component.label = "macd",
> >                  variable = list( nFast = macdFastMARange ),
> >                  label = "macdFastMARANGE")
> >
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = 'indicator',
> >                  component.label = "macd",
> >                  variable = list( nSlow = macdSlowMARange ),
> >                  label = "macdSlowMARANGE")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = 'indicator',
> >                  component.label = "macd",
> >                  variable = list( nSig = macdSignalRange ),
> >                  label = "macdSignalRANGE")
> >
> > add.distribution.constraint(strategy.st,
> >                             paramset.label = 'MACD_OPT',
> >                             distribution.label.1 = 'macdFastMARANGE',
> >                             distribution.label.2 = 'macdSlowMARANGE',
> >                             operator = '<',
> >                             label = 'FastMA<SlowMA')
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopLossLong",
> >                  variable = list( threshold = StopLossDistanceRange ),
> >                  label = "StopLossLONG")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopTrailingLong",
> >                  variable = list( threshold = TrailingDistanceRange ),
> >                  label = "StopTrailingLONG")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopLossShort",
> >                  variable = list( threshold = StopLossDistanceRange ),
> >                  label = "StopLossSHORT")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopTrailingShort",
> >                  variable = list( threshold = TrailingDistanceRange ),
> >                  label = "StopTrailingSHORT")
> >
> > add.distribution.constraint(strategy.st,
> >                             paramset.label = "MACD_OPT",
> >                             distribution.label.1 = "StopLossLONG",
> >                             distribution.label.2 = "StopLossSHORT",
> >                             operator = "==",
> >                             label = "StoplossEquality")
> >
> > add.distribution.constraint(strategy.st,
> >                             paramset.label = "MACD_OPT",
> >                             distribution.label.1 = "StopTrailingLONG",
> >                             distribution.label.2 = "StopTrailingSHORT",
> >                             operator = "==",
> >                             label = "TrailingStopEquality")
> >
> > summary(getStrategy(strategy.st))
> >
> >
> >
> > start.t <- Sys.time()
> > paramsetenv<-new.env()
> > cl <- snow::makeCluster(no.cores, type = "SOCK")
> > registerDoSNOW(cl)
> > results <- apply.paramset(strategy.st,paramset.label="MACD_OPT",
> >                           portfolio=strategy.st, account=strategy.st,nsamples=0,verbose
> > = FALSE,
> >                           audit=paramsetenv)
> > snow::stopCluster(cl)
> > finish.t <- Sys.time()
> > print(finish.t-start.t)
> >
> >
> >
> >
> >
> > If there are any problems with the code when reproducing, sorry. I ran it
> > on my computer and it did seem to work as it did normally.
> >
> >
> >
> > 2016-04-06 21:05 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
> >
> >> On Wed, 2016-04-06 at 20:58 +0300, Jersey Fanatic wrote:
> >> > Hi everyone,
> >> >
> >> > I am trying to backtest a simple strategy of mine, but it took approx 10
> >> > hours of processing so I was wondering if it is normal.
> >> >
> >> > My computer has an i7 core 2.10 GHz, 8GB RAM with Windows 7 Ultimate
> >> OS. My
> >> > code uses doSNOW package for parallel processing and all the 8 cores, so
> >> > the CPU is %100 all the time for the complete 10 hours.
> >> >
> >> > The data the backtest is done on is M5 OHLC FX (24 hour) data for
> >> approx 1
> >> > year  which makes a total of 58000 data points (counting OHLC as 1). The
> >> > strategy has 4 entry&exit and 4 stoploss&trailingstoploss&takeprofit
> >> rules.
> >> > 144 combinations of parameters are tested.
> >> >
> >> > I would just like to know if this time is normal for just 1 home-use
> >> > computer. And I would be grateful for any recommendations to speed up
> >> this
> >> > process to decrease computing time.
> >>
> >> No, this sounds very high.
> >>
> >> You haven't told us enough about what you're trying to do for anyone
> >> here to help you in a specific way.  You'd need to provide a minimal
> >> reproducible example.
> >>
> >> However, we typically use a benchmark time of one core minute per day
> >> per instrument on tick data (millions of observations per day).
> >>
> >> Is seems likely that you are doing too much path dependent looping,
> >> copying, or both.
> >>
> >> Regards,
> >>
> >> Brian
> >>
> >>
> >
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From jerseyfanatic1 at gmail.com  Wed Apr  6 22:58:34 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Wed, 6 Apr 2016 23:58:34 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <1459975727.7774.163.camel@brian-rcg>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
Message-ID: <CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>

I stated that I was doing parameter optimization, although I should have
been more clear:
> >> > 144 combinations of parameters are tested.
So the total number of combinations to test is just 144, not several
hundred. That makes the processing time for each combination approx 4.2
minutes. Is that within normal bounds?

I will try running the same code without trailing stops and see what effect
it has on the processing time. I will report back as soon as it is
finished.



2016-04-06 23:48 GMT+03:00 Brian G. Peterson <brian at braverock.com>:

> You didn't say that you were doing parameter optimization.
>
> The length of time that a parameter optimization using brute force will
> take is a linear combination of the number of parameter combinations
> that you choose to search.
>
> Typically, you should only include parameter distributions for
> parameters for which you feel you have a strong economic justification.
> Your strategy contains eight parameter distributions and two
> constraints.  The choices of these distributions appears arbitrary, and
> will result in hundreds of combinations to test.  So, you should expect
> your strategy to take approximately a linear combination of additional
> time based on the number of parameters you wish to test.
>
> Another thing that will make this test take a long time is the inclusion
> of trailing stops.  As is described in the documentation, trailing stops
> require evaluating the strategy at more points in the path dependent
> loop.  The number of observations that need to be evaluated in the path
> dependent rules loop has another linear effect on the time to evaluate
> your backtest.  Have you validated that there is a theoretical
> justification for a trailing stop?  Does this increase the positive
> expectation of your resulting signal process?
>
> Most of the validation of your indicator and signal processes should be
> possible long before you get to parameter optimization.
>
> Regards,
>
> Brian
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>
> On Wed, 2016-04-06 at 23:20 +0300, Jersey Fanatic wrote:
> > The email with the CSV data attached is waiting for moderator's approval.
> > The reproducible code is below.
> >
> >
> > 2016-04-06 23:17 GMT+03:00 Jersey Fanatic <jerseyfanatic1 at gmail.com>:
> >
> > > Thanks for the quick reply. I did not understand what you meant by path
> > > dependent looping or copying, but my aim is to decrease the processing
> time
> > > of the backtesting of several combinations of parameters.
> > >
> > > Here is the reproducible example, and the data I am using is attached
> as
> > > well:
> > >
> > > library(lattice)
> > > library(foreach)
> > > library(doSNOW)
> > > library(ggplot2)
> > > library(PerformanceAnalytics)
> > > library(doSNOW)
> > > require(latticeExtra)
> > > require(grid)
> > > library(gridExtra)
> > > library(reshape)
> > > library(quantstrat)
> > > no.cores <- 8
> > >
> > > .strategy<- new.env()
> > > .blotter<- new.env()
> > >
> > > currency(c('USD', 'EUR'))
> > > exchange_rate(primary_id="EURUSD", tick_size=0.0001)
> > >
> > > data.location.r <- "processingtime_q_rsigfinance.csv"
> > > symbol.data <- as.xts(read.zoo(data.location.r, sep=',',
> > > tz="",header=TRUE, format='%d/%m/%Y %H:%M', index.column = 1))
> > > symbol.data <- symbol.data[symbol.data$VOLUME!=0,]
> > >                                    # Delete rows with no volume (when
> the
> > > market is closed)
> > > symbol.data[,c(1,2,3,4)] <-
> > > round(as.numeric(symbol.data[,c(1,2,3,4)]),abs(log10(0.0001))) #datay?
> tick
> > > sizela uyumlu yapma
> > > assign("EURUSD", symbol.data)
> > >
> > > strategy.st <- "rsigfinance"
> > > rm.strat(strategy.st)
> > >
> > >
> > > initDate = as.character(as.Date(index(symbol.data[1])-1))
> > >
> > > initPortf(strategy.st, "EURUSD", initDate=initDate, currency = "USD")
> > > initAcct(strategy.st, portfolios=strategy.st, initDate=initDate,
> > > initEq=100000, currency = "USD")
> > > initOrders(portfolio=strategy.st,initDate=initDate)
> > >
> > > strategy(strategy.st,store=TRUE)
> > > summary(getStrategy(strategy.st))
> > >
> > >
> > > macdFastMARange <- seq(2,17,by=5)
> > > macdSlowMARange <- seq(5,35,by=10)
> > > macdSignalRange <- seq(2,18,by=8)
> > >
> > > StopLossDistanceRange <- seq(0.01,0.02,by=0.01)
> > >
> > > TrailingDistanceRange <- seq(0.01,0.02,by=0.01)
> > >
> > >
> > > positionSizeLong  =    round(100000 /
> as.numeric(symbol.data$CLOSE[1]),-2)
> > > positionSizeShort =  - round(100000 /
> as.numeric(symbol.data$CLOSE[1]),-2)
> > > txn.model <- 0
> > > sltsltp.txn.fee <- 0
> > >
> > >
> > > add.indicator(strategy.st,
> > >               name = "MACD",
> > >               arguments = list(x=Cl(eval(parse(text = "EURUSD")))),
> > >               label='macd')
> > >
> > > add.signal(strategy.st,name="sigCrossover",
> > >            arguments =
> > > list(columns=c("macd.macd","signal.macd"),relationship="gt"),
> > >            label="macd.gt.signal")
> > >
> > > add.signal(strategy.st,name="sigCrossover",
> > >            arguments =
> > > list(columns=c("macd.macd","signal.macd"),relationship="lt"),
> > >            label="macd.lt.signal")
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.gt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty= positionSizeLong,
> > >                           ordertype='market',
> > >                           orderside='long',
> > >                           orderset='ocolong',
> > >                           TxnFees = txn.model),
> > >          type='enter',
> > >          label='longenter',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.lt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty='all',
> > >                           ordertype='market',
> > >                           orderside='long',
> > >                           orderset='ocolong',
> > >                           TxnFees = txn.model),
> > >          type='exit',
> > >          label='longexit',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,name='ruleSignal',
> > >          arguments = list( sigcol="macd.lt.signal", sigval=TRUE,
> > >                            replace=FALSE,
> > >                            orderside='long',
> > >                            ordertype='stoplimit',
> > >                            tmult=TRUE,
> > >                            threshold=quote( longStopLossDistance ),
> > >                            orderqty='all',
> > >                            orderset='ocolong',
> > >                            TxnFees = txn.model),
> > >          type='chain', parent="longenter",
> > >          label='StopLossLong',
> > >          enabled=TRUE)
> > >
> > > add.rule(strategy.st, name = 'ruleSignal',
> > >          arguments=list(sigcol="macd.lt.signal" , sigval=TRUE,
> > >                         replace=FALSE,
> > >                         orderside='long',
> > >                         ordertype='stoptrailing',
> > >                         tmult=TRUE,
> > >                         threshold=quote(longTrailingStopDistance),
> > >                         orderqty='all',
> > >                         orderset='ocolong',
> > >                         TxnFees = txn.model),
> > >          type='chain', parent="longenter",
> > >          label='StopTrailingLong',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st, name = "ruleSignal",
> > >          arguments = list(sigcol="macd.lt.signal",
> > >                           sigval=TRUE,
> > >                           ordertype="limit",
> > >                           orderside="long",
> > >                           replace=FALSE,
> > >                           tmult=TRUE,
> > >                           threshold=quote(longTakeProfitDistance),
> > >                           orderqty="all",
> > >                           orderset="ocolong",
> > >                           TxnFees = txn.model),
> > >          type = "chain", parent="longenter",
> > >          label = "takeProfitLong",
> > >          enabled = FALSE
> > > )
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.lt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty=positionSizeShort,
> > >                           ordertype='market',
> > >                           orderside='short',
> > >                           orderset='ocoshort',
> > >                           TxnFees = txn.model),
> > >          type='enter',
> > >          label='shortenter',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.gt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty='all',
> > >                           ordertype='market',
> > >                           orderside='short',
> > >                           orderset='ocoshort',
> > >                           TxnFees = txn.model),
> > >          type='exit',
> > >          label='shortexit',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,name='ruleSignal',
> > >          arguments = list( sigcol="macd.gt.signal", sigval=TRUE,
> > >                            replace=FALSE,
> > >                            orderside='short',
> > >                            ordertype='stoplimit',
> > >                            tmult=TRUE,
> > >                            threshold=quote( shortStopLossDistance ),
> > >                            orderqty='all',
> > >                            orderset='ocoshort',
> > >                            TxnFees = txn.model),
> > >          type='chain', parent="shortenter",
> > >          label='StopLossShort',
> > >          enabled=TRUE)
> > >
> > > add.rule(strategy.st, name = 'ruleSignal',
> > >          arguments=list(sigcol="macd.gt.signal" , sigval=TRUE,
> > >                         replace=FALSE,
> > >                         orderside='short',
> > >                         ordertype='stoptrailing',
> > >                         tmult=TRUE,
> > >                         threshold=quote( shortTrailingStopDistance),
> > >                         orderqty='all',
> > >                         orderset='ocoshort',
> > >                         TxnFees = txn.model),
> > >          type='chain', parent="shortenter",
> > >          label='StopTrailingShort',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st, name = "ruleSignal",
> > >          arguments = list(sigcol="macd.gt.signal",
> > >                           sigval=TRUE,
> > >                           ordertype="limit",
> > >                           orderside="short",
> > >                           replace=FALSE,
> > >                           tmult=TRUE,
> > >                           threshold=quote( -shortTakeProfitDistance),
> > >                           orderqty="all",
> > >                           orderset="ocoshort",
> > >                           TxnFees = txn.model),
> > >          type = "chain", parent="shortenter",
> > >          label = "takeProfitShort",
> > >          enabled = FALSE
> > > )
> > >
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = 'indicator',
> > >                  component.label = "macd",
> > >                  variable = list( nFast = macdFastMARange ),
> > >                  label = "macdFastMARANGE")
> > >
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = 'indicator',
> > >                  component.label = "macd",
> > >                  variable = list( nSlow = macdSlowMARange ),
> > >                  label = "macdSlowMARANGE")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = 'indicator',
> > >                  component.label = "macd",
> > >                  variable = list( nSig = macdSignalRange ),
> > >                  label = "macdSignalRANGE")
> > >
> > > add.distribution.constraint(strategy.st,
> > >                             paramset.label = 'MACD_OPT',
> > >                             distribution.label.1 = 'macdFastMARANGE',
> > >                             distribution.label.2 = 'macdSlowMARANGE',
> > >                             operator = '<',
> > >                             label = 'FastMA<SlowMA')
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopLossLong",
> > >                  variable = list( threshold = StopLossDistanceRange ),
> > >                  label = "StopLossLONG")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopTrailingLong",
> > >                  variable = list( threshold = TrailingDistanceRange ),
> > >                  label = "StopTrailingLONG")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopLossShort",
> > >                  variable = list( threshold = StopLossDistanceRange ),
> > >                  label = "StopLossSHORT")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopTrailingShort",
> > >                  variable = list( threshold = TrailingDistanceRange ),
> > >                  label = "StopTrailingSHORT")
> > >
> > > add.distribution.constraint(strategy.st,
> > >                             paramset.label = "MACD_OPT",
> > >                             distribution.label.1 = "StopLossLONG",
> > >                             distribution.label.2 = "StopLossSHORT",
> > >                             operator = "==",
> > >                             label = "StoplossEquality")
> > >
> > > add.distribution.constraint(strategy.st,
> > >                             paramset.label = "MACD_OPT",
> > >                             distribution.label.1 = "StopTrailingLONG",
> > >                             distribution.label.2 = "StopTrailingSHORT",
> > >                             operator = "==",
> > >                             label = "TrailingStopEquality")
> > >
> > > summary(getStrategy(strategy.st))
> > >
> > >
> > >
> > > start.t <- Sys.time()
> > > paramsetenv<-new.env()
> > > cl <- snow::makeCluster(no.cores, type = "SOCK")
> > > registerDoSNOW(cl)
> > > results <- apply.paramset(strategy.st,paramset.label="MACD_OPT",
> > >                           portfolio=strategy.st, account=strategy.st
> ,nsamples=0,verbose
> > > = FALSE,
> > >                           audit=paramsetenv)
> > > snow::stopCluster(cl)
> > > finish.t <- Sys.time()
> > > print(finish.t-start.t)
> > >
> > >
> > >
> > >
> > >
> > > If there are any problems with the code when reproducing, sorry. I ran
> it
> > > on my computer and it did seem to work as it did normally.
> > >
> > >
> > >
> > > 2016-04-06 21:05 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
> > >
> > >> On Wed, 2016-04-06 at 20:58 +0300, Jersey Fanatic wrote:
> > >> > Hi everyone,
> > >> >
> > >> > I am trying to backtest a simple strategy of mine, but it took
> approx 10
> > >> > hours of processing so I was wondering if it is normal.
> > >> >
> > >> > My computer has an i7 core 2.10 GHz, 8GB RAM with Windows 7 Ultimate
> > >> OS. My
> > >> > code uses doSNOW package for parallel processing and all the 8
> cores, so
> > >> > the CPU is %100 all the time for the complete 10 hours.
> > >> >
> > >> > The data the backtest is done on is M5 OHLC FX (24 hour) data for
> > >> approx 1
> > >> > year  which makes a total of 58000 data points (counting OHLC as
> 1). The
> > >> > strategy has 4 entry&exit and 4 stoploss&trailingstoploss&takeprofit
> > >> rules.
> > >> > 144 combinations of parameters are tested.
> > >> >
> > >> > I would just like to know if this time is normal for just 1 home-use
> > >> > computer. And I would be grateful for any recommendations to speed
> up
> > >> this
> > >> > process to decrease computing time.
> > >>
> > >> No, this sounds very high.
> > >>
> > >> You haven't told us enough about what you're trying to do for anyone
> > >> here to help you in a specific way.  You'd need to provide a minimal
> > >> reproducible example.
> > >>
> > >> However, we typically use a benchmark time of one core minute per day
> > >> per instrument on tick data (millions of observations per day).
> > >>
> > >> Is seems likely that you are doing too much path dependent looping,
> > >> copying, or both.
> > >>
> > >> Regards,
> > >>
> > >> Brian
> > >>
> > >>
> > >
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
> >
>
>

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Apr  6 23:34:07 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 06 Apr 2016 16:34:07 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a single
 computer
In-Reply-To: <CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
Message-ID: <1459978447.7774.165.camel@brian-rcg>

On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> I will try running the same code without trailing stops and see what
> effect
> it has on the processing time. I will report back as soon as it is
> finished.

Running the macd demo code over 10 years of daily data on my machine (no
trailing stops) takes 0.5262365 secs for a single run.


From josh.m.ulrich at gmail.com  Thu Apr  7 01:48:51 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 6 Apr 2016 18:48:51 -0500
Subject: [R-SIG-Finance] GetOrders with Quantstrat
In-Reply-To: <CAPPM_gTi4kM63dmu4W=kET=jTOdPnpGWEphcyhVjy_-tmzk8EA@mail.gmail.com>
References: <CANf4qfhT8-BmzdCfVrb8FMOWaT-Ayi5pPOoMnPmD5hg5ePL9-w@mail.gmail.com>
	<CAPPM_gTi4kM63dmu4W=kET=jTOdPnpGWEphcyhVjy_-tmzk8EA@mail.gmail.com>
Message-ID: <CAPPM_gR2xzFMqL61_N6rQJci7URNH8D6aWaRVTbfx_PgJ4CD_w@mail.gmail.com>

Please keep messages on-list, so others may benefit.

On Wed, Apr 6, 2016 at 2:46 AM, Ryan Crawford <suchislife27 at gmail.com> wrote:
> Joshua thank you for your time - all your work is greatly appreciated.
>
> I'm not sure why the example strategy wouldn't run and my apologies, perhaps
> a Mac/PC issue, however I think I pinpointed the problem.
>
> Would it be likely that getOrders only works for a single symbol?
>
Yes, that's it exactly.  Thanks for this example, which made the issue clear.

I've committed a change (r1746) that throws a warning if
length(symbol) > 1, but proceeds with just the first element of the
symbol vector.

> When I try it using multiple symbols I get an error, however with only one
> symbol it works fine.
>
> I've attached a better example below to demonstrate.
>
> The error is:
>
> Error in getOrders(portfolio.st, symbols, status = "open") :
>   symbol STW.AX does not exist in portfolio RSI_Test having symbols
> BHP.AXsymbol BHP.AX does not exist in portfolio RSI_Test having symbols
> STW.AX
>
> Thanks again.
>
>
> require(quantstrat)
>
> # Suppresses warnings
> options("getSymbols.warning4.0" = FALSE)
>
> # Set the currency and the timezone
> currency('USD')
> Sys.setenv(TZ = "UTC")
>
> # Define symbols of interest - this leads to the error
> symbols <- c("STW.AX", "BHP.AX")
>
> # Using a single, getOrders works fine
> #symbols <- "STW.AX"
>
>
> #Get Symbols
> getSymbols(Symbols=symbols, from="2014-01-01", to="2016-04-04")
>
>
>
> ### Start ###
>
>
> # Define the instrument type
> stock(symbols, currency = "USD", multiplier = 1)
>
> #Boilerplate
> initDate = "1990-01-01"
> from = "2005-01-01"
> to = "2015-12-07"
>
>
> #trade sizing and initial equity settings
> tradeSize <- 100
> initEq <- 100000
>
> strategy.st <- portfolio.st <- account.st <- "RSI_Test"
> rm.strat(portfolio.st)
> rm.strat(strategy.st)
> initPortf(portfolio.st, symbols=symbols, initDate=initDate, currency='USD')
> initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
> currency='USD',initEq=initEq)
> initOrders(portfolio.st, initDate=initDate)
> strategy(strategy.st, store=TRUE)
>
> #parameters
> nRSI=2
> RSIentry=30
> RSIexit=70
>
> #Add Indicators
> add.indicator(strategy.st, name="RSI",
>               arguments=list(price=quote(Cl(mktdata)), n=nRSI),
>               label="rsi")
>
> #Add Entry and Exit Signals
> add.signal(strategy.st, name="sigThreshold",
>            arguments=list(column="rsi", threshold=RSIentry,
>                           relationship="lt", cross=FALSE),
>            label="longentry")
>
> add.signal(strategy.st, name="sigThreshold",
>            arguments=list(column="rsi", threshold=RSIexit,
>                           relationship="gt", cross=FALSE),
>            label="longexit")
>
> #enter signal rule
> add.rule(strategy.st, name="ruleSignal",
>          arguments=list(sigcol="longentry", sigval=TRUE, ordertype="market",
>                         orderside="long", replace=FALSE, prefer="Open",
> orderqty=tradeSize),
>          type="enter", path.dep=TRUE, label="enterlong")
>
> add.rule(strategy.st, name="ruleSignal",
>          arguments=list(sigcol="longexit", sigval=TRUE, ordertype="market",
>                         orderside="long", replace=FALSE, prefer="Open",
> orderqty="all"),
>          type="exit", path.dep=TRUE, label="exitlong")
>
> #take profit - I changed the parent to longentry from long
> add.rule(strategy.st, name="ruleSignal", arguments=list(sigcol="longentry",
>                                                         sigval=TRUE,
>                                                         ordertype="limit",
>                                                         orderside="long",
>                                                         replace=FALSE,
>                                                         orderqty="all",
>                                                         threshold=quote(.5),
>                                                         orderset="ocolong"),
>          type="chain",
>          parent="enterlong",
>          label="takeProfitLong",
>          path.dep=TRUE,
>          enable=TRUE)
>
>
>
> #stop loss
> add.rule(strategy.st, name="ruleSignal", arguments=list(sigcol="longentry",
>                                                         sigval=TRUE,
>
> ordertype="stoplimit",
>                                                         orderside="long",
>                                                         replace=FALSE,
>                                                         orderqty="all",
>                                                         threshold=quote(.1),
>                                                         orderset="ocolong"),
>          type="chain",
>          parent="enterlong",
>          label="stopLossLong",
>          path.dep=TRUE,
>          enable=TRUE)
>
> #apply strategy
> t1 <- Sys.time()
> out2 <- applyStrategy(strategy=strategy.st,portfolios=portfolio.st )
> t2 <- Sys.time()
> print(t2-t1)
>
> #getOrders
> oB <- getOrders(portfolio.st, symbols, status="open")
> View(oB)
>
> On Tue, Apr 5, 2016 at 7:48 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> wrote:
>>
>> On Tue, Apr 5, 2016 at 4:26 AM, Ryan Crawford <suchislife27 at gmail.com>
>> wrote:
>> > Hello
>> >
>> > I have been trying to view "open" orders from the orderbook in
>> > Quantstrat
>> > and keep running into the same error.
>> >
>> > It seems a reasonably simple process however the error I get is:
>> >
>> > oB <- getOrders(portfolio.st, symbols, status="open")
>> >
>> > Error in orderbook[[portfolio]][[symbol]] :
>> >   recursive indexing failed at level 2
>> >
>> > I've searched extensively and I can't seem to pinpoint the issue.
>> >
>> > Below is a reproducible example that generates the error.
>> >
>> > Thank you in advance for any help.
>> >
>> While reproducible, a strategy with 22 symbols isn't minimal.
>> Regardless, I ran your code, but no orders are created and lots of
>> warnings are generated by IKTrading function(s).
>>
>> I also get a different error when calling getOrders():
>> "Error in orderbook[[portfolio]][[symbol]] : no such index at level 2".
>> ...which is reasonable, given there are no orders.
>>
>> >
>> > require(quantstrat)
>> > require(IKTrading)
>> >
>> > # Set the currency and the timezone
>> > currency('USD')
>> > Sys.setenv(TZ = "UTC")
>> >
>> > # Define symbols of interest
>> > symbols <- c("AMP.AX", "BHP.AX", "ANZ.AX",
>> >              "CBA.AX", "BXB.AX", "CSL.AX", "IAG.AX",
>> >              "MQG.AX", "NAB.AX", "ORG.AX", "QBE.AX",
>> >              "RIO.AX", "SCG.AX", "SUN.AX", "TLS.AX",
>> >              "WBC.AX", "WES.AX", "WOW.AX", "WPL.AX",
>> >              "TCL.AX", "WFD.AX", "AMC.AX")
>> >
>> > #Get Symbols
>> > getSymbols(Symbols=symbols, from="2010-01-01", to="2016-04-04")
>> >
>> > # Define the instrument type
>> > stock(symbols, currency = "USD", multiplier = 1)
>> >
>> > #Boilerplate
>> > from = "2010-01-01"
>> > to = "2016-04-04"
>> >
>> > #trade sizing and initial equity settings
>> > tradeSize <- 2500
>> > initEq <- 100000
>> >
>> > strategy.st <- portfolio.st <- account.st <- "GetOrderBook"
>> > rm.strat(portfolio.st)
>> > rm.strat(strategy.st)
>> > initAcct(account.st, portfolio.st, currency='USD', initEq=initEq)
>> > initPortf(portfolio.st, symbols, currency='USD')
>> > initOrders(portfolio.st)
>> > strategy(strategy.st, store=TRUE)
>> >
>> > #Add Indicators
>> > add.indicator(strategy.st, name="SMA",
>> >               arguments=list(x=quote(Cl(mktdata)), n=20),
>> >               label="sma")
>> >
>> > #Add Entry and Exit Signals
>> > add.signal(strategy.st, name="sigComparison",
>> >            arguments=list(columns=c("Close", "SMA.20.sma"),
>> >                           relationship="gt"),
>> >            label="longentry")
>> >
>> > #enter signal rule
>> > add.rule(strategy.st, name="ruleSignal",
>> >          arguments=list(sigcol="longentry",
>> >                         sigval=TRUE,
>> >                         ordertype="limit",
>> >                         orderside="long",
>> >                         replace=TRUE,
>> >                         prefer="Close",
>> >                         tmult = TRUE,
>> >                         threshold = 0.05,
>> >                         time.in.force=172800,
>> >                         orderqty=tradeSize,
>> >                         osFUN=osMaxDollar,
>> >                         tradeSize=tradeSize,
>> >                         maxSize=tradeSize),
>> >          type="enter",
>> >          path.dep=TRUE,
>> >          label="enterlong")
>> >
>> > #stop loss.
>> > add.rule(strategy.st, name="ruleSignal",
>> >          arguments=list(sigcol="longentry",
>> >                         sigval=TRUE,
>> >                         ordertype="stoptrailing",
>> >                         orderside="long",
>> >                         replace=FALSE,
>> >                         orderqty="all",
>> >                         threshold=0.05,
>> >                         tmult=TRUE,
>> >                         orderset="ocolong"),
>> >          type="chain",
>> >          parent="enterlong",
>> >          label="stopLossLong",
>> >          path.dep=TRUE,
>> >          enable=TRUE)
>> >
>> > #apply strategy
>> > out2 <- applyStrategy(strategy=strategy.st,portfolios=portfolio.st )
>> >
>> > #get open orders
>> > oB <- getOrders(portfolio.st, symbols, status="open")
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-SIG-Finance at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > -- Also note that this is not the r-help list where general R questions
>> > should go.
>>
>>
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com
>> R/Finance 2016 | www.rinfinance.com
>
>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Thu Apr  7 02:57:25 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 6 Apr 2016 19:57:25 -0500
Subject: [R-SIG-Finance] rbind and duplicates in monthly futures
In-Reply-To: <CAHDRDJVocXEB0-EFvkq-BZp5R6pzg=bCbjxYGXhL5QwgDSNGPg@mail.gmail.com>
References: <CAHDRDJV9zhYMyf7_RPuF8LtXck4Zdx_P_C83xgKG3ZAWr76rSQ@mail.gmail.com>
	<CAPPM_gSJiiEdB09cOMPFf5xbKPoO_0NkpKzg7-RDmvehq2yaUA@mail.gmail.com>
	<CAHDRDJVocXEB0-EFvkq-BZp5R6pzg=bCbjxYGXhL5QwgDSNGPg@mail.gmail.com>
Message-ID: <CAPPM_gT3eN+1B1OZATkMXaYDQ1-YAQ2JERZJKHKvZy7LGs_=5Q@mail.gmail.com>

On Tue, Apr 5, 2016 at 3:06 PM, Peter Neumaier <peter.neumaier at gmail.com> wrote:
> Hi all, in the interim I've managed to import the halfhourly data, cast to a
> matrix, then rbind the two months
> and convert to XTS for later use by my algo strategy.
>
> I am wondering how the data overlap will be treated by the quantstrat
> framework and how
> it might be impacting the calculations (i.e. P&L during overlaps).
>
It wasn't clear to me from your original question, but I can now see
that you want to create a single continuous futures series using
adjacent futures contracts.  As you probably guessed, the overlap in
data in your APR_MAY object would be very bad.

There is not a single correct way to create a continuous futures
series for every futures market.  You could roll to the next contract
when the current contract expires, when volume or open interest in the
current contract drops below some threshold over the next contract's
volume or open interest, etc.

I realize this doesn't completely answer your question... because your
question is not just about programming.  It's also about the
microstructure of the market you're researching.  Searching for
"continuous futures" or "futures roll" should help give you some ideas
about how to solve the problem for this specific futures market.

> Below the files and the code I am using:
>
> APR <-
> as.matrix(read.zoo("NGF201404_6weeks30mins.csv",sep=",",tz="",header=T))
> MAY <-
> as.matrix(read.zoo("NGF201405_6weeks30mins.csv",sep=",",tz="",header=T))
>
> APR_MAY <- as.xts(rbind(APR,MAY))
>
>
> http://tempsend.com/BBA86DB4ED
>
> http://tempsend.com/0EDA07753B
>
> Thanks
> Peter
>
> On Mon, Apr 4, 2016 at 2:30 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> wrote:
>>
>> On Mon, Apr 4, 2016 at 7:24 AM, Peter Neumaier <peter.neumaier at gmail.com>
>> wrote:
>> > Hi all, I am trying to rbind monthly futures to a continuous time series
>> > to
>> > be run through an algo strategy. The problem here is that data is
>> > overlapping, i.e. my Feb contract trades for 6 weeks and when I rbind
>> > with
>> > my March data I get an overlap for last two weeks of Jan.
>> >
>> > How can I create a time series that is continuous, not overlapping and
>> > useable in quantstrat (i.e. XTS format)? I am not posting any code as it
>> > would be really one single rbind statement.
>> >
>> Even though the code may be simple, you still would be more likely to
>> receive help if you provide a minimal reproducible example of the
>> issue.  In this case, the data are not simple, and most people will
>> not take the time to construct sample data in order to attempt to
>> reproduce the issue you describe.
>>
>> > Thanks
>> > Peter
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-SIG-Finance at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > -- Also note that this is not the r-help list where general R questions
>> > should go.
>>
>>
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com
>> R/Finance 2016 | www.rinfinance.com
>
>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From jasonhart4 at icloud.com  Thu Apr  7 03:35:07 2016
From: jasonhart4 at icloud.com (Jason Hart)
Date: Thu, 07 Apr 2016 01:35:07 +0000 (GMT)
Subject: [R-SIG-Finance] Importing batch tickers from Bloomberg to R for
	Rblpapi use
Message-ID: <a9f19a97-1eab-433e-8514-fdbdc5264469@me.com>

Hi everyone - I'm new to the forum and there is a lot of great stuff in here, I can see the previous posts will keep me busy for a long time. ?I discovered the Rblpapi package not too long ago and was wondering if there is a way to import multiple tickers rather than typing them in manually. ?I plan on importing dozens to hundreds of tickers at a time and entering them in manually one at a time is prohibitive for time purposes. ?I tried to import the tickers from a CSV file but I get an error message that says "expecting a string vector". ?My coding is light years behind the group so apologies in advance for a softball question but here is the code I'm using. ?When I type in imp all of the tickers show up in the R console but they will not work with the bloomberg data requests. ??

imp <- read.csv("bloomberg.csv") 
###attempt to import tickers from excel
bdp(imp, c("PX_LAST", "VOLUME"))

Thanks,
Jason

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20160407/fd569d8d/attachment.html>

From n-e-w at qtradr.net  Thu Apr  7 05:17:28 2016
From: n-e-w at qtradr.net (Nick White)
Date: Thu, 7 Apr 2016 13:17:28 +1000
Subject: [R-SIG-Finance] Importing batch tickers from Bloomberg to R for
 Rblpapi use
In-Reply-To: <a9f19a97-1eab-433e-8514-fdbdc5264469@me.com>
References: <a9f19a97-1eab-433e-8514-fdbdc5264469@me.com>
Message-ID: <CAH+4RFtD3+Jv0Vnavk0jUAoYTtJjVDA2c3Hn15uRbhSLyWR5FA@mail.gmail.com>

Yes - this is very easy.

Do you get the error message when you run the bdp command or when you try
to run the read.csv command?

If it's after read.csv, can you supply an extract of the header row and?
the first row of tickers so we can see what your file looks like? How you
read in a csv is largely a function of how you've set it up.

Alternatively, you could just paste in the result of

str(imp)

if the read.csv command succeeds.

The default behavior of read.csv is to convert strings to factors in a data
frame. You want to preserve your tickers as characters, so typically you
need to specify something like:

imp <- read.csv("xyz.csv", stringsAsFactors=FALSE, headers = TRUE)

otherwise your frame of tickers will be of type factor rather than string

assuming you have some structure in the csv like:

row 1: |ticker|
           --------
row 2  |SPY US Equity|
           --------

I suspect (though Dirk et al could confirm) that you're getting the
'expecting a string vector' error as you're not passing a character vector
to bdp

	[[alternative HTML version deleted]]


From peter.neumaier at gmail.com  Thu Apr  7 13:25:28 2016
From: peter.neumaier at gmail.com (Peter Neumaier)
Date: Thu, 7 Apr 2016 12:25:28 +0100
Subject: [R-SIG-Finance] rbind and duplicates in monthly futures
In-Reply-To: <CAPPM_gT3eN+1B1OZATkMXaYDQ1-YAQ2JERZJKHKvZy7LGs_=5Q@mail.gmail.com>
References: <CAHDRDJV9zhYMyf7_RPuF8LtXck4Zdx_P_C83xgKG3ZAWr76rSQ@mail.gmail.com>
	<CAPPM_gSJiiEdB09cOMPFf5xbKPoO_0NkpKzg7-RDmvehq2yaUA@mail.gmail.com>
	<CAHDRDJVocXEB0-EFvkq-BZp5R6pzg=bCbjxYGXhL5QwgDSNGPg@mail.gmail.com>
	<CAPPM_gT3eN+1B1OZATkMXaYDQ1-YAQ2JERZJKHKvZy7LGs_=5Q@mail.gmail.com>
Message-ID: <CAHDRDJVqdw-z655pdZWs6HhC63ErczNJKcpgD3S_BdLpNUUDAg@mail.gmail.com>

I agree, I could have been more explicit about the nature of my problem and
the specific issue arising from the decision of
when/how to roll futures contracts.

However, I was hoping for a workaround within the quantstrat framework that
might help me. My research shows
that the last six weeks of my traded contract are the most liquid period
over lifetime. As a result, I end up wth an overlap of two
weeks, where in practical terms I would be trading two contracts: the
actual frontmonth and the following month.

Currently, I am backtesting each contract separately, ending up with
monthly output, which is not 100% satisfying as I'd like to
evaluate the yearly performance and not look into monthly output.

Is there a way to overcome the issue of overlapping periods, i.e. run the
data for the actual frontmonth (six weeks) and continue thereafter
with the overlap period, essentially forcing sequential execution of the
time series instead of merging the two months and mix
the data during the overlap period? I hope I am not confusing you further.

Thanks
Peter



On Thu, Apr 7, 2016 at 1:57 AM, Joshua Ulrich <josh.m.ulrich at gmail.com>
wrote:

> On Tue, Apr 5, 2016 at 3:06 PM, Peter Neumaier <peter.neumaier at gmail.com>
> wrote:
> > Hi all, in the interim I've managed to import the halfhourly data, cast
> to a
> > matrix, then rbind the two months
> > and convert to XTS for later use by my algo strategy.
> >
> > I am wondering how the data overlap will be treated by the quantstrat
> > framework and how
> > it might be impacting the calculations (i.e. P&L during overlaps).
> >
> It wasn't clear to me from your original question, but I can now see
> that you want to create a single continuous futures series using
> adjacent futures contracts.  As you probably guessed, the overlap in
> data in your APR_MAY object would be very bad.
>
> There is not a single correct way to create a continuous futures
> series for every futures market.  You could roll to the next contract
> when the current contract expires, when volume or open interest in the
> current contract drops below some threshold over the next contract's
> volume or open interest, etc.
>
> I realize this doesn't completely answer your question... because your
> question is not just about programming.  It's also about the
> microstructure of the market you're researching.  Searching for
> "continuous futures" or "futures roll" should help give you some ideas
> about how to solve the problem for this specific futures market.
>
> > Below the files and the code I am using:
> >
> > APR <-
> > as.matrix(read.zoo("NGF201404_6weeks30mins.csv",sep=",",tz="",header=T))
> > MAY <-
> > as.matrix(read.zoo("NGF201405_6weeks30mins.csv",sep=",",tz="",header=T))
> >
> > APR_MAY <- as.xts(rbind(APR,MAY))
> >
> >
> > http://tempsend.com/BBA86DB4ED
> >
> > http://tempsend.com/0EDA07753B
> >
> > Thanks
> > Peter
> >
> > On Mon, Apr 4, 2016 at 2:30 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> > wrote:
> >>
> >> On Mon, Apr 4, 2016 at 7:24 AM, Peter Neumaier <
> peter.neumaier at gmail.com>
> >> wrote:
> >> > Hi all, I am trying to rbind monthly futures to a continuous time
> series
> >> > to
> >> > be run through an algo strategy. The problem here is that data is
> >> > overlapping, i.e. my Feb contract trades for 6 weeks and when I rbind
> >> > with
> >> > my March data I get an overlap for last two weeks of Jan.
> >> >
> >> > How can I create a time series that is continuous, not overlapping and
> >> > useable in quantstrat (i.e. XTS format)? I am not posting any code as
> it
> >> > would be really one single rbind statement.
> >> >
> >> Even though the code may be simple, you still would be more likely to
> >> receive help if you provide a minimal reproducible example of the
> >> issue.  In this case, the data are not simple, and most people will
> >> not take the time to construct sample data in order to attempt to
> >> reproduce the issue you describe.
> >>
> >> > Thanks
> >> > Peter
> >> >
> >> >         [[alternative HTML version deleted]]
> >> >
> >> > _______________________________________________
> >> > R-SIG-Finance at r-project.org mailing list
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> > -- Subscriber-posting only. If you want to post, subscribe first.
> >> > -- Also note that this is not the r-help list where general R
> questions
> >> > should go.
> >>
> >>
> >>
> >> --
> >> Joshua Ulrich  |  about.me/joshuaulrich
> >> FOSS Trading  |  www.fosstrading.com
> >> R/Finance 2016 | www.rinfinance.com
> >
> >
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
>

	[[alternative HTML version deleted]]


From brian at braverock.com  Thu Apr  7 14:05:21 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Thu, 07 Apr 2016 07:05:21 -0500
Subject: [R-SIG-Finance] rbind and duplicates in monthly futures
In-Reply-To: <CAHDRDJVqdw-z655pdZWs6HhC63ErczNJKcpgD3S_BdLpNUUDAg@mail.gmail.com>
References: <CAHDRDJV9zhYMyf7_RPuF8LtXck4Zdx_P_C83xgKG3ZAWr76rSQ@mail.gmail.com>
	<CAPPM_gSJiiEdB09cOMPFf5xbKPoO_0NkpKzg7-RDmvehq2yaUA@mail.gmail.com>
	<CAHDRDJVocXEB0-EFvkq-BZp5R6pzg=bCbjxYGXhL5QwgDSNGPg@mail.gmail.com>
	<CAPPM_gT3eN+1B1OZATkMXaYDQ1-YAQ2JERZJKHKvZy7LGs_=5Q@mail.gmail.com>
	<CAHDRDJVqdw-z655pdZWs6HhC63ErczNJKcpgD3S_BdLpNUUDAg@mail.gmail.com>
Message-ID: <1460030721.7774.172.camel@brian-rcg>

You need to decide how you want to roll.  You're telling us that you'll
trade two contracts simultaneously.  That's different from all the
standard roll algorithms.  

You've confirmed what Josh told you by saying you don't want to create a
continuous series.

You should subset your data over the periods you want to trade before
calling quantstrat.  quantstrat loops over instruments, so it will trade
them when the data is available. 

I don't understand your query about summarizing results.  If they are
cash P&L recorded in the portfolio or account, they will be at whatever
frequency you market the portfolio at, typically at least daily.  You'll
probably pull then using something like dailyEqPL or dailyTxnPL or
dailyReturn or dailyStats.

You can summarize and display your results however you like, and there
are a host of tools in blotter for price/cash space and
PerformanceAnalytics for %-returns space.  Very few of them presume
monthly summaries except for the few standardized fund returns tables.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


On Thu, 2016-04-07 at 12:25 +0100, Peter Neumaier wrote:
> I agree, I could have been more explicit about the nature of my problem and
> the specific issue arising from the decision of
> when/how to roll futures contracts.
> 
> However, I was hoping for a workaround within the quantstrat framework that
> might help me. My research shows
> that the last six weeks of my traded contract are the most liquid period
> over lifetime. As a result, I end up wth an overlap of two
> weeks, where in practical terms I would be trading two contracts: the
> actual frontmonth and the following month.
> 
> Currently, I am backtesting each contract separately, ending up with
> monthly output, which is not 100% satisfying as I'd like to
> evaluate the yearly performance and not look into monthly output.
> 
> Is there a way to overcome the issue of overlapping periods, i.e. run the
> data for the actual frontmonth (six weeks) and continue thereafter
> with the overlap period, essentially forcing sequential execution of the
> time series instead of merging the two months and mix
> the data during the overlap period? I hope I am not confusing you further.
> 
> Thanks
> Peter
> 
> 
> 
> On Thu, Apr 7, 2016 at 1:57 AM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> wrote:
> 
> > On Tue, Apr 5, 2016 at 3:06 PM, Peter Neumaier <peter.neumaier at gmail.com>
> > wrote:
> > > Hi all, in the interim I've managed to import the halfhourly data, cast
> > to a
> > > matrix, then rbind the two months
> > > and convert to XTS for later use by my algo strategy.
> > >
> > > I am wondering how the data overlap will be treated by the quantstrat
> > > framework and how
> > > it might be impacting the calculations (i.e. P&L during overlaps).
> > >
> > It wasn't clear to me from your original question, but I can now see
> > that you want to create a single continuous futures series using
> > adjacent futures contracts.  As you probably guessed, the overlap in
> > data in your APR_MAY object would be very bad.
> >
> > There is not a single correct way to create a continuous futures
> > series for every futures market.  You could roll to the next contract
> > when the current contract expires, when volume or open interest in the
> > current contract drops below some threshold over the next contract's
> > volume or open interest, etc.
> >
> > I realize this doesn't completely answer your question... because your
> > question is not just about programming.  It's also about the
> > microstructure of the market you're researching.  Searching for
> > "continuous futures" or "futures roll" should help give you some ideas
> > about how to solve the problem for this specific futures market.
> >
> > > Below the files and the code I am using:
> > >
> > > APR <-
> > > as.matrix(read.zoo("NGF201404_6weeks30mins.csv",sep=",",tz="",header=T))
> > > MAY <-
> > > as.matrix(read.zoo("NGF201405_6weeks30mins.csv",sep=",",tz="",header=T))
> > >
> > > APR_MAY <- as.xts(rbind(APR,MAY))
> > >
> > >
> > > http://tempsend.com/BBA86DB4ED
> > >
> > > http://tempsend.com/0EDA07753B
> > >
> > > Thanks
> > > Peter
> > >
> > > On Mon, Apr 4, 2016 at 2:30 PM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> > > wrote:
> > >>
> > >> On Mon, Apr 4, 2016 at 7:24 AM, Peter Neumaier <
> > peter.neumaier at gmail.com>
> > >> wrote:
> > >> > Hi all, I am trying to rbind monthly futures to a continuous time
> > series
> > >> > to
> > >> > be run through an algo strategy. The problem here is that data is
> > >> > overlapping, i.e. my Feb contract trades for 6 weeks and when I rbind
> > >> > with
> > >> > my March data I get an overlap for last two weeks of Jan.
> > >> >
> > >> > How can I create a time series that is continuous, not overlapping and
> > >> > useable in quantstrat (i.e. XTS format)? I am not posting any code as
> > it
> > >> > would be really one single rbind statement.
> > >> >
> > >> Even though the code may be simple, you still would be more likely to
> > >> receive help if you provide a minimal reproducible example of the
> > >> issue.  In this case, the data are not simple, and most people will
> > >> not take the time to construct sample data in order to attempt to
> > >> reproduce the issue you describe.
> > >>
> > >> > Thanks
> > >> > Peter
> > >> >
> > >> >         [[alternative HTML version deleted]]
> > >> >
> > >> > _______________________________________________
> > >> > R-SIG-Finance at r-project.org mailing list
> > >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > >> > -- Subscriber-posting only. If you want to post, subscribe first.
> > >> > -- Also note that this is not the r-help list where general R
> > questions
> > >> > should go.
> > >>
> > >>
> > >>
> > >> --
> > >> Joshua Ulrich  |  about.me/joshuaulrich
> > >> FOSS Trading  |  www.fosstrading.com
> > >> R/Finance 2016 | www.rinfinance.com
> > >
> > >
> >
> >
> >
> > --
> > Joshua Ulrich  |  about.me/joshuaulrich
> > FOSS Trading  |  www.fosstrading.com
> > R/Finance 2016 | www.rinfinance.com
> >
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From jasonhart4 at icloud.com  Thu Apr  7 14:44:59 2016
From: jasonhart4 at icloud.com (Jason Hart)
Date: Thu, 07 Apr 2016 12:44:59 +0000 (GMT)
Subject: [R-SIG-Finance]
 =?utf-8?q?Importing_batch_tickers_from_Bloomberg_?=
 =?utf-8?q?to_R_for_Rblpapi_use?=
Message-ID: <9fe932b8-9ed8-40ac-bc4d-bd5e219aaba6@me.com>

Thanks for the response Nick. ?I tried your suggestions and can't seem to get this to work. ?I can pull in the tickers but the problem appears to be when it gets passed along to bdp where the tickers are not recognized. I pasted the tickers into excel and it starts in cell A1 and ends in A100. ?Here's a small sample of what it looks like ?




On Apr 06, 2016, at 08:17 PM, Nick White <n-e-w at qtradr.net> wrote:

Yes - this is very easy.?

Do you get the error message when you run the bdp command or when you try to run the read.csv command?

If it's after read.csv, can you supply an extract of the header row and? the first row of tickers so we can see what your file looks like? How you read in a csv is largely a function of how you've set it up.

Alternatively, you could just paste in the result of

str(imp)

if the read.csv command succeeds.

The default behavior of read.csv is to convert strings to factors in a data frame. You want to preserve your tickers as characters, so typically you need to specify something like:

imp <- read.csv("xyz.csv", stringsAsFactors=FALSE, headers = TRUE)

otherwise your frame of tickers will be of type factor rather than string

assuming you have some structure in the csv like:

row 1: |ticker|
? ? ? ? ? ?--------
row 2 ?|SPY US Equity|
? ? ? ? ? ?--------

I suspect (though Dirk et al could confirm) that you're getting the 'expecting a string vector' error as you're not passing a character vector to bdp




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20160407/3b850486/attachment.html>

From jerseyfanatic1 at gmail.com  Thu Apr  7 15:10:21 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Thu, 7 Apr 2016 16:10:21 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <1459978447.7774.165.camel@brian-rcg>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
Message-ID: <CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>

10 years of daily data makes about 2500 data points. So extrapolating from
that to 58000 data points (assuming the relation is linear), it should take
about 12.2 secs for a single run with my dataset. For 144 runs (total
number of parameter combinations), it should take about 30 mins. However, I
ran apply.paramset() this morning (without trailing stops), it took 4.5
hours. And the code is the one that I sent earlier with Trailing stop rules
enabled=FALSE'd.

Did you run the macd demo code with single core? If you did some parallel
processing, did you use doSNOW package or something else? Maybe that is the
reason, I am not sure.

Would deleting trailing stop rules speed things up, instead of defining
them but setting enabled=FALSE?

2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:

> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> > I will try running the same code without trailing stops and see what
> > effect
> > it has on the processing time. I will report back as soon as it is
> > finished.
>
> Running the macd demo code over 10 years of daily data on my machine (no
> trailing stops) takes 0.5262365 secs for a single run.
>
>
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Thu Apr  7 15:32:19 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 7 Apr 2016 08:32:19 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
Message-ID: <CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>

On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <jerseyfanatic1 at gmail.com> wrote:
> 10 years of daily data makes about 2500 data points. So extrapolating from
> that to 58000 data points (assuming the relation is linear), it should take

Number of data points is not necessarily a good estimator for run time
even if the strategies are the same.  What matters more is the number
of timestamps/observations that must be evaluated.  That includes
signals, moving orders, processing fills, etc.

> about 12.2 secs for a single run with my dataset. For 144 runs (total
> number of parameter combinations), it should take about 30 mins. However, I

Again, the relationship is not linear.  Different parameter
combinations will produce differing amounts of signals, order
movement, fills, etc.

For example, I ran parameter optimization on ~3 years of 5-second
data.  Some parameter combinations took 1-2 minutes, some took >20
minutes.

> ran apply.paramset() this morning (without trailing stops), it took 4.5
> hours. And the code is the one that I sent earlier with Trailing stop rules
> enabled=FALSE'd.
>
> Did you run the macd demo code with single core? If you did some parallel
> processing, did you use doSNOW package or something else? Maybe that is the
> reason, I am not sure.
>
> Would deleting trailing stop rules speed things up, instead of defining
> them but setting enabled=FALSE?
>
> 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
>
>> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
>> > I will try running the same code without trailing stops and see what
>> > effect
>> > it has on the processing time. I will report back as soon as it is
>> > finished.
>>
>> Running the macd demo code over 10 years of daily data on my machine (no
>> trailing stops) takes 0.5262365 secs for a single run.
>>
>>
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From jerseyfanatic1 at gmail.com  Thu Apr  7 18:30:08 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Thu, 7 Apr 2016 19:30:08 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
Message-ID: <CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>

Thanks for the insight. I did not know variations in processing time of 20
minutes or so could happen between different parameter combinations.

I ran the strategy with the same dataset with random parameters without
Trailing SL, on single core and it took 5.15 minutes. The number of
transactions were 7800. The amount of processing time seems too much
compared to yours though. 5sec data of 3 years vs M5 data of just 1 year;
20 min vs 5 mins.

2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:

> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <jerseyfanatic1 at gmail.com>
> wrote:
> > 10 years of daily data makes about 2500 data points. So extrapolating
> from
> > that to 58000 data points (assuming the relation is linear), it should
> take
>
> Number of data points is not necessarily a good estimator for run time
> even if the strategies are the same.  What matters more is the number
> of timestamps/observations that must be evaluated.  That includes
> signals, moving orders, processing fills, etc.
>
> > about 12.2 secs for a single run with my dataset. For 144 runs (total
> > number of parameter combinations), it should take about 30 mins.
> However, I
>
> Again, the relationship is not linear.  Different parameter
> combinations will produce differing amounts of signals, order
> movement, fills, etc.
>
> For example, I ran parameter optimization on ~3 years of 5-second
> data.  Some parameter combinations took 1-2 minutes, some took >20
> minutes.
>
> > ran apply.paramset() this morning (without trailing stops), it took 4.5
> > hours. And the code is the one that I sent earlier with Trailing stop
> rules
> > enabled=FALSE'd.
> >
> > Did you run the macd demo code with single core? If you did some parallel
> > processing, did you use doSNOW package or something else? Maybe that is
> the
> > reason, I am not sure.
> >
> > Would deleting trailing stop rules speed things up, instead of defining
> > them but setting enabled=FALSE?
> >
> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
> >
> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> >> > I will try running the same code without trailing stops and see what
> >> > effect
> >> > it has on the processing time. I will report back as soon as it is
> >> > finished.
> >>
> >> Running the macd demo code over 10 years of daily data on my machine (no
> >> trailing stops) takes 0.5262365 secs for a single run.
> >>
> >>
> >>
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
>

	[[alternative HTML version deleted]]


From jerseyfanatic1 at gmail.com  Thu Apr  7 18:33:44 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Thu, 7 Apr 2016 19:33:44 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <8C841E9FC08E374BA235324BBFEA323B15724F@NLDNC501PN2.UBSPROD.MSAD.UBS.NET>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<8C841E9FC08E374BA235324BBFEA323B15724F@NLDNC501PN2.UBSPROD.MSAD.UBS.NET>
Message-ID: <CAC_=oyOKhwY7OZFkQP_6q4g5VMtMAEOLK9m=eYup+O6sJzdGyA@mail.gmail.com>

Thanks Mr. Jessop for the recommendation of papers. I am familiar of
backtest overfitting and the works of Mr.Prado and Mr.Bailey. I implemented
an idea (Probability of Backtest Overfitting) from one of their papers
recently into my methodology recently to prevent overfitting. I am just
trying to figure out whether something is wrong in my code that increases
backtesting time significantly or the amount it takes is just normal with
the resources I've got.

2016-04-07 17:50 GMT+03:00 <david.jessop at ubs.com>:

> Hi
>
> Just to add to Brian's comment on "economic justification", see David
> Bailey / de Prado's sequence of papers (e.g.
> http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2460551 or
> http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2308659 , the latter
> is probably better) on the perils of overfitting parameters.  Summarising
> the paper, if you run just 100 backtests and optimise the parameters on a
> strategy with a true Sharpe ratio of zero then the best one will have on
> average an apparent Sharpe of 2.5.
>
> Regards
>
> David
>
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On
> Behalf Of Brian G. Peterson
> Sent: 06 April 2016 21:49
> To: Jersey Fanatic
> Cc: r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] Processing time of backtests on a single
> computer
>
> You didn't say that you were doing parameter optimization.
>
> The length of time that a parameter optimization using brute force will
> take is a linear combination of the number of parameter combinations that
> you choose to search.
>
> Typically, you should only include parameter distributions for parameters
> for which you feel you have a strong economic justification.
> Your strategy contains eight parameter distributions and two constraints.
> The choices of these distributions appears arbitrary, and will result in
> hundreds of combinations to test.  So, you should expect your strategy to
> take approximately a linear combination of additional time based on the
> number of parameters you wish to test.
>
> Another thing that will make this test take a long time is the inclusion
> of trailing stops.  As is described in the documentation, trailing stops
> require evaluating the strategy at more points in the path dependent loop.
> The number of observations that need to be evaluated in the path dependent
> rules loop has another linear effect on the time to evaluate your
> backtest.  Have you validated that there is a theoretical justification for
> a trailing stop?  Does this increase the positive expectation of your
> resulting signal process?
>
> Most of the validation of your indicator and signal processes should be
> possible long before you get to parameter optimization.
>
> Regards,
>
> Brian
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>
> On Wed, 2016-04-06 at 23:20 +0300, Jersey Fanatic wrote:
> > The email with the CSV data attached is waiting for moderator's approval.
> > The reproducible code is below.
> >
> >
> > 2016-04-06 23:17 GMT+03:00 Jersey Fanatic <jerseyfanatic1 at gmail.com>:
> >
> > > Thanks for the quick reply. I did not understand what you meant by path
> > > dependent looping or copying, but my aim is to decrease the processing
> time
> > > of the backtesting of several combinations of parameters.
> > >
> > > Here is the reproducible example, and the data I am using is attached
> as
> > > well:
> > >
> > > library(lattice)
> > > library(foreach)
> > > library(doSNOW)
> > > library(ggplot2)
> > > library(PerformanceAnalytics)
> > > library(doSNOW)
> > > require(latticeExtra)
> > > require(grid)
> > > library(gridExtra)
> > > library(reshape)
> > > library(quantstrat)
> > > no.cores <- 8
> > >
> > > .strategy<- new.env()
> > > .blotter<- new.env()
> > >
> > > currency(c('USD', 'EUR'))
> > > exchange_rate(primary_id="EURUSD", tick_size=0.0001)
> > >
> > > data.location.r <- "processingtime_q_rsigfinance.csv"
> > > symbol.data <- as.xts(read.zoo(data.location.r, sep=',',
> > > tz="",header=TRUE, format='%d/%m/%Y %H:%M', index.column = 1))
> > > symbol.data <- symbol.data[symbol.data$VOLUME!=0,]
> > >                                    # Delete rows with no volume (when
> the
> > > market is closed)
> > > symbol.data[,c(1,2,3,4)] <-
> > > round(as.numeric(symbol.data[,c(1,2,3,4)]),abs(log10(0.0001))) #datay?
> tick
> > > sizela uyumlu yapma
> > > assign("EURUSD", symbol.data)
> > >
> > > strategy.st <- "rsigfinance"
> > > rm.strat(strategy.st)
> > >
> > >
> > > initDate = as.character(as.Date(index(symbol.data[1])-1))
> > >
> > > initPortf(strategy.st, "EURUSD", initDate=initDate, currency = "USD")
> > > initAcct(strategy.st, portfolios=strategy.st, initDate=initDate,
> > > initEq=100000, currency = "USD")
> > > initOrders(portfolio=strategy.st,initDate=initDate)
> > >
> > > strategy(strategy.st,store=TRUE)
> > > summary(getStrategy(strategy.st))
> > >
> > >
> > > macdFastMARange <- seq(2,17,by=5)
> > > macdSlowMARange <- seq(5,35,by=10)
> > > macdSignalRange <- seq(2,18,by=8)
> > >
> > > StopLossDistanceRange <- seq(0.01,0.02,by=0.01)
> > >
> > > TrailingDistanceRange <- seq(0.01,0.02,by=0.01)
> > >
> > >
> > > positionSizeLong  =    round(100000 /
> as.numeric(symbol.data$CLOSE[1]),-2)
> > > positionSizeShort =  - round(100000 /
> as.numeric(symbol.data$CLOSE[1]),-2)
> > > txn.model <- 0
> > > sltsltp.txn.fee <- 0
> > >
> > >
> > > add.indicator(strategy.st,
> > >               name = "MACD",
> > >               arguments = list(x=Cl(eval(parse(text = "EURUSD")))),
> > >               label='macd')
> > >
> > > add.signal(strategy.st,name="sigCrossover",
> > >            arguments =
> > > list(columns=c("macd.macd","signal.macd"),relationship="gt"),
> > >            label="macd.gt.signal")
> > >
> > > add.signal(strategy.st,name="sigCrossover",
> > >            arguments =
> > > list(columns=c("macd.macd","signal.macd"),relationship="lt"),
> > >            label="macd.lt.signal")
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.gt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty= positionSizeLong,
> > >                           ordertype='market',
> > >                           orderside='long',
> > >                           orderset='ocolong',
> > >                           TxnFees = txn.model),
> > >          type='enter',
> > >          label='longenter',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.lt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty='all',
> > >                           ordertype='market',
> > >                           orderside='long',
> > >                           orderset='ocolong',
> > >                           TxnFees = txn.model),
> > >          type='exit',
> > >          label='longexit',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,name='ruleSignal',
> > >          arguments = list( sigcol="macd.lt.signal", sigval=TRUE,
> > >                            replace=FALSE,
> > >                            orderside='long',
> > >                            ordertype='stoplimit',
> > >                            tmult=TRUE,
> > >                            threshold=quote( longStopLossDistance ),
> > >                            orderqty='all',
> > >                            orderset='ocolong',
> > >                            TxnFees = txn.model),
> > >          type='chain', parent="longenter",
> > >          label='StopLossLong',
> > >          enabled=TRUE)
> > >
> > > add.rule(strategy.st, name = 'ruleSignal',
> > >          arguments=list(sigcol="macd.lt.signal" , sigval=TRUE,
> > >                         replace=FALSE,
> > >                         orderside='long',
> > >                         ordertype='stoptrailing',
> > >                         tmult=TRUE,
> > >                         threshold=quote(longTrailingStopDistance),
> > >                         orderqty='all',
> > >                         orderset='ocolong',
> > >                         TxnFees = txn.model),
> > >          type='chain', parent="longenter",
> > >          label='StopTrailingLong',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st, name = "ruleSignal",
> > >          arguments = list(sigcol="macd.lt.signal",
> > >                           sigval=TRUE,
> > >                           ordertype="limit",
> > >                           orderside="long",
> > >                           replace=FALSE,
> > >                           tmult=TRUE,
> > >                           threshold=quote(longTakeProfitDistance),
> > >                           orderqty="all",
> > >                           orderset="ocolong",
> > >                           TxnFees = txn.model),
> > >          type = "chain", parent="longenter",
> > >          label = "takeProfitLong",
> > >          enabled = FALSE
> > > )
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.lt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty=positionSizeShort,
> > >                           ordertype='market',
> > >                           orderside='short',
> > >                           orderset='ocoshort',
> > >                           TxnFees = txn.model),
> > >          type='enter',
> > >          label='shortenter',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,
> > >          name='ruleSignal',
> > >          arguments = list(sigcol="macd.gt.signal",
> > >                           sigval=TRUE,
> > >                           prefer="Open",
> > >                           orderqty='all',
> > >                           ordertype='market',
> > >                           orderside='short',
> > >                           orderset='ocoshort',
> > >                           TxnFees = txn.model),
> > >          type='exit',
> > >          label='shortexit',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st,name='ruleSignal',
> > >          arguments = list( sigcol="macd.gt.signal", sigval=TRUE,
> > >                            replace=FALSE,
> > >                            orderside='short',
> > >                            ordertype='stoplimit',
> > >                            tmult=TRUE,
> > >                            threshold=quote( shortStopLossDistance ),
> > >                            orderqty='all',
> > >                            orderset='ocoshort',
> > >                            TxnFees = txn.model),
> > >          type='chain', parent="shortenter",
> > >          label='StopLossShort',
> > >          enabled=TRUE)
> > >
> > > add.rule(strategy.st, name = 'ruleSignal',
> > >          arguments=list(sigcol="macd.gt.signal" , sigval=TRUE,
> > >                         replace=FALSE,
> > >                         orderside='short',
> > >                         ordertype='stoptrailing',
> > >                         tmult=TRUE,
> > >                         threshold=quote( shortTrailingStopDistance),
> > >                         orderqty='all',
> > >                         orderset='ocoshort',
> > >                         TxnFees = txn.model),
> > >          type='chain', parent="shortenter",
> > >          label='StopTrailingShort',
> > >          enabled=TRUE
> > > )
> > >
> > > add.rule(strategy.st, name = "ruleSignal",
> > >          arguments = list(sigcol="macd.gt.signal",
> > >                           sigval=TRUE,
> > >                           ordertype="limit",
> > >                           orderside="short",
> > >                           replace=FALSE,
> > >                           tmult=TRUE,
> > >                           threshold=quote( -shortTakeProfitDistance),
> > >                           orderqty="all",
> > >                           orderset="ocoshort",
> > >                           TxnFees = txn.model),
> > >          type = "chain", parent="shortenter",
> > >          label = "takeProfitShort",
> > >          enabled = FALSE
> > > )
> > >
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = 'indicator',
> > >                  component.label = "macd",
> > >                  variable = list( nFast = macdFastMARange ),
> > >                  label = "macdFastMARANGE")
> > >
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = 'indicator',
> > >                  component.label = "macd",
> > >                  variable = list( nSlow = macdSlowMARange ),
> > >                  label = "macdSlowMARANGE")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = 'indicator',
> > >                  component.label = "macd",
> > >                  variable = list( nSig = macdSignalRange ),
> > >                  label = "macdSignalRANGE")
> > >
> > > add.distribution.constraint(strategy.st,
> > >                             paramset.label = 'MACD_OPT',
> > >                             distribution.label.1 = 'macdFastMARANGE',
> > >                             distribution.label.2 = 'macdSlowMARANGE',
> > >                             operator = '<',
> > >                             label = 'FastMA<SlowMA')
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopLossLong",
> > >                  variable = list( threshold = StopLossDistanceRange ),
> > >                  label = "StopLossLONG")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopTrailingLong",
> > >                  variable = list( threshold = TrailingDistanceRange ),
> > >                  label = "StopTrailingLONG")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopLossShort",
> > >                  variable = list( threshold = StopLossDistanceRange ),
> > >                  label = "StopLossSHORT")
> > >
> > > add.distribution(strategy.st,
> > >                  paramset.label = "MACD_OPT",
> > >                  component.type = "chain",
> > >                  component.label = "StopTrailingShort",
> > >                  variable = list( threshold = TrailingDistanceRange ),
> > >                  label = "StopTrailingSHORT")
> > >
> > > add.distribution.constraint(strategy.st,
> > >                             paramset.label = "MACD_OPT",
> > >                             distribution.label.1 = "StopLossLONG",
> > >                             distribution.label.2 = "StopLossSHORT",
> > >                             operator = "==",
> > >                             label = "StoplossEquality")
> > >
> > > add.distribution.constraint(strategy.st,
> > >                             paramset.label = "MACD_OPT",
> > >                             distribution.label.1 = "StopTrailingLONG",
> > >                             distribution.label.2 = "StopTrailingSHORT",
> > >                             operator = "==",
> > >                             label = "TrailingStopEquality")
> > >
> > > summary(getStrategy(strategy.st))
> > >
> > >
> > >
> > > start.t <- Sys.time()
> > > paramsetenv<-new.env()
> > > cl <- snow::makeCluster(no.cores, type = "SOCK")
> > > registerDoSNOW(cl)
> > > results <- apply.paramset(strategy.st,paramset.label="MACD_OPT",
> > >                           portfolio=strategy.st, account=strategy.st
> ,nsamples=0,verbose
> > > = FALSE,
> > >                           audit=paramsetenv)
> > > snow::stopCluster(cl)
> > > finish.t <- Sys.time()
> > > print(finish.t-start.t)
> > >
> > >
> > >
> > >
> > >
> > > If there are any problems with the code when reproducing, sorry. I ran
> it
> > > on my computer and it did seem to work as it did normally.
> > >
> > >
> > >
> > > 2016-04-06 21:05 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
> > >
> > >> On Wed, 2016-04-06 at 20:58 +0300, Jersey Fanatic wrote:
> > >> > Hi everyone,
> > >> >
> > >> > I am trying to backtest a simple strategy of mine, but it took
> approx 10
> > >> > hours of processing so I was wondering if it is normal.
> > >> >
> > >> > My computer has an i7 core 2.10 GHz, 8GB RAM with Windows 7 Ultimate
> > >> OS. My
> > >> > code uses doSNOW package for parallel processing and all the 8
> cores, so
> > >> > the CPU is %100 all the time for the complete 10 hours.
> > >> >
> > >> > The data the backtest is done on is M5 OHLC FX (24 hour) data for
> > >> approx 1
> > >> > year  which makes a total of 58000 data points (counting OHLC as
> 1). The
> > >> > strategy has 4 entry&exit and 4 stoploss&trailingstoploss&takeprofit
> > >> rules.
> > >> > 144 combinations of parameters are tested.
> > >> >
> > >> > I would just like to know if this time is normal for just 1 home-use
> > >> > computer. And I would be grateful for any recommendations to speed
> up
> > >> this
> > >> > process to decrease computing time.
> > >>
> > >> No, this sounds very high.
> > >>
> > >> You haven't told us enough about what you're trying to do for anyone
> > >> here to help you in a specific way.  You'd need to provide a minimal
> > >> reproducible example.
> > >>
> > >> However, we typically use a benchmark time of one core minute per day
> > >> per instrument on tick data (millions of observations per day).
> > >>
> > >> Is seems likely that you are doing too much path dependent looping,
> > >> copying, or both.
> > >>
> > >> Regards,
> > >>
> > >> Brian
> > >>
> > >>
> > >
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
> >
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
> Visit our website at http://www.ubs.com
>
> This message contains confidential information and is intended only
> for the individual named. If you are not the named addressee you
> should not disseminate, distribute or copy this e-mail. Please
> notify the sender immediately by e-mail if you have received this
> e-mail by mistake and delete this e-mail from your system.
>
> E-mails are not encrypted and cannot be guaranteed to be secure or
> error-free as information could be intercepted, corrupted, lost,
> destroyed, arrive late or incomplete, or contain viruses. The sender
> therefore does not accept liability for any errors or omissions in the
> contents of this message which arise as a result of e-mail transmission.
> If verification is required please request a hard-copy version. This
> message is provided for informational purposes and should not be
> construed as a solicitation or offer to buy or sell any securities
> or related financial instruments.
>
> UBS Limited is a company limited by shares incorporated in the United
> Kingdom registered in England and Wales with number 2035362.
> Registered Office: 1 Finsbury Avenue, London EC2M 2PP
> UBS Limited is authorised by the Prudential Regulation Authority
> and regulated by the Financial Conduct Authority and the Prudential
> Regulation Authority.
>
> UBS AG is a public company incorporated with limited liability in
> Switzerland domiciled in the Canton of Basel-City and the Canton of
> Zurich respectively registered at the Commercial Registry offices in
> those Cantons with new Identification No: CHE-101.329.561 as from 18
> December 2013 (and prior to 18 December 2013 with Identification
> No: CH-270.3.004.646-4) and having respective head offices at
> Aeschenvorstadt 1, 4051 Basel and Bahnhofstrasse 45, 8001 Zurich,
> Switzerland and is authorised and regulated by the Financial Market
> Supervisory Authority in Switzerland.  Registered in the United
> Kingdom as a foreign company with No: FC021146 and having a UK
> Establishment registered at Companies House, Cardiff, with
> No: BR 004507.  The principal office of UK Establishment: 1 Finsbury
> Avenue, London EC2M 2PP.  In the United Kingdom, UBS AG is authorised
> by the Prudential Regulation Authority and subject to regulation
> by the Financial Conduct Authority and limited regulation by the
> Prudential Regulation Authority.  Details about the extent of our
> regulation by the Prudential Regulation Authority are available
> from us on request.
>
> UBS reserves the right to retain all messages. Messages are protected
> and accessed only in legally justified cases.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Thu Apr  7 19:45:57 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 7 Apr 2016 12:45:57 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
Message-ID: <CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>

On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
<jerseyfanatic1 at gmail.com> wrote:
> Thanks for the insight. I did not know variations in processing time of 20
> minutes or so could happen between different parameter combinations.
>
> I ran the strategy with the same dataset with random parameters without
> Trailing SL, on single core and it took 5.15 minutes. The number of
> transactions were 7800. The amount of processing time seems too much
> compared to yours though. 5sec data of 3 years vs M5 data of just 1 year; 20
> min vs 5 mins.
>
Again, the number of observations is not a good predictor of the
amount of time it will take.  You have 7800 transactions.  My shortest
(longest) run had 25 (1500) transactions.

Seems reasonable to me that a strategy producing nearly 8000
transactions takes about 5 minutes; that's about 25 transactions a
second.

> 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>>
>> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <jerseyfanatic1 at gmail.com>
>> wrote:
>> > 10 years of daily data makes about 2500 data points. So extrapolating
>> > from
>> > that to 58000 data points (assuming the relation is linear), it should
>> > take
>>
>> Number of data points is not necessarily a good estimator for run time
>> even if the strategies are the same.  What matters more is the number
>> of timestamps/observations that must be evaluated.  That includes
>> signals, moving orders, processing fills, etc.
>>
>> > about 12.2 secs for a single run with my dataset. For 144 runs (total
>> > number of parameter combinations), it should take about 30 mins.
>> > However, I
>>
>> Again, the relationship is not linear.  Different parameter
>> combinations will produce differing amounts of signals, order
>> movement, fills, etc.
>>
>> For example, I ran parameter optimization on ~3 years of 5-second
>> data.  Some parameter combinations took 1-2 minutes, some took >20
>> minutes.
>>
>> > ran apply.paramset() this morning (without trailing stops), it took 4.5
>> > hours. And the code is the one that I sent earlier with Trailing stop
>> > rules
>> > enabled=FALSE'd.
>> >
>> > Did you run the macd demo code with single core? If you did some
>> > parallel
>> > processing, did you use doSNOW package or something else? Maybe that is
>> > the
>> > reason, I am not sure.
>> >
>> > Would deleting trailing stop rules speed things up, instead of defining
>> > them but setting enabled=FALSE?
>> >
>> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
>> >
>> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
>> >> > I will try running the same code without trailing stops and see what
>> >> > effect
>> >> > it has on the processing time. I will report back as soon as it is
>> >> > finished.
>> >>
>> >> Running the macd demo code over 10 years of daily data on my machine
>> >> (no
>> >> trailing stops) takes 0.5262365 secs for a single run.
>> >>
>> >>
>> >>
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-SIG-Finance at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > -- Also note that this is not the r-help list where general R questions
>> > should go.
>>
>>
>>
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich
>> FOSS Trading  |  www.fosstrading.com
>> R/Finance 2016 | www.rinfinance.com
>
>



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From jerseyfanatic1 at gmail.com  Thu Apr  7 20:41:53 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Thu, 7 Apr 2016 21:41:53 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
Message-ID: <CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com>

So I tried to see what effect trailing stop and stop loss rules have on the
processing time. For the same dataset, only SL took 5 mins while only
trailing SL took 10 mins, and trailing SL with normal SL took 13 mins. I
guess it is processing it as fast as it should be. Thanks for all the help.

2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:

> On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
> <jerseyfanatic1 at gmail.com> wrote:
> > Thanks for the insight. I did not know variations in processing time of
> 20
> > minutes or so could happen between different parameter combinations.
> >
> > I ran the strategy with the same dataset with random parameters without
> > Trailing SL, on single core and it took 5.15 minutes. The number of
> > transactions were 7800. The amount of processing time seems too much
> > compared to yours though. 5sec data of 3 years vs M5 data of just 1
> year; 20
> > min vs 5 mins.
> >
> Again, the number of observations is not a good predictor of the
> amount of time it will take.  You have 7800 transactions.  My shortest
> (longest) run had 25 (1500) transactions.
>
> Seems reasonable to me that a strategy producing nearly 8000
> transactions takes about 5 minutes; that's about 25 transactions a
> second.
>
> > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
> >>
> >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
> jerseyfanatic1 at gmail.com>
> >> wrote:
> >> > 10 years of daily data makes about 2500 data points. So extrapolating
> >> > from
> >> > that to 58000 data points (assuming the relation is linear), it should
> >> > take
> >>
> >> Number of data points is not necessarily a good estimator for run time
> >> even if the strategies are the same.  What matters more is the number
> >> of timestamps/observations that must be evaluated.  That includes
> >> signals, moving orders, processing fills, etc.
> >>
> >> > about 12.2 secs for a single run with my dataset. For 144 runs (total
> >> > number of parameter combinations), it should take about 30 mins.
> >> > However, I
> >>
> >> Again, the relationship is not linear.  Different parameter
> >> combinations will produce differing amounts of signals, order
> >> movement, fills, etc.
> >>
> >> For example, I ran parameter optimization on ~3 years of 5-second
> >> data.  Some parameter combinations took 1-2 minutes, some took >20
> >> minutes.
> >>
> >> > ran apply.paramset() this morning (without trailing stops), it took
> 4.5
> >> > hours. And the code is the one that I sent earlier with Trailing stop
> >> > rules
> >> > enabled=FALSE'd.
> >> >
> >> > Did you run the macd demo code with single core? If you did some
> >> > parallel
> >> > processing, did you use doSNOW package or something else? Maybe that
> is
> >> > the
> >> > reason, I am not sure.
> >> >
> >> > Would deleting trailing stop rules speed things up, instead of
> defining
> >> > them but setting enabled=FALSE?
> >> >
> >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
> >> >
> >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> >> >> > I will try running the same code without trailing stops and see
> what
> >> >> > effect
> >> >> > it has on the processing time. I will report back as soon as it is
> >> >> > finished.
> >> >>
> >> >> Running the macd demo code over 10 years of daily data on my machine
> >> >> (no
> >> >> trailing stops) takes 0.5262365 secs for a single run.
> >> >>
> >> >>
> >> >>
> >> >
> >> >         [[alternative HTML version deleted]]
> >> >
> >> > _______________________________________________
> >> > R-SIG-Finance at r-project.org mailing list
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> > -- Subscriber-posting only. If you want to post, subscribe first.
> >> > -- Also note that this is not the r-help list where general R
> questions
> >> > should go.
> >>
> >>
> >>
> >> --
> >> Joshua Ulrich  |  about.me/joshuaulrich
> >> FOSS Trading  |  www.fosstrading.com
> >> R/Finance 2016 | www.rinfinance.com
> >
> >
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
>

	[[alternative HTML version deleted]]


From erol.biceroglu at alumni.utoronto.ca  Thu Apr  7 22:23:15 2016
From: erol.biceroglu at alumni.utoronto.ca (Erol Biceroglu)
Date: Thu, 7 Apr 2016 16:23:15 -0400
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com>
Message-ID: <CACjNfmk7U=5HLnh7VyNHasC_7A9gH8+xwuvuLGuF_b2af_a4Wg@mail.gmail.com>

Hello,

Only thing I can think of that might make it take longer, that affected me
in the past, is RAM, especially in Windows.  Is it maxing out at all?

On Thursday, April 7, 2016, Jersey Fanatic <jerseyfanatic1 at gmail.com> wrote:

> So I tried to see what effect trailing stop and stop loss rules have on the
> processing time. For the same dataset, only SL took 5 mins while only
> trailing SL took 10 mins, and trailing SL with normal SL took 13 mins. I
> guess it is processing it as fast as it should be. Thanks for all the help.
>
> 2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com
> <javascript:;>>:
>
> > On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
> > <jerseyfanatic1 at gmail.com <javascript:;>> wrote:
> > > Thanks for the insight. I did not know variations in processing time of
> > 20
> > > minutes or so could happen between different parameter combinations.
> > >
> > > I ran the strategy with the same dataset with random parameters without
> > > Trailing SL, on single core and it took 5.15 minutes. The number of
> > > transactions were 7800. The amount of processing time seems too much
> > > compared to yours though. 5sec data of 3 years vs M5 data of just 1
> > year; 20
> > > min vs 5 mins.
> > >
> > Again, the number of observations is not a good predictor of the
> > amount of time it will take.  You have 7800 transactions.  My shortest
> > (longest) run had 25 (1500) transactions.
> >
> > Seems reasonable to me that a strategy producing nearly 8000
> > transactions takes about 5 minutes; that's about 25 transactions a
> > second.
> >
> > > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com
> <javascript:;>>:
> > >>
> > >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
> > jerseyfanatic1 at gmail.com <javascript:;>>
> > >> wrote:
> > >> > 10 years of daily data makes about 2500 data points. So
> extrapolating
> > >> > from
> > >> > that to 58000 data points (assuming the relation is linear), it
> should
> > >> > take
> > >>
> > >> Number of data points is not necessarily a good estimator for run time
> > >> even if the strategies are the same.  What matters more is the number
> > >> of timestamps/observations that must be evaluated.  That includes
> > >> signals, moving orders, processing fills, etc.
> > >>
> > >> > about 12.2 secs for a single run with my dataset. For 144 runs
> (total
> > >> > number of parameter combinations), it should take about 30 mins.
> > >> > However, I
> > >>
> > >> Again, the relationship is not linear.  Different parameter
> > >> combinations will produce differing amounts of signals, order
> > >> movement, fills, etc.
> > >>
> > >> For example, I ran parameter optimization on ~3 years of 5-second
> > >> data.  Some parameter combinations took 1-2 minutes, some took >20
> > >> minutes.
> > >>
> > >> > ran apply.paramset() this morning (without trailing stops), it took
> > 4.5
> > >> > hours. And the code is the one that I sent earlier with Trailing
> stop
> > >> > rules
> > >> > enabled=FALSE'd.
> > >> >
> > >> > Did you run the macd demo code with single core? If you did some
> > >> > parallel
> > >> > processing, did you use doSNOW package or something else? Maybe that
> > is
> > >> > the
> > >> > reason, I am not sure.
> > >> >
> > >> > Would deleting trailing stop rules speed things up, instead of
> > defining
> > >> > them but setting enabled=FALSE?
> > >> >
> > >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com
> <javascript:;>>:
> > >> >
> > >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> > >> >> > I will try running the same code without trailing stops and see
> > what
> > >> >> > effect
> > >> >> > it has on the processing time. I will report back as soon as it
> is
> > >> >> > finished.
> > >> >>
> > >> >> Running the macd demo code over 10 years of daily data on my
> machine
> > >> >> (no
> > >> >> trailing stops) takes 0.5262365 secs for a single run.
> > >> >>
> > >> >>
> > >> >>
> > >> >
> > >> >         [[alternative HTML version deleted]]
> > >> >
> > >> > _______________________________________________
> > >> > R-SIG-Finance at r-project.org <javascript:;> mailing list
> > >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > >> > -- Subscriber-posting only. If you want to post, subscribe first.
> > >> > -- Also note that this is not the r-help list where general R
> > questions
> > >> > should go.
> > >>
> > >>
> > >>
> > >> --
> > >> Joshua Ulrich  |  about.me/joshuaulrich
> > >> FOSS Trading  |  www.fosstrading.com
> > >> R/Finance 2016 | www.rinfinance.com
> > >
> > >
> >
> >
> >
> > --
> > Joshua Ulrich  |  about.me/joshuaulrich
> > FOSS Trading  |  www.fosstrading.com
> > R/Finance 2016 | www.rinfinance.com
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org <javascript:;> mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>


-- 

Erol Biceroglu


*erol.biceroglu at alumni.utoronto.ca
<erol.biceroglu at alumni.utoronto.ca>416-275-7970*

	[[alternative HTML version deleted]]


From jerseyfanatic1 at gmail.com  Fri Apr  8 07:46:59 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Fri, 8 Apr 2016 08:46:59 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CACjNfmk7U=5HLnh7VyNHasC_7A9gH8+xwuvuLGuF_b2af_a4Wg@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com>
	<CACjNfmk7U=5HLnh7VyNHasC_7A9gH8+xwuvuLGuF_b2af_a4Wg@mail.gmail.com>
Message-ID: <CAC_=oyP1=y3QBxCxghT9pikE=o1cBX8pAh__40iF6B0b=PCiUw@mail.gmail.com>

RAM is usually at 80% or so, but CPU is maxing out, I guess that means RAM
is sufficient?

2016-04-07 23:23 GMT+03:00 Erol Biceroglu <erol.biceroglu at alumni.utoronto.ca
>:

> Hello,
>
> Only thing I can think of that might make it take longer, that affected me
> in the past, is RAM, especially in Windows.  Is it maxing out at all?
>
>
> On Thursday, April 7, 2016, Jersey Fanatic <jerseyfanatic1 at gmail.com>
> wrote:
>
>> So I tried to see what effect trailing stop and stop loss rules have on
>> the
>> processing time. For the same dataset, only SL took 5 mins while only
>> trailing SL took 10 mins, and trailing SL with normal SL took 13 mins. I
>> guess it is processing it as fast as it should be. Thanks for all the
>> help.
>>
>> 2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>>
>> > On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
>> > <jerseyfanatic1 at gmail.com> wrote:
>> > > Thanks for the insight. I did not know variations in processing time
>> of
>> > 20
>> > > minutes or so could happen between different parameter combinations.
>> > >
>> > > I ran the strategy with the same dataset with random parameters
>> without
>> > > Trailing SL, on single core and it took 5.15 minutes. The number of
>> > > transactions were 7800. The amount of processing time seems too much
>> > > compared to yours though. 5sec data of 3 years vs M5 data of just 1
>> > year; 20
>> > > min vs 5 mins.
>> > >
>> > Again, the number of observations is not a good predictor of the
>> > amount of time it will take.  You have 7800 transactions.  My shortest
>> > (longest) run had 25 (1500) transactions.
>> >
>> > Seems reasonable to me that a strategy producing nearly 8000
>> > transactions takes about 5 minutes; that's about 25 transactions a
>> > second.
>> >
>> > > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>> > >>
>> > >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
>> > jerseyfanatic1 at gmail.com>
>> > >> wrote:
>> > >> > 10 years of daily data makes about 2500 data points. So
>> extrapolating
>> > >> > from
>> > >> > that to 58000 data points (assuming the relation is linear), it
>> should
>> > >> > take
>> > >>
>> > >> Number of data points is not necessarily a good estimator for run
>> time
>> > >> even if the strategies are the same.  What matters more is the number
>> > >> of timestamps/observations that must be evaluated.  That includes
>> > >> signals, moving orders, processing fills, etc.
>> > >>
>> > >> > about 12.2 secs for a single run with my dataset. For 144 runs
>> (total
>> > >> > number of parameter combinations), it should take about 30 mins.
>> > >> > However, I
>> > >>
>> > >> Again, the relationship is not linear.  Different parameter
>> > >> combinations will produce differing amounts of signals, order
>> > >> movement, fills, etc.
>> > >>
>> > >> For example, I ran parameter optimization on ~3 years of 5-second
>> > >> data.  Some parameter combinations took 1-2 minutes, some took >20
>> > >> minutes.
>> > >>
>> > >> > ran apply.paramset() this morning (without trailing stops), it took
>> > 4.5
>> > >> > hours. And the code is the one that I sent earlier with Trailing
>> stop
>> > >> > rules
>> > >> > enabled=FALSE'd.
>> > >> >
>> > >> > Did you run the macd demo code with single core? If you did some
>> > >> > parallel
>> > >> > processing, did you use doSNOW package or something else? Maybe
>> that
>> > is
>> > >> > the
>> > >> > reason, I am not sure.
>> > >> >
>> > >> > Would deleting trailing stop rules speed things up, instead of
>> > defining
>> > >> > them but setting enabled=FALSE?
>> > >> >
>> > >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
>> > >> >
>> > >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
>> > >> >> > I will try running the same code without trailing stops and see
>> > what
>> > >> >> > effect
>> > >> >> > it has on the processing time. I will report back as soon as it
>> is
>> > >> >> > finished.
>> > >> >>
>> > >> >> Running the macd demo code over 10 years of daily data on my
>> machine
>> > >> >> (no
>> > >> >> trailing stops) takes 0.5262365 secs for a single run.
>> > >> >>
>> > >> >>
>> > >> >>
>> > >> >
>> > >> >         [[alternative HTML version deleted]]
>> > >> >
>> > >> > _______________________________________________
>> > >> > R-SIG-Finance at r-project.org mailing list
>> > >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > >> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > >> > -- Also note that this is not the r-help list where general R
>> > questions
>> > >> > should go.
>> > >>
>> > >>
>> > >>
>> > >> --
>> > >> Joshua Ulrich  |  about.me/joshuaulrich
>> > >> FOSS Trading  |  www.fosstrading.com
>> > >> R/Finance 2016 | www.rinfinance.com
>> > >
>> > >
>> >
>> >
>> >
>> > --
>> > Joshua Ulrich  |  about.me/joshuaulrich
>> > FOSS Trading  |  www.fosstrading.com
>> > R/Finance 2016 | www.rinfinance.com
>> >
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>
> --
>
> Erol Biceroglu
>
>
> *erol.biceroglu at alumni.utoronto.ca
> <erol.biceroglu at alumni.utoronto.ca>416-275-7970 <416-275-7970>*
>

	[[alternative HTML version deleted]]


From jerseyfanatic1 at gmail.com  Fri Apr  8 07:50:39 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Fri, 8 Apr 2016 08:50:39 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
Message-ID: <CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>

So here are my latest results of testing using the same dataset and rules
(no trailing stoploss):
8-core using doSNOW -> 1.07 hours
4-core using doSNOW -> 59.7 minutes
single-core -> 2.11 hours

So yeah, I guess it is normal for a strategy with high number of
transactions to take this long to backtest.


2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:

> On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
> <jerseyfanatic1 at gmail.com> wrote:
> > Thanks for the insight. I did not know variations in processing time of
> 20
> > minutes or so could happen between different parameter combinations.
> >
> > I ran the strategy with the same dataset with random parameters without
> > Trailing SL, on single core and it took 5.15 minutes. The number of
> > transactions were 7800. The amount of processing time seems too much
> > compared to yours though. 5sec data of 3 years vs M5 data of just 1
> year; 20
> > min vs 5 mins.
> >
> Again, the number of observations is not a good predictor of the
> amount of time it will take.  You have 7800 transactions.  My shortest
> (longest) run had 25 (1500) transactions.
>
> Seems reasonable to me that a strategy producing nearly 8000
> transactions takes about 5 minutes; that's about 25 transactions a
> second.
>
> > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
> >>
> >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
> jerseyfanatic1 at gmail.com>
> >> wrote:
> >> > 10 years of daily data makes about 2500 data points. So extrapolating
> >> > from
> >> > that to 58000 data points (assuming the relation is linear), it should
> >> > take
> >>
> >> Number of data points is not necessarily a good estimator for run time
> >> even if the strategies are the same.  What matters more is the number
> >> of timestamps/observations that must be evaluated.  That includes
> >> signals, moving orders, processing fills, etc.
> >>
> >> > about 12.2 secs for a single run with my dataset. For 144 runs (total
> >> > number of parameter combinations), it should take about 30 mins.
> >> > However, I
> >>
> >> Again, the relationship is not linear.  Different parameter
> >> combinations will produce differing amounts of signals, order
> >> movement, fills, etc.
> >>
> >> For example, I ran parameter optimization on ~3 years of 5-second
> >> data.  Some parameter combinations took 1-2 minutes, some took >20
> >> minutes.
> >>
> >> > ran apply.paramset() this morning (without trailing stops), it took
> 4.5
> >> > hours. And the code is the one that I sent earlier with Trailing stop
> >> > rules
> >> > enabled=FALSE'd.
> >> >
> >> > Did you run the macd demo code with single core? If you did some
> >> > parallel
> >> > processing, did you use doSNOW package or something else? Maybe that
> is
> >> > the
> >> > reason, I am not sure.
> >> >
> >> > Would deleting trailing stop rules speed things up, instead of
> defining
> >> > them but setting enabled=FALSE?
> >> >
> >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
> >> >
> >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> >> >> > I will try running the same code without trailing stops and see
> what
> >> >> > effect
> >> >> > it has on the processing time. I will report back as soon as it is
> >> >> > finished.
> >> >>
> >> >> Running the macd demo code over 10 years of daily data on my machine
> >> >> (no
> >> >> trailing stops) takes 0.5262365 secs for a single run.
> >> >>
> >> >>
> >> >>
> >> >
> >> >         [[alternative HTML version deleted]]
> >> >
> >> > _______________________________________________
> >> > R-SIG-Finance at r-project.org mailing list
> >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> > -- Subscriber-posting only. If you want to post, subscribe first.
> >> > -- Also note that this is not the r-help list where general R
> questions
> >> > should go.
> >>
> >>
> >>
> >> --
> >> Joshua Ulrich  |  about.me/joshuaulrich
> >> FOSS Trading  |  www.fosstrading.com
> >> R/Finance 2016 | www.rinfinance.com
> >
> >
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
>

	[[alternative HTML version deleted]]


From frankm60606 at gmail.com  Fri Apr  8 15:22:49 2016
From: frankm60606 at gmail.com (Frank)
Date: Fri, 8 Apr 2016 08:22:49 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a singlecomputer
In-Reply-To: <CAC_=oyP1=y3QBxCxghT9pikE=o1cBX8pAh__40iF6B0b=PCiUw@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com><1459965951.7774.156.camel@brian-rcg><CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com><CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com><1459975727.7774.163.camel@brian-rcg><CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com><1459978447.7774.165.camel@brian-rcg><CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com><CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com><CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com><CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com><CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com><CACjNfmk7U=5HLnh7VyNHasC_7A9gH8+xwuvuLGuF_b2af_a4Wg@mail.gmail.com>
	<CAC_=oyP1=y3QBxCxghT9pikE=o1cBX8pAh__40iF6B0b=PCiUw@mail.gmail.com>
Message-ID: <E7E67E5FE0B84E5CAD0433E7D2B21368@Franki7PC>

Windows can start using the swap file long before 80% memory utilization. If
speed is of the essence, you might want to max out the memory on your
machine. If that doesn't help, return the memory. 

Frank
Chicago, IL

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of Jersey Fanatic
Sent: Friday, April 08, 2016 12:47 AM
To: Erol Biceroglu
Cc: r-sig-finance; Brian G. Peterson
Subject: Re: [R-SIG-Finance] Processing time of backtests on a
singlecomputer

RAM is usually at 80% or so, but CPU is maxing out, I guess that means RAM
is sufficient?

2016-04-07 23:23 GMT+03:00 Erol Biceroglu <erol.biceroglu at alumni.utoronto.ca
>:

> Hello,
>
> Only thing I can think of that might make it take longer, that affected me
> in the past, is RAM, especially in Windows.  Is it maxing out at all?
>
>
> On Thursday, April 7, 2016, Jersey Fanatic <jerseyfanatic1 at gmail.com>
> wrote:
>
>> So I tried to see what effect trailing stop and stop loss rules have on
>> the
>> processing time. For the same dataset, only SL took 5 mins while only
>> trailing SL took 10 mins, and trailing SL with normal SL took 13 mins. I
>> guess it is processing it as fast as it should be. Thanks for all the
>> help.
>>
>> 2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>>
>> > On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
>> > <jerseyfanatic1 at gmail.com> wrote:
>> > > Thanks for the insight. I did not know variations in processing time
>> of
>> > 20
>> > > minutes or so could happen between different parameter combinations.
>> > >
>> > > I ran the strategy with the same dataset with random parameters
>> without
>> > > Trailing SL, on single core and it took 5.15 minutes. The number of
>> > > transactions were 7800. The amount of processing time seems too much
>> > > compared to yours though. 5sec data of 3 years vs M5 data of just 1
>> > year; 20
>> > > min vs 5 mins.
>> > >
>> > Again, the number of observations is not a good predictor of the
>> > amount of time it will take.  You have 7800 transactions.  My shortest
>> > (longest) run had 25 (1500) transactions.
>> >
>> > Seems reasonable to me that a strategy producing nearly 8000
>> > transactions takes about 5 minutes; that's about 25 transactions a
>> > second.
>> >
>> > > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>> > >>
>> > >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
>> > jerseyfanatic1 at gmail.com>
>> > >> wrote:
>> > >> > 10 years of daily data makes about 2500 data points. So
>> extrapolating
>> > >> > from
>> > >> > that to 58000 data points (assuming the relation is linear), it
>> should
>> > >> > take
>> > >>
>> > >> Number of data points is not necessarily a good estimator for run
>> time
>> > >> even if the strategies are the same.  What matters more is the
number
>> > >> of timestamps/observations that must be evaluated.  That includes
>> > >> signals, moving orders, processing fills, etc.
>> > >>
>> > >> > about 12.2 secs for a single run with my dataset. For 144 runs
>> (total
>> > >> > number of parameter combinations), it should take about 30 mins.
>> > >> > However, I
>> > >>
>> > >> Again, the relationship is not linear.  Different parameter
>> > >> combinations will produce differing amounts of signals, order
>> > >> movement, fills, etc.
>> > >>
>> > >> For example, I ran parameter optimization on ~3 years of 5-second
>> > >> data.  Some parameter combinations took 1-2 minutes, some took >20
>> > >> minutes.
>> > >>
>> > >> > ran apply.paramset() this morning (without trailing stops), it
took
>> > 4.5
>> > >> > hours. And the code is the one that I sent earlier with Trailing
>> stop
>> > >> > rules
>> > >> > enabled=FALSE'd.
>> > >> >
>> > >> > Did you run the macd demo code with single core? If you did some
>> > >> > parallel
>> > >> > processing, did you use doSNOW package or something else? Maybe
>> that
>> > is
>> > >> > the
>> > >> > reason, I am not sure.
>> > >> >
>> > >> > Would deleting trailing stop rules speed things up, instead of
>> > defining
>> > >> > them but setting enabled=FALSE?
>> > >> >
>> > >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
>> > >> >
>> > >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
>> > >> >> > I will try running the same code without trailing stops and see
>> > what
>> > >> >> > effect
>> > >> >> > it has on the processing time. I will report back as soon as it
>> is
>> > >> >> > finished.
>> > >> >>
>> > >> >> Running the macd demo code over 10 years of daily data on my
>> machine
>> > >> >> (no
>> > >> >> trailing stops) takes 0.5262365 secs for a single run.
>> > >> >>
>> > >> >>
>> > >> >>
>> > >> >
>> > >> >         [[alternative HTML version deleted]]
>> > >> >
>> > >> > _______________________________________________
>> > >> > R-SIG-Finance at r-project.org mailing list
>> > >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > >> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > >> > -- Also note that this is not the r-help list where general R
>> > questions
>> > >> > should go.
>> > >>
>> > >>
>> > >>
>> > >> --
>> > >> Joshua Ulrich  |  about.me/joshuaulrich
>> > >> FOSS Trading  |  www.fosstrading.com
>> > >> R/Finance 2016 | www.rinfinance.com
>> > >
>> > >
>> >
>> >
>> >
>> > --
>> > Joshua Ulrich  |  about.me/joshuaulrich
>> > FOSS Trading  |  www.fosstrading.com
>> > R/Finance 2016 | www.rinfinance.com
>> >
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>
> --
>
> Erol Biceroglu
>
>
> *erol.biceroglu at alumni.utoronto.ca
> <erol.biceroglu at alumni.utoronto.ca>416-275-7970 <416-275-7970>*
>

	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From david.jessop at ubs.com  Thu Apr  7 16:50:45 2016
From: david.jessop at ubs.com (david.jessop at ubs.com)
Date: Thu, 7 Apr 2016 14:50:45 +0000
Subject: [R-SIG-Finance] Processing time of backtests on a single
 computer
In-Reply-To: <1459975727.7774.163.camel@brian-rcg>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
Message-ID: <8C841E9FC08E374BA235324BBFEA323B15724F@NLDNC501PN2.UBSPROD.MSAD.UBS.NET>

Hi

Just to add to Brian's comment on "economic justification", see David Bailey / de Prado's sequence of papers (e.g. http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2460551 or http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2308659 , the latter is probably better) on the perils of overfitting parameters.  Summarising the paper, if you run just 100 backtests and optimise the parameters on a strategy with a true Sharpe ratio of zero then the best one will have on average an apparent Sharpe of 2.5.  

Regards

David


-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf Of Brian G. Peterson
Sent: 06 April 2016 21:49
To: Jersey Fanatic
Cc: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Processing time of backtests on a single computer

You didn't say that you were doing parameter optimization.

The length of time that a parameter optimization using brute force will take is a linear combination of the number of parameter combinations that you choose to search.

Typically, you should only include parameter distributions for parameters for which you feel you have a strong economic justification.
Your strategy contains eight parameter distributions and two constraints.  The choices of these distributions appears arbitrary, and will result in hundreds of combinations to test.  So, you should expect your strategy to take approximately a linear combination of additional time based on the number of parameters you wish to test. 

Another thing that will make this test take a long time is the inclusion of trailing stops.  As is described in the documentation, trailing stops require evaluating the strategy at more points in the path dependent loop.  The number of observations that need to be evaluated in the path dependent rules loop has another linear effect on the time to evaluate your backtest.  Have you validated that there is a theoretical justification for a trailing stop?  Does this increase the positive expectation of your resulting signal process?

Most of the validation of your indicator and signal processes should be possible long before you get to parameter optimization.

Regards,

Brian
  
--
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


On Wed, 2016-04-06 at 23:20 +0300, Jersey Fanatic wrote:
> The email with the CSV data attached is waiting for moderator's approval.
> The reproducible code is below.
> 
> 
> 2016-04-06 23:17 GMT+03:00 Jersey Fanatic <jerseyfanatic1 at gmail.com>:
> 
> > Thanks for the quick reply. I did not understand what you meant by path
> > dependent looping or copying, but my aim is to decrease the processing time
> > of the backtesting of several combinations of parameters.
> >
> > Here is the reproducible example, and the data I am using is attached as
> > well:
> >
> > library(lattice)
> > library(foreach)
> > library(doSNOW)
> > library(ggplot2)
> > library(PerformanceAnalytics)
> > library(doSNOW)
> > require(latticeExtra)
> > require(grid)
> > library(gridExtra)
> > library(reshape)
> > library(quantstrat)
> > no.cores <- 8
> >
> > .strategy<- new.env()
> > .blotter<- new.env()
> >
> > currency(c('USD', 'EUR'))
> > exchange_rate(primary_id="EURUSD", tick_size=0.0001)
> >
> > data.location.r <- "processingtime_q_rsigfinance.csv"
> > symbol.data <- as.xts(read.zoo(data.location.r, sep=',',
> > tz="",header=TRUE, format='%d/%m/%Y %H:%M', index.column = 1))
> > symbol.data <- symbol.data[symbol.data$VOLUME!=0,]
> >                                    # Delete rows with no volume (when the
> > market is closed)
> > symbol.data[,c(1,2,3,4)] <-
> > round(as.numeric(symbol.data[,c(1,2,3,4)]),abs(log10(0.0001))) #datay? tick
> > sizela uyumlu yapma
> > assign("EURUSD", symbol.data)
> >
> > strategy.st <- "rsigfinance"
> > rm.strat(strategy.st)
> >
> >
> > initDate = as.character(as.Date(index(symbol.data[1])-1))
> >
> > initPortf(strategy.st, "EURUSD", initDate=initDate, currency = "USD")
> > initAcct(strategy.st, portfolios=strategy.st, initDate=initDate,
> > initEq=100000, currency = "USD")
> > initOrders(portfolio=strategy.st,initDate=initDate)
> >
> > strategy(strategy.st,store=TRUE)
> > summary(getStrategy(strategy.st))
> >
> >
> > macdFastMARange <- seq(2,17,by=5)
> > macdSlowMARange <- seq(5,35,by=10)
> > macdSignalRange <- seq(2,18,by=8)
> >
> > StopLossDistanceRange <- seq(0.01,0.02,by=0.01)
> >
> > TrailingDistanceRange <- seq(0.01,0.02,by=0.01)
> >
> >
> > positionSizeLong  =    round(100000 / as.numeric(symbol.data$CLOSE[1]),-2)
> > positionSizeShort =  - round(100000 / as.numeric(symbol.data$CLOSE[1]),-2)
> > txn.model <- 0
> > sltsltp.txn.fee <- 0
> >
> >
> > add.indicator(strategy.st,
> >               name = "MACD",
> >               arguments = list(x=Cl(eval(parse(text = "EURUSD")))),
> >               label='macd')
> >
> > add.signal(strategy.st,name="sigCrossover",
> >            arguments =
> > list(columns=c("macd.macd","signal.macd"),relationship="gt"),
> >            label="macd.gt.signal")
> >
> > add.signal(strategy.st,name="sigCrossover",
> >            arguments =
> > list(columns=c("macd.macd","signal.macd"),relationship="lt"),
> >            label="macd.lt.signal")
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.gt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty= positionSizeLong,
> >                           ordertype='market',
> >                           orderside='long',
> >                           orderset='ocolong',
> >                           TxnFees = txn.model),
> >          type='enter',
> >          label='longenter',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.lt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty='all',
> >                           ordertype='market',
> >                           orderside='long',
> >                           orderset='ocolong',
> >                           TxnFees = txn.model),
> >          type='exit',
> >          label='longexit',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,name='ruleSignal',
> >          arguments = list( sigcol="macd.lt.signal", sigval=TRUE,
> >                            replace=FALSE,
> >                            orderside='long',
> >                            ordertype='stoplimit',
> >                            tmult=TRUE,
> >                            threshold=quote( longStopLossDistance ),
> >                            orderqty='all',
> >                            orderset='ocolong',
> >                            TxnFees = txn.model),
> >          type='chain', parent="longenter",
> >          label='StopLossLong',
> >          enabled=TRUE)
> >
> > add.rule(strategy.st, name = 'ruleSignal',
> >          arguments=list(sigcol="macd.lt.signal" , sigval=TRUE,
> >                         replace=FALSE,
> >                         orderside='long',
> >                         ordertype='stoptrailing',
> >                         tmult=TRUE,
> >                         threshold=quote(longTrailingStopDistance),
> >                         orderqty='all',
> >                         orderset='ocolong',
> >                         TxnFees = txn.model),
> >          type='chain', parent="longenter",
> >          label='StopTrailingLong',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st, name = "ruleSignal",
> >          arguments = list(sigcol="macd.lt.signal",
> >                           sigval=TRUE,
> >                           ordertype="limit",
> >                           orderside="long",
> >                           replace=FALSE,
> >                           tmult=TRUE,
> >                           threshold=quote(longTakeProfitDistance),
> >                           orderqty="all",
> >                           orderset="ocolong",
> >                           TxnFees = txn.model),
> >          type = "chain", parent="longenter",
> >          label = "takeProfitLong",
> >          enabled = FALSE
> > )
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.lt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty=positionSizeShort,
> >                           ordertype='market',
> >                           orderside='short',
> >                           orderset='ocoshort',
> >                           TxnFees = txn.model),
> >          type='enter',
> >          label='shortenter',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,
> >          name='ruleSignal',
> >          arguments = list(sigcol="macd.gt.signal",
> >                           sigval=TRUE,
> >                           prefer="Open",
> >                           orderqty='all',
> >                           ordertype='market',
> >                           orderside='short',
> >                           orderset='ocoshort',
> >                           TxnFees = txn.model),
> >          type='exit',
> >          label='shortexit',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st,name='ruleSignal',
> >          arguments = list( sigcol="macd.gt.signal", sigval=TRUE,
> >                            replace=FALSE,
> >                            orderside='short',
> >                            ordertype='stoplimit',
> >                            tmult=TRUE,
> >                            threshold=quote( shortStopLossDistance ),
> >                            orderqty='all',
> >                            orderset='ocoshort',
> >                            TxnFees = txn.model),
> >          type='chain', parent="shortenter",
> >          label='StopLossShort',
> >          enabled=TRUE)
> >
> > add.rule(strategy.st, name = 'ruleSignal',
> >          arguments=list(sigcol="macd.gt.signal" , sigval=TRUE,
> >                         replace=FALSE,
> >                         orderside='short',
> >                         ordertype='stoptrailing',
> >                         tmult=TRUE,
> >                         threshold=quote( shortTrailingStopDistance),
> >                         orderqty='all',
> >                         orderset='ocoshort',
> >                         TxnFees = txn.model),
> >          type='chain', parent="shortenter",
> >          label='StopTrailingShort',
> >          enabled=TRUE
> > )
> >
> > add.rule(strategy.st, name = "ruleSignal",
> >          arguments = list(sigcol="macd.gt.signal",
> >                           sigval=TRUE,
> >                           ordertype="limit",
> >                           orderside="short",
> >                           replace=FALSE,
> >                           tmult=TRUE,
> >                           threshold=quote( -shortTakeProfitDistance),
> >                           orderqty="all",
> >                           orderset="ocoshort",
> >                           TxnFees = txn.model),
> >          type = "chain", parent="shortenter",
> >          label = "takeProfitShort",
> >          enabled = FALSE
> > )
> >
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = 'indicator',
> >                  component.label = "macd",
> >                  variable = list( nFast = macdFastMARange ),
> >                  label = "macdFastMARANGE")
> >
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = 'indicator',
> >                  component.label = "macd",
> >                  variable = list( nSlow = macdSlowMARange ),
> >                  label = "macdSlowMARANGE")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = 'indicator',
> >                  component.label = "macd",
> >                  variable = list( nSig = macdSignalRange ),
> >                  label = "macdSignalRANGE")
> >
> > add.distribution.constraint(strategy.st,
> >                             paramset.label = 'MACD_OPT',
> >                             distribution.label.1 = 'macdFastMARANGE',
> >                             distribution.label.2 = 'macdSlowMARANGE',
> >                             operator = '<',
> >                             label = 'FastMA<SlowMA')
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopLossLong",
> >                  variable = list( threshold = StopLossDistanceRange ),
> >                  label = "StopLossLONG")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopTrailingLong",
> >                  variable = list( threshold = TrailingDistanceRange ),
> >                  label = "StopTrailingLONG")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopLossShort",
> >                  variable = list( threshold = StopLossDistanceRange ),
> >                  label = "StopLossSHORT")
> >
> > add.distribution(strategy.st,
> >                  paramset.label = "MACD_OPT",
> >                  component.type = "chain",
> >                  component.label = "StopTrailingShort",
> >                  variable = list( threshold = TrailingDistanceRange ),
> >                  label = "StopTrailingSHORT")
> >
> > add.distribution.constraint(strategy.st,
> >                             paramset.label = "MACD_OPT",
> >                             distribution.label.1 = "StopLossLONG",
> >                             distribution.label.2 = "StopLossSHORT",
> >                             operator = "==",
> >                             label = "StoplossEquality")
> >
> > add.distribution.constraint(strategy.st,
> >                             paramset.label = "MACD_OPT",
> >                             distribution.label.1 = "StopTrailingLONG",
> >                             distribution.label.2 = "StopTrailingSHORT",
> >                             operator = "==",
> >                             label = "TrailingStopEquality")
> >
> > summary(getStrategy(strategy.st))
> >
> >
> >
> > start.t <- Sys.time()
> > paramsetenv<-new.env()
> > cl <- snow::makeCluster(no.cores, type = "SOCK")
> > registerDoSNOW(cl)
> > results <- apply.paramset(strategy.st,paramset.label="MACD_OPT",
> >                           portfolio=strategy.st, account=strategy.st,nsamples=0,verbose
> > = FALSE,
> >                           audit=paramsetenv)
> > snow::stopCluster(cl)
> > finish.t <- Sys.time()
> > print(finish.t-start.t)
> >
> >
> >
> >
> >
> > If there are any problems with the code when reproducing, sorry. I ran it
> > on my computer and it did seem to work as it did normally.
> >
> >
> >
> > 2016-04-06 21:05 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
> >
> >> On Wed, 2016-04-06 at 20:58 +0300, Jersey Fanatic wrote:
> >> > Hi everyone,
> >> >
> >> > I am trying to backtest a simple strategy of mine, but it took approx 10
> >> > hours of processing so I was wondering if it is normal.
> >> >
> >> > My computer has an i7 core 2.10 GHz, 8GB RAM with Windows 7 Ultimate
> >> OS. My
> >> > code uses doSNOW package for parallel processing and all the 8 cores, so
> >> > the CPU is %100 all the time for the complete 10 hours.
> >> >
> >> > The data the backtest is done on is M5 OHLC FX (24 hour) data for
> >> approx 1
> >> > year  which makes a total of 58000 data points (counting OHLC as 1). The
> >> > strategy has 4 entry&exit and 4 stoploss&trailingstoploss&takeprofit
> >> rules.
> >> > 144 combinations of parameters are tested.
> >> >
> >> > I would just like to know if this time is normal for just 1 home-use
> >> > computer. And I would be grateful for any recommendations to speed up
> >> this
> >> > process to decrease computing time.
> >>
> >> No, this sounds very high.
> >>
> >> You haven't told us enough about what you're trying to do for anyone
> >> here to help you in a specific way.  You'd need to provide a minimal
> >> reproducible example.
> >>
> >> However, we typically use a benchmark time of one core minute per day
> >> per instrument on tick data (millions of observations per day).
> >>
> >> Is seems likely that you are doing too much path dependent looping,
> >> copying, or both.
> >>
> >> Regards,
> >>
> >> Brian
> >>
> >>
> >
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.
-------------- next part --------------

Visit our website at http://www.ubs.com 

This message contains confidential information and is intended only 
for the individual named. If you are not the named addressee you 
should not disseminate, distribute or copy this e-mail. Please 
notify the sender immediately by e-mail if you have received this 
e-mail by mistake and delete this e-mail from your system. 

E-mails are not encrypted and cannot be guaranteed to be secure or 
error-free as information could be intercepted, corrupted, lost, 
destroyed, arrive late or incomplete, or contain viruses. The sender 
therefore does not accept liability for any errors or omissions in the 
contents of this message which arise as a result of e-mail transmission. 
If verification is required please request a hard-copy version. This 
message is provided for informational purposes and should not be 
construed as a solicitation or offer to buy or sell any securities 
or related financial instruments. 

UBS Limited is a company limited by shares incorporated in the United 
Kingdom registered in England and Wales with number 2035362.  
Registered Office: 1 Finsbury Avenue, London EC2M 2PP
UBS Limited is authorised by the Prudential Regulation Authority 
and regulated by the Financial Conduct Authority and the Prudential 
Regulation Authority.

UBS AG is a public company incorporated with limited liability in
Switzerland domiciled in the Canton of Basel-City and the Canton of
Zurich respectively registered at the Commercial Registry offices in
those Cantons with new Identification No: CHE-101.329.561 as from 18
December 2013 (and prior to 18 December 2013 with Identification
No: CH-270.3.004.646-4) and having respective head offices at
Aeschenvorstadt 1, 4051 Basel and Bahnhofstrasse 45, 8001 Zurich,
Switzerland and is authorised and regulated by the Financial Market
Supervisory Authority in Switzerland.  Registered in the United
Kingdom as a foreign company with No: FC021146 and having a UK
Establishment registered at Companies House, Cardiff, with
No: BR 004507.  The principal office of UK Establishment: 1 Finsbury
Avenue, London EC2M 2PP.  In the United Kingdom, UBS AG is authorised
by the Prudential Regulation Authority and subject to regulation
by the Financial Conduct Authority and limited regulation by the
Prudential Regulation Authority.  Details about the extent of our
regulation by the Prudential Regulation Authority are available
from us on request.

UBS reserves the right to retain all messages. Messages are protected 
and accessed only in legally justified cases. 

From jerseyfanatic1 at gmail.com  Fri Apr  8 16:27:37 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Fri, 8 Apr 2016 17:27:37 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a singlecomputer
In-Reply-To: <E7E67E5FE0B84E5CAD0433E7D2B21368@Franki7PC>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com>
	<CACjNfmk7U=5HLnh7VyNHasC_7A9gH8+xwuvuLGuF_b2af_a4Wg@mail.gmail.com>
	<CAC_=oyP1=y3QBxCxghT9pikE=o1cBX8pAh__40iF6B0b=PCiUw@mail.gmail.com>
	<E7E67E5FE0B84E5CAD0433E7D2B21368@Franki7PC>
Message-ID: <CAC_=oyMOEgettO5mhHt-AessUJ5hBEw-yDYOfqOgn2nnXJ_1JA@mail.gmail.com>

All info I could find was about setting the swap file size, not enabling
Windows to max out memory, or disabling paging before like %90 memory
usage. But will research further too see how its done. Thanks.

2016-04-08 16:22 GMT+03:00 Frank <frankm60606 at gmail.com>:

> Windows can start using the swap file long before 80% memory utilization.
> If
> speed is of the essence, you might want to max out the memory on your
> machine. If that doesn't help, return the memory.
>
> Frank
> Chicago, IL
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
> Of Jersey Fanatic
> Sent: Friday, April 08, 2016 12:47 AM
> To: Erol Biceroglu
> Cc: r-sig-finance; Brian G. Peterson
> Subject: Re: [R-SIG-Finance] Processing time of backtests on a
> singlecomputer
>
> RAM is usually at 80% or so, but CPU is maxing out, I guess that means RAM
> is sufficient?
>
> 2016-04-07 23:23 GMT+03:00 Erol Biceroglu <
> erol.biceroglu at alumni.utoronto.ca
> >:
>
> > Hello,
> >
> > Only thing I can think of that might make it take longer, that affected
> me
> > in the past, is RAM, especially in Windows.  Is it maxing out at all?
> >
> >
> > On Thursday, April 7, 2016, Jersey Fanatic <jerseyfanatic1 at gmail.com>
> > wrote:
> >
> >> So I tried to see what effect trailing stop and stop loss rules have on
> >> the
> >> processing time. For the same dataset, only SL took 5 mins while only
> >> trailing SL took 10 mins, and trailing SL with normal SL took 13 mins. I
> >> guess it is processing it as fast as it should be. Thanks for all the
> >> help.
> >>
> >> 2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
> >>
> >> > On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
> >> > <jerseyfanatic1 at gmail.com> wrote:
> >> > > Thanks for the insight. I did not know variations in processing time
> >> of
> >> > 20
> >> > > minutes or so could happen between different parameter combinations.
> >> > >
> >> > > I ran the strategy with the same dataset with random parameters
> >> without
> >> > > Trailing SL, on single core and it took 5.15 minutes. The number of
> >> > > transactions were 7800. The amount of processing time seems too much
> >> > > compared to yours though. 5sec data of 3 years vs M5 data of just 1
> >> > year; 20
> >> > > min vs 5 mins.
> >> > >
> >> > Again, the number of observations is not a good predictor of the
> >> > amount of time it will take.  You have 7800 transactions.  My shortest
> >> > (longest) run had 25 (1500) transactions.
> >> >
> >> > Seems reasonable to me that a strategy producing nearly 8000
> >> > transactions takes about 5 minutes; that's about 25 transactions a
> >> > second.
> >> >
> >> > > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
> >> > >>
> >> > >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
> >> > jerseyfanatic1 at gmail.com>
> >> > >> wrote:
> >> > >> > 10 years of daily data makes about 2500 data points. So
> >> extrapolating
> >> > >> > from
> >> > >> > that to 58000 data points (assuming the relation is linear), it
> >> should
> >> > >> > take
> >> > >>
> >> > >> Number of data points is not necessarily a good estimator for run
> >> time
> >> > >> even if the strategies are the same.  What matters more is the
> number
> >> > >> of timestamps/observations that must be evaluated.  That includes
> >> > >> signals, moving orders, processing fills, etc.
> >> > >>
> >> > >> > about 12.2 secs for a single run with my dataset. For 144 runs
> >> (total
> >> > >> > number of parameter combinations), it should take about 30 mins.
> >> > >> > However, I
> >> > >>
> >> > >> Again, the relationship is not linear.  Different parameter
> >> > >> combinations will produce differing amounts of signals, order
> >> > >> movement, fills, etc.
> >> > >>
> >> > >> For example, I ran parameter optimization on ~3 years of 5-second
> >> > >> data.  Some parameter combinations took 1-2 minutes, some took >20
> >> > >> minutes.
> >> > >>
> >> > >> > ran apply.paramset() this morning (without trailing stops), it
> took
> >> > 4.5
> >> > >> > hours. And the code is the one that I sent earlier with Trailing
> >> stop
> >> > >> > rules
> >> > >> > enabled=FALSE'd.
> >> > >> >
> >> > >> > Did you run the macd demo code with single core? If you did some
> >> > >> > parallel
> >> > >> > processing, did you use doSNOW package or something else? Maybe
> >> that
> >> > is
> >> > >> > the
> >> > >> > reason, I am not sure.
> >> > >> >
> >> > >> > Would deleting trailing stop rules speed things up, instead of
> >> > defining
> >> > >> > them but setting enabled=FALSE?
> >> > >> >
> >> > >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com
> >:
> >> > >> >
> >> > >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> >> > >> >> > I will try running the same code without trailing stops and
> see
> >> > what
> >> > >> >> > effect
> >> > >> >> > it has on the processing time. I will report back as soon as
> it
> >> is
> >> > >> >> > finished.
> >> > >> >>
> >> > >> >> Running the macd demo code over 10 years of daily data on my
> >> machine
> >> > >> >> (no
> >> > >> >> trailing stops) takes 0.5262365 secs for a single run.
> >> > >> >>
> >> > >> >>
> >> > >> >>
> >> > >> >
> >> > >> >         [[alternative HTML version deleted]]
> >> > >> >
> >> > >> > _______________________________________________
> >> > >> > R-SIG-Finance at r-project.org mailing list
> >> > >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> > >> > -- Subscriber-posting only. If you want to post, subscribe first.
> >> > >> > -- Also note that this is not the r-help list where general R
> >> > questions
> >> > >> > should go.
> >> > >>
> >> > >>
> >> > >>
> >> > >> --
> >> > >> Joshua Ulrich  |  about.me/joshuaulrich
> >> > >> FOSS Trading  |  www.fosstrading.com
> >> > >> R/Finance 2016 | www.rinfinance.com
> >> > >
> >> > >
> >> >
> >> >
> >> >
> >> > --
> >> > Joshua Ulrich  |  about.me/joshuaulrich
> >> > FOSS Trading  |  www.fosstrading.com
> >> > R/Finance 2016 | www.rinfinance.com
> >> >
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >>
> >
> >
> > --
> >
> > Erol Biceroglu
> >
> >
> > *erol.biceroglu at alumni.utoronto.ca
> > <erol.biceroglu at alumni.utoronto.ca>416-275-7970 <416-275-7970>*
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>

	[[alternative HTML version deleted]]


From frankm60606 at gmail.com  Fri Apr  8 16:32:16 2016
From: frankm60606 at gmail.com (Frank)
Date: Fri, 8 Apr 2016 09:32:16 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a singlecomputer
In-Reply-To: <CAC_=oyMOEgettO5mhHt-AessUJ5hBEw-yDYOfqOgn2nnXJ_1JA@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com><1459965951.7774.156.camel@brian-rcg><CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com><CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com><1459975727.7774.163.camel@brian-rcg><CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com><1459978447.7774.165.camel@brian-rcg><CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com><CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com><CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com><CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com><CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com><CACjNfmk7U=5HLnh7VyNHasC_7A9gH8+xwuvuLGuF_b2af_a4Wg@mail.gmail.com><CAC_=oyP1=y3QBxCxghT9pikE=o1cBX8pAh__40iF6B0b=PCiUw@mail.gmail.com><E7E67E5FE0B84E5CAD0433E7D2B21368@Franki7PC>
	<CAC_=oyMOEgettO5mhHt-AessUJ5hBEw-yDYOfqOgn2nnXJ_1JA@mail.gmail.com>
Message-ID: <F92202FB402149E8B3AFDE6B2B3D578D@Franki7PC>

I mean buy the maximum amount of memory your system allows, install it and
see if that helps. Memory is cheap. On the expensive side, most quad core i7
CPU sockets can accept a six core i7 CPU upgrade. These were $1,000 the last
time I checked.

 

Frank

Chicago, IL

 

  _____  

From: Jersey Fanatic [mailto:jerseyfanatic1 at gmail.com] 
Sent: Friday, April 08, 2016 9:28 AM
To: Frank
Cc: Erol Biceroglu; r-sig-finance; Brian G. Peterson
Subject: Re: [R-SIG-Finance] Processing time of backtests on a
singlecomputer

 

All info I could find was about setting the swap file size, not enabling
Windows to max out memory, or disabling paging before like %90 memory usage.
But will research further too see how its done. Thanks.

 

2016-04-08 16:22 GMT+03:00 Frank <frankm60606 at gmail.com>:

Windows can start using the swap file long before 80% memory utilization. If
speed is of the essence, you might want to max out the memory on your
machine. If that doesn't help, return the memory.

Frank
Chicago, IL

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of Jersey Fanatic
Sent: Friday, April 08, 2016 12:47 AM
To: Erol Biceroglu
Cc: r-sig-finance; Brian G. Peterson
Subject: Re: [R-SIG-Finance] Processing time of backtests on a
singlecomputer

RAM is usually at 80% or so, but CPU is maxing out, I guess that means RAM
is sufficient?

2016-04-07 23:23 GMT+03:00 Erol Biceroglu <erol.biceroglu at alumni.utoronto.ca
>:

> Hello,
>
> Only thing I can think of that might make it take longer, that affected me
> in the past, is RAM, especially in Windows.  Is it maxing out at all?
>
>
> On Thursday, April 7, 2016, Jersey Fanatic <jerseyfanatic1 at gmail.com>
> wrote:
>
>> So I tried to see what effect trailing stop and stop loss rules have on
>> the
>> processing time. For the same dataset, only SL took 5 mins while only
>> trailing SL took 10 mins, and trailing SL with normal SL took 13 mins. I
>> guess it is processing it as fast as it should be. Thanks for all the
>> help.
>>
>> 2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>>
>> > On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
>> > <jerseyfanatic1 at gmail.com> wrote:
>> > > Thanks for the insight. I did not know variations in processing time
>> of
>> > 20
>> > > minutes or so could happen between different parameter combinations.
>> > >
>> > > I ran the strategy with the same dataset with random parameters
>> without
>> > > Trailing SL, on single core and it took 5.15 minutes. The number of
>> > > transactions were 7800. The amount of processing time seems too much
>> > > compared to yours though. 5sec data of 3 years vs M5 data of just 1
>> > year; 20
>> > > min vs 5 mins.
>> > >
>> > Again, the number of observations is not a good predictor of the
>> > amount of time it will take.  You have 7800 transactions.  My shortest
>> > (longest) run had 25 (1500) transactions.
>> >
>> > Seems reasonable to me that a strategy producing nearly 8000
>> > transactions takes about 5 minutes; that's about 25 transactions a
>> > second.
>> >
>> > > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
>> > >>
>> > >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
>> > jerseyfanatic1 at gmail.com>
>> > >> wrote:
>> > >> > 10 years of daily data makes about 2500 data points. So
>> extrapolating
>> > >> > from
>> > >> > that to 58000 data points (assuming the relation is linear), it
>> should
>> > >> > take
>> > >>
>> > >> Number of data points is not necessarily a good estimator for run
>> time
>> > >> even if the strategies are the same.  What matters more is the
number
>> > >> of timestamps/observations that must be evaluated.  That includes
>> > >> signals, moving orders, processing fills, etc.
>> > >>
>> > >> > about 12.2 secs for a single run with my dataset. For 144 runs
>> (total
>> > >> > number of parameter combinations), it should take about 30 mins.
>> > >> > However, I
>> > >>
>> > >> Again, the relationship is not linear.  Different parameter
>> > >> combinations will produce differing amounts of signals, order
>> > >> movement, fills, etc.
>> > >>
>> > >> For example, I ran parameter optimization on ~3 years of 5-second
>> > >> data.  Some parameter combinations took 1-2 minutes, some took >20
>> > >> minutes.
>> > >>
>> > >> > ran apply.paramset() this morning (without trailing stops), it
took
>> > 4.5
>> > >> > hours. And the code is the one that I sent earlier with Trailing
>> stop
>> > >> > rules
>> > >> > enabled=FALSE'd.
>> > >> >
>> > >> > Did you run the macd demo code with single core? If you did some
>> > >> > parallel
>> > >> > processing, did you use doSNOW package or something else? Maybe
>> that
>> > is
>> > >> > the
>> > >> > reason, I am not sure.
>> > >> >
>> > >> > Would deleting trailing stop rules speed things up, instead of
>> > defining
>> > >> > them but setting enabled=FALSE?
>> > >> >
>> > >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com>:
>> > >> >
>> > >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
>> > >> >> > I will try running the same code without trailing stops and see
>> > what
>> > >> >> > effect
>> > >> >> > it has on the processing time. I will report back as soon as it
>> is
>> > >> >> > finished.
>> > >> >>
>> > >> >> Running the macd demo code over 10 years of daily data on my
>> machine
>> > >> >> (no
>> > >> >> trailing stops) takes 0.5262365 secs for a single run.
>> > >> >>
>> > >> >>
>> > >> >>
>> > >> >
>> > >> >         [[alternative HTML version deleted]]
>> > >> >
>> > >> > _______________________________________________
>> > >> > R-SIG-Finance at r-project.org mailing list
>> > >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > >> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > >> > -- Also note that this is not the r-help list where general R
>> > questions
>> > >> > should go.
>> > >>
>> > >>
>> > >>
>> > >> --
>> > >> Joshua Ulrich  |  about.me/joshuaulrich
>> > >> FOSS Trading  |  www.fosstrading.com
>> > >> R/Finance 2016 | www.rinfinance.com
>> > >
>> > >
>> >
>> >
>> >
>> > --
>> > Joshua Ulrich  |  about.me/joshuaulrich
>> > FOSS Trading  |  www.fosstrading.com
>> > R/Finance 2016 | www.rinfinance.com
>> >
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>
> --
>
> Erol Biceroglu
>
>

> *erol.biceroglu at alumni.utoronto.ca
> <erol.biceroglu at alumni.utoronto.ca>416-275-7970 <416-275-7970>*

>

        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.

 


	[[alternative HTML version deleted]]


From jerseyfanatic1 at gmail.com  Sat Apr  9 10:57:00 2016
From: jerseyfanatic1 at gmail.com (Jersey Fanatic)
Date: Sat, 9 Apr 2016 11:57:00 +0300
Subject: [R-SIG-Finance] Processing time of backtests on a singlecomputer
In-Reply-To: <F92202FB402149E8B3AFDE6B2B3D578D@Franki7PC>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyMgZKHx6FHVOKnK0G2pdsNBV3Gg0q7wv_PJOVTbNv7oJg@mail.gmail.com>
	<CACjNfmk7U=5HLnh7VyNHasC_7A9gH8+xwuvuLGuF_b2af_a4Wg@mail.gmail.com>
	<CAC_=oyP1=y3QBxCxghT9pikE=o1cBX8pAh__40iF6B0b=PCiUw@mail.gmail.com>
	<E7E67E5FE0B84E5CAD0433E7D2B21368@Franki7PC>
	<CAC_=oyMOEgettO5mhHt-AessUJ5hBEw-yDYOfqOgn2nnXJ_1JA@mail.gmail.com>
	<F92202FB402149E8B3AFDE6B2B3D578D@Franki7PC>
Message-ID: <CAC_=oyPiwgT4+PC24Dy3pdVBE0FiUzNcidBJWvDv7BAg0eeWqQ@mail.gmail.com>

Will go with the cheap route. I will report back the performance increase
if I remember to do so. Thanks for the recommendation.

2016-04-08 17:32 GMT+03:00 Frank <frankm60606 at gmail.com>:

> I mean buy the maximum amount of memory your system allows, install it and
> see if that helps. Memory is cheap. On the expensive side, most quad core
> i7 CPU sockets can accept a six core i7 CPU upgrade. These were $1,000 the
> last time I checked.
>
>
>
> Frank
>
> Chicago, IL
>
>
> ------------------------------
>
> *From:* Jersey Fanatic [mailto:jerseyfanatic1 at gmail.com]
> *Sent:* Friday, April 08, 2016 9:28 AM
> *To:* Frank
> *Cc:* Erol Biceroglu; r-sig-finance; Brian G. Peterson
>
> *Subject:* Re: [R-SIG-Finance] Processing time of backtests on a
> singlecomputer
>
>
>
> All info I could find was about setting the swap file size, not enabling
> Windows to max out memory, or disabling paging before like %90 memory
> usage. But will research further too see how its done. Thanks.
>
>
>
> 2016-04-08 16:22 GMT+03:00 Frank <frankm60606 at gmail.com>:
>
> Windows can start using the swap file long before 80% memory utilization.
> If
> speed is of the essence, you might want to max out the memory on your
> machine. If that doesn't help, return the memory.
>
> Frank
> Chicago, IL
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
> Of Jersey Fanatic
> Sent: Friday, April 08, 2016 12:47 AM
> To: Erol Biceroglu
> Cc: r-sig-finance; Brian G. Peterson
> Subject: Re: [R-SIG-Finance] Processing time of backtests on a
> singlecomputer
>
> RAM is usually at 80% or so, but CPU is maxing out, I guess that means RAM
> is sufficient?
>
> 2016-04-07 23:23 GMT+03:00 Erol Biceroglu <
> erol.biceroglu at alumni.utoronto.ca
> >:
>
> > Hello,
> >
> > Only thing I can think of that might make it take longer, that affected
> me
> > in the past, is RAM, especially in Windows.  Is it maxing out at all?
> >
> >
> > On Thursday, April 7, 2016, Jersey Fanatic <jerseyfanatic1 at gmail.com>
> > wrote:
> >
> >> So I tried to see what effect trailing stop and stop loss rules have on
> >> the
> >> processing time. For the same dataset, only SL took 5 mins while only
> >> trailing SL took 10 mins, and trailing SL with normal SL took 13 mins. I
> >> guess it is processing it as fast as it should be. Thanks for all the
> >> help.
> >>
> >> 2016-04-07 20:45 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
> >>
> >> > On Thu, Apr 7, 2016 at 11:30 AM, Jersey Fanatic
> >> > <jerseyfanatic1 at gmail.com> wrote:
> >> > > Thanks for the insight. I did not know variations in processing time
> >> of
> >> > 20
> >> > > minutes or so could happen between different parameter combinations.
> >> > >
> >> > > I ran the strategy with the same dataset with random parameters
> >> without
> >> > > Trailing SL, on single core and it took 5.15 minutes. The number of
> >> > > transactions were 7800. The amount of processing time seems too much
> >> > > compared to yours though. 5sec data of 3 years vs M5 data of just 1
> >> > year; 20
> >> > > min vs 5 mins.
> >> > >
> >> > Again, the number of observations is not a good predictor of the
> >> > amount of time it will take.  You have 7800 transactions.  My shortest
> >> > (longest) run had 25 (1500) transactions.
> >> >
> >> > Seems reasonable to me that a strategy producing nearly 8000
> >> > transactions takes about 5 minutes; that's about 25 transactions a
> >> > second.
> >> >
> >> > > 2016-04-07 16:32 GMT+03:00 Joshua Ulrich <josh.m.ulrich at gmail.com>:
> >> > >>
> >> > >> On Thu, Apr 7, 2016 at 8:10 AM, Jersey Fanatic <
> >> > jerseyfanatic1 at gmail.com>
> >> > >> wrote:
> >> > >> > 10 years of daily data makes about 2500 data points. So
> >> extrapolating
> >> > >> > from
> >> > >> > that to 58000 data points (assuming the relation is linear), it
> >> should
> >> > >> > take
> >> > >>
> >> > >> Number of data points is not necessarily a good estimator for run
> >> time
> >> > >> even if the strategies are the same.  What matters more is the
> number
> >> > >> of timestamps/observations that must be evaluated.  That includes
> >> > >> signals, moving orders, processing fills, etc.
> >> > >>
> >> > >> > about 12.2 secs for a single run with my dataset. For 144 runs
> >> (total
> >> > >> > number of parameter combinations), it should take about 30 mins.
> >> > >> > However, I
> >> > >>
> >> > >> Again, the relationship is not linear.  Different parameter
> >> > >> combinations will produce differing amounts of signals, order
> >> > >> movement, fills, etc.
> >> > >>
> >> > >> For example, I ran parameter optimization on ~3 years of 5-second
> >> > >> data.  Some parameter combinations took 1-2 minutes, some took >20
> >> > >> minutes.
> >> > >>
> >> > >> > ran apply.paramset() this morning (without trailing stops), it
> took
> >> > 4.5
> >> > >> > hours. And the code is the one that I sent earlier with Trailing
> >> stop
> >> > >> > rules
> >> > >> > enabled=FALSE'd.
> >> > >> >
> >> > >> > Did you run the macd demo code with single core? If you did some
> >> > >> > parallel
> >> > >> > processing, did you use doSNOW package or something else? Maybe
> >> that
> >> > is
> >> > >> > the
> >> > >> > reason, I am not sure.
> >> > >> >
> >> > >> > Would deleting trailing stop rules speed things up, instead of
> >> > defining
> >> > >> > them but setting enabled=FALSE?
> >> > >> >
> >> > >> > 2016-04-07 0:34 GMT+03:00 Brian G. Peterson <brian at braverock.com
> >:
> >> > >> >
> >> > >> >> On Wed, 2016-04-06 at 23:58 +0300, Jersey Fanatic wrote:
> >> > >> >> > I will try running the same code without trailing stops and
> see
> >> > what
> >> > >> >> > effect
> >> > >> >> > it has on the processing time. I will report back as soon as
> it
> >> is
> >> > >> >> > finished.
> >> > >> >>
> >> > >> >> Running the macd demo code over 10 years of daily data on my
> >> machine
> >> > >> >> (no
> >> > >> >> trailing stops) takes 0.5262365 secs for a single run.
> >> > >> >>
> >> > >> >>
> >> > >> >>
> >> > >> >
> >> > >> >         [[alternative HTML version deleted]]
> >> > >> >
> >> > >> > _______________________________________________
> >> > >> > R-SIG-Finance at r-project.org mailing list
> >> > >> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> > >> > -- Subscriber-posting only. If you want to post, subscribe first.
> >> > >> > -- Also note that this is not the r-help list where general R
> >> > questions
> >> > >> > should go.
> >> > >>
> >> > >>
> >> > >>
> >> > >> --
> >> > >> Joshua Ulrich  |  about.me/joshuaulrich
> >> > >> FOSS Trading  |  www.fosstrading.com
> >> > >> R/Finance 2016 | www.rinfinance.com
> >> > >
> >> > >
> >> >
> >> >
> >> >
> >> > --
> >> > Joshua Ulrich  |  about.me/joshuaulrich
> >> > FOSS Trading  |  www.fosstrading.com
> >> > R/Finance 2016 | www.rinfinance.com
> >> >
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >>
> >
> >
> > --
> >
> > Erol Biceroglu
> >
> >
>
> > *erol.biceroglu at alumni.utoronto.ca
> > <erol.biceroglu at alumni.utoronto.ca>416-275-7970 <416-275-7970>*
>
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>

	[[alternative HTML version deleted]]


From dmack10 at verizon.net  Sat Apr  9 14:39:07 2016
From: dmack10 at verizon.net (Dan Mack)
Date: Sat, 09 Apr 2016 08:39:07 -0400
Subject: [R-SIG-Finance] Help on getSymbols
Message-ID: <9FEBA479-583E-42CD-BB06-EBD83485A0B7@verizon.net>

Josh,   I have been using the get symbols to bull data from Yahoo via the following code and generally works well.

FromDate = "2002-05-24"
ToDate = "2016-03-17" 


userInput=c("SHW","ABC","LEN","PCLN","HAR","ETN","RRC","PNR","MO","MAT","SNDK","EW","SPLS","AGN","F","MMM",
                   "SWK","EA","KSU","MLM","FCX","XRAY","BDX","DOW","LUK","PHM","TMO","DHI","COH","HOT","STZ","LOW","ADS?,
		   "SWN","REGN","CSC","VFC","CI","HPQ","CA","TE","PWR","RF","BAX")
for (i in userInput)
{
  getSymbols(Symbols=userInput, src="yahoo", from = FromDate, to = ToDate, auto.assign=TRUE, return.class="data.frame")  
}
 
My issue is that many times it takes a really long time to complete,  like upwards to 20-30 minutes.  Sometimes the process terminate with an error message.   I am trying to replicate it, but no luck right now it is just running.  The error indicated something about a header being off.
 
I have a hunch that something is not recognizing the download has completed and can?t terminate the call.

I do notice that when I manually stop the get symbols  call after a short time ( 1-2 minutes) all of my data I asked for will be in the global environment.

This is preventing some automation I would like to do for my models.

Do you have any suggestion on what could be causing this or any solutions?

Thanks  Dan

From josh.m.ulrich at gmail.com  Sat Apr  9 14:42:44 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 9 Apr 2016 07:42:44 -0500
Subject: [R-SIG-Finance] Help on getSymbols
In-Reply-To: <9FEBA479-583E-42CD-BB06-EBD83485A0B7@verizon.net>
References: <9FEBA479-583E-42CD-BB06-EBD83485A0B7@verizon.net>
Message-ID: <CAPPM_gQVg3Wtv6yrpO=n7LwBaEbR060y92bP4E1C0bwRo6GSWQ@mail.gmail.com>

On Sat, Apr 9, 2016 at 7:39 AM, Dan Mack <dmack10 at verizon.net> wrote:
> Josh,   I have been using the get symbols to bull data from Yahoo via the following code and generally works well.
>
> FromDate = "2002-05-24"
> ToDate = "2016-03-17"
>
>
> userInput=c("SHW","ABC","LEN","PCLN","HAR","ETN","RRC","PNR","MO","MAT","SNDK","EW","SPLS","AGN","F","MMM",
>                    "SWK","EA","KSU","MLM","FCX","XRAY","BDX","DOW","LUK","PHM","TMO","DHI","COH","HOT","STZ","LOW","ADS?,
>                    "SWN","REGN","CSC","VFC","CI","HPQ","CA","TE","PWR","RF","BAX")
> for (i in userInput)
> {
>   getSymbols(Symbols=userInput, src="yahoo", from = FromDate, to = ToDate, auto.assign=TRUE, return.class="data.frame")
> }
>
You're downloading all symbols in each iteration of your for loop.
Either set Symbols=userInput and forgo the for loop, or keep the for
loop and set Symbols=i.

> My issue is that many times it takes a really long time to complete,  like upwards to 20-30 minutes.  Sometimes the process terminate with an error message.   I am trying to replicate it, but no luck right now it is just running.  The error indicated something about a header being off.
>
> I have a hunch that something is not recognizing the download has completed and can?t terminate the call.
>
> I do notice that when I manually stop the get symbols  call after a short time ( 1-2 minutes) all of my data I asked for will be in the global environment.
>
> This is preventing some automation I would like to do for my models.
>
> Do you have any suggestion on what could be causing this or any solutions?
>
> Thanks  Dan



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From brian at braverock.com  Sat Apr  9 15:28:31 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Sat, 9 Apr 2016 08:28:31 -0500
Subject: [R-SIG-Finance] Processing time of backtests on a single
	computer
In-Reply-To: <CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
Message-ID: <5709037F.1090404@braverock.com>

On Fri, 2016-04-08 at 08:50 +0300, Jersey Fanatic wrote:
> So here are my latest results of testing using the same dataset and
> rules
> (no trailing stoploss):
> 8-core using doSNOW -> 1.07 hours
> 4-core using doSNOW -> 59.7 minutes
> single-core -> 2.11 hours
>
> So yeah, I guess it is normal for a strategy with high number of
> transactions to take this long to backtest.

I tested a version of this strategy on a 6-core (12 thread) i7-4930K
CPU @ 3.40GHz with 64GB of RAM. [Ref. 1 processingtime_q.ps.R]

4.64 hrs one core (registerDoSEQ)
2.12 hrs six cores using doMC (defaults)
1.77 hrs twelve threads using DoMC (defaults)
1.32 hrs six cores doMC (mc.prescheduling=FALSE)
   44 min twelve threads using DoMC (mc.prescheduling=FALSE)

My script was based on the script originally posted to this thread, and
likely had more rules and tighter parameters than the test reported by
the OP above.

Given a single script and parameter combination verified with the OP,
this machine was about twice as fast. [Ref. 1 
processingtime_q_rsigfinance.R]
5.15 min. for OP and 1.99 min on this reported test machine

Some observations:

RAM:
- all tests consumed more than 8GB of RAM at some point (8.1GB for the
single thread version, 11.8GB for the six thread version, and 18GB for
the 12-thread version)

CPU load:
- the 6-thread test had a load average of about 8, and the 12-thread
  test had a load average below 7, suggesting that the 12-thread test
is using resources less efficiently. with prescheduling FALSE, load
averages were higher for both tests, about 10 for the 6-core test
and about 16 for the 12-thread test.

Load Balancing:
- after about an hour, a load balancing problem was observed, fewer than
half the cores/threads were still executing at 100%.  In the case of the
twelve-thread version, after an hour and half, only one CPU was still
spinning at 100%. It is probable that use of a backend like doRedis or
zmq that are designed for load balancing or taking advantage of a
different prescheduling method in the multicore or SNOW backends would
shorten the execution time, potentially by a lot.

Economic Justification:
- I observed that the shortest timeframe indicator and signal processes
are the most aggressive, often scratching trades.  If trade costs were
taken into account when analyzing the signal process (before even
contemplating rules and a backtest, these short-timeframe signals would
have been ruled out before a brute force parameter search.  These
parameter combinations also take the longest to run, in addition to
likely being economically unfeasible.


References:

[1] The data file and script have been added to quantstrat's sandbox
directory in SVN, for those who are interested.

    /pkg/quantstrat/sandbox/paramtest201604/




-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From paulteetor at yahoo.com  Sat Apr  9 21:28:38 2016
From: paulteetor at yahoo.com (Paul Teetor)
Date: Sat, 9 Apr 2016 19:28:38 +0000 (UTC)
Subject: [R-SIG-Finance] Help on getSymbols
In-Reply-To: <CAPPM_gQVg3Wtv6yrpO=n7LwBaEbR060y92bP4E1C0bwRo6GSWQ@mail.gmail.com>
References: <9FEBA479-583E-42CD-BB06-EBD83485A0B7@verizon.net>
	<CAPPM_gQVg3Wtv6yrpO=n7LwBaEbR060y92bP4E1C0bwRo6GSWQ@mail.gmail.com>
Message-ID: <218848153.2267190.1460230118913.JavaMail.yahoo@mail.yahoo.com>

I could be wrong, but I think Josh meant to say:

Either set Symbols=userInput and forgo the for loop, or keep the for
loop and set Symbols=userInput[i].

 
Paul Teetor, Elgin, IL  USA
http://quantdevel.com/public



________________________________
From: Joshua Ulrich <josh.m.ulrich at gmail.com>
To: Dan Mack <dmack10 at verizon.net> 
Cc: r-sig-finance <r-sig-finance at r-project.org>
Sent: Saturday, April 9, 2016 7:42 AM
Subject: Re: [R-SIG-Finance] Help on getSymbols


On Sat, Apr 9, 2016 at 7:39 AM, Dan Mack <dmack10 at verizon.net> wrote:
> Josh,   I have been using the get symbols to bull data from Yahoo via the following code and generally works well.
>
> FromDate = "2002-05-24"
> ToDate = "2016-03-17"
>
>
> userInput=c("SHW","ABC","LEN","PCLN","HAR","ETN","RRC","PNR","MO","MAT","SNDK","EW","SPLS","AGN","F","MMM",
>                    "SWK","EA","KSU","MLM","FCX","XRAY","BDX","DOW","LUK","PHM","TMO","DHI","COH","HOT","STZ","LOW","ADS?,
>                    "SWN","REGN","CSC","VFC","CI","HPQ","CA","TE","PWR","RF","BAX")
> for (i in userInput)
> {
>   getSymbols(Symbols=userInput, src="yahoo", from = FromDate, to = ToDate, auto.assign=TRUE, return.class="data.frame")
> }
>
You're downloading all symbols in each iteration of your for loop.
Either set Symbols=userInput and forgo the for loop, or keep the for
loop and set Symbols=i.

> My issue is that many times it takes a really long time to complete,  like upwards to 20-30 minutes.  Sometimes the process terminate with an error message.   I am trying to replicate it, but no luck right now it is just running.  The error indicated something about a header being off.
>
> I have a hunch that something is not recognizing the download has completed and can?t terminate the call.
>
> I do notice that when I manually stop the get symbols  call after a short time ( 1-2 minutes) all of my data I asked for will be in the global environment.
>
> This is preventing some automation I would like to do for my models.
>
> Do you have any suggestion on what could be causing this or any solutions?
>
> Thanks  Dan



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From dmack10 at verizon.net  Sat Apr  9 21:33:08 2016
From: dmack10 at verizon.net (Dan Mack)
Date: Sat, 09 Apr 2016 15:33:08 -0400
Subject: [R-SIG-Finance] Help on getSymbols
In-Reply-To: <218848153.2267190.1460230118913.JavaMail.yahoo@mail.yahoo.com>
References: <9FEBA479-583E-42CD-BB06-EBD83485A0B7@verizon.net>
	<CAPPM_gQVg3Wtv6yrpO=n7LwBaEbR060y92bP4E1C0bwRo6GSWQ@mail.gmail.com>
	<218848153.2267190.1460230118913.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <EFF2F7E7-DD60-46AB-B404-B237BCB74D96@verizon.net>

Thanks,  I got it working!,   Dan

On Apr 9, 2016, at 3:28 PM, Paul Teetor <paulteetor at yahoo.com> wrote:

> I could be wrong, but I think Josh meant to say:
> 
> Either set Symbols=userInput and forgo the for loop, or keep the for
> loop and set Symbols=userInput[i].
> 
> 
> Paul Teetor, Elgin, IL  USA
> http://quantdevel.com/public
> 
> 
> 
> ________________________________
> From: Joshua Ulrich <josh.m.ulrich at gmail.com>
> To: Dan Mack <dmack10 at verizon.net> 
> Cc: r-sig-finance <r-sig-finance at r-project.org>
> Sent: Saturday, April 9, 2016 7:42 AM
> Subject: Re: [R-SIG-Finance] Help on getSymbols
> 
> 
> On Sat, Apr 9, 2016 at 7:39 AM, Dan Mack <dmack10 at verizon.net> wrote:
>> Josh,   I have been using the get symbols to bull data from Yahoo via the following code and generally works well.
>> 
>> FromDate = "2002-05-24"
>> ToDate = "2016-03-17"
>> 
>> 
>> userInput=c("SHW","ABC","LEN","PCLN","HAR","ETN","RRC","PNR","MO","MAT","SNDK","EW","SPLS","AGN","F","MMM",
>>                   "SWK","EA","KSU","MLM","FCX","XRAY","BDX","DOW","LUK","PHM","TMO","DHI","COH","HOT","STZ","LOW","ADS?,
>>                   "SWN","REGN","CSC","VFC","CI","HPQ","CA","TE","PWR","RF","BAX")
>> for (i in userInput)
>> {
>>  getSymbols(Symbols=userInput, src="yahoo", from = FromDate, to = ToDate, auto.assign=TRUE, return.class="data.frame")
>> }
>> 
> You're downloading all symbols in each iteration of your for loop.
> Either set Symbols=userInput and forgo the for loop, or keep the for
> loop and set Symbols=i.
> 
>> My issue is that many times it takes a really long time to complete,  like upwards to 20-30 minutes.  Sometimes the process terminate with an error message.   I am trying to replicate it, but no luck right now it is just running.  The error indicated something about a header being off.
>> 
>> I have a hunch that something is not recognizing the download has completed and can?t terminate the call.
>> 
>> I do notice that when I manually stop the get symbols  call after a short time ( 1-2 minutes) all of my data I asked for will be in the global environment.
>> 
>> This is preventing some automation I would like to do for my models.
>> 
>> Do you have any suggestion on what could be causing this or any solutions?
>> 
>> Thanks  Dan
> 
> 
> 
> -- 
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
> 
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From wouter at morannon.org  Sun Apr 10 05:34:10 2016
From: wouter at morannon.org (Wouter Thielen)
Date: Sun, 10 Apr 2016 03:34:10 +0000
Subject: [R-SIG-Finance] Help on getSymbols
In-Reply-To: <EFF2F7E7-DD60-46AB-B404-B237BCB74D96@verizon.net>
References: <9FEBA479-583E-42CD-BB06-EBD83485A0B7@verizon.net>
	<CAPPM_gQVg3Wtv6yrpO=n7LwBaEbR060y92bP4E1C0bwRo6GSWQ@mail.gmail.com>
	<218848153.2267190.1460230118913.JavaMail.yahoo@mail.yahoo.com>
	<EFF2F7E7-DD60-46AB-B404-B237BCB74D96@verizon.net>
Message-ID: <CACySJQUiwHXGEWBsA=yM9eYp2AHR06=Wo0Uj+NtpVcANUMwXnQ@mail.gmail.com>

Paul,

The i actually gets the value of an entry in the vector, when doing a "for
(i in userInput)", not its index. So what Josh typed, was correct :)

Best regards,

Wouter


On Sun, Apr 10, 2016 at 4:33 AM Dan Mack <dmack10 at verizon.net> wrote:

> Thanks,  I got it working!,   Dan
>
> On Apr 9, 2016, at 3:28 PM, Paul Teetor <paulteetor at yahoo.com> wrote:
>
> > I could be wrong, but I think Josh meant to say:
> >
> > Either set Symbols=userInput and forgo the for loop, or keep the for
> > loop and set Symbols=userInput[i].
> >
> >
> > Paul Teetor, Elgin, IL  USA
> > http://quantdevel.com/public
> >
> >
> >
> > ________________________________
> > From: Joshua Ulrich <josh.m.ulrich at gmail.com>
> > To: Dan Mack <dmack10 at verizon.net>
> > Cc: r-sig-finance <r-sig-finance at r-project.org>
> > Sent: Saturday, April 9, 2016 7:42 AM
> > Subject: Re: [R-SIG-Finance] Help on getSymbols
> >
> >
> > On Sat, Apr 9, 2016 at 7:39 AM, Dan Mack <dmack10 at verizon.net> wrote:
> >> Josh,   I have been using the get symbols to bull data from Yahoo via
> the following code and generally works well.
> >>
> >> FromDate = "2002-05-24"
> >> ToDate = "2016-03-17"
> >>
> >>
> >>
> userInput=c("SHW","ABC","LEN","PCLN","HAR","ETN","RRC","PNR","MO","MAT","SNDK","EW","SPLS","AGN","F","MMM",
> >>
>  "SWK","EA","KSU","MLM","FCX","XRAY","BDX","DOW","LUK","PHM","TMO","DHI","COH","HOT","STZ","LOW","ADS?,
> >>
>  "SWN","REGN","CSC","VFC","CI","HPQ","CA","TE","PWR","RF","BAX")
> >> for (i in userInput)
> >> {
> >>  getSymbols(Symbols=userInput, src="yahoo", from = FromDate, to =
> ToDate, auto.assign=TRUE, return.class="data.frame")
> >> }
> >>
> > You're downloading all symbols in each iteration of your for loop.
> > Either set Symbols=userInput and forgo the for loop, or keep the for
> > loop and set Symbols=i.
> >
> >> My issue is that many times it takes a really long time to complete,
> like upwards to 20-30 minutes.  Sometimes the process terminate with an
> error message.   I am trying to replicate it, but no luck right now it is
> just running.  The error indicated something about a header being off.
> >>
> >> I have a hunch that something is not recognizing the download has
> completed and can?t terminate the call.
> >>
> >> I do notice that when I manually stop the get symbols  call after a
> short time ( 1-2 minutes) all of my data I asked for will be in the global
> environment.
> >>
> >> This is preventing some automation I would like to do for my models.
> >>
> >> Do you have any suggestion on what could be causing this or any
> solutions?
> >>
> >> Thanks  Dan
> >
> >
> >
> > --
> > Joshua Ulrich  |  about.me/joshuaulrich
> > FOSS Trading  |  www.fosstrading.com
> > R/Finance 2016 | www.rinfinance.com
> >
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From paulteetor at yahoo.com  Mon Apr 11 03:45:49 2016
From: paulteetor at yahoo.com (Paul Teetor)
Date: Mon, 11 Apr 2016 01:45:49 +0000 (UTC)
Subject: [R-SIG-Finance] Help on getSymbols
In-Reply-To: <CACySJQUiwHXGEWBsA=yM9eYp2AHR06=Wo0Uj+NtpVcANUMwXnQ@mail.gmail.com>
References: <9FEBA479-583E-42CD-BB06-EBD83485A0B7@verizon.net>
	<CAPPM_gQVg3Wtv6yrpO=n7LwBaEbR060y92bP4E1C0bwRo6GSWQ@mail.gmail.com>
	<218848153.2267190.1460230118913.JavaMail.yahoo@mail.yahoo.com>
	<EFF2F7E7-DD60-46AB-B404-B237BCB74D96@verizon.net>
	<CACySJQUiwHXGEWBsA=yM9eYp2AHR06=Wo0Uj+NtpVcANUMwXnQ@mail.gmail.com>
Message-ID: <1940817213.484914.1460339149048.JavaMail.yahoo@mail.yahoo.com>

Oops. You're right. I'm wrong. Sorry about misreading that code!?Paul Teetor, Elgin, IL USAhttp://quantdevel.com/public

      From: Wouter Thielen <wouter at morannon.org>
 To: Dan Mack <dmack10 at verizon.net>; Paul Teetor <paulteetor at yahoo.com> 
Cc: r-sig-finance <r-sig-finance at r-project.org>
 Sent: Saturday, April 9, 2016 10:34 PM
 Subject: Re: [R-SIG-Finance] Help on getSymbols
   
Paul,
The i actually gets the value of an entry in the vector, when doing a "for (i in userInput)", not its index. So what Josh typed, was correct :)
Best regards,
Wouter

On Sun, Apr 10, 2016 at 4:33 AM Dan Mack <dmack10 at verizon.net> wrote:

Thanks,? I got it working!,? ?Dan

On Apr 9, 2016, at 3:28 PM, Paul Teetor <paulteetor at yahoo.com> wrote:

> I could be wrong, but I think Josh meant to say:
>
> Either set Symbols=userInput and forgo the for loop, or keep the for
> loop and set Symbols=userInput[i].
>
>
> Paul Teetor, Elgin, IL? USA
> http://quantdevel.com/public
>
>
>
> ________________________________
> From: Joshua Ulrich <josh.m.ulrich at gmail.com>
> To: Dan Mack <dmack10 at verizon.net>
> Cc: r-sig-finance <r-sig-finance at r-project.org>
> Sent: Saturday, April 9, 2016 7:42 AM
> Subject: Re: [R-SIG-Finance] Help on getSymbols
>
>
> On Sat, Apr 9, 2016 at 7:39 AM, Dan Mack <dmack10 at verizon.net> wrote:
>> Josh,? ?I have been using the get symbols to bull data from Yahoo via the following code and generally works well.
>>
>> FromDate = "2002-05-24"
>> ToDate = "2016-03-17"
>>
>>
>> userInput=c("SHW","ABC","LEN","PCLN","HAR","ETN","RRC","PNR","MO","MAT","SNDK","EW","SPLS","AGN","F","MMM",
>>? ? ? ? ? ? ? ? ? ?"SWK","EA","KSU","MLM","FCX","XRAY","BDX","DOW","LUK","PHM","TMO","DHI","COH","HOT","STZ","LOW","ADS?,
>>? ? ? ? ? ? ? ? ? ?"SWN","REGN","CSC","VFC","CI","HPQ","CA","TE","PWR","RF","BAX")
>> for (i in userInput)
>> {
>>? getSymbols(Symbols=userInput, src="yahoo", from = FromDate, to = ToDate, auto.assign=TRUE, return.class="data.frame")
>> }
>>
> You're downloading all symbols in each iteration of your for loop.
> Either set Symbols=userInput and forgo the for loop, or keep the for
> loop and set Symbols=i.
>
>> My issue is that many times it takes a really long time to complete,? like upwards to 20-30 minutes.? Sometimes the process terminate with an error message.? ?I am trying to replicate it, but no luck right now it is just running.? The error indicated something about a header being off.
>>
>> I have a hunch that something is not recognizing the download has completed and can?t terminate the call.
>>
>> I do notice that when I manually stop the get symbols? call after a short time ( 1-2 minutes) all of my data I asked for will be in the global environment.
>>
>> This is preventing some automation I would like to do for my models.
>>
>> Do you have any suggestion on what could be causing this or any solutions?
>>
>> Thanks? Dan
>
>
>
> --
> Joshua Ulrich? |? about.me/joshuaulrich
> FOSS Trading? |? www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.



  
	[[alternative HTML version deleted]]


From diegoperoni at vodafone.it  Mon Apr 11 12:39:53 2016
From: diegoperoni at vodafone.it (Diego Peroni)
Date: Mon, 11 Apr 2016 12:39:53 +0200
Subject: [R-SIG-Finance] Long Enter Position do not "block" Short Enter
	Orders
In-Reply-To: <5709037F.1090404@braverock.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
	<5709037F.1090404@braverock.com>
Message-ID: <570B7EF9.5000001@vodafone.it>

Hi all,

my simple strategy sets long/short ENTER orders and relative long/short 
EXIT orders.

I don't understand why, if I have an open LONG position, SHORT enter 
order triggers (wrongly closing open position...).

My desire is that if I already have an OPEN position (long) "opposite" 
orders (short enter) do not triggers.

Thanks in advance for your help

Diego


#################################
# MAX POSITION (1 future)
#################################
addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp = 
initDate, maxpos = 1)

#################################
# LONG STRATEGY
#################################
add.rule(qs.strategy, name='ruleSignal',
          arguments = list(sigcol="upTrend", sigval=TRUE,
                           replace=TRUE,
                           prefer='Open',
                           orderside='long',
                           ordertype='stoplimit',
order.price=quote(mktdata$price.enter.long[timestamp]),
                           orderqty=1,
                           osFUN='osMaxPos',
                           time.in.force=quote(timeInForceLong)),
          type='enter',
          label='LE')
add.rule(qs.strategy, name='ruleSignal',
          arguments=list(sigcol='exitLong', sigval=TRUE,
                         replace=FALSE,
                         orderside='long',
                         ordertype='market',
                         orderqty='all',
                         prefer='Open'
          ),
          type='exit',
          label='ExitLong',
          enabled=TRUE)

#################################
# SHORT STRATEGY
#################################
add.rule(qs.strategy, name='ruleSignal',
          arguments=list(sigcol="downTrend", sigval=TRUE,
                         replace=TRUE,
                         prefer='Open',
                         orderside='short',
                         ordertype='stoplimit',
order.price=quote(mktdata$price.enter.short[timestamp]),
                         orderqty=-1,
                         osFUN='osMaxPos',
                         time.in.force=quote(timeInForceShort)),
          type='enter',
          label='SE')
add.rule(qs.strategy, name='ruleSignal',
          arguments=list(sigcol='exitShort', sigval=TRUE,
                         replace=FALSE,
                         orderside='short',
                         ordertype='market',
                         orderqty='all',
                         prefer='Open'
          ),
          type='exit',
          label='ExitShort',
          enabled=TRUE)


From ilya.kipnis at gmail.com  Mon Apr 11 15:05:32 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 11 Apr 2016 09:05:32 -0400
Subject: [R-SIG-Finance] Long Enter Position do not "block" Short Enter
	Orders
In-Reply-To: <570B7EF9.5000001@vodafone.it>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
	<5709037F.1090404@braverock.com> <570B7EF9.5000001@vodafone.it>
Message-ID: <CA+oJuEGhMAxuSW1TkzqXEzJXCtjNKp0m2FU6vZJTrTXfAvNEQA@mail.gmail.com>

Short orders do not by default cancel long orders. You need to have them in
the same order set.

On Mon, Apr 11, 2016 at 6:39 AM, Diego Peroni <diegoperoni at vodafone.it>
wrote:

> Hi all,
>
> my simple strategy sets long/short ENTER orders and relative long/short
> EXIT orders.
>
> I don't understand why, if I have an open LONG position, SHORT enter order
> triggers (wrongly closing open position...).
>
> My desire is that if I already have an OPEN position (long) "opposite"
> orders (short enter) do not triggers.
>
> Thanks in advance for your help
>
> Diego
>
>
> #################################
> # MAX POSITION (1 future)
> #################################
> addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp =
> initDate, maxpos = 1)
>
> #################################
> # LONG STRATEGY
> #################################
> add.rule(qs.strategy, name='ruleSignal',
>          arguments = list(sigcol="upTrend", sigval=TRUE,
>                           replace=TRUE,
>                           prefer='Open',
>                           orderside='long',
>                           ordertype='stoplimit',
> order.price=quote(mktdata$price.enter.long[timestamp]),
>                           orderqty=1,
>                           osFUN='osMaxPos',
>                           time.in.force=quote(timeInForceLong)),
>          type='enter',
>          label='LE')
> add.rule(qs.strategy, name='ruleSignal',
>          arguments=list(sigcol='exitLong', sigval=TRUE,
>                         replace=FALSE,
>                         orderside='long',
>                         ordertype='market',
>                         orderqty='all',
>                         prefer='Open'
>          ),
>          type='exit',
>          label='ExitLong',
>          enabled=TRUE)
>
> #################################
> # SHORT STRATEGY
> #################################
> add.rule(qs.strategy, name='ruleSignal',
>          arguments=list(sigcol="downTrend", sigval=TRUE,
>                         replace=TRUE,
>                         prefer='Open',
>                         orderside='short',
>                         ordertype='stoplimit',
> order.price=quote(mktdata$price.enter.short[timestamp]),
>                         orderqty=-1,
>                         osFUN='osMaxPos',
>                         time.in.force=quote(timeInForceShort)),
>          type='enter',
>          label='SE')
> add.rule(qs.strategy, name='ruleSignal',
>          arguments=list(sigcol='exitShort', sigval=TRUE,
>                         replace=FALSE,
>                         orderside='short',
>                         ordertype='market',
>                         orderqty='all',
>                         prefer='Open'
>          ),
>          type='exit',
>          label='ExitShort',
>          enabled=TRUE)
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Mon Apr 11 15:23:16 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 11 Apr 2016 08:23:16 -0500
Subject: [R-SIG-Finance] R/Finance 2016 registration now open
Message-ID: <CAPPM_gQUv=6u+ej=pS-X83Z7UkRXm1Ztx9G9gZX7i8aqL_bUDA@mail.gmail.com>

Registration for R/Finance 2016 is now open!

The conference will take place on May 20 and 21, at UIC in Chicago.
Building on the success of the previous conferences in 2009-2015, we
expect more than 250 attendees from around the world. R users from
industry, academia, and government will joining 50 presenters covering
all areas of finance with R.

We are very excited about the four keynote presentations given by
Patrick Burns, Frank Diebold, Tarek Eldin, and Rishi Narang.  The
conference agenda (currently) includes 17 full presentations and 33
shorter "lightning talks".  As in previous years, several (optional)
pre-conference seminars are offered on Friday morning.

There is also an (optional) conference dinner at The Riverside Room
and Gallery at Trump.  Situated directly on the hotel's new River
Walk, it is a perfect venue to continue conversations while dining and
drinking.

As they are finalized, agenda details are available at:
  http://www.RinFinance.com/agenda/

Registration information is available at:
  http://www.RinFinance.com/register/

and can also be directly accessed by going to:
  http://go.uic.edu/rfinance

Please note that registration fees will increase by 50% at the end of
early registration on May 6, 2016.

We would to thank our 2016 Sponsors for the continued support enabling us
to host such an exciting conference:

  UIC Liautaud Master of Science in Finance

  Microsoft
  MS-Computational Finance and Risk Management at University of Washington

  Charles Schwab
  Hull Investments
  Interactive Brokers
  OneMarketData
  RStudio

On behalf of the committee and sponsors, we look forward to seeing you
in Chicago!

  Gib Bassett, Peter Carl, Dirk Eddelbuettel, Brian Peterson, Dale
Rosenthal, Jeffrey Ryan, Joshua Ulrich


-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From mikedeanza at outlook.com  Mon Apr 11 17:03:27 2016
From: mikedeanza at outlook.com (Mike Deanza)
Date: Mon, 11 Apr 2016 15:03:27 +0000
Subject: [R-SIG-Finance] [VC++ calling R] How to create a real-time
 interactive ticking time-series chart using dygraph via RInside?
Message-ID: <CY1PR0201MB1818D3AEBC4F2B87B0A9C328C3940@CY1PR0201MB1818.namprd02.prod.outlook.com>

Hi all,


I am trying to figure out how to do this in R and I need your help.


My journey started from something like the following:


http://stackoverflow.com/questions/11365857/real-time-auto-updating-incremental-plot-in-r/1#1


n=1000
df=data.frame(time=1:n,y=runif(n))
window=100
for(i in 1:(n?\window)) {
flush.console()
plot(df$time,df$y,type='l',xlim=c(i,i+window))
Sys.sleep(.09)
}


Then I wanted to make it nicer looking so I went to dygraph.


And then, I would like to be able to live send tick data from within Visual C++ so I started to investigate RInside.


Following the example code here:


http://dirk.eddelbuettel.com/papers/useR2009RcppRInside.pdf


I can open an RInside object in VC++, and then send some data to it, and then execute some command in it, and then get data back.


It is really great.


However, is there a way to have the real-time updating ticking plots to be drawn on dygraph inside RInside?


It turns out the dygraph package tends to draw onto a browser. That makes the real-time updating pretty slow.


Is there a way to set the dygraph to plot to a GUI window in VC++? For example, a QT or MFC GUI window?


My working environment is Win7 64bit ,with VS 2013 and VS2015, QT 5.3 32bit.


Could anybody please shed some lights on me?


Thanks a lot!







	[[alternative HTML version deleted]]


From diegoperoni at vodafone.it  Mon Apr 11 17:07:49 2016
From: diegoperoni at vodafone.it (Diego Peroni)
Date: Mon, 11 Apr 2016 17:07:49 +0200
Subject: [R-SIG-Finance] Long Enter Position do not "block" Short Enter
 Orders
In-Reply-To: <CA+oJuEGhMAxuSW1TkzqXEzJXCtjNKp0m2FU6vZJTrTXfAvNEQA@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
	<5709037F.1090404@braverock.com> <570B7EF9.5000001@vodafone.it>
	<CA+oJuEGhMAxuSW1TkzqXEzJXCtjNKp0m2FU6vZJTrTXfAvNEQA@mail.gmail.com>
Message-ID: <570BBDC5.7050709@vodafone.it>

Thank you Ilya,

I've placed orderset='ocoall' in both ENTER orders (named "LE" and "SE") 
as in the following code but testing them I have the same problem: long 
positions are closed by short (enter) positions...
Can you please tell me what I'm doing wrong?

Diego


#################################
# MAX POSITION (1 future)
#################################
addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp = 
initDate, maxpos = 1)

#################################
# LONG STRATEGY
#################################
add.rule(qs.strategy, name='ruleSignal',
          arguments = list(sigcol="upTrend", sigval=TRUE,
                           replace=TRUE,
                           prefer='Open',
                           orderside='long',
                           ordertype='stoplimit',
order.price=quote(mktdata$price.enter.long[timestamp]),
                           orderqty=1,
                           osFUN='osMaxPos',
                           orderset='ocoall',
                           time.in.force=quote(timeInForceLong)),
          type='enter',
          label='LE')

add.rule(qs.strategy, name='ruleSignal',
          arguments=list(sigcol='exitLong', sigval=TRUE,
                         replace=FALSE,
                         orderside='long',
                         ordertype='market',
                         orderqty='all',
                         prefer='Open'
          ),
          type='exit',
          label='ExitLong',
          enabled=TRUE)

#################################
# SHORT STRATEGY
#################################
add.rule(qs.strategy, name='ruleSignal',
          arguments=list(sigcol="downTrend", sigval=TRUE,
                         replace=TRUE,
                         prefer='Open',
                         orderside='short',
                         ordertype='stoplimit',
order.price=quote(mktdata$price.enter.short[timestamp]),
                         orderqty=-1,
                         osFUN='osMaxPos',
                         orderset='ocoall',
                         time.in.force=quote(timeInForceShort)),
          type='enter',
          label='SE')

add.rule(qs.strategy, name='ruleSignal',
          arguments=list(sigcol='exitShort', sigval=TRUE,
                         replace=FALSE,
                         orderside='short',
                         ordertype='market',
                         orderqty='all',
                         prefer='Open'
          ),
          type='exit',
          label='ExitShort',
          enabled=TRUE)





On 11/04/2016 15:05, Ilya Kipnis wrote:
> Short orders do not by default cancel long orders. You need to have 
> them in the same order set.
>
> On Mon, Apr 11, 2016 at 6:39 AM, Diego Peroni <diegoperoni at vodafone.it 
> <mailto:diegoperoni at vodafone.it>> wrote:
>
>     Hi all,
>
>     my simple strategy sets long/short ENTER orders and relative
>     long/short EXIT orders.
>
>     I don't understand why, if I have an open LONG position, SHORT
>     enter order triggers (wrongly closing open position...).
>
>     My desire is that if I already have an OPEN position (long)
>     "opposite" orders (short enter) do not triggers.
>
>     Thanks in advance for your help
>
>     Diego
>
>
>     #################################
>     # MAX POSITION (1 future)
>     #################################
>     addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp =
>     initDate, maxpos = 1)
>
>     #################################
>     # LONG STRATEGY
>     #################################
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments = list(sigcol="upTrend", sigval=TRUE,
>                               replace=TRUE,
>                               prefer='Open',
>                               orderside='long',
>                               ordertype='stoplimit',
>     order.price=quote(mktdata$price.enter.long[timestamp]),
>                               orderqty=1,
>                               osFUN='osMaxPos',
>     time.in.force=quote(timeInForceLong)),
>              type='enter',
>              label='LE')
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments=list(sigcol='exitLong', sigval=TRUE,
>                             replace=FALSE,
>                             orderside='long',
>                             ordertype='market',
>                             orderqty='all',
>                             prefer='Open'
>              ),
>              type='exit',
>              label='ExitLong',
>              enabled=TRUE)
>
>     #################################
>     # SHORT STRATEGY
>     #################################
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments=list(sigcol="downTrend", sigval=TRUE,
>                             replace=TRUE,
>                             prefer='Open',
>                             orderside='short',
>                             ordertype='stoplimit',
>     order.price=quote(mktdata$price.enter.short[timestamp]),
>                             orderqty=-1,
>                             osFUN='osMaxPos',
>     time.in.force=quote(timeInForceShort)),
>              type='enter',
>              label='SE')
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments=list(sigcol='exitShort', sigval=TRUE,
>                             replace=FALSE,
>                             orderside='short',
>                             ordertype='market',
>                             orderqty='all',
>                             prefer='Open'
>              ),
>              type='exit',
>              label='ExitShort',
>              enabled=TRUE)
>
>     _______________________________________________
>     R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>
>     mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>     -- Subscriber-posting only. If you want to post, subscribe first.
>     -- Also note that this is not the r-help list where general R
>     questions should go.
>
>


	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Mon Apr 11 17:10:46 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 11 Apr 2016 10:10:46 -0500
Subject: [R-SIG-Finance] [VC++ calling R] How to create a real-time
 interactive ticking time-series chart using dygraph via RInside?
In-Reply-To: <CY1PR0201MB1818D3AEBC4F2B87B0A9C328C3940@CY1PR0201MB1818.namprd02.prod.outlook.com>
References: <CY1PR0201MB1818D3AEBC4F2B87B0A9C328C3940@CY1PR0201MB1818.namprd02.prod.outlook.com>
Message-ID: <CAPPM_gSXWwYSY+s8iwaa5G3jxM=72aGwOy3p_+aA7tidZ8qP4g@mail.gmail.com>

Please choose *one* _relevant_ mailing list.  Spamming 5 (!!!!!)
mailing lists fragments the conversation and makes things difficult
for everyone involved.

On Mon, Apr 11, 2016 at 10:03 AM, Mike Deanza <mikedeanza at outlook.com> wrote:
> Hi all,
>
>
> I am trying to figure out how to do this in R and I need your help.
>
>
> My journey started from something like the following:
>
>
> http://stackoverflow.com/questions/11365857/real-time-auto-updating-incremental-plot-in-r/1#1
>
>
> n=1000
> df=data.frame(time=1:n,y=runif(n))
> window=100
> for(i in 1:(n?\window)) {
> flush.console()
> plot(df$time,df$y,type='l',xlim=c(i,i+window))
> Sys.sleep(.09)
> }
>
>
> Then I wanted to make it nicer looking so I went to dygraph.
>
>
> And then, I would like to be able to live send tick data from within Visual C++ so I started to investigate RInside.
>
>
> Following the example code here:
>
>
> http://dirk.eddelbuettel.com/papers/useR2009RcppRInside.pdf
>
>
> I can open an RInside object in VC++, and then send some data to it, and then execute some command in it, and then get data back.
>
>
> It is really great.
>
>
> However, is there a way to have the real-time updating ticking plots to be drawn on dygraph inside RInside?
>
>
> It turns out the dygraph package tends to draw onto a browser. That makes the real-time updating pretty slow.
>
>
> Is there a way to set the dygraph to plot to a GUI window in VC++? For example, a QT or MFC GUI window?
>
>
> My working environment is Win7 64bit ,with VS 2013 and VS2015, QT 5.3 32bit.
>
>
> Could anybody please shed some lights on me?
>
>
> Thanks a lot!
>
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From ilya.kipnis at gmail.com  Mon Apr 11 17:13:19 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 11 Apr 2016 11:13:19 -0400
Subject: [R-SIG-Finance] Long Enter Position do not "block" Short Enter
	Orders
In-Reply-To: <570BBDC5.7050709@vodafone.it>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
	<5709037F.1090404@braverock.com> <570B7EF9.5000001@vodafone.it>
	<CA+oJuEGhMAxuSW1TkzqXEzJXCtjNKp0m2FU6vZJTrTXfAvNEQA@mail.gmail.com>
	<570BBDC5.7050709@vodafone.it>
Message-ID: <CA+oJuEHUHXKhc7VzohZgqu3HJzqy63gT7J-SmLoON4Rr6Ztg-g@mail.gmail.com>

I see your question. If you want short orders not to fire when you have a
long position, you should create a custom order sizing function that
returns 0 if your current position isn't zero for both long and short
positions.

On Mon, Apr 11, 2016 at 11:07 AM, Diego Peroni <diegoperoni at vodafone.it>
wrote:

> Thank you Ilya,
>
> I've placed orderset='ocoall' in both ENTER orders (named "LE" and "SE")
> as in the following code but testing them I have the same problem: long
> positions are closed by short (enter) positions...
> Can you please tell me what I'm doing wrong?
>
> Diego
>
>
> #################################
> # MAX POSITION (1 future)
> #################################
> addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp =
> initDate, maxpos = 1)
>
> #################################
> # LONG STRATEGY
> #################################
> add.rule(qs.strategy, name='ruleSignal',
>          arguments = list(sigcol="upTrend", sigval=TRUE,
>                           replace=TRUE,
>                           prefer='Open',
>                           orderside='long',
>                           ordertype='stoplimit',
>
> order.price=quote(mktdata$price.enter.long[timestamp]),
>                           orderqty=1,
>                           osFUN='osMaxPos',
>                           orderset='ocoall',
>
>                           time.in.force=quote(timeInForceLong)),
>          type='enter',
>          label='LE')
>
> add.rule(qs.strategy, name='ruleSignal',
>          arguments=list(sigcol='exitLong', sigval=TRUE,
>                         replace=FALSE,
>                         orderside='long',
>                         ordertype='market',
>                         orderqty='all',
>                         prefer='Open'
>          ),
>          type='exit',
>          label='ExitLong',
>          enabled=TRUE)
>
> #################################
> # SHORT STRATEGY
> #################################
> add.rule(qs.strategy, name='ruleSignal',
>          arguments=list(sigcol="downTrend", sigval=TRUE,
>                         replace=TRUE,
>                         prefer='Open',
>                         orderside='short',
>                         ordertype='stoplimit',
>
> order.price=quote(mktdata$price.enter.short[timestamp]),
>                         orderqty=-1,
>                         osFUN='osMaxPos',
>                         orderset='ocoall',
>                         time.in.force=quote(timeInForceShort)),
>          type='enter',
>          label='SE')
>
> add.rule(qs.strategy, name='ruleSignal',
>          arguments=list(sigcol='exitShort', sigval=TRUE,
>                         replace=FALSE,
>                         orderside='short',
>                         ordertype='market',
>                         orderqty='all',
>                         prefer='Open'
>          ),
>          type='exit',
>          label='ExitShort',
>          enabled=TRUE)
>
>
>
>
>
> On 11/04/2016 15:05, Ilya Kipnis wrote:
>
> Short orders do not by default cancel long orders. You need to have them
> in the same order set.
>
> On Mon, Apr 11, 2016 at 6:39 AM, Diego Peroni <diegoperoni at vodafone.it>
> wrote:
>
>> Hi all,
>>
>> my simple strategy sets long/short ENTER orders and relative long/short
>> EXIT orders.
>>
>> I don't understand why, if I have an open LONG position, SHORT enter
>> order triggers (wrongly closing open position...).
>>
>> My desire is that if I already have an OPEN position (long) "opposite"
>> orders (short enter) do not triggers.
>>
>> Thanks in advance for your help
>>
>> Diego
>>
>>
>> #################################
>> # MAX POSITION (1 future)
>> #################################
>> addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp =
>> initDate, maxpos = 1)
>>
>> #################################
>> # LONG STRATEGY
>> #################################
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments = list(sigcol="upTrend", sigval=TRUE,
>>                           replace=TRUE,
>>                           prefer='Open',
>>                           orderside='long',
>>                           ordertype='stoplimit',
>> order.price=quote(mktdata$price.enter.long[timestamp]),
>>                           orderqty=1,
>>                           osFUN='osMaxPos',
>>                           time.in.force=quote(timeInForceLong)),
>>          type='enter',
>>          label='LE')
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments=list(sigcol='exitLong', sigval=TRUE,
>>                         replace=FALSE,
>>                         orderside='long',
>>                         ordertype='market',
>>                         orderqty='all',
>>                         prefer='Open'
>>          ),
>>          type='exit',
>>          label='ExitLong',
>>          enabled=TRUE)
>>
>> #################################
>> # SHORT STRATEGY
>> #################################
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments=list(sigcol="downTrend", sigval=TRUE,
>>                         replace=TRUE,
>>                         prefer='Open',
>>                         orderside='short',
>>                         ordertype='stoplimit',
>> order.price=quote(mktdata$price.enter.short[timestamp]),
>>                         orderqty=-1,
>>                         osFUN='osMaxPos',
>>                         time.in.force=quote(timeInForceShort)),
>>          type='enter',
>>          label='SE')
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments=list(sigcol='exitShort', sigval=TRUE,
>>                         replace=FALSE,
>>                         orderside='short',
>>                         ordertype='market',
>>                         orderqty='all',
>>                         prefer='Open'
>>          ),
>>          type='exit',
>>          label='ExitShort',
>>          enabled=TRUE)
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>
>

	[[alternative HTML version deleted]]


From diegoperoni at vodafone.it  Mon Apr 11 17:42:36 2016
From: diegoperoni at vodafone.it (Diego Peroni)
Date: Mon, 11 Apr 2016 17:42:36 +0200
Subject: [R-SIG-Finance] Long Enter Position do not "block" Short Enter
 Orders
In-Reply-To: <CA+oJuEHUHXKhc7VzohZgqu3HJzqy63gT7J-SmLoON4Rr6Ztg-g@mail.gmail.com>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
	<5709037F.1090404@braverock.com> <570B7EF9.5000001@vodafone.it>
	<CA+oJuEGhMAxuSW1TkzqXEzJXCtjNKp0m2FU6vZJTrTXfAvNEQA@mail.gmail.com>
	<570BBDC5.7050709@vodafone.it>
	<CA+oJuEHUHXKhc7VzohZgqu3HJzqy63gT7J-SmLoON4Rr6Ztg-g@mail.gmail.com>
Message-ID: <570BC5EC.4030000@vodafone.it>

Now it works,
this is my custom function:

osMaxPosLS = function(data, timestamp, orderqty, ordertype, orderside, 
portfolio, symbol, ruletype, ...) {
   maxpos = osMaxPos(data, timestamp, orderqty, ordertype, orderside, 
portfolio, symbol, ruletype, ...)
   curpos = getPosQty(portfolio, symbol, timestamp)
   if (orderside == 'long' & curpos<0)
     maxpos = 0
   if (orderside == 'short' & curpos>0)
     maxpos = 0
   return (maxpos)
}

Thank you for your help!

Diego




On 11/04/2016 17:13, Ilya Kipnis wrote:
> I see your question. If you want short orders not to fire when you 
> have a long position, you should create a custom order sizing function 
> that returns 0 if your current position isn't zero for both long and 
> short positions.
>
> On Mon, Apr 11, 2016 at 11:07 AM, Diego Peroni 
> <diegoperoni at vodafone.it <mailto:diegoperoni at vodafone.it>> wrote:
>
>     Thank you Ilya,
>
>     I've placed orderset='ocoall' in both ENTER orders (named "LE" and
>     "SE") as in the following code but testing them I have the same
>     problem: long positions are closed by short (enter) positions...
>     Can you please tell me what I'm doing wrong?
>
>     Diego
>
>
>     #################################
>     # MAX POSITION (1 future)
>     #################################
>     addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp =
>     initDate, maxpos = 1)
>
>     #################################
>     # LONG STRATEGY
>     #################################
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments = list(sigcol="upTrend", sigval=TRUE,
>                               replace=TRUE,
>                               prefer='Open',
>                               orderside='long',
>                               ordertype='stoplimit',
>     order.price=quote(mktdata$price.enter.long[timestamp]),
>                               orderqty=1,
>                               osFUN='osMaxPos',
>                               orderset='ocoall',
>
>     time.in.force=quote(timeInForceLong)),
>              type='enter',
>              label='LE')
>
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments=list(sigcol='exitLong', sigval=TRUE,
>                             replace=FALSE,
>                             orderside='long',
>                             ordertype='market',
>                             orderqty='all',
>                             prefer='Open'
>              ),
>              type='exit',
>              label='ExitLong',
>              enabled=TRUE)
>
>     #################################
>     # SHORT STRATEGY
>     #################################
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments=list(sigcol="downTrend", sigval=TRUE,
>                             replace=TRUE,
>                             prefer='Open',
>                             orderside='short',
>                             ordertype='stoplimit',
>     order.price=quote(mktdata$price.enter.short[timestamp]),
>                             orderqty=-1,
>                             osFUN='osMaxPos',
>                             orderset='ocoall',
>     time.in.force=quote(timeInForceShort)),
>              type='enter',
>              label='SE')
>
>     add.rule(qs.strategy, name='ruleSignal',
>              arguments=list(sigcol='exitShort', sigval=TRUE,
>                             replace=FALSE,
>                             orderside='short',
>                             ordertype='market',
>                             orderqty='all',
>                             prefer='Open'
>              ),
>              type='exit',
>              label='ExitShort',
>              enabled=TRUE)
>
>
>
>
>
>     On 11/04/2016 15:05, Ilya Kipnis wrote:
>>     Short orders do not by default cancel long orders. You need to
>>     have them in the same order set.
>>
>>     On Mon, Apr 11, 2016 at 6:39 AM, Diego Peroni
>>     <diegoperoni at vodafone.it <mailto:diegoperoni at vodafone.it>> wrote:
>>
>>         Hi all,
>>
>>         my simple strategy sets long/short ENTER orders and relative
>>         long/short EXIT orders.
>>
>>         I don't understand why, if I have an open LONG position,
>>         SHORT enter order triggers (wrongly closing open position...).
>>
>>         My desire is that if I already have an OPEN position (long)
>>         "opposite" orders (short enter) do not triggers.
>>
>>         Thanks in advance for your help
>>
>>         Diego
>>
>>
>>         #################################
>>         # MAX POSITION (1 future)
>>         #################################
>>         addPosLimit(portfolio = qs.strategy, symbol = symbol,
>>         timestamp = initDate, maxpos = 1)
>>
>>         #################################
>>         # LONG STRATEGY
>>         #################################
>>         add.rule(qs.strategy, name='ruleSignal',
>>                  arguments = list(sigcol="upTrend", sigval=TRUE,
>>                                   replace=TRUE,
>>                                   prefer='Open',
>>                                   orderside='long',
>>         ordertype='stoplimit',
>>         order.price=quote(mktdata$price.enter.long[timestamp]),
>>                                   orderqty=1,
>>                                   osFUN='osMaxPos',
>>         time.in.force=quote(timeInForceLong)),
>>                  type='enter',
>>                  label='LE')
>>         add.rule(qs.strategy, name='ruleSignal',
>>                  arguments=list(sigcol='exitLong', sigval=TRUE,
>>                                 replace=FALSE,
>>                                 orderside='long',
>>                                 ordertype='market',
>>                                 orderqty='all',
>>                                 prefer='Open'
>>                  ),
>>                  type='exit',
>>                  label='ExitLong',
>>                  enabled=TRUE)
>>
>>         #################################
>>         # SHORT STRATEGY
>>         #################################
>>         add.rule(qs.strategy, name='ruleSignal',
>>                  arguments=list(sigcol="downTrend", sigval=TRUE,
>>                                 replace=TRUE,
>>                                 prefer='Open',
>>                                 orderside='short',
>>                                 ordertype='stoplimit',
>>         order.price=quote(mktdata$price.enter.short[timestamp]),
>>                                 orderqty=-1,
>>                                 osFUN='osMaxPos',
>>         time.in.force=quote(timeInForceShort)),
>>                  type='enter',
>>                  label='SE')
>>         add.rule(qs.strategy, name='ruleSignal',
>>                  arguments=list(sigcol='exitShort', sigval=TRUE,
>>                                 replace=FALSE,
>>                                 orderside='short',
>>                                 ordertype='market',
>>                                 orderqty='all',
>>                                 prefer='Open'
>>                  ),
>>                  type='exit',
>>                  label='ExitShort',
>>                  enabled=TRUE)
>>
>>         _______________________________________________
>>         R-SIG-Finance at r-project.org
>>         <mailto:R-SIG-Finance at r-project.org> mailing list
>>         https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>         -- Subscriber-posting only. If you want to post, subscribe first.
>>         -- Also note that this is not the r-help list where general R
>>         questions should go.
>>
>>
>
>


	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Mon Apr 11 17:47:53 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 11 Apr 2016 11:47:53 -0400
Subject: [R-SIG-Finance] Long Enter Position do not "block" Short Enter
	Orders
In-Reply-To: <570BC5EC.4030000@vodafone.it>
References: <CAC_=oyPFO+PuNcD-2+ZdCXoEGnVCB3xSDZ-DOYF3_tgZMUK71w@mail.gmail.com>
	<1459965951.7774.156.camel@brian-rcg>
	<CAC_=oyNCVggntDfytR0f6ShyHOPpy52PLxvxYB-13aQoygKFoA@mail.gmail.com>
	<CAC_=oyPfBYhEV5u=HCXAMe-Fxd+8TosN07O+s7ehPNVeAxf+WA@mail.gmail.com>
	<1459975727.7774.163.camel@brian-rcg>
	<CAC_=oyN2E-PQC4CMsVBysrdpKjnrYqd1jzKKAyufxxCkVm8TDg@mail.gmail.com>
	<1459978447.7774.165.camel@brian-rcg>
	<CAC_=oyMTOEDMHFDYezsk__3DiEPxiWmkfPg04gY3osQRNgzRHQ@mail.gmail.com>
	<CAPPM_gRAKiUudi_O0J6SyV+ErVGhGYRPMb73yUFB2qGsHjz4xg@mail.gmail.com>
	<CAC_=oyNyB=Xn926KO1WYy8ykpFhSQN0ekFr84QB4zQJxvw4EPQ@mail.gmail.com>
	<CAPPM_gQ4zDyEsb-JH6aZ1xqYLf=VcT+dBHGdGKOJNZdjWqsjug@mail.gmail.com>
	<CAC_=oyOrRHT_jX3Bg391qGGna=cQjfBEtQUACEW62kOjqW6SDw@mail.gmail.com>
	<5709037F.1090404@braverock.com> <570B7EF9.5000001@vodafone.it>
	<CA+oJuEGhMAxuSW1TkzqXEzJXCtjNKp0m2FU6vZJTrTXfAvNEQA@mail.gmail.com>
	<570BBDC5.7050709@vodafone.it>
	<CA+oJuEHUHXKhc7VzohZgqu3HJzqy63gT7J-SmLoON4Rr6Ztg-g@mail.gmail.com>
	<570BC5EC.4030000@vodafone.it>
Message-ID: <CA+oJuEHQ1CnS8Bx-_Wu9tYXmixK1wjTeyE1rfD10spXnZ=PEAQ@mail.gmail.com>

Glad to be of help!

On Mon, Apr 11, 2016 at 11:42 AM, Diego Peroni <diegoperoni at vodafone.it>
wrote:

> Now it works,
> this is my custom function:
>
> osMaxPosLS = function(data, timestamp, orderqty, ordertype, orderside,
> portfolio, symbol, ruletype, ...) {
>   maxpos = osMaxPos(data, timestamp, orderqty, ordertype, orderside,
> portfolio, symbol, ruletype, ...)
>   curpos = getPosQty(portfolio, symbol, timestamp)
>   if (orderside == 'long' & curpos<0)
>     maxpos = 0
>   if (orderside == 'short' & curpos>0)
>     maxpos = 0
>   return (maxpos)
> }
>
> Thank you for your help!
>
> Diego
>
>
>
>
>
> On 11/04/2016 17:13, Ilya Kipnis wrote:
>
> I see your question. If you want short orders not to fire when you have a
> long position, you should create a custom order sizing function that
> returns 0 if your current position isn't zero for both long and short
> positions.
>
> On Mon, Apr 11, 2016 at 11:07 AM, Diego Peroni <diegoperoni at vodafone.it>
> wrote:
>
>> Thank you Ilya,
>>
>> I've placed orderset='ocoall' in both ENTER orders (named "LE" and "SE")
>> as in the following code but testing them I have the same problem: long
>> positions are closed by short (enter) positions...
>> Can you please tell me what I'm doing wrong?
>>
>> Diego
>>
>>
>> #################################
>> # MAX POSITION (1 future)
>> #################################
>> addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp =
>> initDate, maxpos = 1)
>>
>> #################################
>> # LONG STRATEGY
>> #################################
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments = list(sigcol="upTrend", sigval=TRUE,
>>                           replace=TRUE,
>>                           prefer='Open',
>>                           orderside='long',
>>                           ordertype='stoplimit',
>>
>> order.price=quote(mktdata$price.enter.long[timestamp]),
>>                           orderqty=1,
>>                           osFUN='osMaxPos',
>>                           orderset='ocoall',
>>
>>                           time.in.force=quote(timeInForceLong)),
>>          type='enter',
>>          label='LE')
>>
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments=list(sigcol='exitLong', sigval=TRUE,
>>                         replace=FALSE,
>>                         orderside='long',
>>                         ordertype='market',
>>                         orderqty='all',
>>                         prefer='Open'
>>          ),
>>          type='exit',
>>          label='ExitLong',
>>          enabled=TRUE)
>>
>> #################################
>> # SHORT STRATEGY
>> #################################
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments=list(sigcol="downTrend", sigval=TRUE,
>>                         replace=TRUE,
>>                         prefer='Open',
>>                         orderside='short',
>>                         ordertype='stoplimit',
>>
>> order.price=quote(mktdata$price.enter.short[timestamp]),
>>                         orderqty=-1,
>>                         osFUN='osMaxPos',
>>                         orderset='ocoall',
>>                         time.in.force=quote(timeInForceShort)),
>>          type='enter',
>>          label='SE')
>>
>> add.rule(qs.strategy, name='ruleSignal',
>>          arguments=list(sigcol='exitShort', sigval=TRUE,
>>                         replace=FALSE,
>>                         orderside='short',
>>                         ordertype='market',
>>                         orderqty='all',
>>                         prefer='Open'
>>          ),
>>          type='exit',
>>          label='ExitShort',
>>          enabled=TRUE)
>>
>>
>>
>>
>>
>> On 11/04/2016 15:05, Ilya Kipnis wrote:
>>
>> Short orders do not by default cancel long orders. You need to have them
>> in the same order set.
>>
>> On Mon, Apr 11, 2016 at 6:39 AM, Diego Peroni < <diegoperoni at vodafone.it>
>> diegoperoni at vodafone.it> wrote:
>>
>>> Hi all,
>>>
>>> my simple strategy sets long/short ENTER orders and relative long/short
>>> EXIT orders.
>>>
>>> I don't understand why, if I have an open LONG position, SHORT enter
>>> order triggers (wrongly closing open position...).
>>>
>>> My desire is that if I already have an OPEN position (long) "opposite"
>>> orders (short enter) do not triggers.
>>>
>>> Thanks in advance for your help
>>>
>>> Diego
>>>
>>>
>>> #################################
>>> # MAX POSITION (1 future)
>>> #################################
>>> addPosLimit(portfolio = qs.strategy, symbol = symbol, timestamp =
>>> initDate, maxpos = 1)
>>>
>>> #################################
>>> # LONG STRATEGY
>>> #################################
>>> add.rule(qs.strategy, name='ruleSignal',
>>>          arguments = list(sigcol="upTrend", sigval=TRUE,
>>>                           replace=TRUE,
>>>                           prefer='Open',
>>>                           orderside='long',
>>>                           ordertype='stoplimit',
>>> order.price=quote(mktdata$price.enter.long[timestamp]),
>>>                           orderqty=1,
>>>                           osFUN='osMaxPos',
>>>                           time.in.force=quote(timeInForceLong)),
>>>          type='enter',
>>>          label='LE')
>>> add.rule(qs.strategy, name='ruleSignal',
>>>          arguments=list(sigcol='exitLong', sigval=TRUE,
>>>                         replace=FALSE,
>>>                         orderside='long',
>>>                         ordertype='market',
>>>                         orderqty='all',
>>>                         prefer='Open'
>>>          ),
>>>          type='exit',
>>>          label='ExitLong',
>>>          enabled=TRUE)
>>>
>>> #################################
>>> # SHORT STRATEGY
>>> #################################
>>> add.rule(qs.strategy, name='ruleSignal',
>>>          arguments=list(sigcol="downTrend", sigval=TRUE,
>>>                         replace=TRUE,
>>>                         prefer='Open',
>>>                         orderside='short',
>>>                         ordertype='stoplimit',
>>> order.price=quote(mktdata$price.enter.short[timestamp]),
>>>                         orderqty=-1,
>>>                         osFUN='osMaxPos',
>>>                         time.in.force=quote(timeInForceShort)),
>>>          type='enter',
>>>          label='SE')
>>> add.rule(qs.strategy, name='ruleSignal',
>>>          arguments=list(sigcol='exitShort', sigval=TRUE,
>>>                         replace=FALSE,
>>>                         orderside='short',
>>>                         ordertype='market',
>>>                         orderqty='all',
>>>                         prefer='Open'
>>>          ),
>>>          type='exit',
>>>          label='ExitShort',
>>>          enabled=TRUE)
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>>> should go.
>>>
>>
>>
>>
>
>

	[[alternative HTML version deleted]]


From wizardchef at gmail.com  Tue Apr 12 03:48:09 2016
From: wizardchef at gmail.com (Ernie Stokely)
Date: Mon, 11 Apr 2016 20:48:09 -0500
Subject: [R-SIG-Finance] adjustOHLC.R issues
Message-ID: <570C53D9.6030101@gmail.com>

OK, I am prepared for the stones that will be thrown at me for being 
naive, but here goes anyway.

Most of the references on adjusting OHLC values for splits and dividends 
say to use the following adjustment:

K = Ca/C
Om = K * O
Hm = K * H
Lm = K * L
Cm = K * C = Ca

where: Ca = adjusted close, OHLC are the unadjusted values, and OmHmLmCm 
are the modified (adjusted) values of OHLC.

If I use adjustOHLC() in quantmod to do the adjustment I find these are 
not the equations being used. For example, for VTI here is the 
unadjusted OHLCadjC data read from Yahoo:

VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
2006-03-01 128.15 128.90 127.79 128.70 216400 52.56795
2006-03-02 128.50 128.76 128.01 128.61 148800 52.53119
2006-03-03 128.26 129.43 128.20 128.40 323200 52.44541
2006-03-06 128.64 128.64 127.27 127.46 279800 52.06147
2006-03-07 127.15 127.31 126.65 126.94 218400 51.84907
2006-03-08 126.72 127.49 126.20 127.30 491800 51.99612

If I apply adjustOHLC() to these data I get:

VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
2006-03-01 59.15007 59.49625 58.98391 59.40394 216400 52.56795
2006-03-02 59.31162 59.43163 59.08545 59.36240 148800 52.53119
2006-03-03 59.20084 59.74088 59.17315 59.26546 323200 52.44541
2006-03-06 59.37624 59.37624 58.74389 58.83159 279800 52.06147
2006-03-07 58.68851 58.76235 58.45772 58.59158 218400 51.84907
2006-03-08 58.49003 58.84544 58.25001 58.75774 491800 51.99612

Obviously, VTI.Adjusted (Ca) is not equal to VTI.Close (Cm) as required 
by the formula above. I have a colleague who has been trading for 40 
years and he says this is an erroneous result (that Cm must equal Ca). 
When I explore the package reference file for adjustOHLC() I see this 
paragraph:

"New columns are derived by taking the ratio of adjusted value to 
original Close, and multiplying by the difference of the respective 
column and the original Close. This is then added to the modified Close 
column to arrive at the remaining ?adjusted? Open, High, Low column values."

I am not quite sure how to translate this verbal description into an 
equation, but it doesn't sound like the same correction I see 
recommended elsewhere and described at the beginning of this note.

Can someone shed some light on this discrepancy or send me a link to 
more enlightenment? Thanks in advance.

Ernie


From brian at braverock.com  Tue Apr 12 11:09:04 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 12 Apr 2016 04:09:04 -0500
Subject: [R-SIG-Finance] adjustOHLC.R issues
In-Reply-To: <570C53D9.6030101@gmail.com>
References: <570C53D9.6030101@gmail.com>
Message-ID: <570CBB30.3090004@braverock.com>

The output of adjustOHLC and {yahoo}.Adjusted will only rarely, if ever, 
agree, since we don't know when they are starting the adjustment, or how 
they are doing the adjustment.  There are many threads over the years on 
this list about this issue which I'm sure Google can locate for you.

Nevertheless ...

What 'most of the references' are those?

Your equation doesn't subtract dividends or apply splits to arrive at 
the new ratio, and is not a continuous-time process.  (as such, it 
cannot be correct) The ratio changes over time based on the accumulation 
of splits and dividends.

We can easily reference the code, by typing

adjustOHLC

at the prompt, or you could produce an equation which actually includes 
the splits and dividends for which we must adjust ...

I suggest that in addition to the code we use a slightly more 
authoritative source than Yahoo, e.g. CRSP:

http://www.crsp.com/products/documentation/crsp-calculations

 From my read of the code, this is what adjustOHLC is doing.

I believe that your error is in not realizing that the ratio changes 
over time.

Brian

On 04/11/2016 08:48 PM, Ernie Stokely wrote:
> OK, I am prepared for the stones that will be thrown at me for being
> naive, but here goes anyway.
>
> Most of the references on adjusting OHLC values for splits and dividends
> say to use the following adjustment:
>
> K = Ca/C
> Om = K * O
> Hm = K * H
> Lm = K * L
> Cm = K * C = Ca
>
> where: Ca = adjusted close, OHLC are the unadjusted values, and OmHmLmCm
> are the modified (adjusted) values of OHLC.
>
> If I use adjustOHLC() in quantmod to do the adjustment I find these are
> not the equations being used. For example, for VTI here is the
> unadjusted OHLCadjC data read from Yahoo:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 128.15 128.90 127.79 128.70 216400 52.56795
> 2006-03-02 128.50 128.76 128.01 128.61 148800 52.53119
> 2006-03-03 128.26 129.43 128.20 128.40 323200 52.44541
> 2006-03-06 128.64 128.64 127.27 127.46 279800 52.06147
> 2006-03-07 127.15 127.31 126.65 126.94 218400 51.84907
> 2006-03-08 126.72 127.49 126.20 127.30 491800 51.99612
>
> If I apply adjustOHLC() to these data I get:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 59.15007 59.49625 58.98391 59.40394 216400 52.56795
> 2006-03-02 59.31162 59.43163 59.08545 59.36240 148800 52.53119
> 2006-03-03 59.20084 59.74088 59.17315 59.26546 323200 52.44541
> 2006-03-06 59.37624 59.37624 58.74389 58.83159 279800 52.06147
> 2006-03-07 58.68851 58.76235 58.45772 58.59158 218400 51.84907
> 2006-03-08 58.49003 58.84544 58.25001 58.75774 491800 51.99612
>
> Obviously, VTI.Adjusted (Ca) is not equal to VTI.Close (Cm) as required
> by the formula above. I have a colleague who has been trading for 40
> years and he says this is an erroneous result (that Cm must equal Ca).
> When I explore the package reference file for adjustOHLC() I see this
> paragraph:
>
> "New columns are derived by taking the ratio of adjusted value to
> original Close, and multiplying by the difference of the respective
> column and the original Close. This is then added to the modified Close
> column to arrive at the remaining ?adjusted? Open, High, Low column
> values."
>
> I am not quite sure how to translate this verbal description into an
> equation, but it doesn't sound like the same correction I see
> recommended elsewhere and described at the beginning of this note.
>
> Can someone shed some light on this discrepancy or send me a link to
> more enlightenment? Thanks in advance.
>
> Ernie


From josh.m.ulrich at gmail.com  Tue Apr 12 14:21:57 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 12 Apr 2016 07:21:57 -0500
Subject: [R-SIG-Finance] adjustOHLC.R issues
In-Reply-To: <570C53D9.6030101@gmail.com>
References: <570C53D9.6030101@gmail.com>
Message-ID: <CAPPM_gS12jL=o9KmDoBKz2oG=QWECjwCQrCpb4xavD3H=+TAFw@mail.gmail.com>

On Mon, Apr 11, 2016 at 8:48 PM, Ernie Stokely <wizardchef at gmail.com> wrote:
> OK, I am prepared for the stones that will be thrown at me for being naive,
> but here goes anyway.
>
> Most of the references on adjusting OHLC values for splits and dividends say
> to use the following adjustment:
>
> K = Ca/C
> Om = K * O
> Hm = K * H
> Lm = K * L
> Cm = K * C = Ca
>
> where: Ca = adjusted close, OHLC are the unadjusted values, and OmHmLmCm are
> the modified (adjusted) values of OHLC.
>
The adjusted close from Yahoo used to only have 2 decimal places, so
what you describe would have been subject to massive loss of accuracy
when there were many adjustments.  That's the entire reason I wrote
TTR::adjRatios and why quantmod::adjustOHLC exists.

That said, they provide more decimal places now, and adjustOHLC
provides a use.Adjusted argument, so you could have used the
adjustments you describe above by calling: adjustOHLC(VTI,
use.Adjusted=TRUE).

> If I use adjustOHLC() in quantmod to do the adjustment I find these are not
> the equations being used. For example, for VTI here is the unadjusted
> OHLCadjC data read from Yahoo:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 128.15 128.90 127.79 128.70 216400 52.56795
> 2006-03-02 128.50 128.76 128.01 128.61 148800 52.53119
> 2006-03-03 128.26 129.43 128.20 128.40 323200 52.44541
> 2006-03-06 128.64 128.64 127.27 127.46 279800 52.06147
> 2006-03-07 127.15 127.31 126.65 126.94 218400 51.84907
> 2006-03-08 126.72 127.49 126.20 127.30 491800 51.99612
>
> If I apply adjustOHLC() to these data I get:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 59.15007 59.49625 58.98391 59.40394 216400 52.56795
> 2006-03-02 59.31162 59.43163 59.08545 59.36240 148800 52.53119
> 2006-03-03 59.20084 59.74088 59.17315 59.26546 323200 52.44541
> 2006-03-06 59.37624 59.37624 58.74389 58.83159 279800 52.06147
> 2006-03-07 58.68851 58.76235 58.45772 58.59158 218400 51.84907
> 2006-03-08 58.49003 58.84544 58.25001 58.75774 491800 51.99612
>
Works fine for me using the latest quantmod and TTR on CRAN:

R> getSymbols("VTI", from="2006-03-01")
[1] "VTI"
R> first(VTI)
           VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
2006-03-01   128.15    128.9  127.79     128.7     216400     52.56795
R> first(adjustOHLC(VTI))
           VTI.Open VTI.High  VTI.Low VTI.Close VTI.Volume VTI.Adjusted
2006-03-01  52.3433 52.64964 52.19626  52.56795     216400     52.56795

Perhaps you're using an older version of one/both packages?

> Obviously, VTI.Adjusted (Ca) is not equal to VTI.Close (Cm) as required by
> the formula above. I have a colleague who has been trading for 40 years and
> he says this is an erroneous result (that Cm must equal Ca). When I explore
> the package reference file for adjustOHLC() I see this paragraph:
>
> "New columns are derived by taking the ratio of adjusted value to original
> Close, and multiplying by the difference of the respective column and the
> original Close. This is then added to the modified Close column to arrive at
> the remaining ?adjusted? Open, High, Low column values."
>
> I am not quite sure how to translate this verbal description into an
> equation, but it doesn't sound like the same correction I see recommended
> elsewhere and described at the beginning of this note.
>
> Can someone shed some light on this discrepancy or send me a link to more
> enlightenment? Thanks in advance.
>
Yahoo describes their adjusted close column here:
https://help.yahoo.com/kb/finance/SLN2311.html

> Ernie
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From prabh_hanspal at yahoo.in  Tue Apr 12 16:17:23 2016
From: prabh_hanspal at yahoo.in (Prabhdeep Kaur)
Date: Tue, 12 Apr 2016 14:17:23 +0000 (UTC)
Subject: [R-SIG-Finance] Imposing restrictions in vecm in r
References: <1191001429.1207843.1460470643385.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1191001429.1207843.1460470643385.JavaMail.yahoo@mail.yahoo.com>

Good morning Sir
My name is Prabhdeep Kaur. I am a research scholar at Guru Nanak Dev University, Amritsar, India.
Sir,?I am trying to test some restrictions in vecm in R but having some problems in the same. I shall be very thankful to you if you can help me in the same. Here is ?a brief description of the problem:
I am having three variables x,y and z and getting two cointegrating vectors (r=2). I used the following commands:>coint<-cbind(x,y,z)>cointe<-ca.jo(coint,ecd="none",type="trace",k=2,spec="longrun")>vecm<-cajorls(cointe,r=2)>summary(vecm)
I want to re-estimate the model with the following restrictions on the cointegrating vectors:
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?ect1 ? ? ? ? ? ? ? ect2? ? ? ? ? x ? ? ? ? ? ? ? ? ? ? ? ?1 ? ? ? ? ? ? ? ? ? ? 0? ? ? ? ? y ? ? ? ? ? ? ? ? ? ? ? ?b1 ? ? ? ? ? ? ? ? ? 1? ? ? ? ? z ? ? ? ? ? ? ? ? ? ? ? ?0 ? ? ? ? ? ? ? ? ? ? b2? ? ? ? constant ? ? ? ? ? ? ?c1 ? ? ? ? ? ? ? ? ? ?c2
Here b1y and c1 are the coefficients of the first cointegrating vector and b2 and c2 are the coefficients of the second cointegrating vector.
I know I need to use blrtest for the same but unable to define the H martix.
>test<-blrtest(cointe,H=?,r=2)
Can you please help me know how can I specify the?H?martix. I shall be very thankful to you if you can guide me in the right direction. Or I need to use tsDyn package in R for the execution of the same.
Thanks and Regards!?Prabhdeep KaurResearch Scholar
Department of CommerceGuru Nanak Dev UniversityAmritsarIndia
	[[alternative HTML version deleted]]


From wizardchef at gmail.com  Tue Apr 12 20:59:20 2016
From: wizardchef at gmail.com (Ernie Stokely)
Date: Tue, 12 Apr 2016 13:59:20 -0500
Subject: [R-SIG-Finance] adjustOHLC.R issues
In-Reply-To: <CAPPM_gS12jL=o9KmDoBKz2oG=QWECjwCQrCpb4xavD3H=+TAFw@mail.gmail.com>
References: <570C53D9.6030101@gmail.com>
	<CAPPM_gS12jL=o9KmDoBKz2oG=QWECjwCQrCpb4xavD3H=+TAFw@mail.gmail.com>
Message-ID: <570D4588.5010403@gmail.com>

Yes, TTR is 0.23.1 and quantmod is 0.4.5. I think my question boils down 
to the difference between using use.Adjusted = TRUE or FALSE. I have 
found prior articles that talk about why the adjusted close values from 
the two methods do not always match, so I conclude that it depends on 
how Yahoo is computing their adjusted close values and the underlying 
data. Since my code is used to compare various innovations and I am not 
concerned about absolute values, I think either method will give 
adjusted data that are suitable for my purposes.

Ernie

> Joshua Ulrich <mailto:josh.m.ulrich at gmail.com>
> April 12, 2016 at 7:21 AM
> On Mon, Apr 11, 2016 at 8:48 PM, Ernie Stokely<wizardchef at gmail.com>  wrote:
>> OK, I am prepared for the stones that will be thrown at me for being naive,
>> but here goes anyway.
>>
>> Most of the references on adjusting OHLC values for splits and dividends say
>> to use the following adjustment:
>>
>> K = Ca/C
>> Om = K * O
>> Hm = K * H
>> Lm = K * L
>> Cm = K * C = Ca
>>
>> where: Ca = adjusted close, OHLC are the unadjusted values, and OmHmLmCm are
>> the modified (adjusted) values of OHLC.
>>
> The adjusted close from Yahoo used to only have 2 decimal places, so
> what you describe would have been subject to massive loss of accuracy
> when there were many adjustments.  That's the entire reason I wrote
> TTR::adjRatios and why quantmod::adjustOHLC exists.
>
> That said, they provide more decimal places now, and adjustOHLC
> provides a use.Adjusted argument, so you could have used the
> adjustments you describe above by calling: adjustOHLC(VTI,
> use.Adjusted=TRUE).
>
>> If I use adjustOHLC() in quantmod to do the adjustment I find these are not
>> the equations being used. For example, for VTI here is the unadjusted
>> OHLCadjC data read from Yahoo:
>>
>> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
>> 2006-03-01 128.15 128.90 127.79 128.70 216400 52.56795
>> 2006-03-02 128.50 128.76 128.01 128.61 148800 52.53119
>> 2006-03-03 128.26 129.43 128.20 128.40 323200 52.44541
>> 2006-03-06 128.64 128.64 127.27 127.46 279800 52.06147
>> 2006-03-07 127.15 127.31 126.65 126.94 218400 51.84907
>> 2006-03-08 126.72 127.49 126.20 127.30 491800 51.99612
>>
>> If I apply adjustOHLC() to these data I get:
>>
>> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
>> 2006-03-01 59.15007 59.49625 58.98391 59.40394 216400 52.56795
>> 2006-03-02 59.31162 59.43163 59.08545 59.36240 148800 52.53119
>> 2006-03-03 59.20084 59.74088 59.17315 59.26546 323200 52.44541
>> 2006-03-06 59.37624 59.37624 58.74389 58.83159 279800 52.06147
>> 2006-03-07 58.68851 58.76235 58.45772 58.59158 218400 51.84907
>> 2006-03-08 58.49003 58.84544 58.25001 58.75774 491800 51.99612
>>
> Works fine for me using the latest quantmod and TTR on CRAN:
>
> R>  getSymbols("VTI", from="2006-03-01")
> [1] "VTI"
> R>  first(VTI)
>             VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01   128.15    128.9  127.79     128.7     216400     52.56795
> R>  first(adjustOHLC(VTI))
>             VTI.Open VTI.High  VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01  52.3433 52.64964 52.19626  52.56795     216400     52.56795
>
> Perhaps you're using an older version of one/both packages?
>
>> Obviously, VTI.Adjusted (Ca) is not equal to VTI.Close (Cm) as required by
>> the formula above. I have a colleague who has been trading for 40 years and
>> he says this is an erroneous result (that Cm must equal Ca). When I explore
>> the package reference file for adjustOHLC() I see this paragraph:
>>
>> "New columns are derived by taking the ratio of adjusted value to original
>> Close, and multiplying by the difference of the respective column and the
>> original Close. This is then added to the modified Close column to arrive at
>> the remaining ?adjusted? Open, High, Low column values."
>>
>> I am not quite sure how to translate this verbal description into an
>> equation, but it doesn't sound like the same correction I see recommended
>> elsewhere and described at the beginning of this note.
>>
>> Can someone shed some light on this discrepancy or send me a link to more
>> enlightenment? Thanks in advance.
>>
> Yahoo describes their adjusted close column here:
> https://help.yahoo.com/kb/finance/SLN2311.html
>
>> Ernie
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>
>
>
> Ernie Stokely <mailto:wizardchef at gmail.com>
> April 11, 2016 at 8:48 PM
> OK, I am prepared for the stones that will be thrown at me for being 
> naive, but here goes anyway.
>
> Most of the references on adjusting OHLC values for splits and 
> dividends say to use the following adjustment:
>
> K = Ca/C
> Om = K * O
> Hm = K * H
> Lm = K * L
> Cm = K * C = Ca
>
> where: Ca = adjusted close, OHLC are the unadjusted values, and 
> OmHmLmCm are the modified (adjusted) values of OHLC.
>
> If I use adjustOHLC() in quantmod to do the adjustment I find these 
> are not the equations being used. For example, for VTI here is the 
> unadjusted OHLCadjC data read from Yahoo:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 128.15 128.90 127.79 128.70 216400 52.56795
> 2006-03-02 128.50 128.76 128.01 128.61 148800 52.53119
> 2006-03-03 128.26 129.43 128.20 128.40 323200 52.44541
> 2006-03-06 128.64 128.64 127.27 127.46 279800 52.06147
> 2006-03-07 127.15 127.31 126.65 126.94 218400 51.84907
> 2006-03-08 126.72 127.49 126.20 127.30 491800 51.99612
>
> If I apply adjustOHLC() to these data I get:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 59.15007 59.49625 58.98391 59.40394 216400 52.56795
> 2006-03-02 59.31162 59.43163 59.08545 59.36240 148800 52.53119
> 2006-03-03 59.20084 59.74088 59.17315 59.26546 323200 52.44541
> 2006-03-06 59.37624 59.37624 58.74389 58.83159 279800 52.06147
> 2006-03-07 58.68851 58.76235 58.45772 58.59158 218400 51.84907
> 2006-03-08 58.49003 58.84544 58.25001 58.75774 491800 51.99612
>
> Obviously, VTI.Adjusted (Ca) is not equal to VTI.Close (Cm) as 
> required by the formula above. I have a colleague who has been trading 
> for 40 years and he says this is an erroneous result (that Cm must 
> equal Ca). When I explore the package reference file for adjustOHLC() 
> I see this paragraph:
>
> "New columns are derived by taking the ratio of adjusted value to 
> original Close, and multiplying by the difference of the respective 
> column and the original Close. This is then added to the modified 
> Close column to arrive at the remaining ?adjusted? Open, High, Low 
> column values."
>
> I am not quite sure how to translate this verbal description into an 
> equation, but it doesn't sound like the same correction I see 
> recommended elsewhere and described at the beginning of this note.
>
> Can someone shed some light on this discrepancy or send me a link to 
> more enlightenment? Thanks in advance.
>
> Ernie
>
>


	[[alternative HTML version deleted]]


From wizardchef at gmail.com  Wed Apr 13 18:16:47 2016
From: wizardchef at gmail.com (Ernie Stokely)
Date: Wed, 13 Apr 2016 11:16:47 -0500
Subject: [R-SIG-Finance] adjustOHLC.R issues
In-Reply-To: <570CBB30.3090004@braverock.com>
References: <570C53D9.6030101@gmail.com> <570CBB30.3090004@braverock.com>
Message-ID: <570E70EF.7000205@gmail.com>

After looking into this issue further I wanted to post my 
understandings, which hopefully are correct and will help others with 
similar questions. The equations I had in my original post are in fact 
the ones implemented in adjustOHLC() when use.Adjusted = TRUE is 
selected. The original C prices, when adjusted using the Yahoo adjusted 
C, will always equal each other. But, when use.Adjusted = FALSE is used 
(the default) adjustOHLC() calculates its own adjusted C value (by 
downloading splits and dividends as required by the parameter list) 
rather than using Yahoo's adjusted C. It then uses that adjusted C value 
to modify/adjust the values of O, H, L, and C. The modified/adjusted C 
value in this case may or may not match the calculated adjusted C value 
due to historic splits and dividends, and the adjusted C value from 
adjustOHLC() and Yahoo don't always match (maybe rarely as Brian says 
below ... have not done an exhaustive test).

The difference between the two use.Adjusted settings seems to come from 
how Yahoo is calculating its adjusted C. Depending on whether one should 
use use.Adjusted = TRUE or FALSE seems depend on how one will use the 
adjusted prices.

I trust the adjustOHLC() values because the equations are more 
transparent than Yahoo's and it grabs all splits and dividends back to 
1900 and applies them where pertinent. I've read a number of posts on 
stackoverflow and on this SIG and also looked at the adjustOHLC() code 
to come to these conclusions.

Thanks to Brian and Josh for their input. If I have misunderstood please 
correct this post.

Ernie

> Brian G. Peterson <mailto:brian at braverock.com>
> April 12, 2016 at 4:09 AM
> The output of adjustOHLC and {yahoo}.Adjusted will only rarely, if 
> ever, agree, since we don't know when they are starting the 
> adjustment, or how they are doing the adjustment.  There are many 
> threads over the years on this list about this issue which I'm sure 
> Google can locate for you.
>
> Nevertheless ...
>
> What 'most of the references' are those?
>
> Your equation doesn't subtract dividends or apply splits to arrive at 
> the new ratio, and is not a continuous-time process.  (as such, it 
> cannot be correct) The ratio changes over time based on the 
> accumulation of splits and dividends.
>
> We can easily reference the code, by typing
>
> adjustOHLC
>
> at the prompt, or you could produce an equation which actually 
> includes the splits and dividends for which we must adjust ...
>
> I suggest that in addition to the code we use a slightly more 
> authoritative source than Yahoo, e.g. CRSP:
>
> http://www.crsp.com/products/documentation/crsp-calculations
>
> From my read of the code, this is what adjustOHLC is doing.
>
> I believe that your error is in not realizing that the ratio changes 
> over time.
>
> Brian
>
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R 
> questions should go.
> Ernie Stokely <mailto:wizardchef at gmail.com>
> April 11, 2016 at 8:48 PM
> OK, I am prepared for the stones that will be thrown at me for being 
> naive, but here goes anyway.
>
> Most of the references on adjusting OHLC values for splits and 
> dividends say to use the following adjustment:
>
> K = Ca/C
> Om = K * O
> Hm = K * H
> Lm = K * L
> Cm = K * C = Ca
>
> where: Ca = adjusted close, OHLC are the unadjusted values, and 
> OmHmLmCm are the modified (adjusted) values of OHLC.
>
> If I use adjustOHLC() in quantmod to do the adjustment I find these 
> are not the equations being used. For example, for VTI here is the 
> unadjusted OHLCadjC data read from Yahoo:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 128.15 128.90 127.79 128.70 216400 52.56795
> 2006-03-02 128.50 128.76 128.01 128.61 148800 52.53119
> 2006-03-03 128.26 129.43 128.20 128.40 323200 52.44541
> 2006-03-06 128.64 128.64 127.27 127.46 279800 52.06147
> 2006-03-07 127.15 127.31 126.65 126.94 218400 51.84907
> 2006-03-08 126.72 127.49 126.20 127.30 491800 51.99612
>
> If I apply adjustOHLC() to these data I get:
>
> VTI.Open VTI.High VTI.Low VTI.Close VTI.Volume VTI.Adjusted
> 2006-03-01 59.15007 59.49625 58.98391 59.40394 216400 52.56795
> 2006-03-02 59.31162 59.43163 59.08545 59.36240 148800 52.53119
> 2006-03-03 59.20084 59.74088 59.17315 59.26546 323200 52.44541
> 2006-03-06 59.37624 59.37624 58.74389 58.83159 279800 52.06147
> 2006-03-07 58.68851 58.76235 58.45772 58.59158 218400 51.84907
> 2006-03-08 58.49003 58.84544 58.25001 58.75774 491800 51.99612
>
> Obviously, VTI.Adjusted (Ca) is not equal to VTI.Close (Cm) as 
> required by the formula above. I have a colleague who has been trading 
> for 40 years and he says this is an erroneous result (that Cm must 
> equal Ca). When I explore the package reference file for adjustOHLC() 
> I see this paragraph:
>
> "New columns are derived by taking the ratio of adjusted value to 
> original Close, and multiplying by the difference of the respective 
> column and the original Close. This is then added to the modified 
> Close column to arrive at the remaining ?adjusted? Open, High, Low 
> column values."
>
> I am not quite sure how to translate this verbal description into an 
> equation, but it doesn't sound like the same correction I see 
> recommended elsewhere and described at the beginning of this note.
>
> Can someone shed some light on this discrepancy or send me a link to 
> more enlightenment? Thanks in advance.
>
> Ernie
>
>


	[[alternative HTML version deleted]]


From kevinramoutar at yahoo.co.uk  Fri Apr 22 16:44:38 2016
From: kevinramoutar at yahoo.co.uk (Kevin Ramoutar)
Date: Fri, 22 Apr 2016 14:44:38 +0000
Subject: [R-SIG-Finance] FixedRateBondYield in Rquantlib
References: <1969354955.628518.1461336278670.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1969354955.628518.1461336278670.JavaMail.yahoo@mail.yahoo.com>

Hello,
I have run the following script utilizing the FixedRateBondYield function in RQuantLib
FixedRateBondYield(,109.080,100,as.Date("2016-04-13"),as.Date("2018-11-15"),3,,c(0.063),,,,,as.Date("2003-11-06"))

Where price = 109.080evaluation date = 2016/04/13 (YYYY-MM-DD)Maturity date = 2018/11/15Coupon rate = 6.3%Issue date = 2003/11/06
returning a result of:[1] 0.02613533attr(,"class")[1] "FixedRateBondYield"
I cross checked the result with Excel's YIELD function and got a result of 2.639666% which is "fairly" close.
However in my analysis I wanted to evaluate yield to maturities over time and when I updated the "FixedRateBondYield" function to an earlier date (April 3, 2014) the results of the R function and Excel's YIELD function significantly diverge.
Code as follows:?EMN2018 <-FixedRateBondYield(,112.538,100,as.Date("2014-04-03"),as.Date("2018-11-15"),3,,c(0.063),,,,,as.Date("2003-11-06"))
EMN2018 returns?
[1] 0.01303334 ? ? #1.303334%attr(,"class")[1] "FixedRateBondYield"
Excel's YIELD function returns 3.343845%. My excel function specification as follows?YIELD(4/3/2014,11/15/2018,6.3%,112.538,100,2,2)

I would appreciate any assistance with the above.

Best RegardsKevin
	[[alternative HTML version deleted]]


From diegoperoni at vodafone.it  Fri Apr 22 17:26:42 2016
From: diegoperoni at vodafone.it (Diego Peroni)
Date: Fri, 22 Apr 2016 17:26:42 +0200
Subject: [R-SIG-Finance] Exit Order By Current Position Info
In-Reply-To: <1969354955.628518.1461336278670.JavaMail.yahoo@mail.yahoo.com>
References: <1969354955.628518.1461336278670.JavaMail.yahoo.ref@mail.yahoo.com>
	<1969354955.628518.1461336278670.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <571A42B2.2000806@vodafone.it>

Hello,

I'd like to integrate my strategy creating a Stop Loss Order that must 
be sent to the market if my current Open Position reach N points up 
(profit).

So this rule must evaluate: Open Price Position, Side Position and Quantity.

Which is the best way to add this behaviuor to my strat?
In which component do I have to work?
In case does exist a working example?

Thanks in advance for your help

Diego


From brian at braverock.com  Fri Apr 22 18:03:16 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 22 Apr 2016 11:03:16 -0500
Subject: [R-SIG-Finance] Exit Order By Current Position Info
In-Reply-To: <571A42B2.2000806@vodafone.it>
References: <1969354955.628518.1461336278670.JavaMail.yahoo.ref@mail.yahoo.com>
	<1969354955.628518.1461336278670.JavaMail.yahoo@mail.yahoo.com>
	<571A42B2.2000806@vodafone.it>
Message-ID: <1461340996.8091.283.camel@brian-rcg>

On Fri, 2016-04-22 at 17:26 +0200, Diego Peroni wrote:
> Hello,
> 
> I'd like to integrate my strategy creating a Stop Loss Order that must 
> be sent to the market if my current Open Position reach N points up 
> (profit).
> 
> So this rule must evaluate: Open Price Position, Side Position and Quantity.
> 
> Which is the best way to add this behaviuor to my strat?
> In which component do I have to work?
> In case does exist a working example?


Work through the luxor examples that replicate Tomasini.

The takeprofit examples are luxor.5.strategy.ordersets.R and
luxor.6.paramset.takeprofit.R

Fundamentally, you need ordersets and chained orders.  We covered all of
this in great detail in our quantstrat seminar a few years ago at
R/Finance:

http://www.rinfinance.com/agenda/2013/workshop/Humme+Peterson.pdf

don't cut and paste code out of the slides.  The demo scripts are
updated to adjust for changes in R and the required packages, the slides
are obviously static.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From diegoperoni at vodafone.it  Fri Apr 22 18:31:37 2016
From: diegoperoni at vodafone.it (Diego Peroni)
Date: Fri, 22 Apr 2016 18:31:37 +0200
Subject: [R-SIG-Finance] Exit Order By Current Position Info
In-Reply-To: <1461340996.8091.283.camel@brian-rcg>
References: <1969354955.628518.1461336278670.JavaMail.yahoo.ref@mail.yahoo.com>
	<1969354955.628518.1461336278670.JavaMail.yahoo@mail.yahoo.com>
	<571A42B2.2000806@vodafone.it>
	<1461340996.8091.283.camel@brian-rcg>
Message-ID: <8B0B55E0-3063-4C78-89A2-269D0E1C5747@vodafone.it>

Thank you Brian

Diego

> On 22 apr 2016, at 18:03, Brian G. Peterson <brian at braverock.com> wrote:
> 
>> On Fri, 2016-04-22 at 17:26 +0200, Diego Peroni wrote:
>> Hello,
>> 
>> I'd like to integrate my strategy creating a Stop Loss Order that must 
>> be sent to the market if my current Open Position reach N points up 
>> (profit).
>> 
>> So this rule must evaluate: Open Price Position, Side Position and Quantity.
>> 
>> Which is the best way to add this behaviuor to my strat?
>> In which component do I have to work?
>> In case does exist a working example?
> 
> 
> Work through the luxor examples that replicate Tomasini.
> 
> The takeprofit examples are luxor.5.strategy.ordersets.R and
> luxor.6.paramset.takeprofit.R
> 
> Fundamentally, you need ordersets and chained orders.  We covered all of
> this in great detail in our quantstrat seminar a few years ago at
> R/Finance:
> 
> http://www.rinfinance.com/agenda/2013/workshop/Humme+Peterson.pdf
> 
> don't cut and paste code out of the slides.  The demo scripts are
> updated to adjust for changes in R and the required packages, the slides
> are obviously static.
> 
> Regards,
> 
> Brian
> 
> -- 
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
> 
> 
> 
> 


From atakanokan at outlook.com  Sun Apr 24 20:36:33 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Sun, 24 Apr 2016 21:36:33 +0300
Subject: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs
	applyStrategy
Message-ID: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>

Hi,
I have been experimenting with different custom transaction fee models for different assets and I realized that apply.paramset and applyStrategy yields different results when a custom transaction fee function is used. 
The reproducible example is below, and even though apply.paramset yields a NetPnL result of 21779 with the custom transaction fee model, applyStrategy yields 21509, which makes me believe that apply.paramset somehow is not incorporating the fees. The comparison of NetPnL results were made with the parameter combination of FastSMA=5, SlowSMA=50 and Stoploss=0.005.
Any help is appreciated, thanks.
Atakan Okan
Code:
library(lattice);library(foreach);library(doSNOW);library(ggplot2)library(gridExtra);library(reshape);library(beepr);library(quantstrat) library(doSNOW)Sys.setenv(TZ="UTC")                                                                                 .strategy<- new.env();.blotter<- new.env()                                                                                                                             
currency('USD')                                                                                                                                                                      stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)
getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")AAPL <- adjustOHLC(AAPL)
strategy.st <- paste("AAPL","MACD_D1",sep = "_")rm.strat(strategy.st) 
initialEquity = 100000                                                                               initDate = "2013-12-30" initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")initOrders(portfolio=strategy.st,initDate=initDate) strategy(strategy.st,store=TRUE)
customFees <- function (TxnQty, ...) {  return(abs(TxnQty) * -0.01)}txn.model <- "customFees"    
positionSizeLong  =  1000     positionSizeShort =  -1000     

paramset.label.name <- "SMA_OPT"FastSMARange <- seq(5,21,by=8)SlowSMARange <- seq(10,50,by=20)StopLossDistanceRange <- seq(0.0025,0.005,by=0.0025)                               

add.indicator(strategy.st,                                                             name = "SMA",                                                             arguments = list(x=Cl(eval(parse(text = "AAPL")))                               ,n=5   #fastsma of best combination by NetPnL              ),                                                                          label='fastsma')                                           
add.indicator(strategy.st,                                                               name = "SMA",                                                              arguments = list(x=Cl(eval(parse(text = "AAPL")))                               ,n=50    #slowsma of best combination by NetPnL              ),                                                                         label='slowsma')                                             
add.signal(strategy.st,           name="sigCrossover",           arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),           label="fastsma.gt.slowsma")                                                        
add.signal(strategy.st,           name="sigCrossover",           arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),           label="fastsma.lt.slowsma")
add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.gt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty= positionSizeLong,                           #osFUN="osAllInLong",                            ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='enter',         label='longenter',         enabled=FALSE         #timespan = xxxx,         #store=TRUE         #storefun=FALSE )
# Long Exit Rule-------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.lt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='exit',         label='longexit',         enabled=FALSE         #timespan = xxxx,         #store=TRUE)
# Long StopLoss Rule---------------------------------------------------------------------------add.rule(strategy.st,name='ruleSignal',         arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,                           replace=FALSE,                           orderside='long',                           ordertype='stoplimit',                           tmult=TRUE,                           threshold=quote( longStopLossDistance ),                           orderqty='all',                           orderset='ocolong',                           TxnFees = txn.model),         type='chain', parent="longenter",         label='StopLossLong',         enabled=FALSE)
# Short Entry Rule--------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.lt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty=positionSizeShort,                           #osFUN="osAllInShort",                            ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='enter',         label='shortenter',         enabled=FALSE         #timespan = xxxx,         #store=TRUE         #storefun=FALSE )
# Short Exit Rule---------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.gt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='exit',         label='shortexit',         enabled=FALSE         #timespan = xxxx,         #store=TRUE)
# Short Stop Loss Rule-----------------------------------------------------------------add.rule(strategy.st,name='ruleSignal',         arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,                           replace=FALSE,                           orderside='short',                           ordertype='stoplimit',                           tmult=TRUE,                           threshold=quote( shortStopLossDistance ),                           orderqty='all',                           orderset='ocoshort',                           TxnFees = txn.model),         type='chain', parent="shortenter",         label='StopLossShort',         enabled=FALSE)

#Indicator Optimization-------------------------------------------------------------add.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = 'indicator',                 component.label = "fastsma",                 variable = list( n = FastSMARange ),                                label = "FastSMARANGE")

add.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = 'indicator',                 component.label = "slowsma",                 variable = list( n = SlowSMARange ),                 label = "SlowSMARANGE")
add.distribution.constraint(strategy.st,                            paramset.label = 'SMA_OPT',                            distribution.label.1 = 'FastSMARANGE',                            distribution.label.2 = 'SlowSMARANGE',                            operator = '<',                            label = 'FastSMA<SlowSMA')

#SL/Trail-SL/TP Optimization-----------------------------------------------------------------
#Long Stoploss Optimizationadd.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = "chain",                 component.label = "StopLossLong",                 variable = list( threshold = StopLossDistanceRange ),                 label = "StopLossLONG")
#Short Stoploss Optimizationadd.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = "chain",                 component.label = "StopLossShort",                 variable = list( threshold = StopLossDistanceRange ),                 label = "StopLossSHORT")
#Long&Short Stoploss Distance Constraintadd.distribution.constraint(strategy.st,                            paramset.label = paramset.label.name,                            distribution.label.1 = "StopLossLONG",                            distribution.label.2 = "StopLossSHORT",                            operator = "==",                            label = "StoplossEquality")

enable.rule(strategy.st,type="enter",label="longenter", enable = TRUE) enable.rule(strategy.st,type="exit",label="longexit", enable = TRUE)enable.rule(strategy.st,type="enter",label="shortenter", enable = TRUE) enable.rule(strategy.st,type="exit",label="shortexit", enable = TRUE)enable.rule(strategy.st,type="chain",label="StopLossLong", enable = TRUE)enable.rule(strategy.st,type="chain",label="StopLossShort", enable = TRUE) summary(getStrategy(strategy.st))                                              

#First run apply.paramset()paramsetenv<-new.env()cl <- snow::makeCluster(4, type = "SOCK")registerDoSNOW(cl)results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,                          audit=paramsetenv)snow::stopCluster(cl)results.df <- data.frame(results$tradeStats)

#Second run applyStrategy()longStopLossDistance <- 0.005                  #SL of best combination by NetPnLshortStopLossDistance <- 0.005                  #SL of best combination by NetPnL
applyStrategy( strategy=strategy.st , portfolios=strategy.st  ,verbose=TRUE)updatePortf(strategy.st)updateAcct(strategy.st)updateEndEq(strategy.st)
results.df.2 <- data.frame(tradeStats(strategy.st))
#Check NetPnL resulting from apply.paramset vs applyStrategyresults.df$Net.Trading.PL[12]  == results.df.2$Net.Trading.PL 		 	   		  
	[[alternative HTML version deleted]]


From atakanokan at outlook.com  Mon Apr 25 17:43:33 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Mon, 25 Apr 2016 18:43:33 +0300
Subject: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs
	applyStrategy
In-Reply-To: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>
References: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>
Message-ID: <BAY172-W446C7A7592C3AB0B5FEFCDC7620@phx.gbl>

So the code seems a bit odd, the indentation must have somehow caused some problems when emailing.
This a better and a little bit more compact one:
library(lattice);library(foreach);library(doSNOW);library(ggplot2)library(gridExtra);library(reshape);library(beepr);library(quantstrat) library(doSNOW)Sys.setenv(TZ="UTC")                                                                                 .strategy<- new.env();.blotter<- new.env()                                                                                                                             
currency('USD')                                                                                                                                                                      stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)
getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")AAPL <- adjustOHLC(AAPL)
strategy.st <- paste("AAPL","MACD_D1",sep = "_")rm.strat(strategy.st) 
initialEquity = 100000                                                                               initDate = "2013-12-30" initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")initOrders(portfolio=strategy.st,initDate=initDate) strategy(strategy.st,store=TRUE)
customFees <- function (TxnQty, ...) {  return(abs(TxnQty) * -0.01)}txn.model <- "customFees"    
positionSizeLong  =  1000     positionSizeShort =  -1000     

paramset.label.name <- "SMA_OPT"FastSMARange <- seq(5,21,by=8)SlowSMARange <- seq(10,50,by=20)StopLossDistanceRange <- seq(0.0025,0.005,by=0.0025)                               

add.indicator(strategy.st,                                                             name = "SMA",                                                             arguments = list(x=Cl(eval(parse(text = "AAPL")))                               ,n=5   #fastsma of best combination by NetPnL              ),                                                                          label='fastsma')                                           
add.indicator(strategy.st,                                                               name = "SMA",                                                              arguments = list(x=Cl(eval(parse(text = "AAPL")))                               ,n=50    #slowsma of best combination by NetPnL              ),                                                                         label='slowsma')                                             
add.signal(strategy.st,           name="sigCrossover",           arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),           label="fastsma.gt.slowsma")                                                        
add.signal(strategy.st,           name="sigCrossover",           arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),           label="fastsma.lt.slowsma")
add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.gt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty= positionSizeLong,                           #osFUN="osAllInLong",                            ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='enter',         label='longenter',         enabled=TRUE)
# Long Exit Rule-------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.lt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='exit',         label='longexit',         enabled=TRUE)
# Long StopLoss Rule---------------------------------------------------------------------------add.rule(strategy.st,name='ruleSignal',         arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,                           replace=FALSE,                           orderside='long',                           ordertype='stoplimit',                           tmult=TRUE,                           threshold=quote( longStopLossDistance ),                           orderqty='all',                           orderset='ocolong',                           TxnFees = txn.model),         type='chain', parent="longenter",         label='StopLossLong',         enabled=TRUE)
# Short Entry Rule--------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.lt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty=positionSizeShort,                           #osFUN="osAllInShort",                            ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='enter',         label='shortenter',         enabled=TRUE)
# Short Exit Rule---------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.gt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='exit',         label='shortexit',         enabled=TRUE)
# Short Stop Loss Rule-----------------------------------------------------------------add.rule(strategy.st,name='ruleSignal',         arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,                           replace=FALSE,                           orderside='short',                           ordertype='stoplimit',                           tmult=TRUE,                           threshold=quote( shortStopLossDistance ),                           orderqty='all',                           orderset='ocoshort',                           TxnFees = txn.model),         type='chain', parent="shortenter",         label='StopLossShort',         enabled=TRUE)

#Indicator Optimization-------------------------------------------------------------add.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = 'indicator',                 component.label = "fastsma",                 variable = list( n = FastSMARange ),                                label = "FastSMARANGE")

add.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = 'indicator',                 component.label = "slowsma",                 variable = list( n = SlowSMARange ),                 label = "SlowSMARANGE")
add.distribution.constraint(strategy.st,                            paramset.label = 'SMA_OPT',                            distribution.label.1 = 'FastSMARANGE',                            distribution.label.2 = 'SlowSMARANGE',                            operator = '<',                            label = 'FastSMA<SlowSMA')

#SL/Trail-SL/TP Optimization-----------------------------------------------------------------
#Long Stoploss Optimizationadd.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = "chain",                 component.label = "StopLossLong",                 variable = list( threshold = StopLossDistanceRange ),                 label = "StopLossLONG")
#Short Stoploss Optimizationadd.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = "chain",                 component.label = "StopLossShort",                 variable = list( threshold = StopLossDistanceRange ),                 label = "StopLossSHORT")
#Long&Short Stoploss Distance Constraintadd.distribution.constraint(strategy.st,                            paramset.label = paramset.label.name,                            distribution.label.1 = "StopLossLONG",                            distribution.label.2 = "StopLossSHORT",                            operator = "==",                            label = "StoplossEquality")
summary(getStrategy(strategy.st))                                              

#First run apply.paramset()paramsetenv<-new.env()cl <- snow::makeCluster(4, type = "SOCK")registerDoSNOW(cl)results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,                          audit=paramsetenv)snow::stopCluster(cl)results.df <- data.frame(results$tradeStats)

#Second run applyStrategy()longStopLossDistance <- 0.005   #SL of best combination by NetPnLshortStopLossDistance <- 0.005  #SL of best combination by NetPnL
applyStrategy( strategy=strategy.st , portfolios=strategy.st               #,parameters=list(n = 5)               ,verbose=TRUE)updatePortf(strategy.st)updateAcct(strategy.st)updateEndEq(strategy.st)
results.df.2 <- data.frame(tradeStats(strategy.st))
#Check NetPnL apply.paramset vs applyStrategyresults.df$Net.Trading.PL[12]  == results.df.2$Net.Trading.PL
From: atakanokan at outlook.com
To: r-sig-finance at r-project.org
Subject: Custom Txnfee function in apply.paramset vs applyStrategy
Date: Sun, 24 Apr 2016 21:36:33 +0300




Hi,
I have been experimenting with different custom transaction fee models for different assets and I realized that apply.paramset and applyStrategy yields different results when a custom transaction fee function is used. 
The reproducible example is below, and even though apply.paramset yields a NetPnL result of 21779 with the custom transaction fee model, applyStrategy yields 21509, which makes me believe that apply.paramset somehow is not incorporating the fees. The comparison of NetPnL results were made with the parameter combination of FastSMA=5, SlowSMA=50 and Stoploss=0.005.
Any help is appreciated, thanks.
Atakan Okan
Code:
library(lattice);library(foreach);library(doSNOW);library(ggplot2)library(gridExtra);library(reshape);library(beepr);library(quantstrat) library(doSNOW)Sys.setenv(TZ="UTC")                                                                                 .strategy<- new.env();.blotter<- new.env()                                                                                                                             
currency('USD')                                                                                                                                                                      stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)
getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")AAPL <- adjustOHLC(AAPL)
strategy.st <- paste("AAPL","MACD_D1",sep = "_")rm.strat(strategy.st) 
initialEquity = 100000                                                                               initDate = "2013-12-30" initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")initOrders(portfolio=strategy.st,initDate=initDate) strategy(strategy.st,store=TRUE)
customFees <- function (TxnQty, ...) {  return(abs(TxnQty) * -0.01)}txn.model <- "customFees"    
positionSizeLong  =  1000     positionSizeShort =  -1000     

paramset.label.name <- "SMA_OPT"FastSMARange <- seq(5,21,by=8)SlowSMARange <- seq(10,50,by=20)StopLossDistanceRange <- seq(0.0025,0.005,by=0.0025)                               

add.indicator(strategy.st,                                                             name = "SMA",                                                             arguments = list(x=Cl(eval(parse(text = "AAPL")))                               ,n=5   #fastsma of best combination by NetPnL              ),                                                                          label='fastsma')                                           
add.indicator(strategy.st,                                                               name = "SMA",                                                              arguments = list(x=Cl(eval(parse(text = "AAPL")))                               ,n=50    #slowsma of best combination by NetPnL              ),                                                                         label='slowsma')                                             
add.signal(strategy.st,           name="sigCrossover",           arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),           label="fastsma.gt.slowsma")                                                        
add.signal(strategy.st,           name="sigCrossover",           arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),           label="fastsma.lt.slowsma")
add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.gt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty= positionSizeLong,                           #osFUN="osAllInLong",                            ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='enter',         label='longenter',         enabled=FALSE         #timespan = xxxx,         #store=TRUE         #storefun=FALSE )
# Long Exit Rule-------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.lt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='exit',         label='longexit',         enabled=FALSE         #timespan = xxxx,         #store=TRUE)
# Long StopLoss Rule---------------------------------------------------------------------------add.rule(strategy.st,name='ruleSignal',         arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,                           replace=FALSE,                           orderside='long',                           ordertype='stoplimit',                           tmult=TRUE,                           threshold=quote( longStopLossDistance ),                           orderqty='all',                           orderset='ocolong',                           TxnFees = txn.model),         type='chain', parent="longenter",         label='StopLossLong',         enabled=FALSE)
# Short Entry Rule--------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.lt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty=positionSizeShort,                           #osFUN="osAllInShort",                            ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='enter',         label='shortenter',         enabled=FALSE         #timespan = xxxx,         #store=TRUE         #storefun=FALSE )
# Short Exit Rule---------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="fastsma.gt.slowsma",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='exit',         label='shortexit',         enabled=FALSE         #timespan = xxxx,         #store=TRUE)
# Short Stop Loss Rule-----------------------------------------------------------------add.rule(strategy.st,name='ruleSignal',         arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,                           replace=FALSE,                           orderside='short',                           ordertype='stoplimit',                           tmult=TRUE,                           threshold=quote( shortStopLossDistance ),                           orderqty='all',                           orderset='ocoshort',                           TxnFees = txn.model),         type='chain', parent="shortenter",         label='StopLossShort',         enabled=FALSE)

#Indicator Optimization-------------------------------------------------------------add.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = 'indicator',                 component.label = "fastsma",                 variable = list( n = FastSMARange ),                                label = "FastSMARANGE")

add.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = 'indicator',                 component.label = "slowsma",                 variable = list( n = SlowSMARange ),                 label = "SlowSMARANGE")
add.distribution.constraint(strategy.st,                            paramset.label = 'SMA_OPT',                            distribution.label.1 = 'FastSMARANGE',                            distribution.label.2 = 'SlowSMARANGE',                            operator = '<',                            label = 'FastSMA<SlowSMA')

#SL/Trail-SL/TP Optimization-----------------------------------------------------------------
#Long Stoploss Optimizationadd.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = "chain",                 component.label = "StopLossLong",                 variable = list( threshold = StopLossDistanceRange ),                 label = "StopLossLONG")
#Short Stoploss Optimizationadd.distribution(strategy.st,                 paramset.label = paramset.label.name,                 component.type = "chain",                 component.label = "StopLossShort",                 variable = list( threshold = StopLossDistanceRange ),                 label = "StopLossSHORT")
#Long&Short Stoploss Distance Constraintadd.distribution.constraint(strategy.st,                            paramset.label = paramset.label.name,                            distribution.label.1 = "StopLossLONG",                            distribution.label.2 = "StopLossSHORT",                            operator = "==",                            label = "StoplossEquality")

enable.rule(strategy.st,type="enter",label="longenter", enable = TRUE) enable.rule(strategy.st,type="exit",label="longexit", enable = TRUE)enable.rule(strategy.st,type="enter",label="shortenter", enable = TRUE) enable.rule(strategy.st,type="exit",label="shortexit", enable = TRUE)enable.rule(strategy.st,type="chain",label="StopLossLong", enable = TRUE)enable.rule(strategy.st,type="chain",label="StopLossShort", enable = TRUE) summary(getStrategy(strategy.st))                                              

#First run apply.paramset()paramsetenv<-new.env()cl <- snow::makeCluster(4, type = "SOCK")registerDoSNOW(cl)results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,                          audit=paramsetenv)snow::stopCluster(cl)results.df <- data.frame(results$tradeStats)

#Second run applyStrategy()longStopLossDistance <- 0.005                  #SL of best combination by NetPnLshortStopLossDistance <- 0.005                  #SL of best combination by NetPnL
applyStrategy( strategy=strategy.st , portfolios=strategy.st  ,verbose=TRUE)updatePortf(strategy.st)updateAcct(strategy.st)updateEndEq(strategy.st)
results.df.2 <- data.frame(tradeStats(strategy.st))
#Check NetPnL resulting from apply.paramset vs applyStrategyresults.df$Net.Trading.PL[12]  == results.df.2$Net.Trading.PL 		 	   		   		 	   		  
	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Mon Apr 25 18:20:29 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 25 Apr 2016 11:20:29 -0500
Subject: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs
	applyStrategy
In-Reply-To: <BAY172-W446C7A7592C3AB0B5FEFCDC7620@phx.gbl>
References: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>
	<BAY172-W446C7A7592C3AB0B5FEFCDC7620@phx.gbl>
Message-ID: <CAPPM_gR_QGj+edpusOCATOSnkf0T8chFaoDYa1HsRVL-YzJC7w@mail.gmail.com>

The problem is that you're sending HTML, which the posting guide tells
you not to do:
https://www.r-project.org/posting-guide.html
See also the first paragraph in the "General Instructions" section at
the bottom of:
https://www.r-project.org/mail.html

On Mon, Apr 25, 2016 at 10:43 AM, Atakan Okan <atakanokan at outlook.com> wrote:
> So the code seems a bit odd, the indentation must have somehow caused some problems when emailing.
> This a better and a little bit more compact one:
<snip mangled code>
> From: atakanokan at outlook.com
> To: r-sig-finance at r-project.org
> Subject: Custom Txnfee function in apply.paramset vs applyStrategy
> Date: Sun, 24 Apr 2016 21:36:33 +0300
>
>
>
>
> Hi,
> I have been experimenting with different custom transaction fee models for different assets and I realized that apply.paramset and applyStrategy yields different results when a custom transaction fee function is used.
> The reproducible example is below, and even though apply.paramset yields a NetPnL result of 21779 with the custom transaction fee model, applyStrategy yields 21509, which makes me believe that apply.paramset somehow is not incorporating the fees. The comparison of NetPnL results were made with the parameter combination of FastSMA=5, SlowSMA=50 and Stoploss=0.005.
> Any help is appreciated, thanks.
> Atakan Okan
> Code:
<snip mangled code>
>         [[alternative HTML version deleted]]
>
^^^ There's your problem.

> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From atakanokan at outlook.com  Mon Apr 25 18:47:31 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Mon, 25 Apr 2016 19:47:31 +0300
Subject: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs
 applyStrategy
In-Reply-To: <CAPPM_gR_QGj+edpusOCATOSnkf0T8chFaoDYa1HsRVL-YzJC7w@mail.gmail.com>
References: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>
	<BAY172-W446C7A7592C3AB0B5FEFCDC7620@phx.gbl>,
	<CAPPM_gR_QGj+edpusOCATOSnkf0T8chFaoDYa1HsRVL-YzJC7w@mail.gmail.com>
Message-ID: <BAY172-W5272E1024BE864DFC04158C7620@phx.gbl>

Oh sorry about that. Thanks for pointing it out Mr.Ulrich. If it did not work, I will use an gmail account  to send the code for the next try. 

Here is the code:

library(lattice);library(foreach);library(doSNOW);library(ggplot2)
library(gridExtra);library(reshape);library(beepr);library(quantstrat) 
library(doSNOW)
Sys.setenv(TZ="UTC")                                                                                 
.strategy<- new.env();.blotter<- new.env()                                                                                                                             

currency('USD')                                                                                                                                                                      
stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)

getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")
AAPL <- adjustOHLC(AAPL)

strategy.st <- paste("AAPL","MACD_D1",sep = "_")
rm.strat(strategy.st) 

initialEquity = 100000                                                                               
initDate = "2013-12-30" 
initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")
initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")
initOrders(portfolio=strategy.st,initDate=initDate) 
strategy(strategy.st,store=TRUE)

customFees <- function (TxnQty, ...) 
{
  return(abs(TxnQty) * -0.01)
}
txn.model <- "customFees"    

positionSizeLong  =  1000     
positionSizeShort =  -1000     


paramset.label.name <- "SMA_OPT"
FastSMARange <- seq(5,21,by=8)
SlowSMARange <- seq(10,50,by=20)
StopLossDistanceRange <- seq(0.0025,0.005,by=0.0025)                               


add.indicator(strategy.st,                                               
              name = "SMA",                                               
              arguments = list(x=Cl(eval(parse(text = "AAPL")))
                               ,n=5   #fastsma of best combination by NetPnL
              ),                                                            
              label='fastsma')                                           

add.indicator(strategy.st,                                                 
              name = "SMA",                                                
              arguments = list(x=Cl(eval(parse(text = "AAPL")))
                               ,n=50    #slowsma of best combination by NetPnL
              ),                                                           
              label='slowsma')                                             

add.signal(strategy.st,
           name="sigCrossover",
           arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),
           label="fastsma.gt.slowsma")                                                        

add.signal(strategy.st,
           name="sigCrossover",
           arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),
           label="fastsma.lt.slowsma")

add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.gt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty= positionSizeLong, 
                          #osFUN="osAllInLong",  
                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = txn.model),
         type='enter',
         label='longenter',
         enabled=TRUE
)

# Long Exit Rule-------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.lt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty='all',
                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = txn.model),
         type='exit',
         label='longexit',
         enabled=TRUE
)

# Long StopLoss Rule---------------------------------------------------------------------------
add.rule(strategy.st,name='ruleSignal',
         arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,
                           replace=FALSE,
                           orderside='long',
                           ordertype='stoplimit',
                           tmult=TRUE,
                           threshold=quote( longStopLossDistance ),
                           orderqty='all',
                           orderset='ocolong',
                           TxnFees = txn.model),
         type='chain', parent="longenter",
         label='StopLossLong',
         enabled=TRUE)

# Short Entry Rule--------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.lt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty=positionSizeShort, 
                          #osFUN="osAllInShort",  
                          ordertype='market',
                          orderside='short',
                          orderset='ocoshort',
                          TxnFees = txn.model),
         type='enter',
         label='shortenter',
         enabled=TRUE
)

# Short Exit Rule---------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.gt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty='all',
                          ordertype='market',
                          orderside='short',
                          orderset='ocoshort',
                          TxnFees = txn.model),
         type='exit',
         label='shortexit',
         enabled=TRUE
)

# Short Stop Loss Rule-----------------------------------------------------------------
add.rule(strategy.st,name='ruleSignal',
         arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,
                           replace=FALSE,
                           orderside='short',
                           ordertype='stoplimit',
                           tmult=TRUE,
                           threshold=quote( shortStopLossDistance ),
                           orderqty='all',
                           orderset='ocoshort',
                           TxnFees = txn.model),
         type='chain', parent="shortenter",
         label='StopLossShort',
         enabled=TRUE)


#Indicator Optimization-------------------------------------------------------------
add.distribution(strategy.st,
                 paramset.label = paramset.label.name,
                 component.type = 'indicator',
                 component.label = "fastsma",
                 variable = list( n = FastSMARange ),               
                 label = "FastSMARANGE")


add.distribution(strategy.st,
                 paramset.label = paramset.label.name,
                 component.type = 'indicator',
                 component.label = "slowsma",
                 variable = list( n = SlowSMARange ),
                 label = "SlowSMARANGE")

add.distribution.constraint(strategy.st,
                            paramset.label = 'SMA_OPT',
                            distribution.label.1 = 'FastSMARANGE',
                            distribution.label.2 = 'SlowSMARANGE',
                            operator = '<',
                            label = 'FastSMA<- snow::makeCluster(4, type = "SOCK")
registerDoSNOW(cl)
results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,
                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,
                          audit=paramsetenv)
snow::stopCluster(cl)
results.df <- data.frame(results$tradeStats)


#Second run applyStrategy()
longStopLossDistance <- 0.005   #SL of best combination by NetPnL
shortStopLossDistance <- 0.005  #SL of best combination by NetPnL

applyStrategy( strategy=strategy.st , portfolios=strategy.st
               #,parameters=list(n = 5)
               ,verbose=TRUE)
updatePortf(strategy.st)
updateAcct(strategy.st)
updateEndEq(strategy.st)

results.df.2 <- data.frame(tradeStats(strategy.st))

#Check NetPnL apply.paramset vs applyStrategy
results.df$Net.Trading.PL[12]  == results.df.2$Net.Trading.PL






> From: josh.m.ulrich at gmail.com
> Date: Mon, 25 Apr 2016 11:20:29 -0500
> Subject: Re: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs applyStrategy
> To: atakanokan at outlook.com
> CC: r-sig-finance at r-project.org
> 
> The problem is that you're sending HTML, which the posting guide tells
> you not to do:
> https://www.r-project.org/posting-guide.html
> See also the first paragraph in the "General Instructions" section at
> the bottom of:
> https://www.r-project.org/mail.html
> 
> On Mon, Apr 25, 2016 at 10:43 AM, Atakan Okan  wrote:
>> So the code seems a bit odd, the indentation must have somehow caused some problems when emailing.
>> This a better and a little bit more compact one:
> 
>> From: atakanokan at outlook.com
>> To: r-sig-finance at r-project.org
>> Subject: Custom Txnfee function in apply.paramset vs applyStrategy
>> Date: Sun, 24 Apr 2016 21:36:33 +0300
>>
>>
>>
>>
>> Hi,
>> I have been experimenting with different custom transaction fee models for different assets and I realized that apply.paramset and applyStrategy yields different results when a custom transaction fee function is used.
>> The reproducible example is below, and even though apply.paramset yields a NetPnL result of 21779 with the custom transaction fee model, applyStrategy yields 21509, which makes me believe that apply.paramset somehow is not incorporating the fees. The comparison of NetPnL results were made with the parameter combination of FastSMA=5, SlowSMA=50 and Stoploss=0.005.
>> Any help is appreciated, thanks.
>> Atakan Okan
>> Code:
> 
>> [[alternative HTML version deleted]]
>>
> ^^^ There's your problem.
> 
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.
> 
> 
> 
> -- 
> Joshua Ulrich | about.me/joshuaulrich
> FOSS Trading | www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com
 		 	   		  
	[[alternative HTML version deleted]]


From atakanokan at outlook.com  Tue Apr 26 18:32:26 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Tue, 26 Apr 2016 19:32:26 +0300
Subject: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs
 applyStrategy
In-Reply-To: <BAY172-W5272E1024BE864DFC04158C7620@phx.gbl>
References: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>,
	<BAY172-W446C7A7592C3AB0B5FEFCDC7620@phx.gbl>,
	<CAPPM_gR_QGj+edpusOCATOSnkf0T8chFaoDYa1HsRVL-YzJC7w@mail.gmail.com>,
	<BAY172-W5272E1024BE864DFC04158C7620@phx.gbl>
Message-ID: <BAY172-W123C5390D71AF22456CE0CC7630@phx.gbl>

Forgot to add, just run the complete script till the comment "#Second run applyStrategy()". For the second run, just rerun the whole script without the code block below:

registerDoSNOW(cl)
results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,
                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,
                          audit=paramsetenv)
snow::stopCluster(cl)
results.df <- data.frame(results$tradeStats)

Atakan Okan 		 	   		  
	[[alternative HTML version deleted]]


From atakanokan at outlook.com  Tue Apr 26 18:34:49 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Tue, 26 Apr 2016 19:34:49 +0300
Subject: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs
 applyStrategy
In-Reply-To: <BAY172-W123C5390D71AF22456CE0CC7630@phx.gbl>
References: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>,
	<BAY172-W446C7A7592C3AB0B5FEFCDC7620@phx.gbl>,
	<CAPPM_gR_QGj+edpusOCATOSnkf0T8chFaoDYa1HsRVL-YzJC7w@mail.gmail.com>,
	<BAY172-W5272E1024BE864DFC04158C7620@phx.gbl>,
	<BAY172-W123C5390D71AF22456CE0CC7630@phx.gbl>
Message-ID: <BAY172-W43054B8BD60D23655D53AAC7630@phx.gbl>

And I would be grateful, if somebody could just confirm that the reproducible code was sent succesfully, as the code seems to be sent fine in its thread in r-sig-finance archives. Thanks again.

________________________________
> From: atakanokan at outlook.com 
> To: r-sig-finance at r-project.org 
> Subject: RE: [R-SIG-Finance] Custom Txnfee function in apply.paramset 
> vs applyStrategy 
> Date: Tue, 26 Apr 2016 19:32:26 +0300 
> 
> Forgot to add, just run the complete script till the comment "#Second 
> run applyStrategy()". For the second run, just rerun the whole script 
> without the code block below: registerDoSNOW(cl) results <- 
> apply.paramset(strategy.st,paramset.label=paramset.label.name, 
> portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE, 
> audit=paramsetenv) snow::stopCluster(cl) results.df <- 
> data.frame(results$tradeStats) Atakan Okan 
 		 	   		  

From stephen at organicfoodmarkets.com.au  Tue Apr 26 21:36:22 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Wed, 27 Apr 2016 05:36:22 +1000
Subject: [R-SIG-Finance] problem placing order
Message-ID: <571FC336.4030003@organicfoodmarkets.com.au>

Hi

I wonder if someone can see what I am doing wrong.


library(IBrokers)

tws <- twsConnect()

sym <- "WBC"

contract <-twsEquity(sym, exch='ASX', currency='AUD')

# these work
price <- reqMktData(tws, contract, snapshot="TRUE")
price$Close

size <- 1000

order <- twsOrder(reqIds(tws), 'BUY', size, 'MKT')

#this doesn't produce an order in the tws
placeOrder(tws, contract, order)


closeAllConnections()

reqMktData works but placeOrder does not.


----------------------------------------------------------------------------------------------------------------------------------- 

Stephen Choularton PhD, FIoD
0413 545 182


From stephen at organicfoodmarkets.com.au  Wed Apr 27 02:06:22 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Wed, 27 Apr 2016 10:06:22 +1000
Subject: [R-SIG-Finance] problem placing order
In-Reply-To: <571FC336.4030003@organicfoodmarkets.com.au>
References: <571FC336.4030003@organicfoodmarkets.com.au>
Message-ID: <5720027E.6060802@organicfoodmarkets.com.au>

Hi

Apologies - turned out to be to do with my settings.  Looks like the 
code is right.


----------------------------------------------------------------------------------------------------------------------------------- 

Stephen Choularton PhD, FIoD
0413 545 182


On 27/04/2016 5:36 AM, Stephen Choularton wrote:
> Hi
>
> I wonder if someone can see what I am doing wrong.
>
>
> library(IBrokers)
>
> tws <- twsConnect()
>
> sym <- "WBC"
>
> contract <-twsEquity(sym, exch='ASX', currency='AUD')
>
> # these work
> price <- reqMktData(tws, contract, snapshot="TRUE")
> price$Close
>
> size <- 1000
>
> order <- twsOrder(reqIds(tws), 'BUY', size, 'MKT')
>
> #this doesn't produce an order in the tws
> placeOrder(tws, contract, order)
>
>
> closeAllConnections()
>
> reqMktData works but placeOrder does not.
>
>
> ----------------------------------------------------------------------------------------------------------------------------------- 
>
> Stephen Choularton PhD, FIoD
> 0413 545 182
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R 
> questions should go.
>


From stephen at organicfoodmarkets.com.au  Wed Apr 27 03:17:46 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Wed, 27 Apr 2016 11:17:46 +1000
Subject: [R-SIG-Finance] problem placing order
In-Reply-To: <5720027E.6060802@organicfoodmarkets.com.au>
References: <571FC336.4030003@organicfoodmarkets.com.au>
	<5720027E.6060802@organicfoodmarkets.com.au>
Message-ID: <5720133A.6040609@organicfoodmarkets.com.au>

Further apologies - I have been asked to specify the problem/solution 
and I'm rather embarrassed to say it was because I had the order box set 
to transactions and I was trying to run the code before the exchange was 
open ;-(

Just proves having a Computing Science PhD doesn't stop you getting lost 
in all of this.

Thanks.
----------------------------------------------------------------------------------------------------------------------------------- 

Stephen Choularton PhD, FIoD
0413 545 182

On 27/04/2016 10:06 AM, Stephen Choularton wrote:
> Hi
>
> Apologies - turned out to be to do with my settings.  Looks like the 
> code is right.
>
>
> ----------------------------------------------------------------------------------------------------------------------------------- 
>
> Stephen Choularton PhD, FIoD
> 0413 545 182
>
>
> On 27/04/2016 5:36 AM, Stephen Choularton wrote:
>> Hi
>>
>> I wonder if someone can see what I am doing wrong.
>>
>>
>> library(IBrokers)
>>
>> tws <- twsConnect()
>>
>> sym <- "WBC"
>>
>> contract <-twsEquity(sym, exch='ASX', currency='AUD')
>>
>> # these work
>> price <- reqMktData(tws, contract, snapshot="TRUE")
>> price$Close
>>
>> size <- 1000
>>
>> order <- twsOrder(reqIds(tws), 'BUY', size, 'MKT')
>>
>> #this doesn't produce an order in the tws
>> placeOrder(tws, contract, order)
>>
>>
>> closeAllConnections()
>>
>> reqMktData works but placeOrder does not.
>>
>>
>> ----------------------------------------------------------------------------------------------------------------------------------- 
>>
>> Stephen Choularton PhD, FIoD
>> 0413 545 182
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R 
>> questions should go.
>>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R 
> questions should go.
>


From pankajsbi at yahoo.com  Thu Apr 28 18:30:15 2016
From: pankajsbi at yahoo.com (Pankaj K Agarwal)
Date: Thu, 28 Apr 2016 16:30:15 +0000 (UTC)
Subject: [R-SIG-Finance] Default Premium
References: <1624111945.3013270.1461861015575.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1624111945.3013270.1461861015575.JavaMail.yahoo@mail.yahoo.com>

Dear All,I am not sure this question qualifies for this group. But I am using R for handling this project therefore posting. Sorry if I should not have.In a paper by Christopher, Ferson and Schadt, 1998 (Conditioning Manager Alphas on Economic Information: Another Look at the Persistence of Performance), they compute default premium by taking yield spread of AAA and BAA bonds. I am trying to do a similar study but have only AAA bonds and Government Securities yield spreads available. No data on BAA available.?Question: Can Spread (AAA-Government Bonds) be used to measure default premium in place of Spread (BAA-AAA) ?I will be immensely obliged for help.?Regards,Pankaj K Agarwal
Researcher in Mutual FundsIndia+91-98397-11444

	[[alternative HTML version deleted]]


From frankm60606 at gmail.com  Fri Apr 29 01:47:21 2016
From: frankm60606 at gmail.com (Frank)
Date: Thu, 28 Apr 2016 18:47:21 -0500
Subject: [R-SIG-Finance] Default Premium
In-Reply-To: <1624111945.3013270.1461861015575.JavaMail.yahoo@mail.yahoo.com>
References: <1624111945.3013270.1461861015575.JavaMail.yahoo.ref@mail.yahoo.com>
	<1624111945.3013270.1461861015575.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <FE6B9545917146C28C9B0F2FCF6AC6B2@Franki7PC>

Moody's Seasoned Baa Corporate Bond Yield?

Available from FRED:

https://research.stlouisfed.org/fred2/series/DBAA

Frank
Chicago, IL

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of Pankaj K Agarwal via R-SIG-Finance
Sent: Thursday, April 28, 2016 11:30 AM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] Default Premium

Dear All,I am not sure this question qualifies for this group. But I am
using R for handling this project therefore posting. Sorry if I should not
have.In a paper by Christopher, Ferson and Schadt, 1998 (Conditioning
Manager Alphas on Economic Information: Another Look at the Persistence of
Performance), they compute default premium by taking yield spread of AAA and
BAA bonds. I am trying to do a similar study but have only AAA bonds and
Government Securities yield spreads available. No data on BAA
available.?Question: Can Spread (AAA-Government Bonds) be used to measure
default premium in place of Spread (BAA-AAA) ?I will be immensely obliged
for help.?Regards,Pankaj K Agarwal
Researcher in Mutual FundsIndia+91-98397-11444

	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From pankajsbi at yahoo.com  Fri Apr 29 07:40:16 2016
From: pankajsbi at yahoo.com (Pankaj K Agarwal)
Date: Fri, 29 Apr 2016 05:40:16 +0000 (UTC)
Subject: [R-SIG-Finance] Default Premium
In-Reply-To: <FE6B9545917146C28C9B0F2FCF6AC6B2@Franki7PC>
References: <FE6B9545917146C28C9B0F2FCF6AC6B2@Franki7PC>
Message-ID: <788469561.3175129.1461908416581.JavaMail.yahoo@mail.yahoo.com>

Dear FrankThanks. But i forgot to mention i am looking for Indian Bond market data for which BAA yields are not available. Anyone can help??Regards,Pankaj K Agarwal
+91-98397-11444http://in.linkedin.com/in/pankajkagarwal/ 

    On Friday, 29 April 2016 5:16 AM, Frank <frankm60606 at gmail.com> wrote:
 
 

 Moody's Seasoned Baa Corporate Bond Yield?

Available from FRED:

https://research.stlouisfed.org/fred2/series/DBAA

Frank
Chicago, IL

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of Pankaj K Agarwal via R-SIG-Finance
Sent: Thursday, April 28, 2016 11:30 AM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] Default Premium

Dear All,I am not sure this question qualifies for this group. But I am
using R for handling this project therefore posting. Sorry if I should not
have.In a paper by Christopher, Ferson and Schadt, 1998 (Conditioning
Manager Alphas on Economic Information: Another Look at the Persistence of
Performance), they compute default premium by taking yield spread of AAA and
BAA bonds. I am trying to do a similar study but have only AAA bonds and
Government Securities yield spreads available. No data on BAA
available.?Question: Can Spread (AAA-Government Bonds) be used to measure
default premium in place of Spread (BAA-AAA) ?I will be immensely obliged
for help.?Regards,Pankaj K Agarwal
Researcher in Mutual FundsIndia+91-98397-11444

??? [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.



  
	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Mon May  2 18:37:51 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 2 May 2016 11:37:51 -0500
Subject: [R-SIG-Finance] R/Finance 2016 registration now open
In-Reply-To: <CAPPM_gQUv=6u+ej=pS-X83Z7UkRXm1Ztx9G9gZX7i8aqL_bUDA@mail.gmail.com>
References: <CAPPM_gQUv=6u+ej=pS-X83Z7UkRXm1Ztx9G9gZX7i8aqL_bUDA@mail.gmail.com>
Message-ID: <CAPPM_gSU2D4Ab0W4bJr8+PTicerPwBxKcgOj3gBcXbA3z1=Cig@mail.gmail.com>

A friendly reminder that early registration ends this Friday, May 6,
2016.  Registration fees will increase by 50% after Friday.


On Mon, Apr 11, 2016 at 8:23 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> Registration for R/Finance 2016 is now open!
>
> The conference will take place on May 20 and 21, at UIC in Chicago.
> Building on the success of the previous conferences in 2009-2015, we
> expect more than 250 attendees from around the world. R users from
> industry, academia, and government will joining 50 presenters covering
> all areas of finance with R.
>
> We are very excited about the four keynote presentations given by
> Patrick Burns, Frank Diebold, Tarek Eldin, and Rishi Narang.  The
> conference agenda (currently) includes 17 full presentations and 33
> shorter "lightning talks".  As in previous years, several (optional)
> pre-conference seminars are offered on Friday morning.
>
> There is also an (optional) conference dinner at The Riverside Room
> and Gallery at Trump.  Situated directly on the hotel's new River
> Walk, it is a perfect venue to continue conversations while dining and
> drinking.
>
> As they are finalized, agenda details are available at:
>   http://www.RinFinance.com/agenda/
>
> Registration information is available at:
>   http://www.RinFinance.com/register/
>
> and can also be directly accessed by going to:
>   http://go.uic.edu/rfinance
>
> Please note that registration fees will increase by 50% at the end of
> early registration on May 6, 2016.
>
> We would to thank our 2016 Sponsors for the continued support enabling us
> to host such an exciting conference:
>
>   UIC Liautaud Master of Science in Finance
>
>   Microsoft
>   MS-Computational Finance and Risk Management at University of Washington
>
>   Charles Schwab
>   Hull Investments
>   Interactive Brokers
>   OneMarketData
>   RStudio
>
> On behalf of the committee and sponsors, we look forward to seeing you
> in Chicago!
>
>   Gib Bassett, Peter Carl, Dirk Eddelbuettel, Brian Peterson, Dale
> Rosenthal, Jeffrey Ryan, Joshua Ulrich
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> R/Finance 2016 | www.rinfinance.com



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From atakanokan at outlook.com  Mon May  9 23:07:39 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Tue, 10 May 2016 00:07:39 +0300
Subject: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs
 applyStrategy
In-Reply-To: <BAY172-W43054B8BD60D23655D53AAC7630@phx.gbl>
References: <BAY172-W32FC281B954B4B9402BC45C7610@phx.gbl>,
	<BAY172-W446C7A7592C3AB0B5FEFCDC7620@phx.gbl>,
	<CAPPM_gR_QGj+edpusOCATOSnkf0T8chFaoDYa1HsRVL-YzJC7w@mail.gmail.com>,
	<BAY172-W5272E1024BE864DFC04158C7620@phx.gbl>,
	<BAY172-W123C5390D71AF22456CE0CC7630@phx.gbl>,
	<BAY172-W43054B8BD60D23655D53AAC7630@phx.gbl>
Message-ID: <BAY172-W22D4345A835D499B3F479FC7700@phx.gbl>

So an update on the solution of the problem:

The problem is probably caused by the use of parallel processing on Windows as if apply.paramset() is run sequentially, the custom TxnFee function is executed. However when a parallel backend is registered, the custom TxnFee function somehow is not executed thus altering results. 

Here is the reproducible code, again:

library(lattice);library(foreach);library(doSNOW);library(ggplot2)
library(gridExtra);library(reshape);library(beepr);library(quantstrat) 
Sys.setenv(TZ="UTC")                                                                                 
.strategy<- new.env();.blotter<- new.env()                                                                                                                             

currency('USD')                                                                                                                                                                      
stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)

getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")
AAPL <- adjustOHLC(AAPL)

init.strategy.func <- function(){
  strategy.st <- paste("AAPL","MACD_D1",sep = "_")
  rm.strat(strategy.st) 
  initialEquity = 100000                                                                               
  initDate = "2013-12-30" 
  initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")
  initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")
  initOrders(portfolio=strategy.st,initDate=initDate) 
  strategy(strategy.st,store=TRUE)
  return(strategy.st)
}

strategy.st <- init.strategy.func()

customFees <- function (TxnQty, ...) 
{
  return(abs(TxnQty) * -0.01)
}
txn.model <- "customFees"    

positionSizeLong  =  1000     
positionSizeShort =  -1000     


paramset.label.name <- "SMA_OPT"
FastSMARange <- seq(5,21,by=8)
SlowSMARange <- seq(10,50,by=20)
StopLossDistanceRange <- seq(0.0025,0.005,by=0.0025)                               

strategy.function <- function(){
  
  add.indicator(strategy.st,                                               
              name = "SMA",                                               
              arguments = list(x=Cl(eval(parse(text = "AAPL")))
                               ,n=5                                 #fastsma of best combination by NetPnL
              ),                                                            
              label='fastsma')                                           
  
  add.indicator(strategy.st,                                                 
              name = "SMA",                                                
              arguments = list(x=Cl(eval(parse(text = "AAPL")))
                               ,n=50                                #slowsma of best combination by NetPnL
              ),                                                           
              label='slowsma')                                             
  
  add.signal(strategy.st,
           name="sigCrossover",
           arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),
           label="fastsma.gt.slowsma")                                                        
  
  add.signal(strategy.st,
           name="sigCrossover",
           arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),
           label="fastsma.lt.slowsma")
  
  add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.gt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty= positionSizeLong, 
                          #osFUN="osAllInLong",  
                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = txn.model),
         type='enter',
         label='longenter',
         enabled=TRUE
  )
  
  # Long Exit Rule-------------------------------------------------------------------
  add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.lt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty='all',
                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = txn.model),
         type='exit',
         label='longexit',
         enabled=TRUE
  )
  
  # Long StopLoss Rule---------------------------------------------------------------------------
  add.rule(strategy.st,name='ruleSignal',
         arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,
                           replace=FALSE,
                           orderside='long',
                           ordertype='stoplimit',
                           tmult=TRUE,
                           threshold=quote( longStopLossDistance ),
                           orderqty='all',
                           orderset='ocolong',
                           TxnFees = txn.model),
         type='chain', parent="longenter",
         label='StopLossLong',
         enabled=TRUE)
  
  # Short Entry Rule--------------------------------------------------------------------
  add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.lt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty=positionSizeShort, 
                          #osFUN="osAllInShort",  
                          ordertype='market',
                          orderside='short',
                          orderset='ocoshort',
                          TxnFees = txn.model),
         type='enter',
         label='shortenter',
         enabled=TRUE
  )
  
  # Short Exit Rule---------------------------------------------------------------------
  add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="fastsma.gt.slowsma",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty='all',
                          ordertype='market',
                          orderside='short',
                          orderset='ocoshort',
                          TxnFees = txn.model),
         type='exit',
         label='shortexit',
         enabled=TRUE
  )
  
  # Short Stop Loss Rule-----------------------------------------------------------------
  add.rule(strategy.st,name='ruleSignal',
         arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,
                           replace=FALSE,
                           orderside='short',
                           ordertype='stoplimit',
                           tmult=TRUE,
                           threshold=quote( shortStopLossDistance ),
                           orderqty='all',
                           orderset='ocoshort',
                           TxnFees = txn.model),
         type='chain', parent="shortenter",
         label='StopLossShort',
         enabled=TRUE)
  
  
  #Indicator Optimization-------------------------------------------------------------
  add.distribution(strategy.st,
                 paramset.label = paramset.label.name,
                 component.type = 'indicator',
                 component.label = "fastsma",
                 variable = list( n = FastSMARange ),               
                 label = "FastSMARANGE")
  
  
  add.distribution(strategy.st,
                 paramset.label = paramset.label.name,
                 component.type = 'indicator',
                 component.label = "slowsma",
                 variable = list( n = SlowSMARange ),
                 label = "SlowSMARANGE")
  
  add.distribution.constraint(strategy.st,
                            paramset.label = 'SMA_OPT',
                            distribution.label.1 = 'FastSMARANGE',
                            distribution.label.2 = 'SlowSMARANGE',
                            operator = '<',
                            label = 'FastSMA<- snow::makeCluster(4, type = "SOCK")
#registerDoSNOW(cl)
results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,
                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE
                          ,audit=paramsetenv
                          )
#snow::stopCluster(cl)
results.df <- data.frame(results$tradeStats)


#Second run applyStrategy()
strategy.st <- init.strategy.func()
strategy.function()


# fastsma = 5                                       #fastsma of best combination by NetPnL
# slowsma = 50                                  #slowsma of best combination by NetPnL
longStopLossDistance <- 0.005             #SL of best combination by NetPnL
shortStopLossDistance <- 0.005            #SL of best combination by NetPnL

applyStrategy( strategy=strategy.st , portfolios=strategy.st
               #,parameters=list(n = 5)
               ,verbose=TRUE)
updatePortf(strategy.st)
updateAcct(strategy.st)
updateEndEq(strategy.st)

results.df.2 <- data.frame(tradeStats(strategy.st))


#Check NetPnL apply.paramset vs applyStrategy
results.df$Net.Trading.PL[12]  == results.df.2$Net.Trading.PL    #if apply.paramset() is run sequentially == TRUE


Atakan Okan


> From: atakanokan at outlook.com
> To: r-sig-finance at r-project.org
> Subject: RE: [R-SIG-Finance] Custom Txnfee function in apply.paramset vs applyStrategy
> Date: Tue, 26 Apr 2016 19:34:49 +0300
> 
> And I would be grateful, if somebody could just confirm that the reproducible code was sent succesfully, as the code seems to be sent fine in its thread in r-sig-finance archives. Thanks again.
> 
> ________________________________
>> From: atakanokan at outlook.com 
>> To: r-sig-finance at r-project.org 
>> Subject: RE: [R-SIG-Finance] Custom Txnfee function in apply.paramset 
>> vs applyStrategy 
>> Date: Tue, 26 Apr 2016 19:32:26 +0300 
>> 
>> Forgot to add, just run the complete script till the comment "#Second 
>> run applyStrategy()". For the second run, just rerun the whole script 
>> without the code block below: registerDoSNOW(cl) results <- 
>> apply.paramset(strategy.st,paramset.label=paramset.label.name, 
>> portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE, 
>> audit=paramsetenv) snow::stopCluster(cl) results.df <- 
>> data.frame(results$tradeStats) Atakan Okan 
> 
 		 	   		  
	[[alternative HTML version deleted]]


From robert at rwages.com  Tue May 10 21:50:22 2016
From: robert at rwages.com (Robert Wages)
Date: Tue, 10 May 2016 15:50:22 -0400
Subject: [R-SIG-Finance] Adding transaction fees to Return.portfolio
Message-ID: <017e01d1aaf5$3081fdf0$9185f9d0$@rwages.com>

Return.portfolio is an easy function to use to calculate the aggregate
performance of a portfolio that is rebalanced on a regular basis or that has
a custom weighting scheme on the same periodicity of returns.  I cannot find
any provision in Return.portfolio, however, for incorporating the
transaction costs for the rebalancing in the portfolio.  The resulting
portfolio performance would  seem to be high to the extent of the
transaction costs.

 

On the other hand, running strategies in Quantstrat on individual securities
(or groups of securities) allows one to take into account estimated trading
costs to generate somewhat realistic performance estimates.  Quantstrat,
however, does not seem to have any readily accessible functions to balance a
portfolio of securities within a portfolio limit.  Previous related
discussions seem to suggest the only solution is to write custom order
sizing functions to include in the strategy's rules.  

 

I may be able to figure how to write custom functions in Quantstrat to do
this after a lot of brain damage, or alternatively my own version of
Return.portfolio, but I thought I should check with the community to see if
there are any better suggestions for this.  Given that many investment
strategies rely on portfolio rebalancing under some set of rules, as opposed
to buying and selling individual securities on the basis of rules, I would
be surprised if I were the first person to wonder about this.

 

Robert C Wages

USA Mobile: +1 717 618 2828

robert at rwages.com <mailto:robert at rwages.com> 

 


	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Tue May 10 21:52:40 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Tue, 10 May 2016 15:52:40 -0400
Subject: [R-SIG-Finance] Adding transaction fees to Return.portfolio
In-Reply-To: <017e01d1aaf5$3081fdf0$9185f9d0$@rwages.com>
References: <017e01d1aaf5$3081fdf0$9185f9d0$@rwages.com>
Message-ID: <CA+oJuEE=fBiB-DKp=YNJmC7X5mGgAVyaZa0-DMKza7hQAKj5MA@mail.gmail.com>

Robert,

There's actually a way to compute turnover with Return.portfolio, with
verbose = TRUE. It returns end of period weights, and beginning of period
weights, so the turnover can be computed as beginWeights - lag(endWeights).

-Ilya

On Tue, May 10, 2016 at 3:50 PM, Robert Wages <robert at rwages.com> wrote:

> Return.portfolio is an easy function to use to calculate the aggregate
> performance of a portfolio that is rebalanced on a regular basis or that
> has
> a custom weighting scheme on the same periodicity of returns.  I cannot
> find
> any provision in Return.portfolio, however, for incorporating the
> transaction costs for the rebalancing in the portfolio.  The resulting
> portfolio performance would  seem to be high to the extent of the
> transaction costs.
>
>
>
> On the other hand, running strategies in Quantstrat on individual
> securities
> (or groups of securities) allows one to take into account estimated trading
> costs to generate somewhat realistic performance estimates.  Quantstrat,
> however, does not seem to have any readily accessible functions to balance
> a
> portfolio of securities within a portfolio limit.  Previous related
> discussions seem to suggest the only solution is to write custom order
> sizing functions to include in the strategy's rules.
>
>
>
> I may be able to figure how to write custom functions in Quantstrat to do
> this after a lot of brain damage, or alternatively my own version of
> Return.portfolio, but I thought I should check with the community to see if
> there are any better suggestions for this.  Given that many investment
> strategies rely on portfolio rebalancing under some set of rules, as
> opposed
> to buying and selling individual securities on the basis of rules, I would
> be surprised if I were the first person to wonder about this.
>
>
>
> Robert C Wages
>
> USA Mobile: +1 717 618 2828
>
> robert at rwages.com <mailto:robert at rwages.com>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Tue May 10 21:53:13 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Tue, 10 May 2016 15:53:13 -0400
Subject: [R-SIG-Finance] Adding transaction fees to Return.portfolio
In-Reply-To: <CA+oJuEE=fBiB-DKp=YNJmC7X5mGgAVyaZa0-DMKza7hQAKj5MA@mail.gmail.com>
References: <017e01d1aaf5$3081fdf0$9185f9d0$@rwages.com>
	<CA+oJuEE=fBiB-DKp=YNJmC7X5mGgAVyaZa0-DMKza7hQAKj5MA@mail.gmail.com>
Message-ID: <CA+oJuEE-uD7gasRMAcdLY=YE+KtKsfJbxdP8H6BR3T7Oo64qSw@mail.gmail.com>

Essentially, given a change in weights over any period, you can apply your
own custom transaction costs to the difference in weights.

On Tue, May 10, 2016 at 3:52 PM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> Robert,
>
> There's actually a way to compute turnover with Return.portfolio, with
> verbose = TRUE. It returns end of period weights, and beginning of period
> weights, so the turnover can be computed as beginWeights - lag(endWeights).
>
> -Ilya
>
> On Tue, May 10, 2016 at 3:50 PM, Robert Wages <robert at rwages.com> wrote:
>
>> Return.portfolio is an easy function to use to calculate the aggregate
>> performance of a portfolio that is rebalanced on a regular basis or that
>> has
>> a custom weighting scheme on the same periodicity of returns.  I cannot
>> find
>> any provision in Return.portfolio, however, for incorporating the
>> transaction costs for the rebalancing in the portfolio.  The resulting
>> portfolio performance would  seem to be high to the extent of the
>> transaction costs.
>>
>>
>>
>> On the other hand, running strategies in Quantstrat on individual
>> securities
>> (or groups of securities) allows one to take into account estimated
>> trading
>> costs to generate somewhat realistic performance estimates.  Quantstrat,
>> however, does not seem to have any readily accessible functions to
>> balance a
>> portfolio of securities within a portfolio limit.  Previous related
>> discussions seem to suggest the only solution is to write custom order
>> sizing functions to include in the strategy's rules.
>>
>>
>>
>> I may be able to figure how to write custom functions in Quantstrat to do
>> this after a lot of brain damage, or alternatively my own version of
>> Return.portfolio, but I thought I should check with the community to see
>> if
>> there are any better suggestions for this.  Given that many investment
>> strategies rely on portfolio rebalancing under some set of rules, as
>> opposed
>> to buying and selling individual securities on the basis of rules, I would
>> be surprised if I were the first person to wonder about this.
>>
>>
>>
>> Robert C Wages
>>
>> USA Mobile: +1 717 618 2828
>>
>> robert at rwages.com <mailto:robert at rwages.com>
>>
>>
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>

	[[alternative HTML version deleted]]


From robert at rwages.com  Tue May 10 22:05:44 2016
From: robert at rwages.com (Robert Wages)
Date: Tue, 10 May 2016 16:05:44 -0400
Subject: [R-SIG-Finance] Adding transaction fees to Return.portfolio
In-Reply-To: <CA+oJuEE-uD7gasRMAcdLY=YE+KtKsfJbxdP8H6BR3T7Oo64qSw@mail.gmail.com>
References: <017e01d1aaf5$3081fdf0$9185f9d0$@rwages.com>
	<CA+oJuEE=fBiB-DKp=YNJmC7X5mGgAVyaZa0-DMKza7hQAKj5MA@mail.gmail.com>
	<CA+oJuEE-uD7gasRMAcdLY=YE+KtKsfJbxdP8H6BR3T7Oo64qSw@mail.gmail.com>
Message-ID: <018901d1aaf7$56599310$030cb930$@rwages.com>

Thanks, Ilya.  I assume then I would have to subtract the custom transaction costs from the  relevant ?return? list object entries to generate a cost-adjusted portfolio return for each period.  Is that right?

 

Robert C Wages

USA Mobile: +1 717 618 2828

 <mailto:robert at rwages.com> robert at rwages.com

 

From: Ilya Kipnis [mailto:ilya.kipnis at gmail.com] 
Sent: Tuesday, May 10, 2016 3:53 PM
To: Robert Wages <robert at rwages.com>
Cc: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Adding transaction fees to Return.portfolio

 

Essentially, given a change in weights over any period, you can apply your own custom transaction costs to the difference in weights.

 

On Tue, May 10, 2016 at 3:52 PM, Ilya Kipnis <ilya.kipnis at gmail.com <mailto:ilya.kipnis at gmail.com> > wrote:

Robert,

There's actually a way to compute turnover with Return.portfolio, with verbose = TRUE. It returns end of period weights, and beginning of period weights, so the turnover can be computed as beginWeights - lag(endWeights).

-Ilya

 

On Tue, May 10, 2016 at 3:50 PM, Robert Wages <robert at rwages.com <mailto:robert at rwages.com> > wrote:

Return.portfolio is an easy function to use to calculate the aggregate
performance of a portfolio that is rebalanced on a regular basis or that has
a custom weighting scheme on the same periodicity of returns.  I cannot find
any provision in Return.portfolio, however, for incorporating the
transaction costs for the rebalancing in the portfolio.  The resulting
portfolio performance would  seem to be high to the extent of the
transaction costs.



On the other hand, running strategies in Quantstrat on individual securities
(or groups of securities) allows one to take into account estimated trading
costs to generate somewhat realistic performance estimates.  Quantstrat,
however, does not seem to have any readily accessible functions to balance a
portfolio of securities within a portfolio limit.  Previous related
discussions seem to suggest the only solution is to write custom order
sizing functions to include in the strategy's rules.



I may be able to figure how to write custom functions in Quantstrat to do
this after a lot of brain damage, or alternatively my own version of
Return.portfolio, but I thought I should check with the community to see if
there are any better suggestions for this.  Given that many investment
strategies rely on portfolio rebalancing under some set of rules, as opposed
to buying and selling individual securities on the basis of rules, I would
be surprised if I were the first person to wonder about this.



Robert C Wages

USA Mobile: +1 717 618 2828 <tel:%2B1%20717%20618%202828> 

robert at rwages.com <mailto:robert at rwages.com>  <mailto:robert at rwages.com <mailto:robert at rwages.com> >




        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>  mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.






	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Tue May 10 22:06:37 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Tue, 10 May 2016 16:06:37 -0400
Subject: [R-SIG-Finance] Adding transaction fees to Return.portfolio
In-Reply-To: <018901d1aaf7$56599310$030cb930$@rwages.com>
References: <017e01d1aaf5$3081fdf0$9185f9d0$@rwages.com>
	<CA+oJuEE=fBiB-DKp=YNJmC7X5mGgAVyaZa0-DMKza7hQAKj5MA@mail.gmail.com>
	<CA+oJuEE-uD7gasRMAcdLY=YE+KtKsfJbxdP8H6BR3T7Oo64qSw@mail.gmail.com>
	<018901d1aaf7$56599310$030cb930$@rwages.com>
Message-ID: <CA+oJuEGJJPFxiBhMT+P_UDfLvFNeUNUaiVoPy76cOS-XXZr+8g@mail.gmail.com>

This is correct.

On Tue, May 10, 2016 at 4:05 PM, Robert Wages <robert at rwages.com> wrote:

> Thanks, Ilya.  I assume then I would have to subtract the custom
> transaction costs from the  relevant ?return? list object entries to
> generate a cost-adjusted portfolio return for each period.  Is that right?
>
>
>
> *Robert C Wages*
>
> USA Mobile: +1 717 618 2828
>
> robert at rwages.com
>
>
>
> *From:* Ilya Kipnis [mailto:ilya.kipnis at gmail.com]
> *Sent:* Tuesday, May 10, 2016 3:53 PM
> *To:* Robert Wages <robert at rwages.com>
> *Cc:* r-sig-finance at r-project.org
> *Subject:* Re: [R-SIG-Finance] Adding transaction fees to Return.portfolio
>
>
>
> Essentially, given a change in weights over any period, you can apply your
> own custom transaction costs to the difference in weights.
>
>
>
> On Tue, May 10, 2016 at 3:52 PM, Ilya Kipnis <ilya.kipnis at gmail.com>
> wrote:
>
> Robert,
>
> There's actually a way to compute turnover with Return.portfolio, with
> verbose = TRUE. It returns end of period weights, and beginning of period
> weights, so the turnover can be computed as beginWeights - lag(endWeights).
>
> -Ilya
>
>
>
> On Tue, May 10, 2016 at 3:50 PM, Robert Wages <robert at rwages.com> wrote:
>
> Return.portfolio is an easy function to use to calculate the aggregate
> performance of a portfolio that is rebalanced on a regular basis or that
> has
> a custom weighting scheme on the same periodicity of returns.  I cannot
> find
> any provision in Return.portfolio, however, for incorporating the
> transaction costs for the rebalancing in the portfolio.  The resulting
> portfolio performance would  seem to be high to the extent of the
> transaction costs.
>
>
>
> On the other hand, running strategies in Quantstrat on individual
> securities
> (or groups of securities) allows one to take into account estimated trading
> costs to generate somewhat realistic performance estimates.  Quantstrat,
> however, does not seem to have any readily accessible functions to balance
> a
> portfolio of securities within a portfolio limit.  Previous related
> discussions seem to suggest the only solution is to write custom order
> sizing functions to include in the strategy's rules.
>
>
>
> I may be able to figure how to write custom functions in Quantstrat to do
> this after a lot of brain damage, or alternatively my own version of
> Return.portfolio, but I thought I should check with the community to see if
> there are any better suggestions for this.  Given that many investment
> strategies rely on portfolio rebalancing under some set of rules, as
> opposed
> to buying and selling individual securities on the basis of rules, I would
> be surprised if I were the first person to wonder about this.
>
>
>
> Robert C Wages
>
> USA Mobile: +1 717 618 2828
>
> robert at rwages.com <mailto:robert at rwages.com>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>
>
>

	[[alternative HTML version deleted]]


From robert at rwages.com  Tue May 10 22:11:46 2016
From: robert at rwages.com (Robert Wages)
Date: Tue, 10 May 2016 16:11:46 -0400
Subject: [R-SIG-Finance] Adding transaction fees to Return.portfolio
In-Reply-To: <CA+oJuEGJJPFxiBhMT+P_UDfLvFNeUNUaiVoPy76cOS-XXZr+8g@mail.gmail.com>
References: <017e01d1aaf5$3081fdf0$9185f9d0$@rwages.com>
	<CA+oJuEE=fBiB-DKp=YNJmC7X5mGgAVyaZa0-DMKza7hQAKj5MA@mail.gmail.com>
	<CA+oJuEE-uD7gasRMAcdLY=YE+KtKsfJbxdP8H6BR3T7Oo64qSw@mail.gmail.com>
	<018901d1aaf7$56599310$030cb930$@rwages.com>
	<CA+oJuEGJJPFxiBhMT+P_UDfLvFNeUNUaiVoPy76cOS-XXZr+8g@mail.gmail.com>
Message-ID: <019701d1aaf8$2d9d2620$88d77260$@rwages.com>

Cool.  Thanks.

 

Robert C Wages

USA Mobile: +1 717 618 2828

 <mailto:robert at rwages.com> robert at rwages.com

 

From: Ilya Kipnis [mailto:ilya.kipnis at gmail.com] 
Sent: Tuesday, May 10, 2016 4:07 PM
To: Robert Wages <robert at rwages.com>
Cc: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Adding transaction fees to Return.portfolio

 

This is correct.

 

On Tue, May 10, 2016 at 4:05 PM, Robert Wages <robert at rwages.com <mailto:robert at rwages.com> > wrote:

Thanks, Ilya.  I assume then I would have to subtract the custom transaction costs from the  relevant ?return? list object entries to generate a cost-adjusted portfolio return for each period.  Is that right?

 

Robert C Wages

USA Mobile: +1 717 618 2828 <tel:%2B1%20717%20618%202828> 

 <mailto:robert at rwages.com> robert at rwages.com

 

From: Ilya Kipnis [mailto:ilya.kipnis at gmail.com <mailto:ilya.kipnis at gmail.com> ] 
Sent: Tuesday, May 10, 2016 3:53 PM
To: Robert Wages <robert at rwages.com <mailto:robert at rwages.com> >
Cc: r-sig-finance at r-project.org <mailto:r-sig-finance at r-project.org> 
Subject: Re: [R-SIG-Finance] Adding transaction fees to Return.portfolio

 

Essentially, given a change in weights over any period, you can apply your own custom transaction costs to the difference in weights.

 

On Tue, May 10, 2016 at 3:52 PM, Ilya Kipnis <ilya.kipnis at gmail.com <mailto:ilya.kipnis at gmail.com> > wrote:

Robert,

There's actually a way to compute turnover with Return.portfolio, with verbose = TRUE. It returns end of period weights, and beginning of period weights, so the turnover can be computed as beginWeights - lag(endWeights).

-Ilya

 

On Tue, May 10, 2016 at 3:50 PM, Robert Wages <robert at rwages.com <mailto:robert at rwages.com> > wrote:

Return.portfolio is an easy function to use to calculate the aggregate
performance of a portfolio that is rebalanced on a regular basis or that has
a custom weighting scheme on the same periodicity of returns.  I cannot find
any provision in Return.portfolio, however, for incorporating the
transaction costs for the rebalancing in the portfolio.  The resulting
portfolio performance would  seem to be high to the extent of the
transaction costs.



On the other hand, running strategies in Quantstrat on individual securities
(or groups of securities) allows one to take into account estimated trading
costs to generate somewhat realistic performance estimates.  Quantstrat,
however, does not seem to have any readily accessible functions to balance a
portfolio of securities within a portfolio limit.  Previous related
discussions seem to suggest the only solution is to write custom order
sizing functions to include in the strategy's rules.



I may be able to figure how to write custom functions in Quantstrat to do
this after a lot of brain damage, or alternatively my own version of
Return.portfolio, but I thought I should check with the community to see if
there are any better suggestions for this.  Given that many investment
strategies rely on portfolio rebalancing under some set of rules, as opposed
to buying and selling individual securities on the basis of rules, I would
be surprised if I were the first person to wonder about this.



Robert C Wages

USA Mobile: +1 717 618 2828 <tel:%2B1%20717%20618%202828> 

robert at rwages.com <mailto:robert at rwages.com>  <mailto:robert at rwages.com <mailto:robert at rwages.com> >




        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org <mailto:R-SIG-Finance at r-project.org>  mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.








	[[alternative HTML version deleted]]


From tleitch1 at jhu.edu  Thu May 12 00:00:11 2016
From: tleitch1 at jhu.edu (terry leitch)
Date: Wed, 11 May 2016 18:00:11 -0400
Subject: [R-SIG-Finance] FW: Contract R Position in DC
In-Reply-To: <A68374A2-8745-4372-BF08-B8A429A96FD1@jhu.edu>
References: <A68374A2-8745-4372-BF08-B8A429A96FD1@jhu.edu>
Message-ID: <C235A1AA-20F1-4054-AFDC-2A548BAC04CF@jhu.edu>

Position is available on contract basis to support an agency in their effort to build a risk dashboard for monitoring derivative markets by key policymakers. The position involves high level engagement of the top regulatory policymakers and advisors and involves valuation and risk analysis of a growing database (over $14 Trillion currently)  of derivative products on a regular basis. Required skills are extensive R programming and data analysis. Preferred skills are fixed income and fixed income derivatives, Shiny, and SQL. US citizenship required. Rate DOE.


	[[alternative HTML version deleted]]


From neliomachado at gmail.com  Fri May 13 02:38:34 2016
From: neliomachado at gmail.com (Nelio Machado)
Date: Thu, 12 May 2016 21:38:34 -0300
Subject: [R-SIG-Finance] R-SIG-Finance
Message-ID: <CAKKvw8P2GaF+1ZOsG8mrkX=rP23UcLKshVbtRa3NMgnntMa2GQ@mail.gmail.com>

R-SIG-Finance


Nelio Machado

? Antes de imprimir pense em seu compromisso com o Meio Ambiente e no
comprometimento com os Custos.

Se for encaminhar esta mensagem, por favor:
1. Apague o meu e-mail e o meu nome;
2. Encaminhe como c?pia oculta (Cco ou Bcc) aos seus destinat?rios;
3. Apague tamb?m, se houver, os endere?os dos amigos antes de reenviar;
4. Agindo sempre assim dificultaremos a dissemina??o de v?rus, spams e
banners.

	[[alternative HTML version deleted]]


From aritrapan at vgsom.iitkgp.ernet.in  Fri May 13 06:31:45 2016
From: aritrapan at vgsom.iitkgp.ernet.in (Aritra Pan)
Date: Fri, 13 May 2016 10:01:45 +0530 (IST)
Subject: [R-SIG-Finance] Fwd: dataset to xts conversion issue with
 timeseries data
In-Reply-To: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
References: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
Message-ID: <1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>

Sorry, if it is becoming duplicate message. Any suggestion will be highly appreciated. 

-- 
Thanks, 
Aritra 

----- Original Message -----

From: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in> 
To: "R-SIG-Finance" <r-sig-finance-bounces at r-project.org> 
Sent: Thursday, May 12, 2016 11:28:41 AM 
Subject: [R-SIG-Finance] dataset to xts conversion issue with timeseries data 

Hello Members, 

I am hoping if I can get few suggestions on the issue I am facing. 

I am taking data from server using Rblpapi package for 40-50 securities. The data looks like below: 

times 	askValue 	askSize 	stockName 	Type 
01/02/2016 9:15 	91.8 	500 	ABCD IS Equity 	Ask 
01/02/2016 9:15 	92.4 	1420 	ABCD IS Equity 	Ask 
01/02/2016 9:15 	92.2 	5000 	ABCD IS Equity 	Ask 
01/02/2016 9:15 	91.9 	6524 	ABCD IS Equity 	Ask 
01/02/2016 9:15 	91.9 	11524 	ABCD IS Equity 	Ask 
01/02/2016 9:15 	92.05 	6824 	ABCD IS Equity 	Ask 

ABCD IS - any security (assume). 

Now this data is coming in standard dataset format to R from data server. When I try to convert it to XTS it becomes like below 

	askValue 	askSize 	stockName 	askType 
01/02/2016 9:15 	" 91.80" 	" 500" 	"ABCD IS Equity" 	"Ask" 
01/02/2016 9:15 	"474.45" 	" 300" 	"EFGH IS Equity" 	"Ask" 
01/02/2016 9:15 	"455.00" 	" 100" 	"XYZW IS Equity" 	"Ask" 
01/02/2016 9:15 	"101.50" 	" 2799" 	"MNP IS Equity" 	"Ask" 
01/02/2016 9:15 	"194.95" 	" 1600" 	"IJK IS Equity" 	"Ask" 
01/02/2016 9:15 	"293.45" 	" 13" 	"PQRS IS Equity" 	"Ask" 

You can see the the column name "times" is becoming here index. And that's why after data conversion to xts object I am not able to match my quote data which are bid dataset and ask dataset. 

Can anyone please suggest on this data set to xts conversion. 

PS: When I am downloading data in excel and then transforming data from excel to xts then it is working fine. 

	Date 	Type 	Price 	Size 
1 	01/03/2016 9:15 	ASK 	538.9 	50 
2 	01/03/2016 9:15 	ASK 	538.8 	75 
3 	01/03/2016 9:15 	ASK 	538.7 	50 
4 	01/03/2016 9:15 	ASK 	538.3 	75 
5 	01/03/2016 9:15 	ASK 	538.85 	798 
6 	01/03/2016 9:15 	ASK 	538.9 	93 

But as I am trying to run for multiple stocks data download script at same time and it is high-frequency data, so I am using R script to download data from server to R directly skipping excel using Rblpapi package. 

-- 
Thanks, 
Aritra 



	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Fri May 13 07:09:18 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 13 May 2016 01:09:18 -0400
Subject: [R-SIG-Finance] Fwd: dataset to xts conversion issue with
 timeseries data
In-Reply-To: <1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
References: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
Message-ID: <CA+oJuEFZcNSNNXHOM-1JUP9VYtHN0yShevB6=5VdXtM5aeuJCw@mail.gmail.com>

Aritra,

The underlying data structure of an xts is a matrix. If you have a
character vector inside that matrix, the entire thing will become
characters. In your example, you have stockName and type vectors, which are
character vectors, whereas in the excel example, you don't. Hope that helps.

-Ilya

On Fri, May 13, 2016 at 12:31 AM, Aritra Pan <
aritrapan at vgsom.iitkgp.ernet.in> wrote:

> Sorry, if it is becoming duplicate message. Any suggestion will be highly
> appreciated.
>
> --
> Thanks,
> Aritra
>
> ----- Original Message -----
>
> From: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in>
> To: "R-SIG-Finance" <r-sig-finance-bounces at r-project.org>
> Sent: Thursday, May 12, 2016 11:28:41 AM
> Subject: [R-SIG-Finance] dataset to xts conversion issue with timeseries
> data
>
> Hello Members,
>
> I am hoping if I can get few suggestions on the issue I am facing.
>
> I am taking data from server using Rblpapi package for 40-50 securities.
> The data looks like below:
>
> times   askValue        askSize         stockName       Type
> 01/02/2016 9:15         91.8    500     ABCD IS Equity  Ask
> 01/02/2016 9:15         92.4    1420    ABCD IS Equity  Ask
> 01/02/2016 9:15         92.2    5000    ABCD IS Equity  Ask
> 01/02/2016 9:15         91.9    6524    ABCD IS Equity  Ask
> 01/02/2016 9:15         91.9    11524   ABCD IS Equity  Ask
> 01/02/2016 9:15         92.05   6824    ABCD IS Equity  Ask
>
> ABCD IS - any security (assume).
>
> Now this data is coming in standard dataset format to R from data server.
> When I try to convert it to XTS it becomes like below
>
>         askValue        askSize         stockName       askType
> 01/02/2016 9:15         " 91.80"        " 500"  "ABCD IS Equity"
> "Ask"
> 01/02/2016 9:15         "474.45"        " 300"  "EFGH IS Equity"
> "Ask"
> 01/02/2016 9:15         "455.00"        " 100"  "XYZW IS Equity"
> "Ask"
> 01/02/2016 9:15         "101.50"        " 2799"         "MNP IS Equity"
>      "Ask"
> 01/02/2016 9:15         "194.95"        " 1600"         "IJK IS Equity"
>      "Ask"
> 01/02/2016 9:15         "293.45"        " 13"   "PQRS IS Equity"
> "Ask"
>
> You can see the the column name "times" is becoming here index. And that's
> why after data conversion to xts object I am not able to match my quote
> data which are bid dataset and ask dataset.
>
> Can anyone please suggest on this data set to xts conversion.
>
> PS: When I am downloading data in excel and then transforming data from
> excel to xts then it is working fine.
>
>         Date    Type    Price   Size
> 1       01/03/2016 9:15         ASK     538.9   50
> 2       01/03/2016 9:15         ASK     538.8   75
> 3       01/03/2016 9:15         ASK     538.7   50
> 4       01/03/2016 9:15         ASK     538.3   75
> 5       01/03/2016 9:15         ASK     538.85  798
> 6       01/03/2016 9:15         ASK     538.9   93
>
> But as I am trying to run for multiple stocks data download script at same
> time and it is high-frequency data, so I am using R script to download data
> from server to R directly skipping excel using Rblpapi package.
>
> --
> Thanks,
> Aritra
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From aritrapan at vgsom.iitkgp.ernet.in  Fri May 13 07:17:42 2016
From: aritrapan at vgsom.iitkgp.ernet.in (Aritra Pan)
Date: Fri, 13 May 2016 10:47:42 +0530 (IST)
Subject: [R-SIG-Finance] Fwd: dataset to xts conversion issue with
 timeseries data
In-Reply-To: <CA+oJuEFZcNSNNXHOM-1JUP9VYtHN0yShevB6=5VdXtM5aeuJCw@mail.gmail.com>
References: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<CA+oJuEFZcNSNNXHOM-1JUP9VYtHN0yShevB6=5VdXtM5aeuJCw@mail.gmail.com>
Message-ID: <1714733726.6182786.1463116662572.JavaMail.zimbra@vgsom.iitkgp.ernet.in>

Hi Ilya, 

Thanks for the suggestion. But when I try with the dataset containing only timestamp, value and size columns; then also if I try to convert from dataset to xts, the timestamp column is becoming index and further I am not able to access timestamp matching between objects. 

-- 
Thanks, 
Aritra 

----- Original Message -----

From: "Ilya Kipnis" <ilya.kipnis at gmail.com> 
To: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in> 
Cc: r-sig-finance at r-project.org 
Sent: Friday, May 13, 2016 10:39:18 AM 
Subject: Re: [R-SIG-Finance] Fwd: dataset to xts conversion issue with timeseries data 

Aritra, 

The underlying data structure of an xts is a matrix. If you have a character vector inside that matrix, the entire thing will become characters. In your example, you have stockName and type vectors, which are character vectors, whereas in the excel example, you don't. Hope that helps. 

-Ilya 

On Fri, May 13, 2016 at 12:31 AM, Aritra Pan < aritrapan at vgsom.iitkgp.ernet.in > wrote: 


Sorry, if it is becoming duplicate message. Any suggestion will be highly appreciated. 

-- 
Thanks, 
Aritra 

----- Original Message ----- 

From: "Aritra Pan" < aritrapan at vgsom.iitkgp.ernet.in > 
To: "R-SIG-Finance" < r-sig-finance-bounces at r-project.org > 
Sent: Thursday, May 12, 2016 11:28:41 AM 
Subject: [R-SIG-Finance] dataset to xts conversion issue with timeseries data 

Hello Members, 

I am hoping if I can get few suggestions on the issue I am facing. 

I am taking data from server using Rblpapi package for 40-50 securities. The data looks like below: 

times askValue askSize stockName Type 
01/02/2016 9:15 91.8 500 ABCD IS Equity Ask 
01/02/2016 9:15 92.4 1420 ABCD IS Equity Ask 
01/02/2016 9:15 92.2 5000 ABCD IS Equity Ask 
01/02/2016 9:15 91.9 6524 ABCD IS Equity Ask 
01/02/2016 9:15 91.9 11524 ABCD IS Equity Ask 
01/02/2016 9:15 92.05 6824 ABCD IS Equity Ask 

ABCD IS - any security (assume). 

Now this data is coming in standard dataset format to R from data server. When I try to convert it to XTS it becomes like below 

askValue askSize stockName askType 
01/02/2016 9:15 " 91.80" " 500" "ABCD IS Equity" "Ask" 
01/02/2016 9:15 "474.45" " 300" "EFGH IS Equity" "Ask" 
01/02/2016 9:15 "455.00" " 100" "XYZW IS Equity" "Ask" 
01/02/2016 9:15 "101.50" " 2799" "MNP IS Equity" "Ask" 
01/02/2016 9:15 "194.95" " 1600" "IJK IS Equity" "Ask" 
01/02/2016 9:15 "293.45" " 13" "PQRS IS Equity" "Ask" 

You can see the the column name "times" is becoming here index. And that's why after data conversion to xts object I am not able to match my quote data which are bid dataset and ask dataset. 

Can anyone please suggest on this data set to xts conversion. 

PS: When I am downloading data in excel and then transforming data from excel to xts then it is working fine. 

Date Type Price Size 
1 01/03/2016 9:15 ASK 538.9 50 
2 01/03/2016 9:15 ASK 538.8 75 
3 01/03/2016 9:15 ASK 538.7 50 
4 01/03/2016 9:15 ASK 538.3 75 
5 01/03/2016 9:15 ASK 538.85 798 
6 01/03/2016 9:15 ASK 538.9 93 

But as I am trying to run for multiple stocks data download script at same time and it is high-frequency data, so I am using R script to download data from server to R directly skipping excel using Rblpapi package. 

-- 
Thanks, 
Aritra 



[[alternative HTML version deleted]] 

_______________________________________________ 
R-SIG-Finance at r-project.org mailing list 
https://stat.ethz.ch/mailman/listinfo/r-sig-finance 
-- Subscriber-posting only. If you want to post, subscribe first. 
-- Also note that this is not the r-help list where general R questions should go. 






	[[alternative HTML version deleted]]


From brian at braverock.com  Fri May 13 12:02:04 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 13 May 2016 05:02:04 -0500
Subject: [R-SIG-Finance] Fwd: dataset to xts conversion issue with
 timeseries data
In-Reply-To: <1714733726.6182786.1463116662572.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
References: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<CA+oJuEFZcNSNNXHOM-1JUP9VYtHN0yShevB6=5VdXtM5aeuJCw@mail.gmail.com>
	<1714733726.6182786.1463116662572.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
Message-ID: <5735A61C.5070104@braverock.com>

Please make it easy for someone else to help you.  Provide a minimal 
example, e.g. use dput to export a small copy of your object showing us 
what you're trying to do and the code you are trying.

Ilya's advice was correct, so your problem is unquestionably user error, 
but it will be hard for anyone to help you if you don't show us 
precisely what you are trying by providing a reproducible example 
including a copy of your input data.


On 05/13/2016 12:17 AM, Aritra Pan wrote:
> Hi Ilya,
>
> Thanks for the suggestion. But when I try with the dataset containing
> only timestamp, value and size columns; then also if I try to convert
> from dataset to xts, the timestamp column is becoming index and
> further I am not able to access timestamp matching between objects.
>

On 05/13/2016 12:09 AM, Ilya Kipnis wrote:
> Aritra,
>
> The underlying data structure of an xts is a matrix. If you have a
> character vector inside that matrix, the entire thing will become
> characters. In your example, you have stockName and type vectors,
which are
> character vectors, whereas in the excel example, you don't. Hope
> that
helps.
>
> -Ilya
>
> On Fri, May 13, 2016 at 12:31 AM, Aritra Pan <
> aritrapan at vgsom.iitkgp.ernet.in> wrote:
>
>> Sorry, if it is becoming duplicate message. Any suggestion will be
>> highly appreciated.
>>
>> -- Thanks, Aritra
>>
>> ----- Original Message -----
>>
>> From: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in> To:
>> "R-SIG-Finance" <r-sig-finance-bounces at r-project.org> Sent:
>> Thursday, May 12, 2016 11:28:41 AM Subject: [R-SIG-Finance] dataset
>> to xts conversion issue with timeseries data
>>
>> Hello Members,
>>
>> I am hoping if I can get few suggestions on the issue I am facing.
>>
>> I am taking data from server using Rblpapi package for 40-50
>> securities. The data looks like below:
>>
>> times   askValue        askSize         stockName       Type
>> 01/02/2016 9:15         91.8    500     ABCD IS Equity  Ask
>> 01/02/2016 9:15         92.4    1420    ABCD IS Equity  Ask
>> 01/02/2016 9:15         92.2    5000    ABCD IS Equity  Ask
>> 01/02/2016 9:15         91.9    6524    ABCD IS Equity  Ask
>> 01/02/2016 9:15         91.9    11524   ABCD IS Equity  Ask
>> 01/02/2016 9:15         92.05   6824    ABCD IS Equity  Ask
>>
>> ABCD IS - any security (assume).
>>
>> Now this data is coming in standard dataset format to R from data
>> server. When I try to convert it to XTS it becomes like below
>>
>> askValue        askSize         stockName       askType 01/02/2016
>> 9:15         " 91.80"        " 500"  "ABCD IS Equity" "Ask"
>> 01/02/2016 9:15         "474.45"        " 300"  "EFGH IS Equity"
>> "Ask" 01/02/2016 9:15         "455.00"        " 100"  "XYZW IS
>> Equity" "Ask" 01/02/2016 9:15         "101.50"        " 2799"
>> "MNP IS Equity" "Ask" 01/02/2016 9:15         "194.95"        "
>> 1600"         "IJK IS Equity" "Ask" 01/02/2016 9:15
>> "293.45"        " 13"   "PQRS IS Equity" "Ask"
>>
>> You can see the the column name "times" is becoming here index.
>> And
that's
>> why after data conversion to xts object I am not able to match my
>> quote data which are bid dataset and ask dataset.
>>
>> Can anyone please suggest on this data set to xts conversion.
>>
>> PS: When I am downloading data in excel and then transforming data
>> from excel to xts then it is working fine.
>>
>> Date    Type    Price   Size 1       01/03/2016 9:15         ASK
>> 538.9   50 2       01/03/2016 9:15         ASK     538.8   75 3
>> 01/03/2016 9:15         ASK     538.7   50 4       01/03/2016 9:15
>> ASK     538.3   75 5       01/03/2016 9:15         ASK     538.85
>> 798 6       01/03/2016 9:15         ASK     538.9   93
>>
>> But as I am trying to run for multiple stocks data download script
>> at
same
>> time and it is high-frequency data, so I am using R script to
download data
>> from server to R directly skipping excel using Rblpapi package.
>>
>> -- Thanks, Aritra
>>
-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From aritrapan at vgsom.iitkgp.ernet.in  Fri May 13 15:29:58 2016
From: aritrapan at vgsom.iitkgp.ernet.in (Aritra Pan)
Date: Fri, 13 May 2016 18:59:58 +0530 (IST)
Subject: [R-SIG-Finance] Fwd: dataset to xts conversion issue with
 timeseries data
In-Reply-To: <5735A61C.5070104@braverock.com>
References: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<CA+oJuEFZcNSNNXHOM-1JUP9VYtHN0yShevB6=5VdXtM5aeuJCw@mail.gmail.com>
	<1714733726.6182786.1463116662572.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<5735A61C.5070104@braverock.com>
Message-ID: <1703592222.6225415.1463146198858.JavaMail.zimbra@vgsom.iitkgp.ernet.in>

Hi,

Sorry if my mail lacked information. But I took Ilya's point and it's resolved now. Still I will explain the issue once more.

> head(ask_dataset)
                times askValue askSize      stockName askType
1 2016-02-01 09:15:01    91.80     500 DITV IS Equity     Ask
2 2016-02-01 09:15:02    92.40    1420 DITV IS Equity     Ask
3 2016-02-01 09:15:04    92.20    5000 DITV IS Equity     Ask
4 2016-02-01 09:15:05    91.90    6524 DITV IS Equity     Ask
5 2016-02-01 09:15:06    91.90   11524 DITV IS Equity     Ask
6 2016-02-01 09:15:06    92.05    6824 DITV IS Equity     Ask

This is the data from data set. Now if I convert it to xts then the "times" column is converting to index (as for time series data). So to select data from xts matching particular timestamp was becoming difficult. That's what Ilya explained that matrix data structure of xts.

-- 
Thanks, 
Aritra 

----- Original Message -----
From: "Brian G. Peterson" <brian at braverock.com>
To: r-sig-finance at r-project.org
Sent: Friday, May 13, 2016 3:32:04 PM
Subject: Re: [R-SIG-Finance] Fwd: dataset to xts conversion issue with timeseries data

Please make it easy for someone else to help you.  Provide a minimal 
example, e.g. use dput to export a small copy of your object showing us 
what you're trying to do and the code you are trying.

Ilya's advice was correct, so your problem is unquestionably user error, 
but it will be hard for anyone to help you if you don't show us 
precisely what you are trying by providing a reproducible example 
including a copy of your input data.


On 05/13/2016 12:17 AM, Aritra Pan wrote:
> Hi Ilya,
>
> Thanks for the suggestion. But when I try with the dataset containing
> only timestamp, value and size columns; then also if I try to convert
> from dataset to xts, the timestamp column is becoming index and
> further I am not able to access timestamp matching between objects.
>

On 05/13/2016 12:09 AM, Ilya Kipnis wrote:
> Aritra,
>
> The underlying data structure of an xts is a matrix. If you have a
> character vector inside that matrix, the entire thing will become
> characters. In your example, you have stockName and type vectors,
which are
> character vectors, whereas in the excel example, you don't. Hope
> that
helps.
>
> -Ilya
>
> On Fri, May 13, 2016 at 12:31 AM, Aritra Pan <
> aritrapan at vgsom.iitkgp.ernet.in> wrote:
>
>> Sorry, if it is becoming duplicate message. Any suggestion will be
>> highly appreciated.
>>
>> -- Thanks, Aritra
>>
>> ----- Original Message -----
>>
>> From: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in> To:
>> "R-SIG-Finance" <r-sig-finance-bounces at r-project.org> Sent:
>> Thursday, May 12, 2016 11:28:41 AM Subject: [R-SIG-Finance] dataset
>> to xts conversion issue with timeseries data
>>
>> Hello Members,
>>
>> I am hoping if I can get few suggestions on the issue I am facing.
>>
>> I am taking data from server using Rblpapi package for 40-50
>> securities. The data looks like below:
>>
>> times   askValue        askSize         stockName       Type
>> 01/02/2016 9:15         91.8    500     ABCD IS Equity  Ask
>> 01/02/2016 9:15         92.4    1420    ABCD IS Equity  Ask
>> 01/02/2016 9:15         92.2    5000    ABCD IS Equity  Ask
>> 01/02/2016 9:15         91.9    6524    ABCD IS Equity  Ask
>> 01/02/2016 9:15         91.9    11524   ABCD IS Equity  Ask
>> 01/02/2016 9:15         92.05   6824    ABCD IS Equity  Ask
>>
>> ABCD IS - any security (assume).
>>
>> Now this data is coming in standard dataset format to R from data
>> server. When I try to convert it to XTS it becomes like below
>>
>> askValue        askSize         stockName       askType 01/02/2016
>> 9:15         " 91.80"        " 500"  "ABCD IS Equity" "Ask"
>> 01/02/2016 9:15         "474.45"        " 300"  "EFGH IS Equity"
>> "Ask" 01/02/2016 9:15         "455.00"        " 100"  "XYZW IS
>> Equity" "Ask" 01/02/2016 9:15         "101.50"        " 2799"
>> "MNP IS Equity" "Ask" 01/02/2016 9:15         "194.95"        "
>> 1600"         "IJK IS Equity" "Ask" 01/02/2016 9:15
>> "293.45"        " 13"   "PQRS IS Equity" "Ask"
>>
>> You can see the the column name "times" is becoming here index.
>> And
that's
>> why after data conversion to xts object I am not able to match my
>> quote data which are bid dataset and ask dataset.
>>
>> Can anyone please suggest on this data set to xts conversion.
>>
>> PS: When I am downloading data in excel and then transforming data
>> from excel to xts then it is working fine.
>>
>> Date    Type    Price   Size 1       01/03/2016 9:15         ASK
>> 538.9   50 2       01/03/2016 9:15         ASK     538.8   75 3
>> 01/03/2016 9:15         ASK     538.7   50 4       01/03/2016 9:15
>> ASK     538.3   75 5       01/03/2016 9:15         ASK     538.85
>> 798 6       01/03/2016 9:15         ASK     538.9   93
>>
>> But as I am trying to run for multiple stocks data download script
>> at
same
>> time and it is high-frequency data, so I am using R script to
download data
>> from server to R directly skipping excel using Rblpapi package.
>>
>> -- Thanks, Aritra
>>
-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From josh.m.ulrich at gmail.com  Fri May 13 16:11:05 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 13 May 2016 09:11:05 -0500
Subject: [R-SIG-Finance] Fwd: dataset to xts conversion issue with
 timeseries data
In-Reply-To: <1703592222.6225415.1463146198858.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
References: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<CA+oJuEFZcNSNNXHOM-1JUP9VYtHN0yShevB6=5VdXtM5aeuJCw@mail.gmail.com>
	<1714733726.6182786.1463116662572.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<5735A61C.5070104@braverock.com>
	<1703592222.6225415.1463146198858.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
Message-ID: <CAPPM_gSjcm_F_tnD5V1qZDsSVYPx8+Kc7D9WiHfO5VZBM4j1ow@mail.gmail.com>

You still have not explained what you're trying to do.  You say, "to
select data from xts matching particular timestamp was becoming
difficult."  Selecting data for particular timestamps is one of the
problems xts was *designed* to solve, so I doubt xts makes it
difficult.

In your initial email, you said, "I am not able to match my quote data
which are bid dataset and ask dataset."  You need to provide an
example of your quote data, and an example of your desired result from
matching them.

It is much better to describe your problem using raw data and code
than by using words, especially when there's a language barrier.  It
appears English isn't your native language, and many on this list
probably do not speak your native language, but we all speak R.


On Fri, May 13, 2016 at 8:29 AM, Aritra Pan
<aritrapan at vgsom.iitkgp.ernet.in> wrote:
> Hi,
>
> Sorry if my mail lacked information. But I took Ilya's point and it's resolved now. Still I will explain the issue once more.
>
>> head(ask_dataset)
>                 times askValue askSize      stockName askType
> 1 2016-02-01 09:15:01    91.80     500 DITV IS Equity     Ask
> 2 2016-02-01 09:15:02    92.40    1420 DITV IS Equity     Ask
> 3 2016-02-01 09:15:04    92.20    5000 DITV IS Equity     Ask
> 4 2016-02-01 09:15:05    91.90    6524 DITV IS Equity     Ask
> 5 2016-02-01 09:15:06    91.90   11524 DITV IS Equity     Ask
> 6 2016-02-01 09:15:06    92.05    6824 DITV IS Equity     Ask
>
> This is the data from data set. Now if I convert it to xts then the "times" column is converting to index (as for time series data). So to select data from xts matching particular timestamp was becoming difficult. That's what Ilya explained that matrix data structure of xts.
>
> --
> Thanks,
> Aritra
>
> ----- Original Message -----
> From: "Brian G. Peterson" <brian at braverock.com>
> To: r-sig-finance at r-project.org
> Sent: Friday, May 13, 2016 3:32:04 PM
> Subject: Re: [R-SIG-Finance] Fwd: dataset to xts conversion issue with timeseries data
>
> Please make it easy for someone else to help you.  Provide a minimal
> example, e.g. use dput to export a small copy of your object showing us
> what you're trying to do and the code you are trying.
>
> Ilya's advice was correct, so your problem is unquestionably user error,
> but it will be hard for anyone to help you if you don't show us
> precisely what you are trying by providing a reproducible example
> including a copy of your input data.
>
>
> On 05/13/2016 12:17 AM, Aritra Pan wrote:
>> Hi Ilya,
>>
>> Thanks for the suggestion. But when I try with the dataset containing
>> only timestamp, value and size columns; then also if I try to convert
>> from dataset to xts, the timestamp column is becoming index and
>> further I am not able to access timestamp matching between objects.
>>
>
> On 05/13/2016 12:09 AM, Ilya Kipnis wrote:
>> Aritra,
>>
>> The underlying data structure of an xts is a matrix. If you have a
>> character vector inside that matrix, the entire thing will become
>> characters. In your example, you have stockName and type vectors,
> which are
>> character vectors, whereas in the excel example, you don't. Hope
>> that
> helps.
>>
>> -Ilya
>>
>> On Fri, May 13, 2016 at 12:31 AM, Aritra Pan <
>> aritrapan at vgsom.iitkgp.ernet.in> wrote:
>>
>>> Sorry, if it is becoming duplicate message. Any suggestion will be
>>> highly appreciated.
>>>
>>> -- Thanks, Aritra
>>>
>>> ----- Original Message -----
>>>
>>> From: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in> To:
>>> "R-SIG-Finance" <r-sig-finance-bounces at r-project.org> Sent:
>>> Thursday, May 12, 2016 11:28:41 AM Subject: [R-SIG-Finance] dataset
>>> to xts conversion issue with timeseries data
>>>
>>> Hello Members,
>>>
>>> I am hoping if I can get few suggestions on the issue I am facing.
>>>
>>> I am taking data from server using Rblpapi package for 40-50
>>> securities. The data looks like below:
>>>
>>> times   askValue        askSize         stockName       Type
>>> 01/02/2016 9:15         91.8    500     ABCD IS Equity  Ask
>>> 01/02/2016 9:15         92.4    1420    ABCD IS Equity  Ask
>>> 01/02/2016 9:15         92.2    5000    ABCD IS Equity  Ask
>>> 01/02/2016 9:15         91.9    6524    ABCD IS Equity  Ask
>>> 01/02/2016 9:15         91.9    11524   ABCD IS Equity  Ask
>>> 01/02/2016 9:15         92.05   6824    ABCD IS Equity  Ask
>>>
>>> ABCD IS - any security (assume).
>>>
>>> Now this data is coming in standard dataset format to R from data
>>> server. When I try to convert it to XTS it becomes like below
>>>
>>> askValue        askSize         stockName       askType 01/02/2016
>>> 9:15         " 91.80"        " 500"  "ABCD IS Equity" "Ask"
>>> 01/02/2016 9:15         "474.45"        " 300"  "EFGH IS Equity"
>>> "Ask" 01/02/2016 9:15         "455.00"        " 100"  "XYZW IS
>>> Equity" "Ask" 01/02/2016 9:15         "101.50"        " 2799"
>>> "MNP IS Equity" "Ask" 01/02/2016 9:15         "194.95"        "
>>> 1600"         "IJK IS Equity" "Ask" 01/02/2016 9:15
>>> "293.45"        " 13"   "PQRS IS Equity" "Ask"
>>>
>>> You can see the the column name "times" is becoming here index.
>>> And
> that's
>>> why after data conversion to xts object I am not able to match my
>>> quote data which are bid dataset and ask dataset.
>>>
>>> Can anyone please suggest on this data set to xts conversion.
>>>
>>> PS: When I am downloading data in excel and then transforming data
>>> from excel to xts then it is working fine.
>>>
>>> Date    Type    Price   Size 1       01/03/2016 9:15         ASK
>>> 538.9   50 2       01/03/2016 9:15         ASK     538.8   75 3
>>> 01/03/2016 9:15         ASK     538.7   50 4       01/03/2016 9:15
>>> ASK     538.3   75 5       01/03/2016 9:15         ASK     538.85
>>> 798 6       01/03/2016 9:15         ASK     538.9   93
>>>
>>> But as I am trying to run for multiple stocks data download script
>>> at
> same
>>> time and it is high-frequency data, so I am using R script to
> download data
>>> from server to R directly skipping excel using Rblpapi package.
>>>
>>> -- Thanks, Aritra
>>>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From aritrapan at vgsom.iitkgp.ernet.in  Fri May 13 18:37:34 2016
From: aritrapan at vgsom.iitkgp.ernet.in (Aritra Pan)
Date: Fri, 13 May 2016 22:07:34 +0530 (IST)
Subject: [R-SIG-Finance] Fwd: dataset to xts conversion issue with
 timeseries data
In-Reply-To: <CAPPM_gSjcm_F_tnD5V1qZDsSVYPx8+Kc7D9WiHfO5VZBM4j1ow@mail.gmail.com>
References: <192333022.6113283.1463032721201.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<1507353946.6178836.1463113905193.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<CA+oJuEFZcNSNNXHOM-1JUP9VYtHN0yShevB6=5VdXtM5aeuJCw@mail.gmail.com>
	<1714733726.6182786.1463116662572.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<5735A61C.5070104@braverock.com>
	<1703592222.6225415.1463146198858.JavaMail.zimbra@vgsom.iitkgp.ernet.in>
	<CAPPM_gSjcm_F_tnD5V1qZDsSVYPx8+Kc7D9WiHfO5VZBM4j1ow@mail.gmail.com>
Message-ID: <1863302651.6236842.1463157454314.JavaMail.zimbra@vgsom.iitkgp.ernet.in>

Hi Joshua,

1. If I could share original data with forum, I would love to. But there are some constraints. So, I pasted masked data in my first mail.
2. I somehow missed the matrix structure of xts objects. First, I was hoping to keep the structure from dataframe intact in xts. Ilya cleared the concept.

Hope these resolves your concern.

Enjoy your weekend,

PS: Sorry if I have used bad English.

-- 
Thanks, 
Aritra 

----- Original Message -----
From: "Joshua Ulrich" <josh.m.ulrich at gmail.com>
To: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in>
Cc: "Brian G. Peterson" <brian at braverock.com>, "r-sig-finance" <r-sig-finance at r-project.org>
Sent: Friday, May 13, 2016 7:41:05 PM
Subject: Re: [R-SIG-Finance] Fwd: dataset to xts conversion issue with timeseries data

You still have not explained what you're trying to do.  You say, "to
select data from xts matching particular timestamp was becoming
difficult."  Selecting data for particular timestamps is one of the
problems xts was *designed* to solve, so I doubt xts makes it
difficult.

In your initial email, you said, "I am not able to match my quote data
which are bid dataset and ask dataset."  You need to provide an
example of your quote data, and an example of your desired result from
matching them.

It is much better to describe your problem using raw data and code
than by using words, especially when there's a language barrier.  It
appears English isn't your native language, and many on this list
probably do not speak your native language, but we all speak R.


On Fri, May 13, 2016 at 8:29 AM, Aritra Pan
<aritrapan at vgsom.iitkgp.ernet.in> wrote:
> Hi,
>
> Sorry if my mail lacked information. But I took Ilya's point and it's resolved now. Still I will explain the issue once more.
>
>> head(ask_dataset)
>                 times askValue askSize      stockName askType
> 1 2016-02-01 09:15:01    91.80     500 DITV IS Equity     Ask
> 2 2016-02-01 09:15:02    92.40    1420 DITV IS Equity     Ask
> 3 2016-02-01 09:15:04    92.20    5000 DITV IS Equity     Ask
> 4 2016-02-01 09:15:05    91.90    6524 DITV IS Equity     Ask
> 5 2016-02-01 09:15:06    91.90   11524 DITV IS Equity     Ask
> 6 2016-02-01 09:15:06    92.05    6824 DITV IS Equity     Ask
>
> This is the data from data set. Now if I convert it to xts then the "times" column is converting to index (as for time series data). So to select data from xts matching particular timestamp was becoming difficult. That's what Ilya explained that matrix data structure of xts.
>
> --
> Thanks,
> Aritra
>
> ----- Original Message -----
> From: "Brian G. Peterson" <brian at braverock.com>
> To: r-sig-finance at r-project.org
> Sent: Friday, May 13, 2016 3:32:04 PM
> Subject: Re: [R-SIG-Finance] Fwd: dataset to xts conversion issue with timeseries data
>
> Please make it easy for someone else to help you.  Provide a minimal
> example, e.g. use dput to export a small copy of your object showing us
> what you're trying to do and the code you are trying.
>
> Ilya's advice was correct, so your problem is unquestionably user error,
> but it will be hard for anyone to help you if you don't show us
> precisely what you are trying by providing a reproducible example
> including a copy of your input data.
>
>
> On 05/13/2016 12:17 AM, Aritra Pan wrote:
>> Hi Ilya,
>>
>> Thanks for the suggestion. But when I try with the dataset containing
>> only timestamp, value and size columns; then also if I try to convert
>> from dataset to xts, the timestamp column is becoming index and
>> further I am not able to access timestamp matching between objects.
>>
>
> On 05/13/2016 12:09 AM, Ilya Kipnis wrote:
>> Aritra,
>>
>> The underlying data structure of an xts is a matrix. If you have a
>> character vector inside that matrix, the entire thing will become
>> characters. In your example, you have stockName and type vectors,
> which are
>> character vectors, whereas in the excel example, you don't. Hope
>> that
> helps.
>>
>> -Ilya
>>
>> On Fri, May 13, 2016 at 12:31 AM, Aritra Pan <
>> aritrapan at vgsom.iitkgp.ernet.in> wrote:
>>
>>> Sorry, if it is becoming duplicate message. Any suggestion will be
>>> highly appreciated.
>>>
>>> -- Thanks, Aritra
>>>
>>> ----- Original Message -----
>>>
>>> From: "Aritra Pan" <aritrapan at vgsom.iitkgp.ernet.in> To:
>>> "R-SIG-Finance" <r-sig-finance-bounces at r-project.org> Sent:
>>> Thursday, May 12, 2016 11:28:41 AM Subject: [R-SIG-Finance] dataset
>>> to xts conversion issue with timeseries data
>>>
>>> Hello Members,
>>>
>>> I am hoping if I can get few suggestions on the issue I am facing.
>>>
>>> I am taking data from server using Rblpapi package for 40-50
>>> securities. The data looks like below:
>>>
>>> times   askValue        askSize         stockName       Type
>>> 01/02/2016 9:15         91.8    500     ABCD IS Equity  Ask
>>> 01/02/2016 9:15         92.4    1420    ABCD IS Equity  Ask
>>> 01/02/2016 9:15         92.2    5000    ABCD IS Equity  Ask
>>> 01/02/2016 9:15         91.9    6524    ABCD IS Equity  Ask
>>> 01/02/2016 9:15         91.9    11524   ABCD IS Equity  Ask
>>> 01/02/2016 9:15         92.05   6824    ABCD IS Equity  Ask
>>>
>>> ABCD IS - any security (assume).
>>>
>>> Now this data is coming in standard dataset format to R from data
>>> server. When I try to convert it to XTS it becomes like below
>>>
>>> askValue        askSize         stockName       askType 01/02/2016
>>> 9:15         " 91.80"        " 500"  "ABCD IS Equity" "Ask"
>>> 01/02/2016 9:15         "474.45"        " 300"  "EFGH IS Equity"
>>> "Ask" 01/02/2016 9:15         "455.00"        " 100"  "XYZW IS
>>> Equity" "Ask" 01/02/2016 9:15         "101.50"        " 2799"
>>> "MNP IS Equity" "Ask" 01/02/2016 9:15         "194.95"        "
>>> 1600"         "IJK IS Equity" "Ask" 01/02/2016 9:15
>>> "293.45"        " 13"   "PQRS IS Equity" "Ask"
>>>
>>> You can see the the column name "times" is becoming here index.
>>> And
> that's
>>> why after data conversion to xts object I am not able to match my
>>> quote data which are bid dataset and ask dataset.
>>>
>>> Can anyone please suggest on this data set to xts conversion.
>>>
>>> PS: When I am downloading data in excel and then transforming data
>>> from excel to xts then it is working fine.
>>>
>>> Date    Type    Price   Size 1       01/03/2016 9:15         ASK
>>> 538.9   50 2       01/03/2016 9:15         ASK     538.8   75 3
>>> 01/03/2016 9:15         ASK     538.7   50 4       01/03/2016 9:15
>>> ASK     538.3   75 5       01/03/2016 9:15         ASK     538.85
>>> 798 6       01/03/2016 9:15         ASK     538.9   93
>>>
>>> But as I am trying to run for multiple stocks data download script
>>> at
> same
>>> time and it is high-frequency data, so I am using R script to
> download data
>>> from server to R directly skipping excel using Rblpapi package.
>>>
>>> -- Thanks, Aritra
>>>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From trunglh at hvnh.edu.vn  Fri May 13 19:59:08 2016
From: trunglh at hvnh.edu.vn (Trung.BA)
Date: Fri, 13 May 2016 18:59:08 +0100
Subject: [R-SIG-Finance] FW: Re:  racd package
Message-ID: <008301d1ad41$25c7b6e0$715724a0$@hvnh.edu.vn>

Hi Alexios and team, 

I am using racd in modelling time varying higher moments for a daily return
of SP500 since 2000. 

I tried to used msoptim solver with n.sim = 10000. I am now considering
skewed t ("sstd"), NIG and SGED distribution.

I got this warning message :" In .acdmakefitmodel(acdmodel = fname, f = fun,
T = T, m = m, timer = timer,  :

  NaNs produced"

Then, when I plot the skewness and kurtosis parameter from estimated models,
they varies in the similar manner but in a large different value. For
example, kurtosis in sstd distribution is between 1 - 100, kurtosis of NIG
is even between 1-300. 

Is there anything wrong with my estimation that relate to surprising
differences in kurtosis and skewness estimated value? 

Thanks in advance 

Trung


	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Sat May 14 01:18:13 2016
From: alexios at 4dscape.com (alexios galanos)
Date: Fri, 13 May 2016 18:18:13 -0500
Subject: [R-SIG-Finance] FW: Re: racd package
In-Reply-To: <008301d1ad41$25c7b6e0$715724a0$@hvnh.edu.vn>
References: <008301d1ad41$25c7b6e0$715724a0$@hvnh.edu.vn>
Message-ID: <35c94514-0ad2-4d71-e17b-2529cea8a739@4dscape.com>

Please provide a reproducible example.

Alexios

On 13/05/2016 12:59, Trung.BA wrote:
> Hi Alexios and team, 
>
> I am using racd in modelling time varying higher moments for a daily return
> of SP500 since 2000. 
>
> I tried to used msoptim solver with n.sim = 10000. I am now considering
> skewed t ("sstd"), NIG and SGED distribution.
>
> I got this warning message :" In .acdmakefitmodel(acdmodel = fname, f = fun,
> T = T, m = m, timer = timer,  :
>
>   NaNs produced"
>
> Then, when I plot the skewness and kurtosis parameter from estimated models,
> they varies in the similar manner but in a large different value. For
> example, kurtosis in sstd distribution is between 1 - 100, kurtosis of NIG
> is even between 1-300. 
>
> Is there anything wrong with my estimation that relate to surprising
> differences in kurtosis and skewness estimated value? 
>
> Thanks in advance 
>
> Trung
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From fakir.charles.780 at student.lu.se  Mon May 23 23:02:05 2016
From: fakir.charles.780 at student.lu.se (FAKIR CHARLES)
Date: Mon, 23 May 2016 23:02:05 +0200
Subject: [R-SIG-Finance] ugarchspec: external regressors
Message-ID: <CACtY5jH67iHiP60-m2CUiAeYtbiVEqyjjFiL-nnhvt6id_i8=A@mail.gmail.com>

Hi All,

I am running rugarch Version: 1.3-5 and am trying to simulate the paper:
?High-low range in GARCH models of stock return volatility? SSRN:
http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2753336, for my thesis.

I am able to run sGARCH with no problems. The paper though, calls to
?estimate a GARCH(0,1) model with an exogenous variable? This is where it
goes all pear shape. I have modelled the volatility using the TTR package:
?train.vGK <- volatility(train.ohlc, calc="garman")
train.vParkinson <- volatility(train.ohlc, calc="parkinson")?

The result is an xts object, as expected considering my input class is xts,
and the dimensions after some adjustments:

> str(close.djdr)
An ?xts? object on 1993-01-15/2009-04-24 containing:
  Data: num [1:4100, 1] 0.000979 0.001161 -0.005788 -0.004309 0.003387 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : chr "daily.returns"
  Indexed by objects of class: [Date] TZ: UTC
  xts Attributes:
 NULL

> str(train.vParkinson)
An ?xts? object on 1993-01-15/2009-04-24 containing:
  Data: num [1:4100, 1] 0.0866 0.0853 0.0875 0.088 0.0772 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : chr "vParkinson"
  Indexed by objects of class: [Date] TZ: UTC
  xts Attributes:
 NULL

When I try to run the ugarchspec, it fails miserably:
> spec1X=ugarchspec(variance.model=list(model="sGARCH"),
+ external.regressors = train.vParkinson[,1],  #What is the correct form
here? I have lagged it: train.xreg = lag(train.vParkinson,1)
+ mean.model=list(armaOrder=c(0,0)))
Error in .local(variance.model, mean.model, distribution.model,
start.pars,  :
  unused argument (external.regressors = c(0.0866063373770964,
0.0853297963049413, 0.0875414180301314, 0.0880414499227675,
0.0771631965517572, 0.0707091044790502, 0.0778057119517414,
0.0775765066940466, 0.077820690394834, 0.0752388231276861,
0.072436404409338, 0.07452357235863, 0.0710133687112722,
0.0817565181849798, 0.0900172823007909, 0.0930080887667925,
0.0896830143657568, 0.089774572544706, 0.0904325308768051,
0.092930283058663, 0.0964456153316399, 0.123570155397932,
0.125244790062196, 0.138922401992731,
0.135292796408894, 0.134903364202769, 0.136922606737311, 0.138012028037638,
0.136775934192342, 0.136172719004911, 0.136364919382056, 0.122106445616322,
0.121111651605594, 0.0962623729322267, 0.0981395485851856,
0.117961280078613, 0.114364914549088, 0.112811619226829, 0.1139844134944,
0.120975655704514, 0.117871553416396, 0.106136285136668, 0.106057886734732,
0.113735726997588, 0.108700010793231, 0.085947506860437,
0.0853823006923295, 0.0834373451373239, 0.0829486747947965,

So, I lag my exon variable
train.xreg = lag(train.vParkinson,1)
train.test = as.matrix(train.xreg, ncol = 1)

Then set a matrix, but I don?t think this is required as I am using xts
class (see: https://stat.ethz.ch/pipermail/r-sig-finance/2014q3/012708.html)

I have tried to change the class of train.vParkinson to matrix, data.frame,
with the square brackets, without the square brackets, read several threads
on a similar problem. What am I doing wrong?

The data is extracted with quant mod:
#     1.1.1 Set start and end date for collection in YYYYMMDD (numeric)
format
train.date.start<-19930103 #Monday
train.date.end<-20090424 #Friday - changed the original date which was
20090427


#     1.1.2 Collect historical data for DJIA Index
train.djd <- getYahooData("^DJI", start=train.date.start,
end=train.date.end, freq="daily")
chartSeries(train.djd[,1:5])

close.djdr = dailyReturn(djd[,4], type="log") #daily returns close on close
close.djdr = close.djdr[-(1:9)]

Thanks in advance.
Kirro

	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Tue May 24 01:36:05 2016
From: alexios at 4dscape.com (alexios galanos)
Date: Mon, 23 May 2016 18:36:05 -0500
Subject: [R-SIG-Finance] ugarchspec: external regressors
In-Reply-To: <CACtY5jH67iHiP60-m2CUiAeYtbiVEqyjjFiL-nnhvt6id_i8=A@mail.gmail.com>
References: <CACtY5jH67iHiP60-m2CUiAeYtbiVEqyjjFiL-nnhvt6id_i8=A@mail.gmail.com>
Message-ID: <7427a198-47a9-d28a-53bc-068428078e19@4dscape.com>

I think the error message is quite informative:
"...unused argument (external.regressors...)

The "external.regressors" goes either in the mean.model or
variance.model list.
You are passing it outside, so you get an error. I did mention to you
when you
emailed me offline that it might be useful to carefully check the
ugarchspec specification and what you are passing.

A quick "arguments" check usually helps:

>args(ugarchspec)
function (
variance.model = list(model = "sGARCH", garchOrder = c(1, 1),
submodel = NULL, external.regressors = NULL, variance.targeting = FALSE),
mean.model = list(armaOrder = c(1, 1), include.mean = TRUE,
archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = NULL,
archex = FALSE),
distribution.model = "norm", start.pars = list(), fixed.pars = list(), ...)


Alexios

On 23/05/2016 16:02, FAKIR CHARLES wrote:
> Hi All,
>
> I am running rugarch Version: 1.3-5 and am trying to simulate the paper:
> ?High-low range in GARCH models of stock return volatility? SSRN:
> http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2753336, for my thesis.
>
> I am able to run sGARCH with no problems. The paper though, calls to
> ?estimate a GARCH(0,1) model with an exogenous variable? This is where it
> goes all pear shape. I have modelled the volatility using the TTR package:
> ?train.vGK <- volatility(train.ohlc, calc="garman")
> train.vParkinson <- volatility(train.ohlc, calc="parkinson")?
>
> The result is an xts object, as expected considering my input class is xts,
> and the dimensions after some adjustments:
>
>> str(close.djdr)
> An ?xts? object on 1993-01-15/2009-04-24 containing:
>   Data: num [1:4100, 1] 0.000979 0.001161 -0.005788 -0.004309 0.003387 ...
>  - attr(*, "dimnames")=List of 2
>   ..$ : NULL
>   ..$ : chr "daily.returns"
>   Indexed by objects of class: [Date] TZ: UTC
>   xts Attributes:
>  NULL
>
>> str(train.vParkinson)
> An ?xts? object on 1993-01-15/2009-04-24 containing:
>   Data: num [1:4100, 1] 0.0866 0.0853 0.0875 0.088 0.0772 ...
>  - attr(*, "dimnames")=List of 2
>   ..$ : NULL
>   ..$ : chr "vParkinson"
>   Indexed by objects of class: [Date] TZ: UTC
>   xts Attributes:
>  NULL
>
> When I try to run the ugarchspec, it fails miserably:
>> spec1X=ugarchspec(variance.model=list(model="sGARCH"),
> + external.regressors = train.vParkinson[,1],  #What is the correct form
> here? I have lagged it: train.xreg = lag(train.vParkinson,1)
> + mean.model=list(armaOrder=c(0,0)))
> Error in .local(variance.model, mean.model, distribution.model,
> start.pars,  :
>   unused argument (external.regressors = c(0.0866063373770964,
> 0.0853297963049413, 0.0875414180301314, 0.0880414499227675,
> 0.0771631965517572, 0.0707091044790502, 0.0778057119517414,
> 0.0775765066940466, 0.077820690394834, 0.0752388231276861,
> 0.072436404409338, 0.07452357235863, 0.0710133687112722,
> 0.0817565181849798, 0.0900172823007909, 0.0930080887667925,
> 0.0896830143657568, 0.089774572544706, 0.0904325308768051,
> 0.092930283058663, 0.0964456153316399, 0.123570155397932,
> 0.125244790062196, 0.138922401992731,
> 0.135292796408894, 0.134903364202769, 0.136922606737311, 0.138012028037638,
> 0.136775934192342, 0.136172719004911, 0.136364919382056, 0.122106445616322,
> 0.121111651605594, 0.0962623729322267, 0.0981395485851856,
> 0.117961280078613, 0.114364914549088, 0.112811619226829, 0.1139844134944,
> 0.120975655704514, 0.117871553416396, 0.106136285136668, 0.106057886734732,
> 0.113735726997588, 0.108700010793231, 0.085947506860437,
> 0.0853823006923295, 0.0834373451373239, 0.0829486747947965,
>
> So, I lag my exon variable
> train.xreg = lag(train.vParkinson,1)
> train.test = as.matrix(train.xreg, ncol = 1)
>
> Then set a matrix, but I don?t think this is required as I am using xts
> class (see: https://stat.ethz.ch/pipermail/r-sig-finance/2014q3/012708.html)
>
> I have tried to change the class of train.vParkinson to matrix, data.frame,
> with the square brackets, without the square brackets, read several threads
> on a similar problem. What am I doing wrong?
>
> The data is extracted with quant mod:
> #     1.1.1 Set start and end date for collection in YYYYMMDD (numeric)
> format
> train.date.start<-19930103 #Monday
> train.date.end<-20090424 #Friday - changed the original date which was
> 20090427
>
>
> #     1.1.2 Collect historical data for DJIA Index
> train.djd <- getYahooData("^DJI", start=train.date.start,
> end=train.date.end, freq="daily")
> chartSeries(train.djd[,1:5])
>
> close.djdr = dailyReturn(djd[,4], type="log") #daily returns close on close
> close.djdr = close.djdr[-(1:9)]
>
> Thanks in advance.
> Kirro
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From fakir.charles.780 at student.lu.se  Tue May 24 13:08:59 2016
From: fakir.charles.780 at student.lu.se (FAKIR CHARLES)
Date: Tue, 24 May 2016 13:08:59 +0200
Subject: [R-SIG-Finance] ugarchspec: external regressors
In-Reply-To: <7427a198-47a9-d28a-53bc-068428078e19@4dscape.com>
References: <CACtY5jH67iHiP60-m2CUiAeYtbiVEqyjjFiL-nnhvt6id_i8=A@mail.gmail.com>
	<7427a198-47a9-d28a-53bc-068428078e19@4dscape.com>
Message-ID: <CACtY5jH7P_Fv7ayxyH=NEciiB3-L2TjwsQzB+7oBrtweG_Qoag@mail.gmail.com>

Hi Alexios,

Thanks for all your hardwork, I think many would agree with if I say you
are doing a great job.

As for me, I have less than 6 months experience with R, so I already feel
dumb, and when the solution is so simple, well you can imagine how I feel.
Anyway I got my ugarchspec with the external regressor, and now will have a
few days trying to figure out, my ugarchfit problem:

> fit1X=ugarchfit(data=close.djdr,spec=spec1X)
Error in temp$h : $ operator is invalid for atomic vectors
In addition: Warning message:
In .makefitmodel(garchmodel = "sGARCH", f = .sgarchLLH, T = T, m = m,  :
rugarch-->warning: failed to invert hessian

So, don't be surprised if this thread continues.

Regards
Fakir Charles

On Tue, May 24, 2016 at 1:36 AM, alexios galanos <alexios at 4dscape.com>
wrote:

> I think the error message is quite informative:
> "...unused argument (external.regressors...)
>
> The "external.regressors" goes either in the mean.model or
> variance.model list.
> You are passing it outside, so you get an error. I did mention to you
> when you
> emailed me offline that it might be useful to carefully check the
> ugarchspec specification and what you are passing.
>
> A quick "arguments" check usually helps:
>
> >args(ugarchspec)
> function (
> variance.model = list(model = "sGARCH", garchOrder = c(1, 1),
> submodel = NULL, external.regressors = NULL, variance.targeting = FALSE),
> mean.model = list(armaOrder = c(1, 1), include.mean = TRUE,
> archm = FALSE, archpow = 1, arfima = FALSE, external.regressors = NULL,
> archex = FALSE),
> distribution.model = "norm", start.pars = list(), fixed.pars = list(), ...)
>
>
> Alexios
>
> On 23/05/2016 16:02, FAKIR CHARLES wrote:
> > Hi All,
> >
> > I am running rugarch Version: 1.3-5 and am trying to simulate the paper:
> > ?High-low range in GARCH models of stock return volatility? SSRN:
> > http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2753336, for my
> thesis.
> >
> > I am able to run sGARCH with no problems. The paper though, calls to
> > ?estimate a GARCH(0,1) model with an exogenous variable? This is where it
> > goes all pear shape. I have modelled the volatility using the TTR
> package:
> > ?train.vGK <- volatility(train.ohlc, calc="garman")
> > train.vParkinson <- volatility(train.ohlc, calc="parkinson")?
> >
> > The result is an xts object, as expected considering my input class is
> xts,
> > and the dimensions after some adjustments:
> >
> >> str(close.djdr)
> > An ?xts? object on 1993-01-15/2009-04-24 containing:
> >   Data: num [1:4100, 1] 0.000979 0.001161 -0.005788 -0.004309 0.003387
> ...
> >  - attr(*, "dimnames")=List of 2
> >   ..$ : NULL
> >   ..$ : chr "daily.returns"
> >   Indexed by objects of class: [Date] TZ: UTC
> >   xts Attributes:
> >  NULL
> >
> >> str(train.vParkinson)
> > An ?xts? object on 1993-01-15/2009-04-24 containing:
> >   Data: num [1:4100, 1] 0.0866 0.0853 0.0875 0.088 0.0772 ...
> >  - attr(*, "dimnames")=List of 2
> >   ..$ : NULL
> >   ..$ : chr "vParkinson"
> >   Indexed by objects of class: [Date] TZ: UTC
> >   xts Attributes:
> >  NULL
> >
> > When I try to run the ugarchspec, it fails miserably:
> >> spec1X=ugarchspec(variance.model=list(model="sGARCH"),
> > + external.regressors = train.vParkinson[,1],  #What is the correct form
> > here? I have lagged it: train.xreg = lag(train.vParkinson,1)
> > + mean.model=list(armaOrder=c(0,0)))
> > Error in .local(variance.model, mean.model, distribution.model,
> > start.pars,  :
> >   unused argument (external.regressors = c(0.0866063373770964,
> > 0.0853297963049413, 0.0875414180301314, 0.0880414499227675,
> > 0.0771631965517572, 0.0707091044790502, 0.0778057119517414,
> > 0.0775765066940466, 0.077820690394834, 0.0752388231276861,
> > 0.072436404409338, 0.07452357235863, 0.0710133687112722,
> > 0.0817565181849798, 0.0900172823007909, 0.0930080887667925,
> > 0.0896830143657568, 0.089774572544706, 0.0904325308768051,
> > 0.092930283058663, 0.0964456153316399, 0.123570155397932,
> > 0.125244790062196, 0.138922401992731,
> > 0.135292796408894, 0.134903364202769, 0.136922606737311,
> 0.138012028037638,
> > 0.136775934192342, 0.136172719004911, 0.136364919382056,
> 0.122106445616322,
> > 0.121111651605594, 0.0962623729322267, 0.0981395485851856,
> > 0.117961280078613, 0.114364914549088, 0.112811619226829, 0.1139844134944,
> > 0.120975655704514, 0.117871553416396, 0.106136285136668,
> 0.106057886734732,
> > 0.113735726997588, 0.108700010793231, 0.085947506860437,
> > 0.0853823006923295, 0.0834373451373239, 0.0829486747947965,
> >
> > So, I lag my exon variable
> > train.xreg = lag(train.vParkinson,1)
> > train.test = as.matrix(train.xreg, ncol = 1)
> >
> > Then set a matrix, but I don?t think this is required as I am using xts
> > class (see:
> https://stat.ethz.ch/pipermail/r-sig-finance/2014q3/012708.html)
> >
> > I have tried to change the class of train.vParkinson to matrix,
> data.frame,
> > with the square brackets, without the square brackets, read several
> threads
> > on a similar problem. What am I doing wrong?
> >
> > The data is extracted with quant mod:
> > #     1.1.1 Set start and end date for collection in YYYYMMDD (numeric)
> > format
> > train.date.start<-19930103 #Monday
> > train.date.end<-20090424 #Friday - changed the original date which was
> > 20090427
> >
> >
> > #     1.1.2 Collect historical data for DJIA Index
> > train.djd <- getYahooData("^DJI", start=train.date.start,
> > end=train.date.end, freq="daily")
> > chartSeries(train.djd[,1:5])
> >
> > close.djdr = dailyReturn(djd[,4], type="log") #daily returns close on
> close
> > close.djdr = close.djdr[-(1:9)]
> >
> > Thanks in advance.
> > Kirro
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>

	[[alternative HTML version deleted]]


From atakanokan at outlook.com  Tue May 24 18:39:53 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Tue, 24 May 2016 19:39:53 +0300
Subject: [R-SIG-Finance] Trailing Stop Loss Execution at Custom Levels
Message-ID: <BAY172-W10B9AD846BE1854ACA7623C74F0@phx.gbl>

Hi r-sig-finance,

I want Trailing stops to execute at levels different than the default level, which I assume is the High-TrailingStopDistance. How can I implement trailing stops that get executed at levels different than this? For example: ((High-TrailingStopDistance)+Low)/2 or at the Low of the bar (maybe for stress testing). Below is a reproducible example with prefer=".." arguments commented out. I tried using the prefer argument with different levels such as "High","Low","Open" in?add.rule() with ordertype argument passed as "stoptrailing".?

Any help is appreciated, thanks.

Atakan Okan

Code:

library(quantstrat)?
Sys.setenv(TZ="UTC") ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
.strategy<- new.env();.blotter<- new.env() ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??

currency('USD') ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)

getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")
AAPL <- adjustOHLC(AAPL)

strategy.st <- paste("AAPL","SMA_D1",sep = "_")
rm.strat(strategy.st)?
initialEquity = 100000 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
initDate = "2013-12-30"?
initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")
initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")
initOrders(portfolio=strategy.st,initDate=initDate)?
strategy(strategy.st,store=TRUE)

txn.model <- 0 ? ?
positionSizeLong ?= ?1000 ? ??
positionSizeShort = ?-1000

longStopLossDistance <- 0.025 ??
shortStopLossDistance <- 0.025 ?
longTrailingStopDistance <- 0.01
shortTrailingStopDistance <- 0.01

add.indicator(strategy.st, ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? name = "SMA", ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? arguments = list(x=Cl(eval(parse(text = "AAPL")))
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?,n=5 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? ), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? label='fastsma') ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??

add.indicator(strategy.st, ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? name = "SMA", ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? arguments = list(x=Cl(eval(parse(text = "AAPL")))
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?,n=50 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?
? ? ? ? ? ? ? ), ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??
? ? ? ? ? ? ? label='slowsma') ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ??

add.signal(strategy.st,
? ? ? ? ? ?name="sigCrossover",
? ? ? ? ? ?arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),
? ? ? ? ? ?label="fastsma.gt.slowsma") ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?

add.signal(strategy.st,
? ? ? ? ? ?name="sigCrossover",
? ? ? ? ? ?arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),
? ? ? ? ? ?label="fastsma.lt.slowsma")

# Long Entry Rule-------------------------------------------------------------------
add.rule(strategy.st,
? ? ? ? ?name='ruleSignal',
? ? ? ? ?arguments = list(sigcol="fastsma.gt.slowsma",
? ? ? ? ? ? ? ? ? ? ? ? ? sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? prefer="Open",?
? ? ? ? ? ? ? ? ? ? ? ? ? orderqty= positionSizeLong,?
? ? ? ? ? ? ? ? ? ? ? ? ? #osFUN="osAllInLong", ?
? ? ? ? ? ? ? ? ? ? ? ? ? ordertype='market',
? ? ? ? ? ? ? ? ? ? ? ? ? orderside='long',
? ? ? ? ? ? ? ? ? ? ? ? ? orderset='ocolong',
? ? ? ? ? ? ? ? ? ? ? ? ? TxnFees = txn.model),
? ? ? ? ?type='enter',
? ? ? ? ?label='longenter',
? ? ? ? ?enabled=TRUE
)

# Long Exit Rule-------------------------------------------------------------------
add.rule(strategy.st,
? ? ? ? ?name='ruleSignal',
? ? ? ? ?arguments = list(sigcol="fastsma.lt.slowsma",
? ? ? ? ? ? ? ? ? ? ? ? ? sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? prefer="Open",?
? ? ? ? ? ? ? ? ? ? ? ? ? orderqty='all',
? ? ? ? ? ? ? ? ? ? ? ? ? ordertype='market',
? ? ? ? ? ? ? ? ? ? ? ? ? orderside='long',
? ? ? ? ? ? ? ? ? ? ? ? ? orderset='ocolong',
? ? ? ? ? ? ? ? ? ? ? ? ? TxnFees = txn.model),
? ? ? ? ?type='exit',
? ? ? ? ?label='longexit',
? ? ? ? ?enabled=TRUE
)

# Long StopLoss Rule---------------------------------------------------------------------------
add.rule(strategy.st,name='ruleSignal',
? ? ? ? ?arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? ?replace=FALSE,
? ? ? ? ? ? ? ? ? ? ? ? ? ?orderside='long',
? ? ? ? ? ? ? ? ? ? ? ? ? ?ordertype='stoplimit',
? ? ? ? ? ? ? ? ? ? ? ? ? ?tmult=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? ?threshold=quote( longStopLossDistance ),
? ? ? ? ? ? ? ? ? ? ? ? ? ?orderqty='all',
? ? ? ? ? ? ? ? ? ? ? ? ? ?orderset='ocolong',
? ? ? ? ? ? ? ? ? ? ? ? ? ?TxnFees = txn.model),
? ? ? ? ?type='chain', parent="longenter",
? ? ? ? ?label='StopLossLong',
? ? ? ? ?enabled=TRUE)

# Long Trailing Stop Rule--------------------------------------------------------
add.rule(strategy.st, name = 'ruleSignal',
? ? ? ? ?arguments=list(sigcol="fastsma.lt.slowsma" , sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? replace=FALSE,
? ? ? ? ? ? ? ? ? ? ? ? orderside='long',
? ? ? ? ? ? ? ? ? ? ? ? #prefer="High",
? ? ? ? ? ? ? ? ? ? ? ? ordertype='stoptrailing',
? ? ? ? ? ? ? ? ? ? ? ? tmult=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? threshold=quote(longTrailingStopDistance),
? ? ? ? ? ? ? ? ? ? ? ? orderqty='all',
? ? ? ? ? ? ? ? ? ? ? ? orderset='ocolong',
? ? ? ? ? ? ? ? ? ? ? ? TxnFees = txn.model),
? ? ? ? ?type='chain', parent="longenter",
? ? ? ? ?label='StopTrailingLong',
? ? ? ? ?enabled=TRUE
)


# Short Entry Rule--------------------------------------------------------------------
add.rule(strategy.st,
? ? ? ? ?name='ruleSignal',
? ? ? ? ?arguments = list(sigcol="fastsma.lt.slowsma",
? ? ? ? ? ? ? ? ? ? ? ? ? sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? prefer="Open",?
? ? ? ? ? ? ? ? ? ? ? ? ? orderqty=positionSizeShort,?
? ? ? ? ? ? ? ? ? ? ? ? ? #osFUN="osAllInShort", ?
? ? ? ? ? ? ? ? ? ? ? ? ? ordertype='market',
? ? ? ? ? ? ? ? ? ? ? ? ? orderside='short',
? ? ? ? ? ? ? ? ? ? ? ? ? orderset='ocoshort',
? ? ? ? ? ? ? ? ? ? ? ? ? TxnFees = txn.model),
? ? ? ? ?type='enter',
? ? ? ? ?label='shortenter',
? ? ? ? ?enabled=TRUE
)

# Short Exit Rule---------------------------------------------------------------------
add.rule(strategy.st,
? ? ? ? ?name='ruleSignal',
? ? ? ? ?arguments = list(sigcol="fastsma.gt.slowsma",
? ? ? ? ? ? ? ? ? ? ? ? ? sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? prefer="Open",?
? ? ? ? ? ? ? ? ? ? ? ? ? orderqty='all',
? ? ? ? ? ? ? ? ? ? ? ? ? ordertype='market',
? ? ? ? ? ? ? ? ? ? ? ? ? orderside='short',
? ? ? ? ? ? ? ? ? ? ? ? ? orderset='ocoshort',
? ? ? ? ? ? ? ? ? ? ? ? ? TxnFees = txn.model),
? ? ? ? ?type='exit',
? ? ? ? ?label='shortexit',
? ? ? ? ?enabled=TRUE
)

# Short Stop Loss Rule-----------------------------------------------------------------
add.rule(strategy.st,name='ruleSignal',
? ? ? ? ?arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? ?replace=FALSE,
? ? ? ? ? ? ? ? ? ? ? ? ? ?orderside='short',
? ? ? ? ? ? ? ? ? ? ? ? ? ?ordertype='stoplimit',
? ? ? ? ? ? ? ? ? ? ? ? ? ?tmult=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? ? ?threshold=quote( shortStopLossDistance ),
? ? ? ? ? ? ? ? ? ? ? ? ? ?orderqty='all',
? ? ? ? ? ? ? ? ? ? ? ? ? ?orderset='ocoshort',
? ? ? ? ? ? ? ? ? ? ? ? ? ?TxnFees = txn.model),
? ? ? ? ?type='chain', parent="shortenter",
? ? ? ? ?label='StopLossShort',
? ? ? ? ?enabled=TRUE)

# Short Trailing Stop Loss Rule-------------------------------------------------------
add.rule(strategy.st, name = 'ruleSignal',
? ? ? ? ?arguments=list(sigcol="fastsma.gt.slowsma" , sigval=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? replace=FALSE,
? ? ? ? ? ? ? ? ? ? ? ? orderside='short',
? ? ? ? ? ? ? ? ? ? ? ? #prefer="Open",
? ? ? ? ? ? ? ? ? ? ? ? ordertype='stoptrailing',
? ? ? ? ? ? ? ? ? ? ? ? tmult=TRUE,
? ? ? ? ? ? ? ? ? ? ? ? threshold=quote( shortTrailingStopDistance),
? ? ? ? ? ? ? ? ? ? ? ? orderqty='all',
? ? ? ? ? ? ? ? ? ? ? ? orderset='ocoshort',
? ? ? ? ? ? ? ? ? ? ? ? TxnFees = txn.model),
? ? ? ? ?type='chain', parent="shortenter",
? ? ? ? ?label='StopTrailingShort',
? ? ? ? ?enabled=TRUE
)



summary(getStrategy(strategy.st)) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?

applyStrategy( strategy=strategy.st , portfolios=strategy.st
? ? ? ? ? ? ? ?#,parameters=list(n = 5)
? ? ? ? ? ? ? ?,verbose=TRUE)
updatePortf(strategy.st)
updateAcct(strategy.st)
updateEndEq(strategy.st)

results.df.2 <- data.frame(tradeStats(strategy.st))

chart.Posn(strategy.st, Symbol = "AAPL"
? ? ? ? ? ?, Dates = '2014-04-01::2014-06-25'
) ? ? ? ? ? ? ?

 		 	   		  

From brian at braverock.com  Tue May 24 19:03:02 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 24 May 2016 12:03:02 -0500
Subject: [R-SIG-Finance] Trailing Stop Loss Execution at Custom Levels
In-Reply-To: <BAY172-W10B9AD846BE1854ACA7623C74F0@phx.gbl>
References: <BAY172-W10B9AD846BE1854ACA7623C74F0@phx.gbl>
Message-ID: <1464109382.10392.76.camel@brian-rcg>

Add a custom price column either before calling applyStrategy or
preferably using an indicator and set a prefer= argument for which price
to use as the reference price for your stop order. 


On Tue, 2016-05-24 at 19:39 +0300, Atakan Okan wrote:
> Hi r-sig-finance,
> 
> I want Trailing stops to execute at levels different than the default level, which I assume is the High-TrailingStopDistance. How can I implement trailing stops that get executed at levels different than this? For example: ((High-TrailingStopDistance)+Low)/2 or at the Low of the bar (maybe for stress testing). Below is a reproducible example with prefer=".." arguments commented out. I tried using the prefer argument with different levels such as "High","Low","Open" in add.rule() with ordertype argument passed as "stoptrailing". 
> 
> Any help is appreciated, thanks.
> 
> Atakan Okan
> 
> Code:
> 
> library(quantstrat) 
> Sys.setenv(TZ="UTC")                                                                                 
> .strategy<- new.env();.blotter<- new.env()                                                                                                                             
> 
> currency('USD')                                                                                                                                                                      
> stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)
> 
> getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")
> AAPL <- adjustOHLC(AAPL)
> 
> strategy.st <- paste("AAPL","SMA_D1",sep = "_")
> rm.strat(strategy.st) 
> initialEquity = 100000                                                                               
> initDate = "2013-12-30" 
> initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")
> initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")
> initOrders(portfolio=strategy.st,initDate=initDate) 
> strategy(strategy.st,store=TRUE)
> 
> txn.model <- 0    
> positionSizeLong  =  1000     
> positionSizeShort =  -1000
> 
> longStopLossDistance <- 0.025   
> shortStopLossDistance <- 0.025  
> longTrailingStopDistance <- 0.01
> shortTrailingStopDistance <- 0.01
> 
> add.indicator(strategy.st,                                               
>               name = "SMA",                                               
>               arguments = list(x=Cl(eval(parse(text = "AAPL")))
>                                ,n=5                                 
>               ),                                                            
>               label='fastsma')                                           
> 
> add.indicator(strategy.st,                                                 
>               name = "SMA",                                                
>               arguments = list(x=Cl(eval(parse(text = "AAPL")))
>                                ,n=50                                
>               ),                                                           
>               label='slowsma')                                             
> 
> add.signal(strategy.st,
>            name="sigCrossover",
>            arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),
>            label="fastsma.gt.slowsma")                                                        
> 
> add.signal(strategy.st,
>            name="sigCrossover",
>            arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),
>            label="fastsma.lt.slowsma")
> 
> # Long Entry Rule-------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.gt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty= positionSizeLong, 
>                           #osFUN="osAllInLong",  
>                           ordertype='market',
>                           orderside='long',
>                           orderset='ocolong',
>                           TxnFees = txn.model),
>          type='enter',
>          label='longenter',
>          enabled=TRUE
> )
> 
> # Long Exit Rule-------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.lt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty='all',
>                           ordertype='market',
>                           orderside='long',
>                           orderset='ocolong',
>                           TxnFees = txn.model),
>          type='exit',
>          label='longexit',
>          enabled=TRUE
> )
> 
> # Long StopLoss Rule---------------------------------------------------------------------------
> add.rule(strategy.st,name='ruleSignal',
>          arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,
>                            replace=FALSE,
>                            orderside='long',
>                            ordertype='stoplimit',
>                            tmult=TRUE,
>                            threshold=quote( longStopLossDistance ),
>                            orderqty='all',
>                            orderset='ocolong',
>                            TxnFees = txn.model),
>          type='chain', parent="longenter",
>          label='StopLossLong',
>          enabled=TRUE)
> 
> # Long Trailing Stop Rule--------------------------------------------------------
> add.rule(strategy.st, name = 'ruleSignal',
>          arguments=list(sigcol="fastsma.lt.slowsma" , sigval=TRUE,
>                         replace=FALSE,
>                         orderside='long',
>                         #prefer="High",
>                         ordertype='stoptrailing',
>                         tmult=TRUE,
>                         threshold=quote(longTrailingStopDistance),
>                         orderqty='all',
>                         orderset='ocolong',
>                         TxnFees = txn.model),
>          type='chain', parent="longenter",
>          label='StopTrailingLong',
>          enabled=TRUE
> )
> 
> 
> # Short Entry Rule--------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.lt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty=positionSizeShort, 
>                           #osFUN="osAllInShort",  
>                           ordertype='market',
>                           orderside='short',
>                           orderset='ocoshort',
>                           TxnFees = txn.model),
>          type='enter',
>          label='shortenter',
>          enabled=TRUE
> )
> 
> # Short Exit Rule---------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.gt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty='all',
>                           ordertype='market',
>                           orderside='short',
>                           orderset='ocoshort',
>                           TxnFees = txn.model),
>          type='exit',
>          label='shortexit',
>          enabled=TRUE
> )
> 
> # Short Stop Loss Rule-----------------------------------------------------------------
> add.rule(strategy.st,name='ruleSignal',
>          arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,
>                            replace=FALSE,
>                            orderside='short',
>                            ordertype='stoplimit',
>                            tmult=TRUE,
>                            threshold=quote( shortStopLossDistance ),
>                            orderqty='all',
>                            orderset='ocoshort',
>                            TxnFees = txn.model),
>          type='chain', parent="shortenter",
>          label='StopLossShort',
>          enabled=TRUE)
> 
> # Short Trailing Stop Loss Rule-------------------------------------------------------
> add.rule(strategy.st, name = 'ruleSignal',
>          arguments=list(sigcol="fastsma.gt.slowsma" , sigval=TRUE,
>                         replace=FALSE,
>                         orderside='short',
>                         #prefer="Open",
>                         ordertype='stoptrailing',
>                         tmult=TRUE,
>                         threshold=quote( shortTrailingStopDistance),
>                         orderqty='all',
>                         orderset='ocoshort',
>                         TxnFees = txn.model),
>          type='chain', parent="shortenter",
>          label='StopTrailingShort',
>          enabled=TRUE
> )
> 
> 
> 
> summary(getStrategy(strategy.st))                                              
> 
> applyStrategy( strategy=strategy.st , portfolios=strategy.st
>                #,parameters=list(n = 5)
>                ,verbose=TRUE)
> updatePortf(strategy.st)
> updateAcct(strategy.st)
> updateEndEq(strategy.st)
> 
> results.df.2 <- data.frame(tradeStats(strategy.st))
> 
> chart.Posn(strategy.st, Symbol = "AAPL"
>            , Dates = '2014-04-01::2014-06-25'
> )              
> 
>  		 	   		  
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From brian at braverock.com  Tue May 24 19:19:04 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 24 May 2016 12:19:04 -0500
Subject: [R-SIG-Finance] Trailing Stop Loss Execution at Custom Levels
In-Reply-To: <BAY172-W10B9AD846BE1854ACA7623C74F0@phx.gbl>
References: <BAY172-W10B9AD846BE1854ACA7623C74F0@phx.gbl>
Message-ID: <1464110344.10392.77.camel@brian-rcg>

Add a custom price column either before calling applyStrategy or
preferably using an indicator and set a prefer= argument for which price
to use as the reference price for your stop order. 

-- 
Brian

On Tue, 2016-05-24 at 19:39 +0300, Atakan Okan wrote:
> Hi r-sig-finance,
> 
> I want Trailing stops to execute at levels different than the default level, which I assume is the High-TrailingStopDistance. How can I implement trailing stops that get executed at levels different than this? For example: ((High-TrailingStopDistance)+Low)/2 or at the Low of the bar (maybe for stress testing). Below is a reproducible example with prefer=".." arguments commented out. I tried using the prefer argument with different levels such as "High","Low","Open" in add.rule() with ordertype argument passed as "stoptrailing". 
> 
> Any help is appreciated, thanks.
> 
> Atakan Okan
> 
> Code:
> 
> library(quantstrat) 
> Sys.setenv(TZ="UTC")                                                                                 
> .strategy<- new.env();.blotter<- new.env()                                                                                                                             
> 
> currency('USD')                                                                                                                                                                      
> stock("AAPL", currency="USD", multiplier=1,tick_size= 0.01)
> 
> getSymbols('AAPL',src = 'yahoo', from="2014-01-01", to="2015-05-31")
> AAPL <- adjustOHLC(AAPL)
> 
> strategy.st <- paste("AAPL","SMA_D1",sep = "_")
> rm.strat(strategy.st) 
> initialEquity = 100000                                                                               
> initDate = "2013-12-30" 
> initPortf(strategy.st, "AAPL", initDate=initDate, currency = "USD")
> initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, initEq=initialEquity, currency = "USD")
> initOrders(portfolio=strategy.st,initDate=initDate) 
> strategy(strategy.st,store=TRUE)
> 
> txn.model <- 0    
> positionSizeLong  =  1000     
> positionSizeShort =  -1000
> 
> longStopLossDistance <- 0.025   
> shortStopLossDistance <- 0.025  
> longTrailingStopDistance <- 0.01
> shortTrailingStopDistance <- 0.01
> 
> add.indicator(strategy.st,                                               
>               name = "SMA",                                               
>               arguments = list(x=Cl(eval(parse(text = "AAPL")))
>                                ,n=5                                 
>               ),                                                            
>               label='fastsma')                                           
> 
> add.indicator(strategy.st,                                                 
>               name = "SMA",                                                
>               arguments = list(x=Cl(eval(parse(text = "AAPL")))
>                                ,n=50                                
>               ),                                                           
>               label='slowsma')                                             
> 
> add.signal(strategy.st,
>            name="sigCrossover",
>            arguments = list(columns=c("fastsma","slowsma"),relationship="gt"),
>            label="fastsma.gt.slowsma")                                                        
> 
> add.signal(strategy.st,
>            name="sigCrossover",
>            arguments = list(columns=c("fastsma","slowsma"),relationship="lt"),
>            label="fastsma.lt.slowsma")
> 
> # Long Entry Rule-------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.gt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty= positionSizeLong, 
>                           #osFUN="osAllInLong",  
>                           ordertype='market',
>                           orderside='long',
>                           orderset='ocolong',
>                           TxnFees = txn.model),
>          type='enter',
>          label='longenter',
>          enabled=TRUE
> )
> 
> # Long Exit Rule-------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.lt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty='all',
>                           ordertype='market',
>                           orderside='long',
>                           orderset='ocolong',
>                           TxnFees = txn.model),
>          type='exit',
>          label='longexit',
>          enabled=TRUE
> )
> 
> # Long StopLoss Rule---------------------------------------------------------------------------
> add.rule(strategy.st,name='ruleSignal',
>          arguments = list( sigcol="fastsma.lt.slowsma", sigval=TRUE,
>                            replace=FALSE,
>                            orderside='long',
>                            ordertype='stoplimit',
>                            tmult=TRUE,
>                            threshold=quote( longStopLossDistance ),
>                            orderqty='all',
>                            orderset='ocolong',
>                            TxnFees = txn.model),
>          type='chain', parent="longenter",
>          label='StopLossLong',
>          enabled=TRUE)
> 
> # Long Trailing Stop Rule--------------------------------------------------------
> add.rule(strategy.st, name = 'ruleSignal',
>          arguments=list(sigcol="fastsma.lt.slowsma" , sigval=TRUE,
>                         replace=FALSE,
>                         orderside='long',
>                         #prefer="High",
>                         ordertype='stoptrailing',
>                         tmult=TRUE,
>                         threshold=quote(longTrailingStopDistance),
>                         orderqty='all',
>                         orderset='ocolong',
>                         TxnFees = txn.model),
>          type='chain', parent="longenter",
>          label='StopTrailingLong',
>          enabled=TRUE
> )
> 
> 
> # Short Entry Rule--------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.lt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty=positionSizeShort, 
>                           #osFUN="osAllInShort",  
>                           ordertype='market',
>                           orderside='short',
>                           orderset='ocoshort',
>                           TxnFees = txn.model),
>          type='enter',
>          label='shortenter',
>          enabled=TRUE
> )
> 
> # Short Exit Rule---------------------------------------------------------------------
> add.rule(strategy.st,
>          name='ruleSignal',
>          arguments = list(sigcol="fastsma.gt.slowsma",
>                           sigval=TRUE,
>                           prefer="Open", 
>                           orderqty='all',
>                           ordertype='market',
>                           orderside='short',
>                           orderset='ocoshort',
>                           TxnFees = txn.model),
>          type='exit',
>          label='shortexit',
>          enabled=TRUE
> )
> 
> # Short Stop Loss Rule-----------------------------------------------------------------
> add.rule(strategy.st,name='ruleSignal',
>          arguments = list( sigcol="fastsma.gt.slowsma", sigval=TRUE,
>                            replace=FALSE,
>                            orderside='short',
>                            ordertype='stoplimit',
>                            tmult=TRUE,
>                            threshold=quote( shortStopLossDistance ),
>                            orderqty='all',
>                            orderset='ocoshort',
>                            TxnFees = txn.model),
>          type='chain', parent="shortenter",
>          label='StopLossShort',
>          enabled=TRUE)
> 
> # Short Trailing Stop Loss Rule-------------------------------------------------------
> add.rule(strategy.st, name = 'ruleSignal',
>          arguments=list(sigcol="fastsma.gt.slowsma" , sigval=TRUE,
>                         replace=FALSE,
>                         orderside='short',
>                         #prefer="Open",
>                         ordertype='stoptrailing',
>                         tmult=TRUE,
>                         threshold=quote( shortTrailingStopDistance),
>                         orderqty='all',
>                         orderset='ocoshort',
>                         TxnFees = txn.model),
>          type='chain', parent="shortenter",
>          label='StopTrailingShort',
>          enabled=TRUE
> )
> 
> 
> 
> summary(getStrategy(strategy.st))                                              
> 
> applyStrategy( strategy=strategy.st , portfolios=strategy.st
>                #,parameters=list(n = 5)
>                ,verbose=TRUE)
> updatePortf(strategy.st)
> updateAcct(strategy.st)
> updateEndEq(strategy.st)
> 
> results.df.2 <- data.frame(tradeStats(strategy.st))
> 
> chart.Posn(strategy.st, Symbol = "AAPL"
>            , Dates = '2014-04-01::2014-06-25'
> )              
> 
>  		 	   		  
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


From stephen at organicfoodmarkets.com.au  Fri May 27 08:43:41 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Fri, 27 May 2016 16:43:41 +1000
Subject: [R-SIG-Finance] rule delays
Message-ID: <364ac72a-f789-5ceb-ad6f-1da1613d69c4@organicfoodmarkets.com.au>

Hi

I am trying to implement Harry's Connor's RSI from his book Quantative 
Trading ...

I have it working as is and have varied it to some shares in the ASX.

However, I want to pursue the idea of a fixed time (8 day) sell rule 
that takes place if the normal rule doesn't produce a sale before.

I added this rule at line 127 of the file 3. strategy.R:

add.rule(strategy.st, name = "ruleSignal",
     arguments = list(sigcol = "longExit",
     sigval = TRUE,
     orderqty = "all", delay = 691200,
     ordertype = "market",
     orderside = "long", TxnFees = txnFees,
     replace = FALSE,
     prefer = "Open"), type= "exit", path.dep = TRUE)

but it seems to have no effect.

I attach all the code. You run it in the numbered order of the files.

I wonder if anyone can help me make this sort of rule work.

----------------------------------------------------------------------------------------------------------------------------------- 

Stephen Choularton PhD, FIoD
0413 545 182
-------------- next part --------------
######### FUNCTIONS #########################

######### CONNOR SRI FUNCTIONS ##########################################

library(TTR)

# compute Connor's RSI, depends on the RSI TTR function

connorsRSI <- function(price, nRSI = 3, nStreak = 2, nPercentLookBack = 100){

	priceRSI <- RSI(price, nRSI)
	streakRSI <- RSI(computeStreak(price), nStreak)
	percents <- round(runPercentRank(x = diff(log(price)), n = 100, cumulative = FALSE, exact.multiplier = 1) * 100)
	ret <- (priceRSI + streakRSI + percents) /3
	colnames(ret) <- "connorsRSI"
	return(ret)

}

# computes a running streak of positives and negatives of price changes

computeStreak <- function(priceSeries){

	signs <- sign(diff(priceSeries))
	posDiffs <- negDiffs <- rep(0, length(signs))
	posDiffs[signs == 1] <- 1
	posDiffs[signs == -1] <- -1

	# create vector of cumulatives sums and cumulative sums not incremented during streaks. Zero out any leading NAs after na.locf
	posCum <- cumsum(posDiffs)
	posNAcum <- posCum
	posNAcum[posDiffs == 1] <- NA
	posNAcum <- na.locf(posNAcum, na.rm = FALSE)
	posNAcum[is.na(posNAcum)] <- 0
	posStreak <- posCum - posNAcum

	# repeat for negative cumulative sums
	negCum <- cumsum(negDiffs)
	negNAcum <- negCum
	negNAcum[negDiffs == -1] <- NA
	negNAcum <- na.locf(negNAcum, na.rm = FALSE)
	negNAcum[is.na(negNAcum)] <- 0
	negStreak <- negCum - negNAcum

	streak <- posStreak + negStreak
	streak <- xts(streak, order.by = index(priceSeries))

}

sigAND <- function(label, data=mktdata, columns, cross = FALSE){

	ret_sig = NULL
	colNums <- rep(0, length(columns))
	for(i in 1:length(columns)){
		colNums[i] <- match.names(columns[i], colnames(data))
	}
	ret_sig <- data[, colNums[1]]
	if(isTRUE(cross)){
		ret_sig <- diff(ret_sig) == 1
	}
	colnames(ret_sig) <- label
	return(ret_sig)
}

cumCRSI <- function(price, nCum = 2, ...) {

	CSRI <- connorsRSI(price, ...)
	out <- runSum(CSRI, nCum)
	colnames(out) <- "cumCRSI"
	out

}






###########################################################################

######### ATR ORDER SIZING FUNCTIONS #######################################

lagATR <- function(HLC, n = 14, maType, lag = 1, ...) {
	ATR <- ATR(HLC, n = n, maType = maType, ...)
	ATR <- lag(ATR, lag)
	out <- ATR$atr
	colnames(out) <- "atr"
	return(out)
}

osDollarATR <- function(orderside, tradeSize, pctATR, maxPctATR = pctATR, data, timestamp, symbol, prefer = "Open", portfolio, integerQty = TRUE, strMod = "", rebal = FALSE, ...) {

	if(tradeSize > 0 & orderside == "short") {
		tradeSize <- tradeSize * -1
	}

	pos <- getPosQty(portfolio, symbol, timestamp)
	atrString <- paste0("atr", strMod)
	atrCol <- grep(atrString, colnames(mktdata))

	if(length(atrCol) == 0) {
		stop(paste("Term", atrString, "not found in mktdata column names."))
	}

	atrTimeStamp <- mktdata[timestamp, atrCol]
	if(is.na(atrTimeStamp) | atrTimeStamp == 0){
		stop(paste("ATR corresponding to ", atrString, " is invalid at this point in time.  Add a logical operator to account for this."))
	}

	dollarATR <- pos * atrTimeStamp
	desiredDollarATR <- pctATR * tradeSize
	remainingRiskCapacity <- tradeSize * maxPctATR - dollarATR

	if(orderside == "long") {
		qty <- min(tradeSize * pctATR / atrTimeStamp, remainingRiskCapacity / atrTimeStamp)
	} else {
		qty <- max(tradeSize * pctATR / atrTimeStamp, remainingRiskCapacity / atrTimeStamp)
	}

	if(integerQty) {
		qty <- trunc(qty)
	}

	if(!rebal){
		if(orderside == "long" & qty < 0) {
			qty <- 0
		} 
		if(orderside == "short" & qty > 0){
			qty <- 0
		}
	}

	if(rebal) {
		if(pos == 0) {
			qty <- 0
		}
	}

	return (qty)
}


-------------- next part --------------
# do I need these

library(quantstrat)
library(PerformanceAnalytics)
library(blotter)
library(TTR)

# trade size and initial equity settings ???????
#tradeSize <- 10000
#initEq <- tradeSize * length(symbols)


#rm(list = ls(.blotter), envir = .blotter)
initDate = "1990-01-01"
from = "2003-01-01"
to = "2013-12-31"
#initEq = 10000

#currency("USD")
#Sys.setenv(TZ="UTC")

# suppress warnings
options("getSymbols.warning4.0" = FALSE)

# do some house cleaning
rm(list = ls(.blotter), envir = .blotter)

# set the current and time zone
#currency(primary_id = 'USD') # must be first thing specified
#Sys.setenv(TZ = "UTC")

# define the symbols of interest
symbols <- c("AMP.AX",
		"ANZ.AX",
		"BHP.AX",
		"BXB.AX",
		"CBA.AX",
		"CSL.AX",
		"IAG.AX",
		"MQG.AX",
		"NAB.AX",
		"QBE.AX",
		"RIO.AX",
		"SCG.AX",
		"SUN.AX",
		"TCL.AX",
		"TLS.AX",
		"WBC.AX",
		"WES.AX",
		"WFD.AX",
		"WOW.AX",
		"WPL.AX"
		)


# SPDR EFTs first, iShares EFT's afterwards
#if(!"XLB" %in% ls()){
	#if data is not present get it from yahoo
	suppressMessages(getSymbols(symbols, from = from, to = to, src = "yahoo", adjust = TRUE))
#}

#  define the instrument type
stock(symbols, currency = "AUD", multiplier = 1)








-------------- next part --------------
# NEED TO ADD BROKERAGE AND SLIPPAGE?

########## SETUP AND BACKTEST ###############

########### SETUP #############################

#library(quantstrat)
#library(PerformanceAnalytics)
#library(blotter)
#library(TTR)

# trade size and initial equity settings ???????
tradeSize <- 10000
initEq <- tradeSize * length(symbols)
txnFees <- tradeSize * .0008 * -1

rm(list = ls(.blotter), envir = .blotter)
#initDate = "1990-01-01"
#from = "2003-01-01"
#to = "2013-12-31"
#initEq = 10000

currency("AUD")
Sys.setenv(TZ="UTC")

######## DATA SOURCE #########################################
#
# Just pasted in demoData.R at this point
#
###############################################################

#rm(list = ls("portfolio.st", "strategy.st", "account.st"))

strategy.st <- "CRSIcumStrat"
portfolio.st <- "CRSIcumStrat"
account.st <- "CRSIcumStrat"

rm.strat(portfolio.st)
rm.strat(strategy.st)


.blotter <- new.env()
.strategy <- new.env()



initPortf(portfolio.st, symbols=symbols, initDate = initDate, currency = 'USD')

initAcct(account.st, portfolios = portfolio.st, initDate = initDate, currency = 'USD', initEq = initEq)

initOrders(portfolio.st, initDate = initDate)

strategy(strategy.st, store = TRUE)



#### PARAMETERS #########################

cumThresh <- 40
exitThresh <- 75
nCum <- 2
nRSI <- 3
nStreak <- 2
nPercentLookBack <- 100
nSMA <- 200
pctATR <- .02
period <- 10

#### INDICATORS #########

add.indicator(strategy.st, name = "cumCRSI", 
	arguments = list(price = quote(Cl(mktdata)), nCum = nCum, 
	nRSI = nRSI, nStreak = nStreak, 
	nPercentLookBack = nPercentLookBack),
	label = "CRSIcum")

add.indicator(strategy.st, name = "connorsRSI",   
	arguments = list(price= quote(Cl(mktdata)), nRSI = nRSI,
	nStreak = nStreak,
	nPercentLookBack = nPercentLookBack),
	label= "CRSI")

add.indicator(strategy.st, name = "SMA", 
	arguments = list(x = quote(HLC(mktdata)), n = nSMA),
	label = "sma")

add.indicator(strategy.st, name = "lagATR",
	arguments = list(HLC = quote(HLC(mktdata)), n = period),
	label = "atrX")


test <- applyIndicators(strategy.st, mktdata = OHLC(CBA.AX))

#head(round(test, 2 ), 253)
head(round(test, 2 ), 10)

########## SIGNALS ######################

add.signal(strategy.st, name = "sigThreshold",
	arguments = list(column = "cumCRSI.CRSIcum",
	threshold = cumThresh, relationship = "lt", cross = FALSE),
	label = "cumCRSI.lt.thresh")

add.signal(strategy.st, name = "sigComparison",
	arguments = list(columns = c("Close", "SMA.sma"),
	realtionship = "gr"), label = "Cl.gt.SMA")

add.signal(strategy.st, name = "sigAND",
	arguments = list(columns = c("cumCRSI.lt.thresh",
	"Cl.gt.SMA"), cross = TRUE), label = "longEntry")

add.signal(strategy.st, name = "sigThreshold",
	arguments = list(column = "connorsRSI.CRSI",
	threshold = exitThresh, relationship = "gt",
	cross = TRUE), label = "longExit")

########## RULES ################################

add.rule(strategy.st, name = "ruleSignal",
	arguments = list(sigcol = "longEntry", 
	sigval = TRUE, ordertype = "market",
	orderside = "long", TxnFees = txnFees, replace = FALSE,
	prefer = "Open", osFUN = osDollarATR,
	tradeSize = tradeSize, pctATR= pctATR,
	atrMod = "X"), type = "enter", path.dep = TRUE)

add.rule(strategy.st, name = "ruleSignal",
	arguments = list(sigcol = "longExit",
	sigval = TRUE,
	orderqty = "all", delay = 691200,
	ordertype = "market",
	orderside = "long", TxnFees = txnFees,
	replace = FALSE, 
	prefer = "Open"), type= "exit", path.dep = TRUE)



add.rule(strategy.st, name = "ruleSignal",
	arguments = list(sigcol = "longExit",
	sigval = TRUE,
	orderqty = "all",
	ordertype = "market",
	orderside = "long", TxnFees = txnFees,
	replace = FALSE,
	prefer = "Open"), type= "exit", path.dep = TRUE)




######### APPLY #########################################

	t1 <- Sys.time()
	out <- applyStrategy(strategy = strategy.st, 
		portfolio = portfolio.st)
	t2 <- Sys.time()
	print(t2 - t1)

-------------- next part --------------

######### ANALYTICS ######################################

updatePortf(portfolio.st)
dateRange <- time(getPortfolio(portfolio.st)$summary)[-1]
updateAcct(portfolio.st, dateRange)
updateEndEq(account.st)

tStats <- tradeStats(Portfolios = portfolio.st, use = "trades", inclZeroDays = FALSE)
tStats[ ,4:ncol(tStats)] <- round(tStats[ ,4:ncol(tStats)], 2)
print(data.frame(t(tStats[ ,-c(1,2)])))
	

######### EVALUATE #####################################

aggPF <- sum(tStats$Gross.Profits) / - sum(tStats$Gross.Losses)
aggCorrect <- mean(tStats$Percent.Positive)
numTrades <- sum(tStats$Num.Trades)
meanAvgWLR <- mean(tStats$Avg.WinLoss.Ratio[tStats$Avg.WinLoss.Ratio < Inf], na.rm = TRUE)

# win to lose ratio
aggPF

#proportion winning trades
aggCorrect

#number of trades
numTrades

meanAvgWLR


############ GENERAL PERFORMANCE ################################

dStats <- dailyStats(Portfolios = portfolio.st, use = "Equity")
rownames(dStats) <- gsub(".DailyEndEq", "", rownames(dStats))
print(data.frame(t(dStats)))

############ ANALYTICS RELATING TO DURATION ######################

durationStatistics <- function(Portfolio, Symbols, includeOpenTrade = FALSE, ...){

	tmp <- list()
	length(tmp) <- length(Symbols)
	for(Symbol in Symbols){
	
		pts <- perTradeStats(Portfolio = Portfolio, Symbol = Symbol, includeOpenTrade = includeOpenTrade)
		pts$diff <- pts$End - pts$Start
		
		durationSummary <- summary(as.numeric(pts$diff))
		winDurationSummary <- summary(as.numeric(pts$diff[pts$Net.Trading.PL > 0]))
		lossDurationSummary <- summary(as.numeric(pts$diff[pts$Net.Trading.PL <= 0]))
		names(durationSummary) <- c("Min", "Q1", "Med", "Mean", "Q3", "Max")
		names(winDurationSummary) <- c("Min", "Q1", "Med", "Mean", "Q3", "Max")
		names(lossDurationSummary) <- c("Min", "Q1", "Med", "Mean", "Q3", "Max")
		names(winDurationSummary) <- paste0("W", names(winDurationSummary))
		names(lossDurationSummary) <- paste0("L", names(lossDurationSummary))
		
		dataRow <- data.frame(cbind(t(round(durationSummary)),
			t(round(winDurationSummary)),
			t(round(lossDurationSummary))))
		tmp[[Symbol]] <- dataRow
		
	}
	
	out <- do.call(rbind, tmp)
	return(out)
	
}

durStats <- durationStatistics(Portfolio = portfolio.st, Symbols=sort(symbols))
print(t(durStats))

############ MARKET EXPOSURE ##################################

tmp <- list()
length(tmp) <- length(symbols)
for(i in 1:nrow(dStats)){
	totalDays <- nrow(get(rownames(dStats)[i]))
	mktExposure <- dStats$Total.Days[i] / totalDays
	tmp[[i]] <- c(rownames(dStats)[i], round(mktExposure, 3))
}
mktExposure <- data.frame <-(do.call(rbind, tmp))
colnames(mktExposure) <- c("Symbol", "MktExposure")

print(mktExposure)

print(mean(as.numeric(mktExposure[ , 2])))


######### CHART AND STATS ###############################



instRate <- PortfReturns(account.st)

portfRets <- xts(rowMeans(instRate) * ncol(instRate), order.by = index(instRate))
cumPortfRets <- cumprod(1 + portfRets)
firstNonZeroDay <- as.character(index(portfRets)[min(which(portfRets != 0))])

# obtain symbol
getSymbols("^AXJO", from = firstNonZeroDay, to = to)
#getSymbols("SPY", from = from, to = to)
AXJOrets <- diff(log(Cl(AXJO)))[-1]
cumAXJOrets <- cumprod(1 + AXJOrets)
comparison <- cbind(cumPortfRets, cumAXJOrets)
colnames(comparison) <- c("Connors RSI trend following strategy", "SPI")

chart.TimeSeries(comparison, legend.loc = "topleft")



##################### CALCULATE THE RISK METRICS ##########################

SharpeRatio.annualized(portfRets)

Return.annualized(portfRets)

maxDrawdown(portfRets)

# win to lose ratio
aggPF

#proportion winning trades
aggCorrect

#number of trades
numTrades

meanAvgWLR

################### EQUITY CURVE OF XLB ##################################

#chart.Posn(portfolio.st, "XLB")

From ilya.kipnis at gmail.com  Fri May 27 08:47:54 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 27 May 2016 02:47:54 -0400
Subject: [R-SIG-Finance] rule delays
In-Reply-To: <364ac72a-f789-5ceb-ad6f-1da1613d69c4@organicfoodmarkets.com.au>
References: <364ac72a-f789-5ceb-ad6f-1da1613d69c4@organicfoodmarkets.com.au>
Message-ID: <CA+oJuEHTnUC1j38tfj0rp-+iQ1OE85Bz=tX37-bkVBrViQmQzQ@mail.gmail.com>

Stephen,

This might be a bit of a hack, but what I'd recommend is this:

Create a custom signal function (see my sigAND function in my IKTrading
package) that simply takes a signal and lags it by eight days, then put
that lagged signal with your original signal in a one-cancels-other order
set.

It's been a while since I formally wrote such code, but you can find such
an example here:
https://quantstrattrader.wordpress.com/2014/08/18/a-hammer-trading-system-demonstrating-custom-indicator-based-limit-orders-in-quantstrat/

Also, look up the R/Finance 2013 presentation on quantstrat that Brian
Peterson himself did which demonstrates this functionality as well.

Hope this helps.

-Ilya

On Fri, May 27, 2016 at 2:43 AM, Stephen Choularton <
stephen at organicfoodmarkets.com.au> wrote:

> Hi
>
> I am trying to implement Harry's Connor's RSI from his book Quantative
> Trading ...
>
> I have it working as is and have varied it to some shares in the ASX.
>
> However, I want to pursue the idea of a fixed time (8 day) sell rule that
> takes place if the normal rule doesn't produce a sale before.
>
> I added this rule at line 127 of the file 3. strategy.R:
>
> add.rule(strategy.st, name = "ruleSignal",
>     arguments = list(sigcol = "longExit",
>     sigval = TRUE,
>     orderqty = "all", delay = 691200,
>     ordertype = "market",
>     orderside = "long", TxnFees = txnFees,
>     replace = FALSE,
>     prefer = "Open"), type= "exit", path.dep = TRUE)
>
> but it seems to have no effect.
>
> I attach all the code. You run it in the numbered order of the files.
>
> I wonder if anyone can help me make this sort of rule work.
>
> -----------------------------------------------------------------------------------------------------------------------------------
>
> Stephen Choularton PhD, FIoD
> 0413 545 182
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From fakir.charles.780 at student.lu.se  Fri May 27 21:57:24 2016
From: fakir.charles.780 at student.lu.se (FAKIR CHARLES)
Date: Fri, 27 May 2016 21:57:24 +0200
Subject: [R-SIG-Finance] ugarchfit: Error in temp$h : $ operator is invalid
	for atomic vectors
Message-ID: <CACtY5jEjdcpixtM_TEPkWKG3L-QUqhy7b8AAtqSMj1K0bPRKfQ@mail.gmail.com>

Hi Alexios,

I hope you can let me know how to solve this issue:
> #     Specify GARCH model
> spec1=ugarchspec(variance.model=list(model="sGARCH", garchOrder =c(0,1)),
+ mean.model=list(armaOrder=c(0,0)))
> fit1=ugarchfit(data=close.djdr,spec=spec1)
Warning message:
In .sgarchfit(spec = spec, data = data, out.sample = out.sample,  :
ugarchfit-->warning: solver failer to converge.

This one is particularly perplexing as I did not get this error prior to
updating my system as suggested on this forum during 2014.

> #     Specify GARCH model including external regressor:
> spec1X=ugarchspec(variance.model=list(model="sGARCH", garchOrder =c(0,1),
+ external.regressors = train.xreg),
+ mean.model=list(armaOrder=c(0,0)))
> fit1X=ugarchfit(data=close.djdr,spec=spec1X)
Error in temp$h : $ operator is invalid for atomic vectors
In addition: Warning message:
In .makefitmodel(garchmodel = "sGARCH", f = .sgarchLLH, T = T, m = m,  :
rugarch-->warning: failed to invert hessian

This was my original problem that I tried to resolve by following the
advise below.

According to this link:
http://stackoverflow.com/questions/23299684/r-error-in-xed-operator-is-invalid-for-atomic-vectors,
I should change to a dataframe, but this should not be the case because xts
object is allowed. Did not act on this information.

According to this post:
http://r.789695.n4.nabble.com/understanding-an-error-from-ugarchfit-td4684836.html#a4694082,
I should update my system which I did:
> sessionInfo()
R version 3.3.0 (2016-05-03)
Platform: x86_64-apple-darwin13.4.0 (64-bit)
Running under: OS X 10.11.4 (El Capitan)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods
base

other attached packages:
 [1] fxregime_1.0-3                vars_1.5-2
lmtest_0.9-34
 [4] urca_1.2-9                    strucchange_1.5-1
sandwich_2.3-4
 [7] MASS_7.3-45                   tseries_0.10-35
forecast_7.1
[10] timeDate_3012.100             xlsx_0.5.7
xlsxjars_0.6.1
[13] rJava_0.9-8                   rmgarch_1.3-0
rugarch_1.3-6
[16] FinTS_0.4-5                   car_2.1-2
quantmod_0.4-5
[19] TTR_0.23-1                    PerformanceAnalytics_1.4.3541
xts_0.9-7
[22] zoo_1.7-13                    devtools_1.11.1

loaded via a namespace (and not attached):
 [1] rgl_0.95.1441               Rcpp_0.12.5
mvtnorm_1.0-5
 [4] lattice_0.20-33             digest_0.6.9
truncnorm_1.0-7
 [7] R6_2.1.2                    plyr_1.8.3
MatrixModels_0.4-1
[10] Bessel_0.5-5                pcaPP_1.9-60
httr_1.1.0
[13] ggplot2_2.1.0               curl_0.9.7
misc3d_0.8-4
[16] minqa_1.2.4                 SparseM_1.7
fracdiff_1.4-2
[19] nloptr_1.0.4                SkewHyperbolic_0.3-2
Matrix_1.2-6
[22] splines_3.3.0               lme4_1.1-12
bit_1.1-12
[25] munsell_0.4.3               numDeriv_2014.2-1
DistributionUtils_0.5-1
[28] mgcv_1.8-12                 nnet_7.3-12
Rsolnp_1.16
[31] multicool_0.1-9             expm_0.999-0
ff_2.2-13
[34] quadprog_1.5-5              codetools_0.2-14
withr_1.0.1
[37] GeneralizedHyperbolic_0.8-1 grid_3.3.0
nlme_3.1-127
[40] gtable_0.2.0                git2r_0.15.0
scales_0.4.0
[43] KernSmooth_2.23-15          spd_2.0-1
tools_3.3.0
[46] ks_1.10.3                   pbkrtest_0.4-6
colorspace_1.2-6
[49] memoise_1.0.0               quantreg_5.24

Regards
Kirro

	[[alternative HTML version deleted]]


From johnsk00 at gmail.com  Fri May 27 22:48:49 2016
From: johnsk00 at gmail.com (John Klingensmith)
Date: Fri, 27 May 2016 16:48:49 -0400
Subject: [R-SIG-Finance] Position Limits
Message-ID: <CAFLRcn0_LiHG0v0WcZTu3YcWOz-HvQ7S0UXQBDnpCHfcqDes-Q@mail.gmail.com>

Hi,
 I am relatively new to R and QuantStrat, etc. I am playing with a real
simple strategy that goes long when the market closes at its lowest close
in 3 days and reverses the position when the market closes at its highest
close in 3 day.  I am trying to limit the position size to 1 lot in either
direction by using osMaxPos and addPosLimit, but for whatever reason the
position limits are not getting imposed. I also read the "Long Enter
Position do not "block" Short Enter Orders" question and tried making a
custom function.

My questions are as follows:

1) I currently have a long entry order and a short entry order - do I need
to have dedicated exit orders? I am just looking to flip the position from
long to short, and the strategy is in the market 100% of the time.

2) Why would it keep trading if I am using osMaxPos and addPosLimt, as
follows:

#Position Limits
addPosLimit(portfolio.st, "GSPC", timestamp = initDate, maxpos = 1,
longlevels = 1, minpos = -1, shortlevels = 1)


#rules
add.rule(strategy.st, name = "ruleSignal",
         arguments = list(sigcol = "longSig",
                          sigval=TRUE,
                          ordertype = "market",
                          orderside = "long",
                          prefer="PST", # PST is just an adjusted price
column i created
                          replace = FALSE,
                          orderqty = 1,
                          osFun =  "osMaxPos"
                          ),
         type = "enter")


add.rule(strategy.st, name = "ruleSignal",
         arguments = list(sigcol = "shortSig",
                          sigval=TRUE,
                          ordertype = "market",
                          orderside = "short",
                          prefer="PST", # PST is just an adjusted price
column i created
                          replace = FALSE,
                          orderqty = -1,
                          osFun = "osMaxPos"
                          ),
        type = "enter")

3) Can I just create a custom function and pass it to add.rule as follows:


#Custom Function
osMaxPosMR = function(data, timestamp, orderqty, ordertype, ordersize,
portfolio, symbol, ruletype, ...){
  maxpos = osMaxPos(data, timestamp, orderqty, ordersize, portfolio,
symbol, ruletype, ...)
  curpos = getPosQty(portfolio, symbol, timestamp)

  if(orderside == 'long' && curpos > 0)
    maxpos = 0

  if(orderside == 'short' && curpos < 0)
    maxpos = 0

  return(maxpos)
  print(curpos)
}

add.rule(strategy.st, name = "ruleSignal",
         arguments = list(sigcol = "longSig",
                          sigval=TRUE,
                          ordertype = "market",
                          orderside = "long",
                          prefer="PST",
                          replace = FALSE,
                          orderqty = 1,
                          osFun = "osMaxPosMR"
                          ),
         type = "enter")


add.rule(strategy.st, name = "ruleSignal",
         arguments = list(sigcol = "shortSig",
                          sigval=TRUE,
                          ordertype = "market",
                          orderside = "short",
                          prefer="PST",
                          replace = FALSE,
                          orderqty = -1,
                          osFun = "osMaxPosMR"
                          ),
        type = "enter")

4) I am using S&P index data; although you cannot actually trade the index,
it is a good proxy for what I am trying to test. When I download the index
data (symbol ^GSPC) the symbol stored is "GSPC" without the carrot;
therefore, I cannot simply use "symbols <- "^GSPC" and reference "symbols"
in my code as I would normally if it were an ETF. Can someone explain why
this is?

Thanks for any help.
Best,
 John

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Fri May 27 22:52:48 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Fri, 27 May 2016 16:52:48 -0400
Subject: [R-SIG-Finance] Position Limits
In-Reply-To: <CAFLRcn0_LiHG0v0WcZTu3YcWOz-HvQ7S0UXQBDnpCHfcqDes-Q@mail.gmail.com>
References: <CAFLRcn0_LiHG0v0WcZTu3YcWOz-HvQ7S0UXQBDnpCHfcqDes-Q@mail.gmail.com>
Message-ID: <CA+oJuEF+A7CmpLN=tMi7hrgXmMLmMGHXDFh682+KhGr42VwxZw@mail.gmail.com>

John,

It's generally a good idea to have an exit order, even if you're just
flipping the position. Quantstrat may take care of it for you, but it's
still good practice to have explicit exits IMO.

Regarding passing in a custom order sizing function, yes, you certainly
can. For instance, I have a position sizing function called osDollarATR in
my IKTrading package. See this post for some depth on it:
https://quantstrattrader.wordpress.com/2014/06/11/trend-vigor-part-iii-atr-position-sizing-annualized-sharpe-above-1-4-and-why-leverage-is-pointless/

-Ilya

On Fri, May 27, 2016 at 4:48 PM, John Klingensmith <johnsk00 at gmail.com>
wrote:

> Hi,
>  I am relatively new to R and QuantStrat, etc. I am playing with a real
> simple strategy that goes long when the market closes at its lowest close
> in 3 days and reverses the position when the market closes at its highest
> close in 3 day.  I am trying to limit the position size to 1 lot in either
> direction by using osMaxPos and addPosLimit, but for whatever reason the
> position limits are not getting imposed. I also read the "Long Enter
> Position do not "block" Short Enter Orders" question and tried making a
> custom function.
>
> My questions are as follows:
>
> 1) I currently have a long entry order and a short entry order - do I need
> to have dedicated exit orders? I am just looking to flip the position from
> long to short, and the strategy is in the market 100% of the time.
>
> 2) Why would it keep trading if I am using osMaxPos and addPosLimt, as
> follows:
>
> #Position Limits
> addPosLimit(portfolio.st, "GSPC", timestamp = initDate, maxpos = 1,
> longlevels = 1, minpos = -1, shortlevels = 1)
>
>
> #rules
> add.rule(strategy.st, name = "ruleSignal",
>          arguments = list(sigcol = "longSig",
>                           sigval=TRUE,
>                           ordertype = "market",
>                           orderside = "long",
>                           prefer="PST", # PST is just an adjusted price
> column i created
>                           replace = FALSE,
>                           orderqty = 1,
>                           osFun =  "osMaxPos"
>                           ),
>          type = "enter")
>
>
> add.rule(strategy.st, name = "ruleSignal",
>          arguments = list(sigcol = "shortSig",
>                           sigval=TRUE,
>                           ordertype = "market",
>                           orderside = "short",
>                           prefer="PST", # PST is just an adjusted price
> column i created
>                           replace = FALSE,
>                           orderqty = -1,
>                           osFun = "osMaxPos"
>                           ),
>         type = "enter")
>
> 3) Can I just create a custom function and pass it to add.rule as follows:
>
>
> #Custom Function
> osMaxPosMR = function(data, timestamp, orderqty, ordertype, ordersize,
> portfolio, symbol, ruletype, ...){
>   maxpos = osMaxPos(data, timestamp, orderqty, ordersize, portfolio,
> symbol, ruletype, ...)
>   curpos = getPosQty(portfolio, symbol, timestamp)
>
>   if(orderside == 'long' && curpos > 0)
>     maxpos = 0
>
>   if(orderside == 'short' && curpos < 0)
>     maxpos = 0
>
>   return(maxpos)
>   print(curpos)
> }
>
> add.rule(strategy.st, name = "ruleSignal",
>          arguments = list(sigcol = "longSig",
>                           sigval=TRUE,
>                           ordertype = "market",
>                           orderside = "long",
>                           prefer="PST",
>                           replace = FALSE,
>                           orderqty = 1,
>                           osFun = "osMaxPosMR"
>                           ),
>          type = "enter")
>
>
> add.rule(strategy.st, name = "ruleSignal",
>          arguments = list(sigcol = "shortSig",
>                           sigval=TRUE,
>                           ordertype = "market",
>                           orderside = "short",
>                           prefer="PST",
>                           replace = FALSE,
>                           orderqty = -1,
>                           osFun = "osMaxPosMR"
>                           ),
>         type = "enter")
>
> 4) I am using S&P index data; although you cannot actually trade the index,
> it is a good proxy for what I am trying to test. When I download the index
> data (symbol ^GSPC) the symbol stored is "GSPC" without the carrot;
> therefore, I cannot simply use "symbols <- "^GSPC" and reference "symbols"
> in my code as I would normally if it were an ETF. Can someone explain why
> this is?
>
> Thanks for any help.
> Best,
>  John
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From stephen at organicfoodmarkets.com.au  Sat May 28 09:05:04 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Sat, 28 May 2016 17:05:04 +1000
Subject: [R-SIG-Finance] rule delays
In-Reply-To: <364ac72a-f789-5ceb-ad6f-1da1613d69c4@organicfoodmarkets.com.au>
References: <364ac72a-f789-5ceb-ad6f-1da1613d69c4@organicfoodmarkets.com.au>
Message-ID: <295a63a1-9e25-eb02-9c6c-3965137fa1b9@organicfoodmarkets.com.au>

Hi

I thought I had found a solution to this by adding the signal:

add.signal(strategy.st, name="sigFormula",
     arguments = list(columns = c("longEntry"),
     formula = "lag(longEntry, 8) == 1", cross=FALSE), label="fixedExit")


and a new rule:

add.rule(strategy.st, name = "ruleSignal",
     arguments = list(sigcol = "fixedExit",
     sigval = TRUE,
     orderqty = "all",
     ordertype = "market",
     orderside = "long", TxnFees = txnFees,
     replace = FALSE,
     prefer = "Open"), type= "exit", path.dep = TRUE)

I placed the rule before the old exit one assuming it would then take 
precedent and because the rule was a sell all one it would do no harm 
for the other rule to trigger as all = 0 at that stage.

It made a difference but I was not sure if it was working properly (ie 
sell either when the normal sale is triggered or on 8 days whichever is 
the earlier).  So I temporarily removed the old longExit signal and 
associated rule.  That should have mean that I only got sales on the 8th 
trading day after a purchase but this showed up in the order book:

            Order.Qty Order.Price        Order.Type Order.Side 
Order.Threshold Order.Status Order.StatusTime      Prefer Order.Set 
Txn.Fees Rule              Time.In.Force
2003-08-07 "3261"    "2.92237690558407" "market"   "long" 
NA              "closed"     "2003-08-08 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2003-08-19 "all"     "2.95346608774812" "market"   "long" 
NA              "closed"     "2003-08-20 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2003-11-11 "3073"    "3.92345478910284" "market"   "long" 
NA              "closed"     "2003-11-12 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2003-11-21 "all"     "3.66852349535765" "market"   "long" 
NA              "closed"     "2003-11-24 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2003-12-10 "2638"    "3.46333489307494" "market"   "long" 
NA              "closed"     "2003-12-11 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2003-12-22 "all"     "3.01565066991264" "market"   "long" 
NA              "closed"     "2003-12-23 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2004-01-13 "3591"    "3.07782903424074" "market"   "long" 
NA              "closed"     "2004-01-14 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2004-01-23 "all"     "2.9223831234205"  "market"   "long" 
NA              "closed"     "2004-01-26 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2004-01-28 "3603"    "2.76693721260026" "market"   "long" 
NA              "closed"     "2004-01-29 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
2004-01-30 "all"     "2.81046206762993" "market"   "long" 
NA              "closed"     "2004-02-02 00:00:00" "Open" NA        
"-8"     "ruleSignal.rule" ""
Please note the last line shows a purchase and sale only two calendar 
days apart.  They were weekdays.  That is not in accordance with the 
indicator or rule I wrote.   In fact mktdata shows:

2004-01-28                 1         0         1         0
2004-01-29                 0         0         0         0
2004-01-30                 0         0         0         0
2004-02-02                 0         0         0         0
2004-02-03                 0         0         0         0
2004-02-04                 0         0         0         0
2004-02-05                 0         0         0         0
2004-02-06                 0         0         0         0
2004-02-09                 0         0         0         1

with the signals on the correct days.

Just a sanity check.  Can anyone tell me where I am going wrong, 
presumably in writing that rule.

----------------------------------------------------------------------------------------------------------------------------------- 

Stephen Choularton PhD, FIoD

On 27/05/2016 4:43 PM, Stephen Choularton wrote:
> Hi
>
> I am trying to implement Harry's Connor's RSI from his book Quantative 
> Trading ...
>
> I have it working as is and have varied it to some shares in the ASX.
>
> However, I want to pursue the idea of a fixed time (8 day) sell rule 
> that takes place if the normal rule doesn't produce a sale before.
>
> I added this rule at line 127 of the file 3. strategy.R:
>
> add.rule(strategy.st, name = "ruleSignal",
>     arguments = list(sigcol = "longExit",
>     sigval = TRUE,
>     orderqty = "all", delay = 691200,
>     ordertype = "market",
>     orderside = "long", TxnFees = txnFees,
>     replace = FALSE,
>     prefer = "Open"), type= "exit", path.dep = TRUE)
>
> but it seems to have no effect.
>
> I attach all the code. You run it in the numbered order of the files.
>
> I wonder if anyone can help me make this sort of rule work.
>
> ----------------------------------------------------------------------------------------------------------------------------------- 
>
> Stephen Choularton PhD, FIoD
> 0413 545 182


From atakanokan at outlook.com  Sat May 28 15:14:08 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Sat, 28 May 2016 16:14:08 +0300
Subject: [R-SIG-Finance] Passing two distributions to one parameter
Message-ID: <BAY172-W36D2E310C57B1056BA2A3BC7430@phx.gbl>

Hi r-sig-finance,
I was trying to implement a strategy where parabolic SAR (from TTR package) is used. However one of the parameters of SAR "accel" takes two values, one for "accelaration factor" and one for "maximum acceleration factor". I was unable to pass two sequences as one parameter and I was wondering if it is possible to do that to be able to optimize those parameters. 
Reproducible code: (The commented out add.distributions did not work.)

library(PerformanceAnalytics)library(quantstrat)                               no.cores <- 4                                     
.strategy <- new.env().blotter  <- new.env()                              
symbol.name = "AAPL"                                        tick.size = 0.01 currency("USD")stock(symbol.name, currency="USD", multiplier=1,tick_size= tick.size)
initialEquity = 1000                                           port.acct.currency <- "USD"strategy.keyword = "PSAR_D1"                                
longStopLossDistance <- 0;longTrailingStopDistance <- 0;longTakeProfitDistance <- 0shortStopLossDistance <- 0;shortTrailingStopDistance <- 0;shortTakeProfitDistance <- 0
symbol.data <- getSymbols(symbol.name)
strategy.st <- paste(symbol.name,strategy.keyword,sep = "_")rm.strat(strategy.st)                                                      
initDate = as.character(as.Date(index(symbol.data[1])-1))                    initPortf(strategy.st, symbol.name, initDate=initDate, currency = port.acct.currency)initAcct(strategy.st, portfolios=strategy.st, initDate=initDate,          initEq=initialEquity, currency = port.acct.currency)initOrders(portfolio=strategy.st,initDate=initDate)                          strategy(strategy.st,store=TRUE)summary(getStrategy(strategy.st))                                            
txn.model <- 0   
fixedSizeLong  =  100     fixedSizeShort =  -100     
paramset.label.name <- "PSAR_OPT"accel.factor <- seq(from=0.01, by=0.01, length.out = 3)max.accel.factor <- seq(from=0.1, by=0.05, length.out = 4)accels.df <- expand.grid(accel.factor,max.accel.factor)   

add.indicator(strategy.st,                                                                   name = "SAR",                                                                 arguments = list(HL=HLC(eval(parse(text = symbol.name)))                               ,accel=c(accel.factor,max.accel.factor)              ),                       label='sar')                                              

#apply.indicators.df <- applyIndicators(strategy.st, mktdata=eval(parse(text = symbol.name)))    

add.signal(strategy.st,name="sigCrossover",           arguments = list(columns=c("sar","Close"),relationship="gt"),           label="sar.gt.close") 
add.signal(strategy.st,name="sigCrossover",           arguments = list(columns=c("sar","Close"),relationship="lt"),           label="sar.lt.close")
#apply.signals.df <- applySignals(strategy.st, mktdata=apply.indicators.df)                     
add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.gt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty= fixedSizeLong,                           ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='enter',         label='longenter',         enabled=TRUE)
# Long Exit Rule-------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.lt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='exit',         label='longexit',         enabled=TRUE)


# Short Entry Rule--------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.lt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty= fixedSizeShort,                           ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='enter',         label='shortenter',         enabled=TRUE)
# Short Exit Rule---------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.gt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='exit',         label='shortexit',         enabled=TRUE)



#SAR Optimization-------------------------------------------------------------#add.distribution(strategy.st, #                paramset.label = paramset.label.name,  #               component.type = 'indicator',   #              component.label = 'sar',                          #             variable = list( accel = accels.df),             #            label = "sar.accels")


#add.distribution(strategy.st,#                 paramset.label = paramset.label.name,#                 component.type = 'indicator',#                 component.label = 'sar',                      #                 variable = list( accel[1] = accel.factor),        #                 label = "sar.accels.factor")

#add.distribution(strategy.st,#                 paramset.label = paramset.label.name,#                 component.type = 'indicator',#                 component.label = 'sar',                      #                 variable = list( accel[2] = max.accel.factor),        #                 label = "sar.accels.max")

#add.distribution(strategy.st,#                 paramset.label = paramset.label.name,#                 component.type = 'indicator',#                 component.label = 'sar',                      #                 variable = list( accel = accel.factor,max.accel.factor),        #                 label = "sar.accels.2")



summary(getStrategy(strategy.st))                                              
paramsetenv<-new.env()results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,                          audit=paramsetenv)
results.df <- data.frame(results$tradeStats)

------------------------------------------------------------------------------------------------------------------------------------------------
Atakan Okan 		 	   		  
	[[alternative HTML version deleted]]


From francesco.bianchi04 at icatt.it  Sat May 28 16:41:18 2016
From: francesco.bianchi04 at icatt.it (Francesco Bianchi)
Date: Sat, 28 May 2016 14:41:18 +0000
Subject: [R-SIG-Finance] CEV Model & MC simulation
Message-ID: <3C655B64-EF82-48EA-8C75-B116B8FC753A@icatt.it>

Hi Everyone,

here below the assignment I should solve:


We assume that the underlying process ST follows a CEV model.

  *   Evaluate the Expected Value of the following payoff using the MC method. Write an efficient code. (Hint: system.time() r function could be useful).

max{ST - K, 0} 1 a_1 ? ST_1 ? b_1, 1 a_1 ? ST_2 ? b_1, 1 a_1 ? ST_3 ? b_1

where a_1 < b_1 and 1 is an indicator function, T1 =0.25*T, T2 =0.5*T, T3 =0.75*T

(Hint: The final time T in your code must be an input fixed by the user. If the user chooses T = 10 than T1 =10*0.25 = 2.5 and so on)

  *   Compute the upper and lower bound of the MC price
  *   For each model parameter write a code for evaluating the corresponding sensitivity measure

Below the code used. It sounds too advanced for the course I am enrolled in (it was produced based on advanced reading).
Any way to make it more row and student friendly?

At the end I introduced the sensitivity analysis, what about developing it through a graph analysis instead?

Thanks,

Francesco
_______

#Clean the global environment
rm(list=ls())

#set seed: important to fix when sensitivity analyses are performed
set.seed(123)

cev = function (N,T,x0,gamma,sigma,mu,alpha1,beta1,K,risk_free) {

  #Initialization of variables
  delta.xt=matrix(NA,T,1)     #Vector of dx_t
  xt=matrix(NA,T+1,1)         #Vector of x_t
  xt.condition=matrix(NA,4,N) #Matrix of x_T1, x_T2, x_T3 & x_T (for each scenario - in columns), input of the payoff function
  x.indicator=matrix(NA,3,N)  #Matrix of indicator function (rows of the same column stand for the different conditions in the same scenario)
  payoff=matrix(NA,1,N)       #Vector of payoff, results of the MC simulation

  #Setting initial value of the process, the same for each simulation
  xt[1,1]=x0

  #Definition of T_j condition
  #Ceiling is the rounding function the nearest higher integer
  T1=ceiling(0.25*T)
  T2=ceiling(0.50*T)
  T3=ceiling(0.75*T)

  #Stop the process if alpha1 is higher than beta1
  if (alpha1>beta1) {

    print("Error message: Alpha1 is higher than Beta1 -> not feasible condition -> the MC is stopped without results")

  } else {

    #####Generate the CEV stochastic process
    #Cycle on number of scenario
    for (j in 1:N) {

      #Cycle on time
      for (i in 1:T) {

        #Calculate dx_t and x_t
        #Remember that x_t is 1 unit longer than dx_t as x_t also includes x0 in first position
        #dt is fixed equal to 1
        #J is not used in the following equations, as saving all the dx_t and x_t in each scenario is cumbersome
        delta.xt[i,1]=mu*xt[i,1]*1+sigma*(xt[i,1]^gamma)*rnorm(1,0,1)
        xt[i+1,1]=xt[i,1]+delta.xt[i,1]

      }

      #Save the values of the process in the 4 time units
      xt.condition[1,j]=xt[T1+1,1]
      xt.condition[2,j]=xt[T2+1,1]
      xt.condition[3,j]=xt[T3+1,1]
      xt.condition[4,j]=xt[T+1,1]

      #Print the current number of simulation to monitor the status of MC simulation
      print(paste("Simulation no.",j,"of",N,"completed",sep=" "))

    }

    #Perform the indicator function condition (TRUE=1, FALSE=0)
    x.indicator[1,]=((xt.condition[1,]>=alpha1) || (xt.condition[1,]<=beta1))
    x.indicator[2,]=((xt.condition[2,]>=alpha1) || (xt.condition[2,]<=beta1))
    x.indicator[3,]=((xt.condition[3,]>=alpha1) || (xt.condition[3,]<=beta1))

    #Cycle on number of simulations in order to perform the distribution of payoff
    for (j in 1:N) {

      payoff[1,j]=max(0,xt.condition[4,j]-K)*x.indicator[1,j]*x.indicator[2,j]*x.indicator[3,j]

    }

    #Calculate expected value of the option and its bounds at 95% confidence interval
    expected.value.MC=mean(exp(-risk_free*T/250)*payoff[1,])
    lower.MC = expected.value.MC-1.96*sqrt(var(exp(-risk_free*T/250)*payoff[1,]))/sqrt(N)
    upper.MC = expected.value.MC+1.96*sqrt(var(exp(-risk_free*T/250)*payoff[1,]))/sqrt(N)

  }

  results=list(Expected.Value=expected.value.MC,
               Lower.Bound=lower.MC,
               Upper.Bound=upper.MC)

  return(results)

}

######MonteCarlo speed of convergence

#Reference Simulation

benchmark=cev(N=10000,T=200,x0=2,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)
benchmark$Expected.Value
benchmark$Lower.Bound
benchmark$Upper.Bound
#In questi tre risultati che stamper? a schermo sono il prezzo di riferimento, il lower bound del MC e l'upper bound del MC.
#L'intervallo di confidenza scelto per il MC ? al 95%

#molto lungo il prossimo codice, si pu? togliere.
m <- c(10, 50, 100, 150, 250, 350, 500)
p1 <- NULL
err <- NULL
nM <- length(m)
repl <- 100
mat <- matrix(, repl, nM)
for (k in 1:nM) {
  tmp <- numeric(repl)
  for (i in 1:repl) tmp[i] <- cev(N = m[k],T=200,x0=2,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.5,K=2,risk_free=0.01)$Expected.Value
  mat[, k] <- tmp
  p1 <- c(p1, mean(tmp))
  err <- c(err, sd(tmp))
}
colnames(mat) <- m

minP <- min(p1 - err)
maxP <- max(p1 + err)

plot(m, p1, type = "n", ylim = c(minP, maxP), axes = F, ylab = "MC price", xlab ="MC replications")
lines(m, p1 + err, col = "blue")
lines(m, p1 - err, col = "blue")
axis(2, benchmark$Expected.Value, "Reference price")
axis(1, m)
boxplot(mat, add = TRUE, at = m, boxwex = 15, col = "orange", axes = F)
points(m, p1, col = "blue", lwd = 3, lty = 3)
abline(h = benchmark$Expected.Value, lty = 2, col = "red", lwd = 3)


#Sensitivity Analysis
#questo ? un po' lungo ma si puo' togliere

#Greeks with finite difference method

#Delta on X0
delta_price=0.02
looping=100
price_up = matrix(, looping, 1)
price_down = matrix(, looping, 1)

price_stable= matrix(,looping, 1)

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_stable[k,1]=result
}

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2+delta_price,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_up[k,1]=result
}

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2-delta_price,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_down[k,1]=result
}

#Central derivatives
delta_greek_x0=(mean(price_up[,1])-mean(price_down[,1]))/(2*delta_price)

#Vega
delta_vol=0.001
looping=100
price_up = matrix(, looping, 1)
price_down = matrix(, looping, 1)

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2,gamma=1.1,sigma=0.01+delta_vol,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_up[k,1]=result
}

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2,gamma=1.1,sigma=0.01-delta_vol,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_down[k,1]=result
}

vega_greek=(mean(price_up[,1])-mean(price_down[,1]))/(2*delta_vol)

#Gamma_X0 (derivata seconda del sottostante)
delta_price=0.02
looping=100
price_stable= matrix(, looping, 1)
price_up = matrix(, looping, 1)
price_down = matrix(, looping, 1)

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_stable[k,1]=result
}

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2+delta_price,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_up[k,1]=result
}

for (k in 1:looping) {
  result=cev(N=100,T=200,x0=2-delta_price,gamma=1.1,sigma=0.01,mu=0.00001,alpha1=1.4,beta1=2.6,K=2,risk_free=0.01)$Expected.Value
  price_down[k,1]=result
}

gamma_greek_x0=(mean(price_up[,1])+mean(price_down[,1])-2*mean(price_stable[,1]))/(delta_price^2)


Francesco Bianchi
Matricola 4506994
francesco.bianchi04 at icatt.it<mailto:francesco.bianchi04 at icatt.it>




----------------------------------------DISCLAIMER----------------------------------------

Il presente indirizzo di posta elettronica ? attribuito automaticamente agli studenti e laureati dell?Universit? Cattolica del Sacro Cuore. L?utilizzo da parte dell?utente ? personale e l?Universit? Cattolica del Sacro Cuore non ? responsabile del contenuto delle comunicazioni.

This email address was assigned automatically as part of the registration process for students and graduates of Universit? Cattolica del Sacro Cuore. The use of the address is personal and Universit? Cattolica del Sacro Cuore accepts no liability for the content of any emails.

	[[alternative HTML version deleted]]


From stephen at organicfoodmarkets.com.au  Sun May 29 11:56:24 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Sun, 29 May 2016 19:56:24 +1000
Subject: [R-SIG-Finance] rule delays
In-Reply-To: <295a63a1-9e25-eb02-9c6c-3965137fa1b9@organicfoodmarkets.com.au>
References: <364ac72a-f789-5ceb-ad6f-1da1613d69c4@organicfoodmarkets.com.au>
	<295a63a1-9e25-eb02-9c6c-3965137fa1b9@organicfoodmarkets.com.au>
Message-ID: <bab2148e-d25e-dbfa-262f-2bb796ccab71@organicfoodmarkets.com.au>

Hi

The more I look the more I see problems.  This is from the orderbook.

date 	size 	days 	value 	price

	
	
	
	
2003-08-07 	3261 	
	9529.8710891097 	2.9223769056
2003-08-19 	all 	9 	9631.2529121466 	2.9534660877
2003-11-11 	3073 	61 	12056.776566913 	3.9234547891
2003-11-21 	all 	9 	11273.3727012341 	3.6685234954
2003-12-10 	2638 	14 	9136.2774479317 	3.4633348931
2003-12-22 	all 	9 	7955.2864672296 	3.0156506699
2004-01-13 	3591 	17 	11052.4840619585 	3.0778290342
2004-01-23 	all 	9 	10494.277796203 	2.9223831234
2004-01-28 	3603 	4 	9969.2747769987 	2.7669372126
2004-01-30 	all 	3 	10126.0948296706 	2.8104620676
2004-02-03 	3184 	3 	8710.9401289089 	2.7358480304
2004-02-09 	all 	5 	8809.9280849192 	2.7669372126
2004-08-19 	2298 	139 	8716.0387547838 	3.792880224
2004-08-31 	all 	9 	8873.2132241324 	3.8612764248
2004-09-17 	3469 	14 	13524.1859650561 	3.8985834434
2004-09-29 	all 	9 	13265.3498700311 	3.8239694062
2005-01-06 	3969 	72 	17546.4794820949 	4.4208817037
2005-01-18 	all 	9 	18484.2660085641 	4.6571594882
2005-02-21 	1830 	25 	8442.9513786548 	4.6136346331
2005-03-03 	all 	9 	8306.4076905903 	4.539020596

I have highlighted two trades which are not according to that 8 day 
rule. If the highlighting gets lost they are the closing sales on the 30 
Jan and 9 Feb.  I can't figure out why.

However, I also notice that the value of the investments made varies 
widely when I would have expected them to be fairly consistent.

Can anyone throw any light on these problems.

Thanks.


------------------------------------------
Stephen Choularton PhD, FIoD

On 28/05/2016 5:05 PM, Stephen Choularton wrote:
> Hi
>
> I thought I had found a solution to this by adding the signal:
>
> add.signal(strategy.st, name="sigFormula",
>     arguments = list(columns = c("longEntry"),
>     formula = "lag(longEntry, 8) == 1", cross=FALSE), label="fixedExit")
>
>
> and a new rule:
>
> add.rule(strategy.st, name = "ruleSignal",
>     arguments = list(sigcol = "fixedExit",
>     sigval = TRUE,
>     orderqty = "all",
>     ordertype = "market",
>     orderside = "long", TxnFees = txnFees,
>     replace = FALSE,
>     prefer = "Open"), type= "exit", path.dep = TRUE)
>
> I placed the rule before the old exit one assuming it would then take 
> precedent and because the rule was a sell all one it would do no harm 
> for the other rule to trigger as all = 0 at that stage.
>
> It made a difference but I was not sure if it was working properly (ie 
> sell either when the normal sale is triggered or on 8 days whichever 
> is the earlier).  So I temporarily removed the old longExit signal and 
> associated rule.  That should have mean that I only got sales on the 
> 8th trading day after a purchase but this showed up in the order book:
>
>            Order.Qty Order.Price        Order.Type Order.Side 
> Order.Threshold Order.Status Order.StatusTime      Prefer Order.Set 
> Txn.Fees Rule              Time.In.Force
> 2003-08-07 "3261"    "2.92237690558407" "market"   "long" 
> NA              "closed"     "2003-08-08 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2003-08-19 "all"     "2.95346608774812" "market"   "long" 
> NA              "closed"     "2003-08-20 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2003-11-11 "3073"    "3.92345478910284" "market"   "long" 
> NA              "closed"     "2003-11-12 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2003-11-21 "all"     "3.66852349535765" "market"   "long" 
> NA              "closed"     "2003-11-24 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2003-12-10 "2638"    "3.46333489307494" "market"   "long" 
> NA              "closed"     "2003-12-11 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2003-12-22 "all"     "3.01565066991264" "market"   "long" 
> NA              "closed"     "2003-12-23 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2004-01-13 "3591"    "3.07782903424074" "market"   "long" 
> NA              "closed"     "2004-01-14 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2004-01-23 "all"     "2.9223831234205"  "market"   "long" 
> NA              "closed"     "2004-01-26 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2004-01-28 "3603"    "2.76693721260026" "market"   "long" 
> NA              "closed"     "2004-01-29 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> 2004-01-30 "all"     "2.81046206762993" "market"   "long" 
> NA              "closed"     "2004-02-02 00:00:00" "Open" NA        
> "-8"     "ruleSignal.rule" ""
> Please note the last line shows a purchase and sale only two calendar 
> days apart.  They were weekdays.  That is not in accordance with the 
> indicator or rule I wrote.   In fact mktdata shows:
>
> 2004-01-28                 1         0         1         0
> 2004-01-29                 0         0         0         0
> 2004-01-30                 0         0         0         0
> 2004-02-02                 0         0         0         0
> 2004-02-03                 0         0         0         0
> 2004-02-04                 0         0         0         0
> 2004-02-05                 0         0         0         0
> 2004-02-06                 0         0         0         0
> 2004-02-09                 0         0         0         1
>
> with the signals on the correct days.
>
> Just a sanity check.  Can anyone tell me where I am going wrong, 
> presumably in writing that rule.
>
> ----------------------------------------------------------------------------------------------------------------------------------- 
>
> Stephen Choularton PhD, FIoD
>
> On 27/05/2016 4:43 PM, Stephen Choularton wrote:
>> Hi
>>
>> I am trying to implement Harry's Connor's RSI from his book 
>> Quantative Trading ...
>>
>> I have it working as is and have varied it to some shares in the ASX.
>>
>> However, I want to pursue the idea of a fixed time (8 day) sell rule 
>> that takes place if the normal rule doesn't produce a sale before.
>>
>> I added this rule at line 127 of the file 3. strategy.R:
>>
>> add.rule(strategy.st, name = "ruleSignal",
>>     arguments = list(sigcol = "longExit",
>>     sigval = TRUE,
>>     orderqty = "all", delay = 691200,
>>     ordertype = "market",
>>     orderside = "long", TxnFees = txnFees,
>>     replace = FALSE,
>>     prefer = "Open"), type= "exit", path.dep = TRUE)
>>
>> but it seems to have no effect.
>>
>> I attach all the code. You run it in the numbered order of the files.
>>
>> I wonder if anyone can help me make this sort of rule work.
>>
>> ----------------------------------------------------------------------------------------------------------------------------------- 
>>
>> Stephen Choularton PhD, FIoD
>> 0413 545 182
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R 
> questions should go.
>


From brian at braverock.com  Sun May 29 12:17:05 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 29 May 2016 05:17:05 -0500
Subject: [R-SIG-Finance] rule delays
In-Reply-To: <bab2148e-d25e-dbfa-262f-2bb796ccab71@organicfoodmarkets.com.au>
References: <364ac72a-f789-5ceb-ad6f-1da1613d69c4@organicfoodmarkets.com.au>
	<295a63a1-9e25-eb02-9c6c-3965137fa1b9@organicfoodmarkets.com.au>
	<bab2148e-d25e-dbfa-262f-2bb796ccab71@organicfoodmarkets.com.au>
Message-ID: <574AC1A1.6040004@braverock.com>

You can't 'highlight' anything in non-HTML email.  The list only passes 
through standard text emails.

The order book does not contain columns
date     size     days     value     price

so you've done some transformation or aggregation.

If you want someone to help you, I suggest using an actual minimal 
reproducible example.  Keep removing things from your script: options, 
arguments, data, stategy components, etc. until it has *nothing* more 
than necessary to replicate what you believe to be the problem.

Your emails after the first one *add* things, not remove  them. That is 
unlikely to uncover a problem, if one exists.

The 'delay' argument was designed for intraday data, where we have used 
it on backtests for years.

Also, Ilya Kipnis already suggested another approach.  You could add 
another signal which is simply a lag 8 days after your entry signal. (I 
don't think you need sigAND  or sigOR for this, just lag as the signal 
function)

In any event, adding complexity is unlikely to help uncover the solution.

Regards,

Brian

On 05/29/2016 04:56 AM, Stephen Choularton wrote:
> Hi
>
> The more I look the more I see problems.  This is from the orderbook.
>
> date     size     days     value     price
>
>
>
>
>
> 2003-08-07     3261
>      9529.8710891097     2.9223769056
> 2003-08-19     all     9     9631.2529121466     2.9534660877
> 2003-11-11     3073     61     12056.776566913     3.9234547891
> 2003-11-21     all     9     11273.3727012341     3.6685234954
> 2003-12-10     2638     14     9136.2774479317     3.4633348931
> 2003-12-22     all     9     7955.2864672296     3.0156506699
> 2004-01-13     3591     17     11052.4840619585     3.0778290342
> 2004-01-23     all     9     10494.277796203     2.9223831234
> 2004-01-28     3603     4     9969.2747769987     2.7669372126
> 2004-01-30     all     3     10126.0948296706     2.8104620676
> 2004-02-03     3184     3     8710.9401289089     2.7358480304
> 2004-02-09     all     5     8809.9280849192     2.7669372126
> 2004-08-19     2298     139     8716.0387547838     3.792880224
> 2004-08-31     all     9     8873.2132241324     3.8612764248
> 2004-09-17     3469     14     13524.1859650561     3.8985834434
> 2004-09-29     all     9     13265.3498700311     3.8239694062
> 2005-01-06     3969     72     17546.4794820949     4.4208817037
> 2005-01-18     all     9     18484.2660085641     4.6571594882
> 2005-02-21     1830     25     8442.9513786548     4.6136346331
> 2005-03-03     all     9     8306.4076905903     4.539020596
>
> I have highlighted two trades which are not according to that 8 day
> rule. If the highlighting gets lost they are the closing sales on the 30
> Jan and 9 Feb.  I can't figure out why.
>
> However, I also notice that the value of the investments made varies
> widely when I would have expected them to be fairly consistent.
>
> Can anyone throw any light on these problems.
>
> Thanks.
>
>
> ------------------------------------------
> Stephen Choularton PhD, FIoD
>
> On 28/05/2016 5:05 PM, Stephen Choularton wrote:
>> Hi
>>
>> I thought I had found a solution to this by adding the signal:
>>
>> add.signal(strategy.st, name="sigFormula",
>>     arguments = list(columns = c("longEntry"),
>>     formula = "lag(longEntry, 8) == 1", cross=FALSE), label="fixedExit")
>>
>>
>> and a new rule:
>>
>> add.rule(strategy.st, name = "ruleSignal",
>>     arguments = list(sigcol = "fixedExit",
>>     sigval = TRUE,
>>     orderqty = "all",
>>     ordertype = "market",
>>     orderside = "long", TxnFees = txnFees,
>>     replace = FALSE,
>>     prefer = "Open"), type= "exit", path.dep = TRUE)
>>
>> I placed the rule before the old exit one assuming it would then take
>> precedent and because the rule was a sell all one it would do no harm
>> for the other rule to trigger as all = 0 at that stage.
>>
>> It made a difference but I was not sure if it was working properly (ie
>> sell either when the normal sale is triggered or on 8 days whichever
>> is the earlier).  So I temporarily removed the old longExit signal and
>> associated rule.  That should have mean that I only got sales on the
>> 8th trading day after a purchase but this showed up in the order book:
>>
>>            Order.Qty Order.Price        Order.Type Order.Side
>> Order.Threshold Order.Status Order.StatusTime      Prefer Order.Set
>> Txn.Fees Rule              Time.In.Force
>> 2003-08-07 "3261"    "2.92237690558407" "market"   "long"
>> NA              "closed"     "2003-08-08 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2003-08-19 "all"     "2.95346608774812" "market"   "long"
>> NA              "closed"     "2003-08-20 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2003-11-11 "3073"    "3.92345478910284" "market"   "long"
>> NA              "closed"     "2003-11-12 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2003-11-21 "all"     "3.66852349535765" "market"   "long"
>> NA              "closed"     "2003-11-24 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2003-12-10 "2638"    "3.46333489307494" "market"   "long"
>> NA              "closed"     "2003-12-11 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2003-12-22 "all"     "3.01565066991264" "market"   "long"
>> NA              "closed"     "2003-12-23 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2004-01-13 "3591"    "3.07782903424074" "market"   "long"
>> NA              "closed"     "2004-01-14 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2004-01-23 "all"     "2.9223831234205"  "market"   "long"
>> NA              "closed"     "2004-01-26 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2004-01-28 "3603"    "2.76693721260026" "market"   "long"
>> NA              "closed"     "2004-01-29 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> 2004-01-30 "all"     "2.81046206762993" "market"   "long"
>> NA              "closed"     "2004-02-02 00:00:00" "Open" NA "-8"
>> "ruleSignal.rule" ""
>> Please note the last line shows a purchase and sale only two calendar
>> days apart.  They were weekdays.  That is not in accordance with the
>> indicator or rule I wrote.   In fact mktdata shows:
>>
>> 2004-01-28                 1         0         1         0
>> 2004-01-29                 0         0         0         0
>> 2004-01-30                 0         0         0         0
>> 2004-02-02                 0         0         0         0
>> 2004-02-03                 0         0         0         0
>> 2004-02-04                 0         0         0         0
>> 2004-02-05                 0         0         0         0
>> 2004-02-06                 0         0         0         0
>> 2004-02-09                 0         0         0         1
>>
>> with the signals on the correct days.
>>
>> Just a sanity check.  Can anyone tell me where I am going wrong,
>> presumably in writing that rule.
>>
>> -----------------------------------------------------------------------------------------------------------------------------------
>>
>> Stephen Choularton PhD, FIoD
>>
>> On 27/05/2016 4:43 PM, Stephen Choularton wrote:
>>> Hi
>>>
>>> I am trying to implement Harry's Connor's RSI from his book
>>> Quantative Trading ...
>>>
>>> I have it working as is and have varied it to some shares in the ASX.
>>>
>>> However, I want to pursue the idea of a fixed time (8 day) sell rule
>>> that takes place if the normal rule doesn't produce a sale before.
>>>
>>> I added this rule at line 127 of the file 3. strategy.R:
>>>
>>> add.rule(strategy.st, name = "ruleSignal",
>>>     arguments = list(sigcol = "longExit",
>>>     sigval = TRUE,
>>>     orderqty = "all", delay = 691200,
>>>     ordertype = "market",
>>>     orderside = "long", TxnFees = txnFees,
>>>     replace = FALSE,
>>>     prefer = "Open"), type= "exit", path.dep = TRUE)
>>>
>>> but it seems to have no effect.
>>>
>>> I attach all the code. You run it in the numbered order of the files.
>>>
>>> I wonder if anyone can help me make this sort of rule work.
>>>
>>> -----------------------------------------------------------------------------------------------------------------------------------
>>>
>>> Stephen Choularton PhD, FIoD
>>> 0413 545 182
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R
>> questions should go.
>>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From josh.m.ulrich at gmail.com  Sun May 29 17:39:20 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sun, 29 May 2016 10:39:20 -0500
Subject: [R-SIG-Finance] Passing two distributions to one parameter
In-Reply-To: <BAY172-W36D2E310C57B1056BA2A3BC7430@phx.gbl>
References: <BAY172-W36D2E310C57B1056BA2A3BC7430@phx.gbl>
Message-ID: <CAPPM_gSWu0j6Du5G8fBO6YVpBJd2m1vSMVtR27D9z=L+ZLZNYQ@mail.gmail.com>

If you want people on this list to help you, you need to stop sending
HTML.  Your message is unreadable and the code is not runable.
Configure your mail client to send only plain-text.

On Sat, May 28, 2016 at 8:14 AM, Atakan Okan <atakanokan at outlook.com> wrote:
> Hi r-sig-finance,
> I was trying to implement a strategy where parabolic SAR (from TTR package) is used. However one of the parameters of SAR "accel" takes two values, one for "accelaration factor" and one for "maximum acceleration factor". I was unable to pass two sequences as one parameter and I was wondering if it is possible to do that to be able to optimize those parameters.
> Reproducible code: (The commented out add.distributions did not work.)
>
> library(PerformanceAnalytics)library(quantstrat)                               no.cores <- 4
> .strategy <- new.env().blotter  <- new.env()
> symbol.name = "AAPL"                                        tick.size = 0.01 currency("USD")stock(symbol.name, currency="USD", multiplier=1,tick_size= tick.size)
> initialEquity = 1000                                           port.acct.currency <- "USD"strategy.keyword = "PSAR_D1"
> longStopLossDistance <- 0;longTrailingStopDistance <- 0;longTakeProfitDistance <- 0shortStopLossDistance <- 0;shortTrailingStopDistance <- 0;shortTakeProfitDistance <- 0
> symbol.data <- getSymbols(symbol.name)
> strategy.st <- paste(symbol.name,strategy.keyword,sep = "_")rm.strat(strategy.st)
> initDate = as.character(as.Date(index(symbol.data[1])-1))                    initPortf(strategy.st, symbol.name, initDate=initDate, currency = port.acct.currency)initAcct(strategy.st, portfolios=strategy.st, initDate=initDate,          initEq=initialEquity, currency = port.acct.currency)initOrders(portfolio=strategy.st,initDate=initDate)                          strategy(strategy.st,store=TRUE)summary(getStrategy(strategy.st))
> txn.model <- 0
> fixedSizeLong  =  100     fixedSizeShort =  -100
> paramset.label.name <- "PSAR_OPT"accel.factor <- seq(from=0.01, by=0.01, length.out = 3)max.accel.factor <- seq(from=0.1, by=0.05, length.out = 4)accels.df <- expand.grid(accel.factor,max.accel.factor)
>
> add.indicator(strategy.st,                                                                   name = "SAR",                                                                 arguments = list(HL=HLC(eval(parse(text = symbol.name)))                               ,accel=c(accel.factor,max.accel.factor)              ),                       label='sar')
>
> #apply.indicators.df <- applyIndicators(strategy.st, mktdata=eval(parse(text = symbol.name)))
>
> add.signal(strategy.st,name="sigCrossover",           arguments = list(columns=c("sar","Close"),relationship="gt"),           label="sar.gt.close")
> add.signal(strategy.st,name="sigCrossover",           arguments = list(columns=c("sar","Close"),relationship="lt"),           label="sar.lt.close")
> #apply.signals.df <- applySignals(strategy.st, mktdata=apply.indicators.df)
> add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.gt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty= fixedSizeLong,                           ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='enter',         label='longenter',         enabled=TRUE)
> # Long Exit Rule-------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.lt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='long',                          orderset='ocolong',                          TxnFees = txn.model),         type='exit',         label='longexit',         enabled=TRUE)
>
>
> # Short Entry Rule--------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.lt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty= fixedSizeShort,                           ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='enter',         label='shortenter',         enabled=TRUE)
> # Short Exit Rule---------------------------------------------------------------------add.rule(strategy.st,         name='ruleSignal',         arguments = list(sigcol="sar.gt.close",                          sigval=TRUE,                          prefer="Open",                           orderqty='all',                          ordertype='market',                          orderside='short',                          orderset='ocoshort',                          TxnFees = txn.model),         type='exit',         label='shortexit',         enabled=TRUE)
>
>
>
> #SAR Optimization-------------------------------------------------------------#add.distribution(strategy.st, #                paramset.label = paramset.label.name,  #               component.type = 'indicator',   #              component.label = 'sar',                          #             variable = list( accel = accels.df),             #            label = "sar.accels")
>
>
> #add.distribution(strategy.st,#                 paramset.label = paramset.label.name,#                 component.type = 'indicator',#                 component.label = 'sar',                      #                 variable = list( accel[1] = accel.factor),        #                 label = "sar.accels.factor")
>
> #add.distribution(strategy.st,#                 paramset.label = paramset.label.name,#                 component.type = 'indicator',#                 component.label = 'sar',                      #                 variable = list( accel[2] = max.accel.factor),        #                 label = "sar.accels.max")
>
> #add.distribution(strategy.st,#                 paramset.label = paramset.label.name,#                 component.type = 'indicator',#                 component.label = 'sar',                      #                 variable = list( accel = accel.factor,max.accel.factor),        #                 label = "sar.accels.2")
>
>
>
> summary(getStrategy(strategy.st))
> paramsetenv<-new.env()results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,                          audit=paramsetenv)
> results.df <- data.frame(results$tradeStats)
>
> ------------------------------------------------------------------------------------------------------------------------------------------------
> Atakan Okan
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From josh.m.ulrich at gmail.com  Sun May 29 18:23:42 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sun, 29 May 2016 11:23:42 -0500
Subject: [R-SIG-Finance] Position Limits
In-Reply-To: <CAFLRcn0_LiHG0v0WcZTu3YcWOz-HvQ7S0UXQBDnpCHfcqDes-Q@mail.gmail.com>
References: <CAFLRcn0_LiHG0v0WcZTu3YcWOz-HvQ7S0UXQBDnpCHfcqDes-Q@mail.gmail.com>
Message-ID: <CAPPM_gT5g-jkTVhqPm6MC9oJ7DaVSOXANJYQYN_Sdfu+aZYO2A@mail.gmail.com>

On Fri, May 27, 2016 at 3:48 PM, John Klingensmith <johnsk00 at gmail.com> wrote:
> Hi,
>  I am relatively new to R and QuantStrat, etc. I am playing with a real
> simple strategy that goes long when the market closes at its lowest close
> in 3 days and reverses the position when the market closes at its highest
> close in 3 day.  I am trying to limit the position size to 1 lot in either
> direction by using osMaxPos and addPosLimit, but for whatever reason the
> position limits are not getting imposed. I also read the "Long Enter
> Position do not "block" Short Enter Orders" question and tried making a
> custom function.
>
> My questions are as follows:
<snip>
>
> 4) I am using S&P index data; although you cannot actually trade the index,
> it is a good proxy for what I am trying to test. When I download the index
> data (symbol ^GSPC) the symbol stored is "GSPC" without the carrot;
> therefore, I cannot simply use "symbols <- "^GSPC" and reference "symbols"
> in my code as I would normally if it were an ETF. Can someone explain why
> this is?
>
Because syntactic names must start with a letter, or a period not
followed by a digit.  See the "Names and Identifiers" section of
?Quotes.

> Thanks for any help.
> Best,
>  John
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From atakanokan at outlook.com  Sun May 29 19:41:43 2016
From: atakanokan at outlook.com (Atakan Okan)
Date: Sun, 29 May 2016 20:41:43 +0300
Subject: [R-SIG-Finance] Passing two distributions to one parameter
In-Reply-To: <CAPPM_gSWu0j6Du5G8fBO6YVpBJd2m1vSMVtR27D9z=L+ZLZNYQ@mail.gmail.com>
References: <BAY172-W36D2E310C57B1056BA2A3BC7430@phx.gbl>,
	<CAPPM_gSWu0j6Du5G8fBO6YVpBJd2m1vSMVtR27D9z=L+ZLZNYQ@mail.gmail.com>
Message-ID: <BAY172-W462F3DD365F87FEA40588C7440@phx.gbl>

I am so sorry, switched to Outlook.com, I always forget to put it into Plain Text mode.

Here is the code in plain-text format,(The commented out add.distributions did not work.)

>> Hi r-sig-finance,
>> I was trying to implement a strategy where parabolic SAR (from TTR package) is used. However one of the parameters of SAR "accel" takes two values, one for "accelaration factor" and one for "maximum acceleration factor". I was unable to pass two sequences as one parameter and I was wondering if it is possible to do that to be able to optimize those parameters.

#PSAR problem - passing two arguments to one parameter when creating distribution


library(PerformanceAnalytics)
library(quantstrat)                               
no.cores <- 4                                     

.strategy <- new.env()
.blotter  <- new.env()                              

symbol.name = "AAPL"                                        
tick.size = 0.01 
currency("USD")
stock(symbol.name, currency="USD", multiplier=1,tick_size= tick.size)

initialEquity = 1000                                           
port.acct.currency <- "USD"
strategy.keyword = "PSAR_D1"                                

longStopLossDistance <- 0;longTrailingStopDistance <- 0;longTakeProfitDistance <- 0
shortStopLossDistance <- 0;shortTrailingStopDistance <- 0;shortTakeProfitDistance <- 0

symbol.data <- getSymbols(symbol.name)

strategy.st <- paste(symbol.name,strategy.keyword,sep = "_")
rm.strat(strategy.st)                                                      

initDate = as.character(as.Date(index(symbol.data[1])-1))                    
initPortf(strategy.st, symbol.name, initDate=initDate, currency = port.acct.currency)
initAcct(strategy.st, portfolios=strategy.st, initDate=initDate, 
         initEq=initialEquity, currency = port.acct.currency)
initOrders(portfolio=strategy.st,initDate=initDate)                          
strategy(strategy.st,store=TRUE)
summary(getStrategy(strategy.st))                                            

txn.model <- 0   

fixedSizeLong  =  100     
fixedSizeShort =  -100     

paramset.label.name <- "PSAR_OPT"
accel.factor <- seq(from=0.01, by=0.01, length.out = 3)
max.accel.factor <- seq(from=0.1, by=0.05, length.out = 4)
accels.df <- expand.grid(accel.factor,max.accel.factor)   


add.indicator(strategy.st,                                                     
              name = "SAR",                                                   
              arguments = list(HL=HLC(eval(parse(text = symbol.name)))
                               ,accel=c(accel.factor,max.accel.factor)
              ),         
              label='sar')                                              


#apply.indicators.df <- applyIndicators(strategy.st, mktdata=eval(parse(text = symbol.name)))    


add.signal(strategy.st,name="sigCrossover",
           arguments = list(columns=c("sar","Close"),relationship="gt"),
           label="sar.gt.close") 

add.signal(strategy.st,name="sigCrossover",
           arguments = list(columns=c("sar","Close"),relationship="lt"),
           label="sar.lt.close")

#apply.signals.df <- applySignals(strategy.st, mktdata=apply.indicators.df)                     

add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="sar.gt.close",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty= fixedSizeLong, 
                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = txn.model),
         type='enter',
         label='longenter',
         enabled=TRUE
)

# Long Exit Rule-------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="sar.lt.close",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty='all',
                          ordertype='market',
                          orderside='long',
                          orderset='ocolong',
                          TxnFees = txn.model),
         type='exit',
         label='longexit',
         enabled=TRUE
)



# Short Entry Rule--------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="sar.lt.close",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty= fixedSizeShort, 
                          ordertype='market',
                          orderside='short',
                          orderset='ocoshort',
                          TxnFees = txn.model),
         type='enter',
         label='shortenter',
         enabled=TRUE
)

# Short Exit Rule---------------------------------------------------------------------
add.rule(strategy.st,
         name='ruleSignal',
         arguments = list(sigcol="sar.gt.close",
                          sigval=TRUE,
                          prefer="Open", 
                          orderqty='all',
                          ordertype='market',
                          orderside='short',
                          orderset='ocoshort',
                          TxnFees = txn.model),
         type='exit',
         label='shortexit',
         enabled=TRUE
)




#SAR Optimization-------------------------------------------------------------
add.distribution(strategy.st,
                 paramset.label = paramset.label.name,
                 component.type = 'indicator',
                 component.label = 'sar',                      
                 variable = list( accel = accels.df),        
                 label = "sar.accels")


#calismadi
#add.distribution(strategy.st,
#                 paramset.label = paramset.label.name,
#                 component.type = 'indicator',
#                 component.label = 'sar',                      
#                 variable = list( accel[1] = accel.factor),        
#                 label = "sar.accels.factor")

#calismadi
#add.distribution(strategy.st,
#                 paramset.label = paramset.label.name,
#                 component.type = 'indicator',
#                 component.label = 'sar',                      
#                 variable = list( accel[2] = max.accel.factor),        
#                 label = "sar.accels.max")

#calismadi
#add.distribution(strategy.st,
#                 paramset.label = paramset.label.name,
#                 component.type = 'indicator',
#                 component.label = 'sar',                      
#                 variable = list( accel = accel.factor,max.accel.factor),        
#                 label = "sar.accels.2")


#apply.paramset.df <- apply.paramset.signal.analysis(strategy.st = strategy.st, portfolio.st = strategy.st, paramset.label = paramset.label.name)


summary(getStrategy(strategy.st))                                              

paramsetenv<-new.env()
results <- apply.paramset(strategy.st,paramset.label=paramset.label.name,
                          portfolio=strategy.st, account=strategy.st,nsamples=0,verbose = TRUE,
                          audit=paramsetenv)

results.df <- data.frame(results$tradeStats)

#applyStrategy( strategy=strategy.st , portfolios=strategy.st
#               ,verbose=TRUE)
#updatePortf(strategy.st)
#updateAcct(strategy.st)
#updateEndEq(strategy.st)


> From: josh.m.ulrich at gmail.com
> Date: Sun, 29 May 2016 10:39:20 -0500
> Subject: Re: [R-SIG-Finance] Passing two distributions to one parameter
> To: atakanokan at outlook.com
> CC: r-sig-finance at r-project.org
> 
> If you want people on this list to help you, you need to stop sending
> HTML. Your message is unreadable and the code is not runable.
> Configure your mail client to send only plain-text.
> 
> On Sat, May 28, 2016 at 8:14 AM, Atakan Okan  wrote:
>> Hi r-sig-finance,
>> I was trying to implement a strategy where parabolic SAR (from TTR package) is used. However one of the parameters of SAR "accel" takes two values, one for "accelaration factor" and one for "maximum acceleration factor". I was unable to pass two sequences as one parameter and I was wondering if it is possible to do that to be able to optimize those parameters.
>> Reproducible code: (The commented out add.distributions did not work.)

 		 	   		  
	[[alternative HTML version deleted]]


From sacios at hotmail.it  Mon Jun  6 01:38:58 2016
From: sacios at hotmail.it (Sachin Kuruvithadam)
Date: Sun, 5 Jun 2016 23:38:58 +0000
Subject: [R-SIG-Finance] Estimating gumbel copula parameter
Message-ID: <DB4PR06MB068563F964E17ED3B5DEB64AB75B0@DB4PR06MB0685.eurprd06.prod.outlook.com>

Hi all. I'm a R newbie, so please bear with me.

I'm fitting nine log losses series (log returns multiplied by -1, so that I have losses on the right and returns on the left) using copulas. My project in more detail:
1) I've filtered the residuals using univariate ARMA-GARCH models, and standardized them dividing by sigma, so that now I have standardized residuals with mean 0 and variance 1 (rugarch package).
2) I modeled the residuals using the generalized pareto distribution family, for all nine series I'm using upper and lower thresholds equal to 0.95 and 0.05 quantiles respectively (spd package).
3) After turning the standardized residuals to their uniform margins using pspd, I'm fitting a Gumbel copula which has upper tail dependence since I'm focusing on losses which are on the right (copula package).
Next part of the work: i) I want to estimate a time-varying Gumbel parameter; ii) given predicted parameter, simulate copula realizations; iii) using the inverse marginal distributions, turn these realizations into standardized residuals; iv) compute returns using ARMA-GARCH specification, convert into simple returns, compute return of equally weighted portfolio and estimate/backtest value at risk and expected shortfall.

Being done with first 2 steps, now I want to estimate a time varying Gumbel. So I'm trying to extract the parameter with a moving window of 500 observations to get an idea of how the time series looks like.

My code looks like this:
theta <- c()
for (i in 1:3345)
{
  theta[i]=summary(fitCopula(gumbel.cop,standardized[i:(i+499),], method="ml"))$coefficients[1]
}

where standardized is a matrix with 9 columns, each with the uniform margin between 0 and 1. So I want to estimate 3345 theta using a window of 500 observations, from theta_1 (obs. 1 to 500) to theta_3345 (obs. 3345 to 4344). However, while running this code, I get:

Error in optim(start, loglikCopula, lower = lower, upper = upper, method = method,  :
  valore iniziale in 'vmmin' non finito

where the last sentence can be translated with "initial value in "vmmin" not finite".

What is this error due to? How can I fix this in the command? It runs for the first 1339 estimates (which I've obtained), but from i=1340 this message shows up and I have NA as estimated value.


Any help is appreciated. Thanks.

	[[alternative HTML version deleted]]


From yijun.xie at stat.ubc.ca  Thu Jun  9 00:58:41 2016
From: yijun.xie at stat.ubc.ca (Xie Yijun)
Date: Wed, 8 Jun 2016 15:58:41 -0700
Subject: [R-SIG-Finance] How are errors terms calculated in GARCH model by
	rugarch package?
Message-ID: <5758A321.9000902@stat.ubc.ca>

Hi,

I am fitting a GARCH(1,1) model to the data and want to look at the 
innovation distribution.

###################
  #generate the data
     set.seed(1)
     N = 5000
     omega = 0.5
     alpha = 0.08
     beta = 0.91
     X1 = rep(0,N)
     X2 = rep(0,N)
     sig1 = rep(0,N)
     sig2 = rep(0,N)

     for(i in 2:N){
       sig1[i] = sqrt(omega + alpha * X1[i-1] + beta * sig1[i-1]^2)
       X1[i] = sig1[i] * rnorm(1)
       sig2[i] = sqrt(omega + alpha * X2[i-1] + beta * sig2[i-1]^2)
       X2[i] = sig2[i] * rt(1, df = 8)
     }

     X1 = X1[-c(1:1000)]
#################


I first generate the data and fit it to GARCH(1,1) model with t innovation.

########################
     spec = ugarchspec(mean.model=list(armaOrder=c(0,0),include.mean=F),
                   distribution.model="std") # GARCH(1,1) model
     myfit = ugarchfit(spec, X1)
########################

Suppose the fitted model is called `myfit` then I can get the error 
terms by

###################
z1 = myfit at fit$z
###################

However, if I only extract the parameters omega, alpha, and beta 
estimated by the `rugarch` package and calculate the error terms manually as

$\sigma_t^2 = \omega + \alpha X_{t-1}^2 + \beta \sigma_{t-1}^2$

$z_t = X_t / \sigma_t$

The code is:

###########################
     omega1 = myfit at fit$coef[1]
     alpha1 = myfit at fit$coef[2]
     beta1 = myfit at fit$coef[3]

     z2 = rep(0,(N-1000))
     sighat1 = rep(0,(N-1000))
     sighat1[2] = 1
     sighat1[1] = 1
     for(i in 2:(N - 1000)){
       sighat1[i] = sqrt(omega1 + alpha1 * X1[i-1] + beta1 * sighat1[i-1]^2)
       z2[i] = X1[i]/sighat1[i]
     }
###########################

I got very different results between these two approaches by comparing 
the Q-Q plot of `z1` and `z2`.

###########
     qqnorm(z1)
     qqline(z1)
     qqnorm(z2)
     qqline(z2)
###########

`z1` seems to be normally distributed following the data generating 
process, while `z2` has a heavy tail following the model specification. 
I was wondering why they are so different? I arbitrarily chose 1 for for 
first two terms of $\hat{\sigma}$, so does the difference come from the 
initial values?

And more generally, how does `rugarch` package fit the GARCH model and 
choose initial values? My understanding is that we need to find 
parameters using either QMLE or MLE and then find error terms 
iteratively using my second approach. But I am not sure how is the 
initial value chosen.

Thanks!
Patrick


From alexios at 4dscape.com  Thu Jun  9 02:58:45 2016
From: alexios at 4dscape.com (alexios galanos)
Date: Wed, 8 Jun 2016 19:58:45 -0500
Subject: [R-SIG-Finance] How are errors terms calculated in GARCH model
 by rugarch package?
In-Reply-To: <5758A321.9000902@stat.ubc.ca>
References: <5758A321.9000902@stat.ubc.ca>
Message-ID: <3e455df8-cbc4-3eb0-95ad-93db81accc33@4dscape.com>


1. The initialization of the recursion (and options for doing so) is
described in the vignette...please READ IT.

The default it to use the mean of the squared residuals.

Many questions have already been answered over the years on this mailing
list regarding
the estimation and related issues so you might also like to search the
archives.

2. For some reason you are multiplying alpha1 by the value of X1 rather
than X1^2.
Have you pre-squared X1 somewhere and I missed it?

Here is the code to get exactly the same values:
#########################
z2 = rep(0,(N-1000))
sighat1 = rep(0,(N-1000))
sighat1[1] = sqrt(mean(X1^2))
z2[1] = X1[1]/sighat1[1]
for(i in 2:length(X1)){
  sighat1[i] = sqrt(omega1 + alpha1 * X1[i-1]^2 + beta1 * sighat1[i-1]^2)
  z2[i] = X1[i]/sighat1[i]
}
all.equal(z1, z2)
>TRUE
#########################

3. You may want to revisit your use of "rt". This is not the
standardized distribution
and hence you will not have a st.deviation of 1.

In rugarch, rdist("std",mu,sigma,shape,skew) is the standardized student
distribution
i.e. rt(1, df=nu)/(sqrt(nu/(nu-2)))


-Alexios


On 08/06/2016 17:58, Xie Yijun wrote:
> Hi,
>
> I am fitting a GARCH(1,1) model to the data and want to look at the
> innovation distribution.
>
> ###################
>  #generate the data
>     set.seed(1)
>     N = 5000
>     omega = 0.5
>     alpha = 0.08
>     beta = 0.91
>     X1 = rep(0,N)
>     X2 = rep(0,N)
>     sig1 = rep(0,N)
>     sig2 = rep(0,N)
>
>     for(i in 2:N){
>       sig1[i] = sqrt(omega + alpha * X1[i-1] + beta * sig1[i-1]^2)
>       X1[i] = sig1[i] * rnorm(1)
>       sig2[i] = sqrt(omega + alpha * X2[i-1] + beta * sig2[i-1]^2)
>       X2[i] = sig2[i] * rt(1, df = 8)
>     }
>
>     X1 = X1[-c(1:1000)]
> #################
>
>
> I first generate the data and fit it to GARCH(1,1) model with t
> innovation.
>
> ########################
>     spec = ugarchspec(mean.model=list(armaOrder=c(0,0),include.mean=F),
>                   distribution.model="std") # GARCH(1,1) model
>     myfit = ugarchfit(spec, X1)
> ########################
>
> Suppose the fitted model is called `myfit` then I can get the error
> terms by
>
> ###################
> z1 = myfit at fit$z
> ###################
>
> However, if I only extract the parameters omega, alpha, and beta
> estimated by the `rugarch` package and calculate the error terms
> manually as
>
> $\sigma_t^2 = \omega + \alpha X_{t-1}^2 + \beta \sigma_{t-1}^2$
>
> $z_t = X_t / \sigma_t$
>
> The code is:
>
> ###########################
>     omega1 = myfit at fit$coef[1]
>     alpha1 = myfit at fit$coef[2]
>     beta1 = myfit at fit$coef[3]
>
>     z2 = rep(0,(N-1000))
>     sighat1 = rep(0,(N-1000))
>     sighat1[2] = 1
>     sighat1[1] = 1
>     for(i in 2:(N - 1000)){
>       sighat1[i] = sqrt(omega1 + alpha1 * X1[i-1] + beta1 *
> sighat1[i-1]^2)
>       z2[i] = X1[i]/sighat1[i]
>     }
> ###########################
>
> I got very different results between these two approaches by comparing
> the Q-Q plot of `z1` and `z2`.
>
> ###########
>     qqnorm(z1)
>     qqline(z1)
>     qqnorm(z2)
>     qqline(z2)
> ###########
>
> `z1` seems to be normally distributed following the data generating
> process, while `z2` has a heavy tail following the model
> specification. I was wondering why they are so different? I
> arbitrarily chose 1 for for first two terms of $\hat{\sigma}$, so does
> the difference come from the initial values?
>
> And more generally, how does `rugarch` package fit the GARCH model and
> choose initial values? My understanding is that we need to find
> parameters using either QMLE or MLE and then find error terms
> iteratively using my second approach. But I am not sure how is the
> initial value chosen.
>
> Thanks!
> Patrick
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R
> questions should go.
>


From thp at 2pimail.com  Thu Jun  9 08:02:39 2016
From: thp at 2pimail.com (thp)
Date: Thu, 09 Jun 2016 08:02:39 +0200
Subject: [R-SIG-Finance] Option pricing, basic question
Message-ID: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>

Hello,

I have a question regarding option pricing. In advance:
thank you for the patience.

I am trying to replay the calculation of plain
vanilla option prices using the Black-Scholes model
(the one leading to the analytic solution seen for
example on the wikipedia page [1]).

Using numerical values as simply obtained from
an arbitrary broker, I am surprised to see that
the formula values and quoted prices mismatch
a lot. (seems cannot all be explained by spread
or dividend details)

My question: What values for r (drift) and \sigma^2
are usually to be used, in which units?

If numerical values are chosen to be given "per year",
then I would expect r to be chosen as \ln(1+i),
where i is the yearly interest rate of the risk-free
portfolio and \ln is the natural logarithm. Would the
risk-free rate currently be chosen as zero?

The \sigma^2 one would accordingly have to choose
as the variance of the underlying security over
a one year period. Should this come out equal in
numerical value to the implied volatility, which is
0.2 to 0.4 for the majority of options?

Tom

[1] https://de.wikipedia.org/wiki/Black-Scholes-Modell


From hyu0401 at hotmail.com  Thu Jun  9 08:38:51 2016
From: hyu0401 at hotmail.com (Hong Yu)
Date: Thu, 9 Jun 2016 14:38:51 +0800
Subject: [R-SIG-Finance] Option pricing, basic question
Message-ID: <SNT405-EAS1072C74C1B528CABCC33D35AE5F0@phx.gbl>


I remember John Hull?s book on option pricing should be helpful in finding some examples for your programming and modelling.  

Some assumptions of the Black-Scholes model are known to be impractical.  ?Implied volatility? is one way to handle that.  Again you can find books for theoretical discussions to improve Black-Scholes.

My suggestions do not stick to your particular questions.  But hope the above may help.

Hong Yu




From: thp 
Sent: Thursday, June 09, 2016 2:03 PM
To: r-sig-finance at r-project.org 
Subject: [R-SIG-Finance] Option pricing, basic question

Hello,

I have a question regarding option pricing. In advance:
thank you for the patience.

I am trying to replay the calculation of plain
vanilla option prices using the Black-Scholes model
(the one leading to the analytic solution seen for
example on the wikipedia page [1]).

Using numerical values as simply obtained from
an arbitrary broker, I am surprised to see that
the formula values and quoted prices mismatch
a lot. (seems cannot all be explained by spread
or dividend details)

My question: What values for r (drift) and \sigma^2
are usually to be used, in which units?

If numerical values are chosen to be given "per year",
then I would expect r to be chosen as \ln(1+i),
where i is the yearly interest rate of the risk-free
portfolio and \ln is the natural logarithm. Would the
risk-free rate currently be chosen as zero?

The \sigma^2 one would accordingly have to choose
as the variance of the underlying security over
a one year period. Should this come out equal in
numerical value to the implied volatility, which is
0.2 to 0.4 for the majority of options?

Tom

[1] https://de.wikipedia.org/wiki/Black-Scholes-Modell

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From frankm60606 at gmail.com  Thu Jun  9 15:42:11 2016
From: frankm60606 at gmail.com (Frank)
Date: Thu, 9 Jun 2016 08:42:11 -0500
Subject: [R-SIG-Finance] Option pricing, basic question
In-Reply-To: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
References: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
Message-ID: <CEDE2EA1808446C3AA719BDC6DE4CA02@Franki7PC>

I use the 3-month constant maturity Treasury bill rate from FRED (Federal
Reserve Economic ??Database??) for the risk-free rate. For options with
substantially more than 3 months until expiration, I think it makes sense to
use a maturity that best matches the option. The R code I use is:

library(quantmod)
library(chron)


##
## Get DGS3MO Treasury yield from FRED
##

getSymbols('DGS3MO',src='FRED')
DGS3MO<-na.locf(DGS3MO/100.0,na.rm = TRUE)
tail(DGS3MO)
file_name <- "DGS3MO.csv"
write.zoo(DGS3MO, file = file_name, append = FALSE, quote = TRUE, sep = ",")
quit()

I run this text from a batch file in Windows 7 Pro 64-bit. The text in the
batch file is:

REM on Microsoft Windows (adjust the path to R.exe as needed) 
DEL *DGS3MO.csv

"C:\Program Files\R\R-3.2.2\bin\x64\R.exe" CMD BATCH
"C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.txt"
"C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.out"
COPY DGS3MO.BAT DGS3MO.BAK
COPY DGS3MO.TXT DGS3MO.TXT.BAK
REM PAUSE

You say "r (drift)". Interest rates do move around despite the constant
interest rate assumption of the Black-Scholes model. This could be
characterized as drift. I'm not sure why else drift is in this post.
Correcting for interest rate drift has not mattered in calculations I've
made.

Volatility is also assumed constant in Black-Scholes. Volatility does drift
and this is the core problem with fitting market data to the standard
Black-Scholes model. Correctly correcting for drift might give you a better
fit to market data. 

Best,

Frank
Chicago, IL

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of thp
Sent: Thursday, June 09, 2016 1:03 AM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] Option pricing, basic question

Hello,

I have a question regarding option pricing. In advance:
thank you for the patience.

I am trying to replay the calculation of plain
vanilla option prices using the Black-Scholes model
(the one leading to the analytic solution seen for
example on the wikipedia page [1]).

Using numerical values as simply obtained from
an arbitrary broker, I am surprised to see that
the formula values and quoted prices mismatch
a lot. (seems cannot all be explained by spread
or dividend details)

My question: What values for r (drift) and \sigma^2
are usually to be used, in which units?

If numerical values are chosen to be given "per year",
then I would expect r to be chosen as \ln(1+i),
where i is the yearly interest rate of the risk-free
portfolio and \ln is the natural logarithm. Would the
risk-free rate currently be chosen as zero?

The \sigma^2 one would accordingly have to choose
as the variance of the underlying security over
a one year period. Should this come out equal in
numerical value to the implied volatility, which is
0.2 to 0.4 for the majority of options?

Tom

[1] https://de.wikipedia.org/wiki/Black-Scholes-Modell

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From adamno227 at gmail.com  Thu Jun  9 17:07:12 2016
From: adamno227 at gmail.com (Adam Ginensky)
Date: Thu, 9 Jun 2016 10:07:12 -0500
Subject: [R-SIG-Finance] Option pricing, basic question
In-Reply-To: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
References: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
Message-ID: <CAEEj48kJRFdK+8mRaZqrpSscqXsX6hYy4FouLsDhAYuC5JsOOQ@mail.gmail.com>

The comments below address the issue of drift and \sigma .  As for the
interest rate used, I think you will find that the difference in the
values obtained by using different interest rates is on the order of
magnitude of rounding error.

There is a famous quote of Box - " All models are wrong, some are
useful ".  This applies to Black-Scholes in spades.  The B-S model is
almost universally  used to price options, but there are a number of
important caveats about using B-S to price options. I would summarize
my comment by  saying that the  volatility of the underlying is merely
a guideline as to what volatility to use in pricing options.  For at
the money options, the implied volatility ( the \sigma that will give
the value of the option) is a market consensus of what volatility will
be going forward.  In times of high volatility, the implied volatility
will always be lower (and I say always in an informed, not theoretical
way) than the realized volatility and similarly in times of low
volatility the implied volatility will typically be higher than
realized volatility - both situations reflecting 'regression to the
mean' nature of market movement. When I was an active floor trader,
this was called 'tilt' by many people. I would sum this up by saying
that the implied volatility is the market consensus as to what
realized volatility will be going forward.
As another exercise, get the prices of relatively short term options
mid-day on the Friday before a 3 day weekend.  The implied volatility
will typically seem absurdly low but will seem reasonable if the
volatility is computed with the date being 3 days forward. That is the
implied volatility will 'price in' the three day weekend .  This is
also true for most ordinary weekends.  Further, this is just a piece
of the issue.  The Black-Scholes model  significantly underprices out
of the money options.  This is because the real world distribution of
log returns has 'fat tails'.
Finally, there is no such thing as 'the volatility'.  For a given
option class, implied volatility is usually different at every strike.
This is in fundamental contradiction to the assumptions of B-S, but
reflects the reality of what happens in the real world.  For stocks,
volatility of out of the money puts is almost always higher than the
volatility for out of the money calls.  This reflects the fact that
markets usually go down faster than they go up as well as the reality
that people usually want insurance against stock prices going down,
not insurance against stock prices going up.  This volatility curve is
dynamic.  As the market goes higher, the difference between the
volatility of out of the money puts and the volatility of out of the
money calls will usually increase.  When the market goes back down,
the volatility difference usually decreases.
The point is that modeling implied volatility is a complicated and not
well understood item.  hth.








On Thu, Jun 9, 2016 at 1:02 AM, thp <thp at 2pimail.com> wrote:
> Hello,
>
> I have a question regarding option pricing. In advance:
> thank you for the patience.
>
> I am trying to replay the calculation of plain
> vanilla option prices using the Black-Scholes model
> (the one leading to the analytic solution seen for
> example on the wikipedia page [1]).
>
> Using numerical values as simply obtained from
> an arbitrary broker, I am surprised to see that
> the formula values and quoted prices mismatch
> a lot. (seems cannot all be explained by spread
> or dividend details)
>
> My question: What values for r (drift) and \sigma^2
> are usually to be used, in which units?
>
> If numerical values are chosen to be given "per year",
> then I would expect r to be chosen as \ln(1+i),
> where i is the yearly interest rate of the risk-free
> portfolio and \ln is the natural logarithm. Would the
> risk-free rate currently be chosen as zero?
>
> The \sigma^2 one would accordingly have to choose
> as the variance of the underlying security over
> a one year period. Should this come out equal in
> numerical value to the implied volatility, which is
> 0.2 to 0.4 for the majority of options?
>
> Tom
>
> [1] https://de.wikipedia.org/wiki/Black-Scholes-Modell
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


From oleg.mubarakshin at gmail.com  Thu Jun  9 18:11:03 2016
From: oleg.mubarakshin at gmail.com (Oleg Mubarakshin)
Date: Thu, 9 Jun 2016 19:11:03 +0300
Subject: [R-SIG-Finance] Option pricing, basic question
In-Reply-To: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
References: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
Message-ID: <C66E6AF301814723B8C94EDACCAF8FEA@OLEHP>

Hi Tom!

I hope you do not try to get option prices with using vol calculated from 
underlying (so called realized or historical vol).
BSM model is a model based on GBM, that we do not see in the real markets of 
course.
Real markets express skew and fat tails in log-return distributions, that 
leads to vol skew and higher implied vol of deep OTM options.

For modeling of option prices often use:
1. Stochastic vol models
2. Local vol models
3. Stochastic local vol models

these models is constructed for catch the effects described by me above.

I hope it will help you!

Kind regards,
Oleg Mubarakshin

-----???????? ?????????----- 
From: thp
Sent: Thursday, June 09, 2016 9:02 AM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] Option pricing, basic question

Hello,

I have a question regarding option pricing. In advance:
thank you for the patience.

I am trying to replay the calculation of plain
vanilla option prices using the Black-Scholes model
(the one leading to the analytic solution seen for
example on the wikipedia page [1]).

Using numerical values as simply obtained from
an arbitrary broker, I am surprised to see that
the formula values and quoted prices mismatch
a lot. (seems cannot all be explained by spread
or dividend details)

My question: What values for r (drift) and \sigma^2
are usually to be used, in which units?

If numerical values are chosen to be given "per year",
then I would expect r to be chosen as \ln(1+i),
where i is the yearly interest rate of the risk-free
portfolio and \ln is the natural logarithm. Would the
risk-free rate currently be chosen as zero?

The \sigma^2 one would accordingly have to choose
as the variance of the underlying security over
a one year period. Should this come out equal in
numerical value to the implied volatility, which is
0.2 to 0.4 for the majority of options?

Tom

[1] https://de.wikipedia.org/wiki/Black-Scholes-Modell

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions 
should go.


From thp at 2pimail.com  Thu Jun  9 18:26:42 2016
From: thp at 2pimail.com (thp)
Date: Thu, 09 Jun 2016 18:26:42 +0200
Subject: [R-SIG-Finance] Option pricing, basic question
In-Reply-To: <CEDE2EA1808446C3AA719BDC6DE4CA02@Franki7PC>
References: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
	<CEDE2EA1808446C3AA719BDC6DE4CA02@Franki7PC>
Message-ID: <9f2d7f33e81b8677fdbf2b321bc2653a@2pimail.com>

Hello to all,

I noticed that indeed my questions are not truly specific to R. 
Nevertheless the code in Frank's post
was guiding to FRED which contributes to answers.

With "drift" I mistakenly meant "risk-free rate"; properly one refers to 
"drift" when meaning the overall movement of the _underlying_.

Tom


On 2016-06-09 15:42, Frank wrote:
> I use the 3-month constant maturity Treasury bill rate from FRED 
> (Federal
> Reserve Economic ??Database??) for the risk-free rate. For options with
> substantially more than 3 months until expiration, I think it makes 
> sense to
> use a maturity that best matches the option. The R code I use is:
> 
> library(quantmod)
> library(chron)
> 
> 
> ##
> ## Get DGS3MO Treasury yield from FRED
> ##
> 
> getSymbols('DGS3MO',src='FRED')
> DGS3MO<-na.locf(DGS3MO/100.0,na.rm = TRUE)
> tail(DGS3MO)
> file_name <- "DGS3MO.csv"
> write.zoo(DGS3MO, file = file_name, append = FALSE, quote = TRUE, sep = 
> ",")
> quit()
> 
> I run this text from a batch file in Windows 7 Pro 64-bit. The text in 
> the
> batch file is:
> 
> REM on Microsoft Windows (adjust the path to R.exe as needed)
> DEL *DGS3MO.csv
> 
> "C:\Program Files\R\R-3.2.2\bin\x64\R.exe" CMD BATCH
> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.txt"
> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.out"
> COPY DGS3MO.BAT DGS3MO.BAK
> COPY DGS3MO.TXT DGS3MO.TXT.BAK
> REM PAUSE
> 
> You say "r (drift)". Interest rates do move around despite the constant
> interest rate assumption of the Black-Scholes model. This could be
> characterized as drift. I'm not sure why else drift is in this post.
> Correcting for interest rate drift has not mattered in calculations 
> I've
> made.
> 
> Volatility is also assumed constant in Black-Scholes. Volatility does 
> drift
> and this is the core problem with fitting market data to the standard
> Black-Scholes model. Correctly correcting for drift might give you a 
> better
> fit to market data.
> 
> Best,
> 
> Frank
> Chicago, IL
> 
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On 
> Behalf
> Of thp
> Sent: Thursday, June 09, 2016 1:03 AM
> To: r-sig-finance at r-project.org
> Subject: [R-SIG-Finance] Option pricing, basic question
> 
> Hello,
> 
> I have a question regarding option pricing. In advance:
> thank you for the patience.
> 
> I am trying to replay the calculation of plain
> vanilla option prices using the Black-Scholes model
> (the one leading to the analytic solution seen for
> example on the wikipedia page [1]).
> 
> Using numerical values as simply obtained from
> an arbitrary broker, I am surprised to see that
> the formula values and quoted prices mismatch
> a lot. (seems cannot all be explained by spread
> or dividend details)
> 
> My question: What values for r (drift) and \sigma^2
> are usually to be used, in which units?
> 
> If numerical values are chosen to be given "per year",
> then I would expect r to be chosen as \ln(1+i),
> where i is the yearly interest rate of the risk-free
> portfolio and \ln is the natural logarithm. Would the
> risk-free rate currently be chosen as zero?
> 
> The \sigma^2 one would accordingly have to choose
> as the variance of the underlying security over
> a one year period. Should this come out equal in
> numerical value to the implied volatility, which is
> 0.2 to 0.4 for the majority of options?
> 
> Tom
> 
> [1] https://de.wikipedia.org/wiki/Black-Scholes-Modell
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


From frankm60606 at gmail.com  Fri Jun 10 00:27:05 2016
From: frankm60606 at gmail.com (Frank)
Date: Thu, 9 Jun 2016 17:27:05 -0500
Subject: [R-SIG-Finance] Option pricing, basic question
In-Reply-To: <9f2d7f33e81b8677fdbf2b321bc2653a@2pimail.com>
References: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com><CEDE2EA1808446C3AA719BDC6DE4CA02@Franki7PC>
	<9f2d7f33e81b8677fdbf2b321bc2653a@2pimail.com>
Message-ID: <B586BE917F244B1E803F82FB9840E73A@Franki7PC>

Tom,

If you get some options data up for analysis, you might want to try 0
interest first and then DGS3MO second. Using DGS3MO should produce a lower
variance between the settlement and the B-S prices.

The CBOE sells market data for $3 per month per symbol. The data is
voluminous and is best loaded into a database where you can query a relevant
subset of data. For instance, all the DEC 2016 SPY Call options that have
greater than 0 volume and open interest and are out-of-the-money.

Best,

Frank
Chicago

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of thp
Sent: Thursday, June 09, 2016 11:27 AM
To: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Option pricing, basic question

Hello to all,

I noticed that indeed my questions are not truly specific to R. 
Nevertheless the code in Frank's post
was guiding to FRED which contributes to answers.

With "drift" I mistakenly meant "risk-free rate"; properly one refers to 
"drift" when meaning the overall movement of the _underlying_.

Tom


On 2016-06-09 15:42, Frank wrote:
> I use the 3-month constant maturity Treasury bill rate from FRED 
> (Federal
> Reserve Economic ??Database??) for the risk-free rate. For options with
> substantially more than 3 months until expiration, I think it makes 
> sense to
> use a maturity that best matches the option. The R code I use is:
> 
> library(quantmod)
> library(chron)
> 
> 
> ##
> ## Get DGS3MO Treasury yield from FRED
> ##
> 
> getSymbols('DGS3MO',src='FRED')
> DGS3MO<-na.locf(DGS3MO/100.0,na.rm = TRUE)
> tail(DGS3MO)
> file_name <- "DGS3MO.csv"
> write.zoo(DGS3MO, file = file_name, append = FALSE, quote = TRUE, sep = 
> ",")
> quit()
> 
> I run this text from a batch file in Windows 7 Pro 64-bit. The text in 
> the
> batch file is:
> 
> REM on Microsoft Windows (adjust the path to R.exe as needed)
> DEL *DGS3MO.csv
> 
> "C:\Program Files\R\R-3.2.2\bin\x64\R.exe" CMD BATCH
> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.txt"
> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.out"
> COPY DGS3MO.BAT DGS3MO.BAK
> COPY DGS3MO.TXT DGS3MO.TXT.BAK
> REM PAUSE
> 
> You say "r (drift)". Interest rates do move around despite the constant
> interest rate assumption of the Black-Scholes model. This could be
> characterized as drift. I'm not sure why else drift is in this post.
> Correcting for interest rate drift has not mattered in calculations 
> I've
> made.
> 
> Volatility is also assumed constant in Black-Scholes. Volatility does 
> drift
> and this is the core problem with fitting market data to the standard
> Black-Scholes model. Correctly correcting for drift might give you a 
> better
> fit to market data.
> 
> Best,
> 
> Frank
> Chicago, IL
> 
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On 
> Behalf
> Of thp
> Sent: Thursday, June 09, 2016 1:03 AM
> To: r-sig-finance at r-project.org
> Subject: [R-SIG-Finance] Option pricing, basic question
> 
> Hello,
> 
> I have a question regarding option pricing. In advance:
> thank you for the patience.
> 
> I am trying to replay the calculation of plain
> vanilla option prices using the Black-Scholes model
> (the one leading to the analytic solution seen for
> example on the wikipedia page [1]).
> 
> Using numerical values as simply obtained from
> an arbitrary broker, I am surprised to see that
> the formula values and quoted prices mismatch
> a lot. (seems cannot all be explained by spread
> or dividend details)
> 
> My question: What values for r (drift) and \sigma^2
> are usually to be used, in which units?
> 
> If numerical values are chosen to be given "per year",
> then I would expect r to be chosen as \ln(1+i),
> where i is the yearly interest rate of the risk-free
> portfolio and \ln is the natural logarithm. Would the
> risk-free rate currently be chosen as zero?
> 
> The \sigma^2 one would accordingly have to choose
> as the variance of the underlying security over
> a one year period. Should this come out equal in
> numerical value to the implied volatility, which is
> 0.2 to 0.4 for the majority of options?
> 
> Tom
> 
> [1] https://de.wikipedia.org/wiki/Black-Scholes-Modell
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From sacios at hotmail.it  Fri Jun 10 12:44:19 2016
From: sacios at hotmail.it (Sachin Kuruvithadam)
Date: Fri, 10 Jun 2016 10:44:19 +0000
Subject: [R-SIG-Finance] Dynamic copula simulation with 'rmgarch' package
Message-ID: <DB4PR06MB0685E6D020051275B830C006B7500@DB4PR06MB0685.eurprd06.prod.outlook.com>

Hi, I have 2 questions about GARCH-SPD-copula fitting.


I'm using a time-varying normal copula with DCC dynamics of the correlation structure. I use the semiparametric distribution with generalized pareto distribution, which is specified in 'cgarchspec' and controlled for in 'cgarchfit' (with thresholds at 0.05 and 0.95). After running the code similar to the example in 'rmgarch.tests' folder (adjusted for my ARMA-GARCH specification and data), 'simX[[i]]' is a Nxd matrix (N=steps ahead, d=number of assets) containing all conditional returns of the i-th simulation.


My questions:

A) Is it possible to extract the GPD parameters in this procedure, maybe from the 'cgarchfit' object, or am I supposed to estimate xi and beta separately through the 'spd' package? In this case, are these estimates the same used in the 'rmgarch' package?

B) Are the conditional returns in 'simX[[i]]' already controlled for the copula and SPD specification? i.e. are they computed following the procedure: i) given data at t, construct correlation matrix at t+1; ii) generate the (1xd) vector of correlated copula realizations m times; iii) using the inverse of the SPD obtain standardized residuals; iv) insert the latter back in the ARMA-GARCH specification and compute returns; v) repeat steps i-iv until the end of the simulation horizon?


Intuitively I would say yes to both questions, i.e. the GPD parameters used in 'rmgarch' and 'spd' are the same if they are specified the same (thresholds at 0.05 and 0.95, mle with normal kernel) and 'simX[[i]]' already runs the whole procedure mentioned above, i.e. simulates copula realizations, converts them into original realizations using the inverse CDF and feeds them in the respective ARMA-GARCH process (otherwise why do we specify the ARMA-GARCH for each series, the copula family and the transformation in 'cgarchspec' with thresholds in 'cgarchfit'?) but I've found no "official" confirmation.


Thank you in advance.

sacios

	[[alternative HTML version deleted]]


From stephen at organicfoodmarkets.com.au  Sun Jun 12 19:31:22 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Sun, 12 Jun 2016 19:31:22 +0200
Subject: [R-SIG-Finance] reqNewsBulletins
Message-ID: <5b9f1123-4b71-dbfc-2a2f-b2644f5b083c@organicfoodmarkets.com.au>

Hi

I tried this code

# newsfeed

tws <- twsConnect()

reqNewsBulletins(tws, allMsgs=TRUE)

but nothing was returned at all.

Can anyone point me to a working example?
-- 
----------------------------------------------------------------------------------------------------------------------------------- 

Stephen Choularton PhD, FIoD


From stephen at organicfoodmarkets.com.au  Mon Jun 13 18:44:01 2016
From: stephen at organicfoodmarkets.com.au (Stephen Choularton)
Date: Mon, 13 Jun 2016 18:44:01 +0200
Subject: [R-SIG-Finance] Fwd: Re: This isn't base R so it must be a package
 -- maybe IBrokers (?)... Would be good to identify it as such
In-Reply-To: <67001a31-9717-9647-0ca5-1b123548079f@organicfoodmarkets.com.au>
References: <67001a31-9717-9647-0ca5-1b123548079f@organicfoodmarkets.com.au>
Message-ID: <54a92e80-18df-9f72-60f3-1f09defa13a2@organicfoodmarkets.com.au>



Apologies - yes the code should have started with library(IBrokers)

-----------------------------------------------------------------------------------------------------------------------------------

Stephen Choularton PhD, FIoD

On 13/06/2016 4:07 PM, Steve Wisdom wrote:
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sun, 12 Jun 2016 19:31:22 +0200
> From: Stephen Choularton <stephen at organicfoodmarkets.com.au
> <mailto:stephen at organicfoodmarkets.com.au>>
> To: "r-sig-finance at r-project.org <mailto:r-sig-finance at r-project.org>"
> <r-sig-finance at r-project.org <mailto:r-sig-finance at r-project.org>>
> Subject: [R-SIG-Finance] reqNewsBulletins
> Message-ID:
>       <5b9f1123-4b71-dbfc-2a2f-b2644f5b083c at organicfoodmarkets.com.au
> <mailto:5b9f1123-4b71-dbfc-2a2f-b2644f5b083c at organicfoodmarkets.com.au>>
> Content-Type: text/plain; charset=utf-8; format=flowed
>
> Hi
>
> I tried this code
>
> # newsfeed
>
> tws <- twsConnect()
>
> reqNewsBulletins(tws, allMsgs=TRUE)
>
> but nothing was returned at all.
>
> Can anyone point me to a working example?
> --
> -----------------------------------------------------------------------------------------------------------------------------------
>
> Stephen Choularton PhD, FIoD
>
>
>
> ------------------------------


From zadig_1 at excite.com  Tue Jun 14 15:00:37 2016
From: zadig_1 at excite.com (ce)
Date: Tue, 14 Jun 2016 09:00:37 -0400
Subject: [R-SIG-Finance] Fwd: Re: This isn't base R so it must be a
	package -- maybe IBrokers (?)... Would be good to identify it
	as such
Message-ID: <20160614090037.24533@web006.roc2.bluetie.com>


You might get better help in TWS API yahoo group :

https://groups.yahoo.com/neo/groups/TWSAPI

-----Original Message-----
From: "Stephen Choularton" [stephen at organicfoodmarkets.com.au]
Date: 06/13/2016 12:44 PM
To: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: [R-SIG-Finance] Fwd: Re: This isn't base R so it must be a package
 -- maybe IBrokers (?)... Would be good to identify it as such



Apologies - yes the code should have started with library(IBrokers)

-----------------------------------------------------------------------------------------------------------------------------------

Stephen Choularton PhD, FIoD

On 13/06/2016 4:07 PM, Steve Wisdom wrote:
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sun, 12 Jun 2016 19:31:22 +0200
> From: Stephen Choularton <stephen at organicfoodmarkets.com.au
> <mailto:stephen at organicfoodmarkets.com.au>>
> To: "r-sig-finance at r-project.org <mailto:r-sig-finance at r-project.org>"
> <r-sig-finance at r-project.org <mailto:r-sig-finance at r-project.org>>
> Subject: [R-SIG-Finance] reqNewsBulletins
> Message-ID:
>       <5b9f1123-4b71-dbfc-2a2f-b2644f5b083c at organicfoodmarkets.com.au
> <mailto:5b9f1123-4b71-dbfc-2a2f-b2644f5b083c at organicfoodmarkets.com.au>>
> Content-Type: text/plain; charset=utf-8; format=flowed
>
> Hi
>
> I tried this code
>
> # newsfeed
>
> tws <- twsConnect()
>
> reqNewsBulletins(tws, allMsgs=TRUE)
>
> but nothing was returned at all.
>
> Can anyone point me to a working example?
> --
> -----------------------------------------------------------------------------------------------------------------------------------
>
> Stephen Choularton PhD, FIoD
>
>
>
> ------------------------------

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From thp at 2pimail.com  Thu Jun 16 16:45:49 2016
From: thp at 2pimail.com (thp)
Date: Thu, 16 Jun 2016 16:45:49 +0200
Subject: [R-SIG-Finance] Option pricing, basic question
In-Reply-To: <CEDE2EA1808446C3AA719BDC6DE4CA02@Franki7PC>
References: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
	<CEDE2EA1808446C3AA719BDC6DE4CA02@Franki7PC>
Message-ID: <1325f09c2ea1189957e42b4655921a98@2pimail.com>

Hello Frank / all,

the getSymbols() code written down before in relation to my option 
pricing question (see citation below)
somehow did not work with me. I got

     library(quantmod)


Version 0.4-0 included new data defaults. See ?getSymbols.
Warning messages:
1: package .quantmod. was built under R version 2.14.2
2: package .Defaults. was built under R version 2.14.2


     getSymbols('DGS3MO', verbose=TRUE,src='FRED')


     As of 0.4-0, .getSymbols. uses env=parent.frame() and
  auto.assign=TRUE by default.

   ...

trying URL 
'http://research.stlouisfed.org/fred2/series/DGS3MO/downloaddata/DGS3MO.csv'
Error in download.file(paste(FRED.URL, "/", Symbols[[i]], "/", 
"downloaddata/",  :
   cannot open URL 
'http://research.stlouisfed.org/fred2/series/DGS3MO/downloaddata/DGS3MO.csv'


This is even though I could download the data at the specified url 
manually.

~Tom

On 2016-06-09 15:42, Frank wrote:
> I use the 3-month constant maturity Treasury bill rate from FRED 
> (Federal
> Reserve Economic ??Database??) for the risk-free rate. For options with
> substantially more than 3 months until expiration, I think it makes 
> sense to
> use a maturity that best matches the option. The R code I use is:
> 
> library(quantmod)
> library(chron)
> 
> 
> ##
> ## Get DGS3MO Treasury yield from FRED
> ##
> 
> getSymbols('DGS3MO',src='FRED')
> DGS3MO<-na.locf(DGS3MO/100.0,na.rm = TRUE)
> tail(DGS3MO)
> file_name <- "DGS3MO.csv"
> write.zoo(DGS3MO, file = file_name, append = FALSE, quote = TRUE, sep = 
> ",")
> quit()
> 
> I run this text from a batch file in Windows 7 Pro 64-bit. The text in 
> the
> batch file is:
> 
> REM on Microsoft Windows (adjust the path to R.exe as needed)
> DEL *DGS3MO.csv
> 
> "C:\Program Files\R\R-3.2.2\bin\x64\R.exe" CMD BATCH
> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.txt"
> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.out"
> COPY DGS3MO.BAT DGS3MO.BAK
> COPY DGS3MO.TXT DGS3MO.TXT.BAK
> REM PAUSE
> ...


From josh.m.ulrich at gmail.com  Thu Jun 16 18:10:36 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 16 Jun 2016 11:10:36 -0500
Subject: [R-SIG-Finance] Option pricing, basic question
In-Reply-To: <1325f09c2ea1189957e42b4655921a98@2pimail.com>
References: <7ec88c2e8ba5cb302d1cf5fe580b4852@2pimail.com>
	<CEDE2EA1808446C3AA719BDC6DE4CA02@Franki7PC>
	<1325f09c2ea1189957e42b4655921a98@2pimail.com>
Message-ID: <CAPPM_gTrM09VR653tnB3-PdsMAd-a6grLShYfzz+k16yytut_Q@mail.gmail.com>

On Thu, Jun 16, 2016 at 9:45 AM, thp <thp at 2pimail.com> wrote:
> Hello Frank / all,
>
> the getSymbols() code written down before in relation to my option pricing
> question (see citation below)
> somehow did not work with me. I got
>
>     library(quantmod)
>
>
> Version 0.4-0 included new data defaults. See ?getSymbols.
> Warning messages:
> 1: package .quantmod. was built under R version 2.14.2
> 2: package .Defaults. was built under R version 2.14.2
>
>
>     getSymbols('DGS3MO', verbose=TRUE,src='FRED')
>
>
>     As of 0.4-0, .getSymbols. uses env=parent.frame() and
>  auto.assign=TRUE by default.
>
>   ...
>
> trying URL
> 'http://research.stlouisfed.org/fred2/series/DGS3MO/downloaddata/DGS3MO.csv'
> Error in download.file(paste(FRED.URL, "/", Symbols[[i]], "/",
> "downloaddata/",  :
>   cannot open URL
> 'http://research.stlouisfed.org/fred2/series/DGS3MO/downloaddata/DGS3MO.csv'
>
>
> This is even though I could download the data at the specified url manually.
>
This has been fixed for almost a year.  You need to upgrade.
https://github.com/joshuaulrich/quantmod/issues/56

> ~Tom
>
> On 2016-06-09 15:42, Frank wrote:
>>
>> I use the 3-month constant maturity Treasury bill rate from FRED (Federal
>> Reserve Economic ??Database??) for the risk-free rate. For options with
>> substantially more than 3 months until expiration, I think it makes sense
>> to
>> use a maturity that best matches the option. The R code I use is:
>>
>> library(quantmod)
>> library(chron)
>>
>>
>> ##
>> ## Get DGS3MO Treasury yield from FRED
>> ##
>>
>> getSymbols('DGS3MO',src='FRED')
>> DGS3MO<-na.locf(DGS3MO/100.0,na.rm = TRUE)
>> tail(DGS3MO)
>> file_name <- "DGS3MO.csv"
>> write.zoo(DGS3MO, file = file_name, append = FALSE, quote = TRUE, sep =
>> ",")
>> quit()
>>
>> I run this text from a batch file in Windows 7 Pro 64-bit. The text in the
>> batch file is:
>>
>> REM on Microsoft Windows (adjust the path to R.exe as needed)
>> DEL *DGS3MO.csv
>>
>> "C:\Program Files\R\R-3.2.2\bin\x64\R.exe" CMD BATCH
>> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.txt"
>> "C:\Users\Frank\Documents\R\Projects\DGS3MO\DGS3MO.out"
>> COPY DGS3MO.BAT DGS3MO.BAK
>> COPY DGS3MO.TXT DGS3MO.TXT.BAK
>> REM PAUSE
>> ...
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From sacios at hotmail.it  Wed Jun 22 19:19:21 2016
From: sacios at hotmail.it (Sachin Kuruvithadam)
Date: Wed, 22 Jun 2016 17:19:21 +0000
Subject: [R-SIG-Finance] Copula-EVT-GARCH with rmgarch package (reproducible
	code)
Message-ID: <DB4PR06MB0685B7DEF67983FC3F5B29EAB72C0@DB4PR06MB0685.eurprd06.prod.outlook.com>

I'm trying to simulate 1-step ahead returns 5000 times for a portfolio of 9 variables. After specifying their GJR-GARCH specifications with SPD marginals, I use the following code (which was inspired by the examples in the 'rmgarch.tests' folder). I use the first 571x9 observations for fitting and the last 570 for out-of-sample analysis. Moreover, I use a moving-window approach, in the sense that I always use the last 571 observations in the cgarchfilter rather than [1:(T+i)] as in the example. Once the simulated returns 'simx' are stored in 'simulatedreturns', I compute the return of an equally-weighted portfolio as a 570x5000 vector, i.e. one series of return of each observation for each simulation. Last, I compute VaR (90%, 95%, 99%) as the respective quantile (0.10, 0.05, 0.01).


My problem is that, contrary to the literature I've found on the topic, VaR is severely underestimated, I obtain a number of violations which is way more than expected (should be 57 for 90%VaR, 28 for 95%VaR, 6 for 99%VaR). Is there any error in the code I have below? I've followed the example by the letter and cannot understand what went wrong. Anyone can help? Any hint is GREATLY appreciated!


library(rugarch)
library(rmgarch)

data(dji30retw)
Dat = dji30retw[, 1:9, drop = FALSE]

model <- ugarchspec(variance.model=list(model="gjrGARCH", garchOrder=c(1,1), variance.targeting=TRUE),
                    mean.model=list(armaOrder=c(0,0), include.mean=F, archm=F, archpow=1),
                    distribution.model="norm")
spec = cgarchspec(uspec = multispec(replicate(3, model)), VAR = FALSE, robust = FALSE,
                    lag.criterion = "AIC", external.regressors = NULL,
                    dccOrder = c(1,1), asymmetric = TRUE, distribution.model = list(copula = "mvt",
                                                                                     method = "ML", time.varying = TRUE,
                                                                                     transformation = "spd"))
fit = cgarchfit(spec, data = Dat, out.sample = 570, cluster = NULL,
                  fit.control = list(eval.se=FALSE))
T = dim(Dat)[1]-570
simMu = simS = filtMu = filtS = matrix(NA, ncol = 9, nrow = 570)
simCor = simC = filtC = filtCor = array(NA, dim = c(9,9,570))
colSd = function(x) apply(x, 2, "sd")
specx = spec
for(i in 1:9) specx at umodel$fixed.pars[[i]] = as.list(fit at model$mpars[fit at model$midx[,i]==1,i])
setfixed(specx)<-as.list(fit at model$mpars[fit at model$midx[,10]==1,10])

simulatedreturns <- array(dim=c(570,9,5000))
for(i in 1:570){
  if(i==1){
    presigma = matrix(tail(sigma(fit), 1), ncol = 9)
    prereturns = matrix(unlist(Dat[T, ]), ncol = 9, nrow = 1)
    preresiduals = matrix(tail(residuals(fit),1), ncol = 9, nrow = 1)
    preR = last(rcor(fit))[,,1]
    diag(preR) = 1
    preQ = fit at mfit$Qt[[length(fit at mfit$Qt)]]
    preZ = tail(fit at mfit$Z, 1)
    tmp = cgarchfilter(specx, Dat[2:(T+1), ], filter.control = list(n.old = T))
    filtMu[i,] = tail(fitted(tmp), 1)
    filtS[i,] = tail(sigma(tmp), 1)
    filtC[,,i] = last(rcov(tmp))[,,1]
    filtCor[,,i] = last(rcor(tmp))[,,1]
  } else{
    presigma = matrix(tail(sigma(tmp), 1), ncol = 9)
    prereturns = matrix(unlist(Dat[(T+i-1), ]), ncol = 9, nrow = 1)
    preresiduals = matrix(tail(residuals(tmp),1), ncol = 9, nrow = 1)
    preR = last(rcor(tmp))[,,1]
    diag(preR) = 1
    preQ = tmp at mfilter$Qt[[length(tmp at mfilter$Qt)]]
    preZ = tail(tmp at mfilter$Z, 1)

    tmp = cgarchfilter(specx17, Dat[(i+1):(T+i), ], filter.control = list(n.old = T))
    filtMu[i,] = tail(fitted(tmp), 1)
    filtS[i,] = tail(sigma(tmp), 1)
    filtC[,,i] = last(rcov(tmp))[,,1]
    filtCor[,,i] = last(rcor(tmp))[,,1]
  }
  sim = cgarchsim(fit, n.sim = 1, m.sim = 5000, startMethod = "sample", preR = preR, preQ = preQ, preZ = preZ,
                    prereturns = prereturns, presigma = presigma, preresiduals = preresiduals, cluster = NULL)
  simx = t(sapply(sim at msim$simX, FUN = function(x) x[1,]))
  simMu[i,] = colMeans(simx)
  simC[,,i] = sim at msim$simH[[1]][,,1]
  simCor[,,i] = sim at msim$simR[[1]][,,1]
  simS[i,] = sqrt(diag(simC[,,i]))
  simulatedreturns[i,,]=simx
}



	[[alternative HTML version deleted]]


From sacios at hotmail.it  Wed Jun 22 21:36:20 2016
From: sacios at hotmail.it (Sachin Kuruvithadam)
Date: Wed, 22 Jun 2016 19:36:20 +0000
Subject: [R-SIG-Finance] dynamic copula using rmgarch package (ignore
 previous question, don't know how to delete it)
Message-ID: <DB4PR06MB068586F59ED7534C53264E64B72C0@DB4PR06MB0685.eurprd06.prod.outlook.com>

(there were some mistakes in the previous code, I've corrected it and I'm reposting)


I'm trying to simulate 1-step ahead returns 5000 times for a portfolio of 9 variables. After specifying their GJR-GARCH specifications with SPD marginals, I use the following code (which was inspired by the examples in the 'rmgarch.tests' folder). I use the first 571x9 observations for fitting and the last 570 for out-of-sample analysis. Moreover, I use a moving-window approach, in the sense that I always use the last 571 observations in the cgarchfilter rather than [1:(T+i)] as in the example. Once the simulated returns 'simx' are stored in 'simulatedreturns', I compute the return of an equally-weighted portfolio as a 570x5000 matrix, i.e. one series of return of each observation for each simulation. Last, I compute VaR (90%, 95%, 99%) as the respective quantile (0.10, 0.05, 0.01).


My problem is that, contrary to the literature I've found on the topic, VaR is severely underestimated, I obtain a number of violations which is way more than expected (should be 57 for 90%VaR, 28 for 95%VaR, 6 for 99%VaR). Is there any error in the code I have below? I've followed the example by the letter and cannot understand what went wrong. Anyone can help? Any hint is GREATLY appreciated!


library(rugarch)
library(rmgarch)

data(dji30retw)
Dat = dji30retw[, 1:9, drop = FALSE]

model <- ugarchspec(variance.model=list(model="gjrGARCH", garchOrder=c(1,1), variance.targeting=TRUE),
                    mean.model=list(armaOrder=c(0,0), include.mean=F, archm=F, archpow=1),
                    distribution.model="norm")
spec = cgarchspec(uspec = multispec(replicate(9, model)), VAR = FALSE, robust = FALSE,
                    lag.criterion = "AIC", external.regressors = NULL,
                    dccOrder = c(1,1), asymmetric = TRUE, distribution.model = list(copula = "mvt",
                                                                                     method = "ML", time.varying = TRUE,
                                                                                     transformation = "spd"))
fit = cgarchfit(spec, data = Dat, out.sample = 570, cluster = NULL, spd.control = list(lower = 0.1, upper = 0.9, type = "mle", kernel = "normal"),
                  fit.control = list(eval.se=FALSE))
T = dim(Dat)[1]-570
simMu = simS = filtMu = filtS = matrix(NA, ncol = 9, nrow = 570)
simCor = simC = filtC = filtCor = array(NA, dim = c(9,9,570))
colSd = function(x) apply(x, 2, "sd")
specx = spec
for(i in 1:9) specx at umodel$fixed.pars[[i]] = as.list(fit at model$mpars[fit at model$midx[,i]==1,i])
setfixed(specx)<-as.list(fit at model$mpars[fit at model$midx[,10]==1,10])

simulatedreturns <- array(dim=c(570,9,5000))
for(i in 1:570){
  if(i==1){
    presigma = matrix(tail(sigma(fit), 1), ncol = 9)
    prereturns = matrix(unlist(Dat[T, ]), ncol = 9, nrow = 1)
    preresiduals = matrix(tail(residuals(fit),1), ncol = 9, nrow = 1)
    preR = last(rcor(fit))[,,1]
    diag(preR) = 1
    preQ = fit at mfit$Qt[[length(fit at mfit$Qt)]]
    preZ = tail(fit at mfit$Z, 1)
    tmp = cgarchfilter(specx, Dat[2:(T+1), ], filter.control = list(n.old = T))
    filtMu[i,] = tail(fitted(tmp), 1)
    filtS[i,] = tail(sigma(tmp), 1)
    filtC[,,i] = last(rcov(tmp))[,,1]
    filtCor[,,i] = last(rcor(tmp))[,,1]
  } else{
    presigma = matrix(tail(sigma(tmp), 1), ncol = 9)
    prereturns = matrix(unlist(Dat[(T+i-1), ]), ncol = 9, nrow = 1)
    preresiduals = matrix(tail(residuals(tmp),1), ncol = 9, nrow = 1)
    preR = last(rcor(tmp))[,,1]
    diag(preR) = 1
    preQ = tmp at mfilter$Qt[[length(tmp at mfilter$Qt)]]
    preZ = tail(tmp at mfilter$Z, 1)

    tmp = cgarchfilter(specx, Dat[(i+1):(T+i), ], filter.control = list(n.old = T))
    filtMu[i,] = tail(fitted(tmp), 1)
    filtS[i,] = tail(sigma(tmp), 1)
    filtC[,,i] = last(rcov(tmp))[,,1]
    filtCor[,,i] = last(rcor(tmp))[,,1]
  }
  sim = cgarchsim(fit, n.sim = 1, m.sim = 5000, startMethod = "sample", preR = preR, preQ = preQ, preZ = preZ,
                    prereturns = prereturns, presigma = presigma, preresiduals = preresiduals, cluster = NULL)
  simx = t(sapply(sim at msim$simX, FUN = function(x) x[1,]))
  simMu[i,] = colMeans(simx)
  simC[,,i] = sim at msim$simH[[1]][,,1]
  simCor[,,i] = sim at msim$simR[[1]][,,1]
  simS[i,] = sqrt(diag(simC[,,i]))
  simulatedreturns[i,,]=simx
}

	[[alternative HTML version deleted]]


From rbali at ufmg.br  Thu Jun 23 21:02:23 2016
From: rbali at ufmg.br (Robert Iquiapaza)
Date: Thu, 23 Jun 2016 16:02:23 -0300
Subject: [R-SIG-Finance] dynamic copula using rmgarch package (ignore
 previous question, don't know how to delete it)
In-Reply-To: <OF5063C9DA.102B45F9-ON83257FDA.006BD8A8@grude.ufmg.br>
References: <OF5063C9DA.102B45F9-ON83257FDA.006BD8A8@grude.ufmg.br>
Message-ID: <CAKW5Cfqt5Q5aPmCAsCE+XJWB=72Xq57CAE6qcve1C0DbHfto5A@mail.gmail.com>

Could you show how are you computing the return of an equally-weighted
portfolio and the VaR?
Robert

2016-06-22 16:36 GMT-03:00 Sachin Kuruvithadam <sacios at hotmail.it>:

> (there were some mistakes in the previous code, I've corrected it and I'm
> reposting)
>
>
> I'm trying to simulate 1-step ahead returns 5000 times for a portfolio of
> 9 variables. After specifying their GJR-GARCH specifications with SPD
> marginals, I use the following code (which was inspired by the examples in
> the 'rmgarch.tests' folder). I use the first 571x9 observations for fitting
> and the last 570 for out-of-sample analysis. Moreover, I use a
> moving-window approach, in the sense that I always use the last 571
> observations in the cgarchfilter rather than [1:(T+i)] as in the example.
> Once the simulated returns 'simx' are stored in 'simulatedreturns', I
> compute the return of an equally-weighted portfolio as a 570x5000 matrix,
> i.e. one series of return of each observation for each simulation. Last, I
> compute VaR (90%, 95%, 99%) as the respective quantile (0.10, 0.05, 0.01).
>
>
> My problem is that, contrary to the literature I've found on the topic,
> VaR is severely underestimated, I obtain a number of violations which is
> way more than expected (should be 57 for 90%VaR, 28 for 95%VaR, 6 for
> 99%VaR). Is there any error in the code I have below? I've followed the
> example by the letter and cannot understand what went wrong. Anyone can
> help? Any hint is GREATLY appreciated!
>
>
> library(rugarch)
> library(rmgarch)
>
> data(dji30retw)
> Dat = dji30retw[, 1:9, drop = FALSE]
>
> model <- ugarchspec(variance.model=list(model="gjrGARCH",
> garchOrder=c(1,1), variance.targeting=TRUE),
>                     mean.model=list(armaOrder=c(0,0), include.mean=F,
> archm=F, archpow=1),
>                     distribution.model="norm")
> spec = cgarchspec(uspec = multispec(replicate(9, model)), VAR = FALSE,
> robust = FALSE,
>                     lag.criterion = "AIC", external.regressors = NULL,
>                     dccOrder = c(1,1), asymmetric = TRUE,
> distribution.model = list(copula = "mvt",
>
>            method = "ML", time.varying = TRUE,
>
>            transformation = "spd"))
> fit = cgarchfit(spec, data = Dat, out.sample = 570, cluster = NULL,
> spd.control = list(lower = 0.1, upper = 0.9, type = "mle", kernel =
> "normal"),
>                   fit.control = list(eval.se=FALSE))
> T = dim(Dat)[1]-570
> simMu = simS = filtMu = filtS = matrix(NA, ncol = 9, nrow = 570)
> simCor = simC = filtC = filtCor = array(NA, dim = c(9,9,570))
> colSd = function(x) apply(x, 2, "sd")
> specx = spec
> for(i in 1:9) specx at umodel$fixed.pars[[i]] = as.list(fit at model
> $mpars[fit at model$midx[,i]==1,i])
> setfixed(specx)<-as.list(fit at model$mpars[fit at model$midx[,10]==1,10])
>
> simulatedreturns <- array(dim=c(570,9,5000))
> for(i in 1:570){
>   if(i==1){
>     presigma = matrix(tail(sigma(fit), 1), ncol = 9)
>     prereturns = matrix(unlist(Dat[T, ]), ncol = 9, nrow = 1)
>     preresiduals = matrix(tail(residuals(fit),1), ncol = 9, nrow = 1)
>     preR = last(rcor(fit))[,,1]
>     diag(preR) = 1
>     preQ = fit at mfit$Qt[[length(fit at mfit$Qt)]]
>     preZ = tail(fit at mfit$Z, 1)
>     tmp = cgarchfilter(specx, Dat[2:(T+1), ], filter.control = list(n.old
> = T))
>     filtMu[i,] = tail(fitted(tmp), 1)
>     filtS[i,] = tail(sigma(tmp), 1)
>     filtC[,,i] = last(rcov(tmp))[,,1]
>     filtCor[,,i] = last(rcor(tmp))[,,1]
>   } else{
>     presigma = matrix(tail(sigma(tmp), 1), ncol = 9)
>     prereturns = matrix(unlist(Dat[(T+i-1), ]), ncol = 9, nrow = 1)
>     preresiduals = matrix(tail(residuals(tmp),1), ncol = 9, nrow = 1)
>     preR = last(rcor(tmp))[,,1]
>     diag(preR) = 1
>     preQ = tmp at mfilter$Qt[[length(tmp at mfilter$Qt)]]
>     preZ = tail(tmp at mfilter$Z, 1)
>
>     tmp = cgarchfilter(specx, Dat[(i+1):(T+i), ], filter.control =
> list(n.old = T))
>     filtMu[i,] = tail(fitted(tmp), 1)
>     filtS[i,] = tail(sigma(tmp), 1)
>     filtC[,,i] = last(rcov(tmp))[,,1]
>     filtCor[,,i] = last(rcor(tmp))[,,1]
>   }
>   sim = cgarchsim(fit, n.sim = 1, m.sim = 5000, startMethod = "sample",
> preR = preR, preQ = preQ, preZ = preZ,
>                     prereturns = prereturns, presigma = presigma,
> preresiduals = preresiduals, cluster = NULL)
>   simx = t(sapply(sim at msim$simX, FUN = function(x) x[1,]))
>   simMu[i,] = colMeans(simx)
>   simC[,,i] = sim at msim$simH[[1]][,,1]
>   simCor[,,i] = sim at msim$simR[[1]][,,1]
>   simS[i,] = sqrt(diag(simC[,,i]))
>   simulatedreturns[i,,]=simx
> }
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>

	[[alternative HTML version deleted]]


From sacios at hotmail.it  Thu Jun 23 23:07:39 2016
From: sacios at hotmail.it (Sachin Kuruvithadam)
Date: Thu, 23 Jun 2016 21:07:39 +0000
Subject: [R-SIG-Finance] dynamic copula using rmgarch package (ignore
 previous question, don't know how to delete it)
In-Reply-To: <CAKW5Cfqt5Q5aPmCAsCE+XJWB=72Xq57CAE6qcve1C0DbHfto5A@mail.gmail.com>
References: <OF5063C9DA.102B45F9-ON83257FDA.006BD8A8@grude.ufmg.br>,
	<CAKW5Cfqt5Q5aPmCAsCE+XJWB=72Xq57CAE6qcve1C0DbHfto5A@mail.gmail.com>
Message-ID: <DB4PR06MB06853A9FDBAEAA8D863AAA45B72D0@DB4PR06MB0685.eurprd06.prod.outlook.com>

Hi Robert, thank you for your reply (I apologize in advance if this is not the proper way to respond in the thread, I'm very new at this).


i) Portfolio return is computed as equal-weighted sum of the nine series. Since in the examples in the 'rmgarchtests' folder these are directly used in the GARCH-GPD-copula specification, I assume these are log returns, and therefore transform them into simple daily returns since log returns are time-additive but not "portfolio"-additive;

ii) In 'simulatedreturns' I have 570 predicted returns for 9 series simulated 5000 times. Like before, I first transform them in simple returns;

iii) the simulated portfolio returns are then computed as before, as equal-weighted sum since simple returns are additive across assets;

iv) for VaR estimation I don't using anything fancy, just the 'quantile' function. For each observation, I estimate the respective simulated quantile and subtract the actual return from it, and store the difference in vector 'a'. If 'a' is negative (meaning VaR is greater in absolute terms than returns) then 'b' equals 0, if 'a' is positive then 'b'=1.


Since I haven't fixed the random number seed, it is possible that you obtain slightly different results. But the number of violations should be the approximately the same as mine, and nowhere close to the number expected.


This is the rest of the code, with comments reported above.


You have an idea what could have gone wrong?


#comment i)
#from log to simple returns
Simple = exp(Dat)-1

#return of equally weighted portfolio as weighted sum
portfolioreturn <- (1/9)*rowSums(Simple)
#since I'm only interested in returns in the testing period, I only take the last 570 observations
portfolioreturn <- portfolioreturn[572:1141] #we're only interested in returns in the testing period

#comment ii)
#transform simulated log returns into simple returns
simplereturns=exp(simulatedreturns)-1

#comment iii)
#return series of simulated portfolio (for each observation from 1 to 570 I have 5000 portfolio returns)
portfolio <- matrix(nrow=570,ncol=5000)
for (i in 1:570){
  for (j in 1:5000){
    portfolio[i,j]=(1/9)*(simplereturns[i,1,j]+simplereturns[i,2,j]+simplereturns[i,3,j]+simplereturns[i,4,j]
                         +simplereturns[i,5,j]+simplereturns[i,6,j]+simplereturns[i,7,j]+simplereturns[i,8,j]
                         +simplereturns[i,9,j])
  }
}

#comment iv)
#estimation of 90%, 95% and 99% VaR as respective 10%, 5% and 1% quantiles
#a is a vector containing the difference between quantile and actual loss
#b is a vector equal to 0 when a is negative (as it should) and 1 when loss is greater than VaR (thus when a is positive)
#number of violations is then computed as sum(b), summing all ones;
a90 <- c()
for (i in 1:570){
  a90[i]=quantile(portfolio[i,],0.1)-portfolioreturn[i]
}
b90 <- c()
for (i in 1:570){
  if (a90[i]>0){b90[i]=1}
  else {b90[i]=0}
}
sum(b90)#number of violations=171 (expected: 570*0.1=57)

a95 <- c()
for (i in 1:570){
  a95[i]=quantile(portfolio[i,],0.05)-portfolioreturn[i]
}
b95 <- c()
for (i in 1:570){
  if (a95[i]>0){b95[i]=1}
  else {b95[i]=0}
}
sum(b95)#number of violations=127 (expected: 570*0.05=29)

a99 <- c()
for (i in 1:570){
  a99[i]=quantile(portfolio[i,],0.01)-portfolioreturn[i]
}
b99 <- c()
for (i in 1:570){
  if (a99[i]>0){b99[i]=1}
  else {b99[i]=0}
}
sum(b99) #number of violations=69 (expected: 570*0.01=6)







________________________________
Da: Robert Iquiapaza <rbali at ufmg.br>
Inviato: gioved? 23 giugno 2016 21.02
A: Sachin Kuruvithadam
Cc: r-sig-finance at r-project.org
Oggetto: Re: [R-SIG-Finance] dynamic copula using rmgarch package (ignore previous question, don't know how to delete it)

Could you show how are you computing the return of an equally-weighted portfolio and the VaR?
Robert

2016-06-22 16:36 GMT-03:00 Sachin Kuruvithadam <sacios at hotmail.it<mailto:sacios at hotmail.it>>:
(there were some mistakes in the previous code, I've corrected it and I'm reposting)


I'm trying to simulate 1-step ahead returns 5000 times for a portfolio of 9 variables. After specifying their GJR-GARCH specifications with SPD marginals, I use the following code (which was inspired by the examples in the 'rmgarch.tests' folder). I use the first 571x9 observations for fitting and the last 570 for out-of-sample analysis. Moreover, I use a moving-window approach, in the sense that I always use the last 571 observations in the cgarchfilter rather than [1:(T+i)] as in the example. Once the simulated returns 'simx' are stored in 'simulatedreturns', I compute the return of an equally-weighted portfolio as a 570x5000 matrix, i.e. one series of return of each observation for each simulation. Last, I compute VaR (90%, 95%, 99%) as the respective quantile (0.10, 0.05, 0.01).


My problem is that, contrary to the literature I've found on the topic, VaR is severely underestimated, I obtain a number of violations which is way more than expected (should be 57 for 90%VaR, 28 for 95%VaR, 6 for 99%VaR). Is there any error in the code I have below? I've followed the example by the letter and cannot understand what went wrong. Anyone can help? Any hint i[[elided Hotmail spam]]


library(rugarch)
library(rmgarch)

data(dji30retw)
Dat = dji30retw[, 1:9, drop = FALSE]

model <- ugarchspec(variance.model=list(model="gjrGARCH", garchOrder=c(1,1), variance.targeting=TRUE),
                    mean.model=list(armaOrder=c(0,0), include.mean=F, archm=F, archpow=1),
                    distribution.model="norm")
spec = cgarchspec(uspec = multispec(replicate(9, model)), VAR = FALSE, robust = FALSE,
                    lag.criterion = "AIC", external.regressors = NULL,
                    dccOrder = c(1,1), asymmetric = TRUE, distribution.model = list(copula = "mvt",
                                                                                     method = "ML", time.varying = TRUE,
                                                                                     transformation = "spd"))
fit = cgarchfit(spec, data = Dat, out.sample = 570, cluster = NULL, spd.control = list(lower = 0.1, upper = 0.9, type = "mle", kernel = "normal"),
                  fit.control = list(eval.se<http://eval.se>=FALSE))
T = dim(Dat)[1]-570
simMu = simS = filtMu = filtS = matrix(NA, ncol = 9, nrow = 570)
simCor = simC = filtC = filtCor = array(NA, dim = c(9,9,570))
colSd = function(x) apply(x, 2, "sd")
specx = spec
for(i in 1:9) specx at umodel$fixed.pars[[i]] = as.list(fit at model$mpars[fit at model$midx[,i]==1,i])
setfixed(specx)<-as.list(fit at model$mpars[fit at model$midx[,10]==1,10])

simulatedreturns <- array(dim=c(570,9,5000))
for(i in 1:570){
  if(i==1){
    presigma = matrix(tail(sigma(fit), 1), ncol = 9)
    prereturns = matrix(unlist(Dat[T, ]), ncol = 9, nrow = 1)
    preresiduals = matrix(tail(residuals(fit),1), ncol = 9, nrow = 1)
    preR = last(rcor(fit))[,,1]
    diag(preR) = 1
    preQ = fit at mfit$Qt[[length(fit at mfit$Qt)]]
    preZ = tail(fit at mfit$Z, 1)
    tmp = cgarchfilter(specx, Dat[2:(T+1), ], filter.control = list(n.old = T))
    filtMu[i,] = tail(fitted(tmp), 1)
    filtS[i,] = tail(sigma(tmp), 1)
    filtC[,,i] = last(rcov(tmp))[,,1]
    filtCor[,,i] = last(rcor(tmp))[,,1]
  } else{
    presigma = matrix(tail(sigma(tmp), 1), ncol = 9)
    prereturns = matrix(unlist(Dat[(T+i-1), ]), ncol = 9, nrow = 1)
    preresiduals = matrix(tail(residuals(tmp),1), ncol = 9, nrow = 1)
    preR = last(rcor(tmp))[,,1]
    diag(preR) = 1
    preQ = tmp at mfilter$Qt[[length(tmp at mfilter$Qt)]]
    preZ = tail(tmp at mfilter$Z, 1)

    tmp = cgarchfilter(specx, Dat[(i+1):(T+i), ], filter.control = list(n.old = T))
    filtMu[i,] = tail(fitted(tmp), 1)
    filtS[i,] = tail(sigma(tmp), 1)
    filtC[,,i] = last(rcov(tmp))[,,1]
    filtCor[,,i] = last(rcor(tmp))[,,1]
  }
  sim = cgarchsim(fit, n.sim = 1, m.sim = 5000, startMethod = "sample", preR = preR, preQ = preQ, preZ = preZ,
                    prereturns = prereturns, presigma = presigma, preresiduals = preresiduals, cluster = NULL)
  simx = t(sapply(sim at msim$simX, FUN = function(x) x[1,]))
  simMu[i,] = colMeans(simx)
  simC[,,i] = sim at msim$simH[[1]][,,1]
  simCor[,,i] = sim at msim$simR[[1]][,,1]
  simS[i,] = sqrt(diag(simC[,,i]))
  simulatedreturns[i,,]=simx
}

        [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org<mailto:R-SIG-Finance at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.



	[[alternative HTML version deleted]]


From pankajsbi at yahoo.com  Sun Jun 26 14:53:02 2016
From: pankajsbi at yahoo.com (Pankaj K Agarwal)
Date: Sun, 26 Jun 2016 12:53:02 +0000 (UTC)
Subject: [R-SIG-Finance] Imputing Missing Values
References: <1287945331.1344273.1466945582322.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>

This might be a very basic query for this erudite group. However, i am hopeful some help will be forthcoming nevertheless.I have a monthly time series of annualized t-bill rates on Indian markets. For some months, the values are missing randomly. I need to convert the annualized yields into daily as well as monthly yields. I have two questions:1. I am using package zoo. Which of the methods of NA imputations will be advisable for this series, viz., na.agggregate, na.locf, na.spline or na.approx etc.?2. Should the imputation be done on monthly annual yields and then the conversion to daily and monthly yields be performed or imputation be done afterwards?3. Are there better methods than above for this task?
I will be extremely grateful for comments. Thanks a ton.?Regards,Pankaj
	[[alternative HTML version deleted]]


From pankajsbi at yahoo.com  Sun Jun 26 14:53:02 2016
From: pankajsbi at yahoo.com (Pankaj K Agarwal)
Date: Sun, 26 Jun 2016 12:53:02 +0000
Subject: [R-SIG-Finance] Imputing Missing Values
References: <1287945331.1344273.1466945582322.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>

This might be a very basic query for this erudite group. However, i am hopeful some help will be forthcoming nevertheless.I have a monthly time series of annualized t-bill rates on Indian markets. For some months, the values are missing randomly. I need to convert the annualized yields into daily as well as monthly yields. I have two questions:1. I am using package zoo. Which of the methods of NA imputations will be advisable for this series, viz., na.agggregate, na.locf, na.spline or na.approx etc.?2. Should the imputation be done on monthly annual yields and then the conversion to daily and monthly yields be performed or imputation be done afterwards?3. Are there better methods than above for this task?
I will be extremely grateful for comments. Thanks a ton.?Regards,Pankaj
	[[alternative HTML version deleted]]


From frankm60606 at gmail.com  Sun Jun 26 15:09:39 2016
From: frankm60606 at gmail.com (Frank)
Date: Sun, 26 Jun 2016 08:09:39 -0500
Subject: [R-SIG-Finance] Imputing Missing Values
In-Reply-To: <1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
References: <1287945331.1344273.1466945582322.JavaMail.yahoo.ref@mail.yahoo.com>
	<1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <F1AB03BCD08A42D9A1FF87BF9C3702BE@Franki7PC>

1)

I use na.locf to replace NAs from FRED. I believe na.rm=TRUE means next
observation is carried backward: 

library(quantmod)
library(chron)


##
## Get DGS3MO Treasury yield from FRED
##

getSymbols('DGS3MO',src='FRED')
DGS3MO<-na.locf(DGS3MO/100.0,na.rm = TRUE)
tail(DGS3MO)
file_name <- "DGS3MO.csv"
write.zoo(DGS3MO, file = file_name, append = FALSE, quote = TRUE, sep = ",")
quit()

2)

Would you be so kind as to show what you are currently using to imply
yields? And what is your intended use for the implied daily/monthly data.

Thanks,

Frank
Chicago
-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of Pankaj K Agarwal via R-SIG-Finance
Sent: Sunday, June 26, 2016 7:53 AM
To: R-sig-finance; R-Finance
Subject: [R-SIG-Finance] Imputing Missing Values

This might be a very basic query for this erudite group. However, i am
hopeful some help will be forthcoming nevertheless.I have a monthly time
series of annualized t-bill rates on Indian markets. For some months, the
values are missing randomly. I need to convert the annualized yields into
daily as well as monthly yields. I have two questions:1. I am using package
zoo. Which of the methods of NA imputations will be advisable for this
series, viz., na.agggregate, na.locf, na.spline or na.approx etc.?2. Should
the imputation be done on monthly annual yields and then the conversion to
daily and monthly yields be performed or imputation be done afterwards?3.
Are there better methods than above for this task?
I will be extremely grateful for comments. Thanks a ton.?Regards,Pankaj
	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From brian at braverock.com  Sun Jun 26 15:16:41 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 26 Jun 2016 08:16:41 -0500
Subject: [R-SIG-Finance] Imputing Missing Values
In-Reply-To: <1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
References: <1287945331.1344273.1466945582322.JavaMail.yahoo.ref@mail.yahoo.com>
	<1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <1466947001.16865.205.camel@brian-rcg>

On Sun, 2016-06-26 at 12:53 +0000, Pankaj K Agarwal via R-SIG-Finance
wrote:
> This might be a very basic query for this erudite group. However, i am
> hopeful some help will be forthcoming nevertheless.I have a monthly
> time series of annualized t-bill rates on Indian markets. For some
> months, the values are missing randomly. I need to convert the
> annualized yields into daily as well as monthly yields. I have two
> questions:1. I am using package zoo. Which of the methods of NA
> imputations will be advisable for this series, viz., na.agggregate,
> na.locf, na.spline or na.approx etc.?2. Should the imputation be done
> on monthly annual yields and then the conversion to daily and monthly
> yields be performed or imputation be done afterwards?3. Are there
> better methods than above for this task? I will be extremely grateful
> for comments. Thanks a ton. Regards,Pankaj 	

The short answer is: Don't do it.  This is a bad idea.

You need to find a better source of data.  Daily data on Indian 3-mo
bill yields is widely available from free sources.  See, e.g.

http://www.investing.com/rates-bonds/india-3-month-bond-yield

There are many other sources of this data as well, I have no opinion on
the data quality of one over the other, but *any* of them would likely
be orders of magnitude better than what you're asking to do.

You can't impute from lower-frequency data to higher frequency data with
any confidence.  

These NA imputation methods are designed to fill some occasionally
missing data, or to do something like Last Observation Carried Forward
on Bid/Ask spreads (which is not imputation at all, since that is the
prevailing market). 

Basically, it always makes sense to start with the highest frequency
data available, and aggregate to lower frequencies.  In the case of your
query, start with the spot yield and do whatever adjustments you need.

Regards,

Brian


From brian at braverock.com  Sun Jun 26 15:16:41 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 26 Jun 2016 08:16:41 -0500
Subject: [R-SIG-Finance] Imputing Missing Values
In-Reply-To: <1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
References: <1287945331.1344273.1466945582322.JavaMail.yahoo.ref@mail.yahoo.com>
	<1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <1466947001.16865.205.camel@brian-rcg>

On Sun, 2016-06-26 at 12:53 +0000, Pankaj K Agarwal via R-SIG-Finance
wrote:
> This might be a very basic query for this erudite group. However, i am
> hopeful some help will be forthcoming nevertheless.I have a monthly
> time series of annualized t-bill rates on Indian markets. For some
> months, the values are missing randomly. I need to convert the
> annualized yields into daily as well as monthly yields. I have two
> questions:1. I am using package zoo. Which of the methods of NA
> imputations will be advisable for this series, viz., na.agggregate,
> na.locf, na.spline or na.approx etc.?2. Should the imputation be done
> on monthly annual yields and then the conversion to daily and monthly
> yields be performed or imputation be done afterwards?3. Are there
> better methods than above for this task? I will be extremely grateful
> for comments. Thanks a ton. Regards,Pankaj 	

The short answer is: Don't do it.  This is a bad idea.

You need to find a better source of data.  Daily data on Indian 3-mo
bill yields is widely available from free sources.  See, e.g.

http://www.investing.com/rates-bonds/india-3-month-bond-yield

There are many other sources of this data as well, I have no opinion on
the data quality of one over the other, but *any* of them would likely
be orders of magnitude better than what you're asking to do.

You can't impute from lower-frequency data to higher frequency data with
any confidence.  

These NA imputation methods are designed to fill some occasionally
missing data, or to do something like Last Observation Carried Forward
on Bid/Ask spreads (which is not imputation at all, since that is the
prevailing market). 

Basically, it always makes sense to start with the highest frequency
data available, and aggregate to lower frequencies.  In the case of your
query, start with the spot yield and do whatever adjustments you need.

Regards,

Brian


From pankajsbi at yahoo.com  Sun Jun 26 15:22:04 2016
From: pankajsbi at yahoo.com (Pankaj K Agarwal)
Date: Sun, 26 Jun 2016 13:22:04 +0000 (UTC)
Subject: [R-SIG-Finance] Imputing Missing Values
In-Reply-To: <F1AB03BCD08A42D9A1FF87BF9C3702BE@Franki7PC>
References: <1287945331.1344273.1466945582322.JavaMail.yahoo.ref@mail.yahoo.com>
	<1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
	<F1AB03BCD08A42D9A1FF87BF9C3702BE@Franki7PC>
Message-ID: <304720112.1361833.1466947324160.JavaMail.yahoo@mail.yahoo.com>

Dear FrankSo kind of you to have replied. Thanks.I am conducting an academic research on mutual funds. I am modelling fund returns on daily as well as monthly frequencies. The model uses zero investment strategy returns (fund/portfolio returns minus risk free rate) as variables. For risk free rates i have good quality 91-day t-bill rates available. But it appeared that using 91-day risk free rate with daily fund returns is not a very good idea, and i needed to search t-bill rates of lesser maturity.?So, in India next lower maturity available is 14-day t-bill, but there are missing values for some months in the monthly series of annualized rates. For example, in some years, data for 3 months running is missing.?Hope i could convey the problem.
Will na.locf be a good idea in this case? Also, if i use 91-day rates with daily fund returns, will it matter much?Kindly advise.
?Regards,Pankaj

 

    On Sunday, 26 June 2016 6:39 PM, Frank <frankm60606 at gmail.com> wrote:
 
 

 1)

I use na.locf to replace NAs from FRED. I believe na.rm=TRUE means next
observation is carried backward: 

library(quantmod)
library(chron)


##
## Get DGS3MO Treasury yield from FRED
##

getSymbols('DGS3MO',src='FRED')
DGS3MO<-na.locf(DGS3MO/100.0,na.rm = TRUE)
tail(DGS3MO)
file_name <- "DGS3MO.csv"
write.zoo(DGS3MO, file = file_name, append = FALSE, quote = TRUE, sep = ",")
quit()

2)

Would you be so kind as to show what you are currently using to imply
yields? And what is your intended use for the implied daily/monthly data.

Thanks,

Frank
Chicago
-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of Pankaj K Agarwal via R-SIG-Finance
Sent: Sunday, June 26, 2016 7:53 AM
To: R-sig-finance; R-Finance
Subject: [R-SIG-Finance] Imputing Missing Values

This might be a very basic query for this erudite group. However, i am
hopeful some help will be forthcoming nevertheless.I have a monthly time
series of annualized t-bill rates on Indian markets. For some months, the
values are missing randomly. I need to convert the annualized yields into
daily as well as monthly yields. I have two questions:1. I am using package
zoo. Which of the methods of NA imputations will be advisable for this
series, viz., na.agggregate, na.locf, na.spline or na.approx etc.?2. Should
the imputation be done on monthly annual yields and then the conversion to
daily and monthly yields be performed or imputation be done afterwards?3.
Are there better methods than above for this task?
I will be extremely grateful for comments. Thanks a ton.?Regards,Pankaj
??? [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.



  
	[[alternative HTML version deleted]]


From pankajsbi at yahoo.com  Sun Jun 26 16:11:52 2016
From: pankajsbi at yahoo.com (Pankaj K Agarwal)
Date: Sun, 26 Jun 2016 14:11:52 +0000 (UTC)
Subject: [R-SIG-Finance] Imputing Missing Values
In-Reply-To: <1466947001.16865.205.camel@brian-rcg>
References: <1287945331.1344273.1466945582322.JavaMail.yahoo.ref@mail.yahoo.com>
	<1287945331.1344273.1466945582322.JavaMail.yahoo@mail.yahoo.com>
	<1466947001.16865.205.camel@brian-rcg>
Message-ID: <44728917.1340223.1466950312671.JavaMail.yahoo@mail.yahoo.com>

Thanks so much Brian sir. Your reply is a great help.?Regards,Pankaj? 

    On Sunday, 26 June 2016 6:47 PM, Brian G. Peterson <brian at braverock.com> wrote:
 
 

 On Sun, 2016-06-26 at 12:53 +0000, Pankaj K Agarwal via R-SIG-Finance
wrote:
> This might be a very basic query for this erudite group. However, i am
> hopeful some help will be forthcoming nevertheless.I have a monthly
> time series of annualized t-bill rates on Indian markets. For some
> months, the values are missing randomly. I need to convert the
> annualized yields into daily as well as monthly yields. I have two
> questions:1. I am using package zoo. Which of the methods of NA
> imputations will be advisable for this series, viz., na.agggregate,
> na.locf, na.spline or na.approx etc.?2. Should the imputation be done
> on monthly annual yields and then the conversion to daily and monthly
> yields be performed or imputation be done afterwards?3. Are there
> better methods than above for this task? I will be extremely grateful
> for comments. Thanks a ton. Regards,Pankaj ??? 

The short answer is: Don't do it.? This is a bad idea.

You need to find a better source of data.? Daily data on Indian 3-mo
bill yields is widely available from free sources.? See, e.g.

http://www.investing.com/rates-bonds/india-3-month-bond-yield

There are many other sources of this data as well, I have no opinion on
the data quality of one over the other, but *any* of them would likely
be orders of magnitude better than what you're asking to do.

You can't impute from lower-frequency data to higher frequency data with
any confidence.? 

These NA imputation methods are designed to fill some occasionally
missing data, or to do something like Last Observation Carried Forward
on Bid/Ask spreads (which is not imputation at all, since that is the
prevailing market). 

Basically, it always makes sense to start with the highest frequency
data available, and aggregate to lower frequencies.? In the case of your
query, start with the spot yield and do whatever adjustments you need.

Regards,

Brian



 
  
	[[alternative HTML version deleted]]


From pankajsbi at yahoo.com  Mon Jun 27 20:17:06 2016
From: pankajsbi at yahoo.com (Pankaj K Agarwal)
Date: Mon, 27 Jun 2016 18:17:06 +0000 (UTC)
Subject: [R-SIG-Finance] GMM
References: <416475601.1919765.1467051426633.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <416475601.1919765.1467051426633.JavaMail.yahoo@mail.yahoo.com>

Apologies if this question is irrelevant for this group.
Does using HAC standard errors (Newey and West: package sandwich) in OLS regression make using GMM (package: GMM) redundant?
?Regards,Pankaj K Agarwal
+91-98397-11444http://in.linkedin.com/in/pankajkagarwal/
	[[alternative HTML version deleted]]


From markleeds2 at gmail.com  Mon Jun 27 20:35:46 2016
From: markleeds2 at gmail.com (Mark Leeds)
Date: Mon, 27 Jun 2016 14:35:46 -0400
Subject: [R-SIG-Finance] GMM
In-Reply-To: <416475601.1919765.1467051426633.JavaMail.yahoo@mail.yahoo.com>
References: <416475601.1919765.1467051426633.JavaMail.yahoo.ref@mail.yahoo.com>
	<416475601.1919765.1467051426633.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CAHz+bWZ+w0p-7KhnMRmXmsOYGdme_E4e9qDV8Mx5q1=JSzv=8g@mail.gmail.com>

Hi : Yes but GMM is used more for either A) when the OLS assumptions are
not true ( i.e autocorrelation or heteroscedasticity. ) or B) you have a
function that is not
necessarily linear like it is in the case of OLS.

Also, Achim could definitely say more on this but there are various
techniques for the construction of HAC estimators so using sandwich may not
necessarily give the same results as GMM even in the OLS case.











On Mon, Jun 27, 2016 at 2:17 PM, Pankaj K Agarwal via R-SIG-Finance <
r-sig-finance at r-project.org> wrote:

> Apologies if this question is irrelevant for this group.
> Does using HAC standard errors (Newey and West: package sandwich) in OLS
> regression make using GMM (package: GMM) redundant?
>  Regards,Pankaj K Agarwal
> +91-98397-11444http://in.linkedin.com/in/pankajkagarwal/
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.

	[[alternative HTML version deleted]]


From ezivot at uw.edu  Tue Jun 28 18:55:19 2016
From: ezivot at uw.edu (Eric Zivot)
Date: Tue, 28 Jun 2016 09:55:19 -0700
Subject: [R-SIG-Finance] GMM
In-Reply-To: <416475601.1919765.1467051426633.JavaMail.yahoo@mail.yahoo.com>
References: <416475601.1919765.1467051426633.JavaMail.yahoo.ref@mail.yahoo.com>
	<416475601.1919765.1467051426633.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <022b01d1d15d$daa0ccb0$8fe26610$@uw.edu>

No
OLS is a special case of GMM where the number of moment conditions is the same as the number of parameters. In this case the efficient weight matrix does not matter for estimation but does matter for the calculation of an estimate of the asymptotic variance matrix of the OLS parameters. This is what HAC standard errors do in the sandwich function vcovHAC()

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf Of Pankaj K Agarwal via R-SIG-Finance
Sent: Monday, June 27, 2016 11:17 AM
To: R-sig-finance <r-sig-finance at r-project.org>
Cc: H.K Pradhan <pradhan at xlri.ac.in>
Subject: [R-SIG-Finance] GMM

Apologies if this question is irrelevant for this group.
Does using HAC standard errors (Newey and West: package sandwich) in OLS regression make using GMM (package: GMM) redundant?
 Regards,Pankaj K Agarwal
+91-98397-11444http://in.linkedin.com/in/pankajkagarwal/
	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From achievingbala at viziamail.com  Tue Jun 28 22:20:53 2016
From: achievingbala at viziamail.com (achievingbala at viziamail.com)
Date: Tue, 28 Jun 2016 23:20:53 +0300
Subject: [R-SIG-Finance] new experience
Message-ID: <0000fd90ca75$5105567b$90349b71$@translucentanalytics.com>

Hi,

I've recently had absolutely new experience, you've got to see that! Just take a look here <http://sticricruza.lookamazingnaked.net/xyvuc>

Pardon my monkey thumbs, nelson at translucentanalytics.com


	[[alternative HTML version deleted]]


From tr206 at kent.ac.uk  Tue Jun 28 23:06:50 2016
From: tr206 at kent.ac.uk (T.Riedle)
Date: Tue, 28 Jun 2016 21:06:50 +0000
Subject: [R-SIG-Finance] Calculating VaR
Message-ID: <79e08bc654e34144a8b21ceeba0077bd@ex13-live-mbn1.ad.kent.ac.uk>

Dear all,

As I am working on Value at Risk, I am looking for an appropriate package to calculate Value at Risk using different methods beyond the historical method. In doing so, I have found the package jvnVaR which provides several methods to calculate VaR. Nevertheless, I am interested in calculating the Monte Carlo VaR and the GARCH (1,1) VaR.



Does anybody know another package which provides  functions to calculate VaR?



Kind regards




	[[alternative HTML version deleted]]


From danielmelendez at alum.northwestern.edu  Tue Jun 28 23:18:16 2016
From: danielmelendez at alum.northwestern.edu (Daniel Melendez)
Date: Tue, 28 Jun 2016 16:18:16 -0500
Subject: [R-SIG-Finance] Calculating VaR
In-Reply-To: <79e08bc654e34144a8b21ceeba0077bd@ex13-live-mbn1.ad.kent.ac.uk>
References: <79e08bc654e34144a8b21ceeba0077bd@ex13-live-mbn1.ad.kent.ac.uk>
Message-ID: <AC5EB50B-F023-4B4A-9CB8-08606E82D9F5@alum.northwestern.edu>

Definitely should look into the rugarch/rmgarch packages 

Regards - Daniel

> On Jun 28, 2016, at 4:06 PM, T.Riedle <tr206 at kent.ac.uk> wrote:
> 
> Dear all,
> 
> As I am working on Value at Risk, I am looking for an appropriate package to calculate Value at Risk using different methods beyond the historical method. In doing so, I have found the package jvnVaR which provides several methods to calculate VaR. Nevertheless, I am interested in calculating the Monte Carlo VaR and the GARCH (1,1) VaR.
> 
> 
> 
> Does anybody know another package which provides  functions to calculate VaR?
> 
> 
> 
> Kind regards
> 
> 
> 
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From ezivot at uw.edu  Wed Jun 29 00:48:29 2016
From: ezivot at uw.edu (Eric Zivot)
Date: Tue, 28 Jun 2016 15:48:29 -0700
Subject: [R-SIG-Finance] Calculating VaR
In-Reply-To: <79e08bc654e34144a8b21ceeba0077bd@ex13-live-mbn1.ad.kent.ac.uk>
References: <79e08bc654e34144a8b21ceeba0077bd@ex13-live-mbn1.ad.kent.ac.uk>
Message-ID: <02f201d1d18f$306b9360$9142ba20$@uw.edu>

You can also look at the Dowd package on R-forge (part of ReturnAnalytics)
and, of course, PerformanceAnalytics. rugarch has built-in functionality for
computing VaR from GARCH models as well as backtesting VaR models.

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of T.Riedle
Sent: Tuesday, June 28, 2016 2:07 PM
To: R-SIG-Finance at r-project.org
Subject: [R-SIG-Finance] Calculating VaR

Dear all,

As I am working on Value at Risk, I am looking for an appropriate package to
calculate Value at Risk using different methods beyond the historical
method. In doing so, I have found the package jvnVaR which provides several
methods to calculate VaR. Nevertheless, I am interested in calculating the
Monte Carlo VaR and the GARCH (1,1) VaR.



Does anybody know another package which provides  functions to calculate
VaR?



Kind regards




	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From markleeds2 at gmail.com  Wed Jun 29 02:41:44 2016
From: markleeds2 at gmail.com (Mark Leeds)
Date: Tue, 28 Jun 2016 20:41:44 -0400
Subject: [R-SIG-Finance] GMM
In-Reply-To: <022b01d1d15d$daa0ccb0$8fe26610$@uw.edu>
References: <416475601.1919765.1467051426633.JavaMail.yahoo.ref@mail.yahoo.com>
	<416475601.1919765.1467051426633.JavaMail.yahoo@mail.yahoo.com>
	<022b01d1d15d$daa0ccb0$8fe26610$@uw.edu>
Message-ID: <CAHz+bWZaF3VOasLxf=R38dob39MBxJ294hzG8oqX0UuYHa9jQQ@mail.gmail.com>

Thanks Eric for your explanation. But I'm a little confused. I understand
that in
the case of OLS, the system is perfectly identified. But are you saying that

A) if he used lm and sandwich, then he won't get a correct answer

B) that if he uses GMM, he won't get a correct answer  because it's not
designed
for perfectly identfied systems. ( i.e: there is no weighting matrix ).

C) if he uses both, he'll get different answers.

Thanks.

And to the person who asked the question originally, below is a short but
sweet intro to GMM.

http://lipas.uwasa.fi/~sjp/Teaching/gmm/lectures/gmmc3.pdf







On Tue, Jun 28, 2016 at 12:55 PM, Eric Zivot <ezivot at uw.edu> wrote:

> No
> OLS is a special case of GMM where the number of moment conditions is the
> same as the number of parameters. In this case the efficient weight matrix
> does not matter for estimation but does matter for the calculation of an
> estimate of the asymptotic variance matrix of the OLS parameters. This is
> what HAC standard errors do in the sandwich function vcovHAC()
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On
> Behalf Of Pankaj K Agarwal via R-SIG-Finance
> Sent: Monday, June 27, 2016 11:17 AM
> To: R-sig-finance <r-sig-finance at r-project.org>
> Cc: H.K Pradhan <pradhan at xlri.ac.in>
> Subject: [R-SIG-Finance] GMM
>
> Apologies if this question is irrelevant for this group.
> Does using HAC standard errors (Newey and West: package sandwich) in OLS
> regression make using GMM (package: GMM) redundant?
>  Regards,Pankaj K Agarwal
> +91-98397-11444http://in.linkedin.com/in/pankajkagarwal/
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From philipp.reich at gmx.net  Wed Jun 29 22:34:14 2016
From: philipp.reich at gmx.net (Philipp Reich)
Date: Wed, 29 Jun 2016 22:34:14 +0200
Subject: [R-SIG-Finance] Creating regression tables for objects returned
	from ugarchfit
Message-ID: <6AE6C8C0-664D-4520-AF3D-CFB03E562B2E@gmx.net>

Hi R-users,

I have not been working a lot with R before so this might be basic.
However, I have been using the fGarch package to estimate Garch-type models and I always used stargazer in order to create an output table. E.g.

d <- read.dta("dataSet.dta");
R = d$GDAX_r;
FGarch01 <- garchFit(data=R, cond.dist="std")
stargazer(fit01, out="models.txt?)

Now I am trying to fit models with exogenous regressors, e.g.

# import data
d <- read.dta("dataSet.dta");

# create data to work with
R = d$GDAX_r;
RK = d$GDAX_rk;
VDAX = d$VDAX_c/sqrt(225);
l1_r = R[2:2676];
l1_rk = RK[2:2676];
l1_vdax = VDAX[2:2676]/sqrt(225);
r = R[1:2675];
rk = RK[1:2675];
vdax = VDAX[1:2675]/sqrt(225);
exVar = cbind(l1_rk, l1_vdax)

# 3. model
spec03 <- ugarchspec(variance.model=list(model="sGARCH",garchOrder=c(1,1), external.regressors=exVar),mean.model=list(arfima=FALSE, armaOrder=c(0,0), include.mean=TRUE),distribution="ged", fixed.pars=list( vxreg2=0))
fit03 <- ugarchfit(spec03, r, solver="nlminb", fit.control = list(stationarity = 1))
coef(fit03);

stargazer(fit03, out="models.txt")

When I try to apply stargazer to the object returned from ugarchfit I get the following error message. 
Error in objects[[i]]$zelig.call : 
  $ operator not defined for this S4 class

The question to you guys is: Did I do something wrong when using stargazer? Are there other methods for creating regression tables when using rugarch? 
If so please share that information with me
Thank you very much for helping me,

Philipp









	[[alternative HTML version deleted]]


From alexios at 4dscape.com  Thu Jun 30 01:45:23 2016
From: alexios at 4dscape.com (alexios galanos)
Date: Wed, 29 Jun 2016 18:45:23 -0500
Subject: [R-SIG-Finance] Creating regression tables for objects returned
 from ugarchfit
In-Reply-To: <6AE6C8C0-664D-4520-AF3D-CFB03E562B2E@gmx.net>
References: <6AE6C8C0-664D-4520-AF3D-CFB03E562B2E@gmx.net>
Message-ID: <acfb744a-1f03-68be-698d-53bfdb6ceac5@4dscape.com>

I've never heard of stargazer but will look into it to see what is
required to generate
the output...probably some contribution of code back to the developers
to handle
rugarch classes.

I'll let you know.

Regards,

Alexios

On 29/06/2016 15:34, Philipp Reich wrote:
> Hi R-users,
>
> I have not been working a lot with R before so this might be basic.
> However, I have been using the fGarch package to estimate Garch-type models and I always used stargazer in order to create an output table. E.g.
>
> d <- read.dta("dataSet.dta");
> R = d$GDAX_r;
> FGarch01 <- garchFit(data=R, cond.dist="std")
> stargazer(fit01, out="models.txt?)
>
> Now I am trying to fit models with exogenous regressors, e.g.
>
> # import data
> d <- read.dta("dataSet.dta");
>
> # create data to work with
> R = d$GDAX_r;
> RK = d$GDAX_rk;
> VDAX = d$VDAX_c/sqrt(225);
> l1_r = R[2:2676];
> l1_rk = RK[2:2676];
> l1_vdax = VDAX[2:2676]/sqrt(225);
> r = R[1:2675];
> rk = RK[1:2675];
> vdax = VDAX[1:2675]/sqrt(225);
> exVar = cbind(l1_rk, l1_vdax)
>
> # 3. model
> spec03 <- ugarchspec(variance.model=list(model="sGARCH",garchOrder=c(1,1), external.regressors=exVar),mean.model=list(arfima=FALSE, armaOrder=c(0,0), include.mean=TRUE),distribution="ged", fixed.pars=list( vxreg2=0))
> fit03 <- ugarchfit(spec03, r, solver="nlminb", fit.control = list(stationarity = 1))
> coef(fit03);
>
> stargazer(fit03, out="models.txt")
>
> When I try to apply stargazer to the object returned from ugarchfit I get the following error message. 
> Error in objects[[i]]$zelig.call : 
>   $ operator not defined for this S4 class
>
> The question to you guys is: Did I do something wrong when using stargazer? Are there other methods for creating regression tables when using rugarch? 
> If so please share that information with me
> Thank you very much for helping me,
>
> Philipp
>
>
>
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



From kristian.langgaard.lind at gmail.com  Tue Oct  4 13:04:50 2016
From: kristian.langgaard.lind at gmail.com (Kristian Lind)
Date: Tue, 4 Oct 2016 13:04:50 +0200
Subject: [R-SIG-Finance] Constrained portfolio optimization with DEoptim
Message-ID: <CAK0QJvxob1C-763TbRJ9Q6=vOWZswyntHSd6TxL0w_s5stucsw@mail.gmail.com>

Hi guys,

I?m working on a portfolio optimization problem

The problem I?m trying to solve is of the form Min risk s.t. return = X

For each asset I have simulated 1000 paths for the development in asset
prices over 10 years.

The risk measure I?d like to minimize is YoY shortfall risk, but could be
any risk metric that takes the information from the scenarios into
consideration.

Likewise, the return is the mean annualized return over all the scenarios.

I have tried solving this problem using DEoptim, where deviations from the
required return is penalized. Similar to the approach applied here:
https://cran.r-project.org/web/packages/DEoptim/vignettes/
DEoptimPortfolioOptimization.pdf

I am unable to achieve convergence where the constraint is fulfilled.

My object function is of the form

Obj <- function(Return data, portfolio weights, target return){

Normalize weights to 1

calculate portfolio return

calculate risk metric

calculate deviation from target return

return (risk metric + deviation from target return*1e6)

}

Any pointers on how to formulate and solve this problem would be much
appreciated.

Thank you.



Kristian Lind

	[[alternative HTML version deleted]]


From brian at braverock.com  Tue Oct  4 14:01:53 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 04 Oct 2016 07:01:53 -0500
Subject: [R-SIG-Finance] Constrained portfolio optimization with DEoptim
In-Reply-To: <CAK0QJvxob1C-763TbRJ9Q6=vOWZswyntHSd6TxL0w_s5stucsw@mail.gmail.com>
References: <CAK0QJvxob1C-763TbRJ9Q6=vOWZswyntHSd6TxL0w_s5stucsw@mail.gmail.com>
Message-ID: <1475582513.14041.262.camel@brian-rcg>

On Tue, 2016-10-04 at 13:04 +0200, Kristian Lind wrote:
> Hi guys,
> 
> I?m working on a portfolio optimization problem
> 
> The problem I?m trying to solve is of the form Min risk s.t. return = X
> 
> For each asset I have simulated 1000 paths for the development in asset
> prices over 10 years.
> 
> The risk measure I?d like to minimize is YoY shortfall risk, but could be
> any risk metric that takes the information from the scenarios into
> consideration.
> 
> Likewise, the return is the mean annualized return over all the scenarios.
> 
> I have tried solving this problem using DEoptim, where deviations from the
> required return is penalized. Similar to the approach applied here:
> https://cran.r-project.org/web/packages/DEoptim/vignettes/
> DEoptimPortfolioOptimization.pdf
> 
> I am unable to achieve convergence where the constraint is fulfilled.
> 
> My object function is of the form
> 
> Obj <- function(Return data, portfolio weights, target return){
> 
> Normalize weights to 1
> calculate portfolio return
> calculate risk metric
> calculate deviation from target return
> return (risk metric + deviation from target return*1e6)
> 
> }
> 
> Any pointers on how to formulate and solve this problem would be much
> appreciated.

You haven't provided a reproducible example, making it hard to help you.

You can easily do this type of optimization with PortfolioAnalytics,
including the use of DEoptim, pso, GenSA, or random search as a global
solver.  The modular objective function of PortfolioAnalytics should
allow you to specify your problem pretty easily.  You'll need to pass in
your 'scenarios', and use functions in your objective that expect this
data and know how to apply weights to it, but that should be pretty
simple.

To get to a general answer to your question, you need to determine a few
things.

Is there a solution that meets your constraints?  Many portfolios are
over-constrained, and are unable to meet the objectives as defined.  In
these cases you need to be able to relax constraints to get to the
closest solution.  It often helps to plot the unconstrained and
constrained feasible spaces (e.g. with random portfolios from
PortfolioAnalytics) to see if you've overconstrained things.  

You don't appear to be using 'fnMap' to apply your full investment
(cardinality) constraint.  Using this tells DEoptim what the final
parameter values were, and doesn't hide them inside your custom
objective.

You're attempting to perform a penalized optimization with:

return (risk metric + deviation from target return*1e6)

Is this the right weighting/penalty between your objectives? Typically,
if you have no significant preference between your objectives, you want
to use a multiplier first to get them to similar overall scale.  Then
you want to separately penalize (with a large multiplier) deviation from
your constraint.  In this case, you are penalizing overshooting and
missing below the return in the same way.  This will give the optimizer
very little indication on direction to improve the solution.  It can
also make sense to plot the path the optimizer takes to see if you're
getting close to a solution.

Your use of 'scenarios' could be messing you up.  DEoptim permutes
'parameters', which are typically weights in portfolio optimization
space.  It then applies the objective function passing the parameters
into the objective. You've said that you're using a annualized mean
across the scenarios and an annualized shortfall risk across the
scenarios.  You're losing quite a lot of dimensionality by reducing 1000
scenarios on each asset to one number.  Doing simple linear combinations
of these will not take things like covariances into account, even though
by saying that you care about shortfall risk, I'd assume what you really
want is *portfolio* shortfall.  I would be concerned that the loss of
dimensionality suggested by your description would make it difficult to
get a realistic solution.   

There are several more things that could cause this to fail to converge.
I've covered the most likely ones, but further investigation would
require a reproducible example.

Regards,

Brian


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From s_tet at tut.by  Sat Oct  8 01:03:37 2016
From: s_tet at tut.by (s_tet)
Date: RANDOM_Sat, 8 Oct 2016 02:03:37 +0300
Subject: [R-SIG-Finance] I think this is what you're looking for
Message-ID: <0000b8d624af$44fe14f0$166320cb$@tut.by>

Hey, 

As I got from your last message you were looking for that information, I  think I have  found it, check  it  out  <http://head.themidsouthfarmshow.com/lnhut>

Best regards, s_tet



	[[alternative HTML version deleted]]


From mwc4120 at hotmail.com  Sun Oct  9 05:29:32 2016
From: mwc4120 at hotmail.com (Michael Chen)
Date: Sun, 9 Oct 2016 03:29:32 +0000
Subject: [R-SIG-Finance] Search Function
Message-ID: <CY4PR14MB1367016819B19492F6E69952B1D80@CY4PR14MB1367.namprd14.prod.outlook.com>

Hi all,

I am looking for an answer to a specific question, I have been going through the threads to look for anything relevant first before I post a new thread.  I haven't found anything.  Is there a search function? I don't think it's efficient to go though every thread.  

This is my first post, please excuse any unintentional breaking of the forum rules.

Thanks,

Michaels

From ramesh.athreya at gmail.com  Sun Oct  9 05:55:18 2016
From: ramesh.athreya at gmail.com (Ramesh)
Date: Sun, 9 Oct 2016 09:25:18 +0530
Subject: [R-SIG-Finance] Error:subscript out of bounds: no column name
	containing "Close
Message-ID: <CACATUAqH09xpaGmOTHwT0GhfFu6j=Z_ZTq+gXtC35Fi1HMM7DQ@mail.gmail.com>

Hello,
I have downloaded the time series of crude oil in to R ( from a local excel
file(csv/text tab delimited) in C drive)and the data ( OHLC) is being
displayed in my R.Studio.
Am able to ascertain the Fibonacci pivot levels ( using a custom program
that I have developed). But when I use package Quantmod and try to
calculate the values using MACD,RSI etc,I get an error  *subscript out of
bounds: no column name containing "Close" *
I googled and found that many R users have  asked help for this issue in
the past.By and large this question looks to be remaining unresolved.
Can you please help me with a solution?
Thanks in advance
-- 
With Best Regards,
Ramesh

	[[alternative HTML version deleted]]


From brian at braverock.com  Sun Oct  9 12:41:10 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 9 Oct 2016 05:41:10 -0500
Subject: [R-SIG-Finance] Error:subscript out of bounds: no column name
 containing "Close
In-Reply-To: <CACATUAqH09xpaGmOTHwT0GhfFu6j=Z_ZTq+gXtC35Fi1HMM7DQ@mail.gmail.com>
References: <CACATUAqH09xpaGmOTHwT0GhfFu6j=Z_ZTq+gXtC35Fi1HMM7DQ@mail.gmail.com>
Message-ID: <57FA1EC6.1020105@braverock.com>

On 10/08/2016 10:55 PM, Ramesh wrote:
> I have downloaded the time series of crude oil in to R ( from a local excel
> file(csv/text tab delimited) in C drive)and the data ( OHLC) is being
> displayed in my R.Studio.
> Am able to ascertain the Fibonacci pivot levels ( using a custom program
> that I have developed). But when I use package Quantmod and try to
> calculate the values using MACD,RSI etc,I get an error  *subscript out of
> bounds: no column name containing "Close" *
> I googled and found that many R users have  asked help for this issue in
> the past.By and large this question looks to be remaining unresolved.
> Can you please help me with a solution?

Please follow the posting guide:

https://www.r-project.org/posting-guide.html

You haven't provided a minimal reproducible example, or nearly enough 
data to answer your question with certainty.


For the purposes of my guestimate, we'll assume your variable is called 'x'

I suspect that your 'OHLC' data doesn't contain any columns that 
quantmod's OHLC utility functions can recognize as close data.

Check the column names of your data.

Try using quantmod functions such as Cl(x) or is.OHLC(x) to see if 
quantmod recognizes your column names. (They are looking for variations 
of English words such as 'open, 'high', 'low', and 'close', 
capitalization unimportant)

The TTR functions MACD and RSI expect univariate data, not OHLC data, as 
is noted in the documentation.  You could try something like:

RSI(getPrice(x))
MACD(getPrice(x))

and the quantmod function 'getPrice' will try to guess at a column that 
may contain price data.  This may suffer from the same problem as above.

In short, your problem is almost certainly that the column names of your 
imported data are unintelligible:  Check this first.

If you're still having trouble, please follow the posting guide and 
provide a minimal reproducible example.

-- 
Brian


From brian at braverock.com  Sun Oct  9 12:46:48 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 9 Oct 2016 05:46:48 -0500
Subject: [R-SIG-Finance] Search Function
In-Reply-To: <CY4PR14MB1367016819B19492F6E69952B1D80@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <CY4PR14MB1367016819B19492F6E69952B1D80@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <57FA2018.2030300@braverock.com>

On 10/08/2016 10:29 PM, Michael Chen wrote:
> I am looking for an answer to a specific question, I have been going
> through the threads to look for anything relevant first before I post
> a new thread.  I haven't found anything.  Is there a search function?
> I don't think it's efficient to go though every thread.
>
> This is my first post, please excuse any unintentional breaking of
> the forum rules.

I will refer you to Pat Burns' excellent post on this exact question:

http://www.portfolioprobe.com/2012/01/19/how-to-search-the-r-sig-finance-archives/

I located the Portfolio Probe post using method B and Googling

'r-sig-finance search'

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From marco.mastrangeli at gmail.com  Tue Oct 11 18:46:28 2016
From: marco.mastrangeli at gmail.com (Marco Mastrangeli)
Date: Tue, 11 Oct 2016 18:46:28 +0200
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
Message-ID: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>

I have a question about the use of the "mu" parameter in the functions
StdDev, VaR e CVaR.
As reference data we can use data in the paper "Vignette: Portfolio
Optimization with CVaR budgets in PortfolioAnalytics".
If we use the default parameters for "mu" and "sigma", there is a
match between

>constrained_objective( w = rep(1/4,4) , R = indexes, portfolio = ObjSpec)
               [,1]
ES 0.1253199

and

>out<-ES(indexes, weights = rep(1/4,4),p=0.95, portfolio_method="component")
> out$MES
                [,1]
[1,] 0.1253199

as explained by the authors.
If I insert a user-defined sigma matrix for the "sigma" parameter, the
match is still there between this two exspressions. If I insert a
user-defined vector for the "mu" parameter (for example "mu=rep(0.01, 4)",
the result of the two exspressions is the same only for portafolio with
risk objective function StdDev and VaR, not for CVaR.

VaR case:
>ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
                  [,1]
VaR 0.04638622

>out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
portfolio_method="component")
> out
$MVaR
                 [,1]
[1,] 0.04638622


CVaR case:
>ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
                [,1]
ES 0.1217594

>out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
portfolio_method="component")
> out
$MES
                [,1]
[1,] 0.1235878

I can't find the explanation for this thing. Thanks a lot for your
attention.

Marco

	[[alternative HTML version deleted]]


From michael.weylandt at gmail.com  Wed Oct 12 01:55:23 2016
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Tue, 11 Oct 2016 18:55:23 -0500
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
In-Reply-To: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
References: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
Message-ID: <CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>

Hi Marco,

Can you put together a minimal reproducible example [1,2] so that it's
easier for others to answer your question?

For this problem, I'd recommend using the edhec data distributed with
PerformanceAnalytics.

Thanks,
Michael

[1] http://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example
[2] http://adv-r.had.co.nz/Reproducibility.html

On Tue, Oct 11, 2016 at 11:46 AM, Marco Mastrangeli
<marco.mastrangeli at gmail.com> wrote:
> I have a question about the use of the "mu" parameter in the functions
> StdDev, VaR e CVaR.
> As reference data we can use data in the paper "Vignette: Portfolio
> Optimization with CVaR budgets in PortfolioAnalytics".
> If we use the default parameters for "mu" and "sigma", there is a
> match between
>
>>constrained_objective( w = rep(1/4,4) , R = indexes, portfolio = ObjSpec)
>                [,1]
> ES 0.1253199
>
> and
>
>>out<-ES(indexes, weights = rep(1/4,4),p=0.95, portfolio_method="component")
>> out$MES
>                 [,1]
> [1,] 0.1253199
>
> as explained by the authors.
> If I insert a user-defined sigma matrix for the "sigma" parameter, the
> match is still there between this two exspressions. If I insert a
> user-defined vector for the "mu" parameter (for example "mu=rep(0.01, 4)",
> the result of the two exspressions is the same only for portafolio with
> risk objective function StdDev and VaR, not for CVaR.
>
> VaR case:
>>ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>                   [,1]
> VaR 0.04638622
>
>>out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> portfolio_method="component")
>> out
> $MVaR
>                  [,1]
> [1,] 0.04638622
>
>
> CVaR case:
>>ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>>constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>                 [,1]
> ES 0.1217594
>
>>out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> portfolio_method="component")
>> out
> $MES
>                 [,1]
> [1,] 0.1235878
>
> I can't find the explanation for this thing. Thanks a lot for your
> attention.
>
> Marco
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From marco.mastrangeli at gmail.com  Wed Oct 12 11:34:48 2016
From: marco.mastrangeli at gmail.com (Marco Mastrangeli)
Date: Wed, 12 Oct 2016 11:34:48 +0200
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
In-Reply-To: <CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>
References: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
	<CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>
Message-ID: <CACb5SZ9TWn+EyDY+zMFotFpj3xUwsxvL089Za5XaHu0UC8boKg@mail.gmail.com>

Hi Michael,

thanks for your reply, I apologize for the not full clarity of my question.
In the following, I try to report a full example.

#Library
*library(PerformanceAnalytics)*
*library(PortfolioAnalytics)*

#Returns data present in "PortfolioAnalytics"
*data(indexes)*
*indexes <- indexes[,1:4]*

#New Portfolio Object
*Wcons <- portfolio.spec(assets=colnames(indexes))*

#Add box constraints
*Wcons <- add.constraint(portfolio=Wcons, type='box', min=0, max=1)*

#Add the full investment constraint
*Wcons <- add.constraint(portfolio=Wcons, type="full_investment")*

#Add Objective specification: VaR with default parameter for vector "mu"
(EXAMPLE 1)
*VaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
arguments=list(p=0.95), enabled=TRUE)*

#The value of the objective function is:
*constrained_objective(w=rep(1/4,4), R=indexes, portfolio=VaRObjSpec)    #* VaR
*0.0499467*

#This is the VaR of the equal-weight portfolio as computed by the function
VaR in the PerformanceAnalytics package.
*VaRout <- VaR(indexes, weights=rep(1/4,4), p=0.95,
portfolio_method="component")*
*VaRout$MVaR       # *[1,]* 0.0499467*

Now, I repet the VaR example with a user-defined vector for the parameter
"mu".

#User-defined vector "mu"
*myMu = rep(0.01, 4)*

#Add Objective specification: VaR with user-defined parameter for vector
"mu"
*myVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
arguments=list(p=0.95, mu=myMu), enabled=TRUE)*

#The value of the objective function is:
*constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myVaRObjSpec)
 #* VaR *0.04638622*

#This is the VaR of the equal-weight portfolio as computed by the function
VaR in the PerformanceAnalytics package with *mu=myMu.*
*myVaRout <- VaR(indexes, weights=rep(1/4,4),
p=0.95, mu=myMu, portfolio_method="component")*
*myVaRout$MVaR       # *[1,]* 0.04638622*

So, using the default and user-defined parameter for "mu" there is
corrispondence between constrained_objective and the function VaR of
PerformanceAnalytics package.
I repet the example but now adding CVaR as risk objective in Wcons
portfolio.

#Add Objective specification: CVaR with default parameter for vector "mu"
(EXAMPLE 2)
*CVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
arguments=list(p=0.95), enabled=TRUE)*

#The value of the objective function is:
*constrained_objective(w=rep(1/4,4), R=indexes, portfolio=CVaRObjSpec)    #* ES
*0.1253199*

#This is the CVaR of the equal-weight portfolio as computed by the function
ES in the PerformanceAnalytics package.
*CVaRout <- ES(indexes, weights=rep(1/4,4), p=0.95,
portfolio_method="component")*
*CVaRout$MES       # *[1,]* 0.1253199*

Now, I repet the CVaR example with a user-defined vector for the parameter
"mu".

#User-defined vector "mu"
*myMu = rep(0.01, 4)*

#Add Objective specification: CVaR with user-defined parameter for vector
"mu"
*myCVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
arguments=list(p=0.95, mu=myMu), enabled=TRUE)*

#The value of the objective function is:
*constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myCVaRObjSpec)
 #* ES *0.1217594*

#This should be the CVaR of the equal-weight portfolio as computed by the
function ES in the PerformanceAnalytics package with *mu=myMu.*
*myCVaRout <- ES(indexes, weights=rep(1/4,4),
p=0.95, mu=myMu, portfolio_method="component")*
*myCVaRout$MES       # *[1,]* 0.1235878*

In this case, using the user-defined parameter for "mu" there is no
corrispondence between the value of constrained_objective (0.1217594*) *and
the result of function ES of PerformanceAnalytics package (0.1235878). Why
there is no match in this case?
This not the case for the matrix parameter (for portfolio) "sigma": if I
use a user-defined sigma matrix, there is always corrispondence (without,
obviosly, costraints that augment the penalty augmented objective
function) between the value of constrained_objective (with VaR/CVaR risk
objective) and the result of function VaR/ES of PerformanceAnalytics
package.

I hope my example is clear enough to illustrate the question.
Thanks a lot for your attention.
Marco


On Wed, Oct 12, 2016 at 1:55 AM, Michael Weylandt <
michael.weylandt at gmail.com> wrote:

> Hi Marco,
>
> Can you put together a minimal reproducible example [1,2] so that it's
> easier for others to answer your question?
>
> For this problem, I'd recommend using the edhec data distributed with
> PerformanceAnalytics.
>
> Thanks,
> Michael
>
> [1] http://stackoverflow.com/questions/5963269/how-to-make-
> a-great-r-reproducible-example
> [2] http://adv-r.had.co.nz/Reproducibility.html
>
> On Tue, Oct 11, 2016 at 11:46 AM, Marco Mastrangeli
> <marco.mastrangeli at gmail.com> wrote:
> > I have a question about the use of the "mu" parameter in the functions
> > StdDev, VaR e CVaR.
> > As reference data we can use data in the paper "Vignette: Portfolio
> > Optimization with CVaR budgets in PortfolioAnalytics".
> > If we use the default parameters for "mu" and "sigma", there is a
> > match between
> >
> >>constrained_objective( w = rep(1/4,4) , R = indexes, portfolio = ObjSpec)
> >                [,1]
> > ES 0.1253199
> >
> > and
> >
> >>out<-ES(indexes, weights = rep(1/4,4),p=0.95,
> portfolio_method="component")
> >> out$MES
> >                 [,1]
> > [1,] 0.1253199
> >
> > as explained by the authors.
> > If I insert a user-defined sigma matrix for the "sigma" parameter, the
> > match is still there between this two exspressions. If I insert a
> > user-defined vector for the "mu" parameter (for example "mu=rep(0.01,
> 4)",
> > the result of the two exspressions is the same only for portafolio with
> > risk objective function StdDev and VaR, not for CVaR.
> >
> > VaR case:
> >>ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
> > arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
> >> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
> >                   [,1]
> > VaR 0.04638622
> >
> >>out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> > portfolio_method="component")
> >> out
> > $MVaR
> >                  [,1]
> > [1,] 0.04638622
> >
> >
> > CVaR case:
> >>ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
> > arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
> >>constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
> >                 [,1]
> > ES 0.1217594
> >
> >>out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> > portfolio_method="component")
> >> out
> > $MES
> >                 [,1]
> > [1,] 0.1235878
> >
> > I can't find the explanation for this thing. Thanks a lot for your
> > attention.
> >
> > Marco
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Oct 12 12:21:23 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 12 Oct 2016 05:21:23 -0500
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
In-Reply-To: <CACb5SZ9TWn+EyDY+zMFotFpj3xUwsxvL089Za5XaHu0UC8boKg@mail.gmail.com>
References: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
	<CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>
	<CACb5SZ9TWn+EyDY+zMFotFpj3xUwsxvL089Za5XaHu0UC8boKg@mail.gmail.com>
Message-ID: <57FE0EA3.90403@braverock.com>

I attach what I think is a syntactically correct version of the email, 
which looks like it was pasted from HTML.

We'll try to take a look.

Regards,

Brian

On 10/12/2016 04:34 AM, Marco Mastrangeli wrote:
> Hi Michael,
>
> thanks for your reply, I apologize for the not full clarity of my question.
> In the following, I try to report a full example.
>
> #Library
> *library(PerformanceAnalytics)*
> *library(PortfolioAnalytics)*
>
> #Returns data present in "PortfolioAnalytics"
> *data(indexes)*
> *indexes <- indexes[,1:4]*
>
> #New Portfolio Object
> *Wcons <- portfolio.spec(assets=colnames(indexes))*
>
> #Add box constraints
> *Wcons <- add.constraint(portfolio=Wcons, type='box', min=0, max=1)*
>
> #Add the full investment constraint
> *Wcons <- add.constraint(portfolio=Wcons, type="full_investment")*
>
> #Add Objective specification: VaR with default parameter for vector "mu"
> (EXAMPLE 1)
> *VaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
> arguments=list(p=0.95), enabled=TRUE)*
>
> #The value of the objective function is:
> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=VaRObjSpec)    #* VaR
> *0.0499467*
>
> #This is the VaR of the equal-weight portfolio as computed by the function
> VaR in the PerformanceAnalytics package.
> *VaRout <- VaR(indexes, weights=rep(1/4,4), p=0.95,
> portfolio_method="component")*
> *VaRout$MVaR       # *[1,]* 0.0499467*
>
> Now, I repet the VaR example with a user-defined vector for the parameter
> "mu".
>
> #User-defined vector "mu"
> *myMu = rep(0.01, 4)*
>
> #Add Objective specification: VaR with user-defined parameter for vector
> "mu"
> *myVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
>
> #The value of the objective function is:
> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myVaRObjSpec)
>   #* VaR *0.04638622*
>
> #This is the VaR of the equal-weight portfolio as computed by the function
> VaR in the PerformanceAnalytics package with *mu=myMu.*
> *myVaRout <- VaR(indexes, weights=rep(1/4,4),
> p=0.95, mu=myMu, portfolio_method="component")*
> *myVaRout$MVaR       # *[1,]* 0.04638622*
>
> So, using the default and user-defined parameter for "mu" there is
> corrispondence between constrained_objective and the function VaR of
> PerformanceAnalytics package.
> I repet the example but now adding CVaR as risk objective in Wcons
> portfolio.
>
> #Add Objective specification: CVaR with default parameter for vector "mu"
> (EXAMPLE 2)
> *CVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
> arguments=list(p=0.95), enabled=TRUE)*
>
> #The value of the objective function is:
> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=CVaRObjSpec)    #* ES
> *0.1253199*
>
> #This is the CVaR of the equal-weight portfolio as computed by the function
> ES in the PerformanceAnalytics package.
> *CVaRout <- ES(indexes, weights=rep(1/4,4), p=0.95,
> portfolio_method="component")*
> *CVaRout$MES       # *[1,]* 0.1253199*
>
> Now, I repet the CVaR example with a user-defined vector for the parameter
> "mu".
>
> #User-defined vector "mu"
> *myMu = rep(0.01, 4)*
>
> #Add Objective specification: CVaR with user-defined parameter for vector
> "mu"
> *myCVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
>
> #The value of the objective function is:
> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myCVaRObjSpec)
>   #* ES *0.1217594*
>
> #This should be the CVaR of the equal-weight portfolio as computed by the
> function ES in the PerformanceAnalytics package with *mu=myMu.*
> *myCVaRout <- ES(indexes, weights=rep(1/4,4),
> p=0.95, mu=myMu, portfolio_method="component")*
> *myCVaRout$MES       # *[1,]* 0.1235878*
>
> In this case, using the user-defined parameter for "mu" there is no
> corrispondence between the value of constrained_objective (0.1217594*) *and
> the result of function ES of PerformanceAnalytics package (0.1235878). Why
> there is no match in this case?
> This not the case for the matrix parameter (for portfolio) "sigma": if I
> use a user-defined sigma matrix, there is always corrispondence (without,
> obviosly, costraints that augment the penalty augmented objective
> function) between the value of constrained_objective (with VaR/CVaR risk
> objective) and the result of function VaR/ES of PerformanceAnalytics
> package.
>
> I hope my example is clear enough to illustrate the question.
> Thanks a lot for your attention.
> Marco
>
>
> On Wed, Oct 12, 2016 at 1:55 AM, Michael Weylandt <
> michael.weylandt at gmail.com> wrote:
>
>> Hi Marco,
>>
>> Can you put together a minimal reproducible example [1,2] so that it's
>> easier for others to answer your question?
>>
>> For this problem, I'd recommend using the edhec data distributed with
>> PerformanceAnalytics.
>>
>> Thanks,
>> Michael
>>
>> [1] http://stackoverflow.com/questions/5963269/how-to-make-
>> a-great-r-reproducible-example
>> [2] http://adv-r.had.co.nz/Reproducibility.html
>>
>> On Tue, Oct 11, 2016 at 11:46 AM, Marco Mastrangeli
>> <marco.mastrangeli at gmail.com> wrote:
>>> I have a question about the use of the "mu" parameter in the functions
>>> StdDev, VaR e CVaR.
>>> As reference data we can use data in the paper "Vignette: Portfolio
>>> Optimization with CVaR budgets in PortfolioAnalytics".
>>> If we use the default parameters for "mu" and "sigma", there is a
>>> match between
>>>
>>>> constrained_objective( w = rep(1/4,4) , R = indexes, portfolio = ObjSpec)
>>>                 [,1]
>>> ES 0.1253199
>>>
>>> and
>>>
>>>> out<-ES(indexes, weights = rep(1/4,4),p=0.95,
>> portfolio_method="component")
>>>> out$MES
>>>                  [,1]
>>> [1,] 0.1253199
>>>
>>> as explained by the authors.
>>> If I insert a user-defined sigma matrix for the "sigma" parameter, the
>>> match is still there between this two exspressions. If I insert a
>>> user-defined vector for the "mu" parameter (for example "mu=rep(0.01,
>> 4)",
>>> the result of the two exspressions is the same only for portafolio with
>>> risk objective function StdDev and VaR, not for CVaR.
>>>
>>> VaR case:
>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>>>                    [,1]
>>> VaR 0.04638622
>>>
>>>> out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
>>> portfolio_method="component")
>>>> out
>>> $MVaR
>>>                   [,1]
>>> [1,] 0.04638622
>>>
>>>
>>> CVaR case:
>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>>>                  [,1]
>>> ES 0.1217594
>>>
>>>> out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
>>> portfolio_method="component")
>>>> out
>>> $MES
>>>                  [,1]
>>> [1,] 0.1235878
>>>
>>> I can't find the explanation for this thing. Thanks a lot for your
>>> attention.
>>>
>>> Marco
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-SIG-Finance at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock
-------------- next part --------------
A non-text attachment was scrubbed...
Name: constrained_obj_issue.R
Type: text/x-r-source
Size: 4524 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161012/b6831678/attachment.bin>

From marco.mastrangeli at gmail.com  Wed Oct 12 13:08:57 2016
From: marco.mastrangeli at gmail.com (Marco Mastrangeli)
Date: Wed, 12 Oct 2016 13:08:57 +0200
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
In-Reply-To: <57FE0EA3.90403@braverock.com>
References: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
	<CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>
	<CACb5SZ9TWn+EyDY+zMFotFpj3xUwsxvL089Za5XaHu0UC8boKg@mail.gmail.com>
	<57FE0EA3.90403@braverock.com>
Message-ID: <CACb5SZ-oBj__3Ro1sayii46inXLhFD8mAy63pBNfHqmYx4vvOg@mail.gmail.com>

Thanks Brian, I will avoid HTML format next time.

Best regards,
Marco

On Wed, Oct 12, 2016 at 12:21 PM, Brian G. Peterson <brian at braverock.com>
wrote:

> I attach what I think is a syntactically correct version of the email,
> which looks like it was pasted from HTML.
>
> We'll try to take a look.
>
> Regards,
>
> Brian
>
> On 10/12/2016 04:34 AM, Marco Mastrangeli wrote:
>
>> Hi Michael,
>>
>> thanks for your reply, I apologize for the not full clarity of my
>> question.
>> In the following, I try to report a full example.
>>
>> #Library
>> *library(PerformanceAnalytics)*
>> *library(PortfolioAnalytics)*
>>
>> #Returns data present in "PortfolioAnalytics"
>> *data(indexes)*
>> *indexes <- indexes[,1:4]*
>>
>> #New Portfolio Object
>> *Wcons <- portfolio.spec(assets=colnames(indexes))*
>>
>> #Add box constraints
>> *Wcons <- add.constraint(portfolio=Wcons, type='box', min=0, max=1)*
>>
>> #Add the full investment constraint
>> *Wcons <- add.constraint(portfolio=Wcons, type="full_investment")*
>>
>> #Add Objective specification: VaR with default parameter for vector "mu"
>> (EXAMPLE 1)
>> *VaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
>> arguments=list(p=0.95), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=VaRObjSpec)
>> #* VaR
>> *0.0499467*
>>
>> #This is the VaR of the equal-weight portfolio as computed by the function
>> VaR in the PerformanceAnalytics package.
>> *VaRout <- VaR(indexes, weights=rep(1/4,4), p=0.95,
>> portfolio_method="component")*
>> *VaRout$MVaR       # *[1,]* 0.0499467*
>>
>> Now, I repet the VaR example with a user-defined vector for the parameter
>> "mu".
>>
>> #User-defined vector "mu"
>> *myMu = rep(0.01, 4)*
>>
>> #Add Objective specification: VaR with user-defined parameter for vector
>> "mu"
>> *myVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
>> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myVaRObjSpec)
>>   #* VaR *0.04638622*
>>
>> #This is the VaR of the equal-weight portfolio as computed by the function
>> VaR in the PerformanceAnalytics package with *mu=myMu.*
>> *myVaRout <- VaR(indexes, weights=rep(1/4,4),
>> p=0.95, mu=myMu, portfolio_method="component")*
>> *myVaRout$MVaR       # *[1,]* 0.04638622*
>>
>> So, using the default and user-defined parameter for "mu" there is
>> corrispondence between constrained_objective and the function VaR of
>> PerformanceAnalytics package.
>> I repet the example but now adding CVaR as risk objective in Wcons
>> portfolio.
>>
>> #Add Objective specification: CVaR with default parameter for vector "mu"
>> (EXAMPLE 2)
>> *CVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
>> arguments=list(p=0.95), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=CVaRObjSpec)
>>   #* ES
>> *0.1253199*
>>
>> #This is the CVaR of the equal-weight portfolio as computed by the
>> function
>> ES in the PerformanceAnalytics package.
>> *CVaRout <- ES(indexes, weights=rep(1/4,4), p=0.95,
>> portfolio_method="component")*
>> *CVaRout$MES       # *[1,]* 0.1253199*
>>
>> Now, I repet the CVaR example with a user-defined vector for the parameter
>> "mu".
>>
>> #User-defined vector "mu"
>> *myMu = rep(0.01, 4)*
>>
>> #Add Objective specification: CVaR with user-defined parameter for vector
>> "mu"
>> *myCVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
>> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myCVaRObjSpec)
>>   #* ES *0.1217594*
>>
>> #This should be the CVaR of the equal-weight portfolio as computed by the
>> function ES in the PerformanceAnalytics package with *mu=myMu.*
>> *myCVaRout <- ES(indexes, weights=rep(1/4,4),
>> p=0.95, mu=myMu, portfolio_method="component")*
>> *myCVaRout$MES       # *[1,]* 0.1235878*
>>
>> In this case, using the user-defined parameter for "mu" there is no
>> corrispondence between the value of constrained_objective (0.1217594*)
>> *and
>>
>> the result of function ES of PerformanceAnalytics package (0.1235878).
>> Why
>> there is no match in this case?
>> This not the case for the matrix parameter (for portfolio) "sigma": if I
>> use a user-defined sigma matrix, there is always corrispondence (without,
>> obviosly, costraints that augment the penalty augmented objective
>> function) between the value of constrained_objective (with VaR/CVaR risk
>> objective) and the result of function VaR/ES of PerformanceAnalytics
>> package.
>>
>> I hope my example is clear enough to illustrate the question.
>> Thanks a lot for your attention.
>> Marco
>>
>>
>> On Wed, Oct 12, 2016 at 1:55 AM, Michael Weylandt <
>> michael.weylandt at gmail.com> wrote:
>>
>> Hi Marco,
>>>
>>> Can you put together a minimal reproducible example [1,2] so that it's
>>> easier for others to answer your question?
>>>
>>> For this problem, I'd recommend using the edhec data distributed with
>>> PerformanceAnalytics.
>>>
>>> Thanks,
>>> Michael
>>>
>>> [1] http://stackoverflow.com/questions/5963269/how-to-make-
>>> a-great-r-reproducible-example
>>> [2] http://adv-r.had.co.nz/Reproducibility.html
>>>
>>> On Tue, Oct 11, 2016 at 11:46 AM, Marco Mastrangeli
>>> <marco.mastrangeli at gmail.com> wrote:
>>>
>>>> I have a question about the use of the "mu" parameter in the functions
>>>> StdDev, VaR e CVaR.
>>>> As reference data we can use data in the paper "Vignette: Portfolio
>>>> Optimization with CVaR budgets in PortfolioAnalytics".
>>>> If we use the default parameters for "mu" and "sigma", there is a
>>>> match between
>>>>
>>>> constrained_objective( w = rep(1/4,4) , R = indexes, portfolio =
>>>>> ObjSpec)
>>>>>
>>>>                 [,1]
>>>> ES 0.1253199
>>>>
>>>> and
>>>>
>>>> out<-ES(indexes, weights = rep(1/4,4),p=0.95,
>>>>>
>>>> portfolio_method="component")
>>>
>>>> out$MES
>>>>>
>>>>                  [,1]
>>>> [1,] 0.1253199
>>>>
>>>> as explained by the authors.
>>>> If I insert a user-defined sigma matrix for the "sigma" parameter, the
>>>> match is still there between this two exspressions. If I insert a
>>>> user-defined vector for the "mu" parameter (for example "mu=rep(0.01,
>>>>
>>> 4)",
>>>
>>>> the result of the two exspressions is the same only for portafolio with
>>>> risk objective function StdDev and VaR, not for CVaR.
>>>>
>>>> VaR case:
>>>>
>>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
>>>>>
>>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>>>>
>>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>>>>>
>>>>                    [,1]
>>>> VaR 0.04638622
>>>>
>>>> out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
>>>>>
>>>> portfolio_method="component")
>>>>
>>>>> out
>>>>>
>>>> $MVaR
>>>>                   [,1]
>>>> [1,] 0.04638622
>>>>
>>>>
>>>> CVaR case:
>>>>
>>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
>>>>>
>>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>>>>
>>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>>>>>
>>>>                  [,1]
>>>> ES 0.1217594
>>>>
>>>> out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
>>>>>
>>>> portfolio_method="component")
>>>>
>>>>> out
>>>>>
>>>> $MES
>>>>                  [,1]
>>>> [1,] 0.1235878
>>>>
>>>> I can't find the explanation for this thing. Thanks a lot for your
>>>> attention.
>>>>
>>>> Marco
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-SIG-Finance at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>>> -- Also note that this is not the r-help list where general R questions
>>>>
>>> should go.
>>>
>>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>>
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From michael.weylandt at gmail.com  Thu Oct 13 19:54:15 2016
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Thu, 13 Oct 2016 12:54:15 -0500
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
In-Reply-To: <57FE0EA3.90403@braverock.com>
References: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
	<CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>
	<CACb5SZ9TWn+EyDY+zMFotFpj3xUwsxvL089Za5XaHu0UC8boKg@mail.gmail.com>
	<57FE0EA3.90403@braverock.com>
Message-ID: <CAAmySGPSN55nLX_trbydC2+-NR69h=Qg8vuvCnrka4Z3p-nxfA@mail.gmail.com>

The issue seems to be in the calculation of the co-skewness and co-kurtosis.

In particular, when calling ES directly, the user-supplied mu gets
used to calculate M3 and M4. When called through PortfolioAnalytics,
M3 and M4 are calculated (without using mu) before calling ES.

A pure PerformanceAnalytics example:

###### < BEGIN EXAMPLE > ######
## Marco's problem
library(PerformanceAnalytics)
data(indexes)

R <- indexes[,1:4]

w <- rep(1/4, 4)
mu <- rep(0.01, 4)

M2 <- cov(R)
M3 <- M3.MM(R)
M4 <- M4.MM(R)

ES(R, portfolio_method="single", weights=w,
   sigma=M2, m3=M3, m4=M4, mu=mu, invert=FALSE)

ES(R, portfolio_method="component", weights=w, mu=mu)$MES

## Adding mu to the calculation of M3, M4 gives consistent answers
M2_mu <- cov(R)
M3_mu <- M3.MM(R, mu=mu)
M4_mu <- M4.MM(R, mu=mu)

ES(R, portfolio_method="single", weights=w,
   sigma=M2, m3=M3_mu, m4=M4_mu, mu=mu, invert=FALSE)

ES(R, portfolio_method="component", weights=w, mu=mu)$MES

##### < END EXAMPLE > ######

It looks like PortfolioAnalytics::set.portfolio.moments does not
attempt to pass a user supplied mu to PerformanceAnalytics::M3.MM and
PerformanceAnalytics::M4.MM, even if its given as an argument to
constrained_objective():

>From https://github.com/cran/PortfolioAnalytics/blob/master/R/moment.functions.R#L327

switch(method,
    sample = {
        if(is.null(momentargs$mu)) momentargs$mu = matrix(
as.vector(apply(tmpR, 2, 'mean')), ncol=1);
        if(is.null(momentargs$sigma)) momentargs$sigma = cov(tmpR)
        if(is.null(momentargs$m3)) momentargs$m3 =
PerformanceAnalytics::M3.MM(tmpR)
        if(is.null(momentargs$m4)) momentargs$m4 =
PerformanceAnalytics::M4.MM(tmpR)
},

[Code for the current development version looks to behave similarly]


Hope this helps,
Michael


On Wed, Oct 12, 2016 at 5:21 AM, Brian G. Peterson <brian at braverock.com> wrote:
> I attach what I think is a syntactically correct version of the email, which
> looks like it was pasted from HTML.
>
> We'll try to take a look.
>
> Regards,
>
> Brian
>
> On 10/12/2016 04:34 AM, Marco Mastrangeli wrote:
>>
>> Hi Michael,
>>
>> thanks for your reply, I apologize for the not full clarity of my
>> question.
>> In the following, I try to report a full example.
>>
>> #Library
>> *library(PerformanceAnalytics)*
>> *library(PortfolioAnalytics)*
>>
>> #Returns data present in "PortfolioAnalytics"
>> *data(indexes)*
>> *indexes <- indexes[,1:4]*
>>
>> #New Portfolio Object
>> *Wcons <- portfolio.spec(assets=colnames(indexes))*
>>
>> #Add box constraints
>> *Wcons <- add.constraint(portfolio=Wcons, type='box', min=0, max=1)*
>>
>> #Add the full investment constraint
>> *Wcons <- add.constraint(portfolio=Wcons, type="full_investment")*
>>
>> #Add Objective specification: VaR with default parameter for vector "mu"
>> (EXAMPLE 1)
>> *VaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
>> arguments=list(p=0.95), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=VaRObjSpec)
>> #* VaR
>> *0.0499467*
>>
>> #This is the VaR of the equal-weight portfolio as computed by the function
>> VaR in the PerformanceAnalytics package.
>> *VaRout <- VaR(indexes, weights=rep(1/4,4), p=0.95,
>> portfolio_method="component")*
>> *VaRout$MVaR       # *[1,]* 0.0499467*
>>
>> Now, I repet the VaR example with a user-defined vector for the parameter
>> "mu".
>>
>> #User-defined vector "mu"
>> *myMu = rep(0.01, 4)*
>>
>> #Add Objective specification: VaR with user-defined parameter for vector
>> "mu"
>> *myVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
>> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myVaRObjSpec)
>>   #* VaR *0.04638622*
>>
>> #This is the VaR of the equal-weight portfolio as computed by the function
>> VaR in the PerformanceAnalytics package with *mu=myMu.*
>> *myVaRout <- VaR(indexes, weights=rep(1/4,4),
>> p=0.95, mu=myMu, portfolio_method="component")*
>> *myVaRout$MVaR       # *[1,]* 0.04638622*
>>
>> So, using the default and user-defined parameter for "mu" there is
>> corrispondence between constrained_objective and the function VaR of
>> PerformanceAnalytics package.
>> I repet the example but now adding CVaR as risk objective in Wcons
>> portfolio.
>>
>> #Add Objective specification: CVaR with default parameter for vector "mu"
>> (EXAMPLE 2)
>> *CVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
>> arguments=list(p=0.95), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=CVaRObjSpec)
>> #* ES
>> *0.1253199*
>>
>> #This is the CVaR of the equal-weight portfolio as computed by the
>> function
>> ES in the PerformanceAnalytics package.
>> *CVaRout <- ES(indexes, weights=rep(1/4,4), p=0.95,
>> portfolio_method="component")*
>> *CVaRout$MES       # *[1,]* 0.1253199*
>>
>> Now, I repet the CVaR example with a user-defined vector for the parameter
>> "mu".
>>
>> #User-defined vector "mu"
>> *myMu = rep(0.01, 4)*
>>
>> #Add Objective specification: CVaR with user-defined parameter for vector
>> "mu"
>> *myCVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
>> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
>>
>> #The value of the objective function is:
>> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myCVaRObjSpec)
>>   #* ES *0.1217594*
>>
>> #This should be the CVaR of the equal-weight portfolio as computed by the
>> function ES in the PerformanceAnalytics package with *mu=myMu.*
>> *myCVaRout <- ES(indexes, weights=rep(1/4,4),
>> p=0.95, mu=myMu, portfolio_method="component")*
>> *myCVaRout$MES       # *[1,]* 0.1235878*
>>
>> In this case, using the user-defined parameter for "mu" there is no
>> corrispondence between the value of constrained_objective (0.1217594*)
>> *and
>>
>> the result of function ES of PerformanceAnalytics package (0.1235878). Why
>> there is no match in this case?
>> This not the case for the matrix parameter (for portfolio) "sigma": if I
>> use a user-defined sigma matrix, there is always corrispondence (without,
>> obviosly, costraints that augment the penalty augmented objective
>> function) between the value of constrained_objective (with VaR/CVaR risk
>> objective) and the result of function VaR/ES of PerformanceAnalytics
>> package.
>>
>> I hope my example is clear enough to illustrate the question.
>> Thanks a lot for your attention.
>> Marco
>>
>>
>> On Wed, Oct 12, 2016 at 1:55 AM, Michael Weylandt <
>> michael.weylandt at gmail.com> wrote:
>>
>>> Hi Marco,
>>>
>>> Can you put together a minimal reproducible example [1,2] so that it's
>>> easier for others to answer your question?
>>>
>>> For this problem, I'd recommend using the edhec data distributed with
>>> PerformanceAnalytics.
>>>
>>> Thanks,
>>> Michael
>>>
>>> [1] http://stackoverflow.com/questions/5963269/how-to-make-
>>> a-great-r-reproducible-example
>>> [2] http://adv-r.had.co.nz/Reproducibility.html
>>>
>>> On Tue, Oct 11, 2016 at 11:46 AM, Marco Mastrangeli
>>> <marco.mastrangeli at gmail.com> wrote:
>>>>
>>>> I have a question about the use of the "mu" parameter in the functions
>>>> StdDev, VaR e CVaR.
>>>> As reference data we can use data in the paper "Vignette: Portfolio
>>>> Optimization with CVaR budgets in PortfolioAnalytics".
>>>> If we use the default parameters for "mu" and "sigma", there is a
>>>> match between
>>>>
>>>>> constrained_objective( w = rep(1/4,4) , R = indexes, portfolio =
>>>>> ObjSpec)
>>>>
>>>>                 [,1]
>>>> ES 0.1253199
>>>>
>>>> and
>>>>
>>>>> out<-ES(indexes, weights = rep(1/4,4),p=0.95,
>>>
>>> portfolio_method="component")
>>>>>
>>>>> out$MES
>>>>
>>>>                  [,1]
>>>> [1,] 0.1253199
>>>>
>>>> as explained by the authors.
>>>> If I insert a user-defined sigma matrix for the "sigma" parameter, the
>>>> match is still there between this two exspressions. If I insert a
>>>> user-defined vector for the "mu" parameter (for example "mu=rep(0.01,
>>>
>>> 4)",
>>>>
>>>> the result of the two exspressions is the same only for portafolio with
>>>> risk objective function StdDev and VaR, not for CVaR.
>>>>
>>>> VaR case:
>>>>>
>>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
>>>>
>>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>>>>>
>>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>>>>
>>>>                    [,1]
>>>> VaR 0.04638622
>>>>
>>>>> out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
>>>>
>>>> portfolio_method="component")
>>>>>
>>>>> out
>>>>
>>>> $MVaR
>>>>                   [,1]
>>>> [1,] 0.04638622
>>>>
>>>>
>>>> CVaR case:
>>>>>
>>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
>>>>
>>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
>>>>>
>>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
>>>>
>>>>                  [,1]
>>>> ES 0.1217594
>>>>
>>>>> out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
>>>>
>>>> portfolio_method="component")
>>>>>
>>>>> out
>>>>
>>>> $MES
>>>>                  [,1]
>>>> [1,] 0.1235878
>>>>
>>>> I can't find the explanation for this thing. Thanks a lot for your
>>>> attention.
>>>>
>>>> Marco
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-SIG-Finance at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>>>> -- Subscriber-posting only. If you want to post, subscribe first.
>>>> -- Also note that this is not the r-help list where general R questions
>>>
>>> should go.
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.


From brian at braverock.com  Thu Oct 13 20:01:19 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Thu, 13 Oct 2016 13:01:19 -0500
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
In-Reply-To: <CAAmySGPSN55nLX_trbydC2+-NR69h=Qg8vuvCnrka4Z3p-nxfA@mail.gmail.com>
References: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
	<CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>
	<CACb5SZ9TWn+EyDY+zMFotFpj3xUwsxvL089Za5XaHu0UC8boKg@mail.gmail.com>
	<57FE0EA3.90403@braverock.com>
	<CAAmySGPSN55nLX_trbydC2+-NR69h=Qg8vuvCnrka4Z3p-nxfA@mail.gmail.com>
Message-ID: <1476381679.18920.7.camel@brian-rcg>

Yes, agreed.  This gets handled correctly, I think in
optimize.portfolio(), but when constrained_objective is called directly,
it looks like set.portfolio.moments doesn't merge arguments from ... or
the arguments=list correctly.

I think that the 'correct' way to deal with this would probably be to
handle it in dots, and make sure those get merged correctly.  I think it
would be much more challenging to process it from the argument=list()
for an individual objective.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


On Thu, 2016-10-13 at 12:54 -0500, Michael Weylandt wrote:
> The issue seems to be in the calculation of the co-skewness and co-kurtosis.
> 
> In particular, when calling ES directly, the user-supplied mu gets
> used to calculate M3 and M4. When called through PortfolioAnalytics,
> M3 and M4 are calculated (without using mu) before calling ES.
> 
> A pure PerformanceAnalytics example:
> 
> ###### < BEGIN EXAMPLE > ######
> ## Marco's problem
> library(PerformanceAnalytics)
> data(indexes)
> 
> R <- indexes[,1:4]
> 
> w <- rep(1/4, 4)
> mu <- rep(0.01, 4)
> 
> M2 <- cov(R)
> M3 <- M3.MM(R)
> M4 <- M4.MM(R)
> 
> ES(R, portfolio_method="single", weights=w,
>    sigma=M2, m3=M3, m4=M4, mu=mu, invert=FALSE)
> 
> ES(R, portfolio_method="component", weights=w, mu=mu)$MES
> 
> ## Adding mu to the calculation of M3, M4 gives consistent answers
> M2_mu <- cov(R)
> M3_mu <- M3.MM(R, mu=mu)
> M4_mu <- M4.MM(R, mu=mu)
> 
> ES(R, portfolio_method="single", weights=w,
>    sigma=M2, m3=M3_mu, m4=M4_mu, mu=mu, invert=FALSE)
> 
> ES(R, portfolio_method="component", weights=w, mu=mu)$MES
> 
> ##### < END EXAMPLE > ######
> 
> It looks like PortfolioAnalytics::set.portfolio.moments does not
> attempt to pass a user supplied mu to PerformanceAnalytics::M3.MM and
> PerformanceAnalytics::M4.MM, even if its given as an argument to
> constrained_objective():
> 
> >From https://github.com/cran/PortfolioAnalytics/blob/master/R/moment.functions.R#L327
> 
> switch(method,
>     sample = {
>         if(is.null(momentargs$mu)) momentargs$mu = matrix(
> as.vector(apply(tmpR, 2, 'mean')), ncol=1);
>         if(is.null(momentargs$sigma)) momentargs$sigma = cov(tmpR)
>         if(is.null(momentargs$m3)) momentargs$m3 =
> PerformanceAnalytics::M3.MM(tmpR)
>         if(is.null(momentargs$m4)) momentargs$m4 =
> PerformanceAnalytics::M4.MM(tmpR)
> },
> 
> [Code for the current development version looks to behave similarly]
> 
> 
> Hope this helps,
> Michael
> 
> 
> On Wed, Oct 12, 2016 at 5:21 AM, Brian G. Peterson <brian at braverock.com> wrote:
> > I attach what I think is a syntactically correct version of the email, which
> > looks like it was pasted from HTML.
> >
> > We'll try to take a look.
> >
> > Regards,
> >
> > Brian
> >
> > On 10/12/2016 04:34 AM, Marco Mastrangeli wrote:
> >>
> >> Hi Michael,
> >>
> >> thanks for your reply, I apologize for the not full clarity of my
> >> question.
> >> In the following, I try to report a full example.
> >>
> >> #Library
> >> *library(PerformanceAnalytics)*
> >> *library(PortfolioAnalytics)*
> >>
> >> #Returns data present in "PortfolioAnalytics"
> >> *data(indexes)*
> >> *indexes <- indexes[,1:4]*
> >>
> >> #New Portfolio Object
> >> *Wcons <- portfolio.spec(assets=colnames(indexes))*
> >>
> >> #Add box constraints
> >> *Wcons <- add.constraint(portfolio=Wcons, type='box', min=0, max=1)*
> >>
> >> #Add the full investment constraint
> >> *Wcons <- add.constraint(portfolio=Wcons, type="full_investment")*
> >>
> >> #Add Objective specification: VaR with default parameter for vector "mu"
> >> (EXAMPLE 1)
> >> *VaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
> >> arguments=list(p=0.95), enabled=TRUE)*
> >>
> >> #The value of the objective function is:
> >> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=VaRObjSpec)
> >> #* VaR
> >> *0.0499467*
> >>
> >> #This is the VaR of the equal-weight portfolio as computed by the function
> >> VaR in the PerformanceAnalytics package.
> >> *VaRout <- VaR(indexes, weights=rep(1/4,4), p=0.95,
> >> portfolio_method="component")*
> >> *VaRout$MVaR       # *[1,]* 0.0499467*
> >>
> >> Now, I repet the VaR example with a user-defined vector for the parameter
> >> "mu".
> >>
> >> #User-defined vector "mu"
> >> *myMu = rep(0.01, 4)*
> >>
> >> #Add Objective specification: VaR with user-defined parameter for vector
> >> "mu"
> >> *myVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
> >> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
> >>
> >> #The value of the objective function is:
> >> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myVaRObjSpec)
> >>   #* VaR *0.04638622*
> >>
> >> #This is the VaR of the equal-weight portfolio as computed by the function
> >> VaR in the PerformanceAnalytics package with *mu=myMu.*
> >> *myVaRout <- VaR(indexes, weights=rep(1/4,4),
> >> p=0.95, mu=myMu, portfolio_method="component")*
> >> *myVaRout$MVaR       # *[1,]* 0.04638622*
> >>
> >> So, using the default and user-defined parameter for "mu" there is
> >> corrispondence between constrained_objective and the function VaR of
> >> PerformanceAnalytics package.
> >> I repet the example but now adding CVaR as risk objective in Wcons
> >> portfolio.
> >>
> >> #Add Objective specification: CVaR with default parameter for vector "mu"
> >> (EXAMPLE 2)
> >> *CVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
> >> arguments=list(p=0.95), enabled=TRUE)*
> >>
> >> #The value of the objective function is:
> >> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=CVaRObjSpec)
> >> #* ES
> >> *0.1253199*
> >>
> >> #This is the CVaR of the equal-weight portfolio as computed by the
> >> function
> >> ES in the PerformanceAnalytics package.
> >> *CVaRout <- ES(indexes, weights=rep(1/4,4), p=0.95,
> >> portfolio_method="component")*
> >> *CVaRout$MES       # *[1,]* 0.1253199*
> >>
> >> Now, I repet the CVaR example with a user-defined vector for the parameter
> >> "mu".
> >>
> >> #User-defined vector "mu"
> >> *myMu = rep(0.01, 4)*
> >>
> >> #Add Objective specification: CVaR with user-defined parameter for vector
> >> "mu"
> >> *myCVaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="CVaR",
> >> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
> >>
> >> #The value of the objective function is:
> >> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=myCVaRObjSpec)
> >>   #* ES *0.1217594*
> >>
> >> #This should be the CVaR of the equal-weight portfolio as computed by the
> >> function ES in the PerformanceAnalytics package with *mu=myMu.*
> >> *myCVaRout <- ES(indexes, weights=rep(1/4,4),
> >> p=0.95, mu=myMu, portfolio_method="component")*
> >> *myCVaRout$MES       # *[1,]* 0.1235878*
> >>
> >> In this case, using the user-defined parameter for "mu" there is no
> >> corrispondence between the value of constrained_objective (0.1217594*)
> >> *and
> >>
> >> the result of function ES of PerformanceAnalytics package (0.1235878). Why
> >> there is no match in this case?
> >> This not the case for the matrix parameter (for portfolio) "sigma": if I
> >> use a user-defined sigma matrix, there is always corrispondence (without,
> >> obviosly, costraints that augment the penalty augmented objective
> >> function) between the value of constrained_objective (with VaR/CVaR risk
> >> objective) and the result of function VaR/ES of PerformanceAnalytics
> >> package.
> >>
> >> I hope my example is clear enough to illustrate the question.
> >> Thanks a lot for your attention.
> >> Marco
> >>
> >>
> >> On Wed, Oct 12, 2016 at 1:55 AM, Michael Weylandt <
> >> michael.weylandt at gmail.com> wrote:
> >>
> >>> Hi Marco,
> >>>
> >>> Can you put together a minimal reproducible example [1,2] so that it's
> >>> easier for others to answer your question?
> >>>
> >>> For this problem, I'd recommend using the edhec data distributed with
> >>> PerformanceAnalytics.
> >>>
> >>> Thanks,
> >>> Michael
> >>>
> >>> [1] http://stackoverflow.com/questions/5963269/how-to-make-
> >>> a-great-r-reproducible-example
> >>> [2] http://adv-r.had.co.nz/Reproducibility.html
> >>>
> >>> On Tue, Oct 11, 2016 at 11:46 AM, Marco Mastrangeli
> >>> <marco.mastrangeli at gmail.com> wrote:
> >>>>
> >>>> I have a question about the use of the "mu" parameter in the functions
> >>>> StdDev, VaR e CVaR.
> >>>> As reference data we can use data in the paper "Vignette: Portfolio
> >>>> Optimization with CVaR budgets in PortfolioAnalytics".
> >>>> If we use the default parameters for "mu" and "sigma", there is a
> >>>> match between
> >>>>
> >>>>> constrained_objective( w = rep(1/4,4) , R = indexes, portfolio =
> >>>>> ObjSpec)
> >>>>
> >>>>                 [,1]
> >>>> ES 0.1253199
> >>>>
> >>>> and
> >>>>
> >>>>> out<-ES(indexes, weights = rep(1/4,4),p=0.95,
> >>>
> >>> portfolio_method="component")
> >>>>>
> >>>>> out$MES
> >>>>
> >>>>                  [,1]
> >>>> [1,] 0.1253199
> >>>>
> >>>> as explained by the authors.
> >>>> If I insert a user-defined sigma matrix for the "sigma" parameter, the
> >>>> match is still there between this two exspressions. If I insert a
> >>>> user-defined vector for the "mu" parameter (for example "mu=rep(0.01,
> >>>
> >>> 4)",
> >>>>
> >>>> the result of the two exspressions is the same only for portafolio with
> >>>> risk objective function StdDev and VaR, not for CVaR.
> >>>>
> >>>> VaR case:
> >>>>>
> >>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
> >>>>
> >>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
> >>>>>
> >>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
> >>>>
> >>>>                    [,1]
> >>>> VaR 0.04638622
> >>>>
> >>>>> out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> >>>>
> >>>> portfolio_method="component")
> >>>>>
> >>>>> out
> >>>>
> >>>> $MVaR
> >>>>                   [,1]
> >>>> [1,] 0.04638622
> >>>>
> >>>>
> >>>> CVaR case:
> >>>>>
> >>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
> >>>>
> >>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
> >>>>>
> >>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
> >>>>
> >>>>                  [,1]
> >>>> ES 0.1217594
> >>>>
> >>>>> out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> >>>>
> >>>> portfolio_method="component")
> >>>>>
> >>>>> out
> >>>>
> >>>> $MES
> >>>>                  [,1]
> >>>> [1,] 0.1235878
> >>>>
> >>>> I can't find the explanation for this thing. Thanks a lot for your
> >>>> attention.
> >>>>
> >>>> Marco
> >>>>
> >>>>          [[alternative HTML version deleted]]
> >>>>
> >>>> _______________________________________________
> >>>> R-SIG-Finance at r-project.org mailing list
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >>>> -- Subscriber-posting only. If you want to post, subscribe first.
> >>>> -- Also note that this is not the r-help list where general R questions
> >>>
> >>> should go.
> >>>
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-SIG-Finance at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> >> -- Subscriber-posting only. If you want to post, subscribe first.
> >> -- Also note that this is not the r-help list where general R questions
> >> should go.
> >>
> >
> >
> > --
> > Brian G. Peterson
> > http://braverock.com/brian/
> > Ph: 773-459-4973
> > IM: bgpbraverock
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> > should go.
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From marco.mastrangeli at gmail.com  Fri Oct 14 11:25:06 2016
From: marco.mastrangeli at gmail.com (Marco Mastrangeli)
Date: Fri, 14 Oct 2016 11:25:06 +0200
Subject: [R-SIG-Finance] CVaR and Penalty Augmented objective function
In-Reply-To: <1476381679.18920.7.camel@brian-rcg>
References: <CACb5SZ-t4MDP+eWPSL8TuEAu_mQ7tpeP6B=gDwEDCC_ZeqaX6g@mail.gmail.com>
	<CAAmySGNdybcXh08yqfWcNkgExHMTHT7yH6MnDSntEvDxVE5dpA@mail.gmail.com>
	<CACb5SZ9TWn+EyDY+zMFotFpj3xUwsxvL089Za5XaHu0UC8boKg@mail.gmail.com>
	<57FE0EA3.90403@braverock.com>
	<CAAmySGPSN55nLX_trbydC2+-NR69h=Qg8vuvCnrka4Z3p-nxfA@mail.gmail.com>
	<1476381679.18920.7.camel@brian-rcg>
Message-ID: <CACb5SZ_WnkZKJ2qYd+0qeTAGxSfHafedf0AriDA0RrHK9V=S3g@mail.gmail.com>

Thanks Michael and Brian for your support, it was very helpful!
I have also noted that in the VaR example (my example 1) there is a match
with the *constrained_objective *and the VaR function because it seems
that,
unlike ES function, the VaR function doesn't consider user-defined mu for
the
calculation of m3 and m4 in the modified method.

Thanks a lot,
best regards
Marco

On Thu, Oct 13, 2016 at 8:01 PM, Brian G. Peterson <brian at braverock.com>
wrote:

> Yes, agreed.  This gets handled correctly, I think in
> optimize.portfolio(), but when constrained_objective is called directly,
> it looks like set.portfolio.moments doesn't merge arguments from ... or
> the arguments=list correctly.
>
> I think that the 'correct' way to deal with this would probably be to
> handle it in dots, and make sure those get merged correctly.  I think it
> would be much more challenging to process it from the argument=list()
> for an individual objective.
>
> Regards,
>
> Brian
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>
> On Thu, 2016-10-13 at 12:54 -0500, Michael Weylandt wrote:
> > The issue seems to be in the calculation of the co-skewness and
> co-kurtosis.
> >
> > In particular, when calling ES directly, the user-supplied mu gets
> > used to calculate M3 and M4. When called through PortfolioAnalytics,
> > M3 and M4 are calculated (without using mu) before calling ES.
> >
> > A pure PerformanceAnalytics example:
> >
> > ###### < BEGIN EXAMPLE > ######
> > ## Marco's problem
> > library(PerformanceAnalytics)
> > data(indexes)
> >
> > R <- indexes[,1:4]
> >
> > w <- rep(1/4, 4)
> > mu <- rep(0.01, 4)
> >
> > M2 <- cov(R)
> > M3 <- M3.MM(R)
> > M4 <- M4.MM(R)
> >
> > ES(R, portfolio_method="single", weights=w,
> >    sigma=M2, m3=M3, m4=M4, mu=mu, invert=FALSE)
> >
> > ES(R, portfolio_method="component", weights=w, mu=mu)$MES
> >
> > ## Adding mu to the calculation of M3, M4 gives consistent answers
> > M2_mu <- cov(R)
> > M3_mu <- M3.MM(R, mu=mu)
> > M4_mu <- M4.MM(R, mu=mu)
> >
> > ES(R, portfolio_method="single", weights=w,
> >    sigma=M2, m3=M3_mu, m4=M4_mu, mu=mu, invert=FALSE)
> >
> > ES(R, portfolio_method="component", weights=w, mu=mu)$MES
> >
> > ##### < END EXAMPLE > ######
> >
> > It looks like PortfolioAnalytics::set.portfolio.moments does not
> > attempt to pass a user supplied mu to PerformanceAnalytics::M3.MM and
> > PerformanceAnalytics::M4.MM, even if its given as an argument to
> > constrained_objective():
> >
> > >From https://github.com/cran/PortfolioAnalytics/blob/
> master/R/moment.functions.R#L327
> >
> > switch(method,
> >     sample = {
> >         if(is.null(momentargs$mu)) momentargs$mu = matrix(
> > as.vector(apply(tmpR, 2, 'mean')), ncol=1);
> >         if(is.null(momentargs$sigma)) momentargs$sigma = cov(tmpR)
> >         if(is.null(momentargs$m3)) momentargs$m3 =
> > PerformanceAnalytics::M3.MM(tmpR)
> >         if(is.null(momentargs$m4)) momentargs$m4 =
> > PerformanceAnalytics::M4.MM(tmpR)
> > },
> >
> > [Code for the current development version looks to behave similarly]
> >
> >
> > Hope this helps,
> > Michael
> >
> >
> > On Wed, Oct 12, 2016 at 5:21 AM, Brian G. Peterson <brian at braverock.com>
> wrote:
> > > I attach what I think is a syntactically correct version of the email,
> which
> > > looks like it was pasted from HTML.
> > >
> > > We'll try to take a look.
> > >
> > > Regards,
> > >
> > > Brian
> > >
> > > On 10/12/2016 04:34 AM, Marco Mastrangeli wrote:
> > >>
> > >> Hi Michael,
> > >>
> > >> thanks for your reply, I apologize for the not full clarity of my
> > >> question.
> > >> In the following, I try to report a full example.
> > >>
> > >> #Library
> > >> *library(PerformanceAnalytics)*
> > >> *library(PortfolioAnalytics)*
> > >>
> > >> #Returns data present in "PortfolioAnalytics"
> > >> *data(indexes)*
> > >> *indexes <- indexes[,1:4]*
> > >>
> > >> #New Portfolio Object
> > >> *Wcons <- portfolio.spec(assets=colnames(indexes))*
> > >>
> > >> #Add box constraints
> > >> *Wcons <- add.constraint(portfolio=Wcons, type='box', min=0, max=1)*
> > >>
> > >> #Add the full investment constraint
> > >> *Wcons <- add.constraint(portfolio=Wcons, type="full_investment")*
> > >>
> > >> #Add Objective specification: VaR with default parameter for vector
> "mu"
> > >> (EXAMPLE 1)
> > >> *VaRObjSpec <- add.objective(portfolio=Wcons, type="risk", name="VaR",
> > >> arguments=list(p=0.95), enabled=TRUE)*
> > >>
> > >> #The value of the objective function is:
> > >> *constrained_objective(w=rep(1/4,4), R=indexes, portfolio=VaRObjSpec)
> > >> #* VaR
> > >> *0.0499467*
> > >>
> > >> #This is the VaR of the equal-weight portfolio as computed by the
> function
> > >> VaR in the PerformanceAnalytics package.
> > >> *VaRout <- VaR(indexes, weights=rep(1/4,4), p=0.95,
> > >> portfolio_method="component")*
> > >> *VaRout$MVaR       # *[1,]* 0.0499467*
> > >>
> > >> Now, I repet the VaR example with a user-defined vector for the
> parameter
> > >> "mu".
> > >>
> > >> #User-defined vector "mu"
> > >> *myMu = rep(0.01, 4)*
> > >>
> > >> #Add Objective specification: VaR with user-defined parameter for
> vector
> > >> "mu"
> > >> *myVaRObjSpec <- add.objective(portfolio=Wcons, type="risk",
> name="VaR",
> > >> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
> > >>
> > >> #The value of the objective function is:
> > >> *constrained_objective(w=rep(1/4,4), R=indexes,
> portfolio=myVaRObjSpec)
> > >>   #* VaR *0.04638622*
> > >>
> > >> #This is the VaR of the equal-weight portfolio as computed by the
> function
> > >> VaR in the PerformanceAnalytics package with *mu=myMu.*
> > >> *myVaRout <- VaR(indexes, weights=rep(1/4,4),
> > >> p=0.95, mu=myMu, portfolio_method="component")*
> > >> *myVaRout$MVaR       # *[1,]* 0.04638622*
> > >>
> > >> So, using the default and user-defined parameter for "mu" there is
> > >> corrispondence between constrained_objective and the function VaR of
> > >> PerformanceAnalytics package.
> > >> I repet the example but now adding CVaR as risk objective in Wcons
> > >> portfolio.
> > >>
> > >> #Add Objective specification: CVaR with default parameter for vector
> "mu"
> > >> (EXAMPLE 2)
> > >> *CVaRObjSpec <- add.objective(portfolio=Wcons, type="risk",
> name="CVaR",
> > >> arguments=list(p=0.95), enabled=TRUE)*
> > >>
> > >> #The value of the objective function is:
> > >> *constrained_objective(w=rep(1/4,4), R=indexes,
> portfolio=CVaRObjSpec)
> > >> #* ES
> > >> *0.1253199*
> > >>
> > >> #This is the CVaR of the equal-weight portfolio as computed by the
> > >> function
> > >> ES in the PerformanceAnalytics package.
> > >> *CVaRout <- ES(indexes, weights=rep(1/4,4), p=0.95,
> > >> portfolio_method="component")*
> > >> *CVaRout$MES       # *[1,]* 0.1253199*
> > >>
> > >> Now, I repet the CVaR example with a user-defined vector for the
> parameter
> > >> "mu".
> > >>
> > >> #User-defined vector "mu"
> > >> *myMu = rep(0.01, 4)*
> > >>
> > >> #Add Objective specification: CVaR with user-defined parameter for
> vector
> > >> "mu"
> > >> *myCVaRObjSpec <- add.objective(portfolio=Wcons, type="risk",
> name="CVaR",
> > >> arguments=list(p=0.95, mu=myMu), enabled=TRUE)*
> > >>
> > >> #The value of the objective function is:
> > >> *constrained_objective(w=rep(1/4,4), R=indexes,
> portfolio=myCVaRObjSpec)
> > >>   #* ES *0.1217594*
> > >>
> > >> #This should be the CVaR of the equal-weight portfolio as computed by
> the
> > >> function ES in the PerformanceAnalytics package with *mu=myMu.*
> > >> *myCVaRout <- ES(indexes, weights=rep(1/4,4),
> > >> p=0.95, mu=myMu, portfolio_method="component")*
> > >> *myCVaRout$MES       # *[1,]* 0.1235878*
> > >>
> > >> In this case, using the user-defined parameter for "mu" there is no
> > >> corrispondence between the value of constrained_objective (0.1217594*)
> > >> *and
> > >>
> > >> the result of function ES of PerformanceAnalytics package
> (0.1235878). Why
> > >> there is no match in this case?
> > >> This not the case for the matrix parameter (for portfolio) "sigma":
> if I
> > >> use a user-defined sigma matrix, there is always corrispondence
> (without,
> > >> obviosly, costraints that augment the penalty augmented objective
> > >> function) between the value of constrained_objective (with VaR/CVaR
> risk
> > >> objective) and the result of function VaR/ES of PerformanceAnalytics
> > >> package.
> > >>
> > >> I hope my example is clear enough to illustrate the question.
> > >> Thanks a lot for your attention.
> > >> Marco
> > >>
> > >>
> > >> On Wed, Oct 12, 2016 at 1:55 AM, Michael Weylandt <
> > >> michael.weylandt at gmail.com> wrote:
> > >>
> > >>> Hi Marco,
> > >>>
> > >>> Can you put together a minimal reproducible example [1,2] so that
> it's
> > >>> easier for others to answer your question?
> > >>>
> > >>> For this problem, I'd recommend using the edhec data distributed with
> > >>> PerformanceAnalytics.
> > >>>
> > >>> Thanks,
> > >>> Michael
> > >>>
> > >>> [1] http://stackoverflow.com/questions/5963269/how-to-make-
> > >>> a-great-r-reproducible-example
> > >>> [2] http://adv-r.had.co.nz/Reproducibility.html
> > >>>
> > >>> On Tue, Oct 11, 2016 at 11:46 AM, Marco Mastrangeli
> > >>> <marco.mastrangeli at gmail.com> wrote:
> > >>>>
> > >>>> I have a question about the use of the "mu" parameter in the
> functions
> > >>>> StdDev, VaR e CVaR.
> > >>>> As reference data we can use data in the paper "Vignette: Portfolio
> > >>>> Optimization with CVaR budgets in PortfolioAnalytics".
> > >>>> If we use the default parameters for "mu" and "sigma", there is a
> > >>>> match between
> > >>>>
> > >>>>> constrained_objective( w = rep(1/4,4) , R = indexes, portfolio =
> > >>>>> ObjSpec)
> > >>>>
> > >>>>                 [,1]
> > >>>> ES 0.1253199
> > >>>>
> > >>>> and
> > >>>>
> > >>>>> out<-ES(indexes, weights = rep(1/4,4),p=0.95,
> > >>>
> > >>> portfolio_method="component")
> > >>>>>
> > >>>>> out$MES
> > >>>>
> > >>>>                  [,1]
> > >>>> [1,] 0.1253199
> > >>>>
> > >>>> as explained by the authors.
> > >>>> If I insert a user-defined sigma matrix for the "sigma" parameter,
> the
> > >>>> match is still there between this two exspressions. If I insert a
> > >>>> user-defined vector for the "mu" parameter (for example
> "mu=rep(0.01,
> > >>>
> > >>> 4)",
> > >>>>
> > >>>> the result of the two exspressions is the same only for portafolio
> with
> > >>>> risk objective function StdDev and VaR, not for CVaR.
> > >>>>
> > >>>> VaR case:
> > >>>>>
> > >>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="VaR",
> > >>>>
> > >>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
> > >>>>>
> > >>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
> > >>>>
> > >>>>                    [,1]
> > >>>> VaR 0.04638622
> > >>>>
> > >>>>> out<-VaR(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> > >>>>
> > >>>> portfolio_method="component")
> > >>>>>
> > >>>>> out
> > >>>>
> > >>>> $MVaR
> > >>>>                   [,1]
> > >>>> [1,] 0.04638622
> > >>>>
> > >>>>
> > >>>> CVaR case:
> > >>>>>
> > >>>>> ObjSpec = add.objective(portfolio=Wcons, type="risk", name="CVaR",
> > >>>>
> > >>>> arguments=list(p=0.95, mu=rep(0.01,4)), enabled=TRUE)
> > >>>>>
> > >>>>> constrained_objective(w=rep(1/4,4), R=indexes, portfolio=ObjSpec)
> > >>>>
> > >>>>                  [,1]
> > >>>> ES 0.1217594
> > >>>>
> > >>>>> out<-ES(indexes, weights=rep(1/4,4), p=0.95, mu=rep(0.01,4),
> > >>>>
> > >>>> portfolio_method="component")
> > >>>>>
> > >>>>> out
> > >>>>
> > >>>> $MES
> > >>>>                  [,1]
> > >>>> [1,] 0.1235878
> > >>>>
> > >>>> I can't find the explanation for this thing. Thanks a lot for your
> > >>>> attention.
> > >>>>
> > >>>> Marco
> > >>>>
> > >>>>          [[alternative HTML version deleted]]
> > >>>>
> > >>>> _______________________________________________
> > >>>> R-SIG-Finance at r-project.org mailing list
> > >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > >>>> -- Subscriber-posting only. If you want to post, subscribe first.
> > >>>> -- Also note that this is not the r-help list where general R
> questions
> > >>>
> > >>> should go.
> > >>>
> > >>
> > >>         [[alternative HTML version deleted]]
> > >>
> > >> _______________________________________________
> > >> R-SIG-Finance at r-project.org mailing list
> > >> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > >> -- Subscriber-posting only. If you want to post, subscribe first.
> > >> -- Also note that this is not the r-help list where general R
> questions
> > >> should go.
> > >>
> > >
> > >
> > > --
> > > Brian G. Peterson
> > > http://braverock.com/brian/
> > > Ph: 773-459-4973
> > > IM: bgpbraverock
> > >
> > > _______________________________________________
> > > R-SIG-Finance at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > > -- Subscriber-posting only. If you want to post, subscribe first.
> > > -- Also note that this is not the r-help list where general R questions
> > > should go.
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> should go.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From carolina.magda.adm at gmail.com  Sat Oct 15 15:13:09 2016
From: carolina.magda.adm at gmail.com (Carolina Magda Roma)
Date: Sat, 15 Oct 2016 15:13:09 +0200
Subject: [R-SIG-Finance] number of observations - rugarch
Message-ID: <CACTi1Uphy3Ty=5tDcjVi0T1L-S+pzr_EcYt=Q=Km5SkOdatw0g@mail.gmail.com>

Dear all,

First I want to say thanks for the beautiful rugarch package!

I am trying to replicate some results and I would like to know if there is
any adjustment that I can do to run the egarch model with external
regressors using less than 100 observations. I tried to run my model but
returns the message error below:

library(rugarch)
library(xts)
data(sp500ret)
spx<-xts(sp500ret, as.Date(rownames(sp500ret)))
xreg<-xts(rnorm(nrow(spx)), index(spx))
colnames(xreg)<-"xreg"
xreg = lag(xreg,1)
inputs<-na.omit(cbind(spx, xreg, join="left"))

egarch.spec = ugarchspec(variance.model = list(model = 'eGARCH', garchOrder
= c(1, 1)), mean.model = list(armaOrder = c(0, 0), include.mean = TRUE,

    external.regressors= inputs[1:60,2]), distribution.model = 'sged')
egarch.fit = ugarchfit(egarch.spec, inputs[1:60,1])
egarch.fcst = ugarchforecast(egarch.fit, n.ahead=1)

Error in .egarchfit(spec = spec, data = data, out.sample = out.sample,  :

ugarchfit-->error: function requires at least 100 data
 points to run


Thanks a lot for any help!

Carol Silva

	[[alternative HTML version deleted]]


From patrick at burns-stat.com  Sat Oct 15 22:20:30 2016
From: patrick at burns-stat.com (Patrick Burns)
Date: Sat, 15 Oct 2016 21:20:30 +0100
Subject: [R-SIG-Finance] number of observations - rugarch
In-Reply-To: <CACTi1Uphy3Ty=5tDcjVi0T1L-S+pzr_EcYt=Q=Km5SkOdatw0g@mail.gmail.com>
References: <CACTi1Uphy3Ty=5tDcjVi0T1L-S+pzr_EcYt=Q=Km5SkOdatw0g@mail.gmail.com>
Message-ID: <c310e2ce-b54b-840b-2e43-5ebc2d4313a1@burns-stat.com>

Rather than answer the question, I'll talk past it.

I'm not convinced that it's worthwhile to worry about a garch model with 
less than 100 observations.  See:

http://www.portfolioprobe.com/2012/09/17/variability-of-garch-estimates/

and the blog post that is referenced in the update.

Good luck, Carolina, in any case.

Pat

On 15/10/2016 14:13, Carolina Magda Roma wrote:
> Dear all,
>
> First I want to say thanks for the beautiful rugarch package!
>
> I am trying to replicate some results and I would like to know if there is
> any adjustment that I can do to run the egarch model with external
> regressors using less than 100 observations. I tried to run my model but
> returns the message error below:
>
> library(rugarch)
> library(xts)
> data(sp500ret)
> spx<-xts(sp500ret, as.Date(rownames(sp500ret)))
> xreg<-xts(rnorm(nrow(spx)), index(spx))
> colnames(xreg)<-"xreg"
> xreg = lag(xreg,1)
> inputs<-na.omit(cbind(spx, xreg, join="left"))
>
> egarch.spec = ugarchspec(variance.model = list(model = 'eGARCH', garchOrder
> = c(1, 1)), mean.model = list(armaOrder = c(0, 0), include.mean = TRUE,
>
>     external.regressors= inputs[1:60,2]), distribution.model = 'sged')
> egarch.fit = ugarchfit(egarch.spec, inputs[1:60,1])
> egarch.fcst = ugarchforecast(egarch.fit, n.ahead=1)
>
> Error in .egarchfit(spec = spec, data = data, out.sample = out.sample,  :
>
> ugarchfit-->error: function requires at least 100 data
>  points to run
>
>
> Thanks a lot for any help!
>
> Carol Silva
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.
>

-- 
Patrick Burns
patrick at burns-stat.com
http://www.burns-stat.com
http://www.portfolioprobe.com/blog
twitter: @burnsstat @portfolioprobe


From andrea_bosio at rocketmail.com  Sun Oct 16 21:00:09 2016
From: andrea_bosio at rocketmail.com (Andrea Bosio)
Date: Sun, 16 Oct 2016 21:00:09 +0200
Subject: [R-SIG-Finance] Loop For - ARMA model estimation and selection
Message-ID: <4a1aefca-5da4-a360-938a-e06970ee949a@rocketmail.com>

Hi,

Suppose that I have the following loop for estimating ARMA models on a 
series of log-returns. The loop varies both the p and the q orders 
between 0 and 10. The returned objects are the matrices of respectively 
the Akaike Information Criterion indicators for model goodness of fit, 
the model equation coefficients, the p-values of the Augmented Dickey 
Fuller test for stationarity of the residuals, the p-values of Box Ljung 
tests for serial uncorrelation and independence of the residuals and the 
p-values of the Jarque Bera test for normality of the residuals.

My questions are:

1)How do you tell R not to display the AIC, the model coefficients and 
all the tests p-values in the case the estimated ARMA model features 
convergence problems? That would probably require to specify an IF 
condition in the loop which I am not currently able to do.

2)Take a look at the ?fit degrees of freedom? argument of the Box tests 
for serial uncorrelation and independence. There I need to tell R to fit 
a number of degrees of freedom which equals p+q (the sum of the orders 
of the estimated ARMA model). Is it correct to write fitdf=i+j+2 as I did?

3)How could I loop for a third variable which is 
?include.mean=TRUE/FALSE?? I tried to loop over a third, string-type 
variable z<-c(TRUE,FALSE) but always got the error message: ?error no 
'dimnames' attribute for array?.

Please note that I am an R beginner. So any help from anybody is deeply 
appreciated.

Here follows the code.

USDlogreturns=diff(log(prices))

armaaicmat=matrix(NA, 11, 11)

armacoefmat=matrix(NA,121,23)

armaadftestmat=matrix(NA, 11, 11)

armaboxtestmat=matrix(NA, 11, 11)

armaboxtest2mat=matrix(NA, 11, 11)

armajarqueberamat=matrix(NA, 11, 11)

k=0

for(i in 0:10){

for(j in 0:10){

k=k+1

fit <- arima(USDlogreturns, order=c(i,0,j), include.mean=TRUE)

armaaicmat[i+1,j+1] = fit$aic

if(i>0) armacoefmat[k,c(1:i) ]=fit$coef[c(1 :i )]

if(j>0) armacoefmat[k,c(13:(12+j))]=fit$coef[c((i+1):(i+j))]

armacoefmat[k,23]=tail(fit$coef,1)

armaadftestmat[i+1,j+1]=adf.test(fit$resid,k=trunc((length(fit$resid)-1)^(1/3)))$p.value

armaboxtestmat[i+1,j+1]=Box.test(fit$resid, fitdf=i+j+2, 
lag=30,type=c("Ljung-Box"))$p.value

armaboxtest2mat[i+1,j+1]=Box.test(fit$resid^2, fitdf=i+j+2, 
lag=30,type=c("Ljung-Box"))$p.value

armajarqueberamat[i+1,j+1]=jarque.bera.test(fit$resid)$p.value

}

}



---
Questa e-mail ? stata controllata per individuare virus con Avast antivirus.
https://www.avast.com/antivirus

	[[alternative HTML version deleted]]


From andrea_bosio at rocketmail.com  Sun Oct 16 21:53:05 2016
From: andrea_bosio at rocketmail.com (Andrea Bosio)
Date: Sun, 16 Oct 2016 21:53:05 +0200
Subject: [R-SIG-Finance] Loop For - ARMA+GARCH Model estimation and selection
Message-ID: <a4e8cc4c-2254-8a50-0271-438e69c58d18@rocketmail.com>

Hello,

I would like to put you the other question that I have about how to use 
loops for in R. The first is entitled ?Loop For ? ARMA model estimation 
and selection?. If you take a look and try to give me an answer to the 
first, I would be extremely thankful. I am an R beginner and I need R 
technical experts? judgement to conduct my empirical analysis as 
efficiently as I can.

My second question is on how to loop over six variables (a,b,c,d,e) for 
an ARMA+GARCH model estimation.

Here is the function to loop.

USDlogreturns=diff(log(prices))

model<-ugarchspec(variance.model=list(model="fGARCH",submodel="c",garchOrder=c(d,e)),mean.model=list(armaOrder=c(a,b),include.mean=TRUE),distribution.model="f")

modelfit<-ugarchfit(spec=model, data=USDlogreturns, solver="hybrid")

Here is a description of the variables from a to f to be looped.

?ARMA orders (a,b). Both orders should be allowed to vary between 0 and 10.

?GARCH version (c). The versions should be allowed to switch from GARCH 
to AVGARCH, GJRGARCH, TGARCH, NGARCH, NAGARCH, APARCH and EGARCH. Note 
that the EGARCH version must be passed directly as ?model? to the 
ugarchfit function.

?GARCH orders (d,e). The d order should be allowed to vary between 1 and 
2. The e order should be allowed to vary between 0 and 2.

?Error distribution (f). The error distribution should be allowed to 
switch from Normal Gaussian to Student-T and GED.

The objects to be returned from the loop are the model Akaike 
Information Criterion indicators, the p-values of the ADF test for 
standardized (stz) residual stationarity, the p-values of the Box-Ljung 
tests for stz residual serial uncorrelation and independence and the 
p-values of the Jarque-Bera test for stz residual normality. Here is the 
full list of the objects.

armagarchaic=infocriteria(modelfit)[1]

armagarchadftest=adf.test(modelfit at fit$z,k=trunc((length(modelfit at fit$z)-1)^(1/3)))$p.value

armagarchboxtest=Box.test(modelfit at fit$z,lag=30,fitdf=d+e,type=c("Ljung-Box"))$p.value

armagarchboxtest2=Box.test(modelfit at fit$z^2,lag=30,fitdf=d+e,type=c("Ljung-Box"))$p.value

armagarchgoftest=gof(modelfit,c(20,30,40,50))

P.S. How do you tell R to set (d+e) (i.e. the sum of ARCH and GARCH 
orders) as fitdf in the Box-Ljung test command? Is it right as I typed?

If you also believe that I should run the same model estimation in a 
simpler and efficient way, let me know on how to do that.

Thank you in advance.



---
Questa e-mail ? stata controllata per individuare virus con Avast antivirus.
https://www.avast.com/antivirus

	[[alternative HTML version deleted]]


From andrea_bosio at rocketmail.com  Sun Oct 16 22:22:59 2016
From: andrea_bosio at rocketmail.com (Andrea Bosio)
Date: Sun, 16 Oct 2016 22:22:59 +0200
Subject: [R-SIG-Finance] Loop For - ARMA+GARCH Model estimation and
 selection
In-Reply-To: <a4e8cc4c-2254-8a50-0271-438e69c58d18@rocketmail.com>
References: <a4e8cc4c-2254-8a50-0271-438e69c58d18@rocketmail.com>
Message-ID: <09e593bb-8926-6f21-85fb-c651f70e7b25@rocketmail.com>

Sorry there is a repo.

In my description I wanted to say that the test for the correctness of 
the stz residual distribution is the Pearson Adjusted Chi-Square, not 
the JB.

Apologies.


Il 16/10/2016 21:53, Andrea Bosio via R-SIG-Finance ha scritto:
> Hello,
>
> I would like to put you the other question that I have about how to use
> loops for in R. The first is entitled ?Loop For ? ARMA model estimation
> and selection?. If you take a look and try to give me an answer to the
> first, I would be extremely thankful. I am an R beginner and I need R
> technical experts? judgement to conduct my empirical analysis as
> efficiently as I can.
>
> My second question is on how to loop over six variables (a,b,c,d,e) for
> an ARMA+GARCH model estimation.
>
> Here is the function to loop.
>
> USDlogreturns=diff(log(prices))
>
> model<-ugarchspec(variance.model=list(model="fGARCH",submodel="c",garchOrder=c(d,e)),mean.model=list(armaOrder=c(a,b),include.mean=TRUE),distribution.model="f")
>
> modelfit<-ugarchfit(spec=model, data=USDlogreturns, solver="hybrid")
>
> Here is a description of the variables from a to f to be looped.
>
> ?ARMA orders (a,b). Both orders should be allowed to vary between 0 and 10.
>
> ?GARCH version (c). The versions should be allowed to switch from GARCH
> to AVGARCH, GJRGARCH, TGARCH, NGARCH, NAGARCH, APARCH and EGARCH. Note
> that the EGARCH version must be passed directly as ?model? to the
> ugarchfit function.
>
> ?GARCH orders (d,e). The d order should be allowed to vary between 1 and
> 2. The e order should be allowed to vary between 0 and 2.
>
> ?Error distribution (f). The error distribution should be allowed to
> switch from Normal Gaussian to Student-T and GED.
>
> The objects to be returned from the loop are the model Akaike
> Information Criterion indicators, the p-values of the ADF test for
> standardized (stz) residual stationarity, the p-values of the Box-Ljung
> tests for stz residual serial uncorrelation and independence and the
> p-values of the Jarque-Bera test for stz residual normality. Here is the
> full list of the objects.
>
> armagarchaic=infocriteria(modelfit)[1]
>
> armagarchadftest=adf.test(modelfit at fit$z,k=trunc((length(modelfit at fit$z)-1)^(1/3)))$p.value
>
> armagarchboxtest=Box.test(modelfit at fit$z,lag=30,fitdf=d+e,type=c("Ljung-Box"))$p.value
>
> armagarchboxtest2=Box.test(modelfit at fit$z^2,lag=30,fitdf=d+e,type=c("Ljung-Box"))$p.value
>
> armagarchgoftest=gof(modelfit,c(20,30,40,50))
>
> P.S. How do you tell R to set (d+e) (i.e. the sum of ARCH and GARCH
> orders) as fitdf in the Box-Ljung test command? Is it right as I typed?
>
> If you also believe that I should run the same model estimation in a
> simpler and efficient way, let me know on how to do that.
>
> Thank you in advance.
>
>
>
> ---
> Questa e-mail ? stata controllata per individuare virus con Avast antivirus.
> https://www.avast.com/antivirus
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


---
Questa e-mail ? stata controllata per individuare virus con Avast antivirus.
https://www.avast.com/antivirus


From sebastian.bayer at uni-konstanz.de  Tue Oct 18 17:15:41 2016
From: sebastian.bayer at uni-konstanz.de (Sebastian Bayer)
Date: Tue, 18 Oct 2016 17:15:41 +0200
Subject: [R-SIG-Finance] rugarch: memory not mapped error
Message-ID: <CA+akxBOXNFNfpQgi2OzaTaLZ1mV=FTMn5LNVyCcq3=_pmw-7+A@mail.gmail.com>

Hello,

after I updated all my R packages today, loading the rugarch library yields
a memory not mapped error.

> sessionInfo()
R version 3.3.1 (2016-06-21)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04 LTS

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=de_DE.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


> library(rugarch)
Loading required package: parallel

 *** caught segfault ***
address 0x20, cause 'memory not mapped'

Traceback:
 1: .Call(Module__functions_names, xp)
 2: Module(module, mustStart = TRUE, where = env)
 3: doTryCatch(return(expr), name, parentenv, handler)
 4: tryCatchOne(expr, names, parentenv, handlers[[1L]])
 5: tryCatchList(expr, classes, parentenv, handlers)
 6: tryCatch(Module(module, mustStart = TRUE, where = env), error =
function(e) e)
 7: loadModule(module = "Multicool", what = TRUE, env = ns, loadNow = TRUE)
 8: (function (ns) loadModule(module = "Multicool", what = TRUE, env = ns,
loadNow = TRUE))(<environment>)
 9: doTryCatch(return(expr), name, parentenv, handler)
10: tryCatchOne(expr, names, parentenv, handlers[[1L]])
11: tryCatchList(expr, classes, parentenv, handlers)
12: tryCatch((function (ns) loadModule(module = "Multicool", what = TRUE,
env = ns, loadNow = TRUE))(<environment>),     error = function(e) e)
13: eval(expr, envir, enclos)
14: eval(substitute(tryCatch(FUN(WHERE), error = function(e) e),
list(FUN = f, WHERE = where)), where)
15: .doLoadActions(where, attach)
16: methods::cacheMetaData(ns, TRUE, ns)
17: loadNamespace(i, c(lib.loc, .libPaths()), versionCheck = vI[[i]])
18: namespaceImport(ns, loadNamespace(i, c(lib.loc, .libPaths()),
versionCheck = vI[[i]]), from = package)
19: loadNamespace(j <- i[[1L]], c(lib.loc, .libPaths()), versionCheck =
vI[[j]])
20: asNamespace(ns)
21: namespaceImportFrom(ns, loadNamespace(j <- i[[1L]], c(lib.loc,
.libPaths()), versionCheck = vI[[j]]), i[[2L]], from = package)
22: loadNamespace(package, lib.loc)
23: doTryCatch(return(expr), name, parentenv, handler)
24: tryCatchOne(expr, names, parentenv, handlers[[1L]])
25: tryCatchList(expr, classes, parentenv, handlers)
26: tryCatch(expr, error = function(e) {    call <- conditionCall(e)    if
(!is.null(call)) {        if (identical(call[[1L]], quote(doTryCatch)))
        call <- sys.call(-4L)        dcall <- deparse(call)[1L]
 prefix <- paste("Error in", dcall, ": ")        LONG <- 75L        msg <-
conditionMessage(e)        sm <- strsplit(msg, "\n")[[1L]]        w <- 14L
+ nchar(dcall, type = "w") + nchar(sm[1L], type = "w")        if (is.na(w))
            w <- 14L + nchar(dcall, type = "b") + nchar(sm[1L],
    type = "b")        if (w > LONG)             prefix <- paste0(prefix,
"\n  ")    }    else prefix <- "Error : "    msg <- paste0(prefix,
conditionMessage(e), "\n")    .Internal(seterrmessage(msg[1L]))    if
(!silent && identical(getOption("show.error.messages"),         TRUE)) {
     cat(msg, file = stderr())        .Internal(printDeferredWarnings())
 }    invisible(structure(msg, class = "try-error", condition = e))})
27: try({    attr(package, "LibPath") <- which.lib.loc    ns <-
loadNamespace(package, lib.loc)    env <- attachNamespace(ns, pos = pos,
deps)})
28: library(rugarch)

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection:


Regards
Sebastian

	[[alternative HTML version deleted]]


From sebastian.bayer at uni-konstanz.de  Wed Oct 19 13:45:04 2016
From: sebastian.bayer at uni-konstanz.de (Sebastian Bayer)
Date: Wed, 19 Oct 2016 13:45:04 +0200
Subject: [R-SIG-Finance] rugarch: memory not mapped error
In-Reply-To: <CA+akxBOXNFNfpQgi2OzaTaLZ1mV=FTMn5LNVyCcq3=_pmw-7+A@mail.gmail.com>
References: <CA+akxBOXNFNfpQgi2OzaTaLZ1mV=FTMn5LNVyCcq3=_pmw-7+A@mail.gmail.com>
Message-ID: <CA+akxBOnzj=9i4xRAxwsCo8VcCs-5K72M+8B=8rQ9AfrRZN-bg@mail.gmail.com>

Hello,

I just wanted to let you know that wiping all R packages and starting from
scratch solved my problem. Sorry for not trying that first.

Regards
Sebastian


2016-10-18 17:15 GMT+02:00 Sebastian Bayer <sebastian.bayer at uni-konstanz.de>
:

> Hello,
>
> after I updated all my R packages today, loading the rugarch library
> yields a memory not mapped error.
>
> > sessionInfo()
> R version 3.3.1 (2016-06-21)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 16.04 LTS
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=en_US.UTF-8
>  [7] LC_PAPER=de_DE.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>
> > library(rugarch)
> Loading required package: parallel
>
>  *** caught segfault ***
> address 0x20, cause 'memory not mapped'
>
> Traceback:
>  1: .Call(Module__functions_names, xp)
>  2: Module(module, mustStart = TRUE, where = env)
>  3: doTryCatch(return(expr), name, parentenv, handler)
>  4: tryCatchOne(expr, names, parentenv, handlers[[1L]])
>  5: tryCatchList(expr, classes, parentenv, handlers)
>  6: tryCatch(Module(module, mustStart = TRUE, where = env), error =
> function(e) e)
>  7: loadModule(module = "Multicool", what = TRUE, env = ns, loadNow = TRUE)
>  8: (function (ns) loadModule(module = "Multicool", what = TRUE, env = ns,
> loadNow = TRUE))(<environment>)
>  9: doTryCatch(return(expr), name, parentenv, handler)
> 10: tryCatchOne(expr, names, parentenv, handlers[[1L]])
> 11: tryCatchList(expr, classes, parentenv, handlers)
> 12: tryCatch((function (ns) loadModule(module = "Multicool", what = TRUE,
> env = ns, loadNow = TRUE))(<environment>),     error = function(e) e)
> 13: eval(expr, envir, enclos)
> 14: eval(substitute(tryCatch(FUN(WHERE), error = function(e) e),
> list(FUN = f, WHERE = where)), where)
> 15: .doLoadActions(where, attach)
> 16: methods::cacheMetaData(ns, TRUE, ns)
> 17: loadNamespace(i, c(lib.loc, .libPaths()), versionCheck = vI[[i]])
> 18: namespaceImport(ns, loadNamespace(i, c(lib.loc, .libPaths()),
> versionCheck = vI[[i]]), from = package)
> 19: loadNamespace(j <- i[[1L]], c(lib.loc, .libPaths()), versionCheck =
> vI[[j]])
> 20: asNamespace(ns)
> 21: namespaceImportFrom(ns, loadNamespace(j <- i[[1L]], c(lib.loc,
> .libPaths()), versionCheck = vI[[j]]), i[[2L]], from = package)
> 22: loadNamespace(package, lib.loc)
> 23: doTryCatch(return(expr), name, parentenv, handler)
> 24: tryCatchOne(expr, names, parentenv, handlers[[1L]])
> 25: tryCatchList(expr, classes, parentenv, handlers)
> 26: tryCatch(expr, error = function(e) {    call <- conditionCall(e)    if
> (!is.null(call)) {        if (identical(call[[1L]], quote(doTryCatch)))
>         call <- sys.call(-4L)        dcall <- deparse(call)[1L]
>  prefix <- paste("Error in", dcall, ": ")        LONG <- 75L        msg <-
> conditionMessage(e)        sm <- strsplit(msg, "\n")[[1L]]        w <- 14L
> + nchar(dcall, type = "w") + nchar(sm[1L], type = "w")        if (is.na(w))
>             w <- 14L + nchar(dcall, type = "b") + nchar(sm[1L],
>     type = "b")        if (w > LONG)             prefix <- paste0(prefix,
> "\n  ")    }    else prefix <- "Error : "    msg <- paste0(prefix,
> conditionMessage(e), "\n")    .Internal(seterrmessage(msg[1L]))    if
> (!silent && identical(getOption("show.error.messages"),         TRUE)) {
>        cat(msg, file = stderr())        .Internal(printDeferredWarnings())
>    }    invisible(structure(msg, class = "try-error", condition = e))})
> 27: try({    attr(package, "LibPath") <- which.lib.loc    ns <-
> loadNamespace(package, lib.loc)    env <- attachNamespace(ns, pos = pos,
> deps)})
> 28: library(rugarch)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection:
>
>
> Regards
> Sebastian
>
>

	[[alternative HTML version deleted]]


From kristian.langgaard.lind at gmail.com  Thu Oct 20 13:00:55 2016
From: kristian.langgaard.lind at gmail.com (Kristian Lind)
Date: Thu, 20 Oct 2016 13:00:55 +0200
Subject: [R-SIG-Finance] Constrained portfolio optimization with DEoptim
In-Reply-To: <1475582513.14041.262.camel@brian-rcg>
References: <CAK0QJvxob1C-763TbRJ9Q6=vOWZswyntHSd6TxL0w_s5stucsw@mail.gmail.com>
	<1475582513.14041.262.camel@brian-rcg>
Message-ID: <CAK0QJvwmzt=maU4+bTrNW81_=YuntDDYRD_3BEuoUXVUZRPq4Q@mail.gmail.com>

Hi Brian*,*

Thank you for your reply. It has been very helpful.

I have, as you suggested, tried to set my problem up within
PortfolioAnalytics.

I have formulated the constrained optimization using two custom objective
functions.

One calculating a risk measure.

objectfunc <- function(R, weights, Nassets)

myfun <- function(x,y){rowSums(x*y)}

PF.Ret <- matrix(data = NA, nrow = nrow(R), ncol = ncol(R)/Nassets)

for(i in 1:(ncol(R)/Nassets))

{

  j <- i*Nassets-(Nassets-1)

  PF.Ret[,i] = myfun(R[,j:(j+Nassets-1)],weights)

}

date <- index(R)

PF.Ret <- xts(PF.Ret, date)

PF.Ret <- log(1+PF.Ret)

list <- list()

for (i in 1:ncol(PF.Ret))

{

  list[[i]] <- apply.yearly(PF.Ret[,i], sum)

}

PF.Ret.Yearly <- matrix(data = unlist(list), nrow=10, ncol = 1000,
byrow=FALSE)

matrix1 <- matrix(data= NA, nrow= 10, ncol= 1)

for (i in 1:10)

{

  mean.ret <- mean(PF.Ret.Yearly[i,])

  sorted <- sort(PF.Ret.Yearly[i,])

  ES_5_pct <- mean(sorted[1:ceiling(length(sorted)*.05)])

  matrix1[i,1] <- -( mean.ret -ES_5_pct)

}

YOY_Shortfall_Risk <- mean(matrix1)

return(YOY_Shortfall_Risk)

}

Another calculating the deviation between a set target return and the
portfolio return given the weights. Deviation from the target return is
penalized.

retcons <- function(R, weights, targetreturn, Nassets){

  myfun <- function(x,y){rowSums(x*y)}

  PF.Ret <- matrix(data = NA, nrow = nrow(R), ncol = ncol(R)/Nassets)

  for(i in 1:(ncol(R)/Nassets))

  {

    j <- i*Nassets-(Nassets-1)

    PF.Ret[,i] = myfun(R[,j:(j+Nassets-1)],weights)

  }

  date <- index(R)

  PF.Ret <- xts(PF.Ret, date)

  PF.Ret <- log(1+PF.Ret)

  PF.Ret.Ann <- Return.annualized(PF.Ret, scale = 4)

  PF.Ret.Dev <- abs(mean(PF.Ret.Ann)-targetreturn)

  return(PF.Ret.Dev*1e6)

  }

Portfolio specification:

pf <- portfolio.spec(assets = 3)

pf <- add.constraint(portfolio=pf, type="leverage", min_sum=0.99,
max_sum=1.01)

pf <- add.constraint(portfolio=pf, type="long_only"

pf <- add.objective(portfolio = pf, name = "objectfunc", type = "risk",
arguments= list(Nassets=length(pf$assets)))

pf <- add.objective(portfolio = pf, name = "retcons", type = "return",
arguments= list(targetreturn = 0.04, Nassets=length(pf$assets)))

Optimizing portfolio:

pf.opt <- optimize.portfolio(R, portfolio = pf, optimize_method =
"DEoptim", search_size = 500, trace = FALSE)

When I try to run this I receive the following error message:

objective name objectfunc generated an error or warning: Error in
`[.xts`(R, , j:(j + Nassets - 1)) : subscript out of bounds

objective name retcons generated an error or warning: Error in `[.xts`(R, ,
j:(j + Nassets - 1)) : subscript out of bounds

I can?t figure out why because the functions are working as they should and
the subscript remains within bounds.

If I try to apply DEoptim() directly to the functions one by one this works
without any problems. This leads me to believe that the two objectives are
somehow formulated wrong.

Any advice would be very helpful.

Thanks.

Kristian

Below is some test data. These are returns for 3 assets over 2 distinct
scenarios.



        0001Asset1           0001Asset2      0001Asset3
                  0002Asset1       0002Asset2         0002Asset3

2016-03-31               0.0009770000       0.016740000     0.016579000
          -0.023776400     -0.0041489000     0.001512000

2016-06-30              -0.0029404272       0.007377501
0.015908257                0.043515031      0.0007250080     0.001240125

2016-09-30               0.0104448377      -0.019819554
0.015738547                0.050726217      0.0313854548     0.001350281

2016-12-31              -0.0062679854       0.010671942
0.016125757               -0.004518026     -0.0117857549     0.001689061

2017-03-31              -0.0079445226      -0.044670060
-0.004612912                0.001194696     -0.0058016987     0.052340217

2017-06-30              -0.0443293966      -0.019210789    -0.004226186
           0.021539797     -0.0179612891     0.054908697

2017-09-30               0.0237102390       0.011401810
-0.003435808               -0.011847182     -0.0126964053     0.056605700

2017-12-31              -0.0015399460       0.035813794
-0.002748625               -0.019542495      0.0101302728     0.058266442

2018-03-31              -0.0113292330       0.007312157
0.056380215               -0.010737433     -0.0069353566     0.045971561

2018-06-30              -0.0096110793      -0.002711140
    0.056623046               -0.003262799      0.0008645106     0.047599867

2018-09-30               0.0094151500      -0.024227124
0.058750803               -0.005936063      0.0023834633     0.048860875

2018-12-31               0.0191824507      -0.010843099
0.060146334               -0.036474625      0.0081957339     0.050592614

2019-03-31               0.0216149159      -0.012509716
-0.005685334               -0.016999378      0.0039543321     0.057437136

2019-06-30              -0.0353713241      -0.027056842
-0.005359282               -0.001568024      0.0055240254     0.056829074

2019-09-30               0.0068256915       0.033676676
-0.005547267               -0.005307774      0.0558182435     0.056924521

2019-12-31               0.0402950042       0.008506863
-0.005229621               -0.008069375      0.0104593718     0.058275726

2020-03-31              -0.0236441279       0.002491410
-0.035715118               -0.013556053     -0.0092781424     0.035725279

2020-06-30              -0.0227378309       0.040566982
-0.036422326               -0.018606615      0.0213017461     0.035333312

2020-09-30              -0.0331522369      -0.013661001
-0.035461805                0.013950153     -0.0062701658     0.035735389

2020-12-31              -0.0022381617       0.004761732
-0.034474179               -0.007912498      0.0449173126     0.035830771

2021-03-31              -0.0123584293      -0.023198797
-0.094912448               -0.024782130      0.0126045150     0.013769555

2021-06-30              -0.0230952138      -0.037092732
-0.096008937               -0.012783368      0.0202277100     0.013955651

2021-09-30              -0.0382849524      -0.039174543
-0.096453235                0.011270169     -0.0004279631     0.014892660

2021-12-31               0.0192312397      -0.042090156
-0.094958812               -0.003473503      0.0197412514     0.015052186

2022-03-31              -0.0176720249      -0.051753716
-0.002995036                0.011147463      0.0061838217     0.076329091

2022-06-30               0.0171345591      -0.047152874
-0.003502619               -0.021507033      0.0245421282     0.078357061

2022-09-30              -0.0058656456      -0.051551676
-0.003696614               -0.003655445     -0.0096960956     0.082151077

2022-12-31              -0.0170921376      -0.066373600
-0.003710194                0.021982228      0.0415787788     0.083333940

2023-03-31               0.0163444872      -0.004762518
0.041507377               -0.026366926      0.0203368716     0.048861009

2023-06-30              -0.0208268986      -0.015490012
0.041058936                0.003762363      0.0189784762     0.051571131

2023-09-30              -0.0004284279      -0.002227971
0.040723178               -0.005698759      0.0233511708     0.055240586

2023-12-31               0.0141513274      -0.023746263
0.041881996               -0.022127398      0.0182298784     0.057153451

2024-03-31               0.0105922202      -0.009016968
0.037171059               -0.016926364      0.0488771263     0.067117695

2024-06-30               0.0245418561       0.004764987
0.038838652               -0.010630231      0.0416277761     0.069258579

2024-09-30               0.0116387526       0.016551947
0.038733564                0.032021448      0.0528662570     0.072442630

2024-12-31              -0.0415150970       0.002499012     0.039572718
              0.067227381      0.0440336173     0.073641408

2025-03-31              -0.0315214326       0.023107293
-0.056239231               -0.038364755      0.0214378006     0.009960962

2025-06-30              -0.0153207849       0.011894464
-0.056741703                0.022417838      0.0340254762     0.013183042

2025-09-30              -0.0375576999       0.059433097
-0.056916400               -0.008105189      0.0429868190     0.014451492

2025-12-31              -0.0253597219       0.042178684
-0.055637987                0.033767714      0.0166919155     0.021603579

Den tirsdag den 4. oktober 2016 skrev Brian G. Peterson <brian at braverock.com
>:

> On Tue, 2016-10-04 at 13:04 +0200, Kristian Lind wrote:
> > Hi guys,
> >
> > I?m working on a portfolio optimization problem
> >
> > The problem I?m trying to solve is of the form Min risk s.t. return = X
> >
> > For each asset I have simulated 1000 paths for the development in asset
> > prices over 10 years.
> >
> > The risk measure I?d like to minimize is YoY shortfall risk, but could be
> > any risk metric that takes the information from the scenarios into
> > consideration.
> >
> > Likewise, the return is the mean annualized return over all the
> scenarios.
> >
> > I have tried solving this problem using DEoptim, where deviations from
> the
> > required return is penalized. Similar to the approach applied here:
> > https://cran.r-project.org/web/packages/DEoptim/vignettes/
> > DEoptimPortfolioOptimization.pdf
> >
> > I am unable to achieve convergence where the constraint is fulfilled.
> >
> > My object function is of the form
> >
> > Obj <- function(Return data, portfolio weights, target return){
> >
> > Normalize weights to 1
> > calculate portfolio return
> > calculate risk metric
> > calculate deviation from target return
> > return (risk metric + deviation from target return*1e6)
> >
> > }
> >
> > Any pointers on how to formulate and solve this problem would be much
> > appreciated.
>
> You haven't provided a reproducible example, making it hard to help you.
>
> You can easily do this type of optimization with PortfolioAnalytics,
> including the use of DEoptim, pso, GenSA, or random search as a global
> solver.  The modular objective function of PortfolioAnalytics should
> allow you to specify your problem pretty easily.  You'll need to pass in
> your 'scenarios', and use functions in your objective that expect this
> data and know how to apply weights to it, but that should be pretty
> simple.
>
> To get to a general answer to your question, you need to determine a few
> things.
>
> Is there a solution that meets your constraints?  Many portfolios are
> over-constrained, and are unable to meet the objectives as defined.  In
> these cases you need to be able to relax constraints to get to the
> closest solution.  It often helps to plot the unconstrained and
> constrained feasible spaces (e.g. with random portfolios from
> PortfolioAnalytics) to see if you've overconstrained things.
>
> You don't appear to be using 'fnMap' to apply your full investment
> (cardinality) constraint.  Using this tells DEoptim what the final
> parameter values were, and doesn't hide them inside your custom
> objective.
>
> You're attempting to perform a penalized optimization with:
>
> return (risk metric + deviation from target return*1e6)
>
> Is this the right weighting/penalty between your objectives? Typically,
> if you have no significant preference between your objectives, you want
> to use a multiplier first to get them to similar overall scale.  Then
> you want to separately penalize (with a large multiplier) deviation from
> your constraint.  In this case, you are penalizing overshooting and
> missing below the return in the same way.  This will give the optimizer
> very little indication on direction to improve the solution.  It can
> also make sense to plot the path the optimizer takes to see if you're
> getting close to a solution.
>
> Your use of 'scenarios' could be messing you up.  DEoptim permutes
> 'parameters', which are typically weights in portfolio optimization
> space.  It then applies the objective function passing the parameters
> into the objective. You've said that you're using a annualized mean
> across the scenarios and an annualized shortfall risk across the
> scenarios.  You're losing quite a lot of dimensionality by reducing 1000
> scenarios on each asset to one number.  Doing simple linear combinations
> of these will not take things like covariances into account, even though
> by saying that you care about shortfall risk, I'd assume what you really
> want is *portfolio* shortfall.  I would be concerned that the loss of
> dimensionality suggested by your description would make it difficult to
> get a realistic solution.
>
> There are several more things that could cause this to fail to converge.
> I've covered the most likely ones, but further investigation would
> require a reproducible example.
>
> Regards,
>
> Brian
>
>
> --
> Brian G. Peterson
> http://braverock.com/brian/
> Ph: 773-459-4973
> IM: bgpbraverock
>
>
>
>
>

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Thu Oct 20 17:54:17 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Thu, 20 Oct 2016 11:54:17 -0400
Subject: [R-SIG-Finance] Closest weekly endpoint to the fifteenth of the
	month
Message-ID: <CA+oJuEG1ms7_6jWFWZj6ZM6H+4GHn5pi_QwmXg_fmiDR0yfcwA@mail.gmail.com>

Hi there. I have a question about custom endpoints. Currently, in R, you
can set endpoints to weekly, monthly, quarterly, etc...

However, I was wondering if there was a way to do this:

Assuming you have weekly endpoints, is there a way to select, in each
month, the day closest to the fifteenth--AKA middle of the month?

Right now, my idea is to loop through each individual month, subtract 15
from each date, end pick the one closest to zero, and index it. I was
wondering if there's a more elegant method of doing this.

Thanks.

-Ilya

	[[alternative HTML version deleted]]


From zadig_1 at excite.com  Thu Oct 20 18:09:40 2016
From: zadig_1 at excite.com (ce)
Date: Thu, 20 Oct 2016 12:09:40 -0400
Subject: [R-SIG-Finance] Closest weekly endpoint to the fifteenth of
	the	month
Message-ID: <20161020120940.1161@web002.roc2.bluetie.com>

If it is an xts object I would do something like :

apply.monthly(s, function(x) last(x[ .indexmday(x) <= 15 ]))


-----Original Message-----
From: "Ilya Kipnis" [ilya.kipnis at gmail.com]
Date: 10/20/2016 11:55 AM
To: "r-sig-finance at r-project.org" <r-sig-finance at r-project.org>
Subject: [R-SIG-Finance] Closest weekly endpoint to the fifteenth of the
	month

Hi there. I have a question about custom endpoints. Currently, in R, you
can set endpoints to weekly, monthly, quarterly, etc...

However, I was wondering if there was a way to do this:

Assuming you have weekly endpoints, is there a way to select, in each
month, the day closest to the fifteenth--AKA middle of the month?

Right now, my idea is to loop through each individual month, subtract 15
from each date, end pick the one closest to zero, and index it. I was
wondering if there's a more elegant method of doing this.

Thanks.

-Ilya

	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.


From jongolenbock at gmail.com  Mon Oct 24 20:55:45 2016
From: jongolenbock at gmail.com (Jon Golenbock)
Date: Mon, 24 Oct 2016 14:55:45 -0400
Subject: [R-SIG-Finance] using quantstrat with custom data
Message-ID: <CAE64KYKF_o32kiOJfh9naZbFZti622+2Q_VAJeGLwuLpuzh-1g@mail.gmail.com>

Hi folks,

new to this mailing list and not very proficient with R in general yet, so
apologies in advance.

all of the demos I could see were using stock data pulled from
yahoo/google, etc -- mine is coming from bloomberg. I did my best to
replicate the type of object that getsymbols() seems to create.

everything seems to be working alright until I actually get to
applystrategy(), where I am getting an error that I imagine, while not
particularly helpful to me, will be completely obvious to somebody with a
bit more experience. the error i'm receiving is

Error in n < 1 :
  comparison (3) is possible only for atomic and list types

code below. Any help is greatly appreciated and apologies for all the rules
I am surely breaking, I'll plead first-timer on this one.



library(quantstrat)
library(quantmod)
library(tidyverse)


ts <- structure(list(times = structure(c(1477312980, 1477313580,
1477314180,
1477314780, 1477315380, 1477315980, 1477316580, 1477317180, 1477317780,
1477318380, 1477318980, 1477319580, 1477320180, 1477320780, 1477321380,
1477321980, 1477322580, 1477323180, 1477323780, 1477324380, 1477324980,
1477325580, 1477326180, 1477326780, 1477327380, 1477327980, 1477328580,
1477329180, 1477329780, 1477330380, 1477330980, 1477331580, 1477332180,
1477332780, 1477333380, 1477333980, 1477334580), class = c("POSIXct",
"POSIXt"), tzone = "UTC"), NG1.Open = c(2.954, 2.93, 2.936, 2.947,
2.951, 2.941, 2.929, 2.924, 2.893, 2.871, 2.891, 2.892, 2.898,
2.89, 2.88, 2.872, 2.885, 2.884, 2.879, 2.876, 2.876, 2.859,
2.864, 2.878, 2.866, 2.886, 2.892, 2.889, 2.878, 2.861, 2.859,
2.851, 2.859, 2.84, 2.836, 2.844, 2.839), NG1.High = c(2.959,
2.937, 2.954, 2.96, 2.957, 2.941, 2.932, 2.926, 2.902, 2.893,
2.898, 2.9, 2.905, 2.893, 2.883, 2.885, 2.891, 2.889, 2.884,
2.877, 2.877, 2.867, 2.878, 2.881, 2.887, 2.897, 2.893, 2.891,
2.884, 2.865, 2.862, 2.861, 2.859, 2.843, 2.845, 2.845, 2.842
), NG1.Low = c(2.929, 2.916, 2.931, 2.946, 2.935, 2.924, 2.924,
2.886, 2.871, 2.852, 2.878, 2.889, 2.886, 2.87, 2.87, 2.866,
2.882, 2.875, 2.875, 2.871, 2.857, 2.848, 2.864, 2.863, 2.864,
2.884, 2.886, 2.878, 2.859, 2.851, 2.849, 2.849, 2.835, 2.829,
2.827, 2.836, 2.836), NG1.Close = c(2.93, 2.936, 2.947, 2.951,
2.94, 2.93, 2.924, 2.892, 2.871, 2.891, 2.892, 2.898, 2.89, 2.879,
2.872, 2.884, 2.884, 2.878, 2.876, 2.876, 2.859, 2.865, 2.878,
2.865, 2.886, 2.892, 2.888, 2.879, 2.862, 2.858, 2.851, 2.858,
2.839, 2.836, 2.844, 2.839, 2.842), NG1.Volume = c(2347, 4491,
2793, 1124, 1624, 1864, 1646, 6497, 3625, 5570, 2231, 1506, 2084,
3443, 1372, 1464, 931, 906, 557, 1266, 2047, 3021, 1206, 938,
1375, 1928, 582, 1203, 1810, 1309, 803, 1368, 3141, 2227, 9590,
1067, 128)), row.names = c(NA, -37L), class = "data.frame", .Names =
c("times",
"NG1.Open", "NG1.High", "NG1.Low", "NG1.Close", "NG1.Volume"))

NG1 <- xts(ts[,-1],ts[,1])


initDate <- Sys.Date()-1
initEq <- 5000
n <- 14
nSMA <- 200

currency("USD")
Sys.setenv(TZ="UTC")
symbols <- "NG1"
stock(symbols, currency="USD", multiplier=1)

strategy.st <- 'teststrat'
portfolio.st <- 'teststrat'
account.st <- 'teststrat'
initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='USD')
initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
initEq=initEq, currency='USD')
initOrders(portfolio=portfolio.st, initDate=initDate)



strategy(name = strategy.st,
         store = TRUE)







add.indicator(
  strategy = strategy.st,
  name = 'RSI',
  arguments = list(price=quote(Cl(mktdata)),n=n),
  label = "rsi")

add.indicator(
  strategy = strategy.st,
  name = 'SMA',
  arguments = list(x=quote(Cl(mktdata)),n=SMA),
  label = 'sma'
)



add.rule(
  strategy=strategy.st,
  name='ruleSignal',
  arguments=list(
    sigcol='RSI_long',
    sigval = TRUE,
    orderside = 'long',
    ordertype='market',
    orderqty=1,
    replace=FALSE
  ),
  type='enter',
  label='Enterlong',
  path.dep = TRUE
)

add.rule(
  strategy=strategy.st,
  name='ruleSignal',
  arguments=list(
    sigcol='RSI_short',
    sigval = TRUE,
    orderside = 'short',
    ordertype='market',
    orderqty=1,
    replace=TRUE
  ),
  type='exit',
  label='Exitlong',
  path.dep = TRUE

)


t1<-Sys.time()
out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
t2<-Sys.time()
print(t2-t1)

	[[alternative HTML version deleted]]


From ilya.kipnis at gmail.com  Mon Oct 24 21:07:09 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Mon, 24 Oct 2016 15:07:09 -0400
Subject: [R-SIG-Finance] using quantstrat with custom data
In-Reply-To: <CAE64KYKF_o32kiOJfh9naZbFZti622+2Q_VAJeGLwuLpuzh-1g@mail.gmail.com>
References: <CAE64KYKF_o32kiOJfh9naZbFZti622+2Q_VAJeGLwuLpuzh-1g@mail.gmail.com>
Message-ID: <CA+oJuEHXufjJartEN3Q2Ty6dx5HeMoaxZN8h6+i1BwwOoEvn4Q@mail.gmail.com>

Hi Jon,

First off, check the parameters on your add.indicator call for your SMA
function.

Secondly, your data is only 37 observations long and you have a setting of
200.

Please fix these two issues.

-Ilya

On Mon, Oct 24, 2016 at 2:55 PM, Jon Golenbock <jongolenbock at gmail.com>
wrote:

> Hi folks,
>
> new to this mailing list and not very proficient with R in general yet, so
> apologies in advance.
>
> all of the demos I could see were using stock data pulled from
> yahoo/google, etc -- mine is coming from bloomberg. I did my best to
> replicate the type of object that getsymbols() seems to create.
>
> everything seems to be working alright until I actually get to
> applystrategy(), where I am getting an error that I imagine, while not
> particularly helpful to me, will be completely obvious to somebody with a
> bit more experience. the error i'm receiving is
>
> Error in n < 1 :
>   comparison (3) is possible only for atomic and list types
>
> code below. Any help is greatly appreciated and apologies for all the rules
> I am surely breaking, I'll plead first-timer on this one.
>
>
>
> library(quantstrat)
> library(quantmod)
> library(tidyverse)
>
>
> ts <- structure(list(times = structure(c(1477312980, 1477313580,
> 1477314180,
> 1477314780, 1477315380, 1477315980, 1477316580, 1477317180, 1477317780,
> 1477318380, 1477318980, 1477319580, 1477320180, 1477320780, 1477321380,
> 1477321980, 1477322580, 1477323180, 1477323780, 1477324380, 1477324980,
> 1477325580, 1477326180, 1477326780, 1477327380, 1477327980, 1477328580,
> 1477329180, 1477329780, 1477330380, 1477330980, 1477331580, 1477332180,
> 1477332780, 1477333380, 1477333980, 1477334580), class = c("POSIXct",
> "POSIXt"), tzone = "UTC"), NG1.Open = c(2.954, 2.93, 2.936, 2.947,
> 2.951, 2.941, 2.929, 2.924, 2.893, 2.871, 2.891, 2.892, 2.898,
> 2.89, 2.88, 2.872, 2.885, 2.884, 2.879, 2.876, 2.876, 2.859,
> 2.864, 2.878, 2.866, 2.886, 2.892, 2.889, 2.878, 2.861, 2.859,
> 2.851, 2.859, 2.84, 2.836, 2.844, 2.839), NG1.High = c(2.959,
> 2.937, 2.954, 2.96, 2.957, 2.941, 2.932, 2.926, 2.902, 2.893,
> 2.898, 2.9, 2.905, 2.893, 2.883, 2.885, 2.891, 2.889, 2.884,
> 2.877, 2.877, 2.867, 2.878, 2.881, 2.887, 2.897, 2.893, 2.891,
> 2.884, 2.865, 2.862, 2.861, 2.859, 2.843, 2.845, 2.845, 2.842
> ), NG1.Low = c(2.929, 2.916, 2.931, 2.946, 2.935, 2.924, 2.924,
> 2.886, 2.871, 2.852, 2.878, 2.889, 2.886, 2.87, 2.87, 2.866,
> 2.882, 2.875, 2.875, 2.871, 2.857, 2.848, 2.864, 2.863, 2.864,
> 2.884, 2.886, 2.878, 2.859, 2.851, 2.849, 2.849, 2.835, 2.829,
> 2.827, 2.836, 2.836), NG1.Close = c(2.93, 2.936, 2.947, 2.951,
> 2.94, 2.93, 2.924, 2.892, 2.871, 2.891, 2.892, 2.898, 2.89, 2.879,
> 2.872, 2.884, 2.884, 2.878, 2.876, 2.876, 2.859, 2.865, 2.878,
> 2.865, 2.886, 2.892, 2.888, 2.879, 2.862, 2.858, 2.851, 2.858,
> 2.839, 2.836, 2.844, 2.839, 2.842), NG1.Volume = c(2347, 4491,
> 2793, 1124, 1624, 1864, 1646, 6497, 3625, 5570, 2231, 1506, 2084,
> 3443, 1372, 1464, 931, 906, 557, 1266, 2047, 3021, 1206, 938,
> 1375, 1928, 582, 1203, 1810, 1309, 803, 1368, 3141, 2227, 9590,
> 1067, 128)), row.names = c(NA, -37L), class = "data.frame", .Names =
> c("times",
> "NG1.Open", "NG1.High", "NG1.Low", "NG1.Close", "NG1.Volume"))
>
> NG1 <- xts(ts[,-1],ts[,1])
>
>
> initDate <- Sys.Date()-1
> initEq <- 5000
> n <- 14
> nSMA <- 200
>
> currency("USD")
> Sys.setenv(TZ="UTC")
> symbols <- "NG1"
> stock(symbols, currency="USD", multiplier=1)
>
> strategy.st <- 'teststrat'
> portfolio.st <- 'teststrat'
> account.st <- 'teststrat'
> initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='
> USD')
> initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
> initEq=initEq, currency='USD')
> initOrders(portfolio=portfolio.st, initDate=initDate)
>
>
>
> strategy(name = strategy.st,
>          store = TRUE)
>
>
>
>
>
>
>
> add.indicator(
>   strategy = strategy.st,
>   name = 'RSI',
>   arguments = list(price=quote(Cl(mktdata)),n=n),
>   label = "rsi")
>
> add.indicator(
>   strategy = strategy.st,
>   name = 'SMA',
>   arguments = list(x=quote(Cl(mktdata)),n=SMA),
>   label = 'sma'
> )
>
>
>
> add.rule(
>   strategy=strategy.st,
>   name='ruleSignal',
>   arguments=list(
>     sigcol='RSI_long',
>     sigval = TRUE,
>     orderside = 'long',
>     ordertype='market',
>     orderqty=1,
>     replace=FALSE
>   ),
>   type='enter',
>   label='Enterlong',
>   path.dep = TRUE
> )
>
> add.rule(
>   strategy=strategy.st,
>   name='ruleSignal',
>   arguments=list(
>     sigcol='RSI_short',
>     sigval = TRUE,
>     orderside = 'short',
>     ordertype='market',
>     orderqty=1,
>     replace=TRUE
>   ),
>   type='exit',
>   label='Exitlong',
>   path.dep = TRUE
>
> )
>
>
> t1<-Sys.time()
> out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
> t2<-Sys.time()
> print(t2-t1)
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From kevin.dhingra at appliedacademics.com  Mon Oct 24 21:19:22 2016
From: kevin.dhingra at appliedacademics.com (Kevin Dhingra)
Date: Mon, 24 Oct 2016 15:19:22 -0400
Subject: [R-SIG-Finance] using quantstrat with custom data
In-Reply-To: <CA+oJuEHXufjJartEN3Q2Ty6dx5HeMoaxZN8h6+i1BwwOoEvn4Q@mail.gmail.com>
References: <CAE64KYKF_o32kiOJfh9naZbFZti622+2Q_VAJeGLwuLpuzh-1g@mail.gmail.com>
	<CA+oJuEHXufjJartEN3Q2Ty6dx5HeMoaxZN8h6+i1BwwOoEvn4Q@mail.gmail.com>
Message-ID: <CAG1eqLZRo6ZscCpKRgXZY0==KBfCpJZAchRFeX3Vw3g1KXuiLw@mail.gmail.com>

Hi Jon,

As mentioned by Ilya, your arguments to SMA are incorrect. Also your
program is missing the signal function. You need to convert your indicator
into a signal using add.signal function before passing it to a rule. Try
running the modified code -

library(quantstrat)
library(quantmod)
library(tidyverse)


ts <- structure(list(times = structure(c(1477312980, 1477313580,
                                         1477314180,
                                         1477314780, 1477315380,
1477315980, 1477316580, 1477317180, 1477317780,
                                         1477318380, 1477318980,
1477319580, 1477320180, 1477320780, 1477321380,
                                         1477321980, 1477322580,
1477323180, 1477323780, 1477324380, 1477324980,
                                         1477325580, 1477326180,
1477326780, 1477327380, 1477327980, 1477328580,
                                         1477329180, 1477329780,
1477330380, 1477330980, 1477331580, 1477332180,
                                         1477332780, 1477333380,
1477333980, 1477334580), class = c("POSIXct",

                        "POSIXt"), tzone = "UTC"), NG1.Open = c(2.954,
2.93, 2.936, 2.947,

                                                                2.951,
2.941, 2.929, 2.924, 2.893, 2.871, 2.891, 2.892, 2.898,

                                                                2.89, 2.88,
2.872, 2.885, 2.884, 2.879, 2.876, 2.876, 2.859,

                                                                2.864,
2.878, 2.866, 2.886, 2.892, 2.889, 2.878, 2.861, 2.859,

                                                                2.851,
2.859, 2.84, 2.836, 2.844, 2.839), NG1.High = c(2.959,


                                           2.937, 2.954, 2.96, 2.957,
2.941, 2.932, 2.926, 2.902, 2.893,


                                           2.898, 2.9, 2.905, 2.893, 2.883,
2.885, 2.891, 2.889, 2.884,


                                           2.877, 2.877, 2.867, 2.878,
2.881, 2.887, 2.897, 2.893, 2.891,


                                           2.884, 2.865, 2.862, 2.861,
2.859, 2.843, 2.845, 2.845, 2.842

                                                                ), NG1.Low
= c(2.929, 2.916, 2.931, 2.946, 2.935, 2.924, 2.924,


   2.886, 2.871, 2.852, 2.878, 2.889, 2.886, 2.87, 2.87, 2.866,


   2.882, 2.875, 2.875, 2.871, 2.857, 2.848, 2.864, 2.863, 2.864,


   2.884, 2.886, 2.878, 2.859, 2.851, 2.849, 2.849, 2.835, 2.829,


   2.827, 2.836, 2.836), NG1.Close = c(2.93, 2.936, 2.947, 2.951,


                                       2.94, 2.93, 2.924, 2.892, 2.871,
2.891, 2.892, 2.898, 2.89, 2.879,


                                       2.872, 2.884, 2.884, 2.878, 2.876,
2.876, 2.859, 2.865, 2.878,


                                       2.865, 2.886, 2.892, 2.888, 2.879,
2.862, 2.858, 2.851, 2.858,


                                       2.839, 2.836, 2.844, 2.839, 2.842),
NG1.Volume = c(2347, 4491,



              2793, 1124, 1624, 1864, 1646, 6497, 3625, 5570, 2231, 1506,
2084,



              3443, 1372, 1464, 931, 906, 557, 1266, 2047, 3021, 1206, 938,



              1375, 1928, 582, 1203, 1810, 1309, 803, 1368, 3141, 2227,
9590,



              1067, 128)), row.names = c(NA, -37L), class = "data.frame",
.Names =
                  c("times",
                    "NG1.Open", "NG1.High", "NG1.Low", "NG1.Close",
"NG1.Volume"))

NG1 <- xts(ts[,-1],ts[,1])


initDate <- index(NG1)[1]
initEq <- 5000
n <- 14

currency("USD")
Sys.setenv(TZ="UTC")
symbols <- "NG1"
stock(symbols, currency="USD", multiplier=1)

strategy.st <- 'teststrat'
portfolio.st <- 'teststrat'
account.st <- 'teststrat'
initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='USD')
initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
         initEq=initEq, currency='USD')
initOrders(portfolio=portfolio.st, initDate=initDate)



strategy(name = strategy.st,
         store = TRUE)

add.indicator(
  strategy = strategy.st,
  name = 'RSI',
  arguments = list(price=quote(Cl(mktdata)),n=n),
  label = "rsi")



add.signal(strategy.st, name="sigThreshold",
           arguments=list(column="rsi", threshold= 40,
                          relationship="lt", cross=FALSE),
           label="RSI_long")

add.rule(
  strategy=strategy.st,
  name='ruleSignal',
  arguments=list(
    sigcol='RSI_long',
    sigval = TRUE,
    orderside = 'long',
    ordertype='market',
    orderqty=1,
    replace=FALSE
  ),
  type='enter',
  label='Enterlong',
  path.dep = TRUE
)




t1<-Sys.time()
out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
t2<-Sys.time()
print(t2-t1)

On Mon, Oct 24, 2016 at 3:07 PM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> Hi Jon,
>
> First off, check the parameters on your add.indicator call for your SMA
> function.
>
> Secondly, your data is only 37 observations long and you have a setting of
> 200.
>
> Please fix these two issues.
>
> -Ilya
>
> On Mon, Oct 24, 2016 at 2:55 PM, Jon Golenbock <jongolenbock at gmail.com>
> wrote:
>
> > Hi folks,
> >
> > new to this mailing list and not very proficient with R in general yet,
> so
> > apologies in advance.
> >
> > all of the demos I could see were using stock data pulled from
> > yahoo/google, etc -- mine is coming from bloomberg. I did my best to
> > replicate the type of object that getsymbols() seems to create.
> >
> > everything seems to be working alright until I actually get to
> > applystrategy(), where I am getting an error that I imagine, while not
> > particularly helpful to me, will be completely obvious to somebody with a
> > bit more experience. the error i'm receiving is
> >
> > Error in n < 1 :
> >   comparison (3) is possible only for atomic and list types
> >
> > code below. Any help is greatly appreciated and apologies for all the
> rules
> > I am surely breaking, I'll plead first-timer on this one.
> >
> >
> >
> > library(quantstrat)
> > library(quantmod)
> > library(tidyverse)
> >
> >
> > ts <- structure(list(times = structure(c(1477312980, 1477313580,
> > 1477314180,
> > 1477314780, 1477315380, 1477315980, 1477316580, 1477317180, 1477317780,
> > 1477318380, 1477318980, 1477319580, 1477320180, 1477320780, 1477321380,
> > 1477321980, 1477322580, 1477323180, 1477323780, 1477324380, 1477324980,
> > 1477325580, 1477326180, 1477326780, 1477327380, 1477327980, 1477328580,
> > 1477329180, 1477329780, 1477330380, 1477330980, 1477331580, 1477332180,
> > 1477332780, 1477333380, 1477333980, 1477334580), class = c("POSIXct",
> > "POSIXt"), tzone = "UTC"), NG1.Open = c(2.954, 2.93, 2.936, 2.947,
> > 2.951, 2.941, 2.929, 2.924, 2.893, 2.871, 2.891, 2.892, 2.898,
> > 2.89, 2.88, 2.872, 2.885, 2.884, 2.879, 2.876, 2.876, 2.859,
> > 2.864, 2.878, 2.866, 2.886, 2.892, 2.889, 2.878, 2.861, 2.859,
> > 2.851, 2.859, 2.84, 2.836, 2.844, 2.839), NG1.High = c(2.959,
> > 2.937, 2.954, 2.96, 2.957, 2.941, 2.932, 2.926, 2.902, 2.893,
> > 2.898, 2.9, 2.905, 2.893, 2.883, 2.885, 2.891, 2.889, 2.884,
> > 2.877, 2.877, 2.867, 2.878, 2.881, 2.887, 2.897, 2.893, 2.891,
> > 2.884, 2.865, 2.862, 2.861, 2.859, 2.843, 2.845, 2.845, 2.842
> > ), NG1.Low = c(2.929, 2.916, 2.931, 2.946, 2.935, 2.924, 2.924,
> > 2.886, 2.871, 2.852, 2.878, 2.889, 2.886, 2.87, 2.87, 2.866,
> > 2.882, 2.875, 2.875, 2.871, 2.857, 2.848, 2.864, 2.863, 2.864,
> > 2.884, 2.886, 2.878, 2.859, 2.851, 2.849, 2.849, 2.835, 2.829,
> > 2.827, 2.836, 2.836), NG1.Close = c(2.93, 2.936, 2.947, 2.951,
> > 2.94, 2.93, 2.924, 2.892, 2.871, 2.891, 2.892, 2.898, 2.89, 2.879,
> > 2.872, 2.884, 2.884, 2.878, 2.876, 2.876, 2.859, 2.865, 2.878,
> > 2.865, 2.886, 2.892, 2.888, 2.879, 2.862, 2.858, 2.851, 2.858,
> > 2.839, 2.836, 2.844, 2.839, 2.842), NG1.Volume = c(2347, 4491,
> > 2793, 1124, 1624, 1864, 1646, 6497, 3625, 5570, 2231, 1506, 2084,
> > 3443, 1372, 1464, 931, 906, 557, 1266, 2047, 3021, 1206, 938,
> > 1375, 1928, 582, 1203, 1810, 1309, 803, 1368, 3141, 2227, 9590,
> > 1067, 128)), row.names = c(NA, -37L), class = "data.frame", .Names =
> > c("times",
> > "NG1.Open", "NG1.High", "NG1.Low", "NG1.Close", "NG1.Volume"))
> >
> > NG1 <- xts(ts[,-1],ts[,1])
> >
> >
> > initDate <- Sys.Date()-1
> > initEq <- 5000
> > n <- 14
> > nSMA <- 200
> >
> > currency("USD")
> > Sys.setenv(TZ="UTC")
> > symbols <- "NG1"
> > stock(symbols, currency="USD", multiplier=1)
> >
> > strategy.st <- 'teststrat'
> > portfolio.st <- 'teststrat'
> > account.st <- 'teststrat'
> > initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='
> > USD')
> > initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
> > initEq=initEq, currency='USD')
> > initOrders(portfolio=portfolio.st, initDate=initDate)
> >
> >
> >
> > strategy(name = strategy.st,
> >          store = TRUE)
> >
> >
> >
> >
> >
> >
> >
> > add.indicator(
> >   strategy = strategy.st,
> >   name = 'RSI',
> >   arguments = list(price=quote(Cl(mktdata)),n=n),
> >   label = "rsi")
> >
> > add.indicator(
> >   strategy = strategy.st,
> >   name = 'SMA',
> >   arguments = list(x=quote(Cl(mktdata)),n=SMA),
> >   label = 'sma'
> > )
> >
> >
> >
> > add.rule(
> >   strategy=strategy.st,
> >   name='ruleSignal',
> >   arguments=list(
> >     sigcol='RSI_long',
> >     sigval = TRUE,
> >     orderside = 'long',
> >     ordertype='market',
> >     orderqty=1,
> >     replace=FALSE
> >   ),
> >   type='enter',
> >   label='Enterlong',
> >   path.dep = TRUE
> > )
> >
> > add.rule(
> >   strategy=strategy.st,
> >   name='ruleSignal',
> >   arguments=list(
> >     sigcol='RSI_short',
> >     sigval = TRUE,
> >     orderside = 'short',
> >     ordertype='market',
> >     orderqty=1,
> >     replace=TRUE
> >   ),
> >   type='exit',
> >   label='Exitlong',
> >   path.dep = TRUE
> >
> > )
> >
> >
> > t1<-Sys.time()
> > out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
> > t2<-Sys.time()
> > print(t2-t1)
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions
> > should go.
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From jongolenbock at gmail.com  Mon Oct 24 21:23:12 2016
From: jongolenbock at gmail.com (Jon Golenbock)
Date: Mon, 24 Oct 2016 15:23:12 -0400
Subject: [R-SIG-Finance] using quantstrat with custom data
In-Reply-To: <CA+oJuEHXufjJartEN3Q2Ty6dx5HeMoaxZN8h6+i1BwwOoEvn4Q@mail.gmail.com>
References: <CAE64KYKF_o32kiOJfh9naZbFZti622+2Q_VAJeGLwuLpuzh-1g@mail.gmail.com>
	<CA+oJuEHXufjJartEN3Q2Ty6dx5HeMoaxZN8h6+i1BwwOoEvn4Q@mail.gmail.com>
Message-ID: <CAE64KYKHKUrUK6eeQ-DkuT+ikqeotc257h2_a7L0HQornMN9wA@mail.gmail.com>

ah - i shortened the dataset for brevity, didn't think about the SMA (the
actual dataset is far larger). I also see that in the add.indicator call i
used n=SMA where it should have been n=nSMA.

Thanks so much for your quick reply. I actually had a couple other bits
missing but I've got it up and running now (or at least I have it posting
transaction data on applystrategy() which is a massive step forward).

Much appreciated!!

On Mon, Oct 24, 2016 at 3:07 PM, Ilya Kipnis <ilya.kipnis at gmail.com> wrote:

> Hi Jon,
>
> First off, check the parameters on your add.indicator call for your SMA
> function.
>
> Secondly, your data is only 37 observations long and you have a setting of
> 200.
>
> Please fix these two issues.
>
> -Ilya
>
> On Mon, Oct 24, 2016 at 2:55 PM, Jon Golenbock <jongolenbock at gmail.com>
> wrote:
>
>> Hi folks,
>>
>> new to this mailing list and not very proficient with R in general yet, so
>> apologies in advance.
>>
>> all of the demos I could see were using stock data pulled from
>> yahoo/google, etc -- mine is coming from bloomberg. I did my best to
>> replicate the type of object that getsymbols() seems to create.
>>
>> everything seems to be working alright until I actually get to
>> applystrategy(), where I am getting an error that I imagine, while not
>> particularly helpful to me, will be completely obvious to somebody with a
>> bit more experience. the error i'm receiving is
>>
>> Error in n < 1 :
>>   comparison (3) is possible only for atomic and list types
>>
>> code below. Any help is greatly appreciated and apologies for all the
>> rules
>> I am surely breaking, I'll plead first-timer on this one.
>>
>>
>>
>> library(quantstrat)
>> library(quantmod)
>> library(tidyverse)
>>
>>
>> ts <- structure(list(times = structure(c(1477312980, 1477313580,
>> 1477314180,
>> 1477314780, 1477315380, 1477315980, 1477316580, 1477317180, 1477317780,
>> 1477318380, 1477318980, 1477319580, 1477320180, 1477320780, 1477321380,
>> 1477321980, 1477322580, 1477323180, 1477323780, 1477324380, 1477324980,
>> 1477325580, 1477326180, 1477326780, 1477327380, 1477327980, 1477328580,
>> 1477329180, 1477329780, 1477330380, 1477330980, 1477331580, 1477332180,
>> 1477332780, 1477333380, 1477333980, 1477334580), class = c("POSIXct",
>> "POSIXt"), tzone = "UTC"), NG1.Open = c(2.954, 2.93, 2.936, 2.947,
>> 2.951, 2.941, 2.929, 2.924, 2.893, 2.871, 2.891, 2.892, 2.898,
>> 2.89, 2.88, 2.872, 2.885, 2.884, 2.879, 2.876, 2.876, 2.859,
>> 2.864, 2.878, 2.866, 2.886, 2.892, 2.889, 2.878, 2.861, 2.859,
>> 2.851, 2.859, 2.84, 2.836, 2.844, 2.839), NG1.High = c(2.959,
>> 2.937, 2.954, 2.96, 2.957, 2.941, 2.932, 2.926, 2.902, 2.893,
>> 2.898, 2.9, 2.905, 2.893, 2.883, 2.885, 2.891, 2.889, 2.884,
>> 2.877, 2.877, 2.867, 2.878, 2.881, 2.887, 2.897, 2.893, 2.891,
>> 2.884, 2.865, 2.862, 2.861, 2.859, 2.843, 2.845, 2.845, 2.842
>> ), NG1.Low = c(2.929, 2.916, 2.931, 2.946, 2.935, 2.924, 2.924,
>> 2.886, 2.871, 2.852, 2.878, 2.889, 2.886, 2.87, 2.87, 2.866,
>> 2.882, 2.875, 2.875, 2.871, 2.857, 2.848, 2.864, 2.863, 2.864,
>> 2.884, 2.886, 2.878, 2.859, 2.851, 2.849, 2.849, 2.835, 2.829,
>> 2.827, 2.836, 2.836), NG1.Close = c(2.93, 2.936, 2.947, 2.951,
>> 2.94, 2.93, 2.924, 2.892, 2.871, 2.891, 2.892, 2.898, 2.89, 2.879,
>> 2.872, 2.884, 2.884, 2.878, 2.876, 2.876, 2.859, 2.865, 2.878,
>> 2.865, 2.886, 2.892, 2.888, 2.879, 2.862, 2.858, 2.851, 2.858,
>> 2.839, 2.836, 2.844, 2.839, 2.842), NG1.Volume = c(2347, 4491,
>> 2793, 1124, 1624, 1864, 1646, 6497, 3625, 5570, 2231, 1506, 2084,
>> 3443, 1372, 1464, 931, 906, 557, 1266, 2047, 3021, 1206, 938,
>> 1375, 1928, 582, 1203, 1810, 1309, 803, 1368, 3141, 2227, 9590,
>> 1067, 128)), row.names = c(NA, -37L), class = "data.frame", .Names =
>> c("times",
>> "NG1.Open", "NG1.High", "NG1.Low", "NG1.Close", "NG1.Volume"))
>>
>> NG1 <- xts(ts[,-1],ts[,1])
>>
>>
>> initDate <- Sys.Date()-1
>> initEq <- 5000
>> n <- 14
>> nSMA <- 200
>>
>> currency("USD")
>> Sys.setenv(TZ="UTC")
>> symbols <- "NG1"
>> stock(symbols, currency="USD", multiplier=1)
>>
>> strategy.st <- 'teststrat'
>> portfolio.st <- 'teststrat'
>> account.st <- 'teststrat'
>> initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='US
>> D')
>> initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
>> initEq=initEq, currency='USD')
>> initOrders(portfolio=portfolio.st, initDate=initDate)
>>
>>
>>
>> strategy(name = strategy.st,
>>          store = TRUE)
>>
>>
>>
>>
>>
>>
>>
>> add.indicator(
>>   strategy = strategy.st,
>>   name = 'RSI',
>>   arguments = list(price=quote(Cl(mktdata)),n=n),
>>   label = "rsi")
>>
>> add.indicator(
>>   strategy = strategy.st,
>>   name = 'SMA',
>>   arguments = list(x=quote(Cl(mktdata)),n=SMA),
>>   label = 'sma'
>> )
>>
>>
>>
>> add.rule(
>>   strategy=strategy.st,
>>   name='ruleSignal',
>>   arguments=list(
>>     sigcol='RSI_long',
>>     sigval = TRUE,
>>     orderside = 'long',
>>     ordertype='market',
>>     orderqty=1,
>>     replace=FALSE
>>   ),
>>   type='enter',
>>   label='Enterlong',
>>   path.dep = TRUE
>> )
>>
>> add.rule(
>>   strategy=strategy.st,
>>   name='ruleSignal',
>>   arguments=list(
>>     sigcol='RSI_short',
>>     sigval = TRUE,
>>     orderside = 'short',
>>     ordertype='market',
>>     orderqty=1,
>>     replace=TRUE
>>   ),
>>   type='exit',
>>   label='Exitlong',
>>   path.dep = TRUE
>>
>> )
>>
>>
>> t1<-Sys.time()
>> out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
>> t2<-Sys.time()
>> print(t2-t1)
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>

	[[alternative HTML version deleted]]


From jongolenbock at gmail.com  Mon Oct 24 21:34:55 2016
From: jongolenbock at gmail.com (Jon Golenbock)
Date: Mon, 24 Oct 2016 15:34:55 -0400
Subject: [R-SIG-Finance] using quantstrat with custom data
In-Reply-To: <CAG1eqLZRo6ZscCpKRgXZY0==KBfCpJZAchRFeX3Vw3g1KXuiLw@mail.gmail.com>
References: <CAE64KYKF_o32kiOJfh9naZbFZti622+2Q_VAJeGLwuLpuzh-1g@mail.gmail.com>
	<CA+oJuEHXufjJartEN3Q2Ty6dx5HeMoaxZN8h6+i1BwwOoEvn4Q@mail.gmail.com>
	<CAG1eqLZRo6ZscCpKRgXZY0==KBfCpJZAchRFeX3Vw3g1KXuiLw@mail.gmail.com>
Message-ID: <CAE64KYJDTHju2z6wB96skgPpdHKZhGkFzJYTsy-9M+2P-ZrmfA@mail.gmail.com>

Thanks Kevin. I actually had just failed to copy-paste the add.signal calls
and figured that out pretty quickly after fixing the previous error.

What I have below is what I've got now (and it runs). probably
unsurprisingly, the data is a 1 minute continous front-month natural gas
contract.

Thank you again.


ts <- structure(list(times = structure(c(1477315440, 1477315500,
1477315560,
1477315620, 1477315680, 1477315740, 1477315800, 1477315860, 1477315920,
1477315980, 1477316040, 1477316100, 1477316160, 1477316220, 1477316280,
1477316340, 1477316400, 1477316460, 1477316520, 1477316580, 1477316640,
1477316700, 1477316760, 1477316820, 1477316880, 1477316940, 1477317000,
1477317060, 1477317120, 1477317180, 1477317240, 1477317300, 1477317360,
1477317420, 1477317480, 1477317540, 1477317600, 1477317660, 1477317720,
1477317780, 1477317840, 1477317900, 1477317960, 1477318020, 1477318080,
1477318140, 1477318200, 1477318260, 1477318320, 1477318380, 1477318440,
1477318500, 1477318560, 1477318620, 1477318680, 1477318740, 1477318800,
1477318860, 1477318920, 1477318980, 1477319040, 1477319100, 1477319160,
1477319220, 1477319280, 1477319340, 1477319400, 1477319460, 1477319520,
1477319580, 1477319640, 1477319700, 1477319760, 1477319820, 1477319880,
1477319940, 1477320000, 1477320060, 1477320120, 1477320180, 1477320240,
1477320300, 1477320360, 1477320420, 1477320480, 1477320540, 1477320600,
1477320660, 1477320720, 1477320780, 1477320840, 1477320900, 1477320960,
1477321020, 1477321080, 1477321140, 1477321200, 1477321260, 1477321320,
1477321380, 1477321440, 1477321500, 1477321560, 1477321620, 1477321680,
1477321740, 1477321800, 1477321860, 1477321920, 1477321980, 1477322040,
1477322100, 1477322160, 1477322220, 1477322280, 1477322340, 1477322400,
1477322460, 1477322520, 1477322580, 1477322640, 1477322700, 1477322760,
1477322820, 1477322880, 1477322940, 1477323000, 1477323060, 1477323120,
1477323180, 1477323240, 1477323300, 1477323360, 1477323420, 1477323480,
1477323540, 1477323600, 1477323660, 1477323720, 1477323780, 1477323840,
1477323900, 1477323960, 1477324020, 1477324080, 1477324140, 1477324200,
1477324260, 1477324320, 1477324380, 1477324440, 1477324500, 1477324560,
1477324620, 1477324680, 1477324740, 1477324800, 1477324860, 1477324920,
1477324980, 1477325040, 1477325100, 1477325160, 1477325220, 1477325280,
1477325340, 1477325400, 1477325460, 1477325520, 1477325580, 1477325640,
1477325700, 1477325760, 1477325820, 1477325880, 1477325940, 1477326000,
1477326060, 1477326120, 1477326180, 1477326240, 1477326300, 1477326360,
1477326420, 1477326480, 1477326540, 1477326600, 1477326660, 1477326720,
1477326780, 1477326840, 1477326900, 1477326960, 1477327020, 1477327080,
1477327140, 1477327200, 1477327260, 1477327320, 1477327380, 1477327440,
1477327500, 1477327560, 1477327620, 1477327680, 1477327740, 1477327800,
1477327860, 1477327920, 1477327980, 1477328040, 1477328100, 1477328160,
1477328220, 1477328280, 1477328340, 1477328400, 1477328460, 1477328520,
1477328580, 1477328640, 1477328700, 1477328760, 1477328820, 1477328880,
1477328940, 1477329000, 1477329060, 1477329120, 1477329180, 1477329240,
1477329300, 1477329360, 1477329420, 1477329480, 1477329540, 1477329600,
1477329660, 1477329720, 1477329780, 1477329840, 1477329900, 1477329960,
1477330020, 1477330080, 1477330140, 1477330200, 1477330260, 1477330320,
1477330380, 1477330440, 1477330500, 1477330560, 1477330620, 1477330680,
1477330740, 1477330800, 1477330860, 1477330920, 1477330980, 1477331040,
1477331100, 1477331160, 1477331220, 1477331280, 1477331340, 1477331400,
1477331460, 1477331520, 1477331580, 1477331640, 1477331700, 1477331760,
1477331820, 1477331880, 1477331940, 1477332000, 1477332060, 1477332120,
1477332180, 1477332240, 1477332300, 1477332360, 1477332420, 1477332480,
1477332540, 1477332600, 1477332660, 1477332720, 1477332780, 1477332840,
1477332900, 1477332960, 1477333020, 1477333080, 1477333140, 1477333200,
1477333260, 1477333320, 1477333380, 1477333440, 1477333500, 1477333560,
1477333620, 1477333680, 1477333740, 1477333800, 1477333860, 1477333920,
1477333980, 1477334040, 1477334100, 1477334160, 1477334220, 1477334280,
1477334340, 1477334400, 1477334460, 1477334520, 1477334580, 1477334640,
1477334700, 1477334760, 1477334820, 1477334880, 1477334940, 1477335000,
1477335060, 1477335120, 1477335180, 1477335240, 1477335300, 1477335360,
1477335420, 1477335480, 1477335540, 1477335600, 1477335660, 1477335720,
1477335780, 1477335840, 1477335900, 1477335960, 1477336020, 1477336080,
1477336140, 1477336200, 1477336260, 1477336320, 1477336440, 1477336500,
1477336560, 1477336620, 1477336680, 1477336740, 1477336800, 1477336860,
1477336920, 1477336980), class = c("POSIXct", "POSIXt"), tzone = "UTC"),
    NG1.Open = c(2.953, 2.952, 2.954, 2.953, 2.95, 2.946, 2.94,
    2.938, 2.936, 2.941, 2.938, 2.937, 2.936, 2.929, 2.927, 2.927,
    2.927, 2.928, 2.93, 2.929, 2.93, 2.928, 2.927, 2.927, 2.929,
    2.928, 2.929, 2.928, 2.925, 2.924, 2.919, 2.911, 2.911, 2.913,
    2.914, 2.905, 2.892, 2.893, 2.887, 2.893, 2.894, 2.897, 2.897,
    2.897, 2.893, 2.893, 2.873, 2.878, 2.883, 2.871, 2.864, 2.865,
    2.872, 2.877, 2.88, 2.884, 2.886, 2.889, 2.887, 2.891, 2.894,
    2.894, 2.885, 2.884, 2.885, 2.889, 2.886, 2.89, 2.891, 2.892,
    2.892, 2.891, 2.893, 2.89, 2.896, 2.892, 2.892, 2.897, 2.893,
    2.898, 2.903, 2.902, 2.898, 2.898, 2.899, 2.902, 2.898, 2.893,
    2.892, 2.89, 2.891, 2.891, 2.891, 2.887, 2.887, 2.873, 2.89,
    2.889, 2.889, 2.88, 2.877, 2.879, 2.882, 2.876, 2.877, 2.88,
    2.873, 2.873, 2.872, 2.872, 2.871, 2.868, 2.872, 2.879, 2.883,
    2.881, 2.882, 2.883, 2.883, 2.885, 2.886, 2.887, 2.885, 2.885,
    2.89, 2.887, 2.887, 2.885, 2.884, 2.884, 2.883, 2.885, 2.884,
    2.884, 2.885, 2.879, 2.877, 2.875, 2.875, 2.879, 2.881, 2.881,
    2.884, 2.882, 2.882, 2.881, 2.878, 2.879, 2.877, 2.876, 2.875,
    2.873, 2.874, 2.875, 2.875, 2.873, 2.874, 2.875, 2.877, 2.876,
    2.876, 2.874, 2.873, 2.872, 2.874, 2.871, 2.863, 2.861, 2.86,
    2.859, 2.855, 2.853, 2.851, 2.854, 2.857, 2.86, 2.861, 2.862,
    2.862, 2.864, 2.865, 2.868, 2.867, 2.869, 2.869, 2.873, 2.872,
    2.873, 2.873, 2.878, 2.879, 2.875, 2.874, 2.869, 2.867, 2.865,
    2.867, 2.867, 2.865, 2.866, 2.865, 2.867, 2.866, 2.867, 2.867,
    2.871, 2.877, 2.876, 2.881, 2.886, 2.889, 2.892, 2.895, 2.896,
    2.893, 2.889, 2.89, 2.89, 2.89, 2.892, 2.89, 2.888, 2.89,
    2.889, 2.888, 2.889, 2.888, 2.888, 2.887, 2.889, 2.888, 2.889,
    2.888, 2.882, 2.883, 2.883, 2.885, 2.883, 2.881, 2.878, 2.879,
    2.88, 2.883, 2.875, 2.87, 2.865, 2.86, 2.862, 2.864, 2.861,
    2.863, 2.858, 2.855, 2.852, 2.854, 2.858, 2.856, 2.858, 2.86,
    2.859, 2.859, 2.861, 2.86, 2.861, 2.86, 2.86, 2.858, 2.856,
    2.853, 2.851, 2.851, 2.852, 2.853, 2.852, 2.851, 2.856, 2.858,
    2.857, 2.86, 2.859, 2.856, 2.854, 2.853, 2.85, 2.85, 2.843,
    2.837, 2.838, 2.84, 2.84, 2.84, 2.839, 2.838, 2.84, 2.832,
    2.832, 2.833, 2.832, 2.832, 2.836, 2.838, 2.837, 2.833, 2.836,
    2.834, 2.832, 2.835, 2.84, 2.842, 2.844, 2.843, 2.841, 2.839,
    2.838, 2.837, 2.838, 2.838, 2.839, 2.839, 2.839, 2.844, 2.843,
    2.844, 2.843, 2.845, 2.845, 2.846, 2.847, 2.848, 2.848, 2.846,
    2.847, 2.848, 2.846, 2.847, 2.846, 2.845, 2.844, 2.848, 2.848,
    2.849, 2.847, 2.847, 2.847, 2.846, 2.846, 2.847, 2.846, 2.846,
    2.846, 2.846, 2.846, 2.845, 2.844, 2.841, 2.84, 2.841, 2.842,
    2.841), NG1.High = c(2.953, 2.957, 2.955, 2.953, 2.951, 2.947,
    2.94, 2.939, 2.941, 2.941, 2.94, 2.937, 2.936, 2.929, 2.928,
    2.928, 2.93, 2.933, 2.932, 2.93, 2.93, 2.928, 2.927, 2.93,
    2.929, 2.931, 2.932, 2.928, 2.925, 2.926, 2.92, 2.912, 2.914,
    2.914, 2.914, 2.905, 2.894, 2.895, 2.892, 2.898, 2.898, 2.898,
    2.902, 2.898, 2.894, 2.893, 2.881, 2.884, 2.883, 2.871, 2.87,
    2.872, 2.879, 2.882, 2.885, 2.889, 2.89, 2.889, 2.893, 2.898,
    2.895, 2.894, 2.887, 2.887, 2.89, 2.889, 2.891, 2.892, 2.893,
    2.892, 2.893, 2.894, 2.893, 2.897, 2.896, 2.892, 2.897, 2.897,
    2.9, 2.905, 2.903, 2.902, 2.9, 2.9, 2.902, 2.902, 2.898,
    2.893, 2.892, 2.892, 2.891, 2.891, 2.891, 2.891, 2.888, 2.891,
    2.89, 2.893, 2.889, 2.882, 2.88, 2.883, 2.882, 2.878, 2.881,
    2.882, 2.876, 2.873, 2.873, 2.875, 2.871, 2.871, 2.88, 2.884,
    2.884, 2.882, 2.883, 2.884, 2.885, 2.887, 2.888, 2.887, 2.886,
    2.891, 2.891, 2.889, 2.887, 2.887, 2.885, 2.884, 2.885, 2.886,
    2.884, 2.889, 2.886, 2.879, 2.877, 2.876, 2.878, 2.882, 2.882,
    2.884, 2.884, 2.884, 2.882, 2.881, 2.879, 2.879, 2.877, 2.877,
    2.876, 2.874, 2.874, 2.875, 2.875, 2.875, 2.875, 2.877, 2.877,
    2.877, 2.876, 2.874, 2.873, 2.874, 2.874, 2.872, 2.864, 2.864,
    2.862, 2.86, 2.856, 2.853, 2.858, 2.861, 2.862, 2.863, 2.862,
    2.863, 2.867, 2.867, 2.867, 2.868, 2.868, 2.869, 2.875, 2.874,
    2.873, 2.873, 2.878, 2.881, 2.879, 2.875, 2.874, 2.87, 2.869,
    2.867, 2.868, 2.867, 2.865, 2.866, 2.867, 2.869, 2.867, 2.869,
    2.875, 2.877, 2.878, 2.881, 2.887, 2.891, 2.896, 2.895, 2.897,
    2.896, 2.893, 2.892, 2.892, 2.89, 2.895, 2.893, 2.89, 2.89,
    2.89, 2.89, 2.89, 2.89, 2.888, 2.888, 2.889, 2.89, 2.888,
    2.89, 2.889, 2.891, 2.886, 2.884, 2.886, 2.883, 2.881, 2.879,
    2.88, 2.884, 2.883, 2.875, 2.871, 2.865, 2.864, 2.865, 2.864,
    2.863, 2.865, 2.858, 2.855, 2.855, 2.858, 2.859, 2.858, 2.859,
    2.86, 2.86, 2.86, 2.861, 2.861, 2.862, 2.861, 2.86, 2.858,
    2.856, 2.853, 2.852, 2.853, 2.855, 2.853, 2.852, 2.857, 2.861,
    2.86, 2.86, 2.86, 2.859, 2.856, 2.856, 2.853, 2.852, 2.85,
    2.843, 2.839, 2.84, 2.841, 2.843, 2.84, 2.839, 2.84, 2.84,
    2.833, 2.835, 2.835, 2.834, 2.838, 2.838, 2.841, 2.838, 2.836,
    2.836, 2.835, 2.836, 2.842, 2.844, 2.845, 2.845, 2.844, 2.842,
    2.839, 2.838, 2.838, 2.839, 2.839, 2.84, 2.841, 2.844, 2.844,
    2.844, 2.845, 2.846, 2.846, 2.847, 2.847, 2.849, 2.849, 2.848,
    2.847, 2.847, 2.848, 2.847, 2.848, 2.847, 2.845, 2.847, 2.849,
    2.85, 2.849, 2.848, 2.847, 2.848, 2.847, 2.847, 2.847, 2.846,
    2.847, 2.847, 2.846, 2.847, 2.845, 2.844, 2.841, 2.841, 2.842,
    2.842, 2.841), NG1.Low = c(2.951, 2.952, 2.952, 2.95, 2.945,
    2.939, 2.937, 2.935, 2.935, 2.936, 2.937, 2.93, 2.927, 2.926,
    2.924, 2.925, 2.926, 2.928, 2.929, 2.928, 2.928, 2.925, 2.926,
    2.927, 2.924, 2.927, 2.928, 2.924, 2.924, 2.919, 2.91, 2.902,
    2.91, 2.911, 2.903, 2.891, 2.888, 2.887, 2.886, 2.891, 2.894,
    2.895, 2.896, 2.893, 2.891, 2.872, 2.872, 2.878, 2.871, 2.852,
    2.864, 2.863, 2.872, 2.876, 2.876, 2.883, 2.886, 2.885, 2.887,
    2.891, 2.892, 2.886, 2.883, 2.878, 2.884, 2.884, 2.885, 2.89,
    2.89, 2.89, 2.89, 2.891, 2.889, 2.889, 2.893, 2.89, 2.891,
    2.893, 2.893, 2.897, 2.901, 2.896, 2.896, 2.898, 2.899, 2.898,
    2.893, 2.886, 2.89, 2.889, 2.89, 2.89, 2.887, 2.879, 2.87,
    2.87, 2.886, 2.888, 2.878, 2.877, 2.877, 2.879, 2.877, 2.874,
    2.876, 2.871, 2.87, 2.87, 2.87, 2.87, 2.866, 2.867, 2.872,
    2.879, 2.881, 2.881, 2.882, 2.882, 2.882, 2.885, 2.886, 2.884,
    2.884, 2.885, 2.887, 2.887, 2.885, 2.883, 2.882, 2.883, 2.881,
    2.883, 2.882, 2.883, 2.878, 2.875, 2.875, 2.875, 2.875, 2.879,
    2.879, 2.881, 2.882, 2.881, 2.881, 2.877, 2.876, 2.877, 2.875,
    2.874, 2.874, 2.872, 2.873, 2.874, 2.872, 2.871, 2.872, 2.875,
    2.876, 2.876, 2.873, 2.871, 2.872, 2.871, 2.871, 2.861, 2.857,
    2.86, 2.859, 2.854, 2.848, 2.85, 2.851, 2.854, 2.857, 2.86,
    2.861, 2.86, 2.862, 2.864, 2.865, 2.866, 2.867, 2.868, 2.868,
    2.872, 2.871, 2.872, 2.873, 2.876, 2.872, 2.872, 2.869, 2.866,
    2.863, 2.863, 2.866, 2.864, 2.864, 2.865, 2.864, 2.866, 2.866,
    2.866, 2.867, 2.87, 2.875, 2.875, 2.879, 2.884, 2.887, 2.892,
    2.891, 2.892, 2.887, 2.888, 2.89, 2.89, 2.889, 2.89, 2.888,
    2.888, 2.889, 2.887, 2.888, 2.887, 2.887, 2.887, 2.886, 2.889,
    2.886, 2.888, 2.879, 2.882, 2.883, 2.883, 2.883, 2.88, 2.878,
    2.878, 2.879, 2.88, 2.875, 2.868, 2.859, 2.86, 2.86, 2.862,
    2.86, 2.861, 2.856, 2.855, 2.852, 2.851, 2.854, 2.855, 2.856,
    2.858, 2.858, 2.857, 2.859, 2.86, 2.859, 2.86, 2.86, 2.856,
    2.857, 2.849, 2.851, 2.85, 2.849, 2.851, 2.851, 2.85, 2.851,
    2.854, 2.856, 2.857, 2.857, 2.857, 2.851, 2.853, 2.849, 2.849,
    2.842, 2.836, 2.835, 2.838, 2.838, 2.84, 2.838, 2.838, 2.838,
    2.83, 2.829, 2.83, 2.831, 2.832, 2.832, 2.834, 2.837, 2.831,
    2.83, 2.831, 2.827, 2.83, 2.835, 2.84, 2.842, 2.843, 2.84,
    2.839, 2.837, 2.837, 2.836, 2.838, 2.838, 2.837, 2.838, 2.836,
    2.843, 2.843, 2.843, 2.843, 2.845, 2.845, 2.846, 2.846, 2.846,
    2.845, 2.846, 2.847, 2.847, 2.845, 2.845, 2.845, 2.843, 2.844,
    2.848, 2.848, 2.847, 2.847, 2.846, 2.846, 2.846, 2.846, 2.846,
    2.846, 2.846, 2.846, 2.846, 2.844, 2.844, 2.84, 2.84, 2.84,
    2.84, 2.84, 2.84), NG1.Close = c(2.951, 2.955, 2.953, 2.95,
    2.946, 2.94, 2.939, 2.935, 2.94, 2.937, 2.937, 2.936, 2.929,
    2.926, 2.926, 2.927, 2.928, 2.93, 2.93, 2.93, 2.928, 2.927,
    2.926, 2.928, 2.928, 2.929, 2.928, 2.925, 2.924, 2.919, 2.911,
    2.911, 2.912, 2.913, 2.904, 2.892, 2.894, 2.887, 2.892, 2.894,
    2.896, 2.896, 2.898, 2.893, 2.893, 2.872, 2.878, 2.884, 2.871,
    2.864, 2.867, 2.872, 2.878, 2.88, 2.885, 2.887, 2.889, 2.887,
    2.891, 2.893, 2.893, 2.886, 2.884, 2.886, 2.89, 2.886, 2.889,
    2.89, 2.892, 2.891, 2.891, 2.894, 2.89, 2.897, 2.893, 2.891,
    2.897, 2.893, 2.898, 2.902, 2.901, 2.899, 2.898, 2.899, 2.901,
    2.898, 2.893, 2.893, 2.89, 2.892, 2.89, 2.891, 2.887, 2.886,
    2.874, 2.889, 2.888, 2.888, 2.879, 2.877, 2.879, 2.883, 2.877,
    2.877, 2.881, 2.872, 2.873, 2.873, 2.872, 2.87, 2.868, 2.871,
    2.879, 2.883, 2.882, 2.881, 2.883, 2.883, 2.884, 2.885, 2.887,
    2.884, 2.885, 2.89, 2.887, 2.887, 2.885, 2.885, 2.884, 2.884,
    2.885, 2.883, 2.884, 2.885, 2.88, 2.876, 2.876, 2.875, 2.878,
    2.881, 2.88, 2.884, 2.882, 2.882, 2.881, 2.877, 2.878, 2.877,
    2.876, 2.875, 2.874, 2.874, 2.874, 2.874, 2.872, 2.873, 2.875,
    2.877, 2.876, 2.876, 2.874, 2.873, 2.872, 2.873, 2.872, 2.862,
    2.861, 2.86, 2.859, 2.855, 2.853, 2.851, 2.854, 2.857, 2.859,
    2.862, 2.861, 2.863, 2.865, 2.865, 2.867, 2.867, 2.868, 2.869,
    2.874, 2.873, 2.872, 2.873, 2.878, 2.878, 2.874, 2.873, 2.87,
    2.867, 2.863, 2.867, 2.868, 2.865, 2.865, 2.865, 2.867, 2.866,
    2.866, 2.866, 2.871, 2.876, 2.875, 2.881, 2.886, 2.888, 2.892,
    2.894, 2.896, 2.893, 2.888, 2.891, 2.89, 2.89, 2.892, 2.891,
    2.888, 2.889, 2.889, 2.889, 2.89, 2.888, 2.888, 2.888, 2.888,
    2.889, 2.888, 2.889, 2.882, 2.883, 2.883, 2.884, 2.883, 2.88,
    2.879, 2.879, 2.88, 2.883, 2.876, 2.87, 2.865, 2.86, 2.862,
    2.865, 2.862, 2.863, 2.858, 2.856, 2.852, 2.854, 2.857, 2.856,
    2.857, 2.859, 2.858, 2.859, 2.86, 2.86, 2.86, 2.86, 2.86,
    2.858, 2.857, 2.853, 2.851, 2.852, 2.852, 2.854, 2.851, 2.851,
    2.856, 2.859, 2.857, 2.86, 2.858, 2.857, 2.854, 2.853, 2.85,
    2.85, 2.843, 2.836, 2.838, 2.839, 2.839, 2.841, 2.84, 2.838,
    2.84, 2.832, 2.832, 2.834, 2.831, 2.832, 2.836, 2.838, 2.838,
    2.833, 2.836, 2.835, 2.831, 2.835, 2.841, 2.841, 2.844, 2.843,
    2.84, 2.839, 2.838, 2.837, 2.838, 2.838, 2.839, 2.839, 2.839,
    2.843, 2.844, 2.844, 2.843, 2.845, 2.845, 2.846, 2.847, 2.847,
    2.848, 2.845, 2.847, 2.847, 2.847, 2.847, 2.847, 2.846, 2.843,
    2.847, 2.849, 2.85, 2.847, 2.848, 2.847, 2.847, 2.847, 2.847,
    2.846, 2.846, 2.847, 2.846, 2.846, 2.845, 2.844, 2.841, 2.841,
    2.84, 2.842, 2.841, 2.841), NG1.Volume = c(24, 249, 57, 48,
    203, 515, 228, 78, 163, 142, 99, 362, 182, 228, 233, 227,
    142, 142, 107, 80, 18, 312, 66, 122, 248, 98, 179, 245, 278,
    654, 1055, 934, 203, 141, 704, 1052, 637, 510, 607, 452,
    107, 71, 252, 136, 105, 928, 586, 288, 700, 2230, 562, 412,
    517, 174, 288, 503, 302, 292, 290, 335, 166, 177, 316, 383,
    267, 119, 233, 70, 165, 60, 143, 94, 222, 259, 84, 77, 297,
    69, 201, 647, 87, 283, 161, 110, 87, 65, 215, 365, 64, 78,
    110, 19, 88, 461, 1188, 1024, 204, 119, 152, 100, 144, 76,
    129, 94, 50, 148, 315, 79, 237, 305, 327, 64, 171, 256, 73,
    15, 35, 51, 167, 85, 70, 60, 86, 259, 68, 40, 36, 161, 66,
    18, 147, 19, 43, 169, 205, 138, 55, 67, 45, 78, 98, 66, 15,
    56, 57, 59, 68, 31, 29, 105, 93, 258, 158, 86, 87, 231, 153,
    69, 26, 35, 106, 170, 24, 332, 141, 664, 324, 110, 141, 246,
    1005, 138, 389, 307, 115, 170, 104, 98, 449, 179, 127, 69,
    66, 196, 363, 52, 69, 29, 56, 199, 78, 48, 85, 71, 224, 78,
    70, 73, 12, 35, 78, 92, 49, 69, 212, 259, 78, 184, 319, 471,
    552, 130, 269, 55, 179, 62, 14, 23, 173, 117, 87, 116, 16,
    85, 39, 43, 21, 25, 33, 75, 75, 119, 319, 243, 57, 13, 52,
    140, 110, 33, 51, 84, 126, 290, 548, 325, 152, 87, 114, 47,
    338, 191, 182, 142, 147, 72, 88, 58, 44, 40, 17, 45, 112,
    41, 77, 139, 23, 222, 87, 94, 326, 51, 119, 130, 204, 204,
    139, 39, 62, 52, 140, 179, 686, 319, 558, 607, 217, 81, 302,
    175, 105, 60, 104, 653, 393, 145, 63, 86, 443, 376, 438,
    666, 272, 639, 2668, 3012, 917, 430, 172, 76, 169, 225, 119,
    26, 95, 49, 82, 121, 105, 157, 37, 55, 201, 73, 40, 96, 46,
    193, 88, 35, 46, 60, 36, 102, 95, 45, 52, 210, 60, 63, 60,
    28, 33, 57, 47, 36, 110, 8, 12, 48, 8, 87, 112, 105, 99,
    57, 64, 52, 11)), row.names = c(NA, -359L), class = "data.frame",
.Names = c("times",
"NG1.Open", "NG1.High", "NG1.Low", "NG1.Close", "NG1.Volume"))


NG1 <- xts(ts[,-1],ts[,1])


initDate <- Sys.Date()-1
initEq <- 5000
n <- 14
nSMA <- 200

currency("USD")
Sys.setenv(TZ="UTC")
symbols <- "NG1"
stock(symbols, currency="USD", multiplier=1)

strategy.st <- 'teststrat'
portfolio.st <- 'teststrat'
account.st <- 'teststrat'
initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='USD')
initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
initEq=initEq, currency='USD')
initOrders(portfolio=portfolio.st, initDate=initDate)



strategy(name = strategy.st,
         store = TRUE)







add.indicator(
  strategy = strategy.st,
  name = 'RSI',
  arguments = list(price=quote(Cl(mktdata)),n=n),
  label = "rsi")

add.indicator(
  strategy = strategy.st,
  name = 'SMA',
  arguments = list(x=quote(Cl(mktdata)),n=nSMA),
  label = 'sma'
)


add.signal(
  strategy = strategy.st,
  name = 'sigThreshold',
  arguments=list(
    threshold = 30,
    column = "rsi",
    relationship="lt",
    cross = TRUE),
  label = "RSI_long"
)

add.signal(
  strategy = strategy.st,
  name = 'sigThreshold',
  arguments=list(
    threshold = 70,
    column = "rsi",
    relationship="gt",
    cross = TRUE),
  label = "RSI_short"
)



add.rule(
  strategy=strategy.st,
  name='ruleSignal',
  arguments=list(
    sigcol='RSI_long',
    sigval = TRUE,
    orderside = 'long',
    ordertype='market',
    orderqty=1,
    replace=FALSE
  ),
  type='enter',
  label='Enterlong',
  path.dep = TRUE
)

add.rule(
  strategy=strategy.st,
  name='ruleSignal',
  arguments=list(
    sigcol='RSI_short',
    sigval = TRUE,
    orderside = 'short',
    ordertype='market',
    orderqty=1,
    replace=TRUE
  ),
  type='exit',
  label='Exitlong',
  path.dep = TRUE

)


t1<-Sys.time()
out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
t2<-Sys.time()
print(t2-t1)



On Mon, Oct 24, 2016 at 3:19 PM, Kevin Dhingra <
kevin.dhingra at appliedacademics.com> wrote:

> Hi Jon,
>
> As mentioned by Ilya, your arguments to SMA are incorrect. Also your
> program is missing the signal function. You need to convert your indicator
> into a signal using add.signal function before passing it to a rule. Try
> running the modified code -
>
> library(quantstrat)
> library(quantmod)
> library(tidyverse)
>
>
> ts <- structure(list(times = structure(c(1477312980, 1477313580,
>                                          1477314180,
>                                          1477314780, 1477315380,
> 1477315980, 1477316580, 1477317180, 1477317780,
>                                          1477318380, 1477318980,
> 1477319580, 1477320180, 1477320780, 1477321380,
>                                          1477321980, 1477322580,
> 1477323180, 1477323780, 1477324380, 1477324980,
>                                          1477325580, 1477326180,
> 1477326780, 1477327380, 1477327980, 1477328580,
>                                          1477329180, 1477329780,
> 1477330380, 1477330980, 1477331580, 1477332180,
>                                          1477332780, 1477333380,
> 1477333980, 1477334580), class = c("POSIXct",
>
>                           "POSIXt"), tzone = "UTC"), NG1.Open = c(2.954,
> 2.93, 2.936, 2.947,
>
>                                                                   2.951,
> 2.941, 2.929, 2.924, 2.893, 2.871, 2.891, 2.892, 2.898,
>
>                                                                   2.89,
> 2.88, 2.872, 2.885, 2.884, 2.879, 2.876, 2.876, 2.859,
>
>                                                                   2.864,
> 2.878, 2.866, 2.886, 2.892, 2.889, 2.878, 2.861, 2.859,
>
>                                                                   2.851,
> 2.859, 2.84, 2.836, 2.844, 2.839), NG1.High = c(2.959,
>
>
>                                              2.937, 2.954, 2.96, 2.957,
> 2.941, 2.932, 2.926, 2.902, 2.893,
>
>
>                                              2.898, 2.9, 2.905, 2.893,
> 2.883, 2.885, 2.891, 2.889, 2.884,
>
>
>                                              2.877, 2.877, 2.867, 2.878,
> 2.881, 2.887, 2.897, 2.893, 2.891,
>
>
>                                              2.884, 2.865, 2.862, 2.861,
> 2.859, 2.843, 2.845, 2.845, 2.842
>
>                                                                   ),
> NG1.Low = c(2.929, 2.916, 2.931, 2.946, 2.935, 2.924, 2.924,
>
>
>      2.886, 2.871, 2.852, 2.878, 2.889, 2.886, 2.87, 2.87, 2.866,
>
>
>      2.882, 2.875, 2.875, 2.871, 2.857, 2.848, 2.864, 2.863, 2.864,
>
>
>      2.884, 2.886, 2.878, 2.859, 2.851, 2.849, 2.849, 2.835, 2.829,
>
>
>      2.827, 2.836, 2.836), NG1.Close = c(2.93, 2.936, 2.947, 2.951,
>
>
>                                          2.94, 2.93, 2.924, 2.892, 2.871,
> 2.891, 2.892, 2.898, 2.89, 2.879,
>
>
>                                          2.872, 2.884, 2.884, 2.878, 2.876,
> 2.876, 2.859, 2.865, 2.878,
>
>
>                                          2.865, 2.886, 2.892, 2.888, 2.879,
> 2.862, 2.858, 2.851, 2.858,
>
>
>                                          2.839, 2.836, 2.844, 2.839,
> 2.842), NG1.Volume = c(2347, 4491,
>
>
>
>                 2793, 1124, 1624, 1864, 1646, 6497, 3625, 5570, 2231, 1506,
> 2084,
>
>
>
>                 3443, 1372, 1464, 931, 906, 557, 1266, 2047, 3021, 1206,
> 938,
>
>
>
>                 1375, 1928, 582, 1203, 1810, 1309, 803, 1368, 3141, 2227,
> 9590,
>
>
>
>                 1067, 128)), row.names = c(NA, -37L), class = "data.frame",
> .Names =
>                   c("times",
>                     "NG1.Open", "NG1.High", "NG1.Low", "NG1.Close",
> "NG1.Volume"))
>
> NG1 <- xts(ts[,-1],ts[,1])
>
>
> initDate <- index(NG1)[1]
> initEq <- 5000
> n <- 14
>
> currency("USD")
> Sys.setenv(TZ="UTC")
> symbols <- "NG1"
> stock(symbols, currency="USD", multiplier=1)
>
> strategy.st <- 'teststrat'
> portfolio.st <- 'teststrat'
> account.st <- 'teststrat'
> initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='
> USD')
> initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
>          initEq=initEq, currency='USD')
> initOrders(portfolio=portfolio.st, initDate=initDate)
>
>
>
> strategy(name = strategy.st,
>          store = TRUE)
>
> add.indicator(
>   strategy = strategy.st,
>   name = 'RSI',
>   arguments = list(price=quote(Cl(mktdata)),n=n),
>   label = "rsi")
>
>
>
> add.signal(strategy.st, name="sigThreshold",
>            arguments=list(column="rsi", threshold= 40,
>                           relationship="lt", cross=FALSE),
>            label="RSI_long")
>
> add.rule(
>   strategy=strategy.st,
>   name='ruleSignal',
>   arguments=list(
>     sigcol='RSI_long',
>     sigval = TRUE,
>     orderside = 'long',
>     ordertype='market',
>     orderqty=1,
>     replace=FALSE
>   ),
>   type='enter',
>   label='Enterlong',
>   path.dep = TRUE
> )
>
>
>
>
> t1<-Sys.time()
> out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
> t2<-Sys.time()
> print(t2-t1)
>
> On Mon, Oct 24, 2016 at 3:07 PM, Ilya Kipnis <ilya.kipnis at gmail.com>
> wrote:
>
>> Hi Jon,
>>
>> First off, check the parameters on your add.indicator call for your SMA
>> function.
>>
>> Secondly, your data is only 37 observations long and you have a setting of
>> 200.
>>
>> Please fix these two issues.
>>
>> -Ilya
>>
>> On Mon, Oct 24, 2016 at 2:55 PM, Jon Golenbock <jongolenbock at gmail.com>
>> wrote:
>>
>> > Hi folks,
>> >
>> > new to this mailing list and not very proficient with R in general yet,
>> so
>> > apologies in advance.
>> >
>> > all of the demos I could see were using stock data pulled from
>> > yahoo/google, etc -- mine is coming from bloomberg. I did my best to
>> > replicate the type of object that getsymbols() seems to create.
>> >
>> > everything seems to be working alright until I actually get to
>> > applystrategy(), where I am getting an error that I imagine, while not
>> > particularly helpful to me, will be completely obvious to somebody with
>> a
>> > bit more experience. the error i'm receiving is
>> >
>> > Error in n < 1 :
>> >   comparison (3) is possible only for atomic and list types
>> >
>> > code below. Any help is greatly appreciated and apologies for all the
>> rules
>> > I am surely breaking, I'll plead first-timer on this one.
>> >
>> >
>> >
>> > library(quantstrat)
>> > library(quantmod)
>> > library(tidyverse)
>> >
>> >
>> > ts <- structure(list(times = structure(c(1477312980, 1477313580,
>> > 1477314180,
>> > 1477314780, 1477315380, 1477315980, 1477316580, 1477317180, 1477317780,
>> > 1477318380, 1477318980, 1477319580, 1477320180, 1477320780, 1477321380,
>> > 1477321980, 1477322580, 1477323180, 1477323780, 1477324380, 1477324980,
>> > 1477325580, 1477326180, 1477326780, 1477327380, 1477327980, 1477328580,
>> > 1477329180, 1477329780, 1477330380, 1477330980, 1477331580, 1477332180,
>> > 1477332780, 1477333380, 1477333980, 1477334580), class = c("POSIXct",
>> > "POSIXt"), tzone = "UTC"), NG1.Open = c(2.954, 2.93, 2.936, 2.947,
>> > 2.951, 2.941, 2.929, 2.924, 2.893, 2.871, 2.891, 2.892, 2.898,
>> > 2.89, 2.88, 2.872, 2.885, 2.884, 2.879, 2.876, 2.876, 2.859,
>> > 2.864, 2.878, 2.866, 2.886, 2.892, 2.889, 2.878, 2.861, 2.859,
>> > 2.851, 2.859, 2.84, 2.836, 2.844, 2.839), NG1.High = c(2.959,
>> > 2.937, 2.954, 2.96, 2.957, 2.941, 2.932, 2.926, 2.902, 2.893,
>> > 2.898, 2.9, 2.905, 2.893, 2.883, 2.885, 2.891, 2.889, 2.884,
>> > 2.877, 2.877, 2.867, 2.878, 2.881, 2.887, 2.897, 2.893, 2.891,
>> > 2.884, 2.865, 2.862, 2.861, 2.859, 2.843, 2.845, 2.845, 2.842
>> > ), NG1.Low = c(2.929, 2.916, 2.931, 2.946, 2.935, 2.924, 2.924,
>> > 2.886, 2.871, 2.852, 2.878, 2.889, 2.886, 2.87, 2.87, 2.866,
>> > 2.882, 2.875, 2.875, 2.871, 2.857, 2.848, 2.864, 2.863, 2.864,
>> > 2.884, 2.886, 2.878, 2.859, 2.851, 2.849, 2.849, 2.835, 2.829,
>> > 2.827, 2.836, 2.836), NG1.Close = c(2.93, 2.936, 2.947, 2.951,
>> > 2.94, 2.93, 2.924, 2.892, 2.871, 2.891, 2.892, 2.898, 2.89, 2.879,
>> > 2.872, 2.884, 2.884, 2.878, 2.876, 2.876, 2.859, 2.865, 2.878,
>> > 2.865, 2.886, 2.892, 2.888, 2.879, 2.862, 2.858, 2.851, 2.858,
>> > 2.839, 2.836, 2.844, 2.839, 2.842), NG1.Volume = c(2347, 4491,
>> > 2793, 1124, 1624, 1864, 1646, 6497, 3625, 5570, 2231, 1506, 2084,
>> > 3443, 1372, 1464, 931, 906, 557, 1266, 2047, 3021, 1206, 938,
>> > 1375, 1928, 582, 1203, 1810, 1309, 803, 1368, 3141, 2227, 9590,
>> > 1067, 128)), row.names = c(NA, -37L), class = "data.frame", .Names =
>> > c("times",
>> > "NG1.Open", "NG1.High", "NG1.Low", "NG1.Close", "NG1.Volume"))
>> >
>> > NG1 <- xts(ts[,-1],ts[,1])
>> >
>> >
>> > initDate <- Sys.Date()-1
>> > initEq <- 5000
>> > n <- 14
>> > nSMA <- 200
>> >
>> > currency("USD")
>> > Sys.setenv(TZ="UTC")
>> > symbols <- "NG1"
>> > stock(symbols, currency="USD", multiplier=1)
>> >
>> > strategy.st <- 'teststrat'
>> > portfolio.st <- 'teststrat'
>> > account.st <- 'teststrat'
>> > initPortf(portfolio.st, symbols = symbols, initDate=initDate,currency='
>> > USD')
>> > initAcct(account.st, portfolios=portfolio.st, initDate=initDate,
>> > initEq=initEq, currency='USD')
>> > initOrders(portfolio=portfolio.st, initDate=initDate)
>> >
>> >
>> >
>> > strategy(name = strategy.st,
>> >          store = TRUE)
>> >
>> >
>> >
>> >
>> >
>> >
>> >
>> > add.indicator(
>> >   strategy = strategy.st,
>> >   name = 'RSI',
>> >   arguments = list(price=quote(Cl(mktdata)),n=n),
>> >   label = "rsi")
>> >
>> > add.indicator(
>> >   strategy = strategy.st,
>> >   name = 'SMA',
>> >   arguments = list(x=quote(Cl(mktdata)),n=SMA),
>> >   label = 'sma'
>> > )
>> >
>> >
>> >
>> > add.rule(
>> >   strategy=strategy.st,
>> >   name='ruleSignal',
>> >   arguments=list(
>> >     sigcol='RSI_long',
>> >     sigval = TRUE,
>> >     orderside = 'long',
>> >     ordertype='market',
>> >     orderqty=1,
>> >     replace=FALSE
>> >   ),
>> >   type='enter',
>> >   label='Enterlong',
>> >   path.dep = TRUE
>> > )
>> >
>> > add.rule(
>> >   strategy=strategy.st,
>> >   name='ruleSignal',
>> >   arguments=list(
>> >     sigcol='RSI_short',
>> >     sigval = TRUE,
>> >     orderside = 'short',
>> >     ordertype='market',
>> >     orderqty=1,
>> >     replace=TRUE
>> >   ),
>> >   type='exit',
>> >   label='Exitlong',
>> >   path.dep = TRUE
>> >
>> > )
>> >
>> >
>> > t1<-Sys.time()
>> > out<-applyStrategy(strategy=strategy.st,portfolios = portfolio.st)
>> > t2<-Sys.time()
>> > print(t2-t1)
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-SIG-Finance at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> > -- Subscriber-posting only. If you want to post, subscribe first.
>> > -- Also note that this is not the r-help list where general R questions
>> > should go.
>> >
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>>
>
>

	[[alternative HTML version deleted]]


From fceci at yahoo.com  Fri Oct 28 16:04:47 2016
From: fceci at yahoo.com (fceci)
Date: Fri, 28 Oct 2016 14:04:47 +0000 (UTC)
Subject: [R-SIG-Finance] PortfolioAttribution
References: <1974313049.534536.1477663487342.ref@mail.yahoo.com>
Message-ID: <1974313049.534536.1477663487342@mail.yahoo.com>

Hi everybody,
first of all thanks for making the Rmetrics suite available to all. I really find these libraries very useful.
I have an issue installing the PortfolioAttribution package. The usual command ?install.packages("PortfolioAttribution",repos="http://R-Forge.R-project.org") does not work and indeed the link to the tar.gz file:http://download.r-forge.r-project.org/src/contrib/PortfolioAttribution_0.3.tar.gz
returns a 404 error.
Is this package still available somewhere??
Thanks! Frank



	[[alternative HTML version deleted]]


From daniel.cegielka at gmail.com  Fri Oct 28 19:45:39 2016
From: daniel.cegielka at gmail.com (=?UTF-8?Q?Daniel_Cegie=C5=82ka?=)
Date: Fri, 28 Oct 2016 19:45:39 +0200
Subject: [R-SIG-Finance] PortfolioAttribution
In-Reply-To: <1974313049.534536.1477663487342@mail.yahoo.com>
References: <1974313049.534536.1477663487342.ref@mail.yahoo.com>
	<1974313049.534536.1477663487342@mail.yahoo.com>
Message-ID: <CAPLrYESLgRx5YYk-XHeeB7NpU5K_W50Pb=hmH1RBjbhrJHOSyQ@mail.gmail.com>

2016-10-28 16:04 GMT+02:00 fceci via R-SIG-Finance
<r-sig-finance at r-project.org>:
>
> Hi everybody,
> first of all thanks for making the Rmetrics suite available to all. I really find these libraries very useful.
> I have an issue installing the PortfolioAttribution package. The usual command  install.packages("PortfolioAttribution",repos="http://R-Forge.R-project.org") does not work and indeed the link to the tar.gz file:http://download.r-forge.r-project.org/src/contrib/PortfolioAttribution_0.3.tar.gz
> returns a 404 error.
> Is this package still available somewhere?
> Thanks! Frank
>

Hi Frank,

https://github.com/R-Finance/PortfolioAttribution

Best regards,
Daniel


From josh.m.ulrich at gmail.com  Fri Oct 28 19:55:31 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 28 Oct 2016 12:55:31 -0500
Subject: [R-SIG-Finance] PortfolioAttribution
In-Reply-To: <CAPLrYESLgRx5YYk-XHeeB7NpU5K_W50Pb=hmH1RBjbhrJHOSyQ@mail.gmail.com>
References: <1974313049.534536.1477663487342.ref@mail.yahoo.com>
	<1974313049.534536.1477663487342@mail.yahoo.com>
	<CAPLrYESLgRx5YYk-XHeeB7NpU5K_W50Pb=hmH1RBjbhrJHOSyQ@mail.gmail.com>
Message-ID: <CAPPM_gTcqFL9Lcu36nNPDaDCYom5Z-vh3u2CYRVT6aNDazdFtQ@mail.gmail.com>

On Fri, Oct 28, 2016 at 12:45 PM, Daniel Cegie?ka
<daniel.cegielka at gmail.com> wrote:
> 2016-10-28 16:04 GMT+02:00 fceci via R-SIG-Finance
> <r-sig-finance at r-project.org>:
>>
>> Hi everybody,
>> first of all thanks for making the Rmetrics suite available to all. I really find these libraries very useful.
>> I have an issue installing the PortfolioAttribution package. The usual command  install.packages("PortfolioAttribution",repos="http://R-Forge.R-project.org") does not work and indeed the link to the tar.gz file:http://download.r-forge.r-project.org/src/contrib/PortfolioAttribution_0.3.tar.gz
>> returns a 404 error.
>> Is this package still available somewhere?

The package is still available on R-Forge.  For some reason, R-Forge
is not providing the tar.gz file produced by R CMD build, but the
source is available.  You can install from source yourself by
following the instructions in this StackOverflow Q+A:
http://stackoverflow.com/q/11105131/271616

>> Thanks! Frank
>>
>
> Hi Frank,
>
> https://github.com/R-Finance/PortfolioAttribution
>
This is a read-only mirror.  R-Forge is still the authoritative
repository for this package.  Regardless, GitHub does not provide the
tar.gz files produced by R CMD build that Frank is asking for.

> Best regards,
> Daniel
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From fceci at yahoo.com  Sat Oct 29 14:51:19 2016
From: fceci at yahoo.com (fceci)
Date: Sat, 29 Oct 2016 12:51:19 +0000 (UTC)
Subject: [R-SIG-Finance] PortfolioAttribution
In-Reply-To: <CAPPM_gTcqFL9Lcu36nNPDaDCYom5Z-vh3u2CYRVT6aNDazdFtQ@mail.gmail.com>
References: <1974313049.534536.1477663487342.ref@mail.yahoo.com>
	<1974313049.534536.1477663487342@mail.yahoo.com>
	<CAPLrYESLgRx5YYk-XHeeB7NpU5K_W50Pb=hmH1RBjbhrJHOSyQ@mail.gmail.com>
	<CAPPM_gTcqFL9Lcu36nNPDaDCYom5Z-vh3u2CYRVT6aNDazdFtQ@mail.gmail.com>
Message-ID: <1160648246.214126.1477745479342@mail.yahoo.com>

Thanks guys, I'll give it a try. 

    On Friday, October 28, 2016 7:55 PM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
 

 On Fri, Oct 28, 2016 at 12:45 PM, Daniel Cegie?ka
<daniel.cegielka at gmail.com> wrote:
> 2016-10-28 16:04 GMT+02:00 fceci via R-SIG-Finance
> <r-sig-finance at r-project.org>:
>>
>> Hi everybody,
>> first of all thanks for making the Rmetrics suite available to all. I really find these libraries very useful.
>> I have an issue installing the PortfolioAttribution package. The usual command? install.packages("PortfolioAttribution",repos="http://R-Forge.R-project.org") does not work and indeed the link to the tar.gz file:http://download.r-forge.r-project.org/src/contrib/PortfolioAttribution_0.3.tar.gz
>> returns a 404 error.
>> Is this package still available somewhere?

The package is still available on R-Forge.? For some reason, R-Forge
is not providing the tar.gz file produced by R CMD build, but the
source is available.? You can install from source yourself by
following the instructions in this StackOverflow Q+A:
http://stackoverflow.com/q/11105131/271616

>> Thanks! Frank
>>
>
> Hi Frank,
>
> https://github.com/R-Finance/PortfolioAttribution
>
This is a read-only mirror.? R-Forge is still the authoritative
repository for this package.? Regardless, GitHub does not provide the
tar.gz files produced by R CMD build that Frank is asking for.

> Best regards,
> Daniel
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich? |? about.me/joshuaulrich
FOSS Trading? |? www.fosstrading.com
R/Finance 2016 | www.rinfinance.com

   
	[[alternative HTML version deleted]]


From bwater at outlook.com  Tue Nov  1 10:57:42 2016
From: bwater at outlook.com (Be Water)
Date: Tue, 1 Nov 2016 09:57:42 +0000
Subject: [R-SIG-Finance] How to add new data to be predicted with fGarch?
Message-ID: <BAY173-W90E7B7F990626A453976CCBA10@phx.gbl>

## R version 3.3.1 (2016-06-21)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows>= 8 x64 (build 9200)

library(fGarch)

## Data simulation
set.seed(345)
ar.sim <- arima.sim(model=list(ar=c(.9,-.2)), n=1000) 
tail(ar.sim) 
plot(ar.sim)

## Model fit 
model = garchFit( ~ arma(1, 2) + garch(1, 1), Data=ar.sim) 
print(model)

##QUESTION: How to add new data to be predicted?
help('predict-methods', pac=fGarch) ## I cannot find any example

newdata <- data.frame(x= -0.3)
newdata <- -0.3
predict(model, newdata = newdata, n.ahead=1)

Thanks  		 	   		  

From pierre.lequeux at hsbc.com  Tue Nov  1 10:19:02 2016
From: pierre.lequeux at hsbc.com (pierre.lequeux at hsbc.com)
Date: Tue, 1 Nov 2016 09:19:02 +0000
Subject: [R-SIG-Finance] fPortfolio minimum variance optimisation under
	constraints
Message-ID: <OF699E0F19.E35FCA48-ON8025805E.0032CD17-8025805E.00332E69@hsbcib.com>


I have when running an optimisation under constraints to derive a set of
currency hedge ratios using the fPortfolio package.  My portfolio is made
of 1 domestic asset (GBP) with a fix weight of 60% and 4 other non-domestic
assets for which I have for each a currency hedged and currency un-hedged
series with a box constraint summing up to the country weight in my
benchmark (respectively 20% for US 10% for Euro, 5% for Japan and 5% for
Switzerland). What I want to do is to find the portfolio that minimise the
variance (and also the one that maximise the risk return ratio). then the
proportionality of weights between the hedge and un-hedged asset will be my
hedge ratio.  The code below is in respect of the minimum variance
portfolio. I have coded a few lines and this seems to work most of the time
but in some occasion I am returned with a vector solution where of weights
are equal to zero. So I am obviously doing something wrong. It may be
something trivial,  possibly the initial settings of the portfolio spec or
the constraints,.but I can t seem to find what it is and running out of
ideas. I would be really thankful  if someonee could take the time to
peruse through the few below lines or point me towarda solution. I have
tried the StackOverflow forum but did not get any answer so far.  I have
attached  my code  and a sample of the data in the below.
                                                                                                                                                      
                GBP-U         USD-U         EUR-U        JPY-U         CHF-U         USD-H         EUR-H         JPY-H        CHF-H                   
 2016-05-13  0.0013866228 -0.0004015032  0.0023176509  0.004868271  0.0230163636 -0.0046939993  0.0065432710  0.0146679154  0.022040377               
 2016-05-20  0.0027094242 -0.0063831791 -0.0126106089 -0.006146676 -0.0158351590  0.0031237903  0.0045931268  0.0173505502  0.008964457               
 2016-05-27  0.0181190929  0.0140661262  0.0099806390 -0.005023782  0.0206840583  0.0223892121  0.0282165690  0.0048453909  0.033676661               
 2016-06-03 -0.0102711128  0.0081653966  0.0133194563  0.031814348  0.0092257881  0.0009701383 -0.0161380212 -0.0101505102 -0.016812484               
 2016-06-10 -0.0144639135  0.0160062120 -0.0152727781  0.008429249  0.0015983898 -0.0021260494 -0.0229890046 -0.0054785155 -0.027628141               
 2016-06-17 -0.0152295990 -0.0183599416 -0.0266861641 -0.039472434 -0.0286395252 -0.0112888146 -0.0217678087 -0.0589147494 -0.026415992               
 2016-06-24  0.0200253356  0.0317549413  0.0346147227  0.029164922  0.0401491058 -0.0166789670  0.0006268938 -0.0379679346  0.004386684               
 2016-07-01  0.0696777854  0.0620232077  0.0754752233  0.065465564  0.0704656764  0.0314514909  0.0433540129  0.0379248977  0.041482495               
 2016-07-08  0.0016753950  0.0369097752  0.0076117981  0.007834512  0.0070165833  0.0130392554 -0.0084350439 -0.0354380321 -0.006380199               
 2016-07-15  0.0118593292 -0.0037643046  0.0058939005  0.028278185 -0.0020681743  0.0144418213  0.0257127861  0.0888542585  0.015778875               
 2016-07-22  0.0092918745  0.0130552307  0.0086318585  0.001398931  0.0062780458  0.0067460116  0.0077586182  0.0070486894  0.004685162               
 2016-07-29 -0.0004646661 -0.0094042916  0.0124831676  0.025141288  0.0018086154 -0.0002180359  0.0040494413 -0.0046691781 -0.006745367               
 2016-08-05  0.0101311910  0.0160368778  0.0045395343 -0.014712256  0.0081973627  0.0040861320  0.0006639525 -0.0289135714  0.007984259               
 2016-08-12  0.0177313054  0.0125451367  0.0377475690  0.050109303  0.0322171465  0.0007342288  0.0192744848  0.0332886266  0.014216897               
 2016-08-19 -0.0086591802 -0.0121869847 -0.0131592756 -0.018946998 -0.0182591489 -0.0003056645 -0.0156054036 -0.0176744155 -0.020491089               
 2016-08-26 -0.0032629188 -0.0112907806 -0.0099742141 -0.028672792 -0.0178773544 -0.0066076557  0.0061594585 -0.0078421386  0.005324054               
 2016-09-02  0.0082322936 -0.0063800658 -0.0012434593  0.010783580  0.0006709931  0.0054516933  0.0145201246  0.0429479722  0.015518353               
 2016-09-09 -0.0172703615 -0.0222186855 -0.0031692051  0.014054238  0.0031503483 -0.0243009678 -0.0119551411  0.0001827415 -0.004089906               
 2016-09-16 -0.0105444978  0.0257113060 -0.0072348498 -0.002332981 -0.0002596633  0.0054847746 -0.0203191336 -0.0263452760 -0.015320125               
 2016-09-23  0.0294827487  0.0150126367  0.0358026791  0.041563858  0.0298489405  0.0121889694  0.0268098637  0.0263689159  0.017033142               
 2016-09-30 -0.0010620124  0.0010033756 -0.0058345738 -0.025319672 -0.0159143301  0.0014163678 -0.0060494835 -0.0215285310 -0.014212323               
 2016-10-07  0.0213392520  0.0351900327  0.0426486765  0.047394294  0.0333505051 -0.0072195144  0.0034453853  0.0210516899 -0.002539864               
 2016-10-14 -0.0050982217  0.0095672058  0.0009866843  0.004577971  0.0035956430 -0.0102205657  0.0020303997 -0.0035136735 -0.002926098               
 2016-10-21  0.0002873986  0.0004041448 -0.0029951394  0.012861688 -0.0135120432  0.0038727554  0.0087025204  0.0127856995 -0.006358163               
 2016-10-28 -0.0039917961 -0.0029823347  0.0078312950  0.013806532 -0.0053670019 -0.0070482290 -0.0052953175  0.0188646173 -0.014826428               
                                                                                                                                                      



                                                                                                                                                      
 require(fPortfolio)                                                                                                                                  
 spec <- portfolioSpec()                                                                                                                              
 mydata <- as.timeSeries(mydata)                                                                                                                      
                                                                                                                                                      
 cons <- c("eqsumW['GBP-U']=0.6" ,"eqsumW[c('USD-U','USD-H')]=0.20","eqsumW[c('EUR-U','EUR-H')]=0.10","eqsumW[c('JPY-U','JPY-H')]=0.05","eqsumW[c     
 ('CHF-U','CHF-H')]=0.05")                                                                                                                            
                                                                                                                                                      
 minvariancePortfolio(list(mu=apply(mydata,2,function(x) mean(x)),sigma=cov(mydata)), spec = spec , constraints = cons)                               
                                                                                                                                                      





when running the above lines on the data I get the following:
                                                                            
 Title:                                                                     
  MV Minimum Variance Portfolio                                             
  Estimator:         covEstimator                                           
  Solver:            solveRquadprog                                         
  Optimize:          minRisk                                                
  Constraints:       LongOnly                                               
                                                                            
 Portfolio Weights:                                                         
 GBP-U USD-U EUR-U JPY-U CHF-U USD-H EUR-H JPY-H CHF-H                      
     0     0     0     0     0     0     0     0     0                      
                                                                            
 Covariance Risk Budgets:                                                   
 GBP-U USD-U EUR-U JPY-U CHF-U USD-H EUR-H JPY-H CHF-H                      
                                                                            
                                                                            
 Target Return and Risk:                                                    
 [1] 0                                                                      
                                                                            
 Description:                                                               
  Mon Oct 31 11:26:35 2016 by user: 43951663                                
                                                                            




Clearly this is not right as I have a solution when I optimise this in
excel I get the following when I solve to minimise the portfolio risk:

                                                                                                  
     Constraints                                                                                  
 GBP 0.6000                                                                                       
 USD 0.2000                                                                                       
 EUR 0.1000                                                                                       
 JPY 0.0500                                                                                       
 CHF 0.0500                                                                                       
                                                                                                  
 Portfolio   1.0000                                                                               
                                                                                                  
                                                                                                  
 Weights                                                                                          
 GBP-U   USD-U   EUR-U   JPY-U   CHF-U   USD-H   EUR-H   JPY-H   CHF-H                            
 0.6000  0.0000  0.0000  0.0423  0.0000  0.2000  0.1000  0.0077  0.0500                           
                                                                                                  
 Portfolio Stdev 0.01562                                                                          
 Portfolio Mean  0.00424                                                                          
                                                                                                  





Kind regards



Pierre



************************************************************
HSBC Bank plc
Registered Office: 8 Canada Square, London E14 5HQ
Registered in England - Number 14259
Authorised by the Prudential Regulation Authority and regulated by the
Financial Conduct Authority and the Prudential Regulation Authority
************************************************************



-----------------------------------------
SAVE PAPER - THINK BEFORE YOU PRINT!

This E-mail is confidential.  

It may also be legally privileged. If you are not the addressee you may not copy,
forward, disclose or use any part of it. If you have received this message in error,
please delete it and all copies from your system and notify the sender immediately by
return E-mail.

Internet communications cannot be guaranteed to be timely secure, error or virus-free.
The sender does not accept liability for any errors or omissions.


From thomas.fuller at coherentlogic.com  Tue Nov  1 15:44:53 2016
From: thomas.fuller at coherentlogic.com (Thomas Fuller)
Date: Tue, 1 Nov 2016 10:44:53 -0400
Subject: [R-SIG-Finance] Coherent Datafeed R Package for Thomson Reuters
 Elektron version 1.0.9 Released Today
Message-ID: <CAM0JZ3noAunegcQfrmd7JUd+6tf=+LDGrGkjj0SL+uA4fjZLOA@mail.gmail.com>

Hi Folks,

We have a new version of the Coherent Datafeed R Package for working with
the Thomson Reuters Elektron platform available for download here:

https://coherentlogic.com/middleware-development/
solutions-for-traders-using-thomson-reuters-market-data/
releases/version-1-0-9-release-details/

Version 1.0.9 has many improvements, bug fixes, and includes the following
new functions:

QueryMarketMaker   and  GetNextMarketMakerUpdateAsJavaObject
QueryMarketByPrice and  GetNextMarketByPriceUpdateAsJavaObject
QueryMarketByOrder and  GetNextMarketByOrderUpdateAsJavaObject

The release page includes a short video that covers the installation and
usage of the package, along with example code.

More information pertaining to the Java API, which is used internally in
this package, is also available here.

With this release I am now available for contract work so if you need help
with this software, anything involving Thomson Reuters Elektron and RFA
(Java), data engineering projects (see below for two examples), or any
other projects which fit my background, please feel free to contact me
directly.

Questions and comments are welcomed.

Tom
LinkedIn <https://www.linkedin.com/in/thomasfuller>

*FRED Client*:

https://coherentlogic.com/middleware-development/are-
you-looking-to-retrieve-economic-data-from-the-federal-reserve-bank-of-st-
louis/

*World Bank Client*:

https://coherentlogic.com/middleware-development/world-bank-client/

	[[alternative HTML version deleted]]


From michael.weylandt at gmail.com  Tue Nov  1 17:05:25 2016
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Tue, 1 Nov 2016 11:05:25 -0500
Subject: [R-SIG-Finance] How to add new data to be predicted with fGarch?
In-Reply-To: <BAY173-W90E7B7F990626A453976CCBA10@phx.gbl>
References: <BAY173-W90E7B7F990626A453976CCBA10@phx.gbl>
Message-ID: <CAAmySGPGAY2no8OxL_--5=kyKP_HnKqEQ=bqV9=9FR6ZLp77dA@mail.gmail.com>

I'm not sure what you're trying to do. What should the `newdata`
argument be used for here? (The shocks/innovations, external
regressors, etc.?)

On Tue, Nov 1, 2016 at 4:57 AM, Be Water <bwater at outlook.com> wrote:
> ## R version 3.3.1 (2016-06-21)
> ## Platform: x86_64-w64-mingw32/x64 (64-bit)
> ## Running under: Windows>= 8 x64 (build 9200)
>
> library(fGarch)
>
> ## Data simulation
> set.seed(345)
> ar.sim <- arima.sim(model=list(ar=c(.9,-.2)), n=1000)
> tail(ar.sim)
> plot(ar.sim)
>
> ## Model fit
> model = garchFit( ~ arma(1, 2) + garch(1, 1), Data=ar.sim)
> print(model)
>
> ##QUESTION: How to add new data to be predicted?
> help('predict-methods', pac=fGarch) ## I cannot find any example
>
> newdata <- data.frame(x= -0.3)
> newdata <- -0.3
> predict(model, newdata = newdata, n.ahead=1)
>
> Thanks
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From michael.weylandt at gmail.com  Tue Nov  1 17:08:54 2016
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Tue, 1 Nov 2016 11:08:54 -0500
Subject: [R-SIG-Finance] fPortfolio minimum variance optimisation under
	constraints
In-Reply-To: <OF699E0F19.E35FCA48-ON8025805E.0032CD17-8025805E.00332E69@hsbcib.com>
References: <OF699E0F19.E35FCA48-ON8025805E.0032CD17-8025805E.00332E69@hsbcib.com>
Message-ID: <CAAmySGMHhANvVWf9kh8FZu9tuepPU4v=AYHxjM_pLCKrc2uXSg@mail.gmail.com>

Hi Pierre,

I'm willing to take a look, but could you format the data in a way
that would make it a bit easier to use?

The dput() function can produce a representation which is safe for
emailing and can be read directly back into R.

Cheers,
Michael

On Tue, Nov 1, 2016 at 4:19 AM,  <pierre.lequeux at hsbc.com> wrote:
>
> I have when running an optimisation under constraints to derive a set of
> currency hedge ratios using the fPortfolio package.  My portfolio is made
> of 1 domestic asset (GBP) with a fix weight of 60% and 4 other non-domestic
> assets for which I have for each a currency hedged and currency un-hedged
> series with a box constraint summing up to the country weight in my
> benchmark (respectively 20% for US 10% for Euro, 5% for Japan and 5% for
> Switzerland). What I want to do is to find the portfolio that minimise the
> variance (and also the one that maximise the risk return ratio). then the
> proportionality of weights between the hedge and un-hedged asset will be my
> hedge ratio.  The code below is in respect of the minimum variance
> portfolio. I have coded a few lines and this seems to work most of the time
> but in some occasion I am returned with a vector solution where of weights
> are equal to zero. So I am obviously doing something wrong. It may be
> something trivial,  possibly the initial settings of the portfolio spec or
> the constraints,.but I can t seem to find what it is and running out of
> ideas. I would be really thankful  if someonee could take the time to
> peruse through the few below lines or point me towarda solution. I have
> tried the StackOverflow forum but did not get any answer so far.  I have
> attached  my code  and a sample of the data in the below.
>
>                 GBP-U         USD-U         EUR-U        JPY-U         CHF-U         USD-H         EUR-H         JPY-H        CHF-H
>  2016-05-13  0.0013866228 -0.0004015032  0.0023176509  0.004868271  0.0230163636 -0.0046939993  0.0065432710  0.0146679154  0.022040377
>  2016-05-20  0.0027094242 -0.0063831791 -0.0126106089 -0.006146676 -0.0158351590  0.0031237903  0.0045931268  0.0173505502  0.008964457
>  2016-05-27  0.0181190929  0.0140661262  0.0099806390 -0.005023782  0.0206840583  0.0223892121  0.0282165690  0.0048453909  0.033676661
>  2016-06-03 -0.0102711128  0.0081653966  0.0133194563  0.031814348  0.0092257881  0.0009701383 -0.0161380212 -0.0101505102 -0.016812484
>  2016-06-10 -0.0144639135  0.0160062120 -0.0152727781  0.008429249  0.0015983898 -0.0021260494 -0.0229890046 -0.0054785155 -0.027628141
>  2016-06-17 -0.0152295990 -0.0183599416 -0.0266861641 -0.039472434 -0.0286395252 -0.0112888146 -0.0217678087 -0.0589147494 -0.026415992
>  2016-06-24  0.0200253356  0.0317549413  0.0346147227  0.029164922  0.0401491058 -0.0166789670  0.0006268938 -0.0379679346  0.004386684
>  2016-07-01  0.0696777854  0.0620232077  0.0754752233  0.065465564  0.0704656764  0.0314514909  0.0433540129  0.0379248977  0.041482495
>  2016-07-08  0.0016753950  0.0369097752  0.0076117981  0.007834512  0.0070165833  0.0130392554 -0.0084350439 -0.0354380321 -0.006380199
>  2016-07-15  0.0118593292 -0.0037643046  0.0058939005  0.028278185 -0.0020681743  0.0144418213  0.0257127861  0.0888542585  0.015778875
>  2016-07-22  0.0092918745  0.0130552307  0.0086318585  0.001398931  0.0062780458  0.0067460116  0.0077586182  0.0070486894  0.004685162
>  2016-07-29 -0.0004646661 -0.0094042916  0.0124831676  0.025141288  0.0018086154 -0.0002180359  0.0040494413 -0.0046691781 -0.006745367
>  2016-08-05  0.0101311910  0.0160368778  0.0045395343 -0.014712256  0.0081973627  0.0040861320  0.0006639525 -0.0289135714  0.007984259
>  2016-08-12  0.0177313054  0.0125451367  0.0377475690  0.050109303  0.0322171465  0.0007342288  0.0192744848  0.0332886266  0.014216897
>  2016-08-19 -0.0086591802 -0.0121869847 -0.0131592756 -0.018946998 -0.0182591489 -0.0003056645 -0.0156054036 -0.0176744155 -0.020491089
>  2016-08-26 -0.0032629188 -0.0112907806 -0.0099742141 -0.028672792 -0.0178773544 -0.0066076557  0.0061594585 -0.0078421386  0.005324054
>  2016-09-02  0.0082322936 -0.0063800658 -0.0012434593  0.010783580  0.0006709931  0.0054516933  0.0145201246  0.0429479722  0.015518353
>  2016-09-09 -0.0172703615 -0.0222186855 -0.0031692051  0.014054238  0.0031503483 -0.0243009678 -0.0119551411  0.0001827415 -0.004089906
>  2016-09-16 -0.0105444978  0.0257113060 -0.0072348498 -0.002332981 -0.0002596633  0.0054847746 -0.0203191336 -0.0263452760 -0.015320125
>  2016-09-23  0.0294827487  0.0150126367  0.0358026791  0.041563858  0.0298489405  0.0121889694  0.0268098637  0.0263689159  0.017033142
>  2016-09-30 -0.0010620124  0.0010033756 -0.0058345738 -0.025319672 -0.0159143301  0.0014163678 -0.0060494835 -0.0215285310 -0.014212323
>  2016-10-07  0.0213392520  0.0351900327  0.0426486765  0.047394294  0.0333505051 -0.0072195144  0.0034453853  0.0210516899 -0.002539864
>  2016-10-14 -0.0050982217  0.0095672058  0.0009866843  0.004577971  0.0035956430 -0.0102205657  0.0020303997 -0.0035136735 -0.002926098
>  2016-10-21  0.0002873986  0.0004041448 -0.0029951394  0.012861688 -0.0135120432  0.0038727554  0.0087025204  0.0127856995 -0.006358163
>  2016-10-28 -0.0039917961 -0.0029823347  0.0078312950  0.013806532 -0.0053670019 -0.0070482290 -0.0052953175  0.0188646173 -0.014826428
>
>
>
>
>
>  require(fPortfolio)
>  spec <- portfolioSpec()
>  mydata <- as.timeSeries(mydata)
>
>  cons <- c("eqsumW['GBP-U']=0.6" ,"eqsumW[c('USD-U','USD-H')]=0.20","eqsumW[c('EUR-U','EUR-H')]=0.10","eqsumW[c('JPY-U','JPY-H')]=0.05","eqsumW[c
>  ('CHF-U','CHF-H')]=0.05")
>
>  minvariancePortfolio(list(mu=apply(mydata,2,function(x) mean(x)),sigma=cov(mydata)), spec = spec , constraints = cons)
>
>
>
>
>
>
> when running the above lines on the data I get the following:
>
>  Title:
>   MV Minimum Variance Portfolio
>   Estimator:         covEstimator
>   Solver:            solveRquadprog
>   Optimize:          minRisk
>   Constraints:       LongOnly
>
>  Portfolio Weights:
>  GBP-U USD-U EUR-U JPY-U CHF-U USD-H EUR-H JPY-H CHF-H
>      0     0     0     0     0     0     0     0     0
>
>  Covariance Risk Budgets:
>  GBP-U USD-U EUR-U JPY-U CHF-U USD-H EUR-H JPY-H CHF-H
>
>
>  Target Return and Risk:
>  [1] 0
>
>  Description:
>   Mon Oct 31 11:26:35 2016 by user: 43951663
>
>
>
>
>
> Clearly this is not right as I have a solution when I optimise this in
> excel I get the following when I solve to minimise the portfolio risk:
>
>
>      Constraints
>  GBP 0.6000
>  USD 0.2000
>  EUR 0.1000
>  JPY 0.0500
>  CHF 0.0500
>
>  Portfolio   1.0000
>
>
>  Weights
>  GBP-U   USD-U   EUR-U   JPY-U   CHF-U   USD-H   EUR-H   JPY-H   CHF-H
>  0.6000  0.0000  0.0000  0.0423  0.0000  0.2000  0.1000  0.0077  0.0500
>
>  Portfolio Stdev 0.01562
>  Portfolio Mean  0.00424
>
>
>
>
>
>
> Kind regards
>
>
>
> Pierre
>
>
>
> ************************************************************
> HSBC Bank plc
> Registered Office: 8 Canada Square, London E14 5HQ
> Registered in England - Number 14259
> Authorised by the Prudential Regulation Authority and regulated by the
> Financial Conduct Authority and the Prudential Regulation Authority
> ************************************************************
>
>
>
> -----------------------------------------
> SAVE PAPER - THINK BEFORE YOU PRINT!
>
> This E-mail is confidential.
>
> It may also be legally privileged. If you are not the addressee you may not copy,
> forward, disclose or use any part of it. If you have received this message in error,
> please delete it and all copies from your system and notify the sender immediately by
> return E-mail.
>
> Internet communications cannot be guaranteed to be timely secure, error or virus-free.
> The sender does not accept liability for any errors or omissions.
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From bwater at outlook.com  Wed Nov  2 09:21:25 2016
From: bwater at outlook.com (Be Water)
Date: Wed, 2 Nov 2016 08:21:25 +0000
Subject: [R-SIG-Finance] How to add new data to be predicted with fGarch?
In-Reply-To: <CAAmySGPGAY2no8OxL_--5=kyKP_HnKqEQ=bqV9=9FR6ZLp77dA@mail.gmail.com>
References: <BAY173-W90E7B7F990626A453976CCBA10@phx.gbl>,
	<CAAmySGPGAY2no8OxL_--5=kyKP_HnKqEQ=bqV9=9FR6ZLp77dA@mail.gmail.com>
Message-ID: <BAY173-W313F948E20C26104BAAD9ECBA00@phx.gbl>

Well, I just want to predict mean and variance for the next period? based on the fitted model parameters.
Could be I don't understand how GARCH?models work.
Thanks
 		 	   		  

From michael.weylandt at gmail.com  Wed Nov  2 16:57:58 2016
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Wed, 2 Nov 2016 10:57:58 -0500
Subject: [R-SIG-Finance] How to add new data to be predicted with fGarch?
In-Reply-To: <BAY173-W313F948E20C26104BAAD9ECBA00@phx.gbl>
References: <BAY173-W90E7B7F990626A453976CCBA10@phx.gbl>
	<CAAmySGPGAY2no8OxL_--5=kyKP_HnKqEQ=bqV9=9FR6ZLp77dA@mail.gmail.com>
	<BAY173-W313F948E20C26104BAAD9ECBA00@phx.gbl>
Message-ID: <CAAmySGOUpjkVN7uP1nMwLFQNt6JYH7YdKCSNe510992WLBy6WQ@mail.gmail.com>

The fGARCH predict() method will do that with the n.ahead argument; no
need to supply newdata. Try running

> example('predict-methods', package="fGARCH")

to see an example (with plots!).

The standard ARMA and GARCH models don't need external data to make
predictions: their predictions are made by integrating over the shocks
(innovations), the distribution of which is specified by the fitted
model.

I think ugarchsim from the rugarch package sometimes needs external
regressors if you fit an ARMA-X mean model [ARMA with external
regressors], but that's because they have a new (non-shock) term that
you don't want to integrate over.

(More precisely, you probably do want to integrate over the predictive
distribution of your external regressors, but you don't want your
GARCH model doing that. Instead, you want something with a proper
model to give a predictive distribution over your external regressors
and then do use a conditioning argument to get your predictive
distribution over both the regressors and the shocks).

Cheers,
Michael



On Wed, Nov 2, 2016 at 3:21 AM, Be Water <bwater at outlook.com> wrote:
> Well, I just want to predict mean and variance for the next period  based on the fitted model parameters.
> Could be I don't understand how GARCH models work.
> Thanks
>


From kagba2006 at yahoo.com  Fri Nov  4 07:59:49 2016
From: kagba2006 at yahoo.com (FMH)
Date: Fri, 4 Nov 2016 06:59:49 +0000 (UTC)
Subject: [R-SIG-Finance] Continuous Wavelet tranform in Biwavelet Package
References: <1408856412.19125.1478242789992.ref@mail.yahoo.com>
Message-ID: <1408856412.19125.1478242789992@mail.yahoo.com>

Dear All,
I have 15 minutes of temperature data for 3 years and would like calculate and plot the CWT using wt command in Biwavelet package. 

Appreciate if someone could tell me the way to define it in wt command.
Thank you,

	[[alternative HTML version deleted]]


From michael.weylandt at gmail.com  Fri Nov  4 21:53:31 2016
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Fri, 4 Nov 2016 15:53:31 -0500
Subject: [R-SIG-Finance] Continuous Wavelet tranform in Biwavelet Package
In-Reply-To: <1408856412.19125.1478242789992@mail.yahoo.com>
References: <1408856412.19125.1478242789992.ref@mail.yahoo.com>
	<1408856412.19125.1478242789992@mail.yahoo.com>
Message-ID: <CAAmySGOtaKhG_MuwM5=bpcqTpDhTB9E42thBKZ_o8n6aiGDYnA@mail.gmail.com>

Hi FMH,

Perhaps you could set up a minimal reproducible example [1,2] to help
us answer your question.

Note that the biwavelet [sic] package has lots of examples that you
can access. The most useful ones are probably found by running

example(wt)

and

example(biwavelet)

Cheers,
Michael

[1] http://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example
[2] http://adv-r.had.co.nz/Reproducibility.html

On Fri, Nov 4, 2016 at 1:59 AM, FMH via R-SIG-Finance
<r-sig-finance at r-project.org> wrote:
> Dear All,
> I have 15 minutes of temperature data for 3 years and would like calculate and plot the CWT using wt command in Biwavelet package.
>
> Appreciate if someone could tell me the way to define it in wt command.
> Thank you,
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From damiano.luis at gmail.com  Sat Nov  5 01:51:35 2016
From: damiano.luis at gmail.com (Luis Damiano)
Date: Fri, 4 Nov 2016 21:51:35 -0300
Subject: [R-SIG-Finance] Uneven time series
Message-ID: <CAMBYN3e634azKFePok-VkyQbZkM4ex+BrLU+Vq-3RmfqS1dATQ@mail.gmail.com>

Dear all,

I'm dealing with an uneven time series with regressors [0]. If the series
was regular, my preferred approach would be some form of space state
representation such as smoothing, time varying regression or an
autoregressive process with external regressors.

The series shows a clear trend and I believe that irregularity is an
important feature. So far, I've found two alternatives: a) continuous time
models and packages like ctsem [1] and cts [2], but they seemed limited in
their application, and b) exponential smoothing for uneven time series [3]
but they wouldn't allow for regressors.

Before I give up, I was wondering if you can suggest a better way to model
this series.

Thank you a lot!

Regards,

[0] http://puu.sh/s6O9q/ba6aa206f6.png

[1] https://cran.r-project.org/web/packages/ctsem/

[2] https://cran.r-project.org/web/packages/cts/

[3] https://oroboro.com/irregular-ema/

	[[alternative HTML version deleted]]


From mwc4120 at hotmail.com  Sat Nov  5 16:51:51 2016
From: mwc4120 at hotmail.com (Michael Chen)
Date: Sat, 5 Nov 2016 15:51:51 +0000
Subject: [R-SIG-Finance]  blotter updatePortf
In-Reply-To: <CAMBYN3e634azKFePok-VkyQbZkM4ex+BrLU+Vq-3RmfqS1dATQ@mail.gmail.com>
References: <CAMBYN3e634azKFePok-VkyQbZkM4ex+BrLU+Vq-3RmfqS1dATQ@mail.gmail.com>
Message-ID: <CY4PR14MB136786730DA320A98BCFCD9BB1A50@CY4PR14MB1367.namprd14.prod.outlook.com>

I have found in running my own customized strategy using blotter and updatePortf that whether I call updatePortf after completely applying my strategy/transactions or call updatePortf at regular intervals like weekly or monthly after each period's transactions, the performance statistics are the same.  So, is there a reason that I should updatePortf regularly during a run or just wait till the end?  I am puzzled.  

Thanks,

Michael


From ilya.kipnis at gmail.com  Sat Nov  5 17:27:21 2016
From: ilya.kipnis at gmail.com (Ilya Kipnis)
Date: Sat, 5 Nov 2016 12:27:21 -0400
Subject: [R-SIG-Finance] blotter updatePortf
In-Reply-To: <CY4PR14MB136786730DA320A98BCFCD9BB1A50@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <CAMBYN3e634azKFePok-VkyQbZkM4ex+BrLU+Vq-3RmfqS1dATQ@mail.gmail.com>
	<CY4PR14MB136786730DA320A98BCFCD9BB1A50@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <CA+oJuEGiS9tiNajbLgqvwpk_kxkAQYBUiXFyJRJ-2fkS5idNqA@mail.gmail.com>

Michael,

Unless you want to use a new end equity over the course of your strategy
(EG I started off with 100 dollars, I made 50 more dollars, I want to go
forward with 150 now), there's no reason to do so that I can think of.

-Ilya

On Sat, Nov 5, 2016 at 11:51 AM, Michael Chen <mwc4120 at hotmail.com> wrote:

> I have found in running my own customized strategy using blotter and
> updatePortf that whether I call updatePortf after completely applying my
> strategy/transactions or call updatePortf at regular intervals like weekly
> or monthly after each period's transactions, the performance statistics are
> the same.  So, is there a reason that I should updatePortf regularly during
> a run or just wait till the end?  I am puzzled.
>
> Thanks,
>
> Michael
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Sun Nov  6 00:46:56 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 5 Nov 2016 18:46:56 -0500
Subject: [R-SIG-Finance] blotter updatePortf
In-Reply-To: <CY4PR14MB136786730DA320A98BCFCD9BB1A50@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <CAMBYN3e634azKFePok-VkyQbZkM4ex+BrLU+Vq-3RmfqS1dATQ@mail.gmail.com>
	<CY4PR14MB136786730DA320A98BCFCD9BB1A50@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <CAPPM_gQy1fOGFTE6i7D-7u07NJ1Cg9t2xX+D70P_TMuL3WWaKw@mail.gmail.com>

On Sat, Nov 5, 2016 at 10:51 AM, Michael Chen <mwc4120 at hotmail.com> wrote:
> I have found in running my own customized strategy using blotter and updatePortf that whether I call updatePortf after completely applying my strategy/transactions or call updatePortf at regular intervals like weekly or monthly after each period's transactions, the performance statistics are the same.  So, is there a reason that I should updatePortf regularly during a run or just wait till the end?  I am puzzled.
>
Calling updatePortf marks your portfolio to market.  I assume (since
you didn't specify in your message) that your transaction sizing is
invariant to portfolio equity.  In that case, you should not expect
calling updatePortf to change strategy performance.

In short, if your strategy doesn't depend on your portfolio market
value, there's no need to call updatePortf until the end of the
simulation.

> Thanks,
>
> Michael
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From cameronmclean.au at gmail.com  Sun Nov  6 19:10:19 2016
From: cameronmclean.au at gmail.com (Cameron McLean)
Date: Sun, 6 Nov 2016 20:10:19 +0200
Subject: [R-SIG-Finance] blotter updatePortf
Message-ID: <CAB-xM08svszwe-vS7VfbYzpe8nV-QrjyuLZ-96mzYdj21iBu4w@mail.gmail.com>

Hi Josh, Ilya

Is there example code you can share or an existing demo in quantstrat
that shows how to update the portfolio equity curve and size future
orders based on the current amount?

A simple example would be something similar to the faber demo where he
invests 20% of equity in each of the 5 asset classes (currently the
faber demo buys and sells lots of 500 shares) or a more complex
example could be using a indicator such as ATR to size trades based on
risk.

thanks
Cam


From brian at braverock.com  Sun Nov  6 20:15:19 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 6 Nov 2016 13:15:19 -0600
Subject: [R-SIG-Finance] blotter updatePortf
In-Reply-To: <CAB-xM08svszwe-vS7VfbYzpe8nV-QrjyuLZ-96mzYdj21iBu4w@mail.gmail.com>
References: <CAB-xM08svszwe-vS7VfbYzpe8nV-QrjyuLZ-96mzYdj21iBu4w@mail.gmail.com>
Message-ID: <581F8147.9080402@braverock.com>

On 11/06/2016 12:10 PM, Cameron McLean wrote:
> Is there example code you can share or an existing demo in quantstrat
> that shows how to update the portfolio equity curve and size future
> orders based on the current amount?

Look at any of the rebalancing demos.  There are rebalancing versions of 
the Faber and macd demos, at least.

These rebalance (adjust max trade size) periodically based on current 
portfolio equity.

> A simple example would be something similar to the faber demo where he
> invests 20% of equity in each of the 5 asset classes (currently the
> faber demo buys and sells lots of 500 shares) or a more complex
> example could be using a indicator such as ATR to size trades based on
> risk.

Sizing based on risk would be done via a custom order sizing function 
that used the indicator value to adjust trade size.  I believe Ilya has 
examples of this on his blog.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From weihanliu2002 at yahoo.com  Tue Nov  8 05:51:17 2016
From: weihanliu2002 at yahoo.com (Wei-han Liu)
Date: Tue, 8 Nov 2016 04:51:17 +0000 (UTC)
Subject: [R-SIG-Finance] Function ugarchroll in Package rugarch
References: <293135334.237550.1478580677660.ref@mail.yahoo.com>
Message-ID: <293135334.237550.1478580677660@mail.yahoo.com>

Hi R users:

?I am trying and learning the Package ?rugarch.? Function?ugarchroll helps?create the rolling density forecast from ARMA-GARCH models with option for re?tting

every n periods with parallel functionality. A nice example of application is posted on this webpage:?A short introduction to the rugarch package

?Could some people show how to extract all the residuals in every refitting after fitting ugarchroll function? I do not find a specific command for that purpose in the documentation.





CHEERS!


Weihan
	[[alternative HTML version deleted]]


From dmack10 at verizon.net  Tue Nov  8 13:27:54 2016
From: dmack10 at verizon.net (Daniel Mack)
Date: Tue, 08 Nov 2016 07:27:54 -0500
Subject: [R-SIG-Finance] Error Check on Yahoo Data
Message-ID: <4090ABE9-1154-478B-B570-76C74018915B@verizon.net>

All,  I did not get an update to yesterday end of day OHLC data (Nov ).  I am using quant mod with a current version of R and have been running it every day for almost 2 years.  I got data in my last call last night through Nov 4, but Nov 7th did not update.  Did anyone else experience this?   I have also observed the yahoo update times are getting erratic when the updates are published.  I also check with my day coming from google as well and did not update the Nov 7 data

FromDate = "2002-05-24"
ToDate = "2016-11-07" #Set one day ahead
DayBeingPred = "2016-11-08"


userInput=c("EMR","ESV","ETR","EQT","EFX","EQR","ESS","EL","EXC",
            "FFIV","FAST","FDX","FIS","FITB","FE","FISV","FLIR","FLS","FLR","FMC","FTI","F",?FOSL?)

getSymbols(Symbols=userInput, src="yahoo", from = FromDate, to = ToDate, auto.assign=TRUE, return.class="data.frame")  


Thanks ,   Dab 

From michael.weylandt at gmail.com  Wed Nov  9 05:42:58 2016
From: michael.weylandt at gmail.com (Michael Weylandt)
Date: Tue, 8 Nov 2016 22:42:58 -0600
Subject: [R-SIG-Finance] Continuous Wavelet tranform in Biwavelet Package
In-Reply-To: <1624283767.168774.1478666266485@mail.yahoo.com>
References: <1408856412.19125.1478242789992.ref@mail.yahoo.com>
	<1408856412.19125.1478242789992@mail.yahoo.com>
	<CAAmySGOtaKhG_MuwM5=bpcqTpDhTB9E42thBKZ_o8n6aiGDYnA@mail.gmail.com>
	<1624283767.168774.1478666266485@mail.yahoo.com>
Message-ID: <062B605D-957A-4E13-B695-2B6CC50B25A7@gmail.com>

I'm watching election results right now so can't answer. 

Keeping the list cc'd in case someone else can.  

> On Nov 8, 2016, at 10:37 PM, FMH <kagba2006 at yahoo.com> wrote:
> 
> Dear Michael,
> 
> Thank you for the comment. 
> 
> In this study, I want to capture the diurnal pattern (at period of 1 day) and I have 96 measurements for each day (15-minutes measurement).
> 
> How to define the correct code based on the above data?
> 
> The data is as attached and the current codes are as follows:
> 
> data <- read.csv("C:\\data.csv")
> attach(data)
> 
> library(biwavelet)
> dat <- cbind(1:length(data$Temp),data$Temp)
> wt.dat <- wt(dat)
> 
> par(mfrow=c(2,1))
> plot.ts(dat[,2])
> plot(wt.dat, plot.cb=TRUE, plot.phase=FALSE)
> 
> Thank you very much for your guideline.
> 
> Fir
> 
> 
> 
> On Saturday, November 5, 2016 4:53 AM, Michael Weylandt <michael.weylandt at gmail.com> wrote:
> 
> 
> Hi FMH,
> 
> Perhaps you could set up a minimal reproducible example [1,2] to help
> us answer your question.
> 
> Note that the biwavelet [sic] package has lots of examples that you
> can access. The most useful ones are probably found by running
> 
> example(wt)
> 
> and
> 
> example(biwavelet)
> 
> Cheers,
> Michael
> 
> [1] http://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example
> [2] http://adv-r.had.co.nz/Reproducibility.html
> 
> On Fri, Nov 4, 2016 at 1:59 AM, FMH via R-SIG-Finance
> <r-sig-finance at r-project.org> wrote:
> > Dear All,
> > I have 15 minutes of temperature data for 3 years and would like calculate and plot the CWT using wt command in Biwavelet package.
> >
> > Appreciate if someone could tell me the way to define it in wt command.
> > Thank you,
> 
> >
> >        [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-SIG-Finance at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> > -- Subscriber-posting only. If you want to post, subscribe first.
> > -- Also note that this is not the r-help list where general R questions should go.
> 
> 
> 
> <data.csv>

	[[alternative HTML version deleted]]


From mwc4120 at hotmail.com  Wed Nov  9 07:41:08 2016
From: mwc4120 at hotmail.com (Michael Chen)
Date: Wed, 9 Nov 2016 06:41:08 +0000
Subject: [R-SIG-Finance] blotter updatePortf
In-Reply-To: <581F8147.9080402@braverock.com>
References: <CAB-xM08svszwe-vS7VfbYzpe8nV-QrjyuLZ-96mzYdj21iBu4w@mail.gmail.com>,
	<581F8147.9080402@braverock.com>
Message-ID: <CY4PR14MB1367407CAF76BF0D343E1661B1B90@CY4PR14MB1367.namprd14.prod.outlook.com>

Reading these answers reminded me to inquire the same about Quantstrat.  I looked into the code for applyStrategy, I don't see any explicit calls to updatePort.  Is this because in my runs of quanstrat, I didn't use "real time" re-balancing? So, no update was necessary?  Usually, l  just run updatePortf (strategy) which updates every symbol and calculates PnL for each period prices available after I ran applyStrategy in quantstrat.   Please let me know if I am missing something.

thanks as always,



________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Brian G. Peterson <brian at braverock.com>
Sent: Sunday, November 6, 2016 11:15 AM
To: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] blotter updatePortf

On 11/06/2016 12:10 PM, Cameron McLean wrote:
> Is there example code you can share or an existing demo in quantstrat
> that shows how to update the portfolio equity curve and size future
> orders based on the current amount?

Look at any of the rebalancing demos.  There are rebalancing versions of
the Faber and macd demos, at least.

These rebalance (adjust max trade size) periodically based on current
portfolio equity.

> A simple example would be something similar to the faber demo where he
> invests 20% of equity in each of the 5 asset classes (currently the
> faber demo buys and sells lots of 500 shares) or a more complex
> example could be using a indicator such as ATR to size trades based on
> risk.

Sizing based on risk would be done via a custom order sizing function
that used the indicator value to adjust trade size.  I believe Ilya has
examples of this on his blog.

Regards,

Brian

--
Brian G. Peterson
http://braverock.com/brian/
Brian G. Peterson<http://braverock.com/brian/>
braverock.com
BRIAN G. PETERSON 773-459-4973. brian at braverock.com. download resume as PDF SUMMARY. Senior quantitative trader, financial analyst, technical architect, and project ...



Ph: 773-459-4973
IM: bgpbraverock

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Nov  9 12:13:39 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 9 Nov 2016 05:13:39 -0600
Subject: [R-SIG-Finance] blotter updatePortf
In-Reply-To: <CY4PR14MB1367407CAF76BF0D343E1661B1B90@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <CAB-xM08svszwe-vS7VfbYzpe8nV-QrjyuLZ-96mzYdj21iBu4w@mail.gmail.com>
	<581F8147.9080402@braverock.com>
	<CY4PR14MB1367407CAF76BF0D343E1661B1B90@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <582304E3.9030400@braverock.com>

On 11/09/2016 12:41 AM, Michael Chen wrote:
> Reading these answers reminded me to inquire the same about
> Quantstrat.  I looked into the code for applyStrategy, I don't see
> any explicit calls to updatePort.  Is this because in my runs of
> quanstrat, I didn't use "real time" re-balancing? So, no update was
> necessary?  Usually, l  just run updatePortf (strategy) which
> updates every symbol and calculates PnL for each period prices
> available after I ran applyStrategy in quantstrat.   Please let me
> know if I am missing something.

updatePortf will be called automatically in quantstrat for rebalancing,
for paramsets, and for walk.forward. It will only be called by the
default applyStrategy call if wrapup=TRUE and you're using the
(experimental, incomplete?) wrapup code.

Regards,

Brian

> on Sunday, November 6, 2016 11:15 AM, Brian G. Peterson wrote:
> On 11/06/2016 12:10 PM, Cameron McLean wrote:
>> Is there example code you can share or an existing demo in
>> quantstrat that shows how to update the portfolio equity curve and
>> size future orders based on the current amount?
>
> Look at any of the rebalancing demos.  There are rebalancing
> versions of the Faber and macd demos, at least.
>
> These rebalance (adjust max trade size) periodically based on current
> portfolio equity.
>
>> A simple example would be something similar to the faber demo
>> where he invests 20% of equity in each of the 5 asset classes
>> (currently the faber demo buys and sells lots of 500 shares) or a
>> more complex example could be using a indicator such as ATR to
>> size trades based on risk.
>
> Sizing based on risk would be done via a custom order sizing function
> that used the indicator value to adjust trade size.  I believe Ilya
> has examples of this on his blog.
>
> Regards,
>
> Brian


From roger.bos at rothschild.com  Wed Nov  9 18:48:57 2016
From: roger.bos at rothschild.com (Bos, Roger)
Date: Wed, 9 Nov 2016 17:48:57 +0000
Subject: [R-SIG-Finance] Portfolio Attributino example with one common
	benchmark
Message-ID: <0765308CD028654885F30322557308D856A861D4@NYCSM0208.rth.ad.rothschild.com>

The help shows an example with one benchmark for each asset:

    library(PortfolioAttribution)
    data(attrib)
    Attribution(Rp = attrib.returns[, 1:10],
      wp = attrib.weights[1, ],
      Rb = attrib.returns[, 11:20],
      wb = attrib.weights[2, ],
      method = "top.down",
      linking = "carino")

I tried to create modify the example to use one benchmark, as the following error message hints is possible:

Error in Attribution(Rp = attrib.returns[, 1:10], wp = attrib.weights[1,  :
  Please use benchmark xts that has columns with benchmarks for each
            asset or one common benchmark for all assets

But this is not working, giving the following error:

   Attribution(Rp = attrib.returns[, 1:10],
      wp = attrib.weights[1, ],
      Rb = attrib.returns[, 11],
      wb = 1,
      method = "top.down",
      linking = "carino")

Error in checkData(R, method = "xts") :
  The data cannot be converted into a time series.  If you are trying to pass in names from a data object with one column, you should use the form 'data[rows, columns, drop = FALSE]'.  Rownames should have standard date formats, such as '1985-03-15'.

And for completeness, drop=FALSE  does not fix the error:

    Attribution(Rp = attrib.returns[, 1:10],
      wp = attrib.weights[1, ],
      Rb = attrib.returns[, 11, drop=FALSE],
      wb = 1,
      method = "top.down",
      linking = "carino")

Could anyone please show me how to do this?

Thanks, Roger




This message and any attachments are for the intended recipient?s use only. This message may contain confidential, proprietary or legally privileged information. No right to confidential or privileged treatment of this message is waived or lost by an error in transmission.
If you have received this message in error, please immediately notify the sender by e-mail, delete the message, any attachments and all copies from your system and destroy any hard copies. You must not, directly or indirectly, use, disclose, distribute, print or copy any part of this message or any attachments if you are not the intended recipient.





From fceci at yahoo.com  Thu Nov 10 17:53:49 2016
From: fceci at yahoo.com (fceci)
Date: Thu, 10 Nov 2016 16:53:49 +0000 (UTC)
Subject: [R-SIG-Finance] Portfolio Attributino example with one common
	benchmark
References: <1158910971.1408058.1478796829705.ref@mail.yahoo.com>
Message-ID: <1158910971.1408058.1478796829705@mail.yahoo.com>

This is supposed to be appended to Roger Bos' post with the same title, but I am not sure it will not result in a new post. If it does, I am sorry....
Roger, concerning your question:
?I think that if you do
...
Rb = attrib.returns[, 11:20],
wb = c(1,rep(0,9))
...

you actually have a single benchmark for all assets. Unless I am wrong, the program uses only the 11th column of attrib.returns and does not care about the others that are weighted at zero.

Caveat emptor: I just started looking into the package so I may be wrong.
Regards, Frank

	[[alternative HTML version deleted]]


From mwc4120 at hotmail.com  Fri Nov 11 11:04:05 2016
From: mwc4120 at hotmail.com (Michael Chen)
Date: Fri, 11 Nov 2016 10:04:05 +0000
Subject: [R-SIG-Finance] blotter updatePortf
In-Reply-To: <582304E3.9030400@braverock.com>
References: <CAB-xM08svszwe-vS7VfbYzpe8nV-QrjyuLZ-96mzYdj21iBu4w@mail.gmail.com>
	<581F8147.9080402@braverock.com>
	<CY4PR14MB1367407CAF76BF0D343E1661B1B90@CY4PR14MB1367.namprd14.prod.outlook.com>,
	<582304E3.9030400@braverock.com>
Message-ID: <CY4PR14MB13672C4B8794C3E4C3AF3CA1B1BB0@CY4PR14MB1367.namprd14.prod.outlook.com>


Hi,

So, in running my custom strategy using blotter, I ran into this problem.  I'll describle the problem first before I give the simplified code to save some trouble and time for all.    I  ran  updatePortf(strategy, symbols, Dates=tradeDate), updpateAcct, and updateEndEq after each weekly transactions (addTxn).    Data is also in weekly format.  I also ran my program entirely first, then ran updatePortf(Strategy) at end.     The codes is otherwise the same.  The two runs have differene Equity curves and  performance analystics results.    Since in both runs, the trades(transactions) are the same, shouldn't the equity curve and performance results the same?    Thanks for any general suggestions and advice that I can try to fix this first.   If not, I will provide data and simplified code.

thank you all again,

Michael
________________________________
From: R-SIG-Finance <r-sig-finance-bounces at r-project.org> on behalf of Brian G. Peterson <brian at braverock.com>
Sent: Wednesday, November 9, 2016 3:13 AM
To: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] blotter updatePortf

On 11/09/2016 12:41 AM, Michael Chen wrote:
> Reading these answers reminded me to inquire the same about
> Quantstrat.  I looked into the code for applyStrategy, I don't see
> any explicit calls to updatePort.  Is this because in my runs of
> quanstrat, I didn't use "real time" re-balancing? So, no update was
> necessary?  Usually, l  just run updatePortf (strategy) which
> updates every symbol and calculates PnL for each period prices
> available after I ran applyStrategy in quantstrat.   Please let me
> know if I am missing something.

updatePortf will be called automatically in quantstrat for rebalancing,
for paramsets, and for walk.forward. It will only be called by the
default applyStrategy call if wrapup=TRUE and you're using the
(experimental, incomplete?) wrapup code.

Regards,

Brian

> on Sunday, November 6, 2016 11:15 AM, Brian G. Peterson wrote:
> On 11/06/2016 12:10 PM, Cameron McLean wrote:
>> Is there example code you can share or an existing demo in
>> quantstrat that shows how to update the portfolio equity curve and
>> size future orders based on the current amount?
>
> Look at any of the rebalancing demos.  There are rebalancing
> versions of the Faber and macd demos, at least.
>
> These rebalance (adjust max trade size) periodically based on current
> portfolio equity.
>
>> A simple example would be something similar to the faber demo
>> where he invests 20% of equity in each of the 5 asset classes
>> (currently the faber demo buys and sells lots of 500 shares) or a
>> more complex example could be using a indicator such as ATR to
>> size trades based on risk.
>
> Sizing based on risk would be done via a custom order sizing function
> that used the indicator value to adjust trade size.  I believe Ilya
> has examples of this on his blog.
>
> Regards,
>
> Brian

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions should go.

	[[alternative HTML version deleted]]


From brian at braverock.com  Fri Nov 11 11:56:33 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Fri, 11 Nov 2016 04:56:33 -0600
Subject: [R-SIG-Finance] blotter updatePortf
In-Reply-To: <CY4PR14MB13672C4B8794C3E4C3AF3CA1B1BB0@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <CAB-xM08svszwe-vS7VfbYzpe8nV-QrjyuLZ-96mzYdj21iBu4w@mail.gmail.com>
	<581F8147.9080402@braverock.com>
	<CY4PR14MB1367407CAF76BF0D343E1661B1B90@CY4PR14MB1367.namprd14.prod.outlook.com>
	<582304E3.9030400@braverock.com>
	<CY4PR14MB13672C4B8794C3E4C3AF3CA1B1BB0@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <5825A3E1.2020909@braverock.com>

Without a minimal reproducible example, I'm just guessing.

I would hope that what you really mean is that you are using daily data, 
since daily data is widely available. Even if you plan to trade only 
once a week (Monday, Friday, Wednesday, whatever) I would certainly want 
more data points to check risk and other metrics against. In any event, 
without more information, I would assume a subsetting problem.

The first thing I would check is that in your periodic runs of 
updatePortf, you should not be using a date range. Differences are most 
likely due to incorrect subsetting with your 'weekly' data.  You say 
below that you are calling something like:

updatePortf(strategy, symbols, Dates=tradeDate)

just call

updatePortf(strategy, symbols)

instead.

If my guess is correct, forcing the  subset is not providing the 
'starting' values to calculate the difference on your 'tradeDate' period 
from.

Regards,

Brian

On 11/11/2016 04:04 AM, Michael Chen wrote:
>
> Hi,
>
> So, in running my custom strategy using blotter, I ran into this
> problem.  I'll describle the problem first before I give the
> simplified code to save some trouble and time for all.    I  ran
> updatePortf(strategy, symbols, Dates=tradeDate), updpateAcct, and
> updateEndEq after each weekly transactions (addTxn).    Data is also
> in weekly format.  I also ran my program entirely first, then ran
> updatePortf(Strategy) at end.     The codes is otherwise the same.
> The two runs have differene Equity curves and  performance analystics
> results.    Since in both runs, the trades(transactions) are the
> same, shouldn't the equity curve and performance results the same?
> Thanks for any general suggestions and advice that I can try to fix
> this first.   If not, I will provide data and simplified code.
>
> thank you all again,
>
> Michael ________________________________ From: R-SIG-Finance
> <r-sig-finance-bounces at r-project.org> on behalf of Brian G. Peterson
> <brian at braverock.com> Sent: Wednesday, November 9, 2016 3:13 AM To:
> r-sig-finance at r-project.org Subject: Re: [R-SIG-Finance] blotter
> updatePortf
>
> On 11/09/2016 12:41 AM, Michael Chen wrote:
>> Reading these answers reminded me to inquire the same about
>> Quantstrat.  I looked into the code for applyStrategy, I don't see
>> any explicit calls to updatePort.  Is this because in my runs of
>> quanstrat, I didn't use "real time" re-balancing? So, no update
>> was necessary?  Usually, l  just run updatePortf (strategy) which
>> updates every symbol and calculates PnL for each period prices
>> available after I ran applyStrategy in quantstrat.   Please let me
>> know if I am missing something.
>
> updatePortf will be called automatically in quantstrat for
> rebalancing, for paramsets, and for walk.forward. It will only be
> called by the default applyStrategy call if wrapup=TRUE and you're
> using the (experimental, incomplete?) wrapup code.
>
> Regards,
>
> Brian
>
>> on Sunday, November 6, 2016 11:15 AM, Brian G. Peterson wrote: On
>> 11/06/2016 12:10 PM, Cameron McLean wrote:
>>> Is there example code you can share or an existing demo in
>>> quantstrat that shows how to update the portfolio equity curve
>>> and size future orders based on the current amount?
>>
>> Look at any of the rebalancing demos.  There are rebalancing
>> versions of the Faber and macd demos, at least.
>>
>> These rebalance (adjust max trade size) periodically based on
>> current portfolio equity.
>>
>>> A simple example would be something similar to the faber demo
>>> where he invests 20% of equity in each of the 5 asset classes
>>> (currently the faber demo buys and sells lots of 500 shares) or
>>> a more complex example could be using a indicator such as ATR to
>>> size trades based on risk.
>>
>> Sizing based on risk would be done via a custom order sizing
>> function that used the indicator value to adjust trade size.  I
>> believe Ilya has examples of this on his blog.
>>
>> Regards,
>>
>> Brian
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance --
> Subscriber-posting only. If you want to post, subscribe first. --
> Also note that this is not the r-help list where general R questions
> should go.
>
> [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance --
> Subscriber-posting only. If you want to post, subscribe first. --
> Also note that this is not the r-help list where general R questions
> should go.
>


-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From coltonsmith321 at gmail.com  Tue Nov 15 19:50:28 2016
From: coltonsmith321 at gmail.com (Colton Smith)
Date: Tue, 15 Nov 2016 10:50:28 -0800
Subject: [R-SIG-Finance] Properly making a xts object from csv file
Message-ID: <CAE5uSD0FRF1T3hkthzFVXmUr3aP-OzrH6snCrEzr0DRW2VVwVQ@mail.gmail.com>

Hello,

I'm currently wokring with a csv file that looks like this:
[image: Inline image 1]
I'm trying to make it an xts object so I can use it for backtesting. If I
detach dplyr, errors happen on the stock() line and if I have dplyr
attached errors happen initPortf()/initOrders().
[image: Inline image 1]
I'm aware of the frustrating interactions between dplyr and finance
packages. I assume there is a proper way to go about this without using
dplyr. If anybody could link me to an example or explain what I need to
use, that'd be great!

Thanks,
Colton Smith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161115/ade1a1d1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 21163 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161115/ade1a1d1/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 69809 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161115/ade1a1d1/attachment-0001.png>

From josh.m.ulrich at gmail.com  Tue Nov 15 20:05:07 2016
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 15 Nov 2016 13:05:07 -0600
Subject: [R-SIG-Finance] Properly making a xts object from csv file
In-Reply-To: <CAE5uSD0FRF1T3hkthzFVXmUr3aP-OzrH6snCrEzr0DRW2VVwVQ@mail.gmail.com>
References: <CAE5uSD0FRF1T3hkthzFVXmUr3aP-OzrH6snCrEzr0DRW2VVwVQ@mail.gmail.com>
Message-ID: <CAPPM_gT1WFB6CC0hD6WwBhoFQdBHCAXGXoB6ZRuG+Mk1r7jytA@mail.gmail.com>

Hi Colton,

On Tue, Nov 15, 2016 at 12:50 PM, Colton Smith <coltonsmith321 at gmail.com> wrote:
> Hello,
>
> I'm currently wokring with a csv file that looks like this:
>
Pictures of data aren't particularly helpful.  Someone would have to
hand-enter those values to be able to do anything meaningful with the
data.

> I'm trying to make it an xts object so I can use it for backtesting. If I
> detach dplyr, errors happen on the stock() line and if I have dplyr attached
> errors happen initPortf()/initOrders().
>
Pictures of code are even less helpful than pictures of data.  No one
can copy/paste your picture into their R console to try and replicate
your results. ;)

> I'm aware of the frustrating interactions between dplyr and finance
> packages. I assume there is a proper way to go about this without using
> dplyr. If anybody could link me to an example or explain what I need to use,
> that'd be great!
>
Nothing in FinancialInstrument depends on dplyr, so there's no way
that *not* having dplyr attached could cause an issue with stock().
The problem is that you're passing an xts object as the 'primary_id',
when the documentation says:

primary_id: String describing the unique ID for the instrument. Most of
          the wrappers allow this to be a vector.

dplyr shouldn't cause issues with most package code, because most
packages should now protect themselves from the sort of badness in
dplyr (I'm looking at you, dplyr::lag).  But it will cause issues for
you at the top-level, because calling lag() on an xts object won't do
what you'd expect.

> Thanks,
> Colton Smith
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2016 | www.rinfinance.com


From diegoperoni at vodafone.it  Fri Nov 18 10:22:21 2016
From: diegoperoni at vodafone.it (Diego Peroni)
Date: Fri, 18 Nov 2016 10:22:21 +0100
Subject: [R-SIG-Finance] Quantstrat Exit Signal by Time from Enter
Message-ID: <d57c0056-861f-6aee-ccf6-ea820a7283a6@vodafone.it>

Hi all,

is there a way to create a signal that triggers an exit rule just by 
evaluating that my position is losing after N bars from Enter Time?

Thanks in advance

Diego


From oleg.mubarakshin at gmail.com  Mon Nov 21 14:55:42 2016
From: oleg.mubarakshin at gmail.com (Oleg Mubarakshin)
Date: Mon, 21 Nov 2016 13:55:42 +0000
Subject: [R-SIG-Finance] Fw: Rblapi
Message-ID: <5832fce0.2aa9c20a.88c0a.4eb5@mx.google.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161121/2fa3be6c/attachment.html>

From armstrong.whit at gmail.com  Mon Nov 21 15:14:54 2016
From: armstrong.whit at gmail.com (Whit Armstrong)
Date: Mon, 21 Nov 2016 09:14:54 -0500
Subject: [R-SIG-Finance] Fw: Rblapi
In-Reply-To: <5832fce0.2aa9c20a.88c0a.4eb5@mx.google.com>
References: <5832fce0.2aa9c20a.88c0a.4eb5@mx.google.com>
Message-ID: <CAMi=pg7S4wWFhs1_a-KoMFxKKJPizAvfNXaVqOxCtkTnjmnWgw@mail.gmail.com>

I think what you want is overrides, not options.

For package specific questions like this, I suggest the github site rather
than the general r-sig-fin list.
https://github.com/Rblp/Rblpapi/issues

-Whit


On Mon, Nov 21, 2016 at 8:55 AM, Oleg Mubarakshin <
oleg.mubarakshin at gmail.com> wrote:

>
>
> Sent from my Huawei Ascend Mate 7
>
>
> -------- Original Message --------
> Subject: Rblapi
> From: Oleg Mubarakshin
> To: Oleg Mubarakshin
> CC:
>
>
> Hi everyone,
>
> when I am trying to receive data by bdp() with defined options I get the
> error
> sample code
> > library(Rblpapi)
> > blpConnect()
> > bdp(securities="GBP2M BGN Curncy", fields="PX_BID",
> options=c("FWD_CURVE_QUOTE_FORMAT"="OUTRIGHT"))
> Error in bdp_Impl(con, securities, fields, options, overrides, verbose,  :
>   Sub-element '(null)' does not exist.
>
> what is it?
>
>
> --
> Oleg Mubarakshin
> Senior FX Structurer [image: Currency Solutions]
> *Tel:* +44 (0)207 740 0000
> *Fax:* +44 (0)207 990 8080
> Hobbs Court, 2 Jacob Street, London SE1 2BG.
>
> www.currencysolutions.co.uk
> [image: Facebook]
> <https://www.facebook.com/Currency-Solutions-Ltd-283996884686/> [image:
> Twitter] <https://twitter.com/currencytrans> [image: Google]
> <https://www.google.co.uk/?q=currencysolutions.co.uk> [image: LinkedIn]
> <https://www.linkedin.com/company/currency-solutions> [image: RSS]
> <http://www.currencysolutions.co.uk/tools/feeds/source/news/feed.xml>
>
> Currency Solutions Ltd is registered in England, Company No. 4864491. Her
> Majesty's Revenue & Customs, No. 12162570. Regulated and authorised by the
> Financial Conduct Authority as a Payment Institution, No. No. 512130 and as
> an Investment Firm No. 602082
>
> This email (including attachments) is confidential. If you have received
> this email in error please notify the sender immediately and delete this
> email from your system without copying or disseminating it or placing any
> reliance upon its contents. We cannot accept liability for any breaches of
> confidence arising through use of email. Any opinions expressed in this
> email (including attachments) are those of the author and do not
> necessarily reflect our opinions. We will not accept responsibility for any
> commitments made by our employees outside the scope of our business. We do
> not warrant the accuracy or completeness of such information.
>
> *Please consider the environment: think before you print.*
>
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>

	[[alternative HTML version deleted]]


From oleg.mubarakshin at gmail.com  Mon Nov 21 15:17:45 2016
From: oleg.mubarakshin at gmail.com (Oleg Mubarakshin)
Date: Mon, 21 Nov 2016 14:17:45 +0000
Subject: [R-SIG-Finance] Fw: Rblapi
Message-ID: <5833020b.6a5cc20a.a0487.5d17@mx.google.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161121/d443d8ef/attachment.html>

From will.oswald at gmail.com  Thu Dec  1 04:05:45 2016
From: will.oswald at gmail.com (Will Oswald)
Date: Thu, 1 Dec 2016 03:05:45 +0000 (UTC)
Subject: [R-SIG-Finance] Cochrane-Piazzesi model in R
Message-ID: <7CC3C8748E4617B1.8EE0781A-3482-42B9-9D19-74878D22B8A1@mail.outlook.com>

I am doing some work on forecasting bond returns, and am looking for R implementations of a range of different models:- Cochrane & Piazzesi (Cochrane, John H. and Monika Piazzesi. 2005. "Bond Risk Premia." American Economic Review, 95(1): 138-160). Monica Piazzesi's homepage has the code available in MatLab (http://www.stanford.edu/~piazzesi/cp.zip)- Fama-Bliss unsmoothed yields (Fama, EF and RR Bliss. 1987. "The Information in Long-Maturity Forward Rates." American Economic Review, 77(4), 680-692). I am not sure if this can be done within the termstrc package, but it doesn't seem to be an explicit function- Adrian, Crump & Moench (Adrian, Tobias; Richard K Crump & Emanuel Moench. 2013. "Pricing the Term Structure with Linear Regressions." Federal Reserve Bank of New York Staff Reports.)
Is anyone on this list aware of implementations done in R and if so, would they be willing to share?
Thank you,Will Oswald



	[[alternative HTML version deleted]]


From prosomething at hotmail.com  Mon Dec 12 18:17:36 2016
From: prosomething at hotmail.com (Aaron)
Date: Mon, 12 Dec 2016 17:17:36 +0000
Subject: [R-SIG-Finance] Basket stop loss implementation quantstrat
Message-ID: <ME1PR01MB2001AC0EB82DEC33F40087EBCA980@ME1PR01MB2001.ausprd01.prod.outlook.com>

Is it possible to implement a basket or portfolio stoploss in quantstrat? That is, I would like to trade a number of symbols simultaneously and use accumulated p/l across all symbols as a global stoploss/take profit.

I have not seen any examples of this in quanstrat, likely as this method of position management is normally seen in foreign exhange trading and not stocks.

Is it possible to do or would it require getting a list of possible entry prices for all symbols and performing post-hoc  position managent?

Cheers,
BobbyT

	[[alternative HTML version deleted]]


From adarshpl7 at gmail.com  Mon Dec 12 18:57:04 2016
From: adarshpl7 at gmail.com (Adarsh KP)
Date: Mon, 12 Dec 2016 23:27:04 +0530
Subject: [R-SIG-Finance] Need help with replication of a strategy using
 'Quantstrat' & 'IKTrading' packages
Message-ID: <CAD8M0rPUNxPfnGcUyTbGqxLebMXjEcKZEsuJxnn3S2y-EAtqZg@mail.gmail.com>

Dear All,

I am trying to replicate core strategy (for a single instrument) from the
book 'Following the trend' by Andreas Clenow. Details about the strategy
are in the picture in this link
(*https://drive.google.com/file/d/0B5GQskyO5V5SVU1SdTFhY2txWEk/view?usp=sharing
<https://drive.google.com/file/d/0B5GQskyO5V5SVU1SdTFhY2txWEk/view?usp=sharing>*).
I was able to add entry indicators, signals & rules, but need help with the
exit part (6th & 7th bullet points in the picture). Also, I am not able to
update the portfolio, hence cannot plot performance charts. I would be very
grateful for your help if you could look into the code attached and help me
resolve this issue.


-- 
Best
,

*Adarsh KP*

Research Associate in Finance,
Indian School of Business (ISB),
Hyderabad, India.
+91-9126140440
<https://www.linkedin.com/profile/view?id=204329912&trk=nav_responsive_tab_profile>

?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161212/d4d0d5d4/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Query.R
Type: application/octet-stream
Size: 7096 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20161212/d4d0d5d4/attachment.obj>

From brian at braverock.com  Mon Dec 12 19:32:45 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 12 Dec 2016 12:32:45 -0600
Subject: [R-SIG-Finance] Basket stop loss implementation quantstrat
In-Reply-To: <ME1PR01MB2001AC0EB82DEC33F40087EBCA980@ME1PR01MB2001.ausprd01.prod.outlook.com>
References: <ME1PR01MB2001AC0EB82DEC33F40087EBCA980@ME1PR01MB2001.ausprd01.prod.outlook.com>
Message-ID: <1481567565.15474.48.camel@braverock.com>

On Mon, 2016-12-12 at 17:17 +0000, Aaron wrote:
> Is it possible to implement a basket or portfolio stoploss in
> quantstrat? That is, I would like to trade a number of symbols
> simultaneously and use accumulated p/l across all symbols as a global
> stoploss/take profit.
> 
> I have not seen any examples of this in quanstrat, likely as this
> method of position management is normally seen in foreign exhange
> trading and not stocks.
> 
> Is it possible to do or would it require getting a list of possible
> entry prices for all symbols and performing post-hoc??position
> management?

quantstrat isn't really optimized for this kind of rule.

You could do it with a rebalance rule, but it will add a cross-symbol
loop on every rebalance period.

Brian


From brian at braverock.com  Mon Dec 12 23:52:33 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 12 Dec 2016 16:52:33 -0600
Subject: [R-SIG-Finance] Need help with replication of a strategy using
 'Quantstrat' & 'IKTrading' packages
In-Reply-To: <CAD8M0rPUNxPfnGcUyTbGqxLebMXjEcKZEsuJxnn3S2y-EAtqZg@mail.gmail.com>
References: <CAD8M0rPUNxPfnGcUyTbGqxLebMXjEcKZEsuJxnn3S2y-EAtqZg@mail.gmail.com>
Message-ID: <1481583153.15474.54.camel@braverock.com>

On Mon, 2016-12-12 at 23:27 +0530, Adarsh KP wrote:
> I am trying to replicate core strategy (for a?single instrument) from
> the book 'Following the trend' by Andreas Clenow. Details about the
> strategy are in the picture in this link (https://drive.google.com/fi
> le/d/0B5GQskyO5V5SVU1SdTFhY2txWEk/view?usp=sharing). I was able?to
> add entry indicators, signals & rules, but need help with the exit
> part (6th & 7th bullet points in the picture). Also, I am not able to
> update the portfolio, hence cannot plot performance charts. I?would
> be very grateful for your help if you could look into the code
> attached?and help me resolve this issue.?

The most efficient way to accomplish this is likely to use a trailing
order.

- Calculate ATR and 3xATR as an indicator
- Chain a trailing exit with prefer='High' and threshold = 3xATR

Regards,

Brian


From adarshpl7 at gmail.com  Tue Dec 13 14:13:22 2016
From: adarshpl7 at gmail.com (Adarsh KP)
Date: Tue, 13 Dec 2016 18:43:22 +0530
Subject: [R-SIG-Finance] Need help with replication of a strategy using
 'Quantstrat' & 'IKTrading' packages
In-Reply-To: <1481583153.15474.54.camel@braverock.com>
References: <CAD8M0rPUNxPfnGcUyTbGqxLebMXjEcKZEsuJxnn3S2y-EAtqZg@mail.gmail.com>
	<1481583153.15474.54.camel@braverock.com>
Message-ID: <CAD8M0rNT7X4M3AHJdf+R7EDq4=7cfiF6CObEMtEbZmWNdmkFMA@mail.gmail.com>

Dear Brian,

Thank you very much for your suggestion. I will do that now. Also, my
portfolio is not getting updated despite using 'updatePortf' & 'updateAcct'
functions. Could you please look into the code and tell me what went wrong.
I started using this package a week ago. So I may sound naive, please don't
mind.

-- 
?Best?
,

*Adarsh KP*

Research Associate in Finance,
Indian School of Business (ISB),
Hyderabad, India.
+91-9126140440
<https://www.linkedin.com/profile/view?id=204329912&trk=nav_responsive_tab_profile>

	[[alternative HTML version deleted]]


From prosomething at hotmail.com  Tue Dec 13 20:37:06 2016
From: prosomething at hotmail.com (Aaron)
Date: Tue, 13 Dec 2016 19:37:06 +0000
Subject: [R-SIG-Finance] Basket stop loss implementation quantstrat
In-Reply-To: <1481567565.15474.48.camel@braverock.com>
References: <ME1PR01MB2001AC0EB82DEC33F40087EBCA980@ME1PR01MB2001.ausprd01.prod.outlook.com>,
	<1481567565.15474.48.camel@braverock.com>
Message-ID: <ME1PR01MB2001954EF4704D0978397BC5CA9B0@ME1PR01MB2001.ausprd01.prod.outlook.com>

Hi Brian,


Thank you for the reply.


I'm going to go out on a limb and assume that rebalancing in this way will come at the cost of considerable overhead(?). I plan on testing 28 symbols with a minimum data periodicity of 15 minutes (over a period of ~10 years). How significant would the extra overhead be in a situation like this?


I have not yet got into rebalancing rules in quantstrat. Is there an example I could look up which could point me in the right direction?


Also, as my objective appears to be outside the scope of normal quantstrat applications, are you able to provide some sketch code as to how such an operation would be managed? I'm more than happy to have a dig at this myself but somewhere to start would be nice.


Cheers,

Aaron


________________________________
From: Brian G. Peterson <brian at braverock.com>
Sent: Tuesday, 13 December 2016 5:32 AM
To: Aaron; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Basket stop loss implementation quantstrat

On Mon, 2016-12-12 at 17:17 +0000, Aaron wrote:
> Is it possible to implement a basket or portfolio stoploss in
> quantstrat? That is, I would like to trade a number of symbols
> simultaneously and use accumulated p/l across all symbols as a global
> stoploss/take profit.
>
> I have not seen any examples of this in quanstrat, likely as this
> method of position management is normally seen in foreign exhange
> trading and not stocks.
>
> Is it possible to do or would it require getting a list of possible
> entry prices for all symbols and performing post-hoc  position
> management?

quantstrat isn't really optimized for this kind of rule.

You could do it with a rebalance rule, but it will add a cross-symbol
loop on every rebalance period.

Brian


	[[alternative HTML version deleted]]


From brian at braverock.com  Tue Dec 13 21:05:22 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 13 Dec 2016 14:05:22 -0600
Subject: [R-SIG-Finance] Basket stop loss implementation quantstrat
In-Reply-To: <ME1PR01MB2001954EF4704D0978397BC5CA9B0@ME1PR01MB2001.ausprd01.prod.outlook.com>
References: <ME1PR01MB2001AC0EB82DEC33F40087EBCA980@ME1PR01MB2001.ausprd01.prod.outlook.com>
	, <1481567565.15474.48.camel@braverock.com>
	<ME1PR01MB2001954EF4704D0978397BC5CA9B0@ME1PR01MB2001.ausprd01.prod.outlook.com>
Message-ID: <1481659522.15474.63.camel@braverock.com>

Yes, it comes at a cost, as I said in my message, and as the
documentation for applyStrategy.rebalancing describes.

In the demo folder, see any of the 'rebalancing' demos for sample code.

Regards,

Brian

On Tue, 2016-12-13 at 19:37 +0000, Aaron wrote:
> Hi Brian,
> 
> 
> Thank you for the reply.
> 
> 
> I'm going to go out on a limb and assume that rebalancing in this way
> will come at the cost of considerable overhead(?). I plan on testing
> 28 symbols with a minimum data periodicity of 15 minutes (over a
> period of ~10 years). How significant would the extra overhead be in
> a situation like this?
> 
> 
> I have not yet got into rebalancing rules in quantstrat. Is there an
> example I could look up which could point me in the right direction?
> 
> 
> Also, as my objective appears to be outside the scope of normal
> quantstrat applications, are you able to provide some sketch code as
> to how such an operation would be managed? I'm more than happy to
> have a dig at this myself but somewhere to start would be nice.
> 
> 
> Cheers,
> 
> Aaron
> 
> 
> ________________________________
> From: Brian G. Peterson <brian at braverock.com>
> Sent: Tuesday, 13 December 2016 5:32 AM
> To: Aaron; r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] Basket stop loss implementation
> quantstrat
> 
> On Mon, 2016-12-12 at 17:17 +0000, Aaron wrote:
> > 
> > Is it possible to implement a basket or portfolio stoploss in
> > quantstrat? That is, I would like to trade a number of symbols
> > simultaneously and use accumulated p/l across all symbols as a
> > global
> > stoploss/take profit.
> > 
> > I have not seen any examples of this in quanstrat, likely as this
> > method of position management is normally seen in foreign exhange
> > trading and not stocks.
> > 
> > Is it possible to do or would it require getting a list of possible
> > entry prices for all symbols and performing post-hoc??position
> > management?
> quantstrat isn't really optimized for this kind of rule.
> 
> You could do it with a rebalance rule, but it will add a cross-symbol
> loop on every rebalance period.
> 
> Brian
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R
> questions should go.


From vineetgupta410 at gmail.com  Wed Dec 14 15:28:00 2016
From: vineetgupta410 at gmail.com (Vineet Gupta)
Date: Wed, 14 Dec 2016 14:28:00 -0000
Subject: [R-SIG-Finance] Quantstrat to backtest portfolio strategy. User
	Defined Weights
Message-ID: <014801d25616$459c8300$d0d58900$@gmail.com>

Hi,

 

I am trying to use Quantstrat to backtest a portfolio strategy with user
defined weights at each re-balance date. The user defined weights, are given
in a matrix (example shown below)

 

         Date     ABC.UN   ABT.UN ACN.UN ADBE.UW

20 2015-05-15 0.50000000 0.000000    0.5       0

21 2015-05-22 0.50000000 0.000000    0.5       0

22 2015-05-29 0.50000000 0.000000    0.5       0

23 2015-06-05 0.50000000 0.000000    0.5       0

24 2015-06-12 0.08865296 0.411347    0.5       0

25 2015-06-19 0.00000000 0.500000    0.5       0

 

Simply put, how can I backtest such a strategy, using Quantstrat? I have
looked at the rule, 'rulePctEquity', but this appears to only govern maximum
trade sizes. 

 

What information does Quantstrat need to re-balance my portfolio at each
user-defined re-balance date?

 

Thanks in advance. Very much appreciated

 

Rgds,

Vineet

 


	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Dec 14 15:40:09 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 14 Dec 2016 08:40:09 -0600
Subject: [R-SIG-Finance] Quantstrat to backtest portfolio strategy. User
 Defined Weights
In-Reply-To: <014801d25616$459c8300$d0d58900$@gmail.com>
References: <014801d25616$459c8300$d0d58900$@gmail.com>
Message-ID: <1481726409.15474.70.camel@braverock.com>

On Wed, 2016-12-14 at 14:28 +0000, Vineet Gupta wrote:
> I am trying to use Quantstrat to backtest a portfolio strategy with
> user defined weights at each re-balance date. The user defined
> weights, are given in a matrix (example shown below)
> 
> ?????????Date?????ABC.UN???ABT.UN ACN.UN ADBE.UW
> 
> 20 2015-05-15 0.50000000 0.000000????0.5???????0
> 21 2015-05-22 0.50000000 0.000000????0.5???????0
> 22 2015-05-29 0.50000000 0.000000????0.5???????0
> 23 2015-06-05 0.50000000 0.000000????0.5???????0
> 24 2015-06-12 0.08865296 0.411347????0.5???????0
> 25 2015-06-19 0.00000000 0.500000????0.5???????0
> 
> Simply put, how can I backtest such a strategy, using Quantstrat? I
> have looked at the rule, 'rulePctEquity', but this appears to only
> govern maximum trade sizes.?
> 
> What information does Quantstrat need to re-balance my portfolio at
> each user-defined re-balance date?
> 
> Thanks in advance. Very much appreciated

You haven't really given us enough information to answer your question,
so I'm just guessing based on the information you did provide.

If you are simply 'trading' a portfolio strategy where the portfolio is
rebalanced form one set of weights to another on a specified
rebalancing period, you probably don't want quantstrat at all.

In that case, you likely want the function Return.portfolio in
PerformanceAnalytics or you want to use PortfolioAnalytics to construct
your target portfolio.

Working in returns and weights is different than working in trades and
cash.

rulePctEquity simply governs how much of the total equity is available
for each instrument in the strategy. ?It doesn't reduce the size of an
existing position on the rebalance period, if there is one. ?It could
certainly be extended to enter orders or transactions to rebalance, if
you wanted it to.

You'll have to provide a minimal reproducible example and more
information about what you'd like to do for someone to be able to help
you further.

Regards,

Brian


From prosomething at hotmail.com  Wed Dec 14 18:14:03 2016
From: prosomething at hotmail.com (Aaron)
Date: Wed, 14 Dec 2016 17:14:03 +0000
Subject: [R-SIG-Finance] Basket stop loss implementation quantstrat
In-Reply-To: <1481659522.15474.63.camel@braverock.com>
References: <ME1PR01MB2001AC0EB82DEC33F40087EBCA980@ME1PR01MB2001.ausprd01.prod.outlook.com>
	, <1481567565.15474.48.camel@braverock.com>
	<ME1PR01MB2001954EF4704D0978397BC5CA9B0@ME1PR01MB2001.ausprd01.prod.outlook.com>,
	<1481659522.15474.63.camel@braverock.com>
Message-ID: <ME1PR01MB2001549E2B35881E2F2C9FE9CA9A0@ME1PR01MB2001.ausprd01.prod.outlook.com>

Thank you Brian. This at least gives me somewhere to start. Much better than I had a few days back.


I have not had a chance to look over the demos thoroughly yet but am I correct in assuming that child rules (of the rebalancing rules) would need to be put in place for both stoploss and take profit? Or is it the other way around; the rebalancing rule exists as a child to the stoploss/take profit rules? Or have I completely overshot the runway here?


Cheers,

Aaron


________________________________
From: Brian G. Peterson <brian at braverock.com>
Sent: Wednesday, 14 December 2016 7:05 AM
To: Aaron; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Basket stop loss implementation quantstrat

Yes, it comes at a cost, as I said in my message, and as the
documentation for applyStrategy.rebalancing describes.

In the demo folder, see any of the 'rebalancing' demos for sample code.

Regards,

Brian

On Tue, 2016-12-13 at 19:37 +0000, Aaron wrote:
> Hi Brian,
>
>
> Thank you for the reply.
>
>
> I'm going to go out on a limb and assume that rebalancing in this way
> will come at the cost of considerable overhead(?). I plan on testing
> 28 symbols with a minimum data periodicity of 15 minutes (over a
> period of ~10 years). How significant would the extra overhead be in
> a situation like this?
>
>
> I have not yet got into rebalancing rules in quantstrat. Is there an
> example I could look up which could point me in the right direction?
>
>
> Also, as my objective appears to be outside the scope of normal
> quantstrat applications, are you able to provide some sketch code as
> to how such an operation would be managed? I'm more than happy to
> have a dig at this myself but somewhere to start would be nice.
>
>
> Cheers,
>
> Aaron
>
>
> ________________________________
> From: Brian G. Peterson <brian at braverock.com>
> Sent: Tuesday, 13 December 2016 5:32 AM
> To: Aaron; r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] Basket stop loss implementation
> quantstrat
>
> On Mon, 2016-12-12 at 17:17 +0000, Aaron wrote:
> >
> > Is it possible to implement a basket or portfolio stoploss in
> > quantstrat? That is, I would like to trade a number of symbols
> > simultaneously and use accumulated p/l across all symbols as a
> > global
> > stoploss/take profit.
> >
> > I have not seen any examples of this in quanstrat, likely as this
> > method of position management is normally seen in foreign exhange
> > trading and not stocks.
> >
> > Is it possible to do or would it require getting a list of possible
> > entry prices for all symbols and performing post-hoc  position
> > management?
> quantstrat isn't really optimized for this kind of rule.
>
> You could do it with a rebalance rule, but it will add a cross-symbol
> loop on every rebalance period.
>
> Brian
>
>
>        [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R
> questions should go.

	[[alternative HTML version deleted]]


From vineetgupta410 at gmail.com  Wed Dec 14 20:21:07 2016
From: vineetgupta410 at gmail.com (Vineet Gupta)
Date: Wed, 14 Dec 2016 19:21:07 -0000
Subject: [R-SIG-Finance] Quantstrat to backtest portfolio strategy. User
	Defined Weights
In-Reply-To: <1481726409.15474.70.camel@braverock.com>
References: <014801d25616$459c8300$d0d58900$@gmail.com>
	<1481726409.15474.70.camel@braverock.com>
Message-ID: <005101d2563f$3879cb00$a96d6100$@gmail.com>

Dear Brian,

 

Thank you for your answer. 

 

My apologies for not providing enough information. I have a small example at the bottom of this page ? it is incomplete, as I could not figure out how to backtest my portfolio strategy with Quantstrat.

 

Your assumptions are correct. I just want to re-balance my portfolio at specified re-balancing dates, according to a set of weights. 

 

With the function ?Return.portfolio?, aside from the R help documentation, do you know of any other guides for how to use it? If there is no documentation available, then I would be happy to share my notes, if I need to make any.

 

Also, does the ?Return.portfolio? function return objects to the Blotter environment, that we can analyse in the same way as Quantstrat strategies? 

 

Example code

 

library(quantstrat)

startDate <- '2010-01-01'   # start of data

endDate <- '2010-07-31'     # end of data

symbols = c("XLF", "XLP", "XLE", "XLY", "XLV", "XLI", "XLB", "XLK", "XLU")

Sys.setenv(TZ = "UTC")      # set time zone

getSymbols(symbols, src = 'yahoo', index.class = c("POSIXt", "POSIXct"),

           from = startDate, to = endDate, adjust = TRUE)

 

#Initialise currency and instruments

initDate <- '2009-12-31'

initEq <- 1e6

currency("USD")

stock(symbols, currency = "USD", multiplier = 1)

 

#Create our Markowitz weights

m_wts <- data.frame('Date' = seq(as.Date("2010-01-31"), by="month", length.out=7))

invisible(lapply(symbols, function(x) m_wts[[x]] <<- as.numeric(NaN)))

invisible(lapply(1:nrow(m_wts), function(i) m_wts[i, 2:9] <<- round(runif(8)/8,2)))

invisible(lapply(1:nrow(m_wts), function(i) m_wts[i, 10] <<- 1 - sum(m_wts[i, 2:9])))

unlist(lapply(1:nrow(m_wts), function(i) sum(m_wts[i,2:10 ])))

 

initPortf(name = "markowitz", symbols, initDate = initDate)

initAcct(name="markowitz", portfolios="markowitz", initDate = initDate,

                                                                initEq = initEq)

initOrders(portfolio = "markowitz", initDate = initDate)

strategy('markowitz', store = T)

 

 

Rgds,

Vineet

 

-----Original Message-----
From: Brian G. Peterson [mailto:brian at braverock.com] 
Sent: 14 December 2016 14:40
To: Vineet Gupta <vineetgupta410 at gmail.com>; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Quantstrat to backtest portfolio strategy. User Defined Weights

 

On Wed, 2016-12-14 at 14:28 +0000, Vineet Gupta wrote:

> I am trying to use Quantstrat to backtest a portfolio strategy with 

> user defined weights at each re-balance date. The user defined 

> weights, are given in a matrix (example shown below)

> 

>          Date     ABC.UN   ABT.UN ACN.UN ADBE.UW

> 

> 20 2015-05-15 0.50000000 0.000000    0.5       0

> 21 2015-05-22 0.50000000 0.000000    0.5       0

> 22 2015-05-29 0.50000000 0.000000    0.5       0

> 23 2015-06-05 0.50000000 0.000000    0.5       0

> 24 2015-06-12 0.08865296 0.411347    0.5       0

> 25 2015-06-19 0.00000000 0.500000    0.5       0

> 

> Simply put, how can I backtest such a strategy, using Quantstrat? I 

> have looked at the rule, 'rulePctEquity', but this appears to only 

> govern maximum trade sizes.

> 

> What information does Quantstrat need to re-balance my portfolio at 

> each user-defined re-balance date?

> 

> Thanks in advance. Very much appreciated

 

You haven't really given us enough information to answer your question, so I'm just guessing based on the information you did provide.

 

If you are simply 'trading' a portfolio strategy where the portfolio is rebalanced form one set of weights to another on a specified rebalancing period, you probably don't want quantstrat at all.

 

In that case, you likely want the function Return.portfolio in PerformanceAnalytics or you want to use PortfolioAnalytics to construct your target portfolio.

 

Working in returns and weights is different than working in trades and cash.

 

rulePctEquity simply governs how much of the total equity is available for each instrument in the strategy.  It doesn't reduce the size of an existing position on the rebalance period, if there is one.  It could certainly be extended to enter orders or transactions to rebalance, if you wanted it to.

 

You'll have to provide a minimal reproducible example and more information about what you'd like to do for someone to be able to help you further.

 

Regards,

 

Brian


	[[alternative HTML version deleted]]


From msinghal_22 at yahoo.com  Thu Dec 15 07:31:29 2016
From: msinghal_22 at yahoo.com (Mayank Singhal)
Date: Thu, 15 Dec 2016 06:31:29 +0000 (UTC)
Subject: [R-SIG-Finance] Quantstrat - applystrategy on subset of mktdata
References: <107258778.3485382.1481783489740.ref@mail.yahoo.com>
Message-ID: <107258778.3485382.1481783489740@mail.yahoo.com>

Hello all,
I am interested in backtesting the strategy on subset of mktdata ?but somehow the below approach is resulting into errors.
#################?yy="2016"out<-applyStrategy(strat.st , portfolios=portfolio.st, mktdata = mktdata[yy])
##################
I understand i can do it in 2 steps where in first step i calculate indicators/signals on the full time series and in second step only supply the subset of mktdata to portfolio for backtest. ?But i was wondering if there is a way to do this in single step itself ? I think the problem is that the full mktdata is added to portfolio.st and not the subset of it ?
Any pointers will be helpful,
Regards,Mayank

	[[alternative HTML version deleted]]


From brian at braverock.com  Thu Dec 15 17:38:41 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Thu, 15 Dec 2016 10:38:41 -0600
Subject: [R-SIG-Finance] Quantstrat - applystrategy on subset of mktdata
In-Reply-To: <107258778.3485382.1481783489740@mail.yahoo.com>
References: <107258778.3485382.1481783489740.ref@mail.yahoo.com>
	<107258778.3485382.1481783489740@mail.yahoo.com>
Message-ID: <1481819921.15474.75.camel@braverock.com>

On Thu, 2016-12-15 at 06:31 +0000, Mayank Singhal via R-SIG-Finance
wrote:
> I am interested in backtesting the strategy on subset of mktdata ?but
> somehow the below approach is resulting into errors.
> #################?yy="2016"out<-applyStrategy(strat.st ,
> portfolios=portfolio.st, mktdata = mktdata[yy])
> ##################
> I understand i can do it in 2 steps where in first step i calculate
> indicators/signals on the full time series and in second step only
> supply the subset of mktdata to portfolio for backtest. ?But i was
> wondering if there is a way to do this in single step itself ? I
> think the problem is that the full mktdata is added to portfolio.st
> and not the subset of it ?
> Any pointers will be helpful,
> Regards,Mayank

You don't give enough information here for anyone to help you.

Please follow the Posting Guide:

https://www.r-project.org/posting-guide.html

and create a minimal reproducible example.

Also, per the posting guide, don't post HTML, as it makes your
formatting impossible to cut and paste from, even if there were a full
example here.

Brian


From gps at asu.edu  Thu Dec 15 21:33:30 2016
From: gps at asu.edu (Geoffrey Smith)
Date: Thu, 15 Dec 2016 13:33:30 -0700
Subject: [R-SIG-Finance] rugarch and gosolnp
Message-ID: <CAGRravZXyTD=ZMwFjO6dCkaces15_ou+qVBK4ar0DyYGGF-uhw@mail.gmail.com>

Hello, I am trying to estimate the EGARCH on many time series using the
code below.  Setting solver = "solnp" produces a lot of warnings().
Setting solver = "gosolnp" works perfectly but I get different parameter
estimates if I change rseed = in the solver.control list.  Is there any way
to make the "gosolnp" estimates less sensitive to the rseed = value?  In
other words, can I change some setting so that the "gosolnp" estimates do
not vary much based on different rseed = values?  Lastly, if I only care
about the parameter estimates (not the standard errors), can I just safely
ignore the warnings() and just use solver = "solnp"?  Thank you.

ugarchspec(mean.model = list(armaOrder = c(1, 1), include.mean = TRUE),
variance.model = list(model = "eGARCH", garchOrder = c(1, 1))),
solver = "gosolnp",
solver.control = list(rseed = 1234))

	[[alternative HTML version deleted]]


From dlvanbrunt at gmail.com  Fri Dec 23 04:56:35 2016
From: dlvanbrunt at gmail.com (David L. Van Brunt, Ph.D.)
Date: Thu, 22 Dec 2016 21:56:35 -0600
Subject: [R-SIG-Finance] probability of 50% profit on short options trade
Message-ID: <CAKHx4Y4kMq3P7m=Xm=r+7JG4SvB__rjdFcpbF27OqGbPyH=ciQ@mail.gmail.com>

Hello; I've been following the "dough" trading platform for a bit and they
are big on short options strategies such as strangles, straddles,
verticals, etc.  One nice thing their platform does is compute the
probability of reaching 50% of target (max) profit, and they recommend
taking profits at that point in time.

I was wondering if there is a way to do this in R... I know there is (monte
carlo, for example) but if there is a package or tool that has done some of
the heavy lifting already, it would save me re-inventing the wheel. The
motivation, of course, is that I'd like to pass many tickers into a script
that helps me find the best trading opportunities.  Their thinking is
described here: https://www.dough.com/blog/probability-of-50-profit-on-dough

Can anyone point me in the right direction to get started?

---------------------------------------
David L. Van Brunt, Ph.D.
mailto:dlvanbrunt at gmail.com

	[[alternative HTML version deleted]]


From chidley.ryan at gmail.com  Fri Dec 23 17:53:06 2016
From: chidley.ryan at gmail.com (chidley.ryan at gmail.com)
Date: Fri, 23 Dec 2016 17:53:06 +0100
Subject: [R-SIG-Finance] Assignment to global data frame
Message-ID: <690BAC47-38EC-46A1-9911-58280BB92375@gmail.com>

Hello.

Could someone please tell me how to do the below?

 assign( df.global [ row, col ] , local.value , envir = .GlobalEnv)

Context: RBlpapi package, subscribe ( ), disallows me from passing a dataframe defined globally to it, so i must edit the df inside the function passed to subscribe ( ) however i can't find the right syntax.

Thank you for your time.

Sent from my iPad

From frankm60606 at gmail.com  Fri Dec 23 18:34:44 2016
From: frankm60606 at gmail.com (Frank)
Date: Fri, 23 Dec 2016 11:34:44 -0600
Subject: [R-SIG-Finance] probability of 50% profit on short options trade
In-Reply-To: <CAKHx4Y4kMq3P7m=Xm=r+7JG4SvB__rjdFcpbF27OqGbPyH=ciQ@mail.gmail.com>
References: <CAKHx4Y4kMq3P7m=Xm=r+7JG4SvB__rjdFcpbF27OqGbPyH=ciQ@mail.gmail.com>
Message-ID: <DBF708CEE9804182A03C2B1B61486C92@Franki7PC>

1) Why not ask the Dough Boys to do your heavy lifting? They developed this
strategy using 10 years of historical data. Ask them to run it over these 10
years for the Mar/Jun/Sep/Dec major SPY expirations for options with about
45 days until expiration.

2) Ask the Dough Boys why they only used a theoretical Monte Carlo
simulation for 2005 to generate their results. I'm retired, but I think it
is 2016.

3) What about the L in P/L? I see nothing about the losses that might have
occurred. How about the losses for the Sep 2001 strangles and straddles? And
likewise for the Sep 2008 strangles and straddles. 

I don't know of any successful option traders that only sell options short.
But 91% probability of making a profit in all these straddles and strangles
at 50% of profit and 81% if held until expiration. I'm incredulous. 

All the successful option traders I know trade spreads in which at least one
leg is long and has a reasonable delta or gamma relative to the short
option(s). They put time into models and analysis that identify option
spreads that have one leg that is cheap or correctly priced and the short
leg that is expensive.

What are three things that are short-lived?

1) Dogs that chase cars.
2) Basketball teams that can't free-throw.
3) Traders that sell naked options.

Best,

Frank
Chicago, IL

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of David L. Van Brunt, Ph.D.
Sent: Thursday, December 22, 2016 9:57 PM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] probability of 50% profit on short options trade

Hello; I've been following the "dough" trading platform for a bit and they
are big on short options strategies such as strangles, straddles,
verticals, etc.  One nice thing their platform does is compute the
probability of reaching 50% of target (max) profit, and they recommend
taking profits at that point in time.

I was wondering if there is a way to do this in R... I know there is (monte
carlo, for example) but if there is a package or tool that has done some of
the heavy lifting already, it would save me re-inventing the wheel. The
motivation, of course, is that I'd like to pass many tickers into a script
that helps me find the best trading opportunities.  Their thinking is
described here: https://www.dough.com/blog/probability-of-50-profit-on-dough

Can anyone point me in the right direction to get started?

---------------------------------------
David L. Van Brunt, Ph.D.
mailto:dlvanbrunt at gmail.com

	[[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From dlvanbrunt at gmail.com  Sun Dec 25 20:45:48 2016
From: dlvanbrunt at gmail.com (David L. Van Brunt, Ph.D.)
Date: Sun, 25 Dec 2016 13:45:48 -0600
Subject: [R-SIG-Finance] probability of 50% profit on short options trade
In-Reply-To: <DBF708CEE9804182A03C2B1B61486C92@Franki7PC>
References: <CAKHx4Y4kMq3P7m=Xm=r+7JG4SvB__rjdFcpbF27OqGbPyH=ciQ@mail.gmail.com>
	<DBF708CEE9804182A03C2B1B61486C92@Franki7PC>
Message-ID: <CAKHx4Y6Ojy3qkWqwegbgYKiRPCX8_isoRfppr0Lnu7gHREYQCA@mail.gmail.com>

Frank and Chris-

Yes, the Dough folks are advocating a strategy that I'd like to study a bit
more since the things you both mentioned all jump right out. I think Chris
took my "get started" comment to mean get started in trading this (or
trading at all), rather than get started on the evaluation of their
claims-- I was not clear. My "finding the best trading opportunities" is so
I can study their strategy from there. I've been investing and trading
profitably for 20 years (longs, shorts, equities, indices, options, actual
real estate...), but I enjoy reading and studying what others are up to in
my spare time (as FT job responsibilities allow). So when I see
extraordinary claims I like to try replicating and studying them for myself
- it's fun, and I learn a lot in the process. So many gurus cherry pick
from history (Frank caught that right off), since the most popular thing to
sell for a profit is "advice". :-)

To dissect Dough's broader claims, I'd have to reproduce what they've done
with their "probability of 50% profit" but they're not really giving enough
information to replicate it that I've been able to find.

Hence the post.

It sounds like thus far the short answer from this R forum is simply "we
don't know how to reproduce that."


On Fri, Dec 23, 2016 at 11:34 AM, Frank <frankm60606 at gmail.com> wrote:

> 1) Why not ask the Dough Boys to do your heavy lifting? They developed this
> strategy using 10 years of historical data. Ask them to run it over these
> 10
> years for the Mar/Jun/Sep/Dec major SPY expirations for options with about
> 45 days until expiration.
>
> 2) Ask the Dough Boys why they only used a theoretical Monte Carlo
> simulation for 2005 to generate their results. I'm retired, but I think it
> is 2016.
>
> 3) What about the L in P/L? I see nothing about the losses that might have
> occurred. How about the losses for the Sep 2001 strangles and straddles?
> And
> likewise for the Sep 2008 strangles and straddles.
>
> I don't know of any successful option traders that only sell options short.
> But 91% probability of making a profit in all these straddles and strangles
> at 50% of profit and 81% if held until expiration. I'm incredulous.
>
> All the successful option traders I know trade spreads in which at least
> one
> leg is long and has a reasonable delta or gamma relative to the short
> option(s). They put time into models and analysis that identify option
> spreads that have one leg that is cheap or correctly priced and the short
> leg that is expensive.
>
> What are three things that are short-lived?
>
> 1) Dogs that chase cars.
> 2) Basketball teams that can't free-throw.
> 3) Traders that sell naked options.
>
> Best,
>
> Frank
> Chicago, IL
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
> Of David L. Van Brunt, Ph.D.
> Sent: Thursday, December 22, 2016 9:57 PM
> To: r-sig-finance at r-project.org
> Subject: [R-SIG-Finance] probability of 50% profit on short options trade
>
> Hello; I've been following the "dough" trading platform for a bit and they
> are big on short options strategies such as strangles, straddles,
> verticals, etc.  One nice thing their platform does is compute the
> probability of reaching 50% of target (max) profit, and they recommend
> taking profits at that point in time.
>
> I was wondering if there is a way to do this in R... I know there is (monte
> carlo, for example) but if there is a package or tool that has done some of
> the heavy lifting already, it would save me re-inventing the wheel. The
> motivation, of course, is that I'd like to pass many tickers into a script
> that helps me find the best trading opportunities.  Their thinking is
> described here: https://www.dough.com/blog/pro
> bability-of-50-profit-on-dough
>
> Can anyone point me in the right direction to get started?
>
> ---------------------------------------
> David L. Van Brunt, Ph.D.
> mailto:dlvanbrunt at gmail.com
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>

	[[alternative HTML version deleted]]


From frankm60606 at gmail.com  Sun Dec 25 21:44:08 2016
From: frankm60606 at gmail.com (Frank)
Date: Sun, 25 Dec 2016 14:44:08 -0600
Subject: [R-SIG-Finance] probability of 50% profit on short options trade
In-Reply-To: <CAKHx4Y6Ojy3qkWqwegbgYKiRPCX8_isoRfppr0Lnu7gHREYQCA@mail.gmail.com>
References: <CAKHx4Y4kMq3P7m=Xm=r+7JG4SvB__rjdFcpbF27OqGbPyH=ciQ@mail.gmail.com>
	<DBF708CEE9804182A03C2B1B61486C92@Franki7PC>
	<CAKHx4Y6Ojy3qkWqwegbgYKiRPCX8_isoRfppr0Lnu7gHREYQCA@mail.gmail.com>
Message-ID: <536D86FFFB58439A9601FA90305E8A31@Franki7PC>

David,

I downloaded the SPY options for November 2016. There are 102160 rows of
data. Looking only at the 1/20/2017 expiration options, there are 398
out-of-the-money calls with both volume and open interest and 802
out-of-the-money puts. Figuring out which strangles and straddles would meet
their 1 sigma strategy definition would be a daunting task. This is not
really a problem with R but a problem of what is the definition of a 1 sigma
strategy or straddle. There is also the possibility of data mining the best
strategies.

Once the strategies that meet the 1 sigma definitions are identified, it is
a piece of cake to identify how many strategies make it to 50% profit and
how many are profitable at expiration. I'd do the calculations in C and also
keep track of the maximum loss. 

In just writing this email, I've figure out another problem. I could
identity strangles that are about 1 sigma away from the current SPY price,
but, what do they mean by a 1 sigma straddle? 

Best,

Frank
Chicago, IL



________________________________________
From: David L. Van Brunt, Ph.D. [mailto:dlvanbrunt at gmail.com] 
Sent: Sunday, December 25, 2016 1:46 PM
To: Frank; Chris Waggoner
Cc: r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] probability of 50% profit on short options
trade

Frank and Chris-?

Yes, the Dough folks are advocating a?strategy that I'd like to study a bit
more since the things you both mentioned all jump right out. I think Chris
took my "get started" comment to mean get started in trading this (or
trading at all), rather than get started on the evaluation of their claims--
I was not clear. My "finding the best trading opportunities" is so I can
study their strategy from there.?I've been investing and trading profitably
for 20 years (longs, shorts, equities, indices, options, actual real
estate...), but I enjoy reading and studying what others are up to in my
spare time (as FT job responsibilities allow). So when I see extraordinary
claims I like to try replicating and studying them for myself - it's fun,
and I learn a lot in the process. So many gurus cherry pick from history
(Frank caught that right off), since the?most popular thing to sell for a
profit is "advice". :-)

To dissect Dough's broader claims, I'd have to reproduce what they've done
with their "probability of 50% profit" but they're not really giving enough
information to replicate it that I've been able to find.?

Hence the post.

It sounds like thus far the short answer from this R forum is simply "we
don't know how to reproduce that." ?


On Fri, Dec 23, 2016 at 11:34 AM, Frank <frankm60606 at gmail.com> wrote:
1) Why not ask the Dough Boys to do your heavy lifting? They developed this
strategy using 10 years of historical data. Ask them to run it over these 10
years for the Mar/Jun/Sep/Dec major SPY expirations for options with about
45 days until expiration.

2) Ask the Dough Boys why they only used a theoretical Monte Carlo
simulation for 2005 to generate their results. I'm retired, but I think it
is 2016.

3) What about the L in P/L? I see nothing about the losses that might have
occurred. How about the losses for the Sep 2001 strangles and straddles? And
likewise for the Sep 2008 strangles and straddles.

I don't know of any successful option traders that only sell options short.
But 91% probability of making a profit in all these straddles and strangles
at 50% of profit and 81% if held until expiration. I'm incredulous.

All the successful option traders I know trade spreads in which at least one
leg is long and has a reasonable delta or gamma relative to the short
option(s). They put time into models and analysis that identify option
spreads that have one leg that is cheap or correctly priced and the short
leg that is expensive.

What are three things that are short-lived?

1) Dogs that chase cars.
2) Basketball teams that can't free-throw.
3) Traders that sell naked options.

Best,

Frank
Chicago, IL

-----Original Message-----
From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
Of David L. Van Brunt, Ph.D.
Sent: Thursday, December 22, 2016 9:57 PM
To: r-sig-finance at r-project.org
Subject: [R-SIG-Finance] probability of 50% profit on short options trade

Hello; I've been following the "dough" trading platform for a bit and they
are big on short options strategies such as strangles, straddles,
verticals, etc.? One nice thing their platform does is compute the
probability of reaching 50% of target (max) profit, and they recommend
taking profits at that point in time.

I was wondering if there is a way to do this in R... I know there is (monte
carlo, for example) but if there is a package or tool that has done some of
the heavy lifting already, it would save me re-inventing the wheel. The
motivation, of course, is that I'd like to pass many tickers into a script
that helps me find the best trading opportunities.? Their thinking is
described here: https://www.dough.com/blog/probability-of-50-profit-on-dough

Can anyone point me in the right direction to get started?

---------------------------------------
David L. Van Brunt, Ph.D.
mailto:dlvanbrunt at gmail.com
? ? ? ? [[alternative HTML version deleted]]

_______________________________________________
R-SIG-Finance at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-sig-finance
-- Subscriber-posting only. If you want to post, subscribe first.
-- Also note that this is not the r-help list where general R questions
should go.


From dlvanbrunt at gmail.com  Sun Dec 25 22:52:32 2016
From: dlvanbrunt at gmail.com (David L. Van Brunt, Ph.D.)
Date: Sun, 25 Dec 2016 15:52:32 -0600
Subject: [R-SIG-Finance] probability of 50% profit on short options trade
In-Reply-To: <536D86FFFB58439A9601FA90305E8A31@Franki7PC>
References: <CAKHx4Y4kMq3P7m=Xm=r+7JG4SvB__rjdFcpbF27OqGbPyH=ciQ@mail.gmail.com>
	<DBF708CEE9804182A03C2B1B61486C92@Franki7PC>
	<CAKHx4Y6Ojy3qkWqwegbgYKiRPCX8_isoRfppr0Lnu7gHREYQCA@mail.gmail.com>
	<536D86FFFB58439A9601FA90305E8A31@Franki7PC>
Message-ID: <CAKHx4Y7eavZ8tqB_cyCKycjnSLK-RQhAtLBS0CL_s5SddX29Vw@mail.gmail.com>

>From watching their videocasts, they call a 1 sigma straddle the first
strikes outside the 68% window (so it's two-tailed) -- though it could be
taken to mean, post premium credits, that the breakevens are outside that
window. It's all done visually enough in TOS, but of course,
Dough/TastyTrade's p50 (as they call it) is not anywhere in ToS. I saw them
do a show where they described it as an equation to get past having to do
monte carlo every time, but then the tech guys were there and described it
exactly as a monte Carlo simulation (10,000 runs even, IIRC).

They are also using the Probability ITM from Black-Scholes rather than
taking the Delta as an approximation.

The other barriers in studying this are simply data: getting current option
data isn't too tough, but historical options I'm sure is messy and
expensive (and huge). And then here's historical Implied Volatility (not to
be confused with historical volatility).

It may just be too much of a PITA to even try to pick it apart.



---------------------------------------
David L. Van Brunt, Ph.D.
mailto:dlvanbrunt at gmail.com

On Sun, Dec 25, 2016 at 2:44 PM, Frank <frankm60606 at gmail.com> wrote:

> David,
>
> I downloaded the SPY options for November 2016. There are 102160 rows of
> data. Looking only at the 1/20/2017 expiration options, there are 398
> out-of-the-money calls with both volume and open interest and 802
> out-of-the-money puts. Figuring out which strangles and straddles would
> meet
> their 1 sigma strategy definition would be a daunting task. This is not
> really a problem with R but a problem of what is the definition of a 1
> sigma
> strategy or straddle. There is also the possibility of data mining the best
> strategies.
>
> Once the strategies that meet the 1 sigma definitions are identified, it is
> a piece of cake to identify how many strategies make it to 50% profit and
> how many are profitable at expiration. I'd do the calculations in C and
> also
> keep track of the maximum loss.
>
> In just writing this email, I've figure out another problem. I could
> identity strangles that are about 1 sigma away from the current SPY price,
> but, what do they mean by a 1 sigma straddle?
>
> Best,
>
> Frank
> Chicago, IL
>
>
>
> ________________________________________
> From: David L. Van Brunt, Ph.D. [mailto:dlvanbrunt at gmail.com]
> Sent: Sunday, December 25, 2016 1:46 PM
> To: Frank; Chris Waggoner
> Cc: r-sig-finance at r-project.org
> Subject: Re: [R-SIG-Finance] probability of 50% profit on short options
> trade
>
> Frank and Chris-
>
> Yes, the Dough folks are advocating a strategy that I'd like to study a bit
> more since the things you both mentioned all jump right out. I think Chris
> took my "get started" comment to mean get started in trading this (or
> trading at all), rather than get started on the evaluation of their
> claims--
> I was not clear. My "finding the best trading opportunities" is so I can
> study their strategy from there. I've been investing and trading profitably
> for 20 years (longs, shorts, equities, indices, options, actual real
> estate...), but I enjoy reading and studying what others are up to in my
> spare time (as FT job responsibilities allow). So when I see extraordinary
> claims I like to try replicating and studying them for myself - it's fun,
> and I learn a lot in the process. So many gurus cherry pick from history
> (Frank caught that right off), since the most popular thing to sell for a
> profit is "advice". :-)
>
> To dissect Dough's broader claims, I'd have to reproduce what they've done
> with their "probability of 50% profit" but they're not really giving enough
> information to replicate it that I've been able to find.
>
> Hence the post.
>
> It sounds like thus far the short answer from this R forum is simply "we
> don't know how to reproduce that."
>
>
> On Fri, Dec 23, 2016 at 11:34 AM, Frank <frankm60606 at gmail.com> wrote:
> 1) Why not ask the Dough Boys to do your heavy lifting? They developed this
> strategy using 10 years of historical data. Ask them to run it over these
> 10
> years for the Mar/Jun/Sep/Dec major SPY expirations for options with about
> 45 days until expiration.
>
> 2) Ask the Dough Boys why they only used a theoretical Monte Carlo
> simulation for 2005 to generate their results. I'm retired, but I think it
> is 2016.
>
> 3) What about the L in P/L? I see nothing about the losses that might have
> occurred. How about the losses for the Sep 2001 strangles and straddles?
> And
> likewise for the Sep 2008 strangles and straddles.
>
> I don't know of any successful option traders that only sell options short.
> But 91% probability of making a profit in all these straddles and strangles
> at 50% of profit and 81% if held until expiration. I'm incredulous.
>
> All the successful option traders I know trade spreads in which at least
> one
> leg is long and has a reasonable delta or gamma relative to the short
> option(s). They put time into models and analysis that identify option
> spreads that have one leg that is cheap or correctly priced and the short
> leg that is expensive.
>
> What are three things that are short-lived?
>
> 1) Dogs that chase cars.
> 2) Basketball teams that can't free-throw.
> 3) Traders that sell naked options.
>
> Best,
>
> Frank
> Chicago, IL
>
> -----Original Message-----
> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
> Of David L. Van Brunt, Ph.D.
> Sent: Thursday, December 22, 2016 9:57 PM
> To: r-sig-finance at r-project.org
> Subject: [R-SIG-Finance] probability of 50% profit on short options trade
>
> Hello; I've been following the "dough" trading platform for a bit and they
> are big on short options strategies such as strangles, straddles,
> verticals, etc.  One nice thing their platform does is compute the
> probability of reaching 50% of target (max) profit, and they recommend
> taking profits at that point in time.
>
> I was wondering if there is a way to do this in R... I know there is (monte
> carlo, for example) but if there is a package or tool that has done some of
> the heavy lifting already, it would save me re-inventing the wheel. The
> motivation, of course, is that I'd like to pass many tickers into a script
> that helps me find the best trading opportunities.  Their thinking is
> described here: https://www.dough.com/blog/probability-of-50-profit-on-
> dough
>
> Can anyone point me in the right direction to get started?
>
> ---------------------------------------
> David L. Van Brunt, Ph.D.
> mailto:dlvanbrunt at gmail.com
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions
> should go.
>
>
>

	[[alternative HTML version deleted]]


From m.ashton at enduringinvestments.com  Sun Dec 25 23:01:03 2016
From: m.ashton at enduringinvestments.com (Michael Ashton)
Date: Sun, 25 Dec 2016 22:01:03 +0000
Subject: [R-SIG-Finance] probability of 50% profit on short options trade
In-Reply-To: <CAKHx4Y7eavZ8tqB_cyCKycjnSLK-RQhAtLBS0CL_s5SddX29Vw@mail.gmail.com>
References: <CAKHx4Y4kMq3P7m=Xm=r+7JG4SvB__rjdFcpbF27OqGbPyH=ciQ@mail.gmail.com>
	<DBF708CEE9804182A03C2B1B61486C92@Franki7PC>
	<CAKHx4Y6Ojy3qkWqwegbgYKiRPCX8_isoRfppr0Lnu7gHREYQCA@mail.gmail.com>
	<536D86FFFB58439A9601FA90305E8A31@Franki7PC>,
	<CAKHx4Y7eavZ8tqB_cyCKycjnSLK-RQhAtLBS0CL_s5SddX29Vw@mail.gmail.com>
Message-ID: <6C9ECB6D-A925-4B6B-8ED7-AF6EF0996DF5@enduringinvestments.com>

I'm already concerned if they call two separate strikes a straddle when it is a strangle. Also be careful of stale data, since the closing price of an option used to be (not any more, though) the last traded price which may or may not correspond to the last traded price of the underlying. Not a problem for futures options and  indices probably but single-stock options used to be rife with this problem. Not sure if they are any more; it has been a long time since I was an options trader and I was primarily fixed-income derivs. 

On Dec 25, 2016, at 4:53 PM, David L. Van Brunt, Ph.D. <dlvanbrunt at gmail.com> wrote:

>> From watching their videocasts, they call a 1 sigma straddle the first
> strikes outside the 68% window (so it's two-tailed) -- though it could be
> taken to mean, post premium credits, that the breakevens are outside that
> window. It's all done visually enough in TOS, but of course,
> Dough/TastyTrade's p50 (as they call it) is not anywhere in ToS. I saw them
> do a show where they described it as an equation to get past having to do
> monte carlo every time, but then the tech guys were there and described it
> exactly as a monte Carlo simulation (10,000 runs even, IIRC).
> 
> They are also using the Probability ITM from Black-Scholes rather than
> taking the Delta as an approximation.
> 
> The other barriers in studying this are simply data: getting current option
> data isn't too tough, but historical options I'm sure is messy and
> expensive (and huge). And then here's historical Implied Volatility (not to
> be confused with historical volatility).
> 
> It may just be too much of a PITA to even try to pick it apart.
> 
> 
> 
> ---------------------------------------
> David L. Van Brunt, Ph.D.
> mailto:dlvanbrunt at gmail.com
> 
>> On Sun, Dec 25, 2016 at 2:44 PM, Frank <frankm60606 at gmail.com> wrote:
>> 
>> David,
>> 
>> I downloaded the SPY options for November 2016. There are 102160 rows of
>> data. Looking only at the 1/20/2017 expiration options, there are 398
>> out-of-the-money calls with both volume and open interest and 802
>> out-of-the-money puts. Figuring out which strangles and straddles would
>> meet
>> their 1 sigma strategy definition would be a daunting task. This is not
>> really a problem with R but a problem of what is the definition of a 1
>> sigma
>> strategy or straddle. There is also the possibility of data mining the best
>> strategies.
>> 
>> Once the strategies that meet the 1 sigma definitions are identified, it is
>> a piece of cake to identify how many strategies make it to 50% profit and
>> how many are profitable at expiration. I'd do the calculations in C and
>> also
>> keep track of the maximum loss.
>> 
>> In just writing this email, I've figure out another problem. I could
>> identity strangles that are about 1 sigma away from the current SPY price,
>> but, what do they mean by a 1 sigma straddle?
>> 
>> Best,
>> 
>> Frank
>> Chicago, IL
>> 
>> 
>> 
>> ________________________________________
>> From: David L. Van Brunt, Ph.D. [mailto:dlvanbrunt at gmail.com]
>> Sent: Sunday, December 25, 2016 1:46 PM
>> To: Frank; Chris Waggoner
>> Cc: r-sig-finance at r-project.org
>> Subject: Re: [R-SIG-Finance] probability of 50% profit on short options
>> trade
>> 
>> Frank and Chris-
>> 
>> Yes, the Dough folks are advocating a strategy that I'd like to study a bit
>> more since the things you both mentioned all jump right out. I think Chris
>> took my "get started" comment to mean get started in trading this (or
>> trading at all), rather than get started on the evaluation of their
>> claims--
>> I was not clear. My "finding the best trading opportunities" is so I can
>> study their strategy from there. I've been investing and trading profitably
>> for 20 years (longs, shorts, equities, indices, options, actual real
>> estate...), but I enjoy reading and studying what others are up to in my
>> spare time (as FT job responsibilities allow). So when I see extraordinary
>> claims I like to try replicating and studying them for myself - it's fun,
>> and I learn a lot in the process. So many gurus cherry pick from history
>> (Frank caught that right off), since the most popular thing to sell for a
>> profit is "advice". :-)
>> 
>> To dissect Dough's broader claims, I'd have to reproduce what they've done
>> with their "probability of 50% profit" but they're not really giving enough
>> information to replicate it that I've been able to find.
>> 
>> Hence the post.
>> 
>> It sounds like thus far the short answer from this R forum is simply "we
>> don't know how to reproduce that."
>> 
>> 
>> On Fri, Dec 23, 2016 at 11:34 AM, Frank <frankm60606 at gmail.com> wrote:
>> 1) Why not ask the Dough Boys to do your heavy lifting? They developed this
>> strategy using 10 years of historical data. Ask them to run it over these
>> 10
>> years for the Mar/Jun/Sep/Dec major SPY expirations for options with about
>> 45 days until expiration.
>> 
>> 2) Ask the Dough Boys why they only used a theoretical Monte Carlo
>> simulation for 2005 to generate their results. I'm retired, but I think it
>> is 2016.
>> 
>> 3) What about the L in P/L? I see nothing about the losses that might have
>> occurred. How about the losses for the Sep 2001 strangles and straddles?
>> And
>> likewise for the Sep 2008 strangles and straddles.
>> 
>> I don't know of any successful option traders that only sell options short.
>> But 91% probability of making a profit in all these straddles and strangles
>> at 50% of profit and 81% if held until expiration. I'm incredulous.
>> 
>> All the successful option traders I know trade spreads in which at least
>> one
>> leg is long and has a reasonable delta or gamma relative to the short
>> option(s). They put time into models and analysis that identify option
>> spreads that have one leg that is cheap or correctly priced and the short
>> leg that is expensive.
>> 
>> What are three things that are short-lived?
>> 
>> 1) Dogs that chase cars.
>> 2) Basketball teams that can't free-throw.
>> 3) Traders that sell naked options.
>> 
>> Best,
>> 
>> Frank
>> Chicago, IL
>> 
>> -----Original Message-----
>> From: R-SIG-Finance [mailto:r-sig-finance-bounces at r-project.org] On Behalf
>> Of David L. Van Brunt, Ph.D.
>> Sent: Thursday, December 22, 2016 9:57 PM
>> To: r-sig-finance at r-project.org
>> Subject: [R-SIG-Finance] probability of 50% profit on short options trade
>> 
>> Hello; I've been following the "dough" trading platform for a bit and they
>> are big on short options strategies such as strangles, straddles,
>> verticals, etc.  One nice thing their platform does is compute the
>> probability of reaching 50% of target (max) profit, and they recommend
>> taking profits at that point in time.
>> 
>> I was wondering if there is a way to do this in R... I know there is (monte
>> carlo, for example) but if there is a package or tool that has done some of
>> the heavy lifting already, it would save me re-inventing the wheel. The
>> motivation, of course, is that I'd like to pass many tickers into a script
>> that helps me find the best trading opportunities.  Their thinking is
>> described here: https://www.dough.com/blog/probability-of-50-profit-on-
>> dough
>> 
>> Can anyone point me in the right direction to get started?
>> 
>> ---------------------------------------
>> David L. Van Brunt, Ph.D.
>> mailto:dlvanbrunt at gmail.com
>>        [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions
>> should go.
>> 
>> 
>> 
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From ajayshah at mayin.org  Mon Dec 26 14:19:09 2016
From: ajayshah at mayin.org (Ajay Shah)
Date: Mon, 26 Dec 2016 18:49:09 +0530
Subject: [R-SIG-Finance] Problem with forecast se in the forecast package
Message-ID: <CA++P4r3-TETDnjCNKVtoZByCnBKirmjA9tzpAu1C1MUFoVMZJw@mail.gmail.com>

I was experimenting with the most impressive forecast package. I tried to
rig up a simplest demo of auto.arima() in action. The forecast sd looks odd
to me. Here's a demo.

## Reproducibility
set.seed(101)

## Simulate a series from AR(1)
x <- arima.sim(list(order = c(1,0,0), ar = 0.8), n = 1000)
sd(x)
  # This is 1.566 which seems right

## Using ar()
m1 <- ar(x)

## Use forecast::auto.arima()
library(forecast)
m2 <- auto.arima(x)

## How did they fare?
m1
m2
  # Both of them got the right model.

f1 <- predict(m1, n.ahead=10)
data.frame(pointest=as.numeric(f1$pred), sd=as.numeric(f1$se))
f2 <- forecast(m2, h=10)
data.frame(pointest=cbind(as.numeric(f2$mean),
sd=(f2$upper[,2]-f2$lower[,2])/2))

Let me show you the two results.

> data.frame(pointest=as.numeric(f1$pred), sd=as.numeric(f1$se))
     pointest        sd
1  -0.3186451 0.9628466
2  -0.2898804 1.2264023
3  -0.2671877 1.3649788
4  -0.2492853 1.4445294
5  -0.2351619 1.4918999
6  -0.2240198 1.5206374
7  -0.2152297 1.5382519
8  -0.2082952 1.5491136
9  -0.2028244 1.5558355
10 -0.1985085 1.5600043

This seems right. The forecast sd is small at first, as we're exploiting
the time series structure. But as we go deep into the future, the AR model
is useless and we're down to the unconditional sd which is ~ 1.566.

> f2 <- forecast(m2, h=10)
> data.frame(pointest=cbind(as.numeric(f2$mean),
sd=(f2$upper[,2]-f2$lower[,2])/2))
   pointest.V1 pointest.sd
1  -0.28090691    1.887602
2  -0.22221139    2.406792
3  -0.17578030    2.681016
4  -0.13905100    2.839174
5  -0.10999628    2.933809
6  -0.08701255    2.991505
7  -0.06883127    3.027050
8  -0.05444897    3.049081
9  -0.04307186    3.062787
10 -0.03407199    3.071333

This seems out of line. Right at n.ahead=1 the forecast sd is 1.8876 which
is > 1.566. And going beyond, the forecast sd goes up to 3.07. What am I
missing?

-- 
Ajay Shah
ajayshah at mayin.org
http://www.mayin.org/ajayshah
http://ajayshahblog.blogspot.com

	[[alternative HTML version deleted]]


From chidley.ryan at gmail.com  Mon Dec 26 23:07:32 2016
From: chidley.ryan at gmail.com (chidley.ryan at gmail.com)
Date: Mon, 26 Dec 2016 14:07:32 -0800
Subject: [R-SIG-Finance] RBLPAPI Subscribe( )
Message-ID: <97DCFA79-F315-4D4A-83D6-7AFE3C043459@gmail.com>

good afternoon,

does anyone have any experience with the above function? i have used it rudimentarily in the past but i presently need to use it in conjunction with global data frames which accumulate values. 

i would appreciate any guidance. thank you for your time.

Sent from my iPhone

From edd at debian.org  Tue Dec 27 05:05:18 2016
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 26 Dec 2016 22:05:18 -0600
Subject: [R-SIG-Finance] RBLPAPI Subscribe( )
In-Reply-To: <97DCFA79-F315-4D4A-83D6-7AFE3C043459@gmail.com>
References: <97DCFA79-F315-4D4A-83D6-7AFE3C043459@gmail.com>
Message-ID: <22625.59518.471282.629934@max.nulle.part>


On 26 December 2016 at 14:07, chidley.ryan at gmail.com wrote:
| does anyone have any experience with the above function? i have used it rudimentarily in the past but i presently need to use it in conjunction with global data frames which accumulate values. 
| 
| i would appreciate any guidance. thank you for your time.

There is nothing actionable here. 

We do respond to bug reports over at https://github.com/Rblp/Rblpapi/issues
where you can search open and closed ones too.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From mwc4120 at hotmail.com  Tue Dec 27 09:07:05 2016
From: mwc4120 at hotmail.com (Michael Chen)
Date: Tue, 27 Dec 2016 08:07:05 +0000
Subject: [R-SIG-Finance] Clarification on trailing stop.
In-Reply-To: <1481819921.15474.75.camel@braverock.com>
References: <107258778.3485382.1481783489740.ref@mail.yahoo.com>
	<107258778.3485382.1481783489740@mail.yahoo.com>,
	<1481819921.15474.75.camel@braverock.com>
Message-ID: <CY4PR14MB1367B0206605FDA62BD7BF1BB1690@CY4PR14MB1367.namprd14.prod.outlook.com>



Hi all,

I am little confused regarding the "prefer" setting in trailing stop orders (may also apply to normal orders).  Setting prefer = "High",  as presented in the Luxor example, means to me that the trailing stop is set at the preset threshold level less than the most recent high.  Default prefer is set for 'Close'.   Prefer= sets the price column to use from data object (mktdata),  but I also read from well-informed bloggers that setting prefer = 'Open' means that after the condition is satisfied, the execution of the order will be at the Open of next bar instead of the Close.  So, is "Prefer=" setting defines the data column to be used in the apply rule calculations or is it used for preference for the point of execution for the order?  or both?

thanks again and I apologize if this has been answered before.  my search didn't reveal anything.

Michael


	[[alternative HTML version deleted]]


From adamno227 at gmail.com  Tue Dec 27 22:50:56 2016
From: adamno227 at gmail.com (Adam Ginensky)
Date: Tue, 27 Dec 2016 15:50:56 -0600
Subject: [R-SIG-Finance] Problem with forecast se in the forecast package
In-Reply-To: <CA++P4r3-TETDnjCNKVtoZByCnBKirmjA9tzpAu1C1MUFoVMZJw@mail.gmail.com>
References: <CA++P4r3-TETDnjCNKVtoZByCnBKirmjA9tzpAu1C1MUFoVMZJw@mail.gmail.com>
Message-ID: <CAEEj48mmp796L22_=RODvNqCibhqN24fqdGjZJ7XFbFAmTEbxQ@mail.gmail.com>

Hi,
I don't know what's going on, but notice the 'bad' sd estimates are
essentially double the 'correct' sd estimates.  There is likely a
connection.

Best,

Adam Ginensky

On Mon, Dec 26, 2016 at 7:19 AM, Ajay Shah <ajayshah at mayin.org> wrote:
> I was experimenting with the most impressive forecast package. I tried to
> rig up a simplest demo of auto.arima() in action. The forecast sd looks odd
> to me. Here's a demo.
>
> ## Reproducibility
> set.seed(101)
>
> ## Simulate a series from AR(1)
> x <- arima.sim(list(order = c(1,0,0), ar = 0.8), n = 1000)
> sd(x)
>   # This is 1.566 which seems right
>
> ## Using ar()
> m1 <- ar(x)
>
> ## Use forecast::auto.arima()
> library(forecast)
> m2 <- auto.arima(x)
>
> ## How did they fare?
> m1
> m2
>   # Both of them got the right model.
>
> f1 <- predict(m1, n.ahead=10)
> data.frame(pointest=as.numeric(f1$pred), sd=as.numeric(f1$se))
> f2 <- forecast(m2, h=10)
> data.frame(pointest=cbind(as.numeric(f2$mean),
> sd=(f2$upper[,2]-f2$lower[,2])/2))
>
> Let me show you the two results.
>
>> data.frame(pointest=as.numeric(f1$pred), sd=as.numeric(f1$se))
>      pointest        sd
> 1  -0.3186451 0.9628466
> 2  -0.2898804 1.2264023
> 3  -0.2671877 1.3649788
> 4  -0.2492853 1.4445294
> 5  -0.2351619 1.4918999
> 6  -0.2240198 1.5206374
> 7  -0.2152297 1.5382519
> 8  -0.2082952 1.5491136
> 9  -0.2028244 1.5558355
> 10 -0.1985085 1.5600043
>
> This seems right. The forecast sd is small at first, as we're exploiting
> the time series structure. But as we go deep into the future, the AR model
> is useless and we're down to the unconditional sd which is ~ 1.566.
>
>> f2 <- forecast(m2, h=10)
>> data.frame(pointest=cbind(as.numeric(f2$mean),
> sd=(f2$upper[,2]-f2$lower[,2])/2))
>    pointest.V1 pointest.sd
> 1  -0.28090691    1.887602
> 2  -0.22221139    2.406792
> 3  -0.17578030    2.681016
> 4  -0.13905100    2.839174
> 5  -0.10999628    2.933809
> 6  -0.08701255    2.991505
> 7  -0.06883127    3.027050
> 8  -0.05444897    3.049081
> 9  -0.04307186    3.062787
> 10 -0.03407199    3.071333
>
> This seems out of line. Right at n.ahead=1 the forecast sd is 1.8876 which
> is > 1.566. And going beyond, the forecast sd goes up to 3.07. What am I
> missing?
>
> --
> Ajay Shah
> ajayshah at mayin.org
> http://www.mayin.org/ajayshah
> http://ajayshahblog.blogspot.com
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


From brian at braverock.com  Tue Dec 27 23:35:17 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 27 Dec 2016 16:35:17 -0600
Subject: [R-SIG-Finance] Clarification on trailing stop.
In-Reply-To: <CY4PR14MB1367B0206605FDA62BD7BF1BB1690@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <107258778.3485382.1481783489740.ref@mail.yahoo.com>
	<107258778.3485382.1481783489740@mail.yahoo.com>
	, <1481819921.15474.75.camel@braverock.com>
	<CY4PR14MB1367B0206605FDA62BD7BF1BB1690@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <1482878117.12534.11.camel@braverock.com>

On Tue, 2016-12-27 at 08:07 +0000, Michael Chen wrote:
> I am little confused regarding the "prefer" setting in trailing stop
> orders (may also apply to normal orders).??Setting prefer =
> "High",??as presented in the Luxor example, means to me that the
> trailing stop is set at the preset threshold level less than the most
> recent high.??Default prefer is set for 'Close'.???Prefer= sets the
> price column to use from data object (mktdata),??but I also read from
> well-informed bloggers that setting prefer = 'Open' means that after
> the condition is satisfied, the execution of the order will be at the
> Open of next bar instead of the Close.??So, is "Prefer=" setting
> defines the data column to be used in the apply rule calculations or
> is it used for preference for the point of execution for the
> order???or both?
> 
> thanks again and I apologize if this has been answered before.??my
> search didn't reveal anything.


The prefer= argument is passed to the getPrice() fn, and will determine
the price column that is used to set your threshold.

stoplimit orders will execute at the limit, so it should be 'High' +/-
threshold (depending on whether you are buying or selling)

Regards,

Brian

--?
Brian G. Peterson?
http://braverock.com/brian/?
Ph: 773-459-4973?
IM: bgpbraverock


From ajayshah at mayin.org  Wed Dec 28 01:59:50 2016
From: ajayshah at mayin.org (Ajay Shah)
Date: Wed, 28 Dec 2016 06:29:50 +0530
Subject: [R-SIG-Finance] Problem with forecast se in the forecast package
In-Reply-To: <CAEEj48mmp796L22_=RODvNqCibhqN24fqdGjZJ7XFbFAmTEbxQ@mail.gmail.com>
References: <CA++P4r3-TETDnjCNKVtoZByCnBKirmjA9tzpAu1C1MUFoVMZJw@mail.gmail.com>
	<CAEEj48mmp796L22_=RODvNqCibhqN24fqdGjZJ7XFbFAmTEbxQ@mail.gmail.com>
Message-ID: <CA++P4r2R7NOUz0McGxxO2NP811d4GZgXBwyzELWAcpipg1RS2Q@mail.gmail.com>

On 28 December 2016 at 03:20, Adam Ginensky <adamno227 at gmail.com> wrote:

> Hi,
> I don't know what's going on, but notice the 'bad' sd estimates are
> essentially double the 'correct' sd estimates.  There is likely a
> connection.
>

Ouch! Got it. Thanks,

-- 
Ajay Shah
ajayshah at mayin.org
http://www.mayin.org/ajayshah
http://ajayshahblog.blogspot.com

	[[alternative HTML version deleted]]


From mwc4120 at hotmail.com  Wed Dec 28 05:09:38 2016
From: mwc4120 at hotmail.com (Michael Chen)
Date: Wed, 28 Dec 2016 04:09:38 +0000
Subject: [R-SIG-Finance] Clarification on trailing stop.
In-Reply-To: <1482878117.12534.11.camel@braverock.com>
References: <107258778.3485382.1481783489740.ref@mail.yahoo.com>
	<107258778.3485382.1481783489740@mail.yahoo.com>	,
	<1481819921.15474.75.camel@braverock.com>
	<CY4PR14MB1367B0206605FDA62BD7BF1BB1690@CY4PR14MB1367.namprd14.prod.outlook.com>,
	<1482878117.12534.11.camel@braverock.com>
Message-ID: <CY4PR14MB1367DBC08EBE6060F2578F21B1680@CY4PR14MB1367.namprd14.prod.outlook.com>

Thanks Brian, as always.    Just to make sure, for all order types, "prefer=",  sets the column data for calculation and therefore for excution.   So, stoplimit/trailing stop orders are excute at that limit ('prefer=high' +/- threshold), but market orders are executed at the next bar (if my indicator uses Cl for normal entry), then useing "prefer=open" will get the transaction price at open of the next bar.

________________________________
From: Brian G. Peterson <brian at braverock.com>
Sent: Tuesday, December 27, 2016 2:35 PM
To: Michael Chen; r-sig-finance at r-project.org
Subject: Re: [R-SIG-Finance] Clarification on trailing stop.

On Tue, 2016-12-27 at 08:07 +0000, Michael Chen wrote:
> I am little confused regarding the "prefer" setting in trailing stop
> orders (may also apply to normal orders).  Setting prefer =
> "High",  as presented in the Luxor example, means to me that the
> trailing stop is set at the preset threshold level less than the most
> recent high.  Default prefer is set for 'Close'.   Prefer= sets the
> price column to use from data object (mktdata),  but I also read from
> well-informed bloggers that setting prefer = 'Open' means that after
> the condition is satisfied, the execution of the order will be at the
> Open of next bar instead of the Close.  So, is "Prefer=" setting
> defines the data column to be used in the apply rule calculations or
> is it used for preference for the point of execution for the
> order?  or both?
>
> thanks again and I apologize if this has been answered before.  my
> search didn't reveal anything.


The prefer= argument is passed to the getPrice() fn, and will determine
the price column that is used to set your threshold.

stoplimit orders will execute at the limit, so it should be 'High' +/-
threshold (depending on whether you are buying or selling)

Regards,

Brian

--
Brian G. Peterson
http://braverock.com/brian/
Brian G. Peterson<http://braverock.com/brian/>
braverock.com
BRIAN G. PETERSON 773-459-4973. brian at braverock.com. download resume as PDF SUMMARY. Senior quantitative trader, financial analyst, technical architect, and project ...


Ph: 773-459-4973
IM: bgpbraverock

	[[alternative HTML version deleted]]


From brian at braverock.com  Wed Dec 28 11:11:24 2016
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 28 Dec 2016 04:11:24 -0600
Subject: [R-SIG-Finance] Clarification on trailing stop.
In-Reply-To: <CY4PR14MB1367DBC08EBE6060F2578F21B1680@CY4PR14MB1367.namprd14.prod.outlook.com>
References: <107258778.3485382.1481783489740.ref@mail.yahoo.com>
	<107258778.3485382.1481783489740@mail.yahoo.com>
	<1481819921.15474.75.camel@braverock.com>
	<CY4PR14MB1367B0206605FDA62BD7BF1BB1690@CY4PR14MB1367.namprd14.prod.outlook.com>
	<1482878117.12534.11.camel@braverock.com>
	<CY4PR14MB1367DBC08EBE6060F2578F21B1680@CY4PR14MB1367.namprd14.prod.outlook.com>
Message-ID: <979cd47f-176e-38df-70e5-d177d9605347@braverock.com>

On 12/27/2016 10:09 PM, Michael Chen wrote:
> Thanks Brian, as always.    Just to make sure, for all order types,
> "prefer=",  sets the column data for calculation and therefore for
> excution.   So, stoplimit/trailing stop orders are excute at that
> limit ('prefer=high' ? threshold), but market orders are executed at
> the next bar (if my indicator uses Cl for normal entry), then useing
> "prefer=open" will get the transaction price at open of the next
> bar.

It would be prefer="open", but yes.

Also be aware that this is a bit sloppy.  Real markets don't trade in bars.

Most investors don't really have access to the opening or closing 
auctions if building backtests on daily data.  As noted in the 
documentation and I have noted elsewhere, intraday historical data is 
readily available, so in most cases you would likely be better served 
using intraday data and something like a VWAP price if you have the data 
available.

in any case, the prefer= argument is a pass-through to getPrice. 
quantstrat will make reasonable guesses based on your data if it is not 
set.  see

?getPrice

for more information on how getPrice works to extract price data.

Regards,

Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From tonytonov at gmail.com  Thu Dec 29 11:16:00 2016
From: tonytonov at gmail.com (Anton Antonov)
Date: Thu, 29 Dec 2016 13:16:00 +0300
Subject: [R-SIG-Finance] Proposal for PerformanceAnalytics::Omega,
	method = "interp"
Message-ID: <d6fb500c-52cd-81b3-a88e-2eb079e759f1@gmail.com>

Hi list,

I've been working on various risk measures recently, Omega being one of 
them. In PerformanceAnalytics I saw two implemented methods ("simple" 
and "interp"), so I studied both. A quick analysis shows that "interp" 
does not work as intended (R 3.3.2, PerformanceAnalytics_1.4.3541):

set.seed(42)
x <- rnorm(1000) / 5
Omega(x)
#[1] 0.9370033
Omega(x, method = "interp")
#[1] 2.877499

It is quite simple to see that under normality assumption Omega at L = 0 
converges to 1, so the "interp" estimate is looking strange. Here's the 
relevant piece of code (truncated for clarity):

xcdf = Hmisc::Ecdf.default(x, pl=FALSE)
f <- approxfun(xcdf$x,xcdf$y,method="linear",ties="ordered")
omegafull = cumsum(1-f(xcdf$x))/cumsum(f(xcdf$x)) # ????????
g <- approxfun(xcdf$x,omegafull,method="linear",ties="ordered")
omega = g(L)

Here the ratio of cumulative sums is not a correct approximation for the 
ratio of two integrals from the Omega definition (which is probably 
pointed out by the comment with question marks). I originally wanted to 
propose the replacement with left rectangle rule for approximation:

xcdf <- Hmisc::Ecdf.default(x, pl=FALSE)
xs <- xcdf$x[-1]
ys <- xcdf$y[-1]
den <- c(0, cumsum(ys[-length(ys)] * diff(xs)))
num <- rev(c(0, cumsum((1 - rev(ys[-length(ys)])) * (rev(diff(xs))))))
g1 <- approxfun(xs, num, method="linear", ties="ordered")
g2 <- approxfun(xs, den, method="linear", ties="ordered")
if (output == "point") {
   omega = g1(L)/g2(L)
} else {
   omega = matrix(num/den)
   names(omega) = xs
}

but it is seemingly exactly the same as "simple" (given the ecdf is 
stepwise). So maybe there's no need for such approximation altogether? 
Anyway, the proposed patch allows to fix the call Omega(x, method = 
"interp", output = "full"), which returns the whole distribution of Omega.
Relevant previous threads:
https://stat.ethz.ch/pipermail/r-sig-finance/2011q3/008524.html
https://stat.ethz.ch/pipermail/r-sig-finance/2008q3/002969.html

Best regards,
Anton



From m@e@qu|ve| @end|ng |rom bncr@||@cr  Fri Jan 24 18:10:28 2025
From: m@e@qu|ve| @end|ng |rom bncr@||@cr (Manfred Alonso Esquivel Monge)
Date: Fri, 24 Jan 2025 17:10:28 +0000
Subject: [R-SIG-Finance] rugarch package vs Eviews cannot get similar
 results from a model with GARCH errors.
Message-ID: <CO6PR14MB43872B6E9FD6936D513FE0C2F1E32@CO6PR14MB4387.namprd14.prod.outlook.com>

I'm trying to replicate in R some results that I get from an Eviews estimation of a model with GARCH errors. For this, I'm using the  "rugarch" package. The problem is that estimated parameters differ by a lot. This is the set up I'm using in R (the data are in an xts object names "datos"):

spec <- ugarchspec(
  variance.model = list(model = "sGARCH", garchOrder = c(2, 1)),
  mean.model = list(armaOrder = c(2, 0), include.mean = TRUE, external.regressors = as.matrix(datos[, c("jueves", "viernes", "sem2", "sem2_ene", "sem3_nov", "sem4_nov")]))
)
fit_garch <- ugarchfit(spec = spec, data = datos$d_TC, solver = "gosolnp")



This es the set up I'm using in Eviews:

equation fit_garch.arch(2,1) d_TC c ar(1) ar(2) jueves viernes sem2 sem2_ene sem3_nov sem4_nov


As you can see, they are supposed to be the same model, an ARMA(2,0) with constant term plus some "external regressors" in the mean equation, and a GARCH(2,1) models for the variance. But coefficient estimates differ by no small amount.
I verified that data are the same (run OLS and got identical results between the softwares).  As a side note, R results does not converge easily, I tried some of the solvers and only "gosolnp" and  "hybrid" converge.
This is my first time using "rugarch", so chances are big that there is something wrong in my R set up.

Any help will be greatly appreciated.

Regards.
Manfred E.

________________________________

AVISO DE CONFIDENCIALIDAD: La informaci?n contenida en este mensaje es estrictamente confidencial, y est? destinada para uso exclusivo de su destinatario. El BANCO NACIONAL y sus subsidiarias no se hacen responsables por su copia, divulgaci?n o distribuci?n a terceros, y se reserva el derecho de interponer las acciones administrativas y/o judiciales que correspondan por los da?os y perjuicios que su difusi?n no autorizada ocasione.

	[[alternative HTML version deleted]]


From m@theu@_vb @end|ng |rom hotm@||@com  Fri Jan 24 18:30:12 2025
From: m@theu@_vb @end|ng |rom hotm@||@com (matheus barroso)
Date: Fri, 24 Jan 2025 17:30:12 +0000
Subject: [R-SIG-Finance] rugarch package vs Eviews cannot get similar
 results from a model with GARCH errors.
In-Reply-To: <CO6PR14MB43872B6E9FD6936D513FE0C2F1E32@CO6PR14MB4387.namprd14.prod.outlook.com>
References: <CO6PR14MB43872B6E9FD6936D513FE0C2F1E32@CO6PR14MB4387.namprd14.prod.outlook.com>
Message-ID: <RO2P152MB5139B2836E1F8A6991112896F7E32@RO2P152MB5139.LAMP152.PROD.OUTLOOK.COM>

Different random seeds / generators 
Sent from my iPhone

> On 24 Jan 2025, at 14:10, Manfred Alonso Esquivel Monge via R-SIG-Finance <r-sig-finance at r-project.org> wrote:
> 
> ?I'm trying to replicate in R some results that I get from an Eviews estimation of a model with GARCH errors. For this, I'm using the  "rugarch" package. The problem is that estimated parameters differ by a lot. This is the set up I'm using in R (the data are in an xts object names "datos"):
> 
> spec <- ugarchspec(
>  variance.model = list(model = "sGARCH", garchOrder = c(2, 1)),
>  mean.model = list(armaOrder = c(2, 0), include.mean = TRUE, external.regressors = as.matrix(datos[, c("jueves", "viernes", "sem2", "sem2_ene", "sem3_nov", "sem4_nov")]))
> )
> fit_garch <- ugarchfit(spec = spec, data = datos$d_TC, solver = "gosolnp")
> 
> 
> 
> This es the set up I'm using in Eviews:
> 
> equation fit_garch.arch(2,1) d_TC c ar(1) ar(2) jueves viernes sem2 sem2_ene sem3_nov sem4_nov
> 
> 
> As you can see, they are supposed to be the same model, an ARMA(2,0) with constant term plus some "external regressors" in the mean equation, and a GARCH(2,1) models for the variance. But coefficient estimates differ by no small amount.
> I verified that data are the same (run OLS and got identical results between the softwares).  As a side note, R results does not converge easily, I tried some of the solvers and only "gosolnp" and  "hybrid" converge.
> This is my first time using "rugarch", so chances are big that there is something wrong in my R set up.
> 
> Any help will be greatly appreciated.
> 
> Regards.
> Manfred E.
> 
> ________________________________
> 
> AVISO DE CONFIDENCIALIDAD: La informaci?n contenida en este mensaje es estrictamente confidencial, y est? destinada para uso exclusivo de su destinatario. El BANCO NACIONAL y sus subsidiarias no se hacen responsables por su copia, divulgaci?n o distribuci?n a terceros, y se reserva el derecho de interponer las acciones administrativas y/o judiciales que correspondan por los da?os y perjuicios que su difusi?n no autorizada ocasione.
> 
>    [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.

From @|ex|o@ @end|ng |rom 4d@c@pe@com  Fri Jan 24 19:41:00 2025
From: @|ex|o@ @end|ng |rom 4d@c@pe@com (alexios galanos)
Date: Fri, 24 Jan 2025 10:41:00 -0800
Subject: [R-SIG-Finance] rugarch package vs Eviews cannot get similar
 results from a model with GARCH errors.
In-Reply-To: <RO2P152MB5139B2836E1F8A6991112896F7E32@RO2P152MB5139.LAMP152.PROD.OUTLOOK.COM>
References: <CO6PR14MB43872B6E9FD6936D513FE0C2F1E32@CO6PR14MB4387.namprd14.prod.outlook.com>
 <RO2P152MB5139B2836E1F8A6991112896F7E32@RO2P152MB5139.LAMP152.PROD.OUTLOOK.COM>
Message-ID: <E592F95D-E1A9-4437-948E-0C5D4580F82A@4dscape.com>

Among other things, Eviews uses backcasting with decay parameter 0.7 for the variance initialization as default (if I remember correctly), whereas
rugarch uses the unconditional variance (i.e. no exponential decay, but there is an option to do so). Then there are differences in the optimizer, bounds etc, which will be likely magnified the smaller your dataset is.

I also suggest you switch to tsgarch instead. Though it does not have a joint ARMA module included (you just pass the residuals from the ARMA module), it has higher accuracy (see the official benchmark https://cran.r-project.org/web/packages/tsgarch/vignettes/benchmark.html), and is in active enhancement/maintenance mode.

Alexios


> On Jan 24, 2025, at 9:30?AM, matheus barroso <matheus_vb at hotmail.com> wrote:
> 
> Different random seeds / generators 
> Sent from my iPhone
> 
>> On 24 Jan 2025, at 14:10, Manfred Alonso Esquivel Monge via R-SIG-Finance <r-sig-finance at r-project.org> wrote:
>> 
>> ?I'm trying to replicate in R some results that I get from an Eviews estimation of a model with GARCH errors. For this, I'm using the  "rugarch" package. The problem is that estimated parameters differ by a lot. This is the set up I'm using in R (the data are in an xts object names "datos"):
>> 
>> spec <- ugarchspec(
>> variance.model = list(model = "sGARCH", garchOrder = c(2, 1)),
>> mean.model = list(armaOrder = c(2, 0), include.mean = TRUE, external.regressors = as.matrix(datos[, c("jueves", "viernes", "sem2", "sem2_ene", "sem3_nov", "sem4_nov")]))
>> )
>> fit_garch <- ugarchfit(spec = spec, data = datos$d_TC, solver = "gosolnp")
>> 
>> 
>> 
>> This es the set up I'm using in Eviews:
>> 
>> equation fit_garch.arch(2,1) d_TC c ar(1) ar(2) jueves viernes sem2 sem2_ene sem3_nov sem4_nov
>> 
>> 
>> As you can see, they are supposed to be the same model, an ARMA(2,0) with constant term plus some "external regressors" in the mean equation, and a GARCH(2,1) models for the variance. But coefficient estimates differ by no small amount.
>> I verified that data are the same (run OLS and got identical results between the softwares).  As a side note, R results does not converge easily, I tried some of the solvers and only "gosolnp" and  "hybrid" converge.
>> This is my first time using "rugarch", so chances are big that there is something wrong in my R set up.
>> 
>> Any help will be greatly appreciated.
>> 
>> Regards.
>> Manfred E.
>> 
>> ________________________________
>> 
>> AVISO DE CONFIDENCIALIDAD: La informaci?n contenida en este mensaje es estrictamente confidencial, y est? destinada para uso exclusivo de su destinatario. El BANCO NACIONAL y sus subsidiarias no se hacen responsables por su copia, divulgaci?n o distribuci?n a terceros, y se reserva el derecho de interponer las acciones administrativas y/o judiciales que correspondan por los da?os y perjuicios que su difusi?n no autorizada ocasione.
>> 
>>   [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-SIG-Finance at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
>> -- Subscriber-posting only. If you want to post, subscribe first.
>> -- Also note that this is not the r-help list where general R questions should go.
> _______________________________________________
> R-SIG-Finance at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-sig-finance
> -- Subscriber-posting only. If you want to post, subscribe first.
> -- Also note that this is not the r-help list where general R questions should go.


	[[alternative HTML version deleted]]


From @rn@ud@g@boury @end|ng |rom gm@||@com  Wed Mar  5 08:57:17 2025
From: @rn@ud@g@boury @end|ng |rom gm@||@com (Arnaud Gaboury)
Date: Wed, 05 Mar 2025 08:57:17 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
Message-ID: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>

I work with Binancer [1] and PMwR [2] packages to write a trading
journal.
Here is a sample of my data frame:
portfolio <- data.frame(
  symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC", "ENAUSDT"),
  time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-01-02
10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
)

I want to fetch the 'BTCUSDT' price for a specific time if the symbol
of same row end with these 3 letters : 'BTC'. In my sample, it will be
rows 3 and 4.
Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:

get_btc_price <- function(time) {
  klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
10:34:49', end_time = '2025-01-02 10:34:49')
}

I was thinking of this code to write my new column BTCUSDT_price:

df <- portfolio %>%
  mutate(
    BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"), map_dbl(time,
get_btc_price), NA_real_)
  )}

But the code returns:
Error in `mutate()`:
? In argument: `BTCUSDT_price = ifelse(...)`.
Caused by error in `map_dbl()`:
? In index: 1.
Caused by error in `[.data.table`:
! Item 1 of j is 12 which is outside the column number range [1,ncol=0]

I have tried other workarounds but all give me errors.

Thank you for help


[1]https://cran.r-project.org/web/packages/binancer
[2]https://cran.r-project.org/web/packages/PMwR

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20250305/b2d7a372/attachment.sig>

From e@ @end|ng |rom enr|co@chum@nn@net  Thu Mar  6 07:29:09 2025
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Thu, 06 Mar 2025 07:29:09 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 (Arnaud Gaboury's message of "Wed, 05 Mar 2025 08:57:17 +0100")
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
Message-ID: <87pliu1xl6.fsf@enricoschumann.net>

On Wed, 05 Mar 2025, Arnaud Gaboury writes:

> I work with Binancer [1] and PMwR [2] packages to write a trading
> journal.
> Here is a sample of my data frame:
> portfolio <- data.frame(
>   symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC", "ENAUSDT"),
>   time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-01-02
> 10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
> )
>
> I want to fetch the 'BTCUSDT' price for a specific time if the symbol
> of same row end with these 3 letters : 'BTC'. In my sample, it will be
> rows 3 and 4.
> Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:
>
> get_btc_price <- function(time) {
>   klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
> 10:34:49', end_time = '2025-01-02 10:34:49')
> }
>
> I was thinking of this code to write my new column BTCUSDT_price:
>
> df <- portfolio %>%
>   mutate(
>     BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"), map_dbl(time,
> get_btc_price), NA_real_)
>   )}
>
> But the code returns:
> Error in `mutate()`:
> ? In argument: `BTCUSDT_price = ifelse(...)`.
> Caused by error in `map_dbl()`:
> ? In index: 1.
> Caused by error in `[.data.table`:
> ! Item 1 of j is 12 which is outside the column number range [1,ncol=0]
>
> I have tried other workarounds but all give me errors.
>
> Thank you for help
>
>
> [1]https://cran.r-project.org/web/packages/binancer
> [2]https://cran.r-project.org/web/packages/PMwR
>

You want to compute a new column for your data.frame as
a function of two existing columns.

In base R, if you don't want to use a loop (and there
would be nothing wrong with a loop), you could use
'mapply'; and then cbind the column to your data.frame:

    new.column <- mapply(
        function(symbol, time) {
            if (grepl("BTC$", symbol)) {
                ## your get_price computation, using
                ## 'symbol' and 'time'
                paste("do something with", symbol, time)
                
            } else
                NA
        },
        portfolio$symbol,
        portfolio$time
    )

    ## new.column
    ##                                         BTCUSDT 
    ##                                              NA 
    ##                                         BTCUSDT 
    ##                                              NA 
    ##                                         ETHUBTC 
    ## "do something with ETHUBTC 2025-01-02 10:34:49" 
    ##                                         AAVEBTC 
    ## "do something with AAVEBTC 2025-01-02 11:14:43" 
    ##                                         ENAUSDT 
    ##                                              NA 
    ##


-- 
Enrico Schumann
Lucerne, Switzerland
https://enricoschumann.net


From @rn@ud@g@boury @end|ng |rom gm@||@com  Thu Mar  6 09:09:14 2025
From: @rn@ud@g@boury @end|ng |rom gm@||@com (Arnaud Gaboury)
Date: Thu, 06 Mar 2025 09:09:14 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <87pliu1xl6.fsf@enricoschumann.net>
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
Message-ID: <e0aa67a0fef7f21ce6556a94241d021af1a9c78c.camel@gmail.com>

On Thu, 2025-03-06 at 07:29 +0100, Enrico Schumann wrote:
> On Wed, 05 Mar 2025, Arnaud Gaboury writes:
> 
> > I work with Binancer [1] and PMwR [2] packages to write a trading
> > journal.
> > Here is a sample of my data frame:
> > portfolio <- data.frame(
> > ? symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC",
> > "ENAUSDT"),
> > ? time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-01-
> > 02
> > 10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
> > )
> > 
> > I want to fetch the 'BTCUSDT' price for a specific time if the
> > symbol
> > of same row end with these 3 letters : 'BTC'. In my sample, it will
> > be
> > rows 3 and 4.
> > Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:
> > 
> > get_btc_price <- function(time) {
> > ? klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
> > 10:34:49', end_time = '2025-01-02 10:34:49')
> > }
> > 
> > I was thinking of this code to write my new column BTCUSDT_price:
> > 
> > df <- portfolio %>%
> > ? mutate(
> > ??? BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"),
> > map_dbl(time,
> > get_btc_price), NA_real_)
> > ? )}
> > 
> > But the code returns:
> > Error in `mutate()`:
> > ? In argument: `BTCUSDT_price = ifelse(...)`.
> > Caused by error in `map_dbl()`:
> > ? In index: 1.
> > Caused by error in `[.data.table`:
> > ! Item 1 of j is 12 which is outside the column number range
> > [1,ncol=0]
> > 
> > I have tried other workarounds but all give me errors.
> > 
> > Thank you for help
> > 
> > 
> > [1]https://cran.r-project.org/web/packages/binancer
> > [2]https://cran.r-project.org/web/packages/PMwR
> > 
> 
> You want to compute a new column for your data.frame as
> a function of two existing columns.
> 
> In base R, if you don't want to use a loop (and there
> would be nothing wrong with a loop), you could use
> 'mapply'; and then cbind the column to your data.frame:
> 
> ??? new.column <- mapply(
> ??????? function(symbol, time) {
> ??????????? if (grepl("BTC$", symbol)) {
> ??????????????? ## your get_price computation, using
> ??????????????? ## 'symbol' and 'time'
> ??????????????? paste("do something with", symbol, time)
> ??????????????? 
> ??????????? } else
> ??????????????? NA
> ??????? },
> ??????? portfolio$symbol,
> ??????? portfolio$time
> ??? )
> 
> ??? ## new.column
> ??? ##???????????????????????????????????????? BTCUSDT 
> ??? ##????????????????????????????????????????????? NA 
> ??? ##???????????????????????????????????????? BTCUSDT 
> ??? ##????????????????????????????????????????????? NA 
> ??? ##???????????????????????????????????????? ETHUBTC 
> ??? ## "do something with ETHUBTC 2025-01-02 10:34:49" 
> ??? ##???????????????????????????????????????? AAVEBTC 
> ??? ## "do something with AAVEBTC 2025-01-02 11:14:43" 
> ??? ##???????????????????????????????????????? ENAUSDT 
> ??? ##????????????????????????????????????????????? NA 

Thank you for your answer.
A very warm thanks for your PMwR package. It helps me managing my
portfolio in a professional way. Unfortunately there isn't so much
material to manage, follow, compute ratio etc. 
By any chance, do you have any cool build-in functions to cook monthly
data (PL, valuation etc) as we compute every month always the same data
?

> ??? ##
> 
> 


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20250306/b177c458/attachment.sig>

From @rn@ud@g@boury @end|ng |rom gm@||@com  Thu Mar  6 18:24:33 2025
From: @rn@ud@g@boury @end|ng |rom gm@||@com (Arnaud Gaboury)
Date: Thu, 06 Mar 2025 18:24:33 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <87pliu1xl6.fsf@enricoschumann.net>
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
Message-ID: <2954e4905995f8d9060e4f271406655d1654972a.camel@gmail.com>

	On Thu, 2025-03-06 at 07:29 +0100, Enrico Schumann wrote:
> On Wed, 05 Mar 2025, Arnaud Gaboury writes:
> 
> > I work with Binancer [1] and PMwR [2] packages to write a trading
> > journal.
> > Here is a sample of my data frame:
> > portfolio <- data.frame(
> > ? symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC",
> > "ENAUSDT"),
> > ? time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-01-
> > 02
> > 10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
> > )
> > 
> > I want to fetch the 'BTCUSDT' price for a specific time if the
> > symbol
> > of same row end with these 3 letters : 'BTC'. In my sample, it will
> > be
> > rows 3 and 4.
> > Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:
> > 
> > get_btc_price <- function(time) {
> > ? klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
> > 10:34:49', end_time = '2025-01-02 10:34:49')
> > }
> > 
> > I was thinking of this code to write my new column BTCUSDT_price:
> > 
> > df <- portfolio %>%
> > ? mutate(
> > ??? BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"),
> > map_dbl(time,
> > get_btc_price), NA_real_)
> > ? )}
> > 
> > But the code returns:
> > Error in `mutate()`:
> > ? In argument: `BTCUSDT_price = ifelse(...)`.
> > Caused by error in `map_dbl()`:
> > ? In index: 1.
> > Caused by error in `[.data.table`:
> > ! Item 1 of j is 12 which is outside the column number range
> > [1,ncol=0]
> > 
> > I have tried other workarounds but all give me errors.
> > 
> > Thank you for help
> > 
> > 
> > [1]https://cran.r-project.org/web/packages/binancer
> > [2]https://cran.r-project.org/web/packages/PMwR
> > 
> 
> You want to compute a new column for your data.frame as
> a function of two existing columns.
> 
> In base R, if you don't want to use a loop (and there
> would be nothing wrong with a loop), you could use
> 'mapply'; and then cbind the column to your data.frame:
> 
> ??? new.column <- mapply(
> ??????? function(symbol, time) {
> ??????????? if (grepl("BTC$", symbol)) {
> ??????????????? ## your get_price computation, using
> ??????????????? ## 'symbol' and 'time'
> ??????????????? paste("do something with", symbol, time)
> ??????????????? 
> ??????????? } else
> ??????????????? NA
> ??????? },
> ??????? portfolio$symbol,
> ??????? portfolio$time
> ??? )

I am sorry but I can't see where I shall put my df ? And my function to
get BTC price:
get_btc_price <- function(my_time) {
    # my_time_ms <- as.integer(as.numeric(my_time) * 1000)
    klines <- binance_klines("BTCUSDT", interval = '1h', start_time =
as.Date(my_time), end_time = as.Date(my_time) + 1)
    return(as.numeric(klines$close[[18]]))
}

Thank you for your help
> 
> ??? ## new.column
> ??? ##???????????????????????????????????????? BTCUSDT 
> ??? ##????????????????????????????????????????????? NA 
> ??? ##???????????????????????????????????????? BTCUSDT 
> ??? ##????????????????????????????????????????????? NA 
> ??? ##???????????????????????????????????????? ETHUBTC 
> ??? ## "do something with ETHUBTC 2025-01-02 10:34:49" 
> ??? ##???????????????????????????????????????? AAVEBTC 
> ??? ## "do something with AAVEBTC 2025-01-02 11:14:43" 
> ??? ##???????????????????????????????????????? ENAUSDT 
> ??? ##????????????????????????????????????????????? NA 
> ??? ##
> 
> 


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20250306/f65e0a36/attachment.sig>

From e@ @end|ng |rom enr|co@chum@nn@net  Fri Mar  7 08:55:00 2025
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Fri, 07 Mar 2025 08:55:00 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <2954e4905995f8d9060e4f271406655d1654972a.camel@gmail.com>
 (Arnaud Gaboury's message of "Thu, 06 Mar 2025 18:24:33 +0100")
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
 <2954e4905995f8d9060e4f271406655d1654972a.camel@gmail.com>
Message-ID: <8734fp1dij.fsf@enricoschumann.net>

On Thu, 06 Mar 2025, Arnaud Gaboury writes:

> 	On Thu, 2025-03-06 at 07:29 +0100, Enrico Schumann wrote:
>> On Wed, 05 Mar 2025, Arnaud Gaboury writes:
>> 
>> > I work with Binancer [1] and PMwR [2] packages to write a trading
>> > journal.
>> > Here is a sample of my data frame:
>> > portfolio <- data.frame(
>> > ? symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC",
>> > "ENAUSDT"),
>> > ? time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-01-
>> > 02
>> > 10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
>> > )
>> > 
>> > I want to fetch the 'BTCUSDT' price for a specific time if the
>> > symbol
>> > of same row end with these 3 letters : 'BTC'. In my sample, it will
>> > be
>> > rows 3 and 4.
>> > Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:
>> > 
>> > get_btc_price <- function(time) {
>> > ? klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
>> > 10:34:49', end_time = '2025-01-02 10:34:49')
>> > }
>> > 
>> > I was thinking of this code to write my new column BTCUSDT_price:
>> > 
>> > df <- portfolio %>%
>> > ? mutate(
>> > ??? BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"),
>> > map_dbl(time,
>> > get_btc_price), NA_real_)
>> > ? )}
>> > 
>> > But the code returns:
>> > Error in `mutate()`:
>> > ? In argument: `BTCUSDT_price = ifelse(...)`.
>> > Caused by error in `map_dbl()`:
>> > ? In index: 1.
>> > Caused by error in `[.data.table`:
>> > ! Item 1 of j is 12 which is outside the column number range
>> > [1,ncol=0]
>> > 
>> > I have tried other workarounds but all give me errors.
>> > 
>> > Thank you for help
>> > 
>> > 
>> > [1]https://cran.r-project.org/web/packages/binancer
>> > [2]https://cran.r-project.org/web/packages/PMwR
>> > 
>> 
>> You want to compute a new column for your data.frame as
>> a function of two existing columns.
>> 
>> In base R, if you don't want to use a loop (and there
>> would be nothing wrong with a loop), you could use
>> 'mapply'; and then cbind the column to your data.frame:
>> 
>> ??? new.column <- mapply(
>> ??????? function(symbol, time) {
>> ??????????? if (grepl("BTC$", symbol)) {
>> ??????????????? ## your get_price computation, using
>> ??????????????? ## 'symbol' and 'time'
>> ??????????????? paste("do something with", symbol, time)
>> ??????????????? 
>> ??????????? } else
>> ??????????????? NA
>> ??????? },
>> ??????? portfolio$symbol,
>> ??????? portfolio$time
>> ??? )
>
> I am sorry but I can't see where I shall put my df ? And my function to
> get BTC price:
> get_btc_price <- function(my_time) {
>     # my_time_ms <- as.integer(as.numeric(my_time) * 1000)
>     klines <- binance_klines("BTCUSDT", interval = '1h', start_time =
> as.Date(my_time), end_time = as.Date(my_time) + 1)
>     return(as.numeric(klines$close[[18]]))
> }
>
> Thank you for your help

Is the ticker you want to fetch data for always the
same?  If yes, then something like this could be
used. [I don't know/use binance, so with a 'dummy' of
your function.]

    get_btc_price <- function(my_time) {
        paste(42, my_time)
    }
    
    new.column <- mapply(
        function(symbol, mytime) {
            if (grepl("BTC$", symbol)) {
                get_btc_price(mytime)
            } else
                NA
        },
        portfolio$symbol,
        portfolio$time
    )

    ##                 BTCUSDT                  BTCUSDT 
    ##                      NA                       NA 
    ##                 ETHUBTC                  AAVEBTC 
    ##"42 2025-01-02 10:34:49" "42 2025-01-02 11:14:43" 
    ##                 ENAUSDT 
    ##                      NA 


-- 
Enrico Schumann
Lucerne, Switzerland
https://enricoschumann.net


From e@ @end|ng |rom enr|co@chum@nn@net  Fri Mar  7 11:31:57 2025
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Fri, 07 Mar 2025 11:31:57 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <e0aa67a0fef7f21ce6556a94241d021af1a9c78c.camel@gmail.com>
 (Arnaud Gaboury's message of "Thu, 06 Mar 2025 09:09:14 +0100")
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
 <e0aa67a0fef7f21ce6556a94241d021af1a9c78c.camel@gmail.com>
Message-ID: <87wmd1nnc2.fsf@enricoschumann.net>

On Thu, 06 Mar 2025, Arnaud Gaboury writes:

> On Thu, 2025-03-06 at 07:29 +0100, Enrico Schumann wrote:
>> On Wed, 05 Mar 2025, Arnaud Gaboury writes:
>> 
>> > I work with Binancer [1] and PMwR [2] packages to write a trading
>> > journal.
>> > Here is a sample of my data frame:
>> > portfolio <- data.frame(
>> > ? symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC",
>> > "ENAUSDT"),
>> > ? time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-01-
>> > 02
>> > 10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
>> > )
>> > 
>> > I want to fetch the 'BTCUSDT' price for a specific time if the
>> > symbol
>> > of same row end with these 3 letters : 'BTC'. In my sample, it will
>> > be
>> > rows 3 and 4.
>> > Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:
>> > 
>> > get_btc_price <- function(time) {
>> > ? klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
>> > 10:34:49', end_time = '2025-01-02 10:34:49')
>> > }
>> > 
>> > I was thinking of this code to write my new column BTCUSDT_price:
>> > 
>> > df <- portfolio %>%
>> > ? mutate(
>> > ??? BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"),
>> > map_dbl(time,
>> > get_btc_price), NA_real_)
>> > ? )}
>> > 
>> > But the code returns:
>> > Error in `mutate()`:
>> > ? In argument: `BTCUSDT_price = ifelse(...)`.
>> > Caused by error in `map_dbl()`:
>> > ? In index: 1.
>> > Caused by error in `[.data.table`:
>> > ! Item 1 of j is 12 which is outside the column number range
>> > [1,ncol=0]
>> > 
>> > I have tried other workarounds but all give me errors.
>> > 
>> > Thank you for help
>> > 
>> > 
>> > [1]https://cran.r-project.org/web/packages/binancer
>> > [2]https://cran.r-project.org/web/packages/PMwR
>> > 
>> 
>> You want to compute a new column for your data.frame as
>> a function of two existing columns.
>> 
>> In base R, if you don't want to use a loop (and there
>> would be nothing wrong with a loop), you could use
>> 'mapply'; and then cbind the column to your data.frame:
>> 
>> ??? new.column <- mapply(
>> ??????? function(symbol, time) {
>> ??????????? if (grepl("BTC$", symbol)) {
>> ??????????????? ## your get_price computation, using
>> ??????????????? ## 'symbol' and 'time'
>> ??????????????? paste("do something with", symbol, time)
>> ??????????????? 
>> ??????????? } else
>> ??????????????? NA
>> ??????? },
>> ??????? portfolio$symbol,
>> ??????? portfolio$time
>> ??? )
>> 
>> ??? ## new.column
>> ??? ##???????????????????????????????????????? BTCUSDT 
>> ??? ##????????????????????????????????????????????? NA 
>> ??? ##???????????????????????????????????????? BTCUSDT 
>> ??? ##????????????????????????????????????????????? NA 
>> ??? ##???????????????????????????????????????? ETHUBTC 
>> ??? ## "do something with ETHUBTC 2025-01-02 10:34:49" 
>> ??? ##???????????????????????????????????????? AAVEBTC 
>> ??? ## "do something with AAVEBTC 2025-01-02 11:14:43" 
>> ??? ##???????????????????????????????????????? ENAUSDT 
>> ??? ##????????????????????????????????????????????? NA 
>
> Thank you for your answer.
> A very warm thanks for your PMwR package. It helps me managing my
> portfolio in a professional way. Unfortunately there isn't so much
> material to manage, follow, compute ratio etc. 
> By any chance, do you have any cool build-in functions to cook monthly
> data (PL, valuation etc) as we compute every month always the same data
> ?

Thank you.

I am afraid there are no built-in, ready-to-use reports in
PMwR.  That was a deliberate choice: PMwR should only
provide simple tools for computing P/L, returns, or for
backtesting, say. For analyzing the results of such
computations, you have all of R for analysis and summarizing
:-)

For my reporting needs, I typically prepare templates in
plain text, HTML or LaTeX and then fill in stats such as
returns etc. See e.g.
https://cran.r-project.org/web/packages/PMwR/vignettes/FinTeX.pdf

For equity series, i.e. total value of a portfolio, using
NAVseries and its summary method might be a start, see e.g.
https://enricoschumann.net/R/packages/PMwR/manual/PMwR.html#NAVseries-summaries
There are handful of functions for analyzing such series,
e. g. `drawdowns` or `streaks`.  But as I said, most
analysis I do with basic R functions.


-- 
Enrico Schumann
Lucerne, Switzerland
https://enricoschumann.net


From @rn@ud@g@boury @end|ng |rom gm@||@com  Fri Mar  7 14:20:17 2025
From: @rn@ud@g@boury @end|ng |rom gm@||@com (Arnaud Gaboury)
Date: Fri, 07 Mar 2025 14:20:17 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <8734fp1dij.fsf@enricoschumann.net>
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
 <2954e4905995f8d9060e4f271406655d1654972a.camel@gmail.com>
 <8734fp1dij.fsf@enricoschumann.net>
Message-ID: <44f4531cce91b8a32eca169ded7d1639b4431fef.camel@gmail.com>

On Fri, 2025-03-07 at 08:55 +0100, Enrico Schumann wrote:
> On Thu, 06 Mar 2025, Arnaud Gaboury writes:
> 
> > 	On Thu, 2025-03-06 at 07:29 +0100, Enrico Schumann wrote:
> > > On Wed, 05 Mar 2025, Arnaud Gaboury writes:
> > > 
> > > > I work with Binancer [1] and PMwR [2] packages to write a
> > > > trading
> > > > journal.
> > > > Here is a sample of my data frame:
> > > > portfolio <- data.frame(
> > > > ? symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC",
> > > > "ENAUSDT"),
> > > > ? time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-
> > > > 01-
> > > > 02
> > > > 10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
> > > > )
> > > > 
> > > > I want to fetch the 'BTCUSDT' price for a specific time if the
> > > > symbol
> > > > of same row end with these 3 letters : 'BTC'. In my sample, it
> > > > will
> > > > be
> > > > rows 3 and 4.
> > > > Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:
> > > > 
> > > > get_btc_price <- function(time) {
> > > > ? klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
> > > > 10:34:49', end_time = '2025-01-02 10:34:49')
> > > > }
> > > > 
> > > > I was thinking of this code to write my new column
> > > > BTCUSDT_price:
> > > > 
> > > > df <- portfolio %>%
> > > > ? mutate(
> > > > ??? BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"),
> > > > map_dbl(time,
> > > > get_btc_price), NA_real_)
> > > > ? )}
> > > > 
> > > > But the code returns:
> > > > Error in `mutate()`:
> > > > ? In argument: `BTCUSDT_price = ifelse(...)`.
> > > > Caused by error in `map_dbl()`:
> > > > ? In index: 1.
> > > > Caused by error in `[.data.table`:
> > > > ! Item 1 of j is 12 which is outside the column number range
> > > > [1,ncol=0]
> > > > 
> > > > I have tried other workarounds but all give me errors.
> > > > 
> > > > Thank you for help
> > > > 
> > > > 
> > > > [1]https://cran.r-project.org/web/packages/binancer
> > > > [2]https://cran.r-project.org/web/packages/PMwR
> > > > 
> > > 
> > > You want to compute a new column for your data.frame as
> > > a function of two existing columns.
> > > 
> > > In base R, if you don't want to use a loop (and there
> > > would be nothing wrong with a loop), you could use
> > > 'mapply'; and then cbind the column to your data.frame:
> > > 
> > > ??? new.column <- mapply(
> > > ??????? function(symbol, time) {
> > > ??????????? if (grepl("BTC$", symbol)) {
> > > ??????????????? ## your get_price computation, using
> > > ??????????????? ## 'symbol' and 'time'
> > > ??????????????? paste("do something with", symbol, time)
> > > ??????????????? 
> > > ??????????? } else
> > > ??????????????? NA
> > > ??????? },
> > > ??????? portfolio$symbol,
> > > ??????? portfolio$time
> > > ??? )
> > 
> > I am sorry but I can't see where I shall put my df ? And my
> > function to
> > get BTC price:
> > get_btc_price <- function(my_time) {
> > ??? # my_time_ms <- as.integer(as.numeric(my_time) * 1000)
> > ??? klines <- binance_klines("BTCUSDT", interval = '1h', start_time
> > =
> > as.Date(my_time), end_time = as.Date(my_time) + 1)
> > ??? return(as.numeric(klines$close[[18]]))
> > }
> > 
> > Thank you for your help
> 
> Is the ticker you want to fetch data for always the
> same?? If yes, then something like this could be
> used. [I don't know/use binance, so with a 'dummy' of
> your function.]

Yes, in this cas I only fecth BTCUSD price, thus my get_btc_price().
For generic, I created get_price().

Your function gives me exactly what I wanted.

Question: why do you paste 42 here ?
    get_btc_price <- function(my_time) {
        paste(42, my_time)
    }


> 
> ??? get_btc_price <- function(my_time) {
> ??????? paste(42, my_time)
> ??? }
> ??? 
> ??? new.column <- mapply(
> ??????? function(symbol, mytime) {
> ??????????? if (grepl("BTC$", symbol)) {
> ??????????????? get_btc_price(mytime)
> ??????????? } else
> ??????????????? NA
> ??????? },
> ??????? portfolio$symbol,
> ??????? portfolio$time
> ??? )
> 
> ??? ##???????????????? BTCUSDT????????????????? BTCUSDT 
> ??? ##????????????????????? NA?????????????????????? NA 
> ??? ##???????????????? ETHUBTC????????????????? AAVEBTC 
> ??? ##"42 2025-01-02 10:34:49" "42 2025-01-02 11:14:43" 
> ??? ##???????????????? ENAUSDT 
> ??? ##????????????????????? NA 
> 
> 


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20250307/ff8354f9/attachment.sig>

From br|@n @end|ng |rom br@verock@com  Fri Mar  7 14:40:13 2025
From: br|@n @end|ng |rom br@verock@com (Brian G. Peterson)
Date: Fri, 07 Mar 2025 07:40:13 -0600
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <87wmd1nnc2.fsf@enricoschumann.net>
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
 <e0aa67a0fef7f21ce6556a94241d021af1a9c78c.camel@gmail.com>
 <87wmd1nnc2.fsf@enricoschumann.net>
Message-ID: <4635125a4c8d371e3c9ad0e2ce49964d1fa0e669.camel@braverock.com>

Arnaud,

You may want to look at 'PerformanceAnalytics' for a large number of
performance and risk functions for financial time series, including a
large number of standard tables and charts.

I can also recommend Bernhard Pfaff's excellent book 'Financial Risk
Modeling and Portfolio Optimization with R, 2nd ed.'

Regards,

Brian

-- 
Brian G. Peterson
ph: +1.773.459.4973
im: bgpbraverock

On Fri, 2025-03-07 at 11:31 +0100, Enrico Schumann wrote:
> On Thu, 06 Mar 2025, Arnaud Gaboury writes:
> 
> > On Thu, 2025-03-06 at 07:29 +0100, Enrico Schumann wrote:
> > > On Wed, 05 Mar 2025, Arnaud Gaboury writes:
> > > 
> > > > I work with Binancer [1] and PMwR [2] packages to write a
> > > > trading
> > > > journal.
> > > > Here is a sample of my data frame:
> > > > portfolio <- data.frame(
> > > > ? symbol = c("BTCUSDT", "BTCUSDT", "ETHUBTC", "AAVEBTC",
> > > > "ENAUSDT"),
> > > > ? time = c("2024-12-17 10:01:30", "2024-12-18 21:32:53", "2025-
> > > > 01-
> > > > 02
> > > > 10:34:49", "2025-01-02 11:14:43", "2025-01-02 11:15:22")
> > > > )
> > > > 
> > > > I want to fetch the 'BTCUSDT' price for a specific time if the
> > > > symbol
> > > > of same row end with these 3 letters : 'BTC'. In my sample, it
> > > > will
> > > > be
> > > > rows 3 and 4.
> > > > Here is how I find BTCUSDT price for date 2025-01-02 10:34:49:
> > > > 
> > > > get_btc_price <- function(time) {
> > > > ? klines <- binance_klines('BTCUSDT', start_time = '2025-01-02
> > > > 10:34:49', end_time = '2025-01-02 10:34:49')
> > > > }
> > > > 
> > > > I was thinking of this code to write my new column
> > > > BTCUSDT_price:
> > > > 
> > > > df <- portfolio %>%
> > > > ? mutate(
> > > > ??? BTCUSDT_price = ifelse(str_detect(symbol, "BTC$"),
> > > > map_dbl(time,
> > > > get_btc_price), NA_real_)
> > > > ? )}
> > > > 
> > > > But the code returns:
> > > > Error in `mutate()`:
> > > > ? In argument: `BTCUSDT_price = ifelse(...)`.
> > > > Caused by error in `map_dbl()`:
> > > > ? In index: 1.
> > > > Caused by error in `[.data.table`:
> > > > ! Item 1 of j is 12 which is outside the column number range
> > > > [1,ncol=0]
> > > > 
> > > > I have tried other workarounds but all give me errors.
> > > > 
> > > > Thank you for help
> > > > 
> > > > 
> > > > [1]https://cran.r-project.org/web/packages/binancer
> > > > [2]https://cran.r-project.org/web/packages/PMwR
> > > > 
> > > 
> > > You want to compute a new column for your data.frame as
> > > a function of two existing columns.
> > > 
> > > In base R, if you don't want to use a loop (and there
> > > would be nothing wrong with a loop), you could use
> > > 'mapply'; and then cbind the column to your data.frame:
> > > 
> > > ??? new.column <- mapply(
> > > ??????? function(symbol, time) {
> > > ??????????? if (grepl("BTC$", symbol)) {
> > > ??????????????? ## your get_price computation, using
> > > ??????????????? ## 'symbol' and 'time'
> > > ??????????????? paste("do something with", symbol, time)
> > > ??????????????? 
> > > ??????????? } else
> > > ??????????????? NA
> > > ??????? },
> > > ??????? portfolio$symbol,
> > > ??????? portfolio$time
> > > ??? )
> > > 
> > > ??? ## new.column
> > > ??? ##???????????????????????????????????????? BTCUSDT 
> > > ??? ##????????????????????????????????????????????? NA 
> > > ??? ##???????????????????????????????????????? BTCUSDT 
> > > ??? ##????????????????????????????????????????????? NA 
> > > ??? ##???????????????????????????????????????? ETHUBTC 
> > > ??? ## "do something with ETHUBTC 2025-01-02 10:34:49" 
> > > ??? ##???????????????????????????????????????? AAVEBTC 
> > > ??? ## "do something with AAVEBTC 2025-01-02 11:14:43" 
> > > ??? ##???????????????????????????????????????? ENAUSDT 
> > > ??? ##????????????????????????????????????????????? NA 
> > 
> > Thank you for your answer.
> > A very warm thanks for your PMwR package. It helps me managing my
> > portfolio in a professional way. Unfortunately there isn't so much
> > material to manage, follow, compute ratio etc. 
> > By any chance, do you have any cool build-in functions to cook
> > monthly
> > data (PL, valuation etc) as we compute every month always the same
> > data
> > ?
> 
> Thank you.
> 
> I am afraid there are no built-in, ready-to-use reports in
> PMwR.? That was a deliberate choice: PMwR should only
> provide simple tools for computing P/L, returns, or for
> backtesting, say. For analyzing the results of such
> computations, you have all of R for analysis and summarizing
> :-)
> 
> For my reporting needs, I typically prepare templates in
> plain text, HTML or LaTeX and then fill in stats such as
> returns etc. See e.g.
> https://cran.r-project.org/web/packages/PMwR/vignettes/FinTeX.pdf
> 
> For equity series, i.e. total value of a portfolio, using
> NAVseries and its summary method might be a start, see e.g.
> https://enricoschumann.net/R/packages/PMwR/manual/PMwR.html#NAVseries-summaries
> There are handful of functions for analyzing such series,
> e. g. `drawdowns` or `streaks`.? But as I said, most
> analysis I do with basic R functions.
> 
> 

	[[alternative HTML version deleted]]


From @rn@ud@g@boury @end|ng |rom gm@||@com  Fri Mar  7 14:57:39 2025
From: @rn@ud@g@boury @end|ng |rom gm@||@com (Arnaud Gaboury)
Date: Fri, 07 Mar 2025 14:57:39 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <4635125a4c8d371e3c9ad0e2ce49964d1fa0e669.camel@braverock.com>
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
 <e0aa67a0fef7f21ce6556a94241d021af1a9c78c.camel@gmail.com>
 <87wmd1nnc2.fsf@enricoschumann.net>
 <4635125a4c8d371e3c9ad0e2ce49964d1fa0e669.camel@braverock.com>
Message-ID: <a378d51ac31f91d4433adf835dceae9137977c75.camel@gmail.com>

On Fri, 2025-03-07 at 07:40 -0600, Brian G. Peterson wrote:
> Arnaud,
> 
> You may want to look at 'PerformanceAnalytics' for a large number of
> performance and risk functions for financial time series, including a
> large number of standard tables and charts.

Yes, I know a little bit the 'PerformanceAnalytics' package. I will
certainly have a close look and do different work with it , but first I
wanted to test Enrico package as it is simple and very straightforward.
My portfolio is very simple, thus its management too.
> 
> I can also recommend Bernhard Pfaff's excellent book 'Financial Risk
> Modeling and Portfolio Optimization with R, 2nd ed.'
> 
> Regards,
> 
> Brian
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20250307/165970f1/attachment.html>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20250307/165970f1/attachment.sig>

From e@ @end|ng |rom enr|co@chum@nn@net  Fri Mar  7 14:57:34 2025
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Fri, 07 Mar 2025 14:57:34 +0100
Subject: [R-SIG-Finance] apply a function to a data.frame column with
 condition
In-Reply-To: <44f4531cce91b8a32eca169ded7d1639b4431fef.camel@gmail.com>
 (Arnaud Gaboury's message of "Fri, 07 Mar 2025 14:20:17 +0100")
References: <1cfce8c24a770a67b6890c6b4c9b1343bc9ef87a.camel@gmail.com>
 <87pliu1xl6.fsf@enricoschumann.net>
 <2954e4905995f8d9060e4f271406655d1654972a.camel@gmail.com>
 <8734fp1dij.fsf@enricoschumann.net>
 <44f4531cce91b8a32eca169ded7d1639b4431fef.camel@gmail.com>
Message-ID: <87jz91ndtd.fsf@enricoschumann.net>

On Fri, 07 Mar 2025, Arnaud Gaboury writes:

[...]

> Question: why do you paste 42 here ?
>     get_btc_price <- function(my_time) {
>         paste(42, my_time)
>     }

Oh, just some random computation with 'my_time' :-)



-- 
Enrico Schumann
Lucerne, Switzerland
https://enricoschumann.net


From @rn@ud@g@boury @end|ng |rom gm@||@com  Fri Mar  7 16:00:52 2025
From: @rn@ud@g@boury @end|ng |rom gm@||@com (Arnaud Gaboury)
Date: Fri, 07 Mar 2025 16:00:52 +0100
Subject: [R-SIG-Finance] from tibble to journal
Message-ID: <0600a74e1ff59e2c94cc8a26887a7f64443bb4bb.camel@gmail.com>

I have one tibble 'journal_tb' with this structure:

gabx at magnolia [R] str(journal_tb)
tibble [72 ? 4] (S3: tbl_df/tbl/data.frame)
 $ timestamp : POSIXct[1:72], format: "2024-12-16 18:00:00" "2024-12-16
18:00:00" "2024-12-16 18:00:00" "2024-12-16 18:00:00" ...
 $ instrument: chr [1:72] "FTMUSDT" "SUIUSDT" "ETHUSDT" "ENAUSDT" ...
 $ amount    : num [1:72] 284270 80024 91.9 207836 9.34 ...
 $ price     : num [1:72] 1.38 4.73 4038 1.19 107012 ...

When transforming to a PMwR journal:

gabx at magnolia [R] my_journal <- as.journal(my_journal_tb)

I have this error: Error in names[[i]] : subscript out of bounds

I have double checked my columns but everything looks fine.

How can I solve this out of bounds error?

Thnak you for help


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-sig-finance/attachments/20250307/610bc538/attachment.sig>

From e@ @end|ng |rom enr|co@chum@nn@net  Fri Mar  7 16:55:50 2025
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Fri, 07 Mar 2025 16:55:50 +0100
Subject: [R-SIG-Finance] from tibble to journal
In-Reply-To: <0600a74e1ff59e2c94cc8a26887a7f64443bb4bb.camel@gmail.com>
 (Arnaud Gaboury's message of "Fri, 07 Mar 2025 16:00:52 +0100")
References: <0600a74e1ff59e2c94cc8a26887a7f64443bb4bb.camel@gmail.com>
Message-ID: <8734fosum1.fsf@enricoschumann.net>

On Fri, 07 Mar 2025, Arnaud Gaboury writes:

> I have one tibble 'journal_tb' with this structure:
>
> gabx at magnolia [R] str(journal_tb)
> tibble [72 ? 4] (S3: tbl_df/tbl/data.frame)
>  $ timestamp : POSIXct[1:72], format: "2024-12-16 18:00:00" "2024-12-16
> 18:00:00" "2024-12-16 18:00:00" "2024-12-16 18:00:00" ...
>  $ instrument: chr [1:72] "FTMUSDT" "SUIUSDT" "ETHUSDT" "ENAUSDT" ...
>  $ amount    : num [1:72] 284270 80024 91.9 207836 9.34 ...
>  $ price     : num [1:72] 1.38 4.73 4038 1.19 107012 ...
>
> When transforming to a PMwR journal:
>
> gabx at magnolia [R] my_journal <- as.journal(my_journal_tb)
>
> I have this error: Error in names[[i]] : subscript out of bounds
>
> I have double checked my columns but everything looks fine.
>
> How can I solve this out of bounds error?
>
> Thnak you for help

Hm, the 'str' output is for 'journal_tb', but below you
try to coerce 'my_journal_tb'. Is this simply a typo?

In any case, we would need a small reproducible example to
see why it does not work, e. g. by using
dput(my_journal_tb).    [Ideally only a few rows.]

I can do this, for instance, without problems:

    library("PMwR")
    d <- data.frame(timestamp = c("2024-12-16 18:00:00",
                                  "2024-12-16 18:00:00"),
                    instrument= c( "FTMUSDT", "SUIUSDT"),
                    amount  = c(284270, 80024),
                    price  = c(1.38, 4.73))
    as.journal(d)
    ## 1     FTMUSDT  2024-12-16 18:00:00  284270   1.38
    ## 2     SUIUSDT  2024-12-16 18:00:00   80024   4.73
    ## 
    ## 2 transactions  
    
    library("tibble")
    d <- as_tibble(d)
    as.journal(d)
    ## 1     FTMUSDT  2024-12-16 18:00:00  284270   1.38
    ## 2     SUIUSDT  2024-12-16 18:00:00   80024   4.73
    ## 
    ## 2 transactions  



-- 
Enrico Schumann
Lucerne, Switzerland
https://enricoschumann.net


From @rn@ud@g@boury @end|ng |rom gm@||@com  Fri Mar  7 17:05:41 2025
From: @rn@ud@g@boury @end|ng |rom gm@||@com (arnaud gaboury)
Date: Fri, 7 Mar 2025 17:05:41 +0100
Subject: [R-SIG-Finance] from tibble to journal
In-Reply-To: <8734fosum1.fsf@enricoschumann.net>
References: <0600a74e1ff59e2c94cc8a26887a7f64443bb4bb.camel@gmail.com>
 <8734fosum1.fsf@enricoschumann.net>
Message-ID: <CAK1hC9uXP1vm1Lg2_vj8GRxxF_qz4CBFrnz1iXogeA4NgBJwqw@mail.gmail.com>

I managed to remove the error by ordering the columns in the correct order,
as indicated in the pdf

On Fri, Mar 7, 2025, 4:55?PM Enrico Schumann <es at enricoschumann.net> wrote:

> On Fri, 07 Mar 2025, Arnaud Gaboury writes:
>
> > I have one tibble 'journal_tb' with this structure:
> >
> > gabx at magnolia [R] str(journal_tb)
> > tibble [72 ? 4] (S3: tbl_df/tbl/data.frame)
> >  $ timestamp : POSIXct[1:72], format: "2024-12-16 18:00:00" "2024-12-16
> > 18:00:00" "2024-12-16 18:00:00" "2024-12-16 18:00:00" ...
> >  $ instrument: chr [1:72] "FTMUSDT" "SUIUSDT" "ETHUSDT" "ENAUSDT" ...
> >  $ amount    : num [1:72] 284270 80024 91.9 207836 9.34 ...
> >  $ price     : num [1:72] 1.38 4.73 4038 1.19 107012 ...
> >
> > When transforming to a PMwR journal:
> >
> > gabx at magnolia [R] my_journal <- as.journal(my_journal_tb)
> >
> > I have this error: Error in names[[i]] : subscript out of bounds
> >
> > I have double checked my columns but everything looks fine.
> >
> > How can I solve this out of bounds error?
> >
> > Thnak you for help
>
> Hm, the 'str' output is for 'journal_tb', but below you
> try to coerce 'my_journal_tb'. Is this simply a typo?
>
> In any case, we would need a small reproducible example to
> see why it does not work, e. g. by using
> dput(my_journal_tb).    [Ideally only a few rows.]
>
> I can do this, for instance, without problems:
>
>     library("PMwR")
>     d <- data.frame(timestamp = c("2024-12-16 18:00:00",
>                                   "2024-12-16 18:00:00"),
>                     instrument= c( "FTMUSDT", "SUIUSDT"),
>                     amount  = c(284270, 80024),
>                     price  = c(1.38, 4.73))
>     as.journal(d)
>     ## 1     FTMUSDT  2024-12-16 18:00:00  284270   1.38
>     ## 2     SUIUSDT  2024-12-16 18:00:00   80024   4.73
>     ##
>     ## 2 transactions
>
>     library("tibble")
>     d <- as_tibble(d)
>     as.journal(d)
>     ## 1     FTMUSDT  2024-12-16 18:00:00  284270   1.38
>     ## 2     SUIUSDT  2024-12-16 18:00:00   80024   4.73
>     ##
>     ## 2 transactions
>
>
>
> --
> Enrico Schumann
> Lucerne, Switzerland
> https://enricoschumann.net
>

	[[alternative HTML version deleted]]


